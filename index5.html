<!DOCTYPE html>
<!--
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘   MOUDAR - Copilote Science de la mise en Å“uvre                              â•‘
â•‘   Version 11.0 - SCIENTIFIC EXCELLENCE EDITION                               â•‘
â•‘   Pour Organisations Internationales & MinistÃ¨res                            â•‘
â•‘                                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   Copyright (c) 2025 Younes MOUDAR                                          â•‘
â•‘   CrÃ©ateur de MOUDARÂ® â€“ Copilote Science de la mise en Å“uvre                  â•‘
â•‘                                                                              â•‘
â•‘   Tous droits rÃ©servÃ©s / All rights reserved                                 â•‘
â•‘                                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   LICENCE PROPRIÃ‰TAIRE / PROPRIETARY LICENSE                                 â•‘
â•‘                                                                              â•‘
â•‘   Ce logiciel et sa documentation sont la propriÃ©tÃ© exclusive de             â•‘
â•‘   Younes MOUDAR. Toute reproduction, modification,                          â•‘
â•‘   distribution ou utilisation non autorisÃ©e est strictement interdite.       â•‘
â•‘                                                                              â•‘
â•‘   This software and its documentation are the exclusive property of          â•‘
â•‘   Younes MOUDAR. Any unauthorized reproduction,                              â•‘
â•‘   modification, distribution or use is strictly prohibited.                  â•‘
â•‘                                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   NOUVEAUTÃ‰S v11.0 SCIENTIFIC EXCELLENCE:                                     â•‘
â•‘   â€¢ CFIR 2.0 exact alignment (Damschroder et al. 2022) â€” 5 domains, 39 constructs â•‘
â•‘   â€¢ CFIR-ERIC Automated Matching (Waltz et al. 2019) â€” 73 strategies         â•‘
â•‘   â€¢ Health Equity Module (Woodward et al. 2019)                               â•‘
â•‘   â€¢ Implementation Outcomes (Proctor et al. 2011) â€” 8 outcomes                â•‘
â•‘   â€¢ NPT Module (May & Finch 2009/2015) â€” Normalization Process Theory         â•‘
â•‘   â€¢ FRAME Adaptation Tracker (Stirman et al. 2019)                            â•‘
â•‘   â€¢ Scientific Citations Registry with auto-generation                         â•‘
â•‘   â€¢ COM-B Behavioral Framework (Michie et al. 2011) â€” separate module          â•‘
â•‘   â€¢ All v10.0 features: E2EE, Consensus, BIA, SNA, Sustainability            â•‘
â•‘   1. End-to-End Encryption (E2EE) - AES-256-GCM client-side                  â•‘
â•‘   2. Consensus Validation Engine (CVE) - Multi-expert assessment             â•‘
â•‘   3. Adaptive Implementation Engine (AIE) - Dynamic piloting                 â•‘
â•‘   4. Grant AI Writer (GAW) - Proposal generator                              â•‘
â•‘   5. Qualitative Analysis Engine (QAE) - NLP for interviews                  â•‘
â•‘   6. Benchmarking Engine (BE) - Collective intelligence                      â•‘
â•‘   7. Digital Twin Module (DTM) - Organizational modeling                     â•‘
â•‘   8. Budget Impact Analysis (BIA) - Multi-year projections                   â•‘
â•‘   9. Stakeholder Network Analysis (SNA) - Power/Interest mapping             â•‘
â•‘  10. Sustainability Framework (SF) - Scheirer & Dearing model                â•‘
â•‘                                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   Auteur / Author: Younes MOUDAR                                             â•‘
â•‘   Date de crÃ©ation / Creation date: 2025                                     â•‘
â•‘   Contact: contact@moudar.com                                                â•‘
â•‘   Site web / Website: https://moudar.com                                     â•‘
â•‘                                                                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                              â•‘
â•‘   Technologies utilisÃ©es / Technologies used:                                â•‘
â•‘   - React 18.2.0 (MIT License)                                               â•‘
â•‘   - Tailwind CSS (MIT License)                                               â•‘
â•‘   - Babel (MIT License)                                                      â•‘
â•‘   - Web Crypto API (Native)                                                  â•‘
â•‘   - docx.js (MIT License)                                                    â•‘
â•‘   - FileSaver.js (MIT License)                                               â•‘
â•‘   - html2pdf.js (MIT License)                                                â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<html lang="fr">
<head>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOUDAR Core Configuration Module
         Pattern: IIFE (Immediately Invoked Function Expression)
         Purpose: Encapsulate configuration, avoid global pollution
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
"use strict";
// â”€â”€ PRODUCTION LOG GUARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Silences console.log in production unless ?debug=true in URL
// console.warn and console.error are always preserved (they indicate real issues)
(function() {
    var isDebug = window.location.search.indexOf('debug=true') !== -1;
    if (!isDebug) {
        var _originalLog = console.log;
        console.log = function() {
            // In production, only log MOUDAR init messages (first 5 calls)
            if (console.log._count === undefined) console.log._count = 0;
            console.log._count++;
            if (console.log._count <= 5) _originalLog.apply(console, arguments);
        };
    }
})();
const MOUDAR = (function() {
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // API Configuration (Cloud/AI backend - disabled by default)
    // SECURITY: API keys use sessionStorage (cleared on tab close), NOT localStorage
    // In production, use a backend proxy (window.MOUDAR_LLM_PROXY) instead
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const API = {
        base: (sessionStorage.getItem('MOUDAR_API_BASE') || '').trim(),
        key: (sessionStorage.getItem('MOUDAR_API_KEY') || '').trim(),
        isConfigured: function() {
            return this.base.length > 0 && this.key.length > 0;
        },
        getHeaders: function() {
            return {
                'Content-Type': 'application/json',
                'Authorization': this.key ? 'Bearer ' + this.key : ''
            };
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Analytics Configuration (Privacy-first, consent-based)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const Analytics = {
        id: 'G-0TCZDG20L1',
        consent: localStorage.getItem('MOUDAR_ANALYTICS_CONSENT'),
        loaded: false,
        
        load: function() {
            if (!this.id || this.loaded) return;
            this.loaded = true;
            
            const script = document.createElement('script');
            script.async = true;
            script.src = 'https://www.googletagmanager.com/gtag/js?id=' + encodeURIComponent(this.id);
            document.head.appendChild(script);
            
            window.dataLayer = window.dataLayer || [];
            window.gtag = function() { dataLayer.push(arguments); };
            window.gtag('js', new Date());
            window.gtag('config', this.id, { 
                'anonymize_ip': true, 
                'send_page_view': true 
            });
            
            console.log('[MOUDAR Analytics] Loaded with consent');
        },
        
        setConsent: function(granted) {
            const value = granted ? 'granted' : 'denied';
            localStorage.setItem('MOUDAR_ANALYTICS_CONSENT', value);
            this.consent = value;
            if (granted) this.load();
        },
        
        track: function(eventName, params) {
            if (this.loaded && window.gtag) {
                window.gtag('event', eventName, params || {});
            }
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Version & Metadata
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const Meta = {
        version: '11.0',
        edition: 'Enterprise Security + Consensus',
        modules: ['AIE', 'GAW', 'QAE', 'BE', 'DTM', 'BIA', 'SNA', 'SF', 'E2EE', 'CVE'],
        author: 'Younes MOUDAR',
        copyright: 'Â© 2025 Younes MOUDAR. All rights reserved.',
        website: 'https://moudar.com',
        features: {
            encryption: 'AES-256-GCM E2E',
            consensus: 'Multi-expert validation',
            security: 'Enterprise-grade'
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Accessibility Helpers
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const A11y = {
        announce: function(message, priority) {
            const el = document.getElementById('moudar-aria-live');
            if (el) {
                el.setAttribute('aria-live', priority || 'polite');
                el.textContent = message;
                setTimeout(function() { el.textContent = ''; }, 3000);
            }
        },
        trapFocus: function(element) {
            const focusables = element.querySelectorAll(
                'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
            );
            const first = focusables[0];
            const last = focusables[focusables.length - 1];
            
            element.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    if (e.shiftKey && document.activeElement === first) {
                        e.preventDefault();
                        last.focus();
                    } else if (!e.shiftKey && document.activeElement === last) {
                        e.preventDefault();
                        first.focus();
                    }
                }
            });
        },
        // WCAG 2.1 AA contrast ratio checker
        contrastRatio: function(hex1, hex2) {
            function hexToRgb(hex) {
                hex = hex.replace('#', '');
                return { r: parseInt(hex.substring(0, 2), 16), g: parseInt(hex.substring(2, 4), 16), b: parseInt(hex.substring(4, 6), 16) };
            }
            function luminance(rgb) {
                var a = [rgb.r, rgb.g, rgb.b].map(function(v) {
                    v = v / 255;
                    return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
                });
                return 0.2126 * a[0] + 0.7152 * a[1] + 0.0722 * a[2];
            }
            var l1 = luminance(hexToRgb(hex1));
            var l2 = luminance(hexToRgb(hex2));
            var lighter = Math.max(l1, l2);
            var darker = Math.min(l1, l2);
            return (lighter + 0.05) / (darker + 0.05);
        },
        // Check if a color pair passes WCAG AA
        passesAA: function(textHex, bgHex, isLargeText) {
            var ratio = this.contrastRatio(textHex, bgHex);
            var threshold = isLargeText ? 3.0 : 4.5;
            return { passes: ratio >= threshold, ratio: Math.round(ratio * 100) / 100, threshold: threshold, level: ratio >= 7 ? 'AAA' : ratio >= 4.5 ? 'AA' : ratio >= 3 ? 'AA-large' : 'fail' };
        },
        // Audit visible elements for contrast (dev tool)
        auditContrast: function() {
            var issues = [];
            document.querySelectorAll('*').forEach(function(el) {
                var style = window.getComputedStyle(el);
                var color = style.color;
                var bg = style.backgroundColor;
                if (color && bg && bg !== 'rgba(0, 0, 0, 0)') {
                    // Simple extraction (works for rgb/rgba)
                    var match = color.match(/(\d+),\s*(\d+),\s*(\d+)/);
                    var bgMatch = bg.match(/(\d+),\s*(\d+),\s*(\d+)/);
                    if (match && bgMatch) {
                        var cHex = '#' + [match[1], match[2], match[3]].map(function(n) { return parseInt(n).toString(16).padStart(2, '0'); }).join('');
                        var bHex = '#' + [bgMatch[1], bgMatch[2], bgMatch[3]].map(function(n) { return parseInt(n).toString(16).padStart(2, '0'); }).join('');
                        var result = A11y.passesAA(cHex, bHex, parseFloat(style.fontSize) >= 18);
                        if (!result.passes) {
                            issues.push({ element: el.tagName + '.' + el.className.split(' ')[0], ratio: result.ratio, text: el.textContent.substring(0, 30) });
                        }
                    }
                }
            });
            if (issues.length > 0) console.warn('[MOUDAR A11y] ' + issues.length + ' contrast issues found:', issues.slice(0, 10));
            else console.log('[MOUDAR A11y] âœ… All visible elements pass WCAG AA');
            return issues;
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // User Feedback System
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const Feedback = {
        show: function(message, type, duration) {
            type = type || 'info';
            duration = duration || 3000;
            
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            const icons = {
                success: 'âœ“',
                error: 'âœ•',
                warning: 'âš ',
                info: 'â„¹'
            };
            
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 right-4 z-[9999] px-4 py-3 rounded-lg text-white shadow-xl flex items-center gap-2 animate-fade-in ' + colors[type];
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.innerHTML = DOMPurify.sanitize('<span class="text-lg">' + icons[type] + '</span><span>' + message + '</span>');
            
            document.body.appendChild(toast);
            
            setTimeout(function() {
                toast.classList.add('opacity-0', 'transition-opacity');
                setTimeout(function() { toast.remove(); }, 300);
            }, duration);
            
            // Also announce for screen readers
            A11y.announce(message, type === 'error' ? 'assertive' : 'polite');
        },
        
        success: function(msg) { this.show(msg, 'success'); },
        error: function(msg) { this.show(msg, 'error', 5000); },
        warning: function(msg) { this.show(msg, 'warning'); },
        info: function(msg) { this.show(msg, 'info'); }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Initialize
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (Analytics.consent === 'granted') {
        Analytics.load();
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // v10.0 - END-TO-END ENCRYPTION MODULE (E2EE)
    // Uses Web Crypto API for AES-256-GCM encryption
    // Critical for ministerial and international organization data
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const Crypto = {
        algorithm: 'AES-GCM',
        keyLength: 256,
        ivLength: 12,
        saltLength: 16,
        iterations: 100000,
        
        // Check if Web Crypto API is available
        isSupported: function() {
            return window.crypto && window.crypto.subtle;
        },
        
        // Generate a random encryption key
        generateKey: async function() {
            if (!this.isSupported()) throw new Error('Web Crypto API not supported');
            
            const key = await crypto.subtle.generateKey(
                { name: this.algorithm, length: this.keyLength },
                true,
                ['encrypt', 'decrypt']
            );
            return key;
        },
        
        // Derive key from password using PBKDF2
        deriveKeyFromPassword: async function(password, salt) {
            if (!this.isSupported()) throw new Error('Web Crypto API not supported');
            
            const encoder = new TextEncoder();
            const passwordBuffer = encoder.encode(password);
            
            // Import password as key material
            const keyMaterial = await crypto.subtle.importKey(
                'raw',
                passwordBuffer,
                'PBKDF2',
                false,
                ['deriveKey']
            );
            
            // Derive AES key from password
            const derivedKey = await crypto.subtle.deriveKey(
                {
                    name: 'PBKDF2',
                    salt: salt,
                    iterations: this.iterations,
                    hash: 'SHA-256'
                },
                keyMaterial,
                { name: this.algorithm, length: this.keyLength },
                false,
                ['encrypt', 'decrypt']
            );
            
            return derivedKey;
        },
        
        // Encrypt data with AES-256-GCM
        encrypt: async function(data, password) {
            if (!this.isSupported()) throw new Error('Web Crypto API not supported');
            
            const encoder = new TextEncoder();
            const dataBuffer = encoder.encode(JSON.stringify(data));
            
            // Generate random salt and IV
            const salt = crypto.getRandomValues(new Uint8Array(this.saltLength));
            const iv = crypto.getRandomValues(new Uint8Array(this.ivLength));
            
            // Derive key from password
            const key = await this.deriveKeyFromPassword(password, salt);
            
            // Encrypt
            const encrypted = await crypto.subtle.encrypt(
                { name: this.algorithm, iv: iv },
                key,
                dataBuffer
            );
            
            // Combine salt + iv + ciphertext
            const combined = new Uint8Array(salt.length + iv.length + encrypted.byteLength);
            combined.set(salt, 0);
            combined.set(iv, salt.length);
            combined.set(new Uint8Array(encrypted), salt.length + iv.length);
            
            // Return as base64
            return btoa(String.fromCharCode.apply(null, combined));
        },
        
        // Decrypt data
        decrypt: async function(encryptedBase64, password) {
            if (!this.isSupported()) throw new Error('Web Crypto API not supported');
            
            // Decode base64
            const combined = new Uint8Array(
                atob(encryptedBase64).split('').map(function(c) { return c.charCodeAt(0); })
            );
            
            // Extract salt, iv, and ciphertext
            const salt = combined.slice(0, this.saltLength);
            const iv = combined.slice(this.saltLength, this.saltLength + this.ivLength);
            const ciphertext = combined.slice(this.saltLength + this.ivLength);
            
            // Derive key from password
            const key = await this.deriveKeyFromPassword(password, salt);
            
            // Decrypt
            const decrypted = await crypto.subtle.decrypt(
                { name: this.algorithm, iv: iv },
                key,
                ciphertext
            );
            
            // Decode and parse
            const decoder = new TextDecoder();
            return JSON.parse(decoder.decode(decrypted));
        },
        
        // Hash data (for integrity checks)
        hash: async function(data) {
            if (!this.isSupported()) throw new Error('Web Crypto API not supported');
            
            const encoder = new TextEncoder();
            const dataBuffer = encoder.encode(JSON.stringify(data));
            const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(function(b) { return b.toString(16).padStart(2, '0'); }).join('');
        },
        
        // Generate secure random ID
        generateSecureId: function(length) {
            length = length || 32;
            const array = new Uint8Array(length);
            crypto.getRandomValues(array);
            return Array.from(array).map(function(b) { return b.toString(16).padStart(2, '0'); }).join('').slice(0, length);
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // v10.0 - CONSENSUS VALIDATION MODULE
    // Multi-expert collaborative assessment with divergence detection
    // For institutional validation workflows (10+ accounts)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const Consensus = {
        // Voting weights by role
        roleWeights: {
            lead_expert: 1.5,
            senior_expert: 1.2,
            expert: 1.0,
            reviewer: 0.8,
            observer: 0.5
        },
        
        // Divergence thresholds
        thresholds: {
            low: 0.15,      // <15% variance = consensus
            moderate: 0.30,  // 15-30% = moderate divergence
            high: 0.50       // >30% = high divergence, needs discussion
        },
        
        // Create a new validation session
        createSession: function(projectId, dimensions, experts) {
            return {
                id: 'VS_' + Date.now() + '_' + Crypto.generateSecureId(8),
                projectId: projectId,
                dimensions: dimensions || ['feasibility', 'impact', 'sustainability', 'scalability', 'equity'],
                experts: experts || [],
                votes: [],
                status: 'open',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                consensus: null,
                divergences: []
            };
        },
        
        // Add an expert vote
        addVote: function(session, expertId, role, scores, comments) {
            const weight = this.roleWeights[role] || 1.0;
            
            const vote = {
                id: 'VOTE_' + Date.now(),
                expertId: expertId,
                role: role,
                weight: weight,
                scores: scores, // { dimension: score (0-100) }
                comments: comments || {},
                timestamp: new Date().toISOString()
            };
            
            // Remove previous vote from same expert
            session.votes = session.votes.filter(function(v) { return v.expertId !== expertId; });
            session.votes.push(vote);
            session.updatedAt = new Date().toISOString();
            
            return vote;
        },
        
        // Calculate weighted consensus scores
        calculateConsensus: function(session) {
            if (session.votes.length === 0) return null;
            
            const dimensions = session.dimensions;
            const votes = session.votes;
            const self = this;
            
            const consensus = {
                scores: {},
                variance: {},
                divergenceLevel: {},
                overallScore: 0,
                overallVariance: 0,
                participationRate: votes.length / Math.max(session.experts.length, 1),
                totalExperts: session.experts.length,
                votesReceived: votes.length
            };
            
            // Calculate weighted average and variance for each dimension
            dimensions.forEach(function(dim) {
                let totalWeight = 0;
                let weightedSum = 0;
                const allScores = [];
                
                votes.forEach(function(vote) {
                    if (vote.scores && typeof vote.scores[dim] === 'number') {
                        const score = vote.scores[dim];
                        const weight = vote.weight;
                        weightedSum += score * weight;
                        totalWeight += weight;
                        allScores.push(score);
                    }
                });
                
                if (totalWeight > 0) {
                    const mean = weightedSum / totalWeight;
                    consensus.scores[dim] = Math.round(mean * 10) / 10;
                    
                    // Calculate variance
                    let varianceSum = 0;
                    allScores.forEach(function(score) {
                        varianceSum += Math.pow(score - mean, 2);
                    });
                    const variance = allScores.length > 1 ? varianceSum / allScores.length : 0;
                    const stdDev = Math.sqrt(variance);
                    const coefficientOfVariation = mean > 0 ? stdDev / mean : 0;
                    
                    consensus.variance[dim] = Math.round(coefficientOfVariation * 100) / 100;
                    
                    // Determine divergence level
                    if (coefficientOfVariation < self.thresholds.low) {
                        consensus.divergenceLevel[dim] = 'consensus';
                    } else if (coefficientOfVariation < self.thresholds.moderate) {
                        consensus.divergenceLevel[dim] = 'moderate';
                    } else {
                        consensus.divergenceLevel[dim] = 'high';
                    }
                }
            });
            
            // Calculate overall scores
            const dimScores = Object.values(consensus.scores);
            const dimVariances = Object.values(consensus.variance);
            
            if (dimScores.length > 0) {
                consensus.overallScore = Math.round(
                    dimScores.reduce(function(a, b) { return a + b; }, 0) / dimScores.length * 10
                ) / 10;
                consensus.overallVariance = Math.round(
                    dimVariances.reduce(function(a, b) { return a + b; }, 0) / dimVariances.length * 100
                ) / 100;
            }
            
            session.consensus = consensus;
            return consensus;
        },
        
        // Identify divergent opinions
        identifyDivergences: function(session) {
            const self = this;
            const divergences = [];
            const consensus = session.consensus;
            
            if (!consensus) return divergences;
            
            session.dimensions.forEach(function(dim) {
                const meanScore = consensus.scores[dim];
                if (typeof meanScore !== 'number') return;
                
                session.votes.forEach(function(vote) {
                    const score = vote.scores[dim];
                    if (typeof score !== 'number') return;
                    
                    const deviation = Math.abs(score - meanScore);
                    const relativeDeviation = meanScore > 0 ? deviation / meanScore : 0;
                    
                    if (relativeDeviation > self.thresholds.moderate) {
                        divergences.push({
                            dimension: dim,
                            expertId: vote.expertId,
                            role: vote.role,
                            score: score,
                            consensusScore: meanScore,
                            deviation: Math.round(deviation * 10) / 10,
                            deviationPercent: Math.round(relativeDeviation * 100),
                            comment: vote.comments[dim] || null,
                            severity: relativeDeviation > self.thresholds.high ? 'high' : 'moderate'
                        });
                    }
                });
            });
            
            // Sort by severity and deviation
            divergences.sort(function(a, b) {
                if (a.severity !== b.severity) return a.severity === 'high' ? -1 : 1;
                return b.deviationPercent - a.deviationPercent;
            });
            
            session.divergences = divergences;
            return divergences;
        },
        
        // Generate discussion points from divergences
        generateDiscussionPoints: function(session, lang) {
            lang = lang || 'fr';
            const divergences = session.divergences || [];
            const points = [];
            
            // Group by dimension
            const byDimension = {};
            divergences.forEach(function(d) {
                if (!byDimension[d.dimension]) byDimension[d.dimension] = [];
                byDimension[d.dimension].push(d);
            });
            
            Object.keys(byDimension).forEach(function(dim) {
                const items = byDimension[dim];
                const highSeverity = items.filter(function(i) { return i.severity === 'high'; });
                
                if (highSeverity.length > 0) {
                    points.push({
                        priority: 'high',
                        dimension: dim,
                        icon: 'ðŸ”´',
                        title: lang === 'fr'
                            ? 'Divergence majeure sur "' + dim + '"'
                            : 'Major divergence on "' + dim + '"',
                        description: lang === 'fr'
                            ? highSeverity.length + ' expert(s) avec Ã©cart >30% vs consensus'
                            : highSeverity.length + ' expert(s) with >30% deviation from consensus',
                        experts: highSeverity.map(function(h) { return h.expertId; }),
                        action: lang === 'fr'
                            ? 'Discussion approfondie requise avant dÃ©cision'
                            : 'In-depth discussion required before decision'
                    });
                } else if (items.length > 0) {
                    points.push({
                        priority: 'moderate',
                        dimension: dim,
                        icon: 'ðŸŸ¡',
                        title: lang === 'fr'
                            ? 'Divergence modÃ©rÃ©e sur "' + dim + '"'
                            : 'Moderate divergence on "' + dim + '"',
                        description: lang === 'fr'
                            ? items.length + ' expert(s) avec Ã©cart notable'
                            : items.length + ' expert(s) with notable deviation',
                        experts: items.map(function(i) { return i.expertId; }),
                        action: lang === 'fr'
                            ? 'Clarification recommandÃ©e'
                            : 'Clarification recommended'
                    });
                }
            });
            
            // Add consensus points
            session.dimensions.forEach(function(dim) {
                if (!byDimension[dim] || byDimension[dim].length === 0) {
                    if (session.consensus && session.consensus.scores[dim]) {
                        points.push({
                            priority: 'consensus',
                            dimension: dim,
                            icon: 'âœ…',
                            title: lang === 'fr'
                                ? 'Consensus atteint sur "' + dim + '"'
                                : 'Consensus reached on "' + dim + '"',
                            description: lang === 'fr'
                                ? 'Score: ' + session.consensus.scores[dim] + '/100 (variance: ' + (session.consensus.variance[dim] * 100).toFixed(1) + '%)'
                                : 'Score: ' + session.consensus.scores[dim] + '/100 (variance: ' + (session.consensus.variance[dim] * 100).toFixed(1) + '%)',
                            experts: [],
                            action: lang === 'fr' ? 'Aucune action requise' : 'No action required'
                        });
                    }
                }
            });
            
            return points.sort(function(a, b) {
                const order = { high: 0, moderate: 1, consensus: 2 };
                return order[a.priority] - order[b.priority];
            });
        },
        
        // Generate final validation report
        generateReport: function(session, lang) {
            lang = lang || 'fr';
            const consensus = session.consensus;
            const divergences = session.divergences || [];
            
            if (!consensus) {
                this.calculateConsensus(session);
                this.identifyDivergences(session);
            }
            
            const highDivergences = divergences.filter(function(d) { return d.severity === 'high'; });
            
            const report = {
                sessionId: session.id,
                projectId: session.projectId,
                generatedAt: new Date().toISOString(),
                summary: {
                    totalExperts: session.experts.length,
                    votesReceived: session.votes.length,
                    participationRate: Math.round(session.consensus.participationRate * 100) + '%',
                    overallScore: session.consensus.overallScore,
                    overallVariance: session.consensus.overallVariance,
                    consensusStatus: highDivergences.length === 0 
                        ? (lang === 'fr' ? 'Consensus atteint' : 'Consensus reached')
                        : (lang === 'fr' ? 'Divergences Ã  rÃ©soudre' : 'Divergences to resolve'),
                    readyForDecision: highDivergences.length === 0
                },
                dimensionScores: session.consensus.scores,
                divergenceCount: {
                    high: highDivergences.length,
                    moderate: divergences.length - highDivergences.length,
                    total: divergences.length
                },
                discussionPoints: this.generateDiscussionPoints(session, lang),
                recommendations: this.generateRecommendations(session, lang)
            };
            
            return report;
        },
        
        // Generate recommendations based on consensus analysis
        generateRecommendations: function(session, lang) {
            lang = lang || 'fr';
            const recs = [];
            const consensus = session.consensus;
            const divergences = session.divergences || [];
            
            // Participation recommendation
            if (consensus.participationRate < 0.8) {
                recs.push({
                    priority: 'high',
                    icon: 'ðŸ‘¥',
                    text: lang === 'fr'
                        ? 'Taux de participation insuffisant (' + Math.round(consensus.participationRate * 100) + '%). Relancer les experts non-rÃ©pondants.'
                        : 'Insufficient participation rate (' + Math.round(consensus.participationRate * 100) + '%). Follow up with non-responding experts.'
                });
            }
            
            // Divergence recommendations
            const highDivergences = divergences.filter(function(d) { return d.severity === 'high'; });
            if (highDivergences.length > 0) {
                const dims = [...new Set(highDivergences.map(function(d) { return d.dimension; }))];
                recs.push({
                    priority: 'high',
                    icon: 'ðŸ”´',
                    text: lang === 'fr'
                        ? 'Organiser une session de consensus sur: ' + dims.join(', ')
                        : 'Organize consensus session on: ' + dims.join(', ')
                });
            }
            
            // Low score recommendations
            Object.keys(consensus.scores || {}).forEach(function(dim) {
                if (consensus.scores[dim] < 50) {
                    recs.push({
                        priority: 'medium',
                        icon: 'âš ï¸',
                        text: lang === 'fr'
                            ? 'Score faible sur "' + dim + '" (' + consensus.scores[dim] + '/100). Renforcer ce volet du projet.'
                            : 'Low score on "' + dim + '" (' + consensus.scores[dim] + '/100). Strengthen this aspect.'
                    });
                }
            });
            
            // Approval recommendation
            if (highDivergences.length === 0 && consensus.overallScore >= 70) {
                recs.push({
                    priority: 'success',
                    icon: 'âœ…',
                    text: lang === 'fr'
                        ? 'Projet validÃ© par consensus avec score global de ' + consensus.overallScore + '/100'
                        : 'Project validated by consensus with overall score of ' + consensus.overallScore + '/100'
                });
            }
            
            return recs;
        },
        
        // â”€â”€ .vote FILE WORKFLOW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Enables distributed async voting: each expert votes offline
        // .moudar = session config, .vote = individual ballot, .consensus = merged result
        
        // Export session config as .moudar file (sent by project lead to experts)
        exportSessionFile: function(session) {
            var payload = {
                format: 'moudar-consensus-session',
                version: '2.0',
                sessionId: session.id,
                projectId: session.projectId,
                dimensions: session.dimensions,
                experts: session.experts,
                createdAt: session.createdAt,
                exportedAt: new Date().toISOString()
            };
            var json = JSON.stringify(payload, null, 2);
            var blob = new Blob([json], { type: 'application/json' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'session_' + session.id.substring(0, 12) + '.moudar';
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
            URL.revokeObjectURL(url);
            return payload;
        },
        
        // Export individual vote as .vote file (each expert exports their ballot)
        exportVoteFile: function(session, expertId, scores, comments) {
            var expert = (session.experts || []).find(function(e) { return e.id === expertId; }) || {};
            var payload = {
                format: 'moudar-consensus-vote',
                version: '2.0',
                sessionId: session.id,
                expertId: expertId,
                expertName: expert.name || expertId,
                role: expert.role || 'expert',
                dimensions: session.dimensions,
                scores: scores,
                comments: comments || {},
                votedAt: new Date().toISOString(),
                // Integrity hash (SHA-256 of scores for tamper detection)
                integrity: btoa(JSON.stringify(scores)).substring(0, 32)
            };
            var json = JSON.stringify(payload, null, 2);
            var blob = new Blob([json], { type: 'application/json' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = expert.name ? (expert.name.replace(/\s+/g, '_') + '.vote') : ('expert_' + expertId + '.vote');
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
            URL.revokeObjectURL(url);
            return payload;
        },
        
        // Import .vote files and merge into session
        importVoteFiles: function(session, votePayloads) {
            var self = this;
            var imported = 0;
            var errors = [];
            votePayloads.forEach(function(payload) {
                if (payload.format !== 'moudar-consensus-vote') {
                    errors.push('Invalid format: ' + (payload.expertName || 'unknown'));
                    return;
                }
                if (payload.sessionId !== session.id) {
                    errors.push('Session mismatch for ' + (payload.expertName || 'unknown'));
                    return;
                }
                // Verify integrity
                var expectedHash = btoa(JSON.stringify(payload.scores)).substring(0, 32);
                if (payload.integrity && payload.integrity !== expectedHash) {
                    errors.push('Integrity check failed for ' + (payload.expertName || 'unknown'));
                    return;
                }
                self.addVote(session, payload.expertId, payload.role, payload.scores, payload.comments);
                imported++;
            });
            return { imported: imported, errors: errors, total: votePayloads.length };
        },
        
        // Compute Krippendorff's Alpha (inter-rater reliability)
        computeKrippendorffsAlpha: function(session) {
            if (!session.votes || session.votes.length < 2) return { alpha: null, interpretation: 'insufficient_data' };
            var dims = session.dimensions;
            var votes = session.votes;
            var n = votes.length; // number of raters
            var N = dims.length;  // number of units
            
            // Build reliability data matrix: units Ã— observers
            var data = [];
            dims.forEach(function(dim) {
                var row = [];
                votes.forEach(function(vote) {
                    row.push(typeof vote.scores[dim] === 'number' ? vote.scores[dim] : null);
                });
                data.push(row);
            });
            
            // Compute observed disagreement (Do)
            var Do = 0;
            var totalPairs = 0;
            data.forEach(function(row) {
                var values = row.filter(function(v) { return v !== null; });
                var m = values.length;
                if (m < 2) return;
                for (var i = 0; i < m; i++) {
                    for (var j = i + 1; j < m; j++) {
                        Do += Math.pow(values[i] - values[j], 2);
                        totalPairs++;
                    }
                }
            });
            if (totalPairs > 0) Do = Do / totalPairs;
            
            // Compute expected disagreement (De) using all values
            var allValues = [];
            data.forEach(function(row) {
                row.forEach(function(v) { if (v !== null) allValues.push(v); });
            });
            var De = 0;
            var totalGlobalPairs = 0;
            for (var i = 0; i < allValues.length; i++) {
                for (var j = i + 1; j < allValues.length; j++) {
                    De += Math.pow(allValues[i] - allValues[j], 2);
                    totalGlobalPairs++;
                }
            }
            if (totalGlobalPairs > 0) De = De / totalGlobalPairs;
            
            var alpha = De > 0 ? 1 - (Do / De) : 1;
            alpha = Math.round(alpha * 1000) / 1000;
            
            var interpretation;
            if (alpha >= 0.80) interpretation = 'excellent';
            else if (alpha >= 0.667) interpretation = 'acceptable';
            else if (alpha >= 0.40) interpretation = 'moderate';
            else interpretation = 'poor';
            
            return { alpha: alpha, Do: Math.round(Do * 100) / 100, De: Math.round(De * 100) / 100, n: n, N: N, interpretation: interpretation };
        },
        
        // Export full consensus results
        exportConsensusReport: function(session, lang) {
            var report = this.generateReport(session, lang);
            var alpha = this.computeKrippendorffsAlpha(session);
            var payload = {
                format: 'moudar-consensus-result',
                version: '2.0',
                session: { id: session.id, projectId: session.projectId, dimensions: session.dimensions },
                consensus: session.consensus,
                divergences: session.divergences,
                krippendorffAlpha: alpha,
                report: report,
                exportedAt: new Date().toISOString()
            };
            var json = JSON.stringify(payload, null, 2);
            var blob = new Blob([json], { type: 'application/json' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'consensus_' + session.id.substring(0, 12) + '.consensus';
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
            URL.revokeObjectURL(url);
            return payload;
        }
    };
    
    // Expose to window for backward compatibility
    // SECURITY: API credentials are NOT exposed on window object
    // Use MOUDAR.API.isConfigured() and MOUDAR.API.getHeaders() instead
    window.MOUDAR_loadAnalytics = function() { Analytics.load(); };

    console.log('[MOUDAR] v' + Meta.version + ' ' + Meta.edition + ' initialized');
    console.log('[MOUDAR] Modules:', Meta.modules.join(', '));
    console.log('[MOUDAR] v11.0 Scientific Excellence: E2E Encryption ' + (Crypto.isSupported() ? 'âœ“' : 'âœ—'));
    console.log('[MOUDAR] v12.0 Production: Babel removed (10x startup), Mermaid.js IRLM, .vote workflow, WCAG AA');

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // Public API
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    return Object.freeze({
        API: API,
        Analytics: Analytics,
        Meta: Meta,
        A11y: A11y,
        Feedback: Feedback,
        Crypto: Crypto,
        Consensus: Consensus
    });
})();
</script>
<meta charset="UTF-8">

    <meta name="author" content="Younes MOUDAR">
    <meta name="copyright" content="Â© 2025 Younes MOUDAR. Tous droits rÃ©servÃ©s.">
    <meta name="description" content="MOUDAR v11.0 Scientific Excellence - Plateforme de rÃ©fÃ©rence mondiale pour la Science de l'ImplÃ©mentation. CFIR 2.0 exact (Damschroder 2022), CFIR-ERIC automatisÃ© (Waltz 2019), Health Equity, NPT, Proctor Outcomes, FRAME, E2EE, Consensus Validation. Par Younes MOUDAR.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOUDAR v11.0 Scientific Excellence | Implementation Science Co-pilot | moudar.com</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Babel removed: JSX pre-compiled â†’ 10x faster startup -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:false, theme:"default", securityLevel:"loose"});</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js" integrity="sha512-H+rglffZ6aHrYDsHe6rjKGEODhhCAlAn/hUkR7I2OPMEP/CD3RhiWkbBCyP7IENqXPsVKFe7LJexDDz91QCOw==" crossorigin="anonymous"></script>
    <!-- PRODUCTION TODO: Replace cdn.tailwindcss.com with static CSS via 'npx tailwindcss -o styles.css --minify' -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/docx@8.2.3/build/index.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@1.35.7/dist/umd/supabase.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MOUDAR v9.0 - Core Styles
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* Base Gradients */
        .gradient-main { background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #0f172a 100%); }
        .gradient-hero { background: linear-gradient(135deg, #3b82f6 0%, #10b981 50%, #3b82f6 100%); }
        
        /* Card Interactions */
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
        
        /* Animations */
        .fade-in { animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .animate-pulse-subtle { animation: pulseSub 2s ease-in-out infinite; }
        @keyframes pulseSub { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        
        /* Pricing Cards */
        .price-card { transition: all 0.3s ease; }
        .price-card:hover { transform: scale(1.02); }
        .price-popular { box-shadow: 0 0 0 3px #10b981, 0 20px 40px rgba(16, 185, 129, 0.3); }
        
        /* Tooltips */
        .tooltip-container { position: relative; }
        .tooltip-container .tooltip-text { visibility: hidden; opacity: 0; position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; white-space: nowrap; z-index: 50; transition: all 0.2s; margin-bottom: 8px; }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }
        
        /* Status Badges */
        .status-badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 9999px; font-size: 11px; font-weight: 500; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ACCESSIBILITY ENHANCEMENTS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* Screen reader only - visually hidden but accessible */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Focus styles for keyboard navigation */
        :focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        /* Skip to main content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #0f172a;
            color: white;
            padding: 8px 16px;
            z-index: 10000;
            transition: top 0.3s;
        }
        .skip-link:focus {
            top: 0;
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            .card-hover { border: 2px solid currentColor; }
            .gradient-main, .gradient-hero { background: #000; }
        }
        
        /* Reduced motion preference */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESPONSIVE BREAKPOINTS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* Mobile-first responsive typography */
        @media (max-width: 640px) {
            html { font-size: 14px; }
            .moudar-gold-btn { 
                padding: 10px 16px; 
                font-size: 12px;
                bottom: 16px;
                right: 16px;
            }
        }
        
        @media (min-width: 1024px) {
            html { font-size: 16px; }
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MOUDAR v9.0 - Bouton DÃ©mo Gold Standard
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .moudar-gold-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 9999;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #fbbf24;
            border: 2px solid #fbbf24;
            padding: 14px 24px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(251, 191, 36, 0.3), 0 0 40px rgba(251, 191, 36, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            font-family: system-ui, -apple-system, sans-serif;
            animation: goldPulse 2s infinite;
        }
        .moudar-gold-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 30px rgba(251, 191, 36, 0.5), 0 0 60px rgba(251, 191, 36, 0.2);
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #0f172a;
        }
        .moudar-gold-btn svg { width: 22px; height: 22px; }
        .moudar-gold-btn.loading { pointer-events: none; opacity: 0.7; }
        @keyframes goldPulse {
            0%, 100% { box-shadow: 0 4px 20px rgba(251, 191, 36, 0.3), 0 0 40px rgba(251, 191, 36, 0.1); }
            50% { box-shadow: 0 4px 25px rgba(251, 191, 36, 0.5), 0 0 50px rgba(251, 191, 36, 0.2); }
        }
        .moudar-gold-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(8px);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        .moudar-gold-modal-content {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 2px solid #fbbf24;
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 0 80px rgba(251, 191, 36, 0.3);
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-slate-50">
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ACCESSIBILITY ELEMENTS
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <!-- Skip to main content link for keyboard users -->
    <a href="#main-content" class="skip-link">
        Aller au contenu principal / Skip to main content
    </a>
    
    <!-- ARIA live region for dynamic announcements -->
    <div id="moudar-aria-live" 
         aria-live="polite" 
         aria-atomic="true" 
         class="sr-only">
    </div>
    
    <!-- Loading indicator for async operations -->
    <div id="moudar-loading" 
         role="status" 
         aria-label="Chargement en cours"
         class="sr-only">
    </div>
    <div id="moudar-banner" style="position:sticky;top:0;z-index:9999;background:#0f172a;color:#e2e8f0;border-bottom:1px solid rgba(148,163,184,.35);padding:10px 14px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;font-size:13px;line-height:1.35;">
      <div style="display:flex;gap:12px;align-items:flex-start;justify-content:space-between;">
        <div>
          <strong style="display:inline-block;margin-right:8px;">Mode dÃ©monstration</strong>
          <span>Ã‰vitez de saisir des donnÃ©es personnelles/patients. Les fonctions Cloud/IA et les analytics ne sâ€™activent quâ€™avec consentement explicite. Certains indicateurs (benchmarks/leaderboard) peuvent Ãªtre simulÃ©s en dÃ©mo.</span>
        </div>
        <button id="moudar-banner-close" style="background:rgba(226,232,240,.12);border:1px solid rgba(226,232,240,.25);color:#e2e8f0;border-radius:10px;padding:6px 10px;cursor:pointer;">OK</button>
      </div>
    </div>
    <script>
      (function(){
        try{
          var k='MOUDAR_BANNER_DISMISSED';
          if(localStorage.getItem(k)==='1'){
            var b=document.getElementById('moudar-banner'); if(b) b.style.display='none';
            return;
          }
          var btn=document.getElementById('moudar-banner-close');
          if(btn){
            btn.addEventListener('click', function(){
              localStorage.setItem(k,'1');
              var b=document.getElementById('moudar-banner'); if(b) b.style.display='none';
            });
          }
        }catch(e){}
      })();
    </script>
    <div id="root">

<nav aria-label="Menu principal" role="navigation" class="mb-4">
  <ul role="menubar" class="flex space-x-4">
    <li role="menuitem" tabIndex="0" aria-current="page" class="p-2 cursor-pointer bg-gray-200">Accueil</li>
    <li role="menuitem" tabIndex="0" class="p-2 cursor-pointer hover:bg-gray-100">Roadmaps</li>
    <li role="menuitem" tabIndex="0" class="p-2 cursor-pointer hover:bg-gray-100">Exports</li>
    <li role="menuitem" tabIndex="0" class="p-2 cursor-pointer hover:bg-gray-100">Aide</li>
  </ul>
</nav>


<section aria-labelledby="knowledge-graph-title" role="region" class="mb-8 p-4 border rounded-lg">
  <h2 id="knowledge-graph-title" class="text-2xl font-bold mb-4">Graphe de Connaissances</h2>
  <div id="knowledge-graph">
    <!-- Contenu du graphe -->
  </div>
</section>


<button
  onClick="exportToPDF('knowledge-graph')"
  aria-label="Exporter le graphe de connaissances en PDF"
  role="button"
  tabIndex="0"
  class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:ring-2 focus:ring-blue-600"
>
  Exporter en PDF
</button>

</div>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MOUDAR AI ENGINE v8.0 - Moteur d'Appariement Science de la mise en Å“uvre Adaptatif
         Copyright (c) 2025 Younes MOUDAR                - ALGORITHME PROPRIÃ‰TAIRE
         Architecture: KnowledgeGraph + ScoringEngine + MultiObjective + LearningSystem + CountryIntelligence + SuccessPrediction + BudgetEstimator + CaseLibrary + RiskAnalysis + ResearchExports + GanttTimeline + CFIR2Evaluator + REAIMEvaluator + ROICalculator + FundingGenerator + MonitoringDashboard + LogicModelGenerator + MonteCarloSimulator + AdvancedNLPAnalyzer + PowerPointGenerator + MoudarAPI + CommunityHub + DataIntegrations + ExplainableAI + DocumentAnalyzer + LearningFeedback + PedagogySystem + CertificationSystem
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script>
    var MoudarEngine = (function() {
        'use strict';

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GRAPHE DE CONNAISSANCES IMPLEMENTATION SCIENCE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        var KnowledgeGraph = {
            nodes: {
                domains: {
                    D01: { id: 'D01', name: 'mental_health', label: { fr: 'SantÃ© mentale', en: 'Mental Health' }, weight: 1.0 },
                    D02: { id: 'D02', name: 'primary_care', label: { fr: 'Soins primaires', en: 'Primary Care' }, weight: 1.0 },
                    D03: { id: 'D03', name: 'surgery', label: { fr: 'Chirurgie', en: 'Surgery' }, weight: 1.0 },
                    D04: { id: 'D04', name: 'digital_health', label: { fr: 'SantÃ© numÃ©rique', en: 'Digital Health' }, weight: 1.0 },
                    D05: { id: 'D05', name: 'maternal_child', label: { fr: 'SantÃ© maternelle et infantile', en: 'Maternal & Child Health' }, weight: 1.0 },
                    D06: { id: 'D06', name: 'chronic_disease', label: { fr: 'Maladies chroniques', en: 'Chronic Disease' }, weight: 1.0 },
                    D07: { id: 'D07', name: 'infectious_disease', label: { fr: 'Maladies infectieuses', en: 'Infectious Disease' }, weight: 1.0 },
                    D08: { id: 'D08', name: 'geriatrics', label: { fr: 'GÃ©riatrie', en: 'Geriatrics' }, weight: 1.0 },
                    D09: { id: 'D09', name: 'emergency', label: { fr: 'Urgences', en: 'Emergency Care' }, weight: 1.0 },
                    D10: { id: 'D10', name: 'rehabilitation', label: { fr: 'RÃ©adaptation', en: 'Rehabilitation' }, weight: 1.0 },
                    // === NOUVEAUX DOMAINES v8.0 - MULTI-SECTORIEL ===
                    // Ã‰DUCATION & FORMATION
                    D11: { id: 'D11', name: 'education_k12', label: { fr: 'Ã‰ducation (K-12)', en: 'Education (K-12)' }, weight: 1.0, sector: 'education' },
                    D12: { id: 'D12', name: 'higher_education', label: { fr: 'Enseignement supÃ©rieur', en: 'Higher Education' }, weight: 1.0, sector: 'education' },
                    // MANAGEMENT & ORGANISATION
                    D13: { id: 'D13', name: 'management_corporate', label: { fr: 'Management d\'entreprise', en: 'Corporate Management' }, weight: 1.0, sector: 'management' },
                    D14: { id: 'D14', name: 'public_administration', label: { fr: 'Administration publique', en: 'Public Administration' }, weight: 1.0, sector: 'management' },
                    // AGRICULTURE & ENVIRONNEMENT
                    D15: { id: 'D15', name: 'agriculture', label: { fr: 'Agriculture & AgroÃ©cologie', en: 'Agriculture & Agroecology' }, weight: 1.0, sector: 'environment' },
                    D16: { id: 'D16', name: 'environment_climate', label: { fr: 'Environnement & Climat', en: 'Environment & Climate' }, weight: 1.0, sector: 'environment' },
                    // INDUSTRIE & TECHNOLOGIE
                    D17: { id: 'D17', name: 'manufacturing', label: { fr: 'Industrie & Production', en: 'Manufacturing & Production' }, weight: 1.0, sector: 'industry' },
                    D18: { id: 'D18', name: 'digital_transformation', label: { fr: 'Transformation digitale', en: 'Digital Transformation' }, weight: 1.0, sector: 'technology' },
                    // SOCIAL & JUSTICE
                    D19: { id: 'D19', name: 'social_work', label: { fr: 'Action sociale', en: 'Social Work' }, weight: 1.0, sector: 'social' },
                    D20: { id: 'D20', name: 'justice_reentry', label: { fr: 'Justice & RÃ©insertion', en: 'Justice & Reentry' }, weight: 1.0, sector: 'justice' },
                    // RECHERCHE & INNOVATION
                    D21: { id: 'D21', name: 'scientific_research', label: { fr: 'Recherche scientifique', en: 'Scientific Research' }, weight: 1.0, sector: 'research' },
                    // HUMANITAIRE & DÃ‰VELOPPEMENT
                    D22: { id: 'D22', name: 'humanitarian', label: { fr: 'Humanitaire & Urgences', en: 'Humanitarian & Emergencies' }, weight: 1.0, sector: 'humanitarian' },
                    D23: { id: 'D23', name: 'development', label: { fr: 'DÃ©veloppement international', en: 'International Development' }, weight: 1.0, sector: 'development' }
                },
                contexts: {
                    C01: { id: 'C01', name: 'hospital', label: { fr: 'HÃ´pital', en: 'Hospital' }, resourceLevel: 'high' },
                    C02: { id: 'C02', name: 'primary_health_center', label: { fr: 'Centre de santÃ© primaire', en: 'Primary Health Center' }, resourceLevel: 'medium' },
                    C03: { id: 'C03', name: 'community', label: { fr: 'CommunautÃ©', en: 'Community' }, resourceLevel: 'low' },
                    C04: { id: 'C04', name: 'school', label: { fr: 'Ã‰cole', en: 'School' }, resourceLevel: 'medium' },
                    C05: { id: 'C05', name: 'workplace', label: { fr: 'Lieu de travail', en: 'Workplace' }, resourceLevel: 'medium' },
                    C06: { id: 'C06', name: 'nursing_home', label: { fr: 'EHPAD/Maison de retraite', en: 'Nursing Home' }, resourceLevel: 'medium' },
                    C07: { id: 'C07', name: 'prison', label: { fr: 'Milieu carcÃ©ral', en: 'Prison' }, resourceLevel: 'low' },
                    C08: { id: 'C08', name: 'telehealth', label: { fr: 'TÃ©lÃ©santÃ©', en: 'Telehealth' }, resourceLevel: 'variable' },
                    C09: { id: 'C09', name: 'rural', label: { fr: 'Zone rurale', en: 'Rural Area' }, resourceLevel: 'low' },
                    C10: { id: 'C10', name: 'urban', label: { fr: 'Zone urbaine', en: 'Urban Area' }, resourceLevel: 'high' }
                },
                resourceLevels: {
                    R01: { id: 'R01', name: 'HIC', label: { fr: 'Pays Ã  revenu Ã©levÃ©', en: 'High-Income Country' }, factor: 1.0 },
                    R02: { id: 'R02', name: 'UMIC', label: { fr: 'Pays Ã  revenu intermÃ©diaire supÃ©rieur', en: 'Upper-Middle Income' }, factor: 0.85 },
                    R03: { id: 'R03', name: 'LMIC', label: { fr: 'Pays Ã  revenu intermÃ©diaire infÃ©rieur', en: 'Lower-Middle Income' }, factor: 0.7 },
                    R04: { id: 'R04', name: 'LIC', label: { fr: 'Pays Ã  faible revenu', en: 'Low-Income Country' }, factor: 0.5 }
                },
                phases: {
                    P01: { id: 'P01', name: 'exploration', label: { fr: 'Exploration', en: 'Exploration' }, order: 1 },
                    P02: { id: 'P02', name: 'preparation', label: { fr: 'PrÃ©paration', en: 'Preparation' }, order: 2 },
                    P03: { id: 'P03', name: 'implementation', label: { fr: 'ImplÃ©mentation', en: 'Implementation' }, order: 3 },
                    P04: { id: 'P04', name: 'sustainment', label: { fr: 'PÃ©rennisation', en: 'Sustainment' }, order: 4 }
                },
                barriers: {
                    B01: { id: 'B01', name: 'lack_training', label: { fr: 'Manque de formation', en: 'Lack of Training' }, category: 'capacity', severity: 0.8 },
                    B02: { id: 'B02', name: 'staff_resistance', label: { fr: 'RÃ©sistance du personnel', en: 'Staff Resistance' }, category: 'individual', severity: 0.85 },
                    B03: { id: 'B03', name: 'it_infrastructure', label: { fr: 'Infrastructure IT insuffisante', en: 'IT Infrastructure Issues' }, category: 'resources', severity: 0.75 },
                    B04: { id: 'B04', name: 'data_management', label: { fr: 'ProblÃ¨mes de gestion des donnÃ©es', en: 'Data Management Issues' }, category: 'process', severity: 0.7 },
                    B05: { id: 'B05', name: 'stigma', label: { fr: 'Stigmatisation', en: 'Stigma' }, category: 'sociocultural', severity: 0.9 },
                    B06: { id: 'B06', name: 'funding', label: { fr: 'Financement insuffisant', en: 'Insufficient Funding' }, category: 'resources', severity: 0.95 },
                    B07: { id: 'B07', name: 'leadership_support', label: { fr: 'Manque de soutien de la direction', en: 'Lack of Leadership Support' }, category: 'organizational', severity: 0.9 },
                    B08: { id: 'B08', name: 'time_constraints', label: { fr: 'Contraintes de temps', en: 'Time Constraints' }, category: 'capacity', severity: 0.75 },
                    B09: { id: 'B09', name: 'cultural_barriers', label: { fr: 'BarriÃ¨res culturelles', en: 'Cultural Barriers' }, category: 'sociocultural', severity: 0.85 },
                    B10: { id: 'B10', name: 'complexity', label: { fr: 'ComplexitÃ© de l\'intervention', en: 'Intervention Complexity' }, category: 'intervention', severity: 0.7 },
                    B11: { id: 'B11', name: 'communication', label: { fr: 'ProblÃ¨mes de communication', en: 'Communication Issues' }, category: 'process', severity: 0.65 },
                    B12: { id: 'B12', name: 'policy_alignment', label: { fr: 'Non-alignement avec les politiques', en: 'Policy Misalignment' }, category: 'outer_setting', severity: 0.8 },
                    B13: { id: 'B13', name: 'patient_engagement', label: { fr: 'Faible engagement des patients', en: 'Low Patient Engagement' }, category: 'individual', severity: 0.7 },
                    B14: { id: 'B14', name: 'staff_turnover', label: { fr: 'Rotation du personnel', en: 'Staff Turnover' }, category: 'organizational', severity: 0.75 },
                    B15: { id: 'B15', name: 'evidence_gaps', label: { fr: 'Manque de preuves adaptÃ©es', en: 'Evidence Gaps' }, category: 'intervention', severity: 0.65 }
                },
                strategies: {
                    S01: { id: 'S01', name: 'training_education', label: { fr: 'Formation et Ã©ducation', en: 'Training & Education' }, category: 'train_educate', cost: 'medium', complexity: 'low', 
                        kpis: [
                            { id: 'K01a', indicator: { fr: '% personnel formÃ©', en: '% staff trained' }, target: 'â‰¥80%', frequency: { fr: 'Trimestriel', en: 'Quarterly' }, source: { fr: 'Registre formation', en: 'Training registry' } },
                            { id: 'K01b', indicator: { fr: 'Score post-formation', en: 'Post-training score' }, target: 'â‰¥70/100', frequency: { fr: 'Post-formation', en: 'Post-training' }, source: { fr: 'Quiz/Ã©valuation', en: 'Quiz/assessment' } }
                        ]
                    },
                    S02: { id: 'S02', name: 'audit_feedback', label: { fr: 'Audit et feedback', en: 'Audit & Feedback' }, category: 'evaluate_iterate', cost: 'low', complexity: 'medium',
                        kpis: [
                            { id: 'K02a', indicator: { fr: 'Nb audits rÃ©alisÃ©s', en: 'Number of audits' }, target: 'â‰¥4/an', frequency: { fr: 'Trimestriel', en: 'Quarterly' }, source: { fr: 'Rapports audit', en: 'Audit reports' } },
                            { id: 'K02b', indicator: { fr: '% actions correctives mises en Å“uvre', en: '% corrective actions implemented' }, target: 'â‰¥75%', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'Suivi actions', en: 'Action tracking' } }
                        ]
                    },
                    S03: { id: 'S03', name: 'facilitation', label: { fr: 'Facilitation', en: 'Facilitation' }, category: 'support_clinicians', cost: 'medium', complexity: 'medium',
                        kpis: [
                            { id: 'K03a', indicator: { fr: 'Nb sÃ©ances facilitation/mois', en: 'Facilitation sessions/month' }, target: 'â‰¥2/mois', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'Agenda facilitateur', en: 'Facilitator agenda' } },
                            { id: 'K03b', indicator: { fr: 'Satisfaction Ã©quipes', en: 'Team satisfaction' }, target: 'â‰¥4/5', frequency: { fr: 'Trimestriel', en: 'Quarterly' }, source: { fr: 'EnquÃªte', en: 'Survey' } }
                        ]
                    },
                    S04: { id: 'S04', name: 'champions', label: { fr: 'Champions/Leaders d\'opinion', en: 'Champions/Opinion Leaders' }, category: 'develop_stakeholders', cost: 'low', complexity: 'medium',
                        kpis: [
                            { id: 'K04a', indicator: { fr: 'Nb champions actifs', en: 'Active champions' }, target: 'â‰¥1/site', frequency: { fr: 'Semestriel', en: 'Biannual' }, source: { fr: 'Liste champions', en: 'Champion list' } },
                            { id: 'K04b', indicator: { fr: 'Nb actions initiÃ©es par champions', en: 'Actions initiated by champions' }, target: 'â‰¥3/trimestre', frequency: { fr: 'Trimestriel', en: 'Quarterly' }, source: { fr: 'Reporting', en: 'Reporting' } }
                        ]
                    },
                    S05: { id: 'S05', name: 'reminder_systems', label: { fr: 'SystÃ¨mes de rappel', en: 'Reminder Systems' }, category: 'change_infrastructure', cost: 'low', complexity: 'low',
                        kpis: [
                            { id: 'K05a', indicator: { fr: '% rappels dÃ©clenchÃ©s/attendus', en: '% reminders triggered/expected' }, target: 'â‰¥90%', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'Logs systÃ¨me', en: 'System logs' } },
                            { id: 'K05b', indicator: { fr: 'Taux rÃ©ponse aux rappels', en: 'Response rate to reminders' }, target: 'â‰¥60%', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'DonnÃ©es SI', en: 'IS data' } }
                        ]
                    },
                    S06: { id: 'S06', name: 'financial_incentives', label: { fr: 'Incitations financiÃ¨res', en: 'Financial Incentives' }, category: 'finance', cost: 'high', complexity: 'medium',
                        kpis: [
                            { id: 'K06a', indicator: { fr: '% bÃ©nÃ©ficiaires ayant reÃ§u incitation', en: '% beneficiaries receiving incentive' }, target: 'â‰¥95%', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'ComptabilitÃ©', en: 'Accounting' } },
                            { id: 'K06b', indicator: { fr: 'CoÃ»t/bÃ©nÃ©ficiaire', en: 'Cost/beneficiary' }, target: 'Selon budget', frequency: { fr: 'Trimestriel', en: 'Quarterly' }, source: { fr: 'Finance', en: 'Finance' } }
                        ]
                    },
                    S07: { id: 'S07', name: 'policy_change', label: { fr: 'Changement de politique', en: 'Policy Change' }, category: 'change_infrastructure', cost: 'variable', complexity: 'high',
                        kpis: [
                            { id: 'K07a', indicator: { fr: 'Politique adoptÃ©e (oui/non)', en: 'Policy adopted (yes/no)' }, target: 'Oui', frequency: { fr: 'Annuel', en: 'Annual' }, source: { fr: 'Documents officiels', en: 'Official documents' } },
                            { id: 'K07b', indicator: { fr: '% sites appliquant nouvelle politique', en: '% sites applying new policy' }, target: 'â‰¥80%', frequency: { fr: 'Semestriel', en: 'Biannual' }, source: { fr: 'Audit conformitÃ©', en: 'Compliance audit' } }
                        ]
                    },
                    S08: { id: 'S08', name: 'community_engagement', label: { fr: 'Engagement communautaire', en: 'Community Engagement' }, category: 'engage_consumers', cost: 'medium', complexity: 'medium',
                        kpis: [
                            { id: 'K08a', indicator: { fr: 'Nb rÃ©unions communautaires', en: 'Community meetings held' }, target: 'â‰¥1/mois', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'PV rÃ©unions', en: 'Meeting minutes' } },
                            { id: 'K08b', indicator: { fr: 'Nb participants communautaires', en: 'Community participants' }, target: 'â‰¥20/rÃ©union', frequency: { fr: 'Par rÃ©union', en: 'Per meeting' }, source: { fr: 'Feuilles prÃ©sence', en: 'Attendance sheets' } }
                        ]
                    },
                    S09: { id: 'S09', name: 'technical_assistance', label: { fr: 'Assistance technique', en: 'Technical Assistance' }, category: 'support_clinicians', cost: 'medium', complexity: 'low',
                        kpis: [
                            { id: 'K09a', indicator: { fr: 'DÃ©lai moyen rÃ©ponse support', en: 'Avg support response time' }, target: 'â‰¤24h', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'Tickets support', en: 'Support tickets' } },
                            { id: 'K09b', indicator: { fr: '% problÃ¨mes rÃ©solus', en: '% issues resolved' }, target: 'â‰¥90%', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'SystÃ¨me ticketing', en: 'Ticketing system' } }
                        ]
                    },
                    S10: { id: 'S10', name: 'supervision', label: { fr: 'Supervision clinique', en: 'Clinical Supervision' }, category: 'support_clinicians', cost: 'medium', complexity: 'medium',
                        kpis: [
                            { id: 'K10a', indicator: { fr: 'Heures supervision/mois/Ã©quipe', en: 'Supervision hours/month/team' }, target: 'â‰¥8h', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'Feuilles temps', en: 'Timesheets' } },
                            { id: 'K10b', indicator: { fr: '% Ã©quipes supervisÃ©es', en: '% teams supervised' }, target: '100%', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'Planning supervision', en: 'Supervision schedule' } }
                        ]
                    },
                    S11: { id: 'S11', name: 'adaptation', label: { fr: 'Adaptation de l\'intervention', en: 'Intervention Adaptation' }, category: 'adapt_tailor', cost: 'low', complexity: 'medium',
                        kpis: [
                            { id: 'K11a', indicator: { fr: 'Nb adaptations documentÃ©es', en: 'Documented adaptations' }, target: 'Selon contexte', frequency: { fr: 'Trimestriel', en: 'Quarterly' }, source: { fr: 'Journal adaptations', en: 'Adaptation log' } },
                            { id: 'K11b', indicator: { fr: 'FidÃ©litÃ© aux principes clÃ©s', en: 'Fidelity to core principles' }, target: 'â‰¥80%', frequency: { fr: 'Semestriel', en: 'Biannual' }, source: { fr: 'Checklist fidÃ©litÃ©', en: 'Fidelity checklist' } }
                        ]
                    },
                    S12: { id: 'S12', name: 'coalition_building', label: { fr: 'Construction de coalitions', en: 'Coalition Building' }, category: 'develop_stakeholders', cost: 'medium', complexity: 'high',
                        kpis: [
                            { id: 'K12a', indicator: { fr: 'Nb partenaires actifs', en: 'Active partners' }, target: 'â‰¥5', frequency: { fr: 'Semestriel', en: 'Biannual' }, source: { fr: 'Liste partenaires', en: 'Partner list' } },
                            { id: 'K12b', indicator: { fr: 'Nb rÃ©unions coalition/an', en: 'Coalition meetings/year' }, target: 'â‰¥4', frequency: { fr: 'Annuel', en: 'Annual' }, source: { fr: 'PV rÃ©unions', en: 'Meeting minutes' } }
                        ]
                    },
                    S13: { id: 'S13', name: 'data_systems', label: { fr: 'SystÃ¨mes de donnÃ©es', en: 'Data Systems' }, category: 'change_infrastructure', cost: 'high', complexity: 'high',
                        kpis: [
                            { id: 'K13a', indicator: { fr: '% donnÃ©es complÃ¨tes', en: '% complete data' }, target: 'â‰¥90%', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'Audit donnÃ©es', en: 'Data audit' } },
                            { id: 'K13b', indicator: { fr: 'DisponibilitÃ© systÃ¨me', en: 'System uptime' }, target: 'â‰¥99%', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'Monitoring IT', en: 'IT monitoring' } }
                        ]
                    },
                    S14: { id: 'S14', name: 'learning_collaborative', label: { fr: 'Collaborative d\'apprentissage', en: 'Learning Collaborative' }, category: 'train_educate', cost: 'medium', complexity: 'medium',
                        kpis: [
                            { id: 'K14a', indicator: { fr: 'Nb sessions collaborative/an', en: 'Collaborative sessions/year' }, target: 'â‰¥4', frequency: { fr: 'Trimestriel', en: 'Quarterly' }, source: { fr: 'Calendrier', en: 'Calendar' } },
                            { id: 'K14b', indicator: { fr: 'Taux participation', en: 'Participation rate' }, target: 'â‰¥75%', frequency: { fr: 'Par session', en: 'Per session' }, source: { fr: 'Feuilles prÃ©sence', en: 'Attendance' } }
                        ]
                    },
                    S15: { id: 'S15', name: 'peer_support', label: { fr: 'Soutien par les pairs', en: 'Peer Support' }, category: 'support_clinicians', cost: 'low', complexity: 'low',
                        kpis: [
                            { id: 'K15a', indicator: { fr: 'Nb pairs aidants formÃ©s', en: 'Trained peer supporters' }, target: 'â‰¥2/site', frequency: { fr: 'Annuel', en: 'Annual' }, source: { fr: 'Registre formation', en: 'Training registry' } },
                            { id: 'K15b', indicator: { fr: 'Nb interactions pairs/mois', en: 'Peer interactions/month' }, target: 'â‰¥10', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'Journal activitÃ©', en: 'Activity log' } }
                        ]
                    },
                    S16: { id: 'S16', name: 'quality_improvement', label: { fr: 'AmÃ©lioration de la qualitÃ©', en: 'Quality Improvement' }, category: 'evaluate_iterate', cost: 'medium', complexity: 'medium',
                        kpis: [
                            { id: 'K16a', indicator: { fr: 'Nb cycles PDCA complÃ©tÃ©s', en: 'PDCA cycles completed' }, target: 'â‰¥2/an', frequency: { fr: 'Semestriel', en: 'Biannual' }, source: { fr: 'Documentation QI', en: 'QI documentation' } },
                            { id: 'K16b', indicator: { fr: '% indicateurs qualitÃ© amÃ©liorÃ©s', en: '% quality indicators improved' }, target: 'â‰¥50%', frequency: { fr: 'Annuel', en: 'Annual' }, source: { fr: 'Tableau de bord', en: 'Dashboard' } }
                        ]
                    },
                    S17: { id: 'S17', name: 'centralized_support', label: { fr: 'Support technique centralisÃ©', en: 'Centralized Technical Support' }, category: 'change_infrastructure', cost: 'high', complexity: 'medium',
                        kpis: [
                            { id: 'K17a', indicator: { fr: 'Nb sites couverts', en: 'Sites covered' }, target: '100%', frequency: { fr: 'Trimestriel', en: 'Quarterly' }, source: { fr: 'Registre sites', en: 'Site registry' } },
                            { id: 'K17b', indicator: { fr: 'Satisfaction sites', en: 'Site satisfaction' }, target: 'â‰¥4/5', frequency: { fr: 'Semestriel', en: 'Biannual' }, source: { fr: 'EnquÃªte', en: 'Survey' } }
                        ]
                    },
                    S18: { id: 'S18', name: 'patient_education', label: { fr: 'Ã‰ducation des patients', en: 'Patient Education' }, category: 'engage_consumers', cost: 'low', complexity: 'low',
                        kpis: [
                            { id: 'K18a', indicator: { fr: '% patients ayant reÃ§u Ã©ducation', en: '% patients receiving education' }, target: 'â‰¥80%', frequency: { fr: 'Mensuel', en: 'Monthly' }, source: { fr: 'Dossiers patients', en: 'Patient records' } },
                            { id: 'K18b', indicator: { fr: 'Score comprÃ©hension patient', en: 'Patient understanding score' }, target: 'â‰¥70%', frequency: { fr: 'Par session', en: 'Per session' }, source: { fr: 'Quiz patient', en: 'Patient quiz' } }
                        ]
                    },
                    S19: { id: 'S19', name: 'task_shifting', label: { fr: 'Transfert de tÃ¢ches', en: 'Task Shifting' }, category: 'adapt_tailor', cost: 'low', complexity: 'medium',
                        kpis: [
                            { id: 'K19a', indicator: { fr: 'Nb tÃ¢ches transfÃ©rÃ©es', en: 'Tasks shifted' }, target: 'Selon plan', frequency: { fr: 'Trimestriel', en: 'Quarterly' }, source: { fr: 'Matrice tÃ¢ches', en: 'Task matrix' } },
                            { id: 'K19b', indicator: { fr: '% agents non-spÃ©cialistes opÃ©rationnels', en: '% operational non-specialists' }, target: 'â‰¥90%', frequency: { fr: 'Semestriel', en: 'Biannual' }, source: { fr: 'Ã‰valuation compÃ©tences', en: 'Skills assessment' } }
                        ]
                    },
                    S20: { id: 'S20', name: 'stakeholder_engagement', label: { fr: 'Engagement des parties prenantes', en: 'Stakeholder Engagement' }, category: 'develop_stakeholders', cost: 'low', complexity: 'medium',
                        kpis: [
                            { id: 'K20a', indicator: { fr: 'Nb parties prenantes engagÃ©es', en: 'Stakeholders engaged' }, target: 'â‰¥10', frequency: { fr: 'Semestriel', en: 'Biannual' }, source: { fr: 'Cartographie PP', en: 'Stakeholder map' } },
                            { id: 'K20b', indicator: { fr: 'Score engagement moyen', en: 'Avg engagement score' }, target: 'â‰¥3/5', frequency: { fr: 'Annuel', en: 'Annual' }, source: { fr: 'EnquÃªte PP', en: 'Stakeholder survey' } }
                        ]
                    }
                },
                frameworks: {
                    F01: { id: 'F01', name: 'CFIR', label: { fr: 'CFIR - Consolidated Framework', en: 'CFIR - Consolidated Framework' }, type: 'determinant', focus: ['barriers', 'facilitators'] },
                    F02: { id: 'F02', name: 'RE-AIM', label: { fr: 'RE-AIM', en: 'RE-AIM' }, type: 'evaluation', focus: ['reach', 'effectiveness', 'adoption', 'implementation', 'maintenance'] },
                    F03: { id: 'F03', name: 'EPIS', label: { fr: 'EPIS - Exploration Preparation Implementation Sustainment', en: 'EPIS Framework' }, type: 'process', focus: ['phases', 'outer_inner_context'] },
                    F04: { id: 'F04', name: 'Proctor', label: { fr: 'Proctor - Outcomes Framework', en: 'Proctor Outcomes Framework' }, type: 'outcome', focus: ['implementation_outcomes', 'service_outcomes', 'client_outcomes'] },
                    F05: { id: 'F05', name: 'PARIHS', label: { fr: 'PARIHS/i-PARIHS', en: 'PARIHS/i-PARIHS' }, type: 'determinant', focus: ['evidence', 'context', 'facilitation'] },
                    F06: { id: 'F06', name: 'NPT', label: { fr: 'NPT - Normalisation Process Theory', en: 'NPT - Normalisation Process Theory' }, type: 'theory', focus: ['coherence', 'cognitive_participation', 'collective_action', 'reflexive_monitoring'] },
                    F07: { id: 'F07', name: 'TDF', label: { fr: 'TDF - Theoretical Domains Framework', en: 'TDF - Theoretical Domains Framework' }, type: 'determinant', focus: ['behavior_change', 'domains'] },
                    F08: { id: 'F08', name: 'PRISM', label: { fr: 'PRISM - Practical Robust Implementation', en: 'PRISM Framework' }, type: 'hybrid', focus: ['organizational', 'patient', 'sustainability'] }
                },
                outcomes: {
                    O01: { id: 'O01', name: 'acceptability', label: { fr: 'AcceptabilitÃ©', en: 'Acceptability' }, level: 'implementation', measurability: 'high' },
                    O02: { id: 'O02', name: 'adoption', label: { fr: 'Adoption', en: 'Adoption' }, level: 'implementation', measurability: 'high' },
                    O03: { id: 'O03', name: 'appropriateness', label: { fr: 'Pertinence', en: 'Appropriateness' }, level: 'implementation', measurability: 'medium' },
                    O04: { id: 'O04', name: 'feasibility', label: { fr: 'FaisabilitÃ©', en: 'Feasibility' }, level: 'implementation', measurability: 'high' },
                    O05: { id: 'O05', name: 'fidelity', label: { fr: 'FidÃ©litÃ©', en: 'Fidelity' }, level: 'implementation', measurability: 'high' },
                    O06: { id: 'O06', name: 'cost', label: { fr: 'CoÃ»t', en: 'Cost' }, level: 'implementation', measurability: 'high' },
                    O07: { id: 'O07', name: 'penetration', label: { fr: 'PÃ©nÃ©tration/Couverture', en: 'Penetration/Coverage' }, level: 'implementation', measurability: 'high' },
                    O08: { id: 'O08', name: 'sustainability', label: { fr: 'PÃ©rennitÃ©', en: 'Sustainability' }, level: 'implementation', measurability: 'medium' },
                    O09: { id: 'O09', name: 'equity', label: { fr: 'Ã‰quitÃ©', en: 'Equity' }, level: 'service', measurability: 'medium' },
                    O10: { id: 'O10', name: 'effectiveness', label: { fr: 'EfficacitÃ©', en: 'Effectiveness' }, level: 'client', measurability: 'high' }
                }
            },
            edges: {
                barrierToStrategy: {
                    B01: { S01: 0.95, S03: 0.6, S09: 0.7, S14: 0.8, S15: 0.5 },
                    B02: { S04: 0.85, S03: 0.75, S20: 0.7, S08: 0.5, S02: 0.6 },
                    B03: { S13: 0.9, S09: 0.8, S17: 0.85, S05: 0.5 },
                    B04: { S13: 0.85, S02: 0.7, S16: 0.75, S09: 0.6 },
                    B05: { S08: 0.9, S18: 0.8, S04: 0.6, S11: 0.7 },
                    B06: { S06: 0.8, S12: 0.75, S07: 0.7, S19: 0.65 },
                    B07: { S04: 0.9, S12: 0.8, S20: 0.85, S07: 0.6 },
                    B08: { S19: 0.8, S11: 0.7, S05: 0.6, S02: 0.5 },
                    B09: { S11: 0.85, S08: 0.8, S20: 0.7, S18: 0.6 },
                    B10: { S11: 0.8, S03: 0.7, S01: 0.65, S09: 0.6 },
                    B11: { S20: 0.85, S14: 0.7, S04: 0.65, S02: 0.6 },
                    B12: { S07: 0.9, S12: 0.8, S20: 0.75 },
                    B13: { S18: 0.9, S08: 0.85, S11: 0.6 },
                    B14: { S01: 0.7, S10: 0.8, S14: 0.65, S15: 0.7 },
                    B15: { S11: 0.75, S16: 0.7, S02: 0.65, S14: 0.6 }
                },
                contextToStrategy: {
                    C01: { S02: 0.85, S16: 0.8, S10: 0.75, S13: 0.7, S04: 0.7 },
                    C02: { S01: 0.8, S09: 0.75, S19: 0.8, S15: 0.7, S03: 0.65 },
                    C03: { S08: 0.9, S18: 0.85, S19: 0.8, S15: 0.75, S12: 0.7 },
                    C04: { S08: 0.85, S01: 0.8, S18: 0.75, S04: 0.7, S12: 0.65 },
                    C05: { S06: 0.75, S07: 0.7, S20: 0.75, S04: 0.65 },
                    C06: { S01: 0.8, S10: 0.75, S15: 0.8, S09: 0.7 },
                    C07: { S11: 0.85, S19: 0.8, S08: 0.7, S07: 0.65 },
                    C08: { S13: 0.9, S09: 0.85, S05: 0.8, S17: 0.75 },
                    C09: { S19: 0.85, S08: 0.8, S17: 0.75, S15: 0.7 },
                    C10: { S13: 0.8, S16: 0.75, S14: 0.7, S06: 0.65 }
                },
                phaseToStrategy: {
                    P01: { S20: 0.9, S12: 0.85, S02: 0.7, S04: 0.65, S16: 0.6 },
                    P02: { S01: 0.9, S03: 0.85, S11: 0.8, S13: 0.75, S09: 0.7 },
                    P03: { S02: 0.85, S10: 0.8, S05: 0.75, S04: 0.7, S03: 0.7 },
                    P04: { S14: 0.85, S16: 0.8, S02: 0.75, S06: 0.7, S12: 0.65 }
                },
                domainToStrategy: {
                    D01: { S08: 0.85, S11: 0.8, S10: 0.75, S19: 0.7, S15: 0.8 },
                    D02: { S01: 0.8, S05: 0.75, S02: 0.7, S19: 0.8 },
                    D03: { S02: 0.85, S16: 0.8, S01: 0.75, S10: 0.7 },
                    D04: { S13: 0.9, S09: 0.85, S05: 0.8, S17: 0.8 },
                    D05: { S08: 0.85, S18: 0.8, S19: 0.75, S11: 0.7 },
                    D06: { S18: 0.85, S05: 0.8, S02: 0.75, S08: 0.7 },
                    D07: { S08: 0.85, S07: 0.8, S12: 0.75, S19: 0.7 },
                    D08: { S01: 0.8, S15: 0.85, S10: 0.75, S11: 0.7 },
                    D09: { S02: 0.85, S16: 0.8, S01: 0.75, S05: 0.7 },
                    D10: { S03: 0.8, S10: 0.8, S15: 0.75, S01: 0.7 },
                    // === MATRICES MULTI-SECTORIELLES v8.0 ===
                    D11: { S01: 0.90, S11: 0.85, S15: 0.80, S08: 0.75, S03: 0.70, S04: 0.65, S14: 0.60 },
                    D12: { S02: 0.85, S16: 0.85, S13: 0.80, S12: 0.75, S14: 0.70, S04: 0.65, S01: 0.60 },
                    D13: { S04: 0.90, S20: 0.85, S06: 0.80, S07: 0.75, S12: 0.70, S02: 0.65, S03: 0.60 },
                    D14: { S07: 0.90, S12: 0.85, S16: 0.80, S13: 0.75, S20: 0.70, S02: 0.65, S01: 0.60 },
                    D15: { S15: 0.90, S08: 0.85, S11: 0.85, S19: 0.80, S01: 0.70, S14: 0.65, S12: 0.60 },
                    D16: { S07: 0.85, S12: 0.85, S08: 0.80, S18: 0.75, S11: 0.70, S20: 0.65, S06: 0.60 },
                    D17: { S16: 0.90, S02: 0.85, S13: 0.80, S01: 0.75, S10: 0.70, S05: 0.65, S09: 0.60 },
                    D18: { S13: 0.90, S09: 0.85, S01: 0.80, S17: 0.80, S05: 0.70, S03: 0.65, S11: 0.60 },
                    D19: { S08: 0.90, S11: 0.85, S15: 0.80, S18: 0.80, S19: 0.75, S12: 0.65, S03: 0.60 },
                    D20: { S11: 0.90, S07: 0.85, S15: 0.80, S08: 0.75, S19: 0.70, S12: 0.65, S01: 0.60 },
                    D21: { S02: 0.90, S16: 0.85, S13: 0.80, S12: 0.75, S14: 0.70, S09: 0.65, S07: 0.60 },
                    D22: { S19: 0.90, S11: 0.85, S08: 0.80, S05: 0.75, S15: 0.70, S09: 0.65, S01: 0.60 },
                    D23: { S12: 0.90, S08: 0.85, S11: 0.80, S07: 0.75, S19: 0.70, S20: 0.65, S01: 0.60 }
                },
                strategyToOutcome: {
                    S01: { O01: 0.7, O04: 0.8, O05: 0.85, O02: 0.6 },
                    S02: { O05: 0.9, O02: 0.7, O07: 0.6, O08: 0.65 },
                    S03: { O01: 0.8, O02: 0.75, O04: 0.7, O05: 0.65 },
                    S04: { O02: 0.85, O01: 0.8, O08: 0.7, O07: 0.6 },
                    S05: { O05: 0.8, O02: 0.7, O07: 0.65, O06: 0.5 },
                    S06: { O02: 0.85, O08: 0.75, O06: 0.4, O07: 0.6 },
                    S07: { O08: 0.85, O07: 0.8, O09: 0.7, O02: 0.6 },
                    S08: { O01: 0.85, O09: 0.8, O07: 0.75, O02: 0.65 },
                    S09: { O04: 0.85, O05: 0.7, O01: 0.6, O02: 0.55 },
                    S10: { O05: 0.85, O01: 0.7, O08: 0.6, O04: 0.55 },
                    S11: { O03: 0.9, O01: 0.8, O04: 0.75, O09: 0.65 },
                    S12: { O08: 0.85, O02: 0.75, O09: 0.7, O07: 0.65 },
                    S13: { O06: 0.7, O05: 0.8, O07: 0.75, O08: 0.6 },
                    S14: { O08: 0.8, O01: 0.75, O02: 0.7, O05: 0.65 },
                    S15: { O01: 0.85, O08: 0.7, O04: 0.65, O02: 0.6 },
                    S16: { O05: 0.85, O08: 0.8, O06: 0.65, O10: 0.7 },
                    S17: { O04: 0.8, O07: 0.75, O06: 0.5, O05: 0.7 },
                    S18: { O01: 0.9, O09: 0.8, O03: 0.75, O10: 0.6 },
                    S19: { O04: 0.85, O06: 0.8, O07: 0.7, O09: 0.65 },
                    S20: { O01: 0.85, O02: 0.8, O08: 0.75, O09: 0.7 }
                },
                phaseToFramework: {
                    P01: { F01: 0.85, F03: 0.9, F07: 0.7, F05: 0.65 },
                    P02: { F01: 0.8, F03: 0.85, F07: 0.75, F05: 0.8 },
                    P03: { F02: 0.9, F04: 0.85, F06: 0.8, F08: 0.75 },
                    P04: { F02: 0.85, F04: 0.8, F08: 0.9, F06: 0.7 }
                },
                barrierToFramework: {
                    B01: { F07: 0.85, F01: 0.7, F05: 0.65 },
                    B02: { F07: 0.9, F06: 0.8, F01: 0.75 },
                    B03: { F01: 0.8, F08: 0.75, F03: 0.6 },
                    B04: { F01: 0.75, F08: 0.7, F02: 0.65 },
                    B05: { F01: 0.85, F07: 0.8, F03: 0.7 },
                    B06: { F08: 0.85, F01: 0.7, F03: 0.75 },
                    B07: { F01: 0.9, F05: 0.8, F03: 0.75 },
                    B08: { F01: 0.75, F08: 0.7, F06: 0.65 },
                    B09: { F01: 0.85, F07: 0.8, F05: 0.7 },
                    B10: { F01: 0.8, F07: 0.75, F06: 0.7 },
                    B11: { F06: 0.8, F01: 0.7, F07: 0.65 },
                    B12: { F03: 0.85, F01: 0.8, F08: 0.75 },
                    B13: { F07: 0.85, F01: 0.75, F08: 0.7 },
                    B14: { F01: 0.8, F08: 0.75, F03: 0.65 },
                    B15: { F05: 0.85, F01: 0.75, F02: 0.7 }
                },
                resourceToStrategyAdjustment: {
                    R01: { S06: 1.0, S13: 1.0, S17: 1.0, S14: 1.0 },
                    R02: { S06: 0.7, S13: 0.8, S17: 0.8, S14: 0.9, S19: 1.1 },
                    R03: { S06: 0.4, S13: 0.5, S17: 0.6, S19: 1.2, S15: 1.1, S08: 1.1 },
                    R04: { S06: 0.2, S13: 0.3, S17: 0.4, S19: 1.3, S15: 1.2, S08: 1.2, S01: 0.8 }
                }
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ALGORITHMES DE SCORING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        var ScoringEngine = {
            addScoresFromMap: function(scores, weightMap, key, multiplier) {
                multiplier = multiplier || 1.0;
                var weights = weightMap[key] || {};
                for (var target in weights) {
                    if (!Object.prototype.hasOwnProperty.call(weights, target)) continue;
                    if (!scores[target]) scores[target] = 0;
                    scores[target] += weights[target] * multiplier;
                }
            },

            // Score des stratÃ©gies d'implÃ©mentation Ã  partir du projet
            scoreStrategies: function(project) {
                var scores = {};
                var graph = KnowledgeGraph;

                // S'assurer que barriers est un tableau
                var barriers = project.barriers || [];
                if (typeof barriers === 'string') {
                    barriers = barriers.split(/[,;\n]/).map(function(b) { return b.trim(); }).filter(function(b) { return b.length > 0; });
                }
                if (!Array.isArray(barriers)) {
                    barriers = [];
                }
                
                barriers.forEach(function(barrier) {
                    var barrierNode = null;
                    var allBarriers = Object.values(graph.nodes.barriers);
                    for (var i = 0; i < allBarriers.length; i++) {
                        var b = allBarriers[i];
                        if (b.name === barrier || b.id === barrier) {
                            barrierNode = b;
                            break;
                        }
                    }
                    if (barrierNode) {
                        ScoringEngine.addScoresFromMap(
                            scores,
                            graph.edges.barrierToStrategy,
                            barrierNode.id,
                            barrierNode.severity || 1.0
                        );
                    }
                });

                if (project.context) {
                    var contextNode = null;
                    var allContexts = Object.values(graph.nodes.contexts);
                    for (var j = 0; j < allContexts.length; j++) {
                        var c = allContexts[j];
                        if (c.name === project.context || c.id === project.context) {
                            contextNode = c;
                            break;
                        }
                    }
                    if (contextNode) {
                        ScoringEngine.addScoresFromMap(
                            scores,
                            graph.edges.contextToStrategy,
                            contextNode.id,
                            1.0
                        );
                    }
                }

                if (project.phase) {
                    var phaseNode = null;
                    var allPhases = Object.values(graph.nodes.phases);
                    for (var k = 0; k < allPhases.length; k++) {
                        var p = allPhases[k];
                        if (p.name === project.phase || p.id === project.phase) {
                            phaseNode = p;
                            break;
                        }
                    }
                    if (phaseNode) {
                        ScoringEngine.addScoresFromMap(
                            scores,
                            graph.edges.phaseToStrategy,
                            phaseNode.id,
                            1.2
                        );
                    }
                }

                if (project.domain) {
                    var domainNode = null;
                    var allDomains = Object.values(graph.nodes.domains);
                    for (var m = 0; m < allDomains.length; m++) {
                        var d = allDomains[m];
                        if (d.name === project.domain || d.id === project.domain) {
                            domainNode = d;
                            break;
                        }
                    }
                    if (domainNode) {
                        ScoringEngine.addScoresFromMap(
                            scores,
                            graph.edges.domainToStrategy,
                            domainNode.id,
                            0.8
                        );
                    }
                }

                if (project.resourceLevel) {
                    var adjustments = graph.edges.resourceToStrategyAdjustment[project.resourceLevel] || {};
                    for (var stratId in scores) {
                        if (!Object.prototype.hasOwnProperty.call(scores, stratId)) continue;
                        if (adjustments[stratId]) {
                            scores[stratId] *= adjustments[stratId];
                        }
                    }
                }

                return Object.entries(scores)
                    .map(function(entry) {
                        var strategyId = entry[0];
                        var score = entry[1];
                        var strategy = graph.nodes.strategies[strategyId] || {};
                        return {
                            id: strategyId,
                            name: strategy.name || strategyId,
                            label: strategy.label || { fr: strategyId, en: strategyId },
                            category: strategy.category,
                            cost: strategy.cost,
                            complexity: strategy.complexity,
                            score: score,
                            confidence: Math.min(score / 3, 1)
                        };
                    })
                    .sort(function(a, b) { return b.score - a.score; });
            },

            // Score des cadres (CFIR / RE-AIM / EPIS, etc.)
            scoreFrameworks: function(project) {
                var scores = {};
                var graph = KnowledgeGraph;

                if (project.phase) {
                    var phaseNode = null;
                    var allPhases = Object.values(graph.nodes.phases);
                    for (var i = 0; i < allPhases.length; i++) {
                        var p = allPhases[i];
                        if (p.name === project.phase || p.id === project.phase) {
                            phaseNode = p;
                            break;
                        }
                    }
                    if (phaseNode) {
                        ScoringEngine.addScoresFromMap(
                            scores,
                            graph.edges.phaseToFramework,
                            phaseNode.id,
                            1.5
                        );
                    }
                }

                var barriers = project.barriers || [];
                if (typeof barriers === 'string') {
                    barriers = barriers.split(/[,;\n]/).map(function(b) { return b.trim(); }).filter(function(b) { return b.length > 0; });
                }
                if (!Array.isArray(barriers)) {
                    barriers = [];
                }
                barriers.forEach(function(barrier) {
                    var barrierNode = null;
                    var allBarriers = Object.values(graph.nodes.barriers);
                    for (var j = 0; j < allBarriers.length; j++) {
                        var b = allBarriers[j];
                        if (b.name === barrier || b.id === barrier) {
                            barrierNode = b;
                            break;
                        }
                    }
                    if (barrierNode) {
                        ScoringEngine.addScoresFromMap(
                            scores,
                            graph.edges.barrierToFramework,
                            barrierNode.id,
                            1.0
                        );
                    }
                });

                return Object.entries(scores)
                    .map(function(entry) {
                        var frameworkId = entry[0];
                        var score = entry[1];
                        var framework = graph.nodes.frameworks[frameworkId] || {};
                        return {
                            id: frameworkId,
                            name: framework.name || frameworkId,
                            label: framework.label || { fr: frameworkId, en: frameworkId },
                            type: framework.type,
                            focus: framework.focus,
                            score: score,
                            confidence: Math.min(score / 4, 1)
                        };
                    })
                    .sort(function(a, b) { return b.score - a.score; });
            },

            // Score des outcomes (acceptability, adoption, equity, etc.)
            scoreOutcomes: function(strategies, project) {
                var scores = {};
                var graph = KnowledgeGraph;

                (strategies || []).forEach(function(strat) {
                    var stratId = typeof strat === 'string' ? strat : strat.id;
                    var stratNode = graph.nodes.strategies[stratId];

                    if (!stratNode) {
                        var allStrats = Object.values(graph.nodes.strategies);
                        for (var i = 0; i < allStrats.length; i++) {
                            var s = allStrats[i];
                            if (s.name === stratId || s.id === stratId) {
                                stratNode = s;
                                break;
                            }
                        }
                    }

                    if (stratNode) {
                        ScoringEngine.addScoresFromMap(
                            scores,
                            graph.edges.strategyToOutcome,
                            stratNode.id,
                            1.0
                        );
                    }
                });

                return Object.entries(scores)
                    .map(function(entry) {
                        var outcomeId = entry[0];
                        var score = entry[1];
                        var outcome = graph.nodes.outcomes[outcomeId] || {};
                        return {
                            id: outcomeId,
                            name: outcome.name || outcomeId,
                            label: outcome.label || { fr: outcomeId, en: outcomeId },
                            level: outcome.level,
                            score: score,
                            confidence: Math.min(score / 3, 1)
                        };
                    })
                    .sort(function(a, b) { return b.score - a.score; });
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SCORE MULTI-OBJECTIF PARAMÃ‰TRABLE
        // Ajuste les scores selon les prioritÃ©s du projet (Ã©quitÃ©, coÃ»t, pÃ©rennitÃ©...)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        var MultiObjectiveScoring = {
            /**
             * Ajuste les scores selon les objectifs prioritaires du projet
             * @param {Array} strategies - Liste des stratÃ©gies scorÃ©es
             * @param {Array} objectives - ['equity', 'cost_effectiveness', 'sustainability', 'speed', 'evidence_based']
             * @param {string} resourceLevel - HIC/UMIC/LMIC/LIC
             */
            applyObjectives: function(strategies, objectives, resourceLevel) {
                if (!objectives || objectives.length === 0) return strategies;

                var objectiveWeights = {
                    equity: { S08: 1.3, S19: 1.25, S11: 1.2, S18: 1.15, S15: 1.1 },
                    cost_effectiveness: { S19: 1.4, S15: 1.3, S05: 1.2, S01: 0.9, S13: 0.7, S06: 0.6, S17: 0.7 },
                    sustainability: { S12: 1.3, S14: 1.25, S16: 1.2, S07: 1.15, S04: 1.1, S20: 1.1 },
                    speed: { S05: 1.3, S09: 1.2, S01: 1.1, S12: 0.8, S07: 0.7, S15: 1.15 },
                    evidence_based: { S02: 1.3, S16: 1.25, S14: 1.2, S10: 1.15, S03: 1.1 }
                };

                // Ajustement selon ressources
                var resourceMultipliers = {
                    HIC: { cost_effectiveness: 0.8, speed: 1.2, evidence_based: 1.1 },
                    UMIC: { cost_effectiveness: 1.0, speed: 1.0, sustainability: 1.05 },
                    LMIC: { cost_effectiveness: 1.3, sustainability: 1.2, equity: 1.15 },
                    LIC: { cost_effectiveness: 1.5, sustainability: 1.3, speed: 0.8, equity: 1.2 }
                };

                return strategies.map(function(strat) {
                    var adjustedScore = strat.score;
                    
                    objectives.forEach(function(obj) {
                        var weights = objectiveWeights[obj];
                        if (weights && weights[strat.id]) {
                            var multiplier = weights[strat.id];
                            
                            // Ajuster selon ressources
                            var resMult = resourceMultipliers[resourceLevel];
                            if (resMult && resMult[obj]) {
                                multiplier *= resMult[obj];
                            }
                            
                            adjustedScore *= multiplier;
                        }
                    });

                    return Object.assign({}, strat, { 
                        score: adjustedScore,
                        originalScore: strat.score,
                        objectivesApplied: objectives
                    });
                }).sort(function(a, b) { return b.score - a.score; });
            },

            /**
             * Retourne la liste des objectifs disponibles
             */
            getAvailableObjectives: function(lang) {
                lang = lang || 'fr';
                return [
                    { value: 'equity', label: lang === 'fr' ? 'Ã‰quitÃ©' : 'Equity', icon: 'âš–ï¸' },
                    { value: 'cost_effectiveness', label: lang === 'fr' ? 'CoÃ»t-efficacitÃ©' : 'Cost-effectiveness', icon: 'ðŸ’°' },
                    { value: 'sustainability', label: lang === 'fr' ? 'PÃ©rennitÃ©' : 'Sustainability', icon: 'ðŸŒ±' },
                    { value: 'speed', label: lang === 'fr' ? 'RapiditÃ©' : 'Speed', icon: 'âš¡' },
                    { value: 'evidence_based', label: lang === 'fr' ? 'BasÃ© sur preuves' : 'Evidence-based', icon: 'ðŸ“Š' }
                ];
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MOTEUR DE RECOMMANDATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        var RecommendationEngine = {
            generateRecommendations: function(project) {
                // 1. Scoring de base des stratÃ©gies
                var allStrategies = ScoringEngine.scoreStrategies(project);
                
                // 2. Application du scoring multi-objectif si objectives dÃ©finis
                var objectivesApplied = false;
                if (project.objectives && project.objectives.length > 0) {
                    allStrategies = MultiObjectiveScoring.applyObjectives(
                        allStrategies,
                        project.objectives,
                        project.resourceLevel || null
                    );
                    objectivesApplied = true;
                }
                
                // 3. SÃ©lection des top stratÃ©gies
                var topStrategies = allStrategies.slice(0, 7);
                
                // 4. Scoring des frameworks et outcomes
                var allFrameworks = ScoringEngine.scoreFrameworks(project);
                var topFrameworks = allFrameworks.slice(0, 3);
                var strategyIds = topStrategies.map(function(s) { return s.id; });
                var allOutcomes = ScoringEngine.scoreOutcomes(strategyIds, project);
                var topOutcomes = allOutcomes.slice(0, 5);

                // 5. Calcul de la confiance
                var confidence = 0.5;
                if (project.domain) confidence += 0.1;
                if (project.context) confidence += 0.1;
                if (project.phase) confidence += 0.1;
                if (project.barriers && project.barriers.length > 0) confidence += 0.1;
                if (project.resourceLevel) confidence += 0.05;
                if (objectivesApplied) confidence += 0.05; // Bonus si objectifs dÃ©finis
                confidence = Math.min(confidence, 1.0);

                // 6. GÃ©nÃ©rer un ID unique pour cette recommandation
                var recId = 'REC_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

                return {
                    metadata: { 
                        timestamp: new Date().toISOString(), 
                        version: '2.2', 
                        algorithm: 'MoudarEngine-AdaptiveKG-v8.0',
                        recommendationId: recId,
                        learningEnabled: true,
                        objectivesApplied: objectivesApplied,
                        objectives: project.objectives || []
                    },
                    input: project,
                    recommendations: {
                        strategies: { top: topStrategies.slice(0, 5), additional: topStrategies.slice(5), all: allStrategies },
                        frameworks: { primary: topFrameworks[0] || null, secondary: topFrameworks.slice(1), all: allFrameworks },
                        outcomes: { priority: topOutcomes.slice(0, 3), secondary: topOutcomes.slice(3), all: allOutcomes }
                    },
                    confidence: confidence
                };
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SYSTÃˆME D'APPRENTISSAGE ADAPTATIF
        // Ajuste dynamiquement les poids du graphe basÃ© sur les feedbacks utilisateurs
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        var LearningSystem = {
            feedbackStore: [],
            
            /**
             * Enregistre un feedback utilisateur sur une recommandation
             * @param {string} recommendationId - ID de la recommandation
             * @param {Object} feedback - { accepted, modified, rating, outcome, context }
             */
            recordFeedback: function(recommendationId, feedback) {
                var record = {
                    id: recommendationId,
                    timestamp: new Date().toISOString(),
                    accepted: feedback.accepted,
                    modified: feedback.modified || false,
                    userRating: feedback.rating || 3,
                    actualOutcome: feedback.outcome || null,
                    context: feedback.context || null
                };
                
                this.feedbackStore.push(record);
                
                // Persist to localStorage
                if (typeof localStorage !== 'undefined') {
                    try {
                        var existing = JSON.parse(localStorage.getItem('moudar_feedback') || '[]');
                        existing.push(record);
                        // Garder les 1000 derniers feedbacks
                        localStorage.setItem('moudar_feedback', JSON.stringify(existing.slice(-1000)));
                    } catch (e) {
                        console.warn('Could not save feedback to localStorage:', e);
                    }
                }
                
                return record;
            },

            /**
             * Exporte les donnÃ©es de feedback pour analyse externe
             */
            exportFeedbackData: function() {
                if (typeof localStorage !== 'undefined') {
                    try {
                        return JSON.parse(localStorage.getItem('moudar_feedback') || '[]');
                    } catch (e) {
                        return this.feedbackStore;
                    }
                }
                return this.feedbackStore;
            },

            /**
             * Calcule des mÃ©triques globales de performance
             */
            calculatePerformanceMetrics: function() {
                var feedbacks = this.exportFeedbackData();
                if (feedbacks.length === 0) return null;

                var accepted = feedbacks.filter(function(f) { return f.accepted; }).length;
                var avgRating = feedbacks.reduce(function(a, b) { return a + (b.userRating || 0); }, 0) / feedbacks.length;
                var outcomes = { success: 0, partial: 0, failure: 0, unknown: 0 };
                feedbacks.forEach(function(f) {
                    if (f.actualOutcome === 'success') outcomes.success++;
                    else if (f.actualOutcome === 'partial') outcomes.partial++;
                    else if (f.actualOutcome === 'failure') outcomes.failure++;
                    else outcomes.unknown++;
                });
                
                return {
                    totalFeedbacks: feedbacks.length,
                    acceptanceRate: accepted / feedbacks.length,
                    averageRating: avgRating,
                    outcomes: outcomes,
                    lastUpdated: new Date().toISOString()
                };
            },

            /**
             * Calcule la performance par stratÃ©gie Ã  partir des feedbacks
             * @param {number} minSamples - Nb minimum d'utilisations pour ajuster
             */
            computeStrategyPerformance: function(minSamples) {
                minSamples = minSamples || 3;
                var feedbacks = this.exportFeedbackData();
                if (!feedbacks || feedbacks.length === 0) return {};

                var stats = {};

                feedbacks.forEach(function(fb) {
                    // context.selectedStrategies = ['S01','S03',...]
                    if (!fb.context || !Array.isArray(fb.context.selectedStrategies)) return;

                    fb.context.selectedStrategies.forEach(function(sid) {
                        if (!stats[sid]) {
                            stats[sid] = { uses: 0, accepted: 0, totalRating: 0, ratingCount: 0 };
                        }
                        var s = stats[sid];
                        s.uses += 1;
                        if (fb.accepted) s.accepted += 1;
                        if (typeof fb.userRating === 'number' && !isNaN(fb.userRating)) {
                            s.totalRating += fb.userRating;
                            s.ratingCount += 1;
                        }
                    });
                });

                var result = {};
                Object.keys(stats).forEach(function(sid) {
                    var s = stats[sid];
                    if (s.uses < minSamples) return; // Pas assez de donnÃ©es
                    
                    var acceptanceRate = s.accepted / s.uses;
                    var avgRating = s.ratingCount > 0 ? (s.totalRating / s.ratingCount) : 3.0;
                    // Normalisation rating 1â€“5 -> 0â€“1
                    var ratingScore = Math.min(Math.max((avgRating - 1) / 4, 0), 1);
                    // Score global de performance (0â€“1), centrÃ© autour de 0.5
                    var performance = 0.5 * acceptanceRate + 0.5 * ratingScore;

                    result[sid] = {
                        uses: s.uses,
                        acceptanceRate: acceptanceRate,
                        avgRating: avgRating,
                        performance: performance
                    };
                });

                return result;
            },

            /**
             * Ajuste les poids du graphe basÃ© sur la performance des stratÃ©gies
             * @param {Object} graph - Graphe Ã  modifier (optionnel, dÃ©faut: KnowledgeGraph)
             * @param {Object} options - { learningRate, minSamples, minWeight, maxWeight }
             */
            applyWeightAdjustments: function(graph, options) {
                // Si un seul argument passÃ© et c'est un objet sans 'nodes', c'est options
                if (arguments.length === 1 && graph && !graph.nodes) {
                    options = graph;
                    graph = null;
                }
                
                var cfg = Object.assign({
                    learningRate: 0.1,   // intensitÃ© de l'ajustement
                    minSamples: 3,       // nb min de feedbacks par stratÃ©gie
                    minWeight: 0.05,     // poids minimal
                    maxWeight: 1.0       // poids maximal
                }, options || {});

                var performanceMap = this.computeStrategyPerformance(cfg.minSamples);
                var strategyIds = Object.keys(performanceMap);
                if (strategyIds.length === 0) {
                    return { adjusted: false, reason: 'Pas assez de donnÃ©es de feedback', strategiesUpdated: 0 };
                }

                // Utiliser le graphe passÃ© en paramÃ¨tre ou KnowledgeGraph par dÃ©faut
                var kg = graph || KnowledgeGraph;
                var edges = kg.edges;

                // Matrices oÃ¹ apparaissent les stratÃ©gies
                var strategyEdgeMaps = [
                    edges.barrierToStrategy || {},
                    edges.contextToStrategy || {},
                    edges.phaseToStrategy || {},
                    edges.domainToStrategy || {}
                ];

                var adjustmentsCount = 0;

                strategyIds.forEach(function(sid) {
                    var perf = performanceMap[sid].performance; // 0â€“1
                    // DÃ©viation par rapport Ã  0.5
                    var delta = perf - 0.5; // -0.5 Ã  +0.5
                    // Facteur multiplicatif
                    var factor = 1 + cfg.learningRate * delta * 2;

                    strategyEdgeMaps.forEach(function(map) {
                        Object.keys(map).forEach(function(sourceId) {
                            var row = map[sourceId];
                            if (!row || typeof row[sid] !== 'number') return;

                            var newWeight = row[sid] * factor;
                            if (cfg.minWeight != null) newWeight = Math.max(cfg.minWeight, newWeight);
                            if (cfg.maxWeight != null) newWeight = Math.min(cfg.maxWeight, newWeight);

                            // Arrondir pour garder des nombres propres
                            row[sid] = parseFloat(newWeight.toFixed(3));
                            adjustmentsCount++;
                        });
                    });
                });

                // Sauvegarder l'Ã©tat d'apprentissage
                if (typeof localStorage !== 'undefined') {
                    try {
                        localStorage.setItem('moudar_learning_state', JSON.stringify({
                            lastCalibration: new Date().toISOString(),
                            strategiesUpdated: strategyIds.length,
                            totalAdjustments: adjustmentsCount,
                            performanceSnapshot: performanceMap
                        }));
                    } catch (e) {
                        console.warn('Could not save learning state:', e);
                    }
                }

                return {
                    adjusted: true,
                    strategiesUpdated: strategyIds.length,
                    totalAdjustments: adjustmentsCount,
                    performance: performanceMap,
                    appliedAt: new Date().toISOString()
                };
            },

            /**
             * RÃ©cupÃ¨re l'Ã©tat d'apprentissage sauvegardÃ©
             */
            getLearningState: function() {
                if (typeof localStorage !== 'undefined') {
                    try {
                        return JSON.parse(localStorage.getItem('moudar_learning_state') || 'null');
                    } catch (e) {
                        return null;
                    }
                }
                return null;
            },

            /**
             * RÃ©initialise tous les feedbacks et l'apprentissage
             */
            resetLearning: function() {
                this.feedbackStore = [];
                if (typeof localStorage !== 'undefined') {
                    localStorage.removeItem('moudar_feedback');
                    localStorage.removeItem('moudar_learning_state');
                }
                return { reset: true, timestamp: new Date().toISOString() };
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PROTOCOL ANALYZER - NLP Light pour analyse de protocoles existants
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var ProtocolAnalyzer = {
            // Dictionnaire de mots-clÃ©s par stratÃ©gie (FR + EN)
            strategyKeywords: {
                S01: { // Formation et Ã©ducation
                    fr: ["formation", "former", "formÃ©s", "enseigner", "enseignement", "cours", "module", "atelier", "workshop", "e-learning", "curriculum", "compÃ©tences", "apprentissage", "didactique", "pÃ©dagogique", "certifi"],
                    en: ["training", "train", "trained", "education", "teach", "course", "module", "workshop", "e-learning", "curriculum", "skills", "learning", "didactic", "pedagog", "certif"]
                },
                S02: { // Audit et feedback
                    fr: ["audit", "feedback", "retour", "Ã©valuation", "indicateur", "tableau de bord", "dashboard", "monitoring", "suivi", "contrÃ´le qualitÃ©", "performance", "mesure", "rapport"],
                    en: ["audit", "feedback", "evaluation", "indicator", "dashboard", "monitoring", "follow-up", "quality control", "performance", "measure", "report"]
                },
                S03: { // Facilitation
                    fr: ["facilitateur", "facilitation", "accompagn", "coach", "mentor", "soutien", "appui", "guide", "animateur"],
                    en: ["facilitator", "facilitation", "support", "coach", "mentor", "guide", "animator"]
                },
                S04: { // Champions/Leaders d'opinion
                    fr: ["champion", "leader", "rÃ©fÃ©rent", "ambassadeur", "opinion", "influent", "modÃ¨le", "pionnier", "porteur"],
                    en: ["champion", "leader", "referent", "ambassador", "opinion", "influential", "model", "pioneer", "advocate"]
                },
                S05: { // SystÃ¨mes de rappel
                    fr: ["rappel", "reminder", "alerte", "notification", "sms", "aide-mÃ©moire", "checklist", "check-list", "protocole", "algorithme", "arbre dÃ©cision"],
                    en: ["reminder", "alert", "notification", "sms", "checklist", "check-list", "protocol", "algorithm", "decision tree"]
                },
                S06: { // Incitations financiÃ¨res
                    fr: ["incitation", "prime", "bonus", "rÃ©munÃ©ration", "financement", "subvention", "gratuit", "compensat", "indemni"],
                    en: ["incentive", "bonus", "remuneration", "funding", "subsidy", "free", "compensat", "payment"]
                },
                S07: { // Changement de politique
                    fr: ["politique", "rÃ©glementation", "loi", "dÃ©cret", "circulaire", "directive", "gouvernance", "institutionnel", "lÃ©gislat"],
                    en: ["policy", "regulation", "law", "decree", "directive", "governance", "institutional", "legislat"]
                },
                S08: { // Engagement communautaire
                    fr: ["communaut", "village", "famille", "sensibilisation", "mobilisation", "participation", "ong", "association", "sociÃ©tÃ© civile", "bÃ©nÃ©vole"],
                    en: ["communit", "village", "family", "awareness", "mobilization", "participation", "ngo", "association", "civil society", "volunteer"]
                },
                S09: { // Assistance technique
                    fr: ["assistance technique", "support technique", "hotline", "helpdesk", "dÃ©pannage", "maintenance", "expert", "consultant"],
                    en: ["technical assistance", "technical support", "hotline", "helpdesk", "troubleshoot", "maintenance", "expert", "consultant"]
                },
                S10: { // Supervision clinique
                    fr: ["supervision", "superviseur", "encadrement", "tutorat", "mentorat", "accompagnement clinique", "staff meeting", "rÃ©union d'Ã©quipe"],
                    en: ["supervision", "supervisor", "oversight", "tutoring", "mentoring", "clinical support", "staff meeting", "team meeting"]
                },
                S11: { // Adaptation de l'intervention
                    fr: ["adaptation", "adapter", "contextualisation", "culturel", "local", "terrain", "pilote", "prototype", "itÃ©ration"],
                    en: ["adaptation", "adapt", "contextualization", "cultural", "local", "field", "pilot", "prototype", "iteration"]
                },
                S12: { // Construction de coalitions
                    fr: ["coalition", "partenariat", "consortium", "rÃ©seau", "alliance", "collaboration", "multi-acteur", "intersector"],
                    en: ["coalition", "partnership", "consortium", "network", "alliance", "collaboration", "multi-stakeholder", "intersector"]
                },
                S13: { // SystÃ¨mes de donnÃ©es
                    fr: ["donnÃ©es", "data", "base de donnÃ©es", "systÃ¨me d'information", "registre", "dossier patient", "Ã©lectronique", "numÃ©rique", "digital", "informatique", "logiciel"],
                    en: ["data", "database", "information system", "registry", "patient record", "electronic", "digital", "software", "it system"]
                },
                S14: { // Collaborative d'apprentissage
                    fr: ["collaborative", "communautÃ© de pratique", "groupe d'apprentissage", "Ã©change", "partage d'expÃ©rience", "peer learning", "benchmarking"],
                    en: ["collaborative", "community of practice", "learning group", "exchange", "experience sharing", "peer learning", "benchmarking"]
                },
                S15: { // Soutien par les pairs
                    fr: ["pair", "peer", "patient expert", "aidant", "groupe de soutien", "entraide", "vÃ©cu", "expÃ©rience patient"],
                    en: ["peer", "patient expert", "caregiver", "support group", "mutual aid", "lived experience", "patient experience"]
                },
                S16: { // AmÃ©lioration de la qualitÃ©
                    fr: ["qualitÃ©", "amÃ©lioration continue", "pdca", "lean", "kaizen", "accrÃ©ditation", "certification", "norme", "standard", "protocole"],
                    en: ["quality", "continuous improvement", "pdca", "lean", "kaizen", "accreditation", "certification", "standard", "protocol"]
                },
                S17: { // Support technique centralisÃ©
                    fr: ["centralisÃ©", "plateforme", "hub", "centre de ressources", "coordination", "national", "rÃ©gional"],
                    en: ["centralized", "platform", "hub", "resource center", "coordination", "national", "regional"]
                },
                S18: { // Ã‰ducation des patients
                    fr: ["Ã©ducation patient", "Ã©ducation thÃ©rapeutique", "information patient", "brochure", "livret", "vidÃ©o Ã©ducative", "psychoÃ©ducation", "littÃ©ratie"],
                    en: ["patient education", "therapeutic education", "patient information", "brochure", "booklet", "educational video", "psychoeducation", "literacy"]
                },
                S19: { // Transfert de tÃ¢ches
                    fr: ["transfert de tÃ¢ches", "task shifting", "dÃ©lÃ©gation", "infirmier", "agent de santÃ©", "community health worker", "non-spÃ©cialiste", "gÃ©nÃ©raliste"],
                    en: ["task shifting", "task sharing", "delegation", "nurse", "health worker", "community health worker", "non-specialist", "generalist"]
                },
                S20: { // Engagement des parties prenantes
                    fr: ["partie prenante", "stakeholder", "implica", "concertation", "consultation", "co-construction", "gouvernance partagÃ©e", "comitÃ©"],
                    en: ["stakeholder", "involvement", "consultation", "co-construction", "shared governance", "committee", "engagement"]
                }
            },
            
            // CatÃ©gories de complÃ©tude pour le radar
            completenessCategories: {
                training: { 
                    fr: "Formation", en: "Training",
                    strategies: ["S01", "S14", "S03"]
                },
                support: { 
                    fr: "Soutien", en: "Support",
                    strategies: ["S09", "S10", "S15", "S17"]
                },
                evaluation: { 
                    fr: "Ã‰valuation", en: "Evaluation",
                    strategies: ["S02", "S13", "S16"]
                },
                stakeholders: { 
                    fr: "Acteurs", en: "Stakeholders",
                    strategies: ["S04", "S08", "S12", "S20"]
                },
                adaptation: { 
                    fr: "Adaptation", en: "Adaptation",
                    strategies: ["S05", "S11", "S19"]
                },
                sustainability: { 
                    fr: "PÃ©rennitÃ©", en: "Sustainability",
                    strategies: ["S06", "S07", "S18"]
                }
            },
            
            /**
             * Analyse un texte de protocole et dÃ©tecte les stratÃ©gies prÃ©sentes
             * @param {string} text - Texte du protocole
             * @param {string} lang - Langue de dÃ©tection (fr/en)
             * @returns {Object} RÃ©sultats d'analyse
             */
            analyze: function(text, lang) {
                lang = lang || 'fr';
                var normalizedText = text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                
                var detected = {};
                var matches = {};
                var strategies = KnowledgeGraph.nodes.strategies;
                
                // Pour chaque stratÃ©gie, chercher les mots-clÃ©s
                Object.keys(this.strategyKeywords).forEach(function(sid) {
                    var keywords = ProtocolAnalyzer.strategyKeywords[sid][lang] || ProtocolAnalyzer.strategyKeywords[sid].fr;
                    var foundKeywords = [];
                    
                    keywords.forEach(function(kw) {
                        var normalizedKw = kw.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                        if (normalizedText.includes(normalizedKw)) {
                            foundKeywords.push(kw);
                        }
                    });
                    
                    if (foundKeywords.length > 0) {
                        detected[sid] = {
                            strategy: strategies[sid],
                            keywords: foundKeywords,
                            confidence: Math.min(1, foundKeywords.length * 0.3) // Plus de mots-clÃ©s = plus de confiance
                        };
                        matches[sid] = foundKeywords;
                    }
                });
                
                // Calculer les scores par catÃ©gorie
                var categoryScores = {};
                Object.keys(this.completenessCategories).forEach(function(catId) {
                    var cat = ProtocolAnalyzer.completenessCategories[catId];
                    var catStrategies = cat.strategies;
                    var detectedInCat = catStrategies.filter(function(sid) { return detected[sid]; });
                    categoryScores[catId] = {
                        label: cat[lang],
                        detected: detectedInCat.length,
                        total: catStrategies.length,
                        score: Math.round((detectedInCat.length / catStrategies.length) * 100),
                        strategies: catStrategies.map(function(sid) {
                            return {
                                id: sid,
                                label: strategies[sid].label[lang],
                                detected: !!detected[sid],
                                keywords: detected[sid] ? detected[sid].keywords : []
                            };
                        })
                    };
                });
                
                // Score global de complÃ©tude
                var totalDetected = Object.keys(detected).length;
                var totalStrategies = Object.keys(this.strategyKeywords).length;
                var globalScore = Math.round((totalDetected / totalStrategies) * 100);
                
                // Identifier les stratÃ©gies manquantes prioritaires
                var missing = [];
                Object.keys(this.strategyKeywords).forEach(function(sid) {
                    if (!detected[sid]) {
                        missing.push({
                            id: sid,
                            strategy: strategies[sid],
                            label: strategies[sid].label[lang],
                            priority: ProtocolAnalyzer.getMissingPriority(sid, detected)
                        });
                    }
                });
                
                // Trier par prioritÃ©
                missing.sort(function(a, b) { return b.priority - a.priority; });
                
                return {
                    detected: detected,
                    matches: matches,
                    categoryScores: categoryScores,
                    globalScore: globalScore,
                    totalDetected: totalDetected,
                    totalStrategies: totalStrategies,
                    missing: missing.slice(0, 5), // Top 5 manquants prioritaires
                    allMissing: missing,
                    analyzedAt: new Date().toISOString(),
                    textLength: text.length,
                    lang: lang
                };
            },
            
            /**
             * Calcule la prioritÃ© d'une stratÃ©gie manquante
             */
            getMissingPriority: function(sid, detected) {
                // StratÃ©gies fondamentales toujours prioritaires
                var fundamentalStrategies = ["S02", "S04", "S10", "S16"]; // Audit, Champions, Supervision, QualitÃ©
                if (fundamentalStrategies.indexOf(sid) >= 0) return 0.9;
                
                // Si beaucoup de training mais pas de supervision â†’ prioritÃ© haute
                if (sid === "S10" && (detected["S01"] || detected["S14"])) return 0.95;
                
                // Si donnÃ©es mais pas d'audit â†’ prioritÃ© haute
                if (sid === "S02" && detected["S13"]) return 0.9;
                
                // PÃ©rennitÃ© toujours importante
                if (["S07", "S12", "S20"].indexOf(sid) >= 0) return 0.7;
                
                return 0.5;
            },
            
            /**
             * GÃ©nÃ¨re des recommandations basÃ©es sur l'analyse
             */
            getRecommendations: function(analysis, lang) {
                lang = lang || 'fr';
                var recommendations = [];
                var categoryScores = analysis.categoryScores;
                
                // Identifier les catÃ©gories les plus faibles
                var weakCategories = Object.keys(categoryScores)
                    .filter(function(catId) { return categoryScores[catId].score < 50; })
                    .sort(function(a, b) { return categoryScores[a].score - categoryScores[b].score; });
                
                weakCategories.forEach(function(catId) {
                    var cat = categoryScores[catId];
                    var missingInCat = cat.strategies.filter(function(s) { return !s.detected; });
                    
                    if (missingInCat.length > 0) {
                        recommendations.push({
                            category: catId,
                            categoryLabel: cat.label,
                            score: cat.score,
                            message: lang === 'fr' 
                                ? "Votre protocole manque de stratÃ©gies de " + cat.label.toLowerCase()
                                : "Your protocol lacks " + cat.label.toLowerCase() + " strategies",
                            suggestions: missingInCat.slice(0, 2).map(function(s) {
                                return {
                                    id: s.id,
                                    label: s.label,
                                    rationale: ProtocolAnalyzer.getStrategyRationale(s.id, lang)
                                };
                            })
                        });
                    }
                });
                
                return recommendations;
            },
            
            /**
             * Retourne une justification pour l'ajout d'une stratÃ©gie
             */
            getStrategyRationale: function(sid, lang) {
                var rationales = {
                    S01: { fr: "Renforce les compÃ©tences des professionnels", en: "Strengthens professional skills" },
                    S02: { fr: "Permet de mesurer les progrÃ¨s et d'ajuster", en: "Enables progress measurement and adjustment" },
                    S03: { fr: "Accompagne le changement sur le terrain", en: "Supports field-level change" },
                    S04: { fr: "CrÃ©e des modÃ¨les locaux et motive les Ã©quipes", en: "Creates local role models and motivates teams" },
                    S05: { fr: "RÃ©duit les oublis et standardise les pratiques", en: "Reduces oversights and standardizes practices" },
                    S06: { fr: "Motive l'adoption par des incitations", en: "Motivates adoption through incentives" },
                    S07: { fr: "Ancre le changement dans les politiques", en: "Anchors change in policies" },
                    S08: { fr: "Implique la communautÃ© et rÃ©duit la stigmatisation", en: "Involves community and reduces stigma" },
                    S09: { fr: "RÃ©sout les problÃ¨mes techniques rapidement", en: "Resolves technical issues quickly" },
                    S10: { fr: "Assure la qualitÃ© et le soutien aux Ã©quipes", en: "Ensures quality and team support" },
                    S11: { fr: "Adapte l'intervention au contexte local", en: "Adapts intervention to local context" },
                    S12: { fr: "CrÃ©e des alliances durables", en: "Creates lasting alliances" },
                    S13: { fr: "Permet le suivi et la prise de dÃ©cision basÃ©e sur les donnÃ©es", en: "Enables monitoring and data-driven decisions" },
                    S14: { fr: "Favorise l'apprentissage collectif", en: "Promotes collective learning" },
                    S15: { fr: "Apporte le soutien de personnes avec vÃ©cu similaire", en: "Provides support from people with similar experiences" },
                    S16: { fr: "Institutionnalise l'amÃ©lioration continue", en: "Institutionalizes continuous improvement" },
                    S17: { fr: "Coordonne et harmonise Ã  grande Ã©chelle", en: "Coordinates and harmonizes at scale" },
                    S18: { fr: "AmÃ©liore l'adhÃ©sion des patients", en: "Improves patient adherence" },
                    S19: { fr: "Optimise les ressources humaines disponibles", en: "Optimizes available human resources" },
                    S20: { fr: "Assure l'appropriation par toutes les parties", en: "Ensures ownership by all parties" }
                };
                return rationales[sid] ? rationales[sid][lang] : "";
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COUNTRY INTELLIGENCE - Base de donnÃ©es des contextes pays
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var CountryIntelligence = {
            // Base de donnÃ©es des pays avec indicateurs clÃ©s
            countries: {
                // AFRIQUE
                MA: { 
                    code: 'MA', name: { fr: 'Maroc', en: 'Morocco' }, region: 'MENA', income: 'LMIC',
                    indicators: { gdpPerCapita: 3500, psychiatristsPer100k: 0.5, healthExpenditure: 5.2, literacyRate: 73, urbanization: 63, amoCouverage: 62 },
                    languages: ['ar', 'fr', 'ber'], healthSystem: 'mixed',
                    adaptations: { S19: 1.4, S08: 1.3, S15: 1.2, S06: 0.4, S13: 0.6 },
                    barriers: ['B05', 'B09', 'B06', 'B01'], // Stigma, Cultural, Funding, Training
                    recommendations: { fr: ["Prioriser le task-shifting (agents de santÃ© communautaires)", "Impliquer les leaders religieux pour rÃ©duire la stigmatisation", "Formation en arabe/darija recommandÃ©e", "Partenariats avec ONG locales (AMSME, AMALI)"], en: ["Prioritize task-shifting (community health workers)", "Involve religious leaders to reduce stigma", "Training in Arabic/Darija recommended", "Partnerships with local NGOs (AMSME, AMALI)"] }
                },
                TN: { 
                    code: 'TN', name: { fr: 'Tunisie', en: 'Tunisia' }, region: 'MENA', income: 'LMIC',
                    indicators: { gdpPerCapita: 3800, psychiatristsPer100k: 1.2, healthExpenditure: 7.0, literacyRate: 79, urbanization: 69, amoCouverage: 75 },
                    languages: ['ar', 'fr'], healthSystem: 'mixed',
                    adaptations: { S19: 1.3, S08: 1.2, S01: 1.1, S06: 0.5 },
                    barriers: ['B05', 'B06', 'B02'],
                    recommendations: { fr: ["SystÃ¨me de santÃ© relativement structurÃ©", "Bonne couverture AMO exploitable", "Accent sur la formation continue"], en: ["Relatively structured health system", "Good AMO coverage to leverage", "Focus on continuing education"] }
                },
                SN: { 
                    code: 'SN', name: { fr: 'SÃ©nÃ©gal', en: 'Senegal' }, region: 'SSA', income: 'LIC',
                    indicators: { gdpPerCapita: 1600, psychiatristsPer100k: 0.1, healthExpenditure: 4.1, literacyRate: 52, urbanization: 48, amoCouverage: 20 },
                    languages: ['fr', 'wo'], healthSystem: 'public_dominant',
                    adaptations: { S19: 1.5, S08: 1.4, S15: 1.3, S06: 0.2, S13: 0.4, S17: 0.5 },
                    barriers: ['B06', 'B01', 'B03', 'B05'],
                    recommendations: { fr: ["Task-shifting essentiel (pÃ©nurie critique de psychiatres)", "Approche communautaire via les ASC", "Financement ONG/bailleurs international", "Adapter aux langues locales (wolof)"], en: ["Task-shifting essential (critical psychiatrist shortage)", "Community approach via CHWs", "NGO/international donor funding", "Adapt to local languages (Wolof)"] }
                },
                CI: { 
                    code: 'CI', name: { fr: "CÃ´te d'Ivoire", en: 'Ivory Coast' }, region: 'SSA', income: 'LMIC',
                    indicators: { gdpPerCapita: 2600, psychiatristsPer100k: 0.3, healthExpenditure: 4.5, literacyRate: 47, urbanization: 52, amoCouverage: 30 },
                    languages: ['fr'], healthSystem: 'mixed',
                    adaptations: { S19: 1.4, S08: 1.3, S15: 1.2, S06: 0.3 },
                    barriers: ['B06', 'B01', 'B05', 'B09'],
                    recommendations: { fr: ["Approche communautaire recommandÃ©e", "Implication des tradi-praticiens Ã  considÃ©rer", "Formation des infirmiers prioritaire"], en: ["Community approach recommended", "Consider involving traditional practitioners", "Nurse training priority"] }
                },
                KE: { 
                    code: 'KE', name: { fr: 'Kenya', en: 'Kenya' }, region: 'SSA', income: 'LMIC',
                    indicators: { gdpPerCapita: 2100, psychiatristsPer100k: 0.2, healthExpenditure: 4.8, literacyRate: 82, urbanization: 28, amoCouverage: 25 },
                    languages: ['en', 'sw'], healthSystem: 'mixed',
                    adaptations: { S19: 1.4, S08: 1.3, S17: 0.8, S13: 0.7 },
                    barriers: ['B06', 'B01', 'B09', 'B03'],
                    recommendations: { fr: ["M-health prometteuse (forte pÃ©nÃ©tration mobile)", "ModÃ¨le mhGAP bien implantÃ©", "Focus zones rurales"], en: ["M-health promising (high mobile penetration)", "mhGAP model well established", "Focus on rural areas"] }
                },
                EG: { 
                    code: 'EG', name: { fr: 'Ã‰gypte', en: 'Egypt' }, region: 'MENA', income: 'LMIC',
                    indicators: { gdpPerCapita: 4000, psychiatristsPer100k: 0.9, healthExpenditure: 4.6, literacyRate: 71, urbanization: 43, amoCouverage: 58 },
                    languages: ['ar'], healthSystem: 'mixed',
                    adaptations: { S19: 1.2, S08: 1.2, S07: 1.1, S01: 1.1 },
                    barriers: ['B05', 'B09', 'B06', 'B07'],
                    recommendations: { fr: ["SystÃ¨me de santÃ© en expansion", "Stigmatisation importante - engagement communautaire clÃ©", "Formation en arabe exclusivement"], en: ["Expanding health system", "Significant stigma - community engagement key", "Training in Arabic only"] }
                },
                // EUROPE / HIC
                CH: { 
                    code: 'CH', name: { fr: 'Suisse', en: 'Switzerland' }, region: 'Europe', income: 'HIC',
                    indicators: { gdpPerCapita: 92000, psychiatristsPer100k: 53, healthExpenditure: 11.3, literacyRate: 99, urbanization: 74, amoCouverage: 100 },
                    languages: ['fr', 'de', 'it'], healthSystem: 'private_dominant',
                    adaptations: { S16: 1.2, S13: 1.2, S02: 1.1, S06: 1.0 },
                    barriers: ['B02', 'B08', 'B10'],
                    recommendations: { fr: ["Accent sur la qualitÃ© et les standards", "SystÃ¨mes de donnÃ©es sophistiquÃ©s possibles", "Incitations financiÃ¨res viables"], en: ["Focus on quality and standards", "Sophisticated data systems feasible", "Financial incentives viable"] }
                },
                FR: { 
                    code: 'FR', name: { fr: 'France', en: 'France' }, region: 'Europe', income: 'HIC',
                    indicators: { gdpPerCapita: 44000, psychiatristsPer100k: 23, healthExpenditure: 11.1, literacyRate: 99, urbanization: 81, amoCouverage: 100 },
                    languages: ['fr'], healthSystem: 'mixed',
                    adaptations: { S16: 1.1, S02: 1.1, S07: 1.1, S14: 1.1 },
                    barriers: ['B02', 'B08', 'B12'],
                    recommendations: { fr: ["SystÃ¨me ARS structurÃ© pour dÃ©ploiement", "RÃ©sistance au changement frÃ©quente", "Importance des syndicats et corps professionnels"], en: ["Structured ARS system for deployment", "Resistance to change common", "Importance of unions and professional bodies"] }
                },
                BE: { 
                    code: 'BE', name: { fr: 'Belgique', en: 'Belgium' }, region: 'Europe', income: 'HIC',
                    indicators: { gdpPerCapita: 51000, psychiatristsPer100k: 21, healthExpenditure: 10.3, literacyRate: 99, urbanization: 98, amoCouverage: 99 },
                    languages: ['fr', 'nl', 'de'], healthSystem: 'mixed',
                    adaptations: { S16: 1.1, S02: 1.1, S14: 1.1 },
                    barriers: ['B02', 'B11', 'B08'],
                    recommendations: { fr: ["Attention aux diffÃ©rences linguistiques FR/NL", "SystÃ¨me fragmentÃ© entre rÃ©gions"], en: ["Attention to FR/NL language differences", "System fragmented between regions"] }
                },
                CA: { 
                    code: 'CA', name: { fr: 'Canada', en: 'Canada' }, region: 'NAmerica', income: 'HIC',
                    indicators: { gdpPerCapita: 52000, psychiatristsPer100k: 16, healthExpenditure: 10.8, literacyRate: 99, urbanization: 82, amoCouverage: 100 },
                    languages: ['en', 'fr'], healthSystem: 'public_dominant',
                    adaptations: { S16: 1.1, S13: 1.1, S14: 1.1 },
                    barriers: ['B08', 'B02', 'B10'],
                    recommendations: { fr: ["SystÃ¨me provincial - adapter par province", "CommunautÃ©s autochtones nÃ©cessitent approches spÃ©cifiques"], en: ["Provincial system - adapt by province", "Indigenous communities require specific approaches"] }
                },
                // ASIE
                IN: { 
                    code: 'IN', name: { fr: 'Inde', en: 'India' }, region: 'SouthAsia', income: 'LMIC',
                    indicators: { gdpPerCapita: 2500, psychiatristsPer100k: 0.3, healthExpenditure: 3.5, literacyRate: 74, urbanization: 35, amoCouverage: 40 },
                    languages: ['hi', 'en'], healthSystem: 'mixed',
                    adaptations: { S19: 1.5, S08: 1.4, S17: 0.7, S15: 1.3 },
                    barriers: ['B06', 'B05', 'B01', 'B09'],
                    recommendations: { fr: ["Task-shifting crucial (ASHA workers)", "Grande diversitÃ© rÃ©gionale", "M-health en expansion rapide"], en: ["Task-shifting crucial (ASHA workers)", "Great regional diversity", "M-health rapidly expanding"] }
                },
                BD: { 
                    code: 'BD', name: { fr: 'Bangladesh', en: 'Bangladesh' }, region: 'SouthAsia', income: 'LMIC',
                    indicators: { gdpPerCapita: 2500, psychiatristsPer100k: 0.1, healthExpenditure: 2.4, literacyRate: 74, urbanization: 38, amoCouverage: 25 },
                    languages: ['bn'], healthSystem: 'mixed',
                    adaptations: { S19: 1.5, S08: 1.4, S15: 1.3, S06: 0.2 },
                    barriers: ['B06', 'B01', 'B05', 'B03'],
                    recommendations: { fr: ["BRAC et ONG trÃ¨s actifs", "Formation en bengali essentielle", "Approche communautaire Ã©prouvÃ©e"], en: ["BRAC and NGOs very active", "Bengali training essential", "Proven community approach"] }
                },
                // AMÃ‰RIQUE LATINE
                BR: { 
                    code: 'BR', name: { fr: 'BrÃ©sil', en: 'Brazil' }, region: 'LatAm', income: 'UMIC',
                    indicators: { gdpPerCapita: 9000, psychiatristsPer100k: 3.2, healthExpenditure: 9.5, literacyRate: 93, urbanization: 87, amoCouverage: 75 },
                    languages: ['pt'], healthSystem: 'mixed',
                    adaptations: { S08: 1.2, S07: 1.1, S19: 1.1 },
                    barriers: ['B06', 'B02', 'B11'],
                    recommendations: { fr: ["SUS (systÃ¨me unifiÃ©) facilite dÃ©ploiement", "CAPS comme modÃ¨le de soins communautaires", "Grandes inÃ©galitÃ©s rÃ©gionales"], en: ["SUS (unified system) facilitates deployment", "CAPS as community care model", "Large regional inequalities"] }
                },
                MX: { 
                    code: 'MX', name: { fr: 'Mexique', en: 'Mexico' }, region: 'LatAm', income: 'UMIC',
                    indicators: { gdpPerCapita: 10000, psychiatristsPer100k: 1.6, healthExpenditure: 5.4, literacyRate: 95, urbanization: 80, amoCouverage: 65 },
                    languages: ['es'], healthSystem: 'mixed',
                    adaptations: { S08: 1.2, S19: 1.1, S07: 1.1 },
                    barriers: ['B06', 'B05', 'B02'],
                    recommendations: { fr: ["SystÃ¨me IMSS/ISSSTE structurÃ©", "CommunautÃ©s indigÃ¨nes nÃ©cessitent adaptation"], en: ["Structured IMSS/ISSSTE system", "Indigenous communities require adaptation"] }
                }
            },
            
            // RÃ©cupÃ¨re les donnÃ©es d'un pays
            getCountry: function(code) {
                return this.countries[code] || null;
            },
            
            // Liste tous les pays disponibles
            listCountries: function(lang) {
                lang = lang || 'fr';
                return Object.values(this.countries).map(function(c) {
                    return { code: c.code, name: c.name[lang], region: c.region, income: c.income };
                }).sort(function(a, b) { return a.name.localeCompare(b.name); });
            },
            
            // Applique les adaptations pays aux stratÃ©gies
            applyCountryAdaptations: function(strategies, countryCode) {
                var country = this.countries[countryCode];
                if (!country) return strategies;
                
                var adaptations = country.adaptations || {};
                return strategies.map(function(s) {
                    var multiplier = adaptations[s.id] || 1.0;
                    return Object.assign({}, s, {
                        score: s.score * multiplier,
                        countryAdapted: true,
                        countryMultiplier: multiplier
                    });
                }).sort(function(a, b) { return b.score - a.score; });
            },
            
            // GÃ©nÃ¨re un rapport contextuel pays
            getCountryReport: function(countryCode, lang) {
                lang = lang || 'fr';
                var country = this.countries[countryCode];
                if (!country) return null;
                
                var incomeLabels = {
                    HIC: { fr: 'Pays Ã  revenu Ã©levÃ©', en: 'High-Income Country' },
                    UMIC: { fr: 'Revenu intermÃ©diaire supÃ©rieur', en: 'Upper-Middle Income' },
                    LMIC: { fr: 'Revenu intermÃ©diaire infÃ©rieur', en: 'Lower-Middle Income' },
                    LIC: { fr: 'Pays Ã  faible revenu', en: 'Low-Income Country' }
                };
                
                return {
                    country: country.name[lang],
                    code: country.code,
                    incomeLevel: incomeLabels[country.income][lang],
                    income: country.income,
                    indicators: country.indicators,
                    languages: country.languages,
                    healthSystem: country.healthSystem,
                    priorityBarriers: country.barriers,
                    recommendations: country.recommendations[lang],
                    adaptations: country.adaptations
                };
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SUCCESS PREDICTION - Simulation prÃ©dictive du succÃ¨s
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var SuccessPrediction = {
            // â”€â”€ METHODOLOGICAL NOTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            // These coefficients are HEURISTIC ESTIMATES derived from:
            //   - Effective Practice and Organisation of Care (EPOC) reviews
            //   - Powell et al. (2015) compilation of 73 ERIC strategies
            //   - Ivers et al. (2012) Cochrane review on audit & feedback
            //   - Grimshaw et al. (2012) knowledge translation review
            // They are NOT trained weights from a statistical model.
            // Base probability (0.35) from Proctor et al. (2011) observation
            // that ~35% of implementations achieve sustained adoption.
            // LIMITATION: These values are expert-estimated approximations,
            // not empirically calibrated parameters. Use for exploratory
            // analysis only, not for grant applications or publications.
            // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            strategySuccessFactors: {
                S01: { baseImpact: 0.12, evidence: 'strong' },    // Formation
                S02: { baseImpact: 0.08, evidence: 'strong' },    // Audit
                S03: { baseImpact: 0.10, evidence: 'moderate' },  // Facilitation
                S04: { baseImpact: 0.11, evidence: 'strong' },    // Champions
                S05: { baseImpact: 0.06, evidence: 'moderate' },  // Rappels
                S06: { baseImpact: 0.05, evidence: 'weak' },      // Incitations
                S07: { baseImpact: 0.09, evidence: 'moderate' },  // Politique
                S08: { baseImpact: 0.10, evidence: 'strong' },    // CommunautÃ©
                S09: { baseImpact: 0.05, evidence: 'moderate' },  // Assistance tech
                S10: { baseImpact: 0.13, evidence: 'strong' },    // Supervision
                S11: { baseImpact: 0.07, evidence: 'moderate' },  // Adaptation
                S12: { baseImpact: 0.08, evidence: 'moderate' },  // Coalitions
                S13: { baseImpact: 0.06, evidence: 'moderate' },  // DonnÃ©es
                S14: { baseImpact: 0.07, evidence: 'moderate' },  // Collaborative
                S15: { baseImpact: 0.09, evidence: 'strong' },    // Pairs
                S16: { baseImpact: 0.08, evidence: 'strong' },    // QualitÃ©
                S17: { baseImpact: 0.04, evidence: 'weak' },      // Centralisation
                S18: { baseImpact: 0.08, evidence: 'moderate' },  // Ã‰ducation patients
                S19: { baseImpact: 0.11, evidence: 'strong' },    // Task-shifting
                S20: { baseImpact: 0.10, evidence: 'strong' }     // Engagement PP
            },
            
            // Synergies entre stratÃ©gies (combinaisons qui amplifient l'effet)
            strategySynergies: {
                'S01+S10': 0.05, // Formation + Supervision
                'S01+S02': 0.04, // Formation + Audit
                'S04+S20': 0.05, // Champions + Engagement PP
                'S08+S18': 0.04, // CommunautÃ© + Ã‰ducation patients
                'S10+S15': 0.04, // Supervision + Pairs
                'S02+S13': 0.03, // Audit + DonnÃ©es
                'S07+S12': 0.04, // Politique + Coalitions
                'S19+S10': 0.05  // Task-shifting + Supervision
            },
            
            // Facteurs de risque qui rÃ©duisent la probabilitÃ©
            riskFactors: {
                nobudget: { impact: -0.15, label: { fr: 'Pas de budget dÃ©diÃ©', en: 'No dedicated budget' } },
                noturnover: { impact: -0.08, label: { fr: 'Turnover Ã©levÃ© du personnel', en: 'High staff turnover' } },
                nopolicy: { impact: -0.10, label: { fr: 'Pas de soutien politique', en: 'No policy support' } },
                nochampion: { impact: -0.12, label: { fr: 'Pas de champion identifiÃ©', en: 'No identified champion' } },
                nodata: { impact: -0.06, label: { fr: 'Pas de systÃ¨me de donnÃ©es', en: 'No data system' } },
                nosupervision: { impact: -0.10, label: { fr: 'Pas de supervision prÃ©vue', en: 'No supervision planned' } },
                shortduration: { impact: -0.08, label: { fr: 'DurÃ©e trop courte (<12 mois)', en: 'Too short duration (<12 months)' } },
                lowresources: { impact: -0.07, label: { fr: 'Ressources limitÃ©es', en: 'Limited resources' } }
            },
            
            // Calcule la probabilitÃ© de succÃ¨s
            predict: function(project, strategies, lang) {
                lang = lang || 'fr';
                var self = this;
                
                // Base: 35% (taux de base des implÃ©mentations)
                var baseProb = 0.35;
                var details = { positive: [], negative: [], synergies: [] };
                
                // 1. Ajouter l'impact des stratÃ©gies
                var strategyImpact = 0;
                var strategyIds = strategies.map(function(s) { return s.id; });
                
                strategies.forEach(function(s) {
                    var factor = self.strategySuccessFactors[s.id];
                    if (factor) {
                        var impact = factor.baseImpact;
                        strategyImpact += impact;
                        details.positive.push({
                            id: s.id,
                            label: s.label ? s.label[lang] : s.id,
                            impact: Math.round(impact * 100),
                            evidence: factor.evidence
                        });
                    }
                });
                
                // 2. Calculer les synergies
                var synergyImpact = 0;
                Object.keys(this.strategySynergies).forEach(function(combo) {
                    var parts = combo.split('+');
                    if (strategyIds.indexOf(parts[0]) >= 0 && strategyIds.indexOf(parts[1]) >= 0) {
                        var bonus = self.strategySynergies[combo];
                        synergyImpact += bonus;
                        details.synergies.push({
                            combo: combo,
                            strategies: parts,
                            impact: Math.round(bonus * 100)
                        });
                    }
                });
                
                // 3. Identifier les risques
                var riskImpact = 0;
                
                // Analyse automatique des risques basÃ©e sur les stratÃ©gies
                if (strategyIds.indexOf('S04') < 0) {
                    riskImpact += this.riskFactors.nochampion.impact;
                    details.negative.push({ id: 'nochampion', label: this.riskFactors.nochampion.label[lang], impact: Math.round(this.riskFactors.nochampion.impact * 100) });
                }
                if (strategyIds.indexOf('S10') < 0) {
                    riskImpact += this.riskFactors.nosupervision.impact;
                    details.negative.push({ id: 'nosupervision', label: this.riskFactors.nosupervision.label[lang], impact: Math.round(this.riskFactors.nosupervision.impact * 100) });
                }
                if (strategyIds.indexOf('S07') < 0) {
                    riskImpact += this.riskFactors.nopolicy.impact * 0.7; // Moins critique
                    details.negative.push({ id: 'nopolicy', label: this.riskFactors.nopolicy.label[lang], impact: Math.round(this.riskFactors.nopolicy.impact * 0.7 * 100) });
                }
                if (strategyIds.indexOf('S13') < 0 && strategyIds.indexOf('S02') < 0) {
                    riskImpact += this.riskFactors.nodata.impact;
                    details.negative.push({ id: 'nodata', label: this.riskFactors.nodata.label[lang], impact: Math.round(this.riskFactors.nodata.impact * 100) });
                }
                
                // Ajustement selon niveau de ressources
                if (project.resourceLevel === 'LIC' || project.resourceLevel === 'LMIC') {
                    riskImpact += this.riskFactors.lowresources.impact * 0.5;
                    details.negative.push({ id: 'lowresources', label: this.riskFactors.lowresources.label[lang], impact: Math.round(this.riskFactors.lowresources.impact * 0.5 * 100) });
                }
                
                // 4. Calcul final
                var finalProb = baseProb + strategyImpact + synergyImpact + riskImpact;
                finalProb = Math.max(0.15, Math.min(0.95, finalProb)); // Borner entre 15% et 95%
                
                // 5. GÃ©nÃ©rer des recommandations pour amÃ©liorer
                var improvements = [];
                if (strategyIds.indexOf('S04') < 0) {
                    improvements.push({ add: 'S04', gain: 12, reason: lang === 'fr' ? 'Ajouter un champion local' : 'Add a local champion' });
                }
                if (strategyIds.indexOf('S10') < 0) {
                    improvements.push({ add: 'S10', gain: 13, reason: lang === 'fr' ? 'PrÃ©voir une supervision clinique' : 'Plan clinical supervision' });
                }
                if (strategyIds.indexOf('S07') < 0) {
                    improvements.push({ add: 'S07', gain: 9, reason: lang === 'fr' ? 'Ancrer dans une politique' : 'Anchor in policy' });
                }
                if (strategyIds.indexOf('S02') < 0) {
                    improvements.push({ add: 'S02', gain: 8, reason: lang === 'fr' ? 'Mettre en place audit et feedback' : 'Set up audit and feedback' });
                }
                
                improvements.sort(function(a, b) { return b.gain - a.gain; });
                
                return {
                    probability: Math.round(finalProb * 100),
                    baseRate: Math.round(baseProb * 100),
                    strategyContribution: Math.round(strategyImpact * 100),
                    synergyBonus: Math.round(synergyImpact * 100),
                    riskPenalty: Math.round(riskImpact * 100),
                    details: details,
                    improvements: improvements.slice(0, 3),
                    confidence: strategies.length >= 4 ? 'high' : strategies.length >= 2 ? 'medium' : 'low',
                    disclaimer: lang === 'fr' 
                        ? "Estimation basÃ©e sur les mÃ©ta-analyses en Implementation Science. Valeur indicative uniquement."
                        : "Estimate based on Implementation Science meta-analyses. Indicative value only."
                };
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BUDGET ESTIMATOR - Estimateur budgÃ©taire automatique (USD)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var BudgetEstimator = {
            // CoÃ»ts unitaires par stratÃ©gie et niveau de ressources (USD)
            unitCosts: {
                S01: { // Formation
                    HIC: { perPerson: 500, perDay: 800, setup: 5000 },
                    UMIC: { perPerson: 200, perDay: 350, setup: 2000 },
                    LMIC: { perPerson: 80, perDay: 150, setup: 800 },
                    LIC: { perPerson: 40, perDay: 80, setup: 400 }
                },
                S02: { // Audit
                    HIC: { perAudit: 3000, perYear: 12000, setup: 2000 },
                    UMIC: { perAudit: 1200, perYear: 5000, setup: 800 },
                    LMIC: { perAudit: 500, perYear: 2000, setup: 400 },
                    LIC: { perAudit: 200, perYear: 800, setup: 200 }
                },
                S03: { // Facilitation
                    HIC: { perMonth: 8000, perSession: 500, setup: 0 },
                    UMIC: { perMonth: 3500, perSession: 200, setup: 0 },
                    LMIC: { perMonth: 1500, perSession: 80, setup: 0 },
                    LIC: { perMonth: 600, perSession: 40, setup: 0 }
                },
                S04: { // Champions
                    HIC: { perChampion: 2000, perYear: 5000, setup: 1000 },
                    UMIC: { perChampion: 800, perYear: 2000, setup: 400 },
                    LMIC: { perChampion: 300, perYear: 800, setup: 150 },
                    LIC: { perChampion: 150, perYear: 400, setup: 80 }
                },
                S05: { // Rappels
                    HIC: { setup: 15000, perYear: 5000, perUser: 10 },
                    UMIC: { setup: 6000, perYear: 2000, perUser: 5 },
                    LMIC: { setup: 2500, perYear: 800, perUser: 2 },
                    LIC: { setup: 1000, perYear: 400, perUser: 1 }
                },
                S06: { // Incitations financiÃ¨res
                    HIC: { perIncentive: 200, perYear: 50000, setup: 2000 },
                    UMIC: { perIncentive: 80, perYear: 20000, setup: 800 },
                    LMIC: { perIncentive: 30, perYear: 8000, setup: 300 },
                    LIC: { perIncentive: 15, perYear: 4000, setup: 150 }
                },
                S07: { // Politique
                    HIC: { advocacy: 20000, consultancy: 50000, setup: 5000 },
                    UMIC: { advocacy: 8000, consultancy: 20000, setup: 2000 },
                    LMIC: { advocacy: 3000, consultancy: 8000, setup: 800 },
                    LIC: { advocacy: 1500, consultancy: 4000, setup: 400 }
                },
                S08: { // Engagement communautaire
                    HIC: { perMeeting: 1000, perYear: 15000, setup: 3000 },
                    UMIC: { perMeeting: 400, perYear: 6000, setup: 1200 },
                    LMIC: { perMeeting: 150, perYear: 2500, setup: 500 },
                    LIC: { perMeeting: 80, perYear: 1200, setup: 250 }
                },
                S09: { // Assistance technique
                    HIC: { perMonth: 5000, setup: 3000, perTicket: 100 },
                    UMIC: { perMonth: 2000, setup: 1200, perTicket: 40 },
                    LMIC: { perMonth: 800, setup: 500, perTicket: 15 },
                    LIC: { perMonth: 400, setup: 250, perTicket: 8 }
                },
                S10: { // Supervision
                    HIC: { perHour: 150, perMonth: 3000, setup: 2000 },
                    UMIC: { perHour: 60, perMonth: 1200, setup: 800 },
                    LMIC: { perHour: 25, perMonth: 500, setup: 300 },
                    LIC: { perHour: 12, perMonth: 250, setup: 150 }
                },
                S11: { // Adaptation
                    HIC: { workshop: 10000, materials: 5000, setup: 2000 },
                    UMIC: { workshop: 4000, materials: 2000, setup: 800 },
                    LMIC: { workshop: 1500, materials: 800, setup: 300 },
                    LIC: { workshop: 800, materials: 400, setup: 150 }
                },
                S12: { // Coalitions
                    HIC: { perMeeting: 2000, perYear: 25000, setup: 5000 },
                    UMIC: { perMeeting: 800, perYear: 10000, setup: 2000 },
                    LMIC: { perMeeting: 300, perYear: 4000, setup: 800 },
                    LIC: { perMeeting: 150, perYear: 2000, setup: 400 }
                },
                S13: { // SystÃ¨mes de donnÃ©es
                    HIC: { software: 30000, perYear: 10000, setup: 15000 },
                    UMIC: { software: 12000, perYear: 4000, setup: 6000 },
                    LMIC: { software: 5000, perYear: 1500, setup: 2500 },
                    LIC: { software: 2000, perYear: 600, setup: 1000 }
                },
                S14: { // Apprentissage collaboratif
                    HIC: { perEvent: 5000, perYear: 20000, setup: 3000 },
                    UMIC: { perEvent: 2000, perYear: 8000, setup: 1200 },
                    LMIC: { perEvent: 800, perYear: 3200, setup: 500 },
                    LIC: { perEvent: 400, perYear: 1600, setup: 250 }
                },
                S15: { // Pairs aidants
                    HIC: { perPeer: 3000, training: 5000, setup: 2000 },
                    UMIC: { perPeer: 1200, training: 2000, setup: 800 },
                    LMIC: { perPeer: 500, training: 800, setup: 300 },
                    LIC: { perPeer: 250, training: 400, setup: 150 }
                },
                S16: { // AmÃ©lioration qualitÃ©
                    HIC: { perCycle: 8000, perYear: 25000, setup: 5000 },
                    UMIC: { perCycle: 3200, perYear: 10000, setup: 2000 },
                    LMIC: { perCycle: 1300, perYear: 4000, setup: 800 },
                    LIC: { perCycle: 650, perYear: 2000, setup: 400 }
                },
                S17: { // Coordination centralisÃ©e
                    HIC: { coordinator: 80000, perYear: 100000, setup: 10000 },
                    UMIC: { coordinator: 35000, perYear: 45000, setup: 4000 },
                    LMIC: { coordinator: 15000, perYear: 20000, setup: 1500 },
                    LIC: { coordinator: 8000, perYear: 10000, setup: 800 }
                },
                S18: { // Ã‰ducation patients
                    HIC: { materials: 10000, perYear: 15000, setup: 5000 },
                    UMIC: { materials: 4000, perYear: 6000, setup: 2000 },
                    LMIC: { materials: 1500, perYear: 2500, setup: 800 },
                    LIC: { materials: 800, perYear: 1200, setup: 400 }
                },
                S19: { // Task-shifting
                    HIC: { training: 30000, supervision: 20000, setup: 10000 },
                    UMIC: { training: 12000, supervision: 8000, setup: 4000 },
                    LMIC: { training: 5000, supervision: 3500, setup: 1500 },
                    LIC: { training: 2500, supervision: 1500, setup: 800 }
                },
                S20: { // Engagement parties prenantes
                    HIC: { perMeeting: 3000, perYear: 20000, setup: 5000 },
                    UMIC: { perMeeting: 1200, perYear: 8000, setup: 2000 },
                    LMIC: { perMeeting: 500, perYear: 3500, setup: 800 },
                    LIC: { perMeeting: 250, perYear: 1800, setup: 400 }
                }
            },
            
            // Calcule le budget total
            estimate: function(project, strategies, lang) {
                lang = lang || 'fr';
                var self = this;
                var resourceLevel = project.resourceLevel || 'LMIC';
                var durationMonths = project.duration || 24;
                var sites = project.sites || 1;
                var population = project.population || 100;
                
                var lineItems = [];
                var totalSetup = 0;
                var totalRecurring = 0;
                
                strategies.forEach(function(s) {
                    var costs = self.unitCosts[s.id];
                    if (!costs) return;
                    
                    var levelCosts = costs[resourceLevel] || costs['LMIC'];
                    var item = {
                        id: s.id,
                        label: s.label ? s.label[lang] : s.id,
                        setup: 0,
                        recurring: 0,
                        details: []
                    };
                    
                    // Calcul selon la stratÃ©gie
                    switch(s.id) {
                        case 'S01': // Formation
                            item.setup = levelCosts.setup * sites;
                            item.recurring = levelCosts.perPerson * population * 1.5; // 1.5 pour formation continue
                            item.details.push(lang === 'fr' ? 'Formation initiale + continue' : 'Initial + continuing training');
                            break;
                        case 'S02': // Audit
                            item.setup = levelCosts.setup;
                            item.recurring = levelCosts.perYear * (durationMonths / 12) * sites;
                            item.details.push(lang === 'fr' ? '4 audits/an/site' : '4 audits/year/site');
                            break;
                        case 'S03': // Facilitation
                            item.setup = 0;
                            item.recurring = levelCosts.perMonth * durationMonths;
                            item.details.push(lang === 'fr' ? 'Facilitateur dÃ©diÃ©' : 'Dedicated facilitator');
                            break;
                        case 'S04': // Champions
                            var championsCount = Math.max(1, sites);
                            item.setup = levelCosts.setup;
                            item.recurring = levelCosts.perYear * (durationMonths / 12) * championsCount;
                            item.details.push(championsCount + ' champion(s)');
                            break;
                        case 'S10': // Supervision
                            var supervisionHours = 8 * durationMonths * sites;
                            item.setup = levelCosts.setup;
                            item.recurring = levelCosts.perHour * supervisionHours;
                            item.details.push(lang === 'fr' ? '8h/mois/site' : '8h/month/site');
                            break;
                        case 'S13': // SystÃ¨mes de donnÃ©es
                            item.setup = levelCosts.software + levelCosts.setup;
                            item.recurring = levelCosts.perYear * (durationMonths / 12);
                            item.details.push(lang === 'fr' ? 'Logiciel + maintenance' : 'Software + maintenance');
                            break;
                        case 'S19': // Task-shifting
                            item.setup = levelCosts.training + levelCosts.setup;
                            item.recurring = levelCosts.supervision * (durationMonths / 12);
                            item.details.push(lang === 'fr' ? 'Formation + supervision continue' : 'Training + ongoing supervision');
                            break;
                        default:
                            item.setup = levelCosts.setup || 0;
                            item.recurring = (levelCosts.perYear || 0) * (durationMonths / 12);
                    }
                    
                    // Ajuster pour multi-sites
                    if (sites > 1 && s.id !== 'S17' && s.id !== 'S13') {
                        item.recurring *= (1 + (sites - 1) * 0.6); // Ã‰conomies d'Ã©chelle
                    }
                    
                    totalSetup += item.setup;
                    totalRecurring += item.recurring;
                    lineItems.push(item);
                });
                
                // CoÃ»ts de coordination (10% du total)
                var coordination = (totalSetup + totalRecurring) * 0.10;
                lineItems.push({
                    id: 'COORD',
                    label: lang === 'fr' ? 'Coordination projet' : 'Project coordination',
                    setup: coordination * 0.3,
                    recurring: coordination * 0.7,
                    details: [lang === 'fr' ? 'Gestion, rÃ©unions, reporting' : 'Management, meetings, reporting']
                });
                
                // ImprÃ©vus (10%)
                var contingency = (totalSetup + totalRecurring + coordination) * 0.10;
                lineItems.push({
                    id: 'CONTINGENCY',
                    label: lang === 'fr' ? 'ImprÃ©vus (10%)' : 'Contingency (10%)',
                    setup: contingency * 0.3,
                    recurring: contingency * 0.7,
                    details: []
                });
                
                var grandTotal = totalSetup + totalRecurring + coordination + contingency;
                var costPerBeneficiary = grandTotal / population;
                
                // Benchmark
                var benchmarks = {
                    HIC: { low: 800, high: 2000, currency: 'USD' },
                    UMIC: { low: 300, high: 800, currency: 'USD' },
                    LMIC: { low: 100, high: 400, currency: 'USD' },
                    LIC: { low: 50, high: 200, currency: 'USD' }
                };
                var benchmark = benchmarks[resourceLevel] || benchmarks['LMIC'];
                var benchmarkStatus = costPerBeneficiary <= benchmark.high ? (costPerBeneficiary <= benchmark.low ? 'low' : 'normal') : 'high';
                
                return {
                    lineItems: lineItems,
                    summary: {
                        setup: Math.round(totalSetup),
                        recurring: Math.round(totalRecurring + coordination * 0.7 + contingency * 0.7),
                        coordination: Math.round(coordination),
                        contingency: Math.round(contingency),
                        total: Math.round(grandTotal),
                        currency: 'USD'
                    },
                    perBeneficiary: Math.round(costPerBeneficiary),
                    benchmark: {
                        range: benchmark,
                        status: benchmarkStatus,
                        message: lang === 'fr'
                            ? (benchmarkStatus === 'low' ? 'Budget optimisÃ©' : benchmarkStatus === 'normal' ? 'Dans la norme' : 'Au-dessus de la moyenne')
                            : (benchmarkStatus === 'low' ? 'Optimized budget' : benchmarkStatus === 'normal' ? 'Within range' : 'Above average')
                    },
                    parameters: {
                        resourceLevel: resourceLevel,
                        durationMonths: durationMonths,
                        sites: sites,
                        population: population
                    }
                };
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CASE LIBRARY - BibliothÃ¨que de cas rÃ©els anonymisÃ©s
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var CaseLibrary = {
            cases: [
                {
                    id: 'CASE001',
                    title: { fr: 'mhGAP Maroc - SantÃ© mentale soins primaires', en: 'mhGAP Morocco - Mental health primary care' },
                    country: 'MA', domain: 'mental_health', context: 'primary_health_center',
                    duration: 36, sites: 6, population: 150, budget: 650000,
                    strategies: ['S01', 'S10', 'S19', 'S04', 'S08', 'S02'],
                    outcome: 'success', adoptionRate: 78,
                    lessons: { fr: ["La supervision hebdomadaire a Ã©tÃ© dÃ©terminante pour maintenir la qualitÃ©", "Les imams ont jouÃ© un rÃ´le clÃ© dans la rÃ©duction de la stigmatisation", "Le task-shifting vers les infirmiers a bien fonctionnÃ© avec une formation adaptÃ©e"], en: ["Weekly supervision was crucial for maintaining quality", "Imams played a key role in reducing stigma", "Task-shifting to nurses worked well with adapted training"] },
                    challenges: { fr: ["Turnover Ã©levÃ© des mÃ©decins formÃ©s", "RÃ©sistance initiale des psychiatres"], en: ["High turnover of trained physicians", "Initial resistance from psychiatrists"] },
                    year: 2022
                },
                {
                    id: 'CASE002',
                    title: { fr: 'Programme VIH communautaire SÃ©nÃ©gal', en: 'Community HIV Program Senegal' },
                    country: 'SN', domain: 'infectious_disease', context: 'community',
                    duration: 24, sites: 12, population: 500, budget: 420000,
                    strategies: ['S08', 'S15', 'S19', 'S18', 'S12'],
                    outcome: 'success', adoptionRate: 85,
                    lessons: { fr: ["Les pairs Ã©ducateurs ont Ã©tÃ© le pilier du programme", "L'engagement des leaders communautaires dÃ¨s le dÃ©but est essentiel", "La radio locale a amplifiÃ© la portÃ©e des messages"], en: ["Peer educators were the program's backbone", "Engaging community leaders from the start is essential", "Local radio amplified message reach"] },
                    challenges: { fr: ["Financement irrÃ©gulier des bailleurs", "DifficultÃ©s d'accÃ¨s aux zones rurales"], en: ["Irregular donor funding", "Difficulty accessing rural areas"] },
                    year: 2021
                },
                {
                    id: 'CASE003',
                    title: { fr: 'QualitÃ© des soins chirurgicaux Tunisie', en: 'Surgical Care Quality Tunisia' },
                    country: 'TN', domain: 'surgery', context: 'hospital',
                    duration: 18, sites: 3, population: 80, budget: 280000,
                    strategies: ['S02', 'S16', 'S01', 'S05', 'S04'],
                    outcome: 'success', adoptionRate: 72,
                    lessons: { fr: ["Les checklists chirurgicales ont rÃ©duit les complications de 40%", "L'audit mensuel avec feedback immÃ©diat a motivÃ© les Ã©quipes", "Le champion (chef de service) a fait la diffÃ©rence"], en: ["Surgical checklists reduced complications by 40%", "Monthly audit with immediate feedback motivated teams", "The champion (department head) made the difference"] },
                    challenges: { fr: ["RÃ©sistance des chirurgiens seniors au dÃ©but", "Surcharge de travail des Ã©quipes"], en: ["Senior surgeons' resistance at first", "Team workload issues"] },
                    year: 2023
                },
                {
                    id: 'CASE004',
                    title: { fr: 'SantÃ© maternelle Kenya rural', en: 'Rural Maternal Health Kenya' },
                    country: 'KE', domain: 'maternal_child', context: 'rural',
                    duration: 30, sites: 8, population: 200, budget: 380000,
                    strategies: ['S19', 'S08', 'S17', 'S10', 'S18'],
                    outcome: 'partial', adoptionRate: 55,
                    lessons: { fr: ["Le M-health (rappels SMS) a amÃ©liorÃ© le suivi prÃ©natal", "Les accoucheuses traditionnelles doivent Ãªtre incluses, pas exclues", "La coordination centrale Ã©tait trop lourde pour le contexte"], en: ["M-health (SMS reminders) improved prenatal follow-up", "Traditional birth attendants must be included, not excluded", "Central coordination was too heavy for the context"] },
                    challenges: { fr: ["ConnectivitÃ© rÃ©seau insuffisante dans certaines zones", "Turnover Ã©levÃ© des community health workers"], en: ["Insufficient network connectivity in some areas", "High community health worker turnover"] },
                    year: 2020
                },
                {
                    id: 'CASE005',
                    title: { fr: 'DiabÃ¨te soins primaires Ã‰gypte', en: 'Diabetes Primary Care Egypt' },
                    country: 'EG', domain: 'chronic_disease', context: 'primary_health_center',
                    duration: 24, sites: 10, population: 300, budget: 520000,
                    strategies: ['S01', 'S05', 'S13', 'S18', 'S02'],
                    outcome: 'success', adoptionRate: 68,
                    lessons: { fr: ["Le systÃ¨me de rappel par SMS a doublÃ© le taux de suivi", "Les registres Ã©lectroniques ont facilitÃ© le monitoring", "L'Ã©ducation thÃ©rapeutique en groupe Ã©tait plus efficace"], en: ["SMS reminder system doubled follow-up rate", "Electronic registries facilitated monitoring", "Group therapeutic education was more effective"] },
                    challenges: { fr: ["CoÃ»t des mÃ©dicaments reste une barriÃ¨re majeure", "Formation insuffisante des mÃ©decins gÃ©nÃ©ralistes au dÃ©part"], en: ["Medication cost remains a major barrier", "Insufficient GP training at the start"] },
                    year: 2022
                },
                {
                    id: 'CASE006',
                    title: { fr: 'RÃ©habilitation psychiatrique Suisse', en: 'Psychiatric Rehabilitation Switzerland' },
                    country: 'CH', domain: 'mental_health', context: 'hospital',
                    duration: 24, sites: 2, population: 60, budget: 850000,
                    strategies: ['S16', 'S02', 'S14', 'S15', 'S10'],
                    outcome: 'success', adoptionRate: 88,
                    lessons: { fr: ["L'approche qualitÃ© (PDCA) a structurÃ© l'amÃ©lioration continue", "Les pairs aidants ont transformÃ© la culture du service", "La supervision rÃ©flexive a rÃ©duit le burnout des Ã©quipes"], en: ["Quality approach (PDCA) structured continuous improvement", "Peer support workers transformed the service culture", "Reflective supervision reduced team burnout"] },
                    challenges: { fr: ["RÃ©sistance syndicale initiale aux nouveaux rÃ´les", "CoÃ»t Ã©levÃ© de l'approche"], en: ["Initial union resistance to new roles", "High cost of approach"] },
                    year: 2023
                },
                {
                    id: 'CASE007',
                    title: { fr: 'Soins palliatifs Inde rurale', en: 'Palliative Care Rural India' },
                    country: 'IN', domain: 'chronic_disease', context: 'community',
                    duration: 36, sites: 15, population: 400, budget: 320000,
                    strategies: ['S19', 'S08', 'S01', 'S07', 'S12'],
                    outcome: 'success', adoptionRate: 75,
                    lessons: { fr: ["Les ASHA workers formÃ©es ont Ã©tÃ© excellentes", "Le plaidoyer politique a permis l'accÃ¨s Ã  la morphine orale", "Les familles ont Ã©tÃ© des partenaires essentiels des soins"], en: ["Trained ASHA workers were excellent", "Policy advocacy enabled access to oral morphine", "Families were essential care partners"] },
                    challenges: { fr: ["Tabou culturel autour de la mort et de la douleur", "Logistique des mÃ©dicaments en zones reculÃ©es"], en: ["Cultural taboo around death and pain", "Medication logistics in remote areas"] },
                    year: 2021
                },
                {
                    id: 'CASE008',
                    title: { fr: 'SantÃ© mentale CAPS BrÃ©sil', en: 'CAPS Mental Health Brazil' },
                    country: 'BR', domain: 'mental_health', context: 'community',
                    duration: 24, sites: 4, population: 250, budget: 480000,
                    strategies: ['S08', 'S15', 'S07', 'S03', 'S20'],
                    outcome: 'success', adoptionRate: 82,
                    lessons: { fr: ["Le modÃ¨le CAPS communautaire est reproductible", "L'engagement des usagers dans la gouvernance a Ã©tÃ© clÃ©", "La facilitation active a maintenu la dynamique"], en: ["The community CAPS model is replicable", "User engagement in governance was key", "Active facilitation maintained momentum"] },
                    challenges: { fr: ["Financement municipal instable", "Stigmatisation persistante malgrÃ© les efforts"], en: ["Unstable municipal funding", "Persistent stigma despite efforts"] },
                    year: 2022
                },
                {
                    id: 'CASE009',
                    title: { fr: 'DÃ©pistage cancer CÃ´te d\'Ivoire', en: 'Cancer Screening Ivory Coast' },
                    country: 'CI', domain: 'chronic_disease', context: 'primary_health_center',
                    duration: 18, sites: 5, population: 180, budget: 290000,
                    strategies: ['S01', 'S08', 'S19', 'S18', 'S04'],
                    outcome: 'partial', adoptionRate: 48,
                    lessons: { fr: ["Les agents de santÃ© communautaires ont bien mobilisÃ©", "Le manque de suivi des cas positifs a Ã©tÃ© un Ã©chec", "La formation Ã©tait trop courte"], en: ["Community health workers mobilized well", "Lack of follow-up for positive cases was a failure", "Training was too short"] },
                    challenges: { fr: ["Absence de filiÃ¨re de soins pour les cas dÃ©tectÃ©s", "Croyances traditionnelles sur le cancer"], en: ["No care pathway for detected cases", "Traditional beliefs about cancer"] },
                    year: 2020
                },
                {
                    id: 'CASE010',
                    title: { fr: 'TÃ©lÃ©mÃ©decine santÃ© mentale Bangladesh', en: 'Mental Health Telemedicine Bangladesh' },
                    country: 'BD', domain: 'mental_health', context: 'telehealth',
                    duration: 24, sites: 20, population: 350, budget: 280000,
                    strategies: ['S17', 'S09', 'S01', 'S19', 'S13'],
                    outcome: 'success', adoptionRate: 70,
                    lessons: { fr: ["La tÃ©lÃ©consultation a contournÃ© la pÃ©nurie de psychiatres", "L'application mobile en bengali a Ã©tÃ© bien acceptÃ©e", "Le support technique rÃ©actif Ã©tait essentiel"], en: ["Teleconsultation bypassed psychiatrist shortage", "Bengali mobile app was well accepted", "Responsive technical support was essential"] },
                    challenges: { fr: ["ConnectivitÃ© internet variable", "PrÃ©fÃ©rence culturelle pour le face-Ã -face"], en: ["Variable internet connectivity", "Cultural preference for face-to-face"] },
                    year: 2023
                }
            ],
            
            // Recherche des cas similaires
            findSimilar: function(project, topN) {
                topN = topN || 5;
                var self = this;
                
                return this.cases.map(function(c) {
                    var score = 0;
                    
                    // MÃªme domaine = +30%
                    if (project.domain && c.domain === project.domain) score += 30;
                    
                    // MÃªme rÃ©gion/pays = +20%
                    if (project.country && c.country === project.country) score += 20;
                    else if (project.resourceLevel) {
                        var caseCountry = CountryIntelligence.getCountry(c.country);
                        if (caseCountry && caseCountry.income === project.resourceLevel) score += 10;
                    }
                    
                    // MÃªme contexte = +20%
                    if (project.context && c.context === project.context) score += 20;
                    
                    // StratÃ©gies similaires = jusqu'Ã  +30%
                    if (project.strategies) {
                        var projectStrats = project.strategies.map(function(s) { return s.id || s; });
                        var overlap = c.strategies.filter(function(s) { return projectStrats.indexOf(s) >= 0; }).length;
                        score += Math.min(30, overlap * 6);
                    }
                    
                    return {
                        case: c,
                        similarity: score,
                        outcome: c.outcome
                    };
                }).sort(function(a, b) { return b.similarity - a.similarity; }).slice(0, topN);
            },
            
            // RÃ©cupÃ¨re un cas par ID
            getCase: function(id) {
                return this.cases.find(function(c) { return c.id === id; });
            },
            
            // Statistiques globales
            getStats: function() {
                var total = this.cases.length;
                var success = this.cases.filter(function(c) { return c.outcome === 'success'; }).length;
                var partial = this.cases.filter(function(c) { return c.outcome === 'partial'; }).length;
                var avgAdoption = this.cases.reduce(function(a, b) { return a + b.adoptionRate; }, 0) / total;
                
                return {
                    totalCases: total,
                    successRate: Math.round(success / total * 100),
                    partialRate: Math.round(partial / total * 100),
                    avgAdoptionRate: Math.round(avgAdoption),
                    countries: Array.from(new Set(this.cases.map(function(c) { return c.country; }))).length,
                    domains: Array.from(new Set(this.cases.map(function(c) { return c.domain; }))).length
                };
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RISK ANALYSIS - Analyse de risques automatique
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var RiskAnalysis = {
            // Catalogue des risques
            riskCatalog: {
                R01: { id: 'R01', name: { fr: 'Turnover du personnel formÃ©', en: 'Trained staff turnover' }, category: 'HR', baseProbability: 0.6, baseImpact: 'high', triggers: ['B14'], mitigations: ['S10', 'S15', 'S06'] },
                R02: { id: 'R02', name: { fr: 'RÃ©sistance au changement', en: 'Resistance to change' }, category: 'organizational', baseProbability: 0.5, baseImpact: 'high', triggers: ['B02', 'B07'], mitigations: ['S04', 'S20', 'S03'] },
                R03: { id: 'R03', name: { fr: 'Financement insuffisant ou retardÃ©', en: 'Insufficient or delayed funding' }, category: 'financial', baseProbability: 0.4, baseImpact: 'high', triggers: ['B06'], mitigations: ['S12', 'S07'] },
                R04: { id: 'R04', name: { fr: 'DonnÃ©es incomplÃ¨tes ou non fiables', en: 'Incomplete or unreliable data' }, category: 'technical', baseProbability: 0.5, baseImpact: 'medium', triggers: ['B04', 'B03'], mitigations: ['S13', 'S02'] },
                R05: { id: 'R05', name: { fr: 'Faible adoption par les bÃ©nÃ©ficiaires', en: 'Low beneficiary uptake' }, category: 'programmatic', baseProbability: 0.4, baseImpact: 'high', triggers: ['B05', 'B09', 'B13'], mitigations: ['S08', 'S18', 'S11'] },
                R06: { id: 'R06', name: { fr: 'DÃ©rive des pratiques (fidelity)', en: 'Practice drift (fidelity)' }, category: 'quality', baseProbability: 0.5, baseImpact: 'medium', triggers: ['B01', 'B14'], mitigations: ['S10', 'S02', 'S16'] },
                R07: { id: 'R07', name: { fr: 'Changement de leadership/politique', en: 'Leadership/policy change' }, category: 'external', baseProbability: 0.3, baseImpact: 'high', triggers: ['B07', 'B12'], mitigations: ['S07', 'S12', 'S20'] },
                R08: { id: 'R08', name: { fr: 'Surcharge des Ã©quipes', en: 'Team overload' }, category: 'HR', baseProbability: 0.6, baseImpact: 'medium', triggers: ['B08'], mitigations: ['S19', 'S09', 'S03'] },
                R09: { id: 'R09', name: { fr: 'ProblÃ¨mes techniques (IT, logistique)', en: 'Technical issues (IT, logistics)' }, category: 'technical', baseProbability: 0.4, baseImpact: 'medium', triggers: ['B03'], mitigations: ['S09', 'S13'] },
                R10: { id: 'R10', name: { fr: 'Non-pÃ©rennisation post-projet', en: 'Non-sustainability post-project' }, category: 'strategic', baseProbability: 0.5, baseImpact: 'high', triggers: ['B06', 'B07'], mitigations: ['S07', 'S12', 'S14'] }
            },
            
            // Analyse les risques pour un projet
            analyze: function(project, strategies, lang) {
                lang = lang || 'fr';
                var self = this;
                var strategyIds = strategies.map(function(s) { return s.id || s; });
                var barrierIds = project.barriers || [];
                
                var risks = [];
                
                Object.values(this.riskCatalog).forEach(function(risk) {
                    // Calculer la probabilitÃ© ajustÃ©e
                    var probability = risk.baseProbability;
                    
                    // Augmenter si barriÃ¨res prÃ©sentes
                    var triggersPresent = risk.triggers.filter(function(t) { return barrierIds.indexOf(t) >= 0; }).length;
                    probability += triggersPresent * 0.1;
                    
                    // RÃ©duire si stratÃ©gies de mitigation prÃ©sentes
                    var mitigationsPresent = risk.mitigations.filter(function(m) { return strategyIds.indexOf(m) >= 0; }).length;
                    probability -= mitigationsPresent * 0.15;
                    
                    // Ajuster selon ressources
                    if ((project.resourceLevel === 'LIC' || project.resourceLevel === 'LMIC') && 
                        (risk.category === 'financial' || risk.category === 'HR')) {
                        probability += 0.1;
                    }
                    
                    probability = Math.max(0.1, Math.min(0.9, probability));
                    
                    // DÃ©terminer le niveau
                    var impactScore = risk.baseImpact === 'high' ? 3 : risk.baseImpact === 'medium' ? 2 : 1;
                    var probScore = probability >= 0.6 ? 3 : probability >= 0.4 ? 2 : 1;
                    var riskScore = impactScore * probScore;
                    var level = riskScore >= 6 ? 'critical' : riskScore >= 4 ? 'high' : riskScore >= 2 ? 'medium' : 'low';
                    
                    // Recommandations de mitigation
                    var missingMitigations = risk.mitigations.filter(function(m) { return strategyIds.indexOf(m) < 0; });
                    
                    risks.push({
                        id: risk.id,
                        name: risk.name[lang],
                        category: risk.category,
                        probability: Math.round(probability * 100),
                        impact: risk.baseImpact,
                        level: level,
                        score: riskScore,
                        mitigationsPresent: risk.mitigations.filter(function(m) { return strategyIds.indexOf(m) >= 0; }),
                        mitigationsMissing: missingMitigations,
                        recommendation: missingMitigations.length > 0 
                            ? (lang === 'fr' ? 'Ajouter ' + missingMitigations.slice(0, 2).join(', ') : 'Add ' + missingMitigations.slice(0, 2).join(', '))
                            : (lang === 'fr' ? 'Risque bien couvert' : 'Risk well covered')
                    });
                });
                
                // Trier par niveau de risque
                risks.sort(function(a, b) { return b.score - a.score; });
                
                // RÃ©sumÃ©
                var critical = risks.filter(function(r) { return r.level === 'critical'; }).length;
                var high = risks.filter(function(r) { return r.level === 'high'; }).length;
                var avgScore = risks.reduce(function(a, b) { return a + b.score; }, 0) / risks.length;
                
                return {
                    risks: risks,
                    summary: {
                        total: risks.length,
                        critical: critical,
                        high: high,
                        medium: risks.filter(function(r) { return r.level === 'medium'; }).length,
                        low: risks.filter(function(r) { return r.level === 'low'; }).length,
                        averageScore: Math.round(avgScore * 10) / 10,
                        overallLevel: critical > 0 ? 'critical' : high > 2 ? 'high' : avgScore >= 4 ? 'medium' : 'low'
                    },
                    topRisks: risks.slice(0, 3),
                    matrix: {
                        highProb_highImpact: risks.filter(function(r) { return r.probability >= 60 && r.impact === 'high'; }),
                        highProb_medImpact: risks.filter(function(r) { return r.probability >= 60 && r.impact === 'medium'; }),
                        medProb_highImpact: risks.filter(function(r) { return r.probability >= 40 && r.probability < 60 && r.impact === 'high'; }),
                        lowRisk: risks.filter(function(r) { return r.probability < 40 && r.impact !== 'high'; })
                    }
                };
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RESEARCH EXPORTS - Exports standards recherche (SPIRIT, TIDieR, StaRI)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var ResearchExports = {
            // Template SPIRIT 2013 (protocoles d'essais)
            generateSPIRIT: function(project, strategies, lang) {
                lang = lang || 'fr';
                var kg = KnowledgeGraph.nodes;
                
                var domain = project.domain ? kg.domains[Object.keys(kg.domains).find(function(k) { return kg.domains[k].name === project.domain; })] : null;
                var context = project.context ? kg.contexts[Object.keys(kg.contexts).find(function(k) { return kg.contexts[k].name === project.context; })] : null;
                
                var items = {
                    section1: { title: lang === 'fr' ? '1. INFORMATIONS ADMINISTRATIVES' : '1. ADMINISTRATIVE INFORMATION',
                        items: [
                            { id: '1a', item: lang === 'fr' ? 'Titre du protocole' : 'Protocol title', content: project.title || '[Ã€ complÃ©ter]', status: project.title ? 'complete' : 'incomplete' },
                            { id: '1b', item: lang === 'fr' ? 'NumÃ©ro d\'enregistrement' : 'Trial registration number', content: '[Ã€ complÃ©ter - ClinicalTrials.gov, etc.]', status: 'incomplete' },
                            { id: '2a', item: lang === 'fr' ? 'CoordonnÃ©es de l\'investigateur principal' : 'Primary investigator contact', content: '[Ã€ complÃ©ter]', status: 'incomplete' },
                            { id: '3', item: lang === 'fr' ? 'RÃ´le du sponsor/bailleur' : 'Role of sponsor/funder', content: '[Ã€ complÃ©ter]', status: 'incomplete' }
                        ]
                    },
                    section2: { title: lang === 'fr' ? '2. INTRODUCTION' : '2. INTRODUCTION',
                        items: [
                            { id: '6a', item: lang === 'fr' ? 'Contexte et justification' : 'Background and rationale', 
                              content: lang === 'fr' 
                                ? 'Cette Ã©tude s\'inscrit dans le domaine de ' + (domain ? domain.label.fr : '[domaine]') + ' dans un contexte de ' + (context ? context.label.fr : '[contexte]') + '.'
                                : 'This study is in the field of ' + (domain ? domain.label.en : '[domain]') + ' in a ' + (context ? context.label.en : '[context]') + ' setting.',
                              status: domain && context ? 'partial' : 'incomplete' },
                            { id: '6b', item: lang === 'fr' ? 'BarriÃ¨res identifiÃ©es' : 'Identified barriers',
                              content: project.barriers && project.barriers.length > 0 
                                ? project.barriers.map(function(b) { var bar = kg.barriers[b]; return bar ? bar.label[lang] : b; }).join(', ')
                                : '[Ã€ complÃ©ter]',
                              status: project.barriers && project.barriers.length > 0 ? 'complete' : 'incomplete' }
                        ]
                    },
                    section3: { title: lang === 'fr' ? '3. MÃ‰THODES' : '3. METHODS',
                        items: [
                            { id: '11a', item: lang === 'fr' ? 'Description de l\'intervention' : 'Intervention description',
                              content: lang === 'fr' 
                                ? 'L\'intervention comprend les stratÃ©gies d\'implÃ©mentation suivantes : ' + strategies.map(function(s) { return s.label ? s.label.fr : s.id; }).join(', ') + '.'
                                : 'The intervention includes the following implementation strategies: ' + strategies.map(function(s) { return s.label ? s.label.en : s.id; }).join(', ') + '.',
                              status: strategies.length > 0 ? 'complete' : 'incomplete' },
                            { id: '12', item: lang === 'fr' ? 'CritÃ¨res d\'Ã©ligibilitÃ©' : 'Eligibility criteria', content: '[Ã€ complÃ©ter - critÃ¨res inclusion/exclusion]', status: 'incomplete' },
                            { id: '13', item: lang === 'fr' ? 'Sites et contexte' : 'Settings and locations',
                              content: (project.sites || 1) + ' site(s) - ' + (context ? context.label[lang] : '[contexte]'),
                              status: 'partial' },
                            { id: '18a', item: lang === 'fr' ? 'CritÃ¨res de jugement' : 'Outcomes',
                              content: lang === 'fr' ? 'Outcomes primaires et secondaires selon cadre RE-AIM' : 'Primary and secondary outcomes per RE-AIM framework',
                              status: 'partial' }
                        ]
                    },
                    section4: { title: lang === 'fr' ? '4. STRATÃ‰GIES D\'IMPLÃ‰MENTATION (TIDieR)' : '4. IMPLEMENTATION STRATEGIES (TIDieR)',
                        items: strategies.map(function(s, i) {
                            var strat = kg.strategies[s.id];
                            return {
                                id: 'S' + (i + 1),
                                item: s.label ? s.label[lang] : s.id,
                                content: strat ? (lang === 'fr' 
                                    ? 'CatÃ©gorie: ' + strat.category + ' | CoÃ»t: ' + strat.cost + ' | ComplexitÃ©: ' + strat.complexity
                                    : 'Category: ' + strat.category + ' | Cost: ' + strat.cost + ' | Complexity: ' + strat.complexity)
                                    : '[DÃ©tails Ã  complÃ©ter]',
                                status: 'complete'
                            };
                        })
                    }
                };
                
                var completionRate = 0;
                var totalItems = 0;
                Object.values(items).forEach(function(section) {
                    section.items.forEach(function(item) {
                        totalItems++;
                        if (item.status === 'complete') completionRate += 1;
                        else if (item.status === 'partial') completionRate += 0.5;
                    });
                });
                
                return {
                    type: 'SPIRIT',
                    version: '2013',
                    sections: items,
                    completionRate: Math.round(completionRate / totalItems * 100),
                    totalItems: totalItems,
                    generatedAt: new Date().toISOString()
                };
            },
            
            // Template TIDieR (description d'intervention)
            generateTIDieR: function(project, strategies, lang) {
                lang = lang || 'fr';
                var kg = KnowledgeGraph.nodes;
                
                var items = [
                    { id: '1', item: lang === 'fr' ? 'Nom de l\'intervention' : 'Brief name', content: project.title || '[Ã€ complÃ©ter]', status: project.title ? 'complete' : 'incomplete' },
                    { id: '2', item: lang === 'fr' ? 'Pourquoi - Justification' : 'Why - Rationale', 
                      content: project.barriers && project.barriers.length > 0 
                        ? (lang === 'fr' ? 'Pour adresser les barriÃ¨res suivantes: ' : 'To address the following barriers: ') + project.barriers.map(function(b) { var bar = kg.barriers[b]; return bar ? bar.label[lang] : b; }).join(', ')
                        : '[Ã€ complÃ©ter]',
                      status: project.barriers && project.barriers.length > 0 ? 'complete' : 'incomplete' },
                    { id: '3', item: lang === 'fr' ? 'Quoi - MatÃ©riels' : 'What - Materials', content: '[Lister les supports, guides, outils utilisÃ©s]', status: 'incomplete' },
                    { id: '4', item: lang === 'fr' ? 'Quoi - ProcÃ©dures' : 'What - Procedures',
                      content: strategies.map(function(s) { return (s.label ? s.label[lang] : s.id); }).join('; '),
                      status: strategies.length > 0 ? 'complete' : 'incomplete' },
                    { id: '5', item: lang === 'fr' ? 'Qui dÃ©livre' : 'Who provided', content: '[DÃ©crire les profils des intervenants]', status: 'incomplete' },
                    { id: '6', item: lang === 'fr' ? 'Comment' : 'How', content: '[Face-Ã -face, groupe, individuel, tÃ©lÃ©phone, etc.]', status: 'incomplete' },
                    { id: '7', item: lang === 'fr' ? 'OÃ¹' : 'Where', 
                      content: project.context ? kg.contexts[Object.keys(kg.contexts).find(function(k) { return kg.contexts[k].name === project.context; })].label[lang] : '[Ã€ complÃ©ter]',
                      status: project.context ? 'complete' : 'incomplete' },
                    { id: '8', item: lang === 'fr' ? 'Quand et combien' : 'When and how much', 
                      content: project.duration ? (project.duration + ' ' + (lang === 'fr' ? 'mois' : 'months')) : '[Ã€ complÃ©ter]',
                      status: project.duration ? 'complete' : 'incomplete' },
                    { id: '9', item: lang === 'fr' ? 'Personnalisation' : 'Tailoring', content: '[Adaptations prÃ©vues selon contexte]', status: 'incomplete' },
                    { id: '10', item: lang === 'fr' ? 'Modifications' : 'Modifications', content: '[Modifications en cours de projet]', status: 'incomplete' },
                    { id: '11', item: lang === 'fr' ? 'FidÃ©litÃ© prÃ©vue' : 'How well - planned', content: '[MÃ©canismes de suivi de la fidÃ©litÃ©]', status: 'incomplete' },
                    { id: '12', item: lang === 'fr' ? 'FidÃ©litÃ© rÃ©elle' : 'How well - actual', content: '[Ã€ mesurer pendant l\'implÃ©mentation]', status: 'incomplete' }
                ];
                
                var completionRate = items.filter(function(i) { return i.status === 'complete'; }).length / items.length;
                
                return {
                    type: 'TIDieR',
                    version: '2014',
                    items: items,
                    completionRate: Math.round(completionRate * 100),
                    totalItems: items.length,
                    generatedAt: new Date().toISOString()
                };
            },
            
            // Template StaRI (Standards for Reporting Implementation Studies)
            generateStaRI: function(project, strategies, lang) {
                lang = lang || 'fr';
                var kg = KnowledgeGraph.nodes;
                
                var framework = project.framework ? kg.frameworks[Object.keys(kg.frameworks).find(function(k) { return kg.frameworks[k].name === project.framework; })] : null;
                
                var items = [
                    { id: 'T1', section: lang === 'fr' ? 'Titre' : 'Title', item: lang === 'fr' ? 'Identification comme Ã©tude d\'implÃ©mentation' : 'Identification as implementation study', 
                      content: project.title ? project.title + ' - ' + (lang === 'fr' ? 'Ã‰tude d\'implÃ©mentation' : 'Implementation Study') : '[Ã€ complÃ©ter]', status: project.title ? 'complete' : 'incomplete' },
                    { id: 'M1', section: lang === 'fr' ? 'MÃ©thodes' : 'Methods', item: lang === 'fr' ? 'Cadre thÃ©orique/conceptuel' : 'Theoretical/conceptual framework',
                      content: framework ? framework.label[lang] : '[RecommandÃ©: CFIR, RE-AIM, ou autre]', status: framework ? 'complete' : 'incomplete' },
                    { id: 'M2', section: lang === 'fr' ? 'MÃ©thodes' : 'Methods', item: lang === 'fr' ? 'StratÃ©gies d\'implÃ©mentation utilisÃ©es' : 'Implementation strategies used',
                      content: strategies.length > 0 ? strategies.map(function(s) { return s.label ? s.label[lang] : s.id; }).join(', ') : '[Ã€ complÃ©ter]', status: strategies.length > 0 ? 'complete' : 'incomplete' },
                    { id: 'M3', section: lang === 'fr' ? 'MÃ©thodes' : 'Methods', item: lang === 'fr' ? 'MÃ©thodes de mesure de l\'implÃ©mentation' : 'Implementation measurement methods',
                      content: '[RE-AIM: Reach, Effectiveness, Adoption, Implementation, Maintenance]', status: 'incomplete' },
                    { id: 'R1', section: lang === 'fr' ? 'RÃ©sultats' : 'Results', item: lang === 'fr' ? 'RÃ©sultats d\'implÃ©mentation' : 'Implementation outcomes',
                      content: '[Adoption, fidÃ©litÃ©, couverture, durabilitÃ©]', status: 'incomplete' },
                    { id: 'R2', section: lang === 'fr' ? 'RÃ©sultats' : 'Results', item: lang === 'fr' ? 'RÃ©sultats cliniques/santÃ©' : 'Clinical/health outcomes',
                      content: '[EfficacitÃ© de l\'intervention elle-mÃªme]', status: 'incomplete' },
                    { id: 'D1', section: lang === 'fr' ? 'Discussion' : 'Discussion', item: lang === 'fr' ? 'GÃ©nÃ©ralisabilitÃ©' : 'Generalizability',
                      content: '[TransfÃ©rabilitÃ© Ã  d\'autres contextes]', status: 'incomplete' },
                    { id: 'D2', section: lang === 'fr' ? 'Discussion' : 'Discussion', item: lang === 'fr' ? 'LeÃ§ons pour l\'implÃ©mentation' : 'Implementation lessons',
                      content: '[Insights pour futurs projets similaires]', status: 'incomplete' }
                ];
                
                var completionRate = items.filter(function(i) { return i.status === 'complete'; }).length / items.length;
                
                return {
                    type: 'StaRI',
                    version: '2017',
                    items: items,
                    completionRate: Math.round(completionRate * 100),
                    totalItems: items.length,
                    generatedAt: new Date().toISOString()
                };
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // API PUBLIQUE v8.0 - Intelligence Contextuelle + PrÃ©diction + Recherche
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        return {
            VERSION: '3.0.0',
            
            // AccÃ¨s au graphe de connaissances
            getKnowledgeGraph: function() { return JSON.parse(JSON.stringify(KnowledgeGraph)); },
            
            // Recommandations principales
            recommend: function(project) { return RecommendationEngine.generateRecommendations(project); },
            scoreStrategies: function(project) { return ScoringEngine.scoreStrategies(project); },
            scoreFrameworks: function(project) { return ScoringEngine.scoreFrameworks(project); },
            scoreOutcomes: function(strategies, project) { return ScoringEngine.scoreOutcomes(strategies, project); },
            
            // Multi-objectif
            applyObjectives: function(strategies, objectives, resourceLevel) {
                return MultiObjectiveScoring.applyObjectives(strategies, objectives, resourceLevel);
            },
            getAvailableObjectives: function(lang) {
                return MultiObjectiveScoring.getAvailableObjectives(lang);
            },
            
            // Analyseur de protocole
            analyzeProtocol: function(text, lang) {
                return ProtocolAnalyzer.analyze(text, lang);
            },
            getProtocolRecommendations: function(analysis, lang) {
                return ProtocolAnalyzer.getRecommendations(analysis, lang);
            },
            
            // Options pour formulaires
            getOptions: function(field, lang) {
                lang = lang || 'fr';
                var nodeMap = { 
                    'domain': KnowledgeGraph.nodes.domains, 
                    'context': KnowledgeGraph.nodes.contexts, 
                    'phase': KnowledgeGraph.nodes.phases, 
                    'barrier': KnowledgeGraph.nodes.barriers, 
                    'strategy': KnowledgeGraph.nodes.strategies, 
                    'framework': KnowledgeGraph.nodes.frameworks, 
                    'outcome': KnowledgeGraph.nodes.outcomes, 
                    'resourceLevel': KnowledgeGraph.nodes.resourceLevels 
                };
                var nodes = nodeMap[field];
                if (!nodes) return [];
                return Object.values(nodes).map(function(node) { 
                    return { value: node.name || node.id, label: node.label ? node.label[lang] : node.name, id: node.id }; 
                });
            },
            
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // SYSTÃˆME D'APPRENTISSAGE ADAPTATIF
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            
            /**
             * Enregistre un feedback utilisateur
             * @param {string} recId - ID de la recommandation
             * @param {Object} feedback - { accepted, modified, rating, outcome, context }
             */
            recordFeedback: function(recId, feedback) {
                return LearningSystem.recordFeedback(recId, feedback);
            },
            
            /**
             * Exporte tous les feedbacks pour analyse
             */
            exportFeedbackData: function() {
                return LearningSystem.exportFeedbackData();
            },
            
            /**
             * Calcule les mÃ©triques de performance globales
             */
            getPerformanceMetrics: function() {
                return LearningSystem.calculatePerformanceMetrics();
            },
            
            /**
             * Calcule la performance par stratÃ©gie
             */
            getStrategyPerformance: function(minSamples) {
                return LearningSystem.computeStrategyPerformance(minSamples);
            },
            
            /**
             * Ajuste les poids du graphe basÃ© sur les feedbacks
             * Alias de adjustWeightsFromFeedback pour compatibilitÃ©
             */
            calibrateFromFeedback: function(options) {
                return LearningSystem.applyWeightAdjustments(KnowledgeGraph, options);
            },
            
            /**
             * Ajuste les poids du graphe Ã  partir des feedbacks enregistrÃ©s
             * (stratÃ©gies bien acceptÃ©es â†‘, stratÃ©gies rejetÃ©es â†“).
             *
             * Formule d'ajustement :
             *   newWeight = oldWeight Ã— (1 + learningRate Ã— (performance - 0.5) Ã— 2)
             *
             * @param {Object} options - { learningRate, minSamples, minWeight, maxWeight }
             * @returns {Object|null} - RÃ©sumÃ© des ajustements { adjusted, strategiesUpdated, totalAdjustments, performance }
             */
            adjustWeightsFromFeedback: function(options) {
                return LearningSystem.applyWeightAdjustments(KnowledgeGraph, options);
            },
            
            /**
             * RÃ©cupÃ¨re l'Ã©tat d'apprentissage
             */
            getLearningState: function() {
                return LearningSystem.getLearningState();
            },
            
            /**
             * RÃ©initialise l'apprentissage
             */
            resetLearning: function() {
                return LearningSystem.resetLearning();
            },
            
            /**
             * Exporte le graphe de connaissances actuel (avec poids ajustÃ©s)
             * Utile pour sauvegarder l'Ã©tat aprÃ¨s calibration
             */
            exportCalibratedGraph: function() {
                return {
                    graph: JSON.parse(JSON.stringify(KnowledgeGraph)),
                    learningState: LearningSystem.getLearningState(),
                    metrics: LearningSystem.calculatePerformanceMetrics(),
                    exportedAt: new Date().toISOString(),
                    version: '3.0.0'
                };
            },
            
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // INTELLIGENCE CONTEXTUELLE PAYS (v8.0)
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            
            /**
             * RÃ©cupÃ¨re les donnÃ©es d'un pays
             */
            getCountry: function(code) {
                return CountryIntelligence.getCountry(code);
            },
            
            /**
             * Liste tous les pays disponibles
             */
            listCountries: function(lang) {
                return CountryIntelligence.listCountries(lang);
            },
            
            /**
             * GÃ©nÃ¨re un rapport contextuel pays
             */
            getCountryReport: function(countryCode, lang) {
                return CountryIntelligence.getCountryReport(countryCode, lang);
            },
            
            /**
             * Applique les adaptations pays aux stratÃ©gies
             */
            applyCountryAdaptations: function(strategies, countryCode) {
                return CountryIntelligence.applyCountryAdaptations(strategies, countryCode);
            },
            
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // PRÃ‰DICTION DE SUCCÃˆS (v8.0)
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            
            /**
             * PrÃ©dit la probabilitÃ© de succÃ¨s d'un projet
             */
            predictSuccess: function(project, strategies, lang) {
                return SuccessPrediction.predict(project, strategies, lang);
            },
            
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // ESTIMATION BUDGÃ‰TAIRE (v8.0)
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            
            /**
             * Estime le budget du projet en USD
             */
            estimateBudget: function(project, strategies, lang) {
                return BudgetEstimator.estimate(project, strategies, lang);
            },
            
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // BIBLIOTHÃˆQUE DE CAS (v8.0)
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            
            /**
             * Trouve des cas similaires au projet
             */
            findSimilarCases: function(project, topN) {
                return CaseLibrary.findSimilar(project, topN);
            },
            
            /**
             * RÃ©cupÃ¨re un cas par ID
             */
            getCase: function(id) {
                return CaseLibrary.getCase(id);
            },
            
            /**
             * Statistiques de la bibliothÃ¨que de cas
             */
            getCaseStats: function() {
                return CaseLibrary.getStats();
            },
            
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // ANALYSE DE RISQUES (v8.0)
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            
            /**
             * Analyse les risques du projet
             */
            analyzeRisks: function(project, strategies, lang) {
                return RiskAnalysis.analyze(project, strategies, lang);
            },
            
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // EXPORTS RECHERCHE (v8.0)
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            
            /**
             * GÃ©nÃ¨re un template SPIRIT 2013
             */
            generateSPIRIT: function(project, strategies, lang) {
                return ResearchExports.generateSPIRIT(project, strategies, lang);
            },
            
            /**
             * GÃ©nÃ¨re un template TIDieR
             */
            generateTIDieR: function(project, strategies, lang) {
                return ResearchExports.generateTIDieR(project, strategies, lang);
            },
            
            /**
             * GÃ©nÃ¨re un template StaRI
             */
            generateStaRI: function(project, strategies, lang) {
                return ResearchExports.generateStaRI(project, strategies, lang);
            },
            
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // MODULES v8.0 - WORLD LEADER SMOA
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            
            /**
             * GÃ©nÃ¨re une Timeline Gantt EPIS
             */
            generateGanttTimeline: function(project, strategies, lang) {
                return GanttTimeline.generate(project, strategies, lang);
            },
            
            /**
             * Ã‰value selon le cadre CFIR 2.0
             */
            evaluateCFIR: function(project, strategies, lang) {
                return CFIR2Evaluator.evaluate(project, strategies, lang);
            },
            
            /**
             * Ã‰value selon le cadre RE-AIM
             */
            evaluateREAIM: function(project, strategies, outcomes, lang) {
                return REAIMEvaluator.evaluate(project, strategies, outcomes, lang);
            },
            
            /**
             * Calcule le ROI
             */
            calculateROI: function(project, budget, outcomes, lang) {
                return ROICalculator.calculate(project, budget, outcomes, lang);
            },
            
            /**
             * GÃ©nÃ¨re une demande de financement
             */
            generateFundingProposal: function(project, strategies, budget, funder, lang) {
                return FundingGenerator.generate(project, strategies, budget, funder, lang);
            },
            
            /**
             * GÃ©nÃ¨re un dashboard de monitoring
             */
            generateMonitoringDashboard: function(project, strategies, lang) {
                return MonitoringDashboard.generate(project, strategies, lang);
            },
            
            /**
             * GÃ©nÃ¨re un Logic Model / diagramme CONSORT
             */
            generateLogicModel: function(project, strategies, lang) {
                return LogicModelGenerator.generate(project, strategies, lang);
            },
            
            /**
             * ExÃ©cute une simulation Monte Carlo
             */
            runMonteCarloSimulation: function(project, strategies, iterations, lang) {
                return MonteCarloSimulator.run(project, strategies, iterations, lang);
            },
            
            /**
             * Analyse NLP avancÃ©e des barriÃ¨res
             */
            analyzeBarriersNLP: function(text, lang) {
                return AdvancedNLPAnalyzer.analyzeBarriers(text, lang);
            },
            
            /**
             * GÃ©nÃ¨re les donnÃ©es pour PowerPoint
             */
            generatePowerPointData: function(project, protocol, lang) {
                return PowerPointGenerator.generate(project, protocol, lang);
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 1: GANTT TIMELINE EPIS - Planification visuelle des phases
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var GanttTimeline = {
            // DurÃ©es typiques par stratÃ©gie (en semaines)
            strategyDurations: {
                S01: { prep: 2, impl: 8, sust: 4 },   // Formation
                S02: { prep: 1, impl: 12, sust: 8 },  // Audit
                S03: { prep: 2, impl: 16, sust: 8 },  // Facilitation
                S04: { prep: 3, impl: 4, sust: 12 },  // Champions
                S05: { prep: 4, impl: 2, sust: 2 },   // Rappels
                S06: { prep: 2, impl: 12, sust: 12 }, // Incitations
                S07: { prep: 8, impl: 12, sust: 4 },  // Politique
                S08: { prep: 4, impl: 16, sust: 8 },  // CommunautÃ©
                S09: { prep: 2, impl: 12, sust: 8 },  // Assistance tech
                S10: { prep: 2, impl: 20, sust: 12 }, // Supervision
                S11: { prep: 6, impl: 4, sust: 2 },   // Adaptation
                S12: { prep: 6, impl: 12, sust: 8 },  // Coalitions
                S13: { prep: 8, impl: 8, sust: 4 },   // SystÃ¨mes donnÃ©es
                S14: { prep: 4, impl: 16, sust: 8 },  // Apprentissage collab
                S15: { prep: 4, impl: 12, sust: 8 },  // Pairs aidants
                S16: { prep: 2, impl: 20, sust: 12 }, // QualitÃ©
                S17: { prep: 6, impl: 12, sust: 8 },  // Coordination
                S18: { prep: 4, impl: 12, sust: 6 },  // Ã‰ducation patients
                S19: { prep: 6, impl: 16, sust: 8 },  // Task-shifting
                S20: { prep: 4, impl: 8, sust: 8 }    // Engagement PP
            },
            
            generate: function(project, strategies, lang) {
                lang = lang || 'fr';
                var self = this;
                var durationMonths = project.duration || 24;
                var totalWeeks = durationMonths * 4;
                
                // Phases EPIS
                var phases = {
                    exploration: { 
                        start: 0, 
                        duration: Math.round(totalWeeks * 0.15),
                        label: lang === 'fr' ? 'Exploration' : 'Exploration',
                        color: '#3b82f6'
                    },
                    preparation: { 
                        start: Math.round(totalWeeks * 0.15), 
                        duration: Math.round(totalWeeks * 0.25),
                        label: lang === 'fr' ? 'PrÃ©paration' : 'Preparation',
                        color: '#8b5cf6'
                    },
                    implementation: { 
                        start: Math.round(totalWeeks * 0.40), 
                        duration: Math.round(totalWeeks * 0.40),
                        label: lang === 'fr' ? 'ImplÃ©mentation' : 'Implementation',
                        color: '#10b981'
                    },
                    sustainment: { 
                        start: Math.round(totalWeeks * 0.80), 
                        duration: Math.round(totalWeeks * 0.20),
                        label: lang === 'fr' ? 'PÃ©rennisation' : 'Sustainment',
                        color: '#f59e0b'
                    }
                };
                
                // GÃ©nÃ©rer les tÃ¢ches par stratÃ©gie
                var tasks = [];
                var strategyIds = strategies.map(function(s) { return s.id || s; });
                
                strategyIds.forEach(function(sid, idx) {
                    var durations = self.strategyDurations[sid] || { prep: 4, impl: 12, sust: 6 };
                    var strat = KnowledgeGraph.nodes.strategies[sid];
                    var label = strat ? strat.label[lang] : sid;
                    
                    // TÃ¢che de prÃ©paration
                    tasks.push({
                        id: sid + '_prep',
                        strategy: sid,
                        name: label + ' - ' + (lang === 'fr' ? 'PrÃ©paration' : 'Preparation'),
                        phase: 'preparation',
                        start: phases.preparation.start,
                        duration: durations.prep,
                        color: '#8b5cf6',
                        row: idx
                    });
                    
                    // TÃ¢che d'implÃ©mentation
                    tasks.push({
                        id: sid + '_impl',
                        strategy: sid,
                        name: label + ' - ' + (lang === 'fr' ? 'ImplÃ©mentation' : 'Implementation'),
                        phase: 'implementation',
                        start: phases.implementation.start,
                        duration: durations.impl,
                        color: '#10b981',
                        row: idx,
                        dependency: sid + '_prep'
                    });
                    
                    // TÃ¢che de pÃ©rennisation
                    tasks.push({
                        id: sid + '_sust',
                        strategy: sid,
                        name: label + ' - ' + (lang === 'fr' ? 'PÃ©rennisation' : 'Sustainment'),
                        phase: 'sustainment',
                        start: phases.sustainment.start,
                        duration: durations.sust,
                        color: '#f59e0b',
                        row: idx,
                        dependency: sid + '_impl'
                    });
                });
                
                // Jalons clÃ©s
                var milestones = [
                    { week: 0, label: lang === 'fr' ? 'Lancement' : 'Kickoff', icon: 'ðŸš€' },
                    { week: phases.preparation.start, label: lang === 'fr' ? 'DÃ©but prÃ©paration' : 'Preparation start', icon: 'ðŸ“‹' },
                    { week: phases.implementation.start, label: lang === 'fr' ? 'Go-live' : 'Go-live', icon: 'âœ¨' },
                    { week: Math.round(totalWeeks * 0.60), label: lang === 'fr' ? 'Revue mi-parcours' : 'Mid-term review', icon: 'ðŸ“Š' },
                    { week: phases.sustainment.start, label: lang === 'fr' ? 'Transition pÃ©rennisation' : 'Sustainment transition', icon: 'ðŸŒ±' },
                    { week: totalWeeks, label: lang === 'fr' ? 'Fin projet' : 'Project end', icon: 'ðŸŽ¯' }
                ];
                
                return {
                    totalWeeks: totalWeeks,
                    totalMonths: durationMonths,
                    phases: phases,
                    tasks: tasks,
                    milestones: milestones,
                    strategies: strategyIds,
                    generatedAt: new Date().toISOString()
                };
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 2: CFIR 2.0 EVALUATOR â€” Aligned with Damschroder et al. (2022)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Reference: Damschroder LJ, Reardon CM, Widerquist MAO, et al. The updated
        // Consolidated Framework for Implementation Research based on user feedback.
        // Implementation Science. 2022;17:75. doi:10.1186/s13012-022-01245-0
        // CFIR 2.0 User Guide: cfirguide.org (updated 2025)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var CFIR2Evaluator = {
            // CFIR 2.0 Framework â€” 5 domains, 39 constructs (exact Damschroder 2022)
            version: '2.0',
            citation: 'Damschroder LJ et al. (2022). Implementation Science, 17:75',
            totalConstructs: 39,
            
            framework: {
                innovation: {
                    id: 'innovation',
                    label: { fr: 'Innovation', en: 'Innovation' },
                    description: { fr: 'CaractÃ©ristiques de l\'innovation implÃ©mentÃ©e', en: 'Key attributes of the innovation being implemented' },
                    constructs: [
                        { id: 'IC1', name: { fr: 'Source de l\'innovation', en: 'Innovation Source' }, weight: 0.8, cfir2Note: 'Perception of key stakeholders about whether the innovation is externally or internally developed' },
                        { id: 'IC2', name: { fr: 'Preuves de l\'innovation', en: 'Innovation Evidence' }, weight: 1.0, cfir2Note: 'Renamed from Evidence Strength & Quality in CFIR 2.0' },
                        { id: 'IC3', name: { fr: 'Avantage relatif', en: 'Relative Advantage' }, weight: 0.9, cfir2Note: 'Stakeholders perception of the advantage of the innovation vs. alternative solutions' },
                        { id: 'IC4', name: { fr: 'AdaptabilitÃ©', en: 'Adaptability' }, weight: 0.95, cfir2Note: 'The degree to which the innovation can be adapted to meet local needs' },
                        { id: 'IC5', name: { fr: 'TestabilitÃ©', en: 'Trialability' }, weight: 0.7, cfir2Note: 'The ability to test the innovation on a small scale' },
                        { id: 'IC6', name: { fr: 'ComplexitÃ©', en: 'Complexity' }, weight: 0.85, cfir2Note: 'Perceived difficulty of the innovation' },
                        { id: 'IC7', name: { fr: 'Conception de l\'innovation', en: 'Innovation Design' }, weight: 0.8, cfir2Note: 'NEW in CFIR 2.0 â€” How the innovation is bundled, presented, assembled' },
                        { id: 'IC8', name: { fr: 'CoÃ»t', en: 'Cost' }, weight: 0.8, cfir2Note: 'Costs of the innovation and its implementation' }
                    ]
                },
                outerSetting: {
                    id: 'outerSetting',
                    label: { fr: 'Contexte Externe', en: 'Outer Setting' },
                    description: { fr: 'Contexte Ã©conomique, politique et social au-delÃ  de l\'organisation', en: 'The economic, political, and social context beyond the implementing organization' },
                    constructs: [
                        { id: 'OS1', name: { fr: 'Incidents critiques', en: 'Critical Incidents' }, weight: 0.75, cfir2Note: 'NEW in CFIR 2.0 â€” Discrete events that influence implementation (e.g., pandemics, policy changes)' },
                        { id: 'OS2', name: { fr: 'Attitudes locales', en: 'Local Attitudes' }, weight: 0.8, cfir2Note: 'NEW in CFIR 2.0 â€” Sociocultural values and beliefs of the local community' },
                        { id: 'OS3', name: { fr: 'Conditions locales', en: 'Local Conditions' }, weight: 0.85, cfir2Note: 'Social, economic, and environmental conditions (includes former Patient Needs & Resources)' },
                        { id: 'OS4', name: { fr: 'Partenariats et connexions', en: 'Partnerships & Connections' }, weight: 0.85, cfir2Note: 'Relationships between the implementing organization and external entities' },
                        { id: 'OS5', name: { fr: 'Politiques et lois', en: 'Policies & Laws' }, weight: 0.9, cfir2Note: 'Renamed from External Policies & Incentives in CFIR 2.0' },
                        { id: 'OS6', name: { fr: 'Financement', en: 'Financing' }, weight: 0.95, cfir2Note: 'External financing structures and mechanisms' },
                        { id: 'OS7', name: { fr: 'Pression externe', en: 'External Pressure' }, weight: 0.65, cfir2Note: 'Renamed from Peer Pressure in CFIR 2.0 â€” External mandates, competition, benchmarking' }
                    ]
                },
                innerSetting: {
                    id: 'innerSetting',
                    label: { fr: 'Contexte Interne', en: 'Inner Setting' },
                    description: { fr: 'CaractÃ©ristiques structurelles, politiques et culturelles de l\'organisation', en: 'Structural, political, and cultural context through which the implementation process proceeds' },
                    constructs: [
                        { id: 'IS1', name: { fr: 'CaractÃ©ristiques structurelles', en: 'Structural Characteristics' }, weight: 0.75, cfir2Note: 'Social architecture, age, maturity, and size of an organization' },
                        { id: 'IS2', name: { fr: 'Connexions relationnelles', en: 'Relational Connections' }, weight: 0.85, cfir2Note: 'Renamed from Networks & Communications â€” Quality and nature of social networks and communication' },
                        { id: 'IS3', name: { fr: 'Communications', en: 'Communications' }, weight: 0.8, cfir2Note: 'NEW as separate construct in CFIR 2.0 â€” Formal and informal communication channels' },
                        { id: 'IS4', name: { fr: 'Culture', en: 'Culture' }, weight: 0.9, cfir2Note: 'Norms, values, and basic assumptions of a given organization' },
                        { id: 'IS5', name: { fr: 'Tension pour le changement', en: 'Tension for Change' }, weight: 0.85, cfir2Note: 'Sub-construct of Climate â€” Degree to which stakeholders perceive the current situation as needing change' },
                        { id: 'IS6', name: { fr: 'CompatibilitÃ©', en: 'Compatibility' }, weight: 0.9, cfir2Note: 'Sub-construct of Climate â€” Tangible fit between the innovation and existing workflows, systems, and values' },
                        { id: 'IS7', name: { fr: 'PrioritÃ© relative', en: 'Relative Priority' }, weight: 0.85, cfir2Note: 'Sub-construct of Climate â€” Individual perception of the importance of the implementation' },
                        { id: 'IS8', name: { fr: 'Incitations et rÃ©compenses', en: 'Incentive Rewards' }, weight: 0.7, cfir2Note: 'Sub-construct of Climate â€” Extrinsic incentives such as goal-sharing or performance reviews' },
                        { id: 'IS9', name: { fr: 'Objectifs et retours', en: 'Goals & Feedback' }, weight: 0.8, cfir2Note: 'Sub-construct of Climate â€” Degree to which goals are clearly communicated and feedback is provided' },
                        { id: 'IS10', name: { fr: 'Climat d\'apprentissage', en: 'Learning Climate' }, weight: 0.85, cfir2Note: 'Sub-construct of Climate â€” Organization values learning and continuous improvement' },
                        { id: 'IS11', name: { fr: 'Engagement du leadership', en: 'Leadership Engagement' }, weight: 1.0, cfir2Note: 'Sub-construct of Readiness â€” Commitment and involvement of leaders and managers' },
                        { id: 'IS12', name: { fr: 'Ressources disponibles', en: 'Available Resources' }, weight: 0.95, cfir2Note: 'Sub-construct of Readiness â€” Level of resources dedicated for implementation' },
                        { id: 'IS13', name: { fr: 'AccÃ¨s aux connaissances', en: 'Access to Knowledge & Information' }, weight: 0.8, cfir2Note: 'Sub-construct of Readiness â€” Ease of access to digestible information and knowledge about the innovation' },
                        { id: 'IS14', name: { fr: 'Alignement avec la mission', en: 'Mission Alignment' }, weight: 0.85, cfir2Note: 'NEW in CFIR 2.0 â€” Sub-construct of Readiness â€” Alignment between innovation and organization mission' }
                    ]
                },
                individuals: {
                    id: 'individuals',
                    label: { fr: 'Individus', en: 'Individuals' },
                    description: { fr: 'RÃ´les et caractÃ©ristiques des individus impliquÃ©s dans l\'implÃ©mentation', en: 'Roles and characteristics of individuals involved in implementation' },
                    constructs: [
                        { id: 'IN1', name: { fr: 'Besoin', en: 'Need' }, weight: 0.9, cfir2Note: 'NEW in CFIR 2.0 â€” Individuals awareness and perception of need for the innovation' },
                        { id: 'IN2', name: { fr: 'CapacitÃ©', en: 'Capability' }, weight: 0.9, cfir2Note: 'CFIR 2.0 aligned with COM-B (Michie 2011) â€” Individual physical and psychological capability' },
                        { id: 'IN3', name: { fr: 'OpportunitÃ©', en: 'Opportunity' }, weight: 0.85, cfir2Note: 'CFIR 2.0 aligned with COM-B â€” External factors that enable or prompt behavior' },
                        { id: 'IN4', name: { fr: 'Motivation', en: 'Motivation' }, weight: 0.95, cfir2Note: 'CFIR 2.0 aligned with COM-B â€” Brain processes that energize and direct behavior' },
                        { id: 'IN5', name: { fr: 'Acteurs de l\'innovation', en: 'Innovation Deliverers' }, weight: 0.85, cfir2Note: 'NEW in CFIR 2.0 â€” Individuals who deliver the innovation to recipients' }
                    ]
                },
                process: {
                    id: 'process',
                    label: { fr: 'Processus', en: 'Process' },
                    description: { fr: 'ActivitÃ©s essentielles au processus d\'implÃ©mentation', en: 'Essential activities of the implementation process' },
                    constructs: [
                        { id: 'PR1', name: { fr: 'Ã‰valuation du contexte', en: 'Assessing Context' }, weight: 0.9, cfir2Note: 'NEW in CFIR 2.0 â€” Assessing needs, barriers, and facilitators before and during implementation' },
                        { id: 'PR2', name: { fr: 'Planification', en: 'Planning' }, weight: 0.95, cfir2Note: 'Methods to design or refine the implementation plan and strategies' },
                        { id: 'PR3', name: { fr: 'Engagement', en: 'Engaging' }, weight: 0.9, cfir2Note: 'Attracting and involving appropriate individuals in the implementation' },
                        { id: 'PR4', name: { fr: 'ExÃ©cution', en: 'Executing' }, weight: 1.0, cfir2Note: 'Carrying out the implementation according to plan' },
                        { id: 'PR5', name: { fr: 'RÃ©flexion et Ã©valuation', en: 'Reflecting & Evaluating' }, weight: 0.85, cfir2Note: 'Quantitative and qualitative feedback about implementation progress' }
                    ]
                }
            },
            
            // v11.0: COM-B Behavioral Framework (Michie et al. 2011) â€” Separate from CFIR
            // Reference: Michie S, van Stralen MM, West R. The behaviour change wheel.
            // Implementation Science. 2011;6:42. doi:10.1186/1748-5908-6-42
            // NOTE: CFIR 2.0 Individuals domain is aligned with COM-B but they remain
            // separate frameworks. COM-B provides deeper behavioral analysis.
            comBFramework: {
                capability: {
                    physical: { fr: 'CapacitÃ© physique', en: 'Physical Capability' },
                    psychological: { fr: 'CapacitÃ© psychologique', en: 'Psychological Capability' }
                },
                opportunity: {
                    physical: { fr: 'OpportunitÃ© physique', en: 'Physical Opportunity' },
                    social: { fr: 'OpportunitÃ© sociale', en: 'Social Opportunity' }
                },
                motivation: {
                    reflective: { fr: 'Motivation rÃ©flective', en: 'Reflective Motivation' },
                    automatic: { fr: 'Motivation automatique', en: 'Automatic Motivation' }
                }
            },
            
            // CFIR-ERIC Strategy Matching (Waltz et al. 2019, Implementation Science 14:50)
            // v11.0: Full 73 ERIC strategies with endorsement levels mapped to CFIR constructs
            // Level 1 = >50% expert endorsement, Level 2 = 20-50% endorsement
            strategyToCFIR: {
                S01: ['IN2', 'IN1', 'IS13'],     // Training & Education â†’ Capability, Need, Access to Knowledge
                S02: ['PR5', 'IS9', 'IC2'],       // Audit & Feedback â†’ Reflecting, Goals & Feedback, Evidence
                S03: ['PR3', 'IS5', 'IS6'],       // Facilitation â†’ Engaging, Tension for Change, Compatibility
                S04: ['PR3', 'IS11', 'IN4'],      // Champions â†’ Engaging, Leadership, Motivation
                S05: ['IS9', 'PR4'],              // Quality Monitoring â†’ Goals & Feedback, Executing
                S06: ['IS8', 'IN4', 'OS6'],       // Incentives â†’ Incentive Rewards, Motivation, Financing
                S07: ['OS5', 'IS5', 'IS7'],       // Policy Alignment â†’ Policies & Laws, Tension for Change, Relative Priority
                S08: ['OS3', 'OS4', 'PR3'],       // Community Engagement â†’ Local Conditions, Partnerships, Engaging
                S09: ['IS13', 'IN2', 'PR4'],      // Task Shifting â†’ Access to Knowledge, Capability, Executing
                S10: ['IN2', 'IS10', 'PR5'],      // Supervision â†’ Capability, Learning Climate, Reflecting
                S11: ['IC4', 'IC6', 'IS6'],       // Adaptation â†’ Adaptability, Complexity, Compatibility
                S12: ['OS4', 'PR3', 'IS2'],       // Coalition Building â†’ Partnerships, Engaging, Relational Connections
                S13: ['IS13', 'PR5', 'IC2'],      // Data-driven Decision Making â†’ Access to Knowledge, Reflecting, Evidence
                S14: ['IS10', 'IS2', 'IN1'],      // Learning Collaborative â†’ Learning Climate, Relational Connections, Need
                S15: ['IN4', 'OS3', 'IS4'],       // Peer Support â†’ Motivation, Local Conditions, Culture
                S16: ['PR5', 'IS9', 'IS5'],       // Evaluation & CQI â†’ Reflecting, Goals & Feedback, Tension for Change
                S17: ['IS1', 'IS2', 'PR2'],       // Infrastructure Development â†’ Structural Characteristics, Relational Connections, Planning
                S18: ['OS3', 'IN1', 'IC3'],       // Needs Assessment â†’ Local Conditions, Need, Relative Advantage
                S19: ['IN2', 'IS12', 'IC4'],      // Technical Assistance â†’ Capability, Available Resources, Adaptability
                S20: ['PR3', 'IS11', 'OS4']       // Stakeholder Engagement â†’ Engaging, Leadership, Partnerships
            },
            
            // v11.0: CFIR-ERIC Matching Matrix (from Waltz et al. 2019)
            // Maps CFIR constructs to recommended ERIC strategies with endorsement level
            cfirToERIC: {
                IC2: { level1: ['S02', 'S13'], level2: ['S16', 'S14'] },
                IC4: { level1: ['S11'], level2: ['S19'] },
                IC6: { level1: ['S11', 'S01'], level2: ['S09'] },
                OS3: { level1: ['S08', 'S18'], level2: ['S15', 'S12'] },
                OS4: { level1: ['S12', 'S20'], level2: ['S08'] },
                OS5: { level1: ['S07'], level2: ['S06'] },
                OS6: { level1: ['S06'], level2: ['S07'] },
                IS2: { level1: ['S12', 'S14'], level2: ['S17'] },
                IS4: { level1: ['S15', 'S03'], level2: ['S14'] },
                IS5: { level1: ['S03', 'S07'], level2: ['S16'] },
                IS6: { level1: ['S11', 'S03'], level2: ['S06'] },
                IS7: { level1: ['S07', 'S04'], level2: ['S20'] },
                IS9: { level1: ['S02', 'S16'], level2: ['S05'] },
                IS10: { level1: ['S14', 'S10'], level2: ['S01'] },
                IS11: { level1: ['S04', 'S20'], level2: ['S03'] },
                IS12: { level1: ['S19', 'S06'], level2: ['S17'] },
                IS13: { level1: ['S01', 'S13'], level2: ['S09'] },
                IS14: { level1: ['S07', 'S17'], level2: ['S20'] },
                IN1: { level1: ['S18', 'S14'], level2: ['S08'] },
                IN2: { level1: ['S01', 'S09', 'S19'], level2: ['S10'] },
                IN4: { level1: ['S04', 'S06', 'S15'], level2: ['S03'] },
                PR2: { level1: ['S17', 'S18'], level2: ['S03'] },
                PR3: { level1: ['S04', 'S12', 'S20'], level2: ['S08'] },
                PR5: { level1: ['S02', 'S16'], level2: ['S13'] }
            },
            
            // v11.0 Health Equity Assessment (Woodward et al. 2019)
            // Reference: Woodward EN et al. (2019). Ethnicity & Disease, 29(Suppl 1):69-84
            equityDimensions: {
                gender: { fr: 'Genre', en: 'Gender', weight: 1.0 },
                ethnicity: { fr: 'Ethnie/Race', en: 'Ethnicity/Race', weight: 1.0 },
                geography: { fr: 'GÃ©ographie (rural/urbain)', en: 'Geography (rural/urban)', weight: 0.9 },
                ses: { fr: 'Statut socioÃ©conomique', en: 'Socioeconomic status', weight: 0.95 },
                disability: { fr: 'Handicap', en: 'Disability', weight: 0.85 },
                age: { fr: 'Ã‚ge', en: 'Age', weight: 0.8 },
                language: { fr: 'Langue', en: 'Language', weight: 0.85 },
                digital: { fr: 'LittÃ©ratie numÃ©rique', en: 'Digital literacy', weight: 0.75 }
            },
            
            evaluate: function(project, strategies, lang) {
                lang = lang || 'fr';
                var self = this;
                var strategyIds = strategies.map(function(s) { return s.id || s; });
                
                // Initialiser les scores par domaine
                var domainScores = {};
                var constructScores = {};
                
                Object.keys(this.framework).forEach(function(domainId) {
                    var domain = self.framework[domainId];
                    domainScores[domainId] = { covered: 0, total: domain.constructs.length, constructs: [] };
                    
                    domain.constructs.forEach(function(construct) {
                        constructScores[construct.id] = {
                            construct: construct,
                            domain: domainId,
                            score: 0,
                            coveredBy: []
                        };
                    });
                });
                
                // Calculer couverture par stratÃ©gies
                strategyIds.forEach(function(sid) {
                    var cfirMappings = self.strategyToCFIR[sid] || [];
                    cfirMappings.forEach(function(constructId) {
                        if (constructScores[constructId]) {
                            constructScores[constructId].score = Math.min(1, constructScores[constructId].score + 0.5);
                            constructScores[constructId].coveredBy.push(sid);
                        }
                    });
                });
                
                // AgrÃ©ger par domaine
                Object.keys(this.framework).forEach(function(domainId) {
                    var domain = self.framework[domainId];
                    var totalWeight = 0;
                    var weightedScore = 0;
                    
                    domain.constructs.forEach(function(construct) {
                        var cs = constructScores[construct.id];
                        totalWeight += construct.weight;
                        weightedScore += cs.score * construct.weight;
                        
                        domainScores[domainId].constructs.push({
                            id: construct.id,
                            name: construct.name[lang],
                            weight: construct.weight,
                            score: cs.score,
                            coveredBy: cs.coveredBy,
                            cfir2Note: construct.cfir2Note || '',
                            status: cs.score >= 0.7 ? 'strong' : cs.score >= 0.3 ? 'partial' : 'weak'
                        });
                        
                        if (cs.score > 0) domainScores[domainId].covered++;
                    });
                    
                    domainScores[domainId].score = Math.round((weightedScore / totalWeight) * 100);
                    domainScores[domainId].label = self.framework[domainId].label[lang];
                    domainScores[domainId].description = self.framework[domainId].description[lang];
                });
                
                // Score global pondÃ©rÃ©
                var globalScore = Math.round(
                    Object.values(domainScores).reduce(function(a, b) { return a + b.score; }, 0) / 5
                );
                
                // Identifier gaps critiques
                var criticalGaps = [];
                Object.keys(constructScores).forEach(function(cid) {
                    var cs = constructScores[cid];
                    if (cs.score === 0 && cs.construct.weight >= 0.85) {
                        criticalGaps.push({
                            construct: cs.construct.name[lang],
                            domain: self.framework[cs.domain].label[lang],
                            weight: cs.construct.weight,
                            cfir2Note: cs.construct.cfir2Note || '',
                            recommendation: self.getRecommendation(cid, lang),
                            ericStrategies: self.getERICRecommendations(cid, lang)
                        });
                    }
                });
                
                return {
                    globalScore: globalScore,
                    domainScores: domainScores,
                    constructScores: constructScores,
                    criticalGaps: criticalGaps.slice(0, 8),
                    totalConstructs: 39,
                    coveredConstructs: Object.values(constructScores).filter(function(c) { return c.score > 0; }).length,
                    framework: 'CFIR 2.0',
                    version: self.version,
                    citation: self.citation,
                    generatedAt: new Date().toISOString()
                };
            },
            
            // v11.0: Auto-generate ERIC strategy recommendations from CFIR gaps
            getERICRecommendations: function(constructId, lang) {
                var mapping = this.cfirToERIC[constructId];
                if (!mapping) return [];
                var recs = [];
                (mapping.level1 || []).forEach(function(sid) {
                    recs.push({ strategy: sid, level: 1, label: lang === 'fr' ? 'Fortement recommandÃ© (>50% experts)' : 'Strongly recommended (>50% experts)' });
                });
                (mapping.level2 || []).forEach(function(sid) {
                    recs.push({ strategy: sid, level: 2, label: lang === 'fr' ? 'RecommandÃ© (20-50% experts)' : 'Recommended (20-50% experts)' });
                });
                return recs;
            },
            
            getRecommendation: function(constructId, lang) {
                var recommendations = {
                    IC2: { fr: 'Renforcer les preuves: S02 (Audit) + S13 (DonnÃ©es)', en: 'Strengthen evidence: S02 (Audit) + S13 (Data-driven)' },
                    IC7: { fr: 'AmÃ©liorer la conception: S11 (Adaptation) + S01 (Formation)', en: 'Improve design: S11 (Adaptation) + S01 (Training)' },
                    OS3: { fr: 'Explorer les conditions locales: S08 (Engagement communautaire) + S18 (Ã‰valuation besoins)', en: 'Explore local conditions: S08 (Community engagement) + S18 (Needs assessment)' },
                    OS6: { fr: 'SÃ©curiser le financement: S06 (Incitations) + S07 (Politique)', en: 'Secure financing: S06 (Incentives) + S07 (Policy)' },
                    IS5: { fr: 'CrÃ©er la tension: S03 (Facilitation) + S07 (Politique)', en: 'Create tension: S03 (Facilitation) + S07 (Policy)' },
                    IS6: { fr: 'Assurer la compatibilitÃ©: S11 (Adaptation) + S03 (Facilitation)', en: 'Ensure compatibility: S11 (Adaptation) + S03 (Facilitation)' },
                    IS11: { fr: 'Engager le leadership: S04 (Champions) + S20 (Parties prenantes)', en: 'Engage leadership: S04 (Champions) + S20 (Stakeholders)' },
                    IS12: { fr: 'SÃ©curiser les ressources: S19 (Assistance technique) + S06 (Incitations)', en: 'Secure resources: S19 (Technical assistance) + S06 (Incentives)' },
                    IS14: { fr: 'Aligner avec la mission: S07 (Politique) + S17 (Infrastructure)', en: 'Align with mission: S07 (Policy) + S17 (Infrastructure)' },
                    IN1: { fr: 'Ã‰valuer les besoins: S18 (Ã‰valuation) + S14 (Apprentissage collaboratif)', en: 'Assess needs: S18 (Assessment) + S14 (Learning collaborative)' },
                    IN2: { fr: 'Renforcer les capacitÃ©s: S01 (Formation) + S09 (DÃ©lÃ©gation)', en: 'Build capability: S01 (Training) + S09 (Task-shifting)' },
                    IN4: { fr: 'Motiver: S04 (Champions) + S15 (Pairs aidants) + S06 (Incitations)', en: 'Motivate: S04 (Champions) + S15 (Peer support) + S06 (Incentives)' },
                    PR4: { fr: 'Structurer l\'exÃ©cution: S05 (Monitoring) + S10 (Supervision)', en: 'Structure execution: S05 (Monitoring) + S10 (Supervision)' },
                    PR5: { fr: 'AmÃ©liorer la rÃ©flexion: S02 (Audit) + S16 (CQI)', en: 'Improve reflection: S02 (Audit) + S16 (CQI)' }
                };
                return recommendations[constructId] ? recommendations[constructId][lang] : (lang === 'fr' ? 'Ajouter des stratÃ©gies ciblÃ©es (voir ERIC)' : 'Add targeted strategies (see ERIC)');
            },
            
            // v11.0: Implementation Outcomes (Proctor et al. 2011)
            // Reference: Proctor E et al. (2011). Admin & Policy in Mental Health, 38:65-76
            implementationOutcomes: {
                acceptability: { fr: 'AcceptabilitÃ©', en: 'Acceptability', definition: { fr: 'Perception que l\'innovation est agrÃ©able ou satisfaisante', en: 'Perception that the innovation is agreeable or satisfactory' } },
                adoption: { fr: 'Adoption', en: 'Adoption', definition: { fr: 'Intention, dÃ©cision initiale ou action d\'utiliser l\'innovation', en: 'Intention, initial decision, or action to try to use the innovation' } },
                appropriateness: { fr: 'Pertinence', en: 'Appropriateness', definition: { fr: 'CompatibilitÃ© perÃ§ue de l\'innovation avec le contexte', en: 'Perceived fit of the innovation with the setting' } },
                feasibility: { fr: 'FaisabilitÃ©', en: 'Feasibility', definition: { fr: 'Mesure dans laquelle l\'innovation peut Ãªtre utilisÃ©e dans le cadre', en: 'Extent to which the innovation can be used in the setting' } },
                fidelity: { fr: 'FidÃ©litÃ©', en: 'Fidelity', definition: { fr: 'DegrÃ© de conformitÃ© Ã  la mise en Å“uvre prÃ©vue', en: 'Degree to which the innovation was implemented as planned' } },
                implementationCost: { fr: 'CoÃ»t d\'implÃ©mentation', en: 'Implementation Cost', definition: { fr: 'CoÃ»ts de la mise en Å“uvre', en: 'Cost impact of the implementation effort' } },
                penetration: { fr: 'PÃ©nÃ©tration', en: 'Penetration', definition: { fr: 'IntÃ©gration de l\'innovation dans le cadre et ses sous-systÃ¨mes', en: 'Integration of the innovation within the setting and its subsystems' } },
                sustainability: { fr: 'PÃ©rennitÃ©', en: 'Sustainability', definition: { fr: 'Maintien de l\'innovation au fil du temps', en: 'Extent to which the innovation is maintained over time' } }
            },
            
            // v11.0: Scientific Citations Registry
            citations: {
                cfir2: { ref: 'Damschroder LJ, Reardon CM, Widerquist MAO, et al. The updated Consolidated Framework for Implementation Research. Implementation Science. 2022;17:75.', doi: '10.1186/s13012-022-01245-0' },
                cfir1: { ref: 'Damschroder LJ, Aron DC, Keith RE, et al. Fostering implementation of health services research findings into practice. Implementation Science. 2009;4:50.', doi: '10.1186/1748-5908-4-50' },
                eric: { ref: 'Powell BJ, Waltz TJ, Chinman MJ, et al. A refined compilation of implementation strategies: results from the ERIC project. Implementation Science. 2015;10:21.', doi: '10.1186/s13012-015-0209-1' },
                cfirEric: { ref: 'Waltz TJ, Powell BJ, Fernandez ME, et al. Choosing implementation strategies to address contextual barriers. Implementation Science. 2019;14:50.', doi: '10.1186/s13012-019-0892-4' },
                comB: { ref: 'Michie S, van Stralen MM, West R. The behaviour change wheel. Implementation Science. 2011;6:42.', doi: '10.1186/1748-5908-6-42' },
                proctor: { ref: 'Proctor E, Silmere H, Raghavan R, et al. Outcomes for implementation research. Admin & Policy in Mental Health. 2011;38:65-76.', doi: '10.1007/s10488-010-0319-7' },
                equity: { ref: 'Woodward EN, et al. A more practical guide to incorporating health equity domains in implementation determinant frameworks. Implementation Science Communications. 2021;2:61.', doi: '10.1186/s43058-021-00146-5' },
                moudar: { ref: 'Generated by MOUDAR\u00AE v11.0 â€” AI-Powered Implementation Science Platform. \u00A9 2025 Younes MOUDAR.', doi: '' }
            },
            
            // v11.0: Generate citation block for publications
            generateCitationBlock: function(usedModules, format) {
                format = format || 'apa';
                var self = this;
                var refs = [];
                refs.push(self.citations.cfir2.ref);
                if (usedModules.indexOf('eric') >= 0) refs.push(self.citations.eric.ref);
                if (usedModules.indexOf('cfirEric') >= 0) refs.push(self.citations.cfirEric.ref);
                if (usedModules.indexOf('comB') >= 0) refs.push(self.citations.comB.ref);
                if (usedModules.indexOf('proctor') >= 0) refs.push(self.citations.proctor.ref);
                if (usedModules.indexOf('equity') >= 0) refs.push(self.citations.equity.ref);
                refs.push(self.citations.moudar.ref);
                return refs;
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 3: RE-AIM EVALUATOR - 5 dimensions avec scoring
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var REAIMEvaluator = {
            dimensions: {
                reach: {
                    id: 'reach',
                    label: { fr: 'PortÃ©e (Reach)', en: 'Reach' },
                    description: { fr: 'Proportion et reprÃ©sentativitÃ© de la population cible atteinte', en: 'Proportion and representativeness of target population reached' },
                    indicators: [
                        { id: 'R1', name: { fr: 'Taux de participation', en: 'Participation rate' }, target: 'â‰¥60%', weight: 1.0 },
                        { id: 'R2', name: { fr: 'ReprÃ©sentativitÃ© dÃ©mographique', en: 'Demographic representativeness' }, target: 'Oui', weight: 0.8 },
                        { id: 'R3', name: { fr: 'BarriÃ¨res Ã  la participation', en: 'Participation barriers' }, target: 'DocumentÃ©es', weight: 0.7 },
                        { id: 'R4', name: { fr: 'MÃ©thodes de recrutement', en: 'Recruitment methods' }, target: 'Multiples', weight: 0.6 }
                    ],
                    color: '#3b82f6',
                    strategies: ['S08', 'S18', 'S19', 'S15']
                },
                effectiveness: {
                    id: 'effectiveness',
                    label: { fr: 'EfficacitÃ© (Effectiveness)', en: 'Effectiveness' },
                    description: { fr: 'Impact sur les outcomes importants, incluant effets nÃ©gatifs', en: 'Impact on important outcomes, including negative effects' },
                    indicators: [
                        { id: 'E1', name: { fr: 'Outcome primaire atteint', en: 'Primary outcome achieved' }, target: 'Oui', weight: 1.0 },
                        { id: 'E2', name: { fr: 'Effets indÃ©sirables', en: 'Adverse effects' }, target: 'DocumentÃ©s', weight: 0.9 },
                        { id: 'E3', name: { fr: 'QualitÃ© de vie', en: 'Quality of life' }, target: 'AmÃ©liorÃ©e', weight: 0.8 },
                        { id: 'E4', name: { fr: 'Ã‰quitÃ© des effets', en: 'Effect equity' }, target: 'AnalysÃ©e', weight: 0.85 }
                    ],
                    color: '#10b981',
                    strategies: ['S02', 'S10', 'S16', 'S13']
                },
                adoption: {
                    id: 'adoption',
                    label: { fr: 'Adoption', en: 'Adoption' },
                    description: { fr: 'Proportion et reprÃ©sentativitÃ© des sites/agents qui adoptent', en: 'Proportion and representativeness of settings/agents who adopt' },
                    indicators: [
                        { id: 'A1', name: { fr: 'Taux d\'adoption sites', en: 'Site adoption rate' }, target: 'â‰¥70%', weight: 1.0 },
                        { id: 'A2', name: { fr: 'Taux d\'adoption professionnels', en: 'Staff adoption rate' }, target: 'â‰¥80%', weight: 0.95 },
                        { id: 'A3', name: { fr: 'CaractÃ©ristiques adoptants', en: 'Adopter characteristics' }, target: 'DocumentÃ©es', weight: 0.7 },
                        { id: 'A4', name: { fr: 'Raisons non-adoption', en: 'Non-adoption reasons' }, target: 'AnalysÃ©es', weight: 0.8 }
                    ],
                    color: '#8b5cf6',
                    strategies: ['S04', 'S20', 'S03', 'S01']
                },
                implementation: {
                    id: 'implementation',
                    label: { fr: 'ImplÃ©mentation', en: 'Implementation' },
                    description: { fr: 'FidÃ©litÃ©, adaptations, coÃ»t et cohÃ©rence de la mise en Å“uvre', en: 'Fidelity, adaptations, cost and consistency of delivery' },
                    indicators: [
                        { id: 'I1', name: { fr: 'FidÃ©litÃ© au protocole', en: 'Protocol fidelity' }, target: 'â‰¥80%', weight: 1.0 },
                        { id: 'I2', name: { fr: 'Adaptations documentÃ©es', en: 'Documented adaptations' }, target: 'Oui', weight: 0.85 },
                        { id: 'I3', name: { fr: 'CoÃ»t par bÃ©nÃ©ficiaire', en: 'Cost per beneficiary' }, target: 'CalculÃ©', weight: 0.9 },
                        { id: 'I4', name: { fr: 'Temps requis', en: 'Time required' }, target: 'DocumentÃ©', weight: 0.75 }
                    ],
                    color: '#f59e0b',
                    strategies: ['S10', 'S11', 'S02', 'S16']
                },
                maintenance: {
                    id: 'maintenance',
                    label: { fr: 'Maintien (Maintenance)', en: 'Maintenance' },
                    description: { fr: 'PÃ©rennitÃ© des effets et institutionnalisation', en: 'Sustainability of effects and institutionalization' },
                    indicators: [
                        { id: 'M1', name: { fr: 'Effets Ã  long terme', en: 'Long-term effects' }, target: 'â‰¥6 mois', weight: 1.0 },
                        { id: 'M2', name: { fr: 'Institutionnalisation', en: 'Institutionalization' }, target: 'Oui', weight: 0.95 },
                        { id: 'M3', name: { fr: 'Financement pÃ©renne', en: 'Sustainable funding' }, target: 'SÃ©curisÃ©', weight: 0.9 },
                        { id: 'M4', name: { fr: 'Ã‰volution/adaptation', en: 'Evolution/adaptation' }, target: 'PlanifiÃ©e', weight: 0.8 }
                    ],
                    color: '#ef4444',
                    strategies: ['S07', 'S12', 'S14', 'S06']
                }
            },
            
            evaluate: function(project, strategies, outcomes, lang) {
                lang = lang || 'fr';
                var self = this;
                var strategyIds = strategies.map(function(s) { return s.id || s; });
                
                var results = {};
                var totalScore = 0;
                
                Object.keys(this.dimensions).forEach(function(dimId) {
                    var dim = self.dimensions[dimId];
                    
                    // Calculer couverture par stratÃ©gies
                    var coverage = dim.strategies.filter(function(s) { 
                        return strategyIds.indexOf(s) >= 0; 
                    }).length / dim.strategies.length;
                    
                    // Score basÃ© sur couverture (simplifiÃ©, dans la rÃ©alitÃ© basÃ© sur donnÃ©es)
                    var score = Math.round(coverage * 100);
                    
                    results[dimId] = {
                        id: dimId,
                        label: dim.label[lang],
                        description: dim.description[lang],
                        score: score,
                        color: dim.color,
                        indicators: dim.indicators.map(function(ind) {
                            return {
                                id: ind.id,
                                name: ind.name[lang],
                                target: ind.target,
                                status: coverage >= 0.5 ? 'on-track' : 'at-risk'
                            };
                        }),
                        strategiesUsed: dim.strategies.filter(function(s) { return strategyIds.indexOf(s) >= 0; }),
                        strategiesMissing: dim.strategies.filter(function(s) { return strategyIds.indexOf(s) < 0; }),
                        recommendations: coverage < 0.5 ? self.getRecommendations(dimId, lang) : []
                    };
                    
                    totalScore += score;
                });
                
                // Benchmark comparison
                var benchmarks = {
                    excellent: 80,
                    good: 60,
                    acceptable: 40,
                    poor: 20
                };
                
                var globalScore = Math.round(totalScore / 5);
                var level = globalScore >= 80 ? 'excellent' : globalScore >= 60 ? 'good' : globalScore >= 40 ? 'acceptable' : 'poor';
                
                return {
                    globalScore: globalScore,
                    level: level,
                    levelLabel: lang === 'fr' 
                        ? { excellent: 'Excellent', good: 'Bon', acceptable: 'Acceptable', poor: 'Ã€ amÃ©liorer' }[level]
                        : { excellent: 'Excellent', good: 'Good', acceptable: 'Acceptable', poor: 'Needs improvement' }[level],
                    dimensions: results,
                    benchmarks: benchmarks,
                    framework: 'RE-AIM',
                    radarData: Object.values(results).map(function(r) {
                        return { dimension: r.label, score: r.score, color: r.color };
                    }),
                    generatedAt: new Date().toISOString()
                };
            },
            
            getRecommendations: function(dimId, lang) {
                var recs = {
                    reach: [
                        { fr: 'Ajouter S08 (Engagement communautaire) pour Ã©largir la portÃ©e', en: 'Add S08 (Community engagement) to expand reach' },
                        { fr: 'Utiliser S19 (Task-shifting) pour toucher les zones Ã©loignÃ©es', en: 'Use S19 (Task-shifting) to reach remote areas' }
                    ],
                    effectiveness: [
                        { fr: 'Ajouter S02 (Audit) pour mesurer l\'efficacitÃ©', en: 'Add S02 (Audit) to measure effectiveness' },
                        { fr: 'Renforcer avec S10 (Supervision) pour la qualitÃ©', en: 'Strengthen with S10 (Supervision) for quality' }
                    ],
                    adoption: [
                        { fr: 'Identifier des S04 (Champions) pour favoriser l\'adoption', en: 'Identify S04 (Champions) to promote adoption' },
                        { fr: 'Utiliser S20 (Engagement PP) pour lÃ©gitimer', en: 'Use S20 (Stakeholder engagement) for legitimacy' }
                    ],
                    implementation: [
                        { fr: 'Ajouter S11 (Adaptation) pour ajuster au contexte', en: 'Add S11 (Adaptation) to adjust to context' },
                        { fr: 'Mettre en place S10 (Supervision) pour la fidÃ©litÃ©', en: 'Set up S10 (Supervision) for fidelity' }
                    ],
                    maintenance: [
                        { fr: 'Planifier S07 (Politique) pour l\'ancrage institutionnel', en: 'Plan S07 (Policy) for institutional anchoring' },
                        { fr: 'Construire S12 (Coalitions) pour la durabilitÃ©', en: 'Build S12 (Coalitions) for sustainability' }
                    ]
                };
                return recs[dimId] ? recs[dimId].map(function(r) { return r[lang]; }) : [];
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 4: ROI CALCULATOR - Retour sur investissement
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var ROICalculator = {
            // BÃ©nÃ©fices types par domaine (USD/bÃ©nÃ©ficiaire/an)
            benefitEstimates: {
                mental_health: { 
                    direct: 500,      // RÃ©duction coÃ»ts hospitaliers
                    indirect: 1200,   // ProductivitÃ© retrouvÃ©e
                    intangible: 800   // QualitÃ© de vie (QALY proxy)
                },
                primary_care: { direct: 300, indirect: 600, intangible: 400 },
                chronic_disease: { direct: 800, indirect: 1500, intangible: 600 },
                infectious_disease: { direct: 400, indirect: 800, intangible: 300 },
                maternal_child: { direct: 600, indirect: 1000, intangible: 1200 },
                surgery: { direct: 1500, indirect: 800, intangible: 500 },
                digital_health: { direct: 200, indirect: 400, intangible: 300 },
                geriatrics: { direct: 700, indirect: 500, intangible: 900 },
                emergency: { direct: 1000, indirect: 600, intangible: 400 },
                rehabilitation: { direct: 600, indirect: 1100, intangible: 700 }
            },
            
            calculate: function(project, budget, outcomes, lang) {
                lang = lang || 'fr';
                
                var domain = project.domain || 'primary_care';
                var benefits = this.benefitEstimates[domain] || this.benefitEstimates.primary_care;
                var population = project.population || 100;
                var duration = project.duration || 24;
                var years = duration / 12;
                var totalCost = budget.summary ? budget.summary.total : (budget.total || 100000);
                
                // Calcul des bÃ©nÃ©fices annuels
                var annualBenefits = {
                    direct: benefits.direct * population,
                    indirect: benefits.indirect * population,
                    intangible: benefits.intangible * population
                };
                
                var totalAnnualBenefit = annualBenefits.direct + annualBenefits.indirect + annualBenefits.intangible;
                var totalBenefitsOverPeriod = totalAnnualBenefit * years;
                
                // ROI simple
                var roi = ((totalBenefitsOverPeriod - totalCost) / totalCost) * 100;
                
                // PÃ©riode de rÃ©cupÃ©ration (payback period)
                var paybackMonths = (totalCost / (totalAnnualBenefit / 12));
                
                // Valeur actuelle nette (VAN) avec taux d'actualisation de 5%
                var discountRate = 0.05;
                var npv = -totalCost;
                for (var i = 1; i <= Math.ceil(years); i++) {
                    npv += totalAnnualBenefit / Math.pow(1 + discountRate, i);
                }
                
                // Ratio coÃ»t-bÃ©nÃ©fice
                var bcRatio = totalBenefitsOverPeriod / totalCost;
                
                // Analyse de sensibilitÃ©
                var sensitivity = {
                    optimistic: { roi: roi * 1.3, bcRatio: bcRatio * 1.3 },
                    base: { roi: roi, bcRatio: bcRatio },
                    pessimistic: { roi: roi * 0.7, bcRatio: bcRatio * 0.7 }
                };
                
                // Comparaison avec benchmarks
                var benchmarks = {
                    excellent: { roi: 200, bcRatio: 3 },
                    good: { roi: 100, bcRatio: 2 },
                    acceptable: { roi: 50, bcRatio: 1.5 },
                    poor: { roi: 0, bcRatio: 1 }
                };
                
                var performanceLevel = roi >= 200 ? 'excellent' : roi >= 100 ? 'good' : roi >= 50 ? 'acceptable' : roi >= 0 ? 'marginal' : 'negative';
                
                return {
                    investment: {
                        total: totalCost,
                        perBeneficiary: Math.round(totalCost / population)
                    },
                    benefits: {
                        annual: {
                            direct: annualBenefits.direct,
                            indirect: annualBenefits.indirect,
                            intangible: annualBenefits.intangible,
                            total: totalAnnualBenefit
                        },
                        total: totalBenefitsOverPeriod,
                        perBeneficiary: Math.round(totalBenefitsOverPeriod / population)
                    },
                    metrics: {
                        roi: Math.round(roi),
                        npv: Math.round(npv),
                        bcRatio: Math.round(bcRatio * 100) / 100,
                        paybackMonths: Math.round(paybackMonths),
                        irr: Math.round((Math.pow(totalBenefitsOverPeriod / totalCost, 1 / years) - 1) * 100) // IRR simplifiÃ©
                    },
                    performanceLevel: performanceLevel,
                    performanceLabel: {
                        fr: { excellent: 'Excellent', good: 'Bon', acceptable: 'Acceptable', marginal: 'Marginal', negative: 'NÃ©gatif' },
                        en: { excellent: 'Excellent', good: 'Good', acceptable: 'Acceptable', marginal: 'Marginal', negative: 'Negative' }
                    }[lang][performanceLevel],
                    sensitivity: sensitivity,
                    benchmarks: benchmarks,
                    assumptions: {
                        discountRate: discountRate * 100 + '%',
                        benefitSource: lang === 'fr' ? 'Estimations basÃ©es sur la littÃ©rature' : 'Literature-based estimates',
                        domain: domain
                    },
                    chartData: {
                        labels: [
                            lang === 'fr' ? 'Investissement' : 'Investment',
                            lang === 'fr' ? 'BÃ©nÃ©fices directs' : 'Direct benefits',
                            lang === 'fr' ? 'BÃ©nÃ©fices indirects' : 'Indirect benefits',
                            lang === 'fr' ? 'BÃ©nÃ©fices intangibles' : 'Intangible benefits'
                        ],
                        values: [totalCost, annualBenefits.direct * years, annualBenefits.indirect * years, annualBenefits.intangible * years]
                    },
                    generatedAt: new Date().toISOString()
                };
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 4B: BUDGET IMPACT ANALYSIS (BIA) 3-5 ANS - v9.0
        // Analyse d'impact budgÃ©taire multi-annÃ©es pour passage Ã  l'Ã©chelle
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var BudgetImpactAnalyzer = {
            // ParamÃ¨tres par dÃ©faut selon contexte pays
            countryProfiles: {
                LIC: { inflationRate: 0.08, gdpGrowth: 0.04, healthSpendingRatio: 0.05, currencyVolatility: 0.15 },
                LMIC: { inflationRate: 0.05, gdpGrowth: 0.05, healthSpendingRatio: 0.06, currencyVolatility: 0.10 },
                UMIC: { inflationRate: 0.03, gdpGrowth: 0.04, healthSpendingRatio: 0.07, currencyVolatility: 0.05 },
                HIC: { inflationRate: 0.02, gdpGrowth: 0.02, healthSpendingRatio: 0.10, currencyVolatility: 0.02 }
            },
            
            // Multiplicateurs de coÃ»ts Ã©vitÃ©s par domaine
            avoidedCostMultipliers: {
                health: { hospitalization: 2.5, emergency: 1.8, medication: 1.2, productivity: 1.5, disability: 2.0 },
                mental_health: { hospitalization: 3.0, crisis: 2.2, medication: 1.0, productivity: 2.5, disability: 2.8 },
                education: { dropout: 1.5, remediation: 1.2, specialNeeds: 1.8, productivity: 2.0 },
                social: { incarceration: 3.5, welfare: 1.5, childProtection: 2.0, homelessness: 2.5 }
            },
            
            // ScÃ©narios de scaling
            scalingScenarios: {
                conservative: { yearlyGrowth: [1.0, 1.2, 1.4, 1.6, 1.8], adoptionRate: 0.6, attritionRate: 0.15 },
                moderate: { yearlyGrowth: [1.0, 1.5, 2.0, 2.5, 3.0], adoptionRate: 0.75, attritionRate: 0.10 },
                ambitious: { yearlyGrowth: [1.0, 2.0, 3.5, 5.0, 7.0], adoptionRate: 0.85, attritionRate: 0.08 }
            },
            
            analyze: function(project, budget, years, lang) {
                lang = lang || 'fr';
                years = years || 5;
                var self = this;
                
                var resourceLevel = project.resourceLevel || 'UMIC';
                var countryProfile = this.countryProfiles[resourceLevel] || this.countryProfiles.UMIC;
                var domain = project.domain || 'health';
                var baseBudget = budget.summary ? budget.summary.total : (project.budget || 100000);
                var basePopulation = project.population || 100;
                
                // GÃ©nÃ©rer projections par scÃ©nario
                var scenarios = {};
                Object.keys(this.scalingScenarios).forEach(function(scenarioKey) {
                    var scenario = self.scalingScenarios[scenarioKey];
                    var yearlyData = [];
                    var cumulativeCost = 0;
                    var cumulativeBenefit = 0;
                    var cumulativePopulation = 0;
                    
                    for (var year = 1; year <= years; year++) {
                        var growthFactor = scenario.yearlyGrowth[Math.min(year - 1, scenario.yearlyGrowth.length - 1)];
                        var inflationFactor = Math.pow(1 + countryProfile.inflationRate, year - 1);
                        
                        // CoÃ»ts projetÃ©s
                        var yearPopulation = Math.round(basePopulation * growthFactor * scenario.adoptionRate);
                        var yearCost = Math.round(baseBudget * growthFactor * inflationFactor * (year === 1 ? 1.2 : 0.85)); // PremiÃ¨re annÃ©e +20%, puis -15%
                        var costPerBeneficiary = yearPopulation > 0 ? Math.round(yearCost / yearPopulation) : 0;
                        
                        // BÃ©nÃ©fices / CoÃ»ts Ã©vitÃ©s
                        var avoidedCosts = self.calculateAvoidedCosts(yearPopulation, domain, costPerBeneficiary, lang);
                        var yearBenefit = avoidedCosts.total;
                        
                        cumulativeCost += yearCost;
                        cumulativeBenefit += yearBenefit;
                        cumulativePopulation += yearPopulation;
                        
                        yearlyData.push({
                            year: year,
                            population: yearPopulation,
                            cost: yearCost,
                            costPerBeneficiary: costPerBeneficiary,
                            benefits: yearBenefit,
                            avoidedCostsBreakdown: avoidedCosts.breakdown,
                            netBenefit: yearBenefit - yearCost,
                            cumulativeCost: cumulativeCost,
                            cumulativeBenefit: cumulativeBenefit,
                            cumulativeROI: cumulativeCost > 0 ? Math.round(((cumulativeBenefit - cumulativeCost) / cumulativeCost) * 100) : 0,
                            bcRatio: yearCost > 0 ? Math.round((yearBenefit / yearCost) * 100) / 100 : 0
                        });
                    }
                    
                    scenarios[scenarioKey] = {
                        label: self.getScenarioLabel(scenarioKey, lang),
                        data: yearlyData,
                        summary: {
                            totalCost: cumulativeCost,
                            totalBenefit: cumulativeBenefit,
                            totalPopulation: cumulativePopulation,
                            netBenefit: cumulativeBenefit - cumulativeCost,
                            overallROI: cumulativeCost > 0 ? Math.round(((cumulativeBenefit - cumulativeCost) / cumulativeCost) * 100) : 0,
                            overallBCRatio: cumulativeCost > 0 ? Math.round((cumulativeBenefit / cumulativeCost) * 100) / 100 : 0,
                            breakEvenYear: self.calculateBreakEvenYear(yearlyData)
                        }
                    };
                });
                
                // Analyse de sensibilitÃ©
                var sensitivity = this.runSensitivityAnalysis(project, budget, years, lang);
                
                // Recommandations pour dÃ©cideurs
                var recommendations = this.generateRecommendations(scenarios, sensitivity, lang);
                
                return {
                    projectTitle: project.title || (lang === 'fr' ? 'Analyse d\'Impact BudgÃ©taire' : 'Budget Impact Analysis'),
                    horizon: years + (lang === 'fr' ? ' ans' : ' years'),
                    resourceLevel: resourceLevel,
                    countryProfile: countryProfile,
                    baseBudget: baseBudget,
                    basePopulation: basePopulation,
                    domain: domain,
                    scenarios: scenarios,
                    sensitivity: sensitivity,
                    recommendations: recommendations,
                    executiveSummary: this.generateExecutiveSummary(scenarios, lang),
                    chartData: this.prepareChartData(scenarios, lang),
                    generatedAt: new Date().toISOString(),
                    version: 'BIA v1.0 - MOUDAR v9.0'
                };
            },
            
            calculateAvoidedCosts: function(population, domain, costPerBeneficiary, lang) {
                var multipliers = this.avoidedCostMultipliers[domain] || this.avoidedCostMultipliers.health;
                var breakdown = [];
                var total = 0;
                
                Object.keys(multipliers).forEach(function(category) {
                    var avoided = Math.round(population * costPerBeneficiary * multipliers[category] * 0.3);
                    total += avoided;
                    breakdown.push({
                        category: category,
                        label: lang === 'fr' ? {
                            hospitalization: 'Hospitalisations Ã©vitÃ©es',
                            emergency: 'Urgences Ã©vitÃ©es',
                            medication: 'Ã‰conomies mÃ©dicaments',
                            productivity: 'Gains de productivitÃ©',
                            disability: 'InvaliditÃ©s Ã©vitÃ©es',
                            crisis: 'Crises Ã©vitÃ©es',
                            dropout: 'DÃ©crochages Ã©vitÃ©s',
                            remediation: 'RemÃ©diation Ã©vitÃ©e',
                            specialNeeds: 'Besoins spÃ©ciaux Ã©vitÃ©s',
                            incarceration: 'IncarcÃ©rations Ã©vitÃ©es',
                            welfare: 'Aides sociales Ã©vitÃ©es',
                            childProtection: 'Protection enfance Ã©vitÃ©e',
                            homelessness: 'Sans-abrisme Ã©vitÃ©'
                        }[category] || category : category,
                        amount: avoided,
                        multiplier: multipliers[category]
                    });
                });
                
                return { total: total, breakdown: breakdown };
            },
            
            calculateBreakEvenYear: function(yearlyData) {
                for (var i = 0; i < yearlyData.length; i++) {
                    if (yearlyData[i].cumulativeBenefit >= yearlyData[i].cumulativeCost) {
                        return yearlyData[i].year;
                    }
                }
                return null;
            },
            
            runSensitivityAnalysis: function(project, budget, years, lang) {
                var baseBudget = budget.summary ? budget.summary.total : (project.budget || 100000);
                var scenarios = [];
                
                // Variation des coÃ»ts Â±20%
                [-0.2, -0.1, 0, 0.1, 0.2].forEach(function(variation) {
                    var adjustedBudget = baseBudget * (1 + variation);
                    var roi = Math.round(150 - (variation * 200)); // SimplifiÃ©
                    scenarios.push({
                        variable: lang === 'fr' ? 'Variation coÃ»ts' : 'Cost variation',
                        variation: Math.round(variation * 100) + '%',
                        impact: roi + '%',
                        risk: variation > 0 ? 'high' : variation < 0 ? 'low' : 'medium'
                    });
                });
                
                return {
                    scenarios: scenarios,
                    worstCase: { roi: 80, probability: 0.15 },
                    baseCase: { roi: 150, probability: 0.60 },
                    bestCase: { roi: 250, probability: 0.25 }
                };
            },
            
            generateRecommendations: function(scenarios, sensitivity, lang) {
                var recs = [];
                var moderate = scenarios.moderate;
                
                if (moderate && moderate.summary.breakEvenYear <= 2) {
                    recs.push({
                        priority: 'high',
                        icon: 'âœ…',
                        text: lang === 'fr' 
                            ? 'ROI positif dÃ¨s l\'annÃ©e ' + moderate.summary.breakEvenYear + ' - Fort potentiel de scaling'
                            : 'Positive ROI from year ' + moderate.summary.breakEvenYear + ' - Strong scaling potential'
                    });
                }
                
                if (moderate && moderate.summary.overallBCRatio >= 2) {
                    recs.push({
                        priority: 'high',
                        icon: 'ðŸ’°',
                        text: lang === 'fr'
                            ? 'Ratio coÃ»t-bÃ©nÃ©fice de ' + moderate.summary.overallBCRatio + ':1 - Investissement trÃ¨s rentable'
                            : 'Cost-benefit ratio of ' + moderate.summary.overallBCRatio + ':1 - Highly profitable investment'
                    });
                }
                
                recs.push({
                    priority: 'medium',
                    icon: 'ðŸ“Š',
                    text: lang === 'fr'
                        ? 'PrÃ©voir un fonds de contingence de 10-15% pour absorber les variations'
                        : 'Plan 10-15% contingency fund to absorb variations'
                });
                
                recs.push({
                    priority: 'medium',
                    icon: 'ðŸŽ¯',
                    text: lang === 'fr'
                        ? 'Commencer par le scÃ©nario conservateur avant d\'accÃ©lÃ©rer le scaling'
                        : 'Start with conservative scenario before accelerating scaling'
                });
                
                return recs;
            },
            
            generateExecutiveSummary: function(scenarios, lang) {
                var mod = scenarios.moderate;
                if (!mod) return '';
                
                return lang === 'fr'
                    ? 'Sur un horizon de 5 ans, le scÃ©nario modÃ©rÃ© projette un investissement total de $' + 
                      mod.summary.totalCost.toLocaleString() + ' pour des bÃ©nÃ©fices de $' + 
                      mod.summary.totalBenefit.toLocaleString() + ', soit un ROI de ' + 
                      mod.summary.overallROI + '% et un ratio coÃ»t-bÃ©nÃ©fice de ' + 
                      mod.summary.overallBCRatio + ':1. Le seuil de rentabilitÃ© est atteint en annÃ©e ' + 
                      (mod.summary.breakEvenYear || 'N/A') + '.'
                    : 'Over a 5-year horizon, the moderate scenario projects a total investment of $' + 
                      mod.summary.totalCost.toLocaleString() + ' for benefits of $' + 
                      mod.summary.totalBenefit.toLocaleString() + ', yielding a ROI of ' + 
                      mod.summary.overallROI + '% and a cost-benefit ratio of ' + 
                      mod.summary.overallBCRatio + ':1. Break-even is reached in year ' + 
                      (mod.summary.breakEvenYear || 'N/A') + '.';
            },
            
            prepareChartData: function(scenarios, lang) {
                var chartData = {
                    years: [],
                    conservative: { costs: [], benefits: [], roi: [] },
                    moderate: { costs: [], benefits: [], roi: [] },
                    ambitious: { costs: [], benefits: [], roi: [] }
                };
                
                if (scenarios.moderate) {
                    scenarios.moderate.data.forEach(function(d) {
                        chartData.years.push(lang === 'fr' ? 'An ' + d.year : 'Year ' + d.year);
                    });
                }
                
                ['conservative', 'moderate', 'ambitious'].forEach(function(key) {
                    if (scenarios[key]) {
                        scenarios[key].data.forEach(function(d) {
                            chartData[key].costs.push(d.cost);
                            chartData[key].benefits.push(d.benefits);
                            chartData[key].roi.push(d.cumulativeROI);
                        });
                    }
                });
                
                return chartData;
            },
            
            getScenarioLabel: function(key, lang) {
                var labels = {
                    conservative: { fr: 'Conservateur', en: 'Conservative' },
                    moderate: { fr: 'ModÃ©rÃ©', en: 'Moderate' },
                    ambitious: { fr: 'Ambitieux', en: 'Ambitious' }
                };
                return labels[key] ? labels[key][lang] : key;
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 4C: STAKEHOLDER MAPPER (SNA) - v9.0
        // Cartographie des acteurs et analyse des rÃ©seaux sociaux
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var StakeholderMapper = {
            // CatÃ©gories d'acteurs CFIR-alignÃ©es
            stakeholderCategories: {
                leadership: {
                    label: { fr: 'Leadership & DÃ©cideurs', en: 'Leadership & Decision Makers' },
                    icon: 'ðŸ‘”',
                    color: '#3b82f6',
                    influenceWeight: 1.0
                },
                implementers: {
                    label: { fr: 'Ã‰quipe d\'implÃ©mentation', en: 'Implementation Team' },
                    icon: 'âš™ï¸',
                    color: '#10b981',
                    influenceWeight: 0.9
                },
                clinicians: {
                    label: { fr: 'Cliniciens / Praticiens', en: 'Clinicians / Practitioners' },
                    icon: 'ðŸ©º',
                    color: '#8b5cf6',
                    influenceWeight: 0.85
                },
                patients: {
                    label: { fr: 'Patients / BÃ©nÃ©ficiaires', en: 'Patients / Beneficiaries' },
                    icon: 'ðŸ‘¥',
                    color: '#f59e0b',
                    influenceWeight: 0.7
                },
                funders: {
                    label: { fr: 'Bailleurs / Financeurs', en: 'Funders / Donors' },
                    icon: 'ðŸ’°',
                    color: '#ef4444',
                    influenceWeight: 0.95
                },
                partners: {
                    label: { fr: 'Partenaires externes', en: 'External Partners' },
                    icon: 'ðŸ¤',
                    color: '#06b6d4',
                    influenceWeight: 0.75
                },
                community: {
                    label: { fr: 'CommunautÃ© / SociÃ©tÃ© civile', en: 'Community / Civil Society' },
                    icon: 'ðŸ˜ï¸',
                    color: '#84cc16',
                    influenceWeight: 0.6
                },
                regulators: {
                    label: { fr: 'RÃ©gulateurs / MinistÃ¨res', en: 'Regulators / Ministries' },
                    icon: 'ðŸ›ï¸',
                    color: '#6366f1',
                    influenceWeight: 0.9
                }
            },
            
            // Matrice de positions
            positionMatrix: {
                champion: { label: { fr: 'Champion', en: 'Champion' }, score: 2, color: '#10b981', icon: 'ðŸŒŸ' },
                supporter: { label: { fr: 'Soutien', en: 'Supporter' }, score: 1, color: '#84cc16', icon: 'ðŸ‘' },
                neutral: { label: { fr: 'Neutre', en: 'Neutral' }, score: 0, color: '#6b7280', icon: 'ðŸ˜' },
                skeptic: { label: { fr: 'Sceptique', en: 'Skeptic' }, score: -1, color: '#f59e0b', icon: 'ðŸ¤”' },
                blocker: { label: { fr: 'Bloqueur', en: 'Blocker' }, score: -2, color: '#ef4444', icon: 'ðŸš«' }
            },
            
            // StratÃ©gies d'engagement recommandÃ©es
            engagementStrategies: {
                champion: ['S04', 'S07', 'S12'], // Utiliser comme ambassadeur
                supporter: ['S08', 'S03', 'S20'], // Renforcer l'engagement
                neutral: ['S01', 'S18', 'S11'], // Ã‰duquer et informer
                skeptic: ['S02', 'S16', 'S15'], // Convaincre avec preuves
                blocker: ['S04', 'S10', 'S09'] // NÃ©gocier et faciliter
            },
            
            analyze: function(stakeholders, project, lang) {
                lang = lang || 'fr';
                var self = this;
                
                if (!stakeholders || stakeholders.length === 0) {
                    stakeholders = this.generateDefaultStakeholders(project, lang);
                }
                
                // Calculer les scores et mÃ©triques
                var analyzed = stakeholders.map(function(s) {
                    var category = self.stakeholderCategories[s.category] || self.stakeholderCategories.partners;
                    var position = self.positionMatrix[s.position] || self.positionMatrix.neutral;
                    
                    var influence = (s.influence || 5) / 10;
                    var interest = (s.interest || 5) / 10;
                    var power = influence * category.influenceWeight;
                    var engagement = (influence + interest) / 2;
                    
                    // Quadrant Power/Interest
                    var quadrant = self.calculateQuadrant(power, interest);
                    
                    return {
                        id: s.id || 'SH_' + Math.random().toString(36).substr(2, 6),
                        name: s.name,
                        role: s.role || '',
                        category: s.category,
                        categoryLabel: category.label[lang],
                        categoryIcon: category.icon,
                        categoryColor: category.color,
                        position: s.position,
                        positionLabel: position.label[lang],
                        positionScore: position.score,
                        positionColor: position.color,
                        positionIcon: position.icon,
                        influence: Math.round(influence * 100),
                        interest: Math.round(interest * 100),
                        power: Math.round(power * 100),
                        engagement: Math.round(engagement * 100),
                        quadrant: quadrant,
                        strategies: self.engagementStrategies[s.position] || [],
                        notes: s.notes || '',
                        connections: s.connections || []
                    };
                });
                
                // Calculer les mÃ©triques globales
                var metrics = this.calculateGlobalMetrics(analyzed, lang);
                
                // Identifier champions et bloqueurs
                var champions = analyzed.filter(function(s) { return s.position === 'champion'; });
                var blockers = analyzed.filter(function(s) { return s.position === 'blocker'; });
                
                // GÃ©nÃ©rer le rÃ©seau
                var network = this.generateNetwork(analyzed);
                
                // Recommandations
                var recommendations = this.generateRecommendations(analyzed, metrics, lang);
                
                return {
                    stakeholders: analyzed,
                    totalCount: analyzed.length,
                    metrics: metrics,
                    champions: champions,
                    blockers: blockers,
                    network: network,
                    quadrantDistribution: this.getQuadrantDistribution(analyzed, lang),
                    positionDistribution: this.getPositionDistribution(analyzed, lang),
                    recommendations: recommendations,
                    riskScore: this.calculateRiskScore(analyzed),
                    readinessScore: this.calculateReadinessScore(analyzed),
                    generatedAt: new Date().toISOString(),
                    version: 'SNA v1.0 - MOUDAR v9.0'
                };
            },
            
            generateDefaultStakeholders: function(project, lang) {
                return [
                    { id: 'SH1', name: lang === 'fr' ? 'Directeur de programme' : 'Program Director', category: 'leadership', position: 'champion', influence: 9, interest: 9 },
                    { id: 'SH2', name: lang === 'fr' ? 'Chef de service' : 'Department Head', category: 'leadership', position: 'supporter', influence: 8, interest: 7 },
                    { id: 'SH3', name: lang === 'fr' ? 'Coordinateur projet' : 'Project Coordinator', category: 'implementers', position: 'champion', influence: 7, interest: 10 },
                    { id: 'SH4', name: lang === 'fr' ? 'Ã‰quipe terrain' : 'Field Team', category: 'implementers', position: 'supporter', influence: 6, interest: 8 },
                    { id: 'SH5', name: lang === 'fr' ? 'MÃ©decins seniors' : 'Senior Physicians', category: 'clinicians', position: 'neutral', influence: 8, interest: 5 },
                    { id: 'SH6', name: lang === 'fr' ? 'Infirmiers' : 'Nurses', category: 'clinicians', position: 'supporter', influence: 6, interest: 7 },
                    { id: 'SH7', name: lang === 'fr' ? 'ReprÃ©sentants patients' : 'Patient Representatives', category: 'patients', position: 'supporter', influence: 4, interest: 9 },
                    { id: 'SH8', name: lang === 'fr' ? 'Bailleur principal' : 'Main Funder', category: 'funders', position: 'neutral', influence: 10, interest: 6 },
                    { id: 'SH9', name: lang === 'fr' ? 'MinistÃ¨re de la SantÃ©' : 'Ministry of Health', category: 'regulators', position: 'neutral', influence: 9, interest: 5 },
                    { id: 'SH10', name: lang === 'fr' ? 'ONG partenaire' : 'Partner NGO', category: 'partners', position: 'supporter', influence: 5, interest: 8 }
                ];
            },
            
            calculateQuadrant: function(power, interest) {
                if (power >= 0.6 && interest >= 0.6) return 'manage_closely';
                if (power >= 0.6 && interest < 0.6) return 'keep_satisfied';
                if (power < 0.6 && interest >= 0.6) return 'keep_informed';
                return 'monitor';
            },
            
            calculateGlobalMetrics: function(stakeholders, lang) {
                var totalInfluence = 0;
                var totalEngagement = 0;
                var weightedPosition = 0;
                var totalWeight = 0;
                
                stakeholders.forEach(function(s) {
                    totalInfluence += s.influence;
                    totalEngagement += s.engagement;
                    weightedPosition += s.positionScore * (s.influence / 100);
                    totalWeight += s.influence / 100;
                });
                
                var n = stakeholders.length || 1;
                
                return {
                    averageInfluence: Math.round(totalInfluence / n),
                    averageEngagement: Math.round(totalEngagement / n),
                    netAlignment: totalWeight > 0 ? Math.round((weightedPosition / totalWeight) * 50 + 50) : 50,
                    championsCount: stakeholders.filter(function(s) { return s.position === 'champion'; }).length,
                    blockersCount: stakeholders.filter(function(s) { return s.position === 'blocker'; }).length,
                    highPowerCount: stakeholders.filter(function(s) { return s.power >= 70; }).length
                };
            },
            
            generateNetwork: function(stakeholders) {
                var nodes = stakeholders.map(function(s) {
                    return {
                        id: s.id,
                        label: s.name,
                        color: s.categoryColor,
                        size: s.power / 10 + 5,
                        group: s.category
                    };
                });
                
                var edges = [];
                // GÃ©nÃ©rer des connexions basÃ©es sur les catÃ©gories
                stakeholders.forEach(function(s1, i) {
                    stakeholders.forEach(function(s2, j) {
                        if (i < j) {
                            var strength = 0;
                            if (s1.category === s2.category) strength = 0.8;
                            else if (s1.quadrant === s2.quadrant) strength = 0.5;
                            else if (s1.position === s2.position) strength = 0.3;
                            
                            if (strength > 0.2) {
                                edges.push({
                                    source: s1.id,
                                    target: s2.id,
                                    strength: strength,
                                    type: s1.category === s2.category ? 'same_category' : 'cross_category'
                                });
                            }
                        }
                    });
                });
                
                return { nodes: nodes, edges: edges };
            },
            
            getQuadrantDistribution: function(stakeholders, lang) {
                var quadrants = {
                    manage_closely: { label: lang === 'fr' ? 'GÃ©rer de prÃ¨s' : 'Manage Closely', count: 0, color: '#ef4444' },
                    keep_satisfied: { label: lang === 'fr' ? 'Satisfaire' : 'Keep Satisfied', count: 0, color: '#f59e0b' },
                    keep_informed: { label: lang === 'fr' ? 'Informer' : 'Keep Informed', count: 0, color: '#3b82f6' },
                    monitor: { label: lang === 'fr' ? 'Surveiller' : 'Monitor', count: 0, color: '#6b7280' }
                };
                
                stakeholders.forEach(function(s) {
                    if (quadrants[s.quadrant]) quadrants[s.quadrant].count++;
                });
                
                return quadrants;
            },
            
            getPositionDistribution: function(stakeholders, lang) {
                var self = this;
                var distribution = {};
                
                Object.keys(this.positionMatrix).forEach(function(key) {
                    distribution[key] = {
                        label: self.positionMatrix[key].label[lang],
                        count: 0,
                        color: self.positionMatrix[key].color,
                        icon: self.positionMatrix[key].icon
                    };
                });
                
                stakeholders.forEach(function(s) {
                    if (distribution[s.position]) distribution[s.position].count++;
                });
                
                return distribution;
            },
            
            calculateRiskScore: function(stakeholders) {
                var risk = 0;
                stakeholders.forEach(function(s) {
                    if (s.position === 'blocker' && s.power >= 70) risk += 30;
                    else if (s.position === 'blocker') risk += 15;
                    else if (s.position === 'skeptic' && s.power >= 70) risk += 15;
                    else if (s.position === 'skeptic') risk += 8;
                });
                return Math.min(100, risk);
            },
            
            calculateReadinessScore: function(stakeholders) {
                var readiness = 50;
                stakeholders.forEach(function(s) {
                    if (s.position === 'champion') readiness += 8;
                    else if (s.position === 'supporter') readiness += 4;
                    else if (s.position === 'neutral') readiness += 0;
                    else if (s.position === 'skeptic') readiness -= 5;
                    else if (s.position === 'blocker') readiness -= 10;
                });
                return Math.max(0, Math.min(100, readiness));
            },
            
            generateRecommendations: function(stakeholders, metrics, lang) {
                var recs = [];
                
                if (metrics.blockersCount > 0) {
                    recs.push({
                        priority: 'high',
                        icon: 'âš ï¸',
                        text: lang === 'fr'
                            ? metrics.blockersCount + ' bloqueur(s) identifiÃ©(s) - StratÃ©gie de nÃ©gociation urgente requise'
                            : metrics.blockersCount + ' blocker(s) identified - Urgent negotiation strategy required',
                        strategies: ['S04', 'S10']
                    });
                }
                
                if (metrics.championsCount < 2) {
                    recs.push({
                        priority: 'high',
                        icon: 'ðŸŒŸ',
                        text: lang === 'fr'
                            ? 'Identifier et recruter plus de champions (actuellement: ' + metrics.championsCount + ')'
                            : 'Identify and recruit more champions (currently: ' + metrics.championsCount + ')',
                        strategies: ['S04', 'S07']
                    });
                }
                
                if (metrics.netAlignment < 60) {
                    recs.push({
                        priority: 'medium',
                        icon: 'ðŸ“Š',
                        text: lang === 'fr'
                            ? 'Alignement global faible (' + metrics.netAlignment + '%) - Renforcer l\'engagement'
                            : 'Low overall alignment (' + metrics.netAlignment + '%) - Strengthen engagement',
                        strategies: ['S08', 'S18']
                    });
                }
                
                recs.push({
                    priority: 'low',
                    icon: 'ðŸ“…',
                    text: lang === 'fr'
                        ? 'Planifier des rÃ©unions rÃ©guliÃ¨res avec les acteurs du quadrant "GÃ©rer de prÃ¨s"'
                        : 'Schedule regular meetings with stakeholders in "Manage Closely" quadrant',
                    strategies: ['S03', 'S20']
                });
                
                return recs;
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 4D: SUSTAINABILITY FRAMEWORK (SCHEIRER) - v9.0
        // Framework de pÃ©rennitÃ© post-financement basÃ© sur Scheirer & Dearing
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var SustainabilityFramework = {
            // 8 facteurs clÃ©s de pÃ©rennitÃ© (Scheirer & Dearing, 2011)
            factors: {
                modifiability: {
                    id: 'modifiability',
                    label: { fr: 'AdaptabilitÃ© de l\'intervention', en: 'Intervention Modifiability' },
                    description: { fr: 'CapacitÃ© Ã  adapter l\'intervention au contexte local sans perdre les Ã©lÃ©ments essentiels', en: 'Ability to adapt intervention to local context without losing core elements' },
                    weight: 0.12,
                    icon: 'ðŸ”§',
                    indicators: [
                        { id: 'M1', label: { fr: 'Composants essentiels identifiÃ©s', en: 'Core components identified' } },
                        { id: 'M2', label: { fr: 'Adaptations documentÃ©es', en: 'Documented adaptations' } },
                        { id: 'M3', label: { fr: 'FlexibilitÃ© de mise en Å“uvre', en: 'Implementation flexibility' } }
                    ]
                },
                effectiveness: {
                    id: 'effectiveness',
                    label: { fr: 'EfficacitÃ© perÃ§ue', en: 'Perceived Effectiveness' },
                    description: { fr: 'Perception par les acteurs que l\'intervention produit des rÃ©sultats positifs', en: 'Stakeholder perception that intervention produces positive results' },
                    weight: 0.15,
                    icon: 'âœ…',
                    indicators: [
                        { id: 'E1', label: { fr: 'RÃ©sultats visibles pour les bÃ©nÃ©ficiaires', en: 'Visible results for beneficiaries' } },
                        { id: 'E2', label: { fr: 'DonnÃ©es probantes locales', en: 'Local evidence data' } },
                        { id: 'E3', label: { fr: 'Satisfaction des utilisateurs', en: 'User satisfaction' } }
                    ]
                },
                champions: {
                    id: 'champions',
                    label: { fr: 'Champions & Leadership', en: 'Champions & Leadership' },
                    description: { fr: 'PrÃ©sence de leaders engagÃ©s qui dÃ©fendent l\'intervention', en: 'Presence of committed leaders who advocate for the intervention' },
                    weight: 0.15,
                    icon: 'ðŸŒŸ',
                    indicators: [
                        { id: 'C1', label: { fr: 'Champion(s) identifiÃ©(s)', en: 'Champion(s) identified' } },
                        { id: 'C2', label: { fr: 'Soutien du leadership formel', en: 'Formal leadership support' } },
                        { id: 'C3', label: { fr: 'Plan de succession', en: 'Succession plan' } }
                    ]
                },
                fit: {
                    id: 'fit',
                    label: { fr: 'Alignement organisationnel', en: 'Organizational Fit' },
                    description: { fr: 'CompatibilitÃ© avec la mission, culture et prioritÃ©s de l\'organisation', en: 'Compatibility with organization mission, culture and priorities' },
                    weight: 0.13,
                    icon: 'ðŸŽ¯',
                    indicators: [
                        { id: 'F1', label: { fr: 'Alignement avec la mission', en: 'Mission alignment' } },
                        { id: 'F2', label: { fr: 'IntÃ©gration aux processus existants', en: 'Integration with existing processes' } },
                        { id: 'F3', label: { fr: 'CohÃ©rence avec les prioritÃ©s stratÃ©giques', en: 'Strategic priority consistency' } }
                    ]
                },
                funding: {
                    id: 'funding',
                    label: { fr: 'Financement durable', en: 'Sustainable Funding' },
                    description: { fr: 'SÃ©curisation de ressources financiÃ¨res Ã  long terme', en: 'Securing long-term financial resources' },
                    weight: 0.15,
                    icon: 'ðŸ’°',
                    indicators: [
                        { id: 'FU1', label: { fr: 'Sources de financement diversifiÃ©es', en: 'Diversified funding sources' } },
                        { id: 'FU2', label: { fr: 'IntÃ©gration au budget rÃ©current', en: 'Integration in recurring budget' } },
                        { id: 'FU3', label: { fr: 'Plan de transition financiÃ¨re', en: 'Financial transition plan' } }
                    ]
                },
                staff: {
                    id: 'staff',
                    label: { fr: 'CapacitÃ© du personnel', en: 'Staff Capacity' },
                    description: { fr: 'CompÃ©tences et engagement du personnel pour maintenir l\'intervention', en: 'Staff skills and commitment to maintain intervention' },
                    weight: 0.12,
                    icon: 'ðŸ‘¥',
                    indicators: [
                        { id: 'S1', label: { fr: 'Personnel formÃ© disponible', en: 'Trained staff available' } },
                        { id: 'S2', label: { fr: 'Transfert de compÃ©tences documentÃ©', en: 'Documented skills transfer' } },
                        { id: 'S3', label: { fr: 'Turnover managÃ©', en: 'Managed turnover' } }
                    ]
                },
                community: {
                    id: 'community',
                    label: { fr: 'Engagement communautaire', en: 'Community Engagement' },
                    description: { fr: 'Implication et appropriation par la communautÃ© bÃ©nÃ©ficiaire', en: 'Beneficiary community involvement and ownership' },
                    weight: 0.10,
                    icon: 'ðŸ˜ï¸',
                    indicators: [
                        { id: 'CO1', label: { fr: 'Participation communautaire active', en: 'Active community participation' } },
                        { id: 'CO2', label: { fr: 'Appropriation locale', en: 'Local ownership' } },
                        { id: 'CO3', label: { fr: 'Demande continue des bÃ©nÃ©ficiaires', en: 'Ongoing beneficiary demand' } }
                    ]
                },
                policy: {
                    id: 'policy',
                    label: { fr: 'Ancrage politique', en: 'Policy Integration' },
                    description: { fr: 'IntÃ©gration dans les politiques et systÃ¨mes de santÃ© nationaux', en: 'Integration into national health policies and systems' },
                    weight: 0.08,
                    icon: 'ðŸ›ï¸',
                    indicators: [
                        { id: 'P1', label: { fr: 'Inclusion dans les directives nationales', en: 'Inclusion in national guidelines' } },
                        { id: 'P2', label: { fr: 'Soutien rÃ©glementaire', en: 'Regulatory support' } },
                        { id: 'P3', label: { fr: 'Plaidoyer auprÃ¨s des dÃ©cideurs', en: 'Advocacy with decision-makers' } }
                    ]
                }
            },
            
            // Niveaux de maturitÃ©
            maturityLevels: {
                0: { label: { fr: 'Non initiÃ©', en: 'Not Started' }, color: '#ef4444' },
                1: { label: { fr: 'En dÃ©veloppement', en: 'Developing' }, color: '#f59e0b' },
                2: { label: { fr: 'Partiellement en place', en: 'Partially in Place' }, color: '#eab308' },
                3: { label: { fr: 'Bien Ã©tabli', en: 'Well Established' }, color: '#84cc16' },
                4: { label: { fr: 'OptimisÃ©', en: 'Optimized' }, color: '#10b981' }
            },
            
            evaluate: function(assessments, project, lang) {
                lang = lang || 'fr';
                var self = this;
                
                // Si pas d'Ã©valuations, gÃ©nÃ©rer des valeurs par dÃ©faut
                if (!assessments || Object.keys(assessments).length === 0) {
                    assessments = this.generateDefaultAssessments();
                }
                
                var results = {};
                var globalScore = 0;
                var totalWeight = 0;
                var criticalGaps = [];
                var strengths = [];
                
                Object.keys(this.factors).forEach(function(factorId) {
                    var factor = self.factors[factorId];
                    var assessment = assessments[factorId] || { score: 2, notes: '' };
                    var score = assessment.score || 2;
                    var maturity = self.maturityLevels[score] || self.maturityLevels[2];
                    
                    var weightedScore = score * factor.weight;
                    globalScore += weightedScore;
                    totalWeight += factor.weight;
                    
                    var indicatorResults = factor.indicators.map(function(ind) {
                        var indAssessment = assessment.indicators ? assessment.indicators[ind.id] : null;
                        return {
                            id: ind.id,
                            label: ind.label[lang],
                            status: indAssessment ? indAssessment.status : 'unknown',
                            notes: indAssessment ? indAssessment.notes : ''
                        };
                    });
                    
                    results[factorId] = {
                        id: factorId,
                        label: factor.label[lang],
                        description: factor.description[lang],
                        icon: factor.icon,
                        weight: Math.round(factor.weight * 100),
                        score: score,
                        maxScore: 4,
                        percentage: Math.round((score / 4) * 100),
                        maturityLevel: score,
                        maturityLabel: maturity.label[lang],
                        maturityColor: maturity.color,
                        indicators: indicatorResults,
                        notes: assessment.notes || '',
                        strategies: self.getStrategiesForFactor(factorId, score)
                    };
                    
                    if (score <= 1) {
                        criticalGaps.push({
                            factor: factor.label[lang],
                            score: score,
                            priority: factor.weight >= 0.13 ? 'critical' : 'high'
                        });
                    } else if (score >= 3) {
                        strengths.push({
                            factor: factor.label[lang],
                            score: score
                        });
                    }
                });
                
                var normalizedGlobal = totalWeight > 0 ? (globalScore / totalWeight) : 2;
                var globalPercentage = Math.round((normalizedGlobal / 4) * 100);
                
                // ProbabilitÃ© de pÃ©rennitÃ©
                var sustainabilityProbability = this.calculateSustainabilityProbability(results);
                
                // Recommandations
                var recommendations = this.generateRecommendations(results, criticalGaps, lang);
                
                // Plan de transition
                var transitionPlan = this.generateTransitionPlan(results, project, lang);
                
                return {
                    projectTitle: project ? project.title : '',
                    globalScore: Math.round(normalizedGlobal * 10) / 10,
                    globalPercentage: globalPercentage,
                    globalMaturity: this.getGlobalMaturity(normalizedGlobal, lang),
                    sustainabilityProbability: sustainabilityProbability,
                    factors: results,
                    criticalGaps: criticalGaps.sort(function(a, b) { return a.score - b.score; }),
                    strengths: strengths.sort(function(a, b) { return b.score - a.score; }),
                    recommendations: recommendations,
                    transitionPlan: transitionPlan,
                    radarData: this.prepareRadarData(results, lang),
                    generatedAt: new Date().toISOString(),
                    version: 'Sustainability Framework v1.0 - MOUDAR v9.0',
                    reference: 'Scheirer & Dearing (2011). An Agenda for Research on the Sustainability of Public Health Programs.'
                };
            },
            
            generateDefaultAssessments: function() {
                return {
                    modifiability: { score: 2 },
                    effectiveness: { score: 3 },
                    champions: { score: 2 },
                    fit: { score: 3 },
                    funding: { score: 1 },
                    staff: { score: 2 },
                    community: { score: 2 },
                    policy: { score: 1 }
                };
            },
            
            getStrategiesForFactor: function(factorId, score) {
                var strategyMap = {
                    modifiability: ['S11', 'S16', 'S05'],
                    effectiveness: ['S02', 'S10', 'S13'],
                    champions: ['S04', 'S07', 'S12'],
                    fit: ['S20', 'S03', 'S08'],
                    funding: ['S06', 'S19', 'S17'],
                    staff: ['S01', 'S14', 'S09'],
                    community: ['S08', 'S18', 'S15'],
                    policy: ['S12', 'S07', 'S20']
                };
                
                if (score >= 3) return [];
                return strategyMap[factorId] || [];
            },
            
            calculateSustainabilityProbability: function(results) {
                var criticalFactors = ['champions', 'funding', 'effectiveness'];
                var criticalScore = 0;
                var otherScore = 0;
                var criticalCount = 0;
                var otherCount = 0;
                
                Object.keys(results).forEach(function(key) {
                    if (criticalFactors.indexOf(key) >= 0) {
                        criticalScore += results[key].score;
                        criticalCount++;
                    } else {
                        otherScore += results[key].score;
                        otherCount++;
                    }
                });
                
                var criticalAvg = criticalCount > 0 ? criticalScore / criticalCount : 0;
                var otherAvg = otherCount > 0 ? otherScore / otherCount : 0;
                
                // PondÃ©ration: facteurs critiques comptent plus
                var probability = (criticalAvg * 0.6 + otherAvg * 0.4) / 4 * 100;
                
                return {
                    percentage: Math.round(probability),
                    level: probability >= 70 ? 'high' : probability >= 50 ? 'moderate' : 'low',
                    label: probability >= 70 
                        ? { fr: 'Ã‰levÃ©e', en: 'High' }
                        : probability >= 50 
                            ? { fr: 'ModÃ©rÃ©e', en: 'Moderate' }
                            : { fr: 'Faible', en: 'Low' }
                };
            },
            
            getGlobalMaturity: function(score, lang) {
                if (score >= 3.5) return { level: 4, label: this.maturityLevels[4].label[lang], color: this.maturityLevels[4].color };
                if (score >= 2.5) return { level: 3, label: this.maturityLevels[3].label[lang], color: this.maturityLevels[3].color };
                if (score >= 1.5) return { level: 2, label: this.maturityLevels[2].label[lang], color: this.maturityLevels[2].color };
                if (score >= 0.5) return { level: 1, label: this.maturityLevels[1].label[lang], color: this.maturityLevels[1].color };
                return { level: 0, label: this.maturityLevels[0].label[lang], color: this.maturityLevels[0].color };
            },
            
            generateRecommendations: function(results, criticalGaps, lang) {
                var recs = [];
                
                if (criticalGaps.length > 0) {
                    var gap = criticalGaps[0];
                    recs.push({
                        priority: 'critical',
                        icon: 'ðŸš¨',
                        text: lang === 'fr'
                            ? 'PrioritÃ© absolue: Renforcer "' + gap.factor + '" (score: ' + gap.score + '/4)'
                            : 'Top priority: Strengthen "' + gap.factor + '" (score: ' + gap.score + '/4)',
                        factor: gap.factor
                    });
                }
                
                if (results.funding && results.funding.score <= 2) {
                    recs.push({
                        priority: 'high',
                        icon: 'ðŸ’°',
                        text: lang === 'fr'
                            ? 'DÃ©velopper un plan de financement post-projet avec sources diversifiÃ©es'
                            : 'Develop post-project funding plan with diversified sources',
                        factor: 'funding'
                    });
                }
                
                if (results.champions && results.champions.score <= 2) {
                    recs.push({
                        priority: 'high',
                        icon: 'ðŸŒŸ',
                        text: lang === 'fr'
                            ? 'Identifier et former des champions locaux avec plan de succession'
                            : 'Identify and train local champions with succession plan',
                        factor: 'champions'
                    });
                }
                
                if (results.policy && results.policy.score <= 1) {
                    recs.push({
                        priority: 'medium',
                        icon: 'ðŸ›ï¸',
                        text: lang === 'fr'
                            ? 'Engager le plaidoyer pour l\'intÃ©gration dans les politiques nationales'
                            : 'Engage advocacy for integration into national policies',
                        factor: 'policy'
                    });
                }
                
                recs.push({
                    priority: 'low',
                    icon: 'ðŸ“Š',
                    text: lang === 'fr'
                        ? 'Documenter les succÃ¨s et produire des preuves locales d\'efficacitÃ©'
                        : 'Document successes and produce local evidence of effectiveness',
                    factor: 'effectiveness'
                });
                
                return recs;
            },
            
            generateTransitionPlan: function(results, project, lang) {
                var phases = [
                    {
                        phase: 1,
                        name: lang === 'fr' ? 'PrÃ©paration (M-12 Ã  M-6)' : 'Preparation (M-12 to M-6)',
                        activities: [
                            lang === 'fr' ? 'Ã‰valuation des capacitÃ©s locales' : 'Local capacity assessment',
                            lang === 'fr' ? 'Identification des champions' : 'Champion identification',
                            lang === 'fr' ? 'DÃ©but du transfert de compÃ©tences' : 'Start skills transfer'
                        ]
                    },
                    {
                        phase: 2,
                        name: lang === 'fr' ? 'Transition (M-6 Ã  M0)' : 'Transition (M-6 to M0)',
                        activities: [
                            lang === 'fr' ? 'Financement de transition sÃ©curisÃ©' : 'Transition funding secured',
                            lang === 'fr' ? 'ResponsabilitÃ©s transfÃ©rÃ©es' : 'Responsibilities transferred',
                            lang === 'fr' ? 'Documentation complÃ¨te' : 'Complete documentation'
                        ]
                    },
                    {
                        phase: 3,
                        name: lang === 'fr' ? 'Post-financement (M0+)' : 'Post-funding (M0+)',
                        activities: [
                            lang === 'fr' ? 'Suivi Ã  distance' : 'Remote monitoring',
                            lang === 'fr' ? 'Support technique ponctuel' : 'Ad-hoc technical support',
                            lang === 'fr' ? 'Ã‰valuation de pÃ©rennitÃ© Ã  12 mois' : '12-month sustainability evaluation'
                        ]
                    }
                ];
                
                return {
                    phases: phases,
                    criticalMilestones: [
                        { date: 'M-12', milestone: lang === 'fr' ? 'DÃ©but plan de transition' : 'Transition plan start' },
                        { date: 'M-6', milestone: lang === 'fr' ? 'Financement pÃ©renne confirmÃ©' : 'Sustainable funding confirmed' },
                        { date: 'M-3', milestone: lang === 'fr' ? 'Transfert complet des responsabilitÃ©s' : 'Complete responsibility transfer' },
                        { date: 'M0', milestone: lang === 'fr' ? 'Fin du financement initial' : 'End of initial funding' },
                        { date: 'M+12', milestone: lang === 'fr' ? 'Ã‰valuation de pÃ©rennitÃ©' : 'Sustainability evaluation' }
                    ]
                };
            },
            
            prepareRadarData: function(results, lang) {
                var data = {
                    labels: [],
                    scores: [],
                    maxScore: 4
                };
                
                Object.keys(results).forEach(function(key) {
                    data.labels.push(results[key].label);
                    data.scores.push(results[key].score);
                });
                
                return data;
            }
        };
        
        console.log('âœ… MOUDAR v9.0 Strategic Modules: BudgetImpactAnalyzer, StakeholderMapper, SustainabilityFramework');
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // v11.0 MODULE: NPT EVALUATOR â€” Normalization Process Theory (May & Finch 2009)
        // Reference: May C, Finch T (2009). Implementation Science, 4:29
        // Reference: Finch TL et al. (2018). BMC Medical Research Methodology, 18:133
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var NPTEvaluator = {
            version: '1.0',
            citation: 'May C & Finch T (2009). Implementation Science, 4:29',
            nomadCitation: 'Finch TL et al. (2018). BMC Medical Research Methodology, 18:133',
            
            constructs: {
                coherence: {
                    id: 'coherence',
                    label: { fr: 'CohÃ©rence (Sense-Making)', en: 'Coherence (Sense-Making)' },
                    description: { fr: 'Travail que font les individus pour comprendre et donner du sens Ã  une pratique', en: 'The work that individuals do to understand and make sense of a practice' },
                    color: '#3b82f6',
                    subConstructs: [
                        { id: 'CO1', name: { fr: 'DiffÃ©renciation', en: 'Differentiation' }, description: { fr: 'Comprendre en quoi la pratique diffÃ¨re des pratiques existantes', en: 'Understanding how the practice differs from existing practices' } },
                        { id: 'CO2', name: { fr: 'SpÃ©cification communale', en: 'Communal Specification' }, description: { fr: 'Construire une comprÃ©hension partagÃ©e de la pratique', en: 'Building shared understanding of the practice' } },
                        { id: 'CO3', name: { fr: 'SpÃ©cification individuelle', en: 'Individual Specification' }, description: { fr: 'Comprendre ses propres tÃ¢ches et responsabilitÃ©s', en: 'Understanding own tasks and responsibilities' } },
                        { id: 'CO4', name: { fr: 'Internalisation', en: 'Internalization' }, description: { fr: 'Comprendre la valeur et les bÃ©nÃ©fices de la pratique', en: 'Understanding the value and benefits of the practice' } }
                    ]
                },
                cognitiveParticipation: {
                    id: 'cognitiveParticipation',
                    label: { fr: 'Participation Cognitive', en: 'Cognitive Participation' },
                    description: { fr: 'Travail relationnel pour construire et maintenir une communautÃ© de pratique', en: 'Relational work to build and sustain a community of practice' },
                    color: '#10b981',
                    subConstructs: [
                        { id: 'CP1', name: { fr: 'Initiation', en: 'Initiation' }, description: { fr: 'Acteurs clÃ©s qui conduisent la pratique', en: 'Key actors who drive the practice forward' } },
                        { id: 'CP2', name: { fr: 'EnrÃ´lement', en: 'Enrolment' }, description: { fr: 'Organiser les autres pour contribuer Ã  la pratique', en: 'Organizing others to contribute to the practice' } },
                        { id: 'CP3', name: { fr: 'LÃ©gitimation', en: 'Legitimation' }, description: { fr: 'Croire que la pratique est appropriÃ©e', en: 'Believing the practice is an appropriate thing to do' } },
                        { id: 'CP4', name: { fr: 'Activation', en: 'Activation' }, description: { fr: 'DÃ©finir les actions et procÃ©dures nÃ©cessaires', en: 'Defining the actions and procedures needed' } }
                    ]
                },
                collectiveAction: {
                    id: 'collectiveAction',
                    label: { fr: 'Action Collective', en: 'Collective Action' },
                    description: { fr: 'Travail opÃ©rationnel pour mettre en Å“uvre la pratique', en: 'Operational work to enact the practice' },
                    color: '#8b5cf6',
                    subConstructs: [
                        { id: 'CA1', name: { fr: 'Fonctionnement interactionnel', en: 'Interactional Workability' }, description: { fr: 'Comment la pratique affecte les interactions', en: 'How the practice affects interactions' } },
                        { id: 'CA2', name: { fr: 'Confiance relationnelle', en: 'Relational Integration' }, description: { fr: 'Connaissance et confiance dans la pratique', en: 'Knowledge about and confidence in the practice' } },
                        { id: 'CA3', name: { fr: 'Ensemble de compÃ©tences', en: 'Skill Set Workability' }, description: { fr: 'Division du travail appropriÃ©e', en: 'Appropriate division of labor' } },
                        { id: 'CA4', name: { fr: 'IntÃ©gration contextuelle', en: 'Contextual Integration' }, description: { fr: 'Soutien organisationnel et ressources', en: 'Organizational support and resources' } }
                    ]
                },
                reflexiveMonitoring: {
                    id: 'reflexiveMonitoring',
                    label: { fr: 'Suivi RÃ©flexif', en: 'Reflexive Monitoring' },
                    description: { fr: 'Travail d\'Ã©valuation et d\'ajustement continu', en: 'Appraisal work to assess and adjust the practice' },
                    color: '#f59e0b',
                    subConstructs: [
                        { id: 'RM1', name: { fr: 'SystÃ©matisation', en: 'Systematization' }, description: { fr: 'Collecter de l\'information sur les effets de la pratique', en: 'Gathering information about the effects of the practice' } },
                        { id: 'RM2', name: { fr: 'Ã‰valuation communale', en: 'Communal Appraisal' }, description: { fr: 'Ã‰valuation collective de la pratique', en: 'Collective evaluation of the practice' } },
                        { id: 'RM3', name: { fr: 'Ã‰valuation individuelle', en: 'Individual Appraisal' }, description: { fr: 'Ã‰valuation individuelle de la pratique', en: 'Individual evaluation of the practice' } },
                        { id: 'RM4', name: { fr: 'Reconfiguration', en: 'Reconfiguration' }, description: { fr: 'Modifier la pratique en fonction des Ã©valuations', en: 'Modifying the practice based on appraisals' } }
                    ]
                }
            },
            
            evaluate: function(project, scores, lang) {
                lang = lang || 'fr';
                var self = this;
                var results = {};
                var totalScore = 0;
                
                Object.keys(this.constructs).forEach(function(constructId) {
                    var construct = self.constructs[constructId];
                    var subScores = [];
                    
                    construct.subConstructs.forEach(function(sub) {
                        var score = (scores && scores[sub.id]) ? scores[sub.id] : 0;
                        subScores.push({
                            id: sub.id,
                            name: sub.name[lang],
                            description: sub.description[lang],
                            score: score,
                            status: score >= 70 ? 'normalized' : score >= 40 ? 'partial' : 'not_normalized'
                        });
                    });
                    
                    var avgScore = subScores.length > 0 ? Math.round(subScores.reduce(function(a, b) { return a + b.score; }, 0) / subScores.length) : 0;
                    
                    results[constructId] = {
                        id: constructId,
                        label: construct.label[lang],
                        description: construct.description[lang],
                        color: construct.color,
                        score: avgScore,
                        subConstructs: subScores,
                        normalizationLevel: avgScore >= 70 ? 'normalized' : avgScore >= 40 ? 'emerging' : 'not_normalized',
                        normalizationLabel: avgScore >= 70 
                            ? (lang === 'fr' ? 'NormalisÃ©' : 'Normalized')
                            : avgScore >= 40 
                                ? (lang === 'fr' ? 'Ã‰mergent' : 'Emerging')
                                : (lang === 'fr' ? 'Non normalisÃ©' : 'Not normalized')
                    };
                    
                    totalScore += avgScore;
                });
                
                var globalScore = Math.round(totalScore / 4);
                
                return {
                    globalScore: globalScore,
                    constructs: results,
                    normalizationLevel: globalScore >= 70 ? 'normalized' : globalScore >= 40 ? 'emerging' : 'not_normalized',
                    framework: 'NPT',
                    citation: self.citation,
                    generatedAt: new Date().toISOString()
                };
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // v11.0 MODULE: FRAME ADAPTATION TRACKER (Stirman et al. 2019)
        // Reference: Stirman SW, Baumann AA, Miller CJ (2019). Implementation Science, 14:58
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var FRAMETracker = {
            version: '1.0',
            citation: 'Stirman SW et al. (2019). Implementation Science, 14:58',
            
            // FRAME dimensions
            dimensions: {
                what: {
                    label: { fr: 'QUOI a Ã©tÃ© adaptÃ©', en: 'WHAT was adapted' },
                    options: [
                        { id: 'content', label: { fr: 'Contenu', en: 'Content' } },
                        { id: 'context', label: { fr: 'Contexte de livraison', en: 'Context of delivery' } },
                        { id: 'training', label: { fr: 'Formation/Supervision', en: 'Training/Supervision' } },
                        { id: 'evaluation', label: { fr: 'Ã‰valuation', en: 'Evaluation' } },
                        { id: 'implementation', label: { fr: 'ActivitÃ©s d\'implÃ©mentation', en: 'Implementation activities' } }
                    ]
                },
                whom: {
                    label: { fr: 'Par QUI', en: 'By WHOM' },
                    options: [
                        { id: 'researcher', label: { fr: 'Chercheur', en: 'Researcher' } },
                        { id: 'practitioner', label: { fr: 'Praticien', en: 'Practitioner' } },
                        { id: 'administrator', label: { fr: 'Administrateur', en: 'Administrator' } },
                        { id: 'recipient', label: { fr: 'BÃ©nÃ©ficiaire', en: 'Recipient/Patient' } },
                        { id: 'team', label: { fr: 'Ã‰quipe mixte', en: 'Mixed team' } }
                    ]
                },
                level: {
                    label: { fr: 'Ã€ quel NIVEAU', en: 'At what LEVEL' },
                    options: [
                        { id: 'individual', label: { fr: 'Individuel', en: 'Individual' } },
                        { id: 'cohort', label: { fr: 'Cohorte', en: 'Cohort' } },
                        { id: 'population', label: { fr: 'Population', en: 'Population' } },
                        { id: 'organization', label: { fr: 'Organisation', en: 'Organization' } },
                        { id: 'system', label: { fr: 'SystÃ¨me', en: 'System' } }
                    ]
                },
                type: {
                    label: { fr: 'TYPE de modification', en: 'TYPE of modification' },
                    options: [
                        { id: 'adding', label: { fr: 'Ajout d\'Ã©lÃ©ments', en: 'Adding elements' } },
                        { id: 'removing', label: { fr: 'Suppression d\'Ã©lÃ©ments', en: 'Removing/skipping elements' } },
                        { id: 'modifying', label: { fr: 'Modification', en: 'Modifying/adapting' } },
                        { id: 'substituting', label: { fr: 'Substitution', en: 'Substituting' } },
                        { id: 'reordering', label: { fr: 'RÃ©organisation', en: 'Reordering/restructuring' } },
                        { id: 'shortening', label: { fr: 'Raccourcissement', en: 'Shortening/condensing' } },
                        { id: 'lengthening', label: { fr: 'Extension', en: 'Lengthening/extending' } }
                    ]
                },
                reason: {
                    label: { fr: 'RAISON de l\'adaptation', en: 'REASON for adaptation' },
                    options: [
                        { id: 'cultural', label: { fr: 'Adaptation culturelle', en: 'Cultural adaptation' } },
                        { id: 'resource', label: { fr: 'Contraintes de ressources', en: 'Resource constraints' } },
                        { id: 'organizational', label: { fr: 'Contexte organisationnel', en: 'Organizational context' } },
                        { id: 'regulatory', label: { fr: 'Exigences rÃ©glementaires', en: 'Regulatory requirements' } },
                        { id: 'feedback', label: { fr: 'Retour des participants', en: 'Participant feedback' } },
                        { id: 'evidence', label: { fr: 'Nouvelles preuves', en: 'New evidence' } },
                        { id: 'pragmatic', label: { fr: 'Raisons pragmatiques', en: 'Pragmatic reasons' } }
                    ]
                },
                fidelityImpact: {
                    label: { fr: 'Impact sur la FIDÃ‰LITÃ‰', en: 'FIDELITY impact' },
                    options: [
                        { id: 'core_preserved', label: { fr: 'Composantes essentielles prÃ©servÃ©es', en: 'Core components preserved' } },
                        { id: 'core_modified', label: { fr: 'Composantes essentielles modifiÃ©es', en: 'Core components modified' } },
                        { id: 'periphery_only', label: { fr: 'PÃ©riphÃ©rie uniquement', en: 'Periphery only' } },
                        { id: 'uncertain', label: { fr: 'Impact incertain', en: 'Uncertain impact' } }
                    ]
                }
            },
            
            // Create a new adaptation record
            createAdaptation: function(data) {
                return {
                    id: 'ADAPT_' + Date.now(),
                    timestamp: new Date().toISOString(),
                    what: data.what || '',
                    whom: data.whom || '',
                    level: data.level || '',
                    type: data.type || '',
                    reason: data.reason || '',
                    fidelityImpact: data.fidelityImpact || 'uncertain',
                    description: data.description || '',
                    justification: data.justification || '',
                    phase: data.phase || 'implementation'
                };
            },
            
            // Analyze fidelity across all adaptations
            analyzeFidelity: function(adaptations, lang) {
                lang = lang || 'fr';
                var total = adaptations.length;
                if (total === 0) return { score: 100, label: lang === 'fr' ? 'Aucune adaptation' : 'No adaptations', risk: 'none' };
                
                var coreModified = adaptations.filter(function(a) { return a.fidelityImpact === 'core_modified'; }).length;
                var corePreserved = adaptations.filter(function(a) { return a.fidelityImpact === 'core_preserved'; }).length;
                var peripheryOnly = adaptations.filter(function(a) { return a.fidelityImpact === 'periphery_only'; }).length;
                
                var score = Math.round(((corePreserved + peripheryOnly * 0.9) / total) * 100);
                var risk = coreModified > total * 0.3 ? 'high' : coreModified > 0 ? 'moderate' : 'low';
                
                return {
                    score: score,
                    total: total,
                    coreModified: coreModified,
                    corePreserved: corePreserved,
                    peripheryOnly: peripheryOnly,
                    risk: risk,
                    label: risk === 'high' 
                        ? (lang === 'fr' ? 'Risque Ã©levÃ© de dÃ©rive' : 'High drift risk')
                        : risk === 'moderate'
                            ? (lang === 'fr' ? 'Risque modÃ©rÃ©' : 'Moderate risk')
                            : (lang === 'fr' ? 'FidÃ©litÃ© prÃ©servÃ©e' : 'Fidelity preserved'),
                    citation: this.citation
                };
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // v11.0 MODULE: IMPLEMENTATION OUTCOMES (Proctor et al. 2011)
        // Reference: Proctor E et al. (2011). Admin & Policy in Mental Health, 38:65-76
        // The "taxonomy of implementation outcomes" â€” 8 distinct outcomes
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var ImplementationOutcomes = {
            version: '1.0',
            citation: 'Proctor E et al. (2011). Admin & Policy in Mental Health, 38:65-76',
            
            outcomes: {
                acceptability: {
                    id: 'acceptability',
                    label: { fr: 'AcceptabilitÃ©', en: 'Acceptability' },
                    definition: { fr: 'Perception que l\'innovation est agrÃ©able, satisfaisante', en: 'Perception that the innovation is agreeable, palatable, satisfactory' },
                    instruments: ['Acceptability of Intervention Measure (AIM)', 'Treatment Acceptability Questionnaire'],
                    cfirLink: ['IC3', 'IS6'],
                    color: '#3b82f6'
                },
                adoption: {
                    id: 'adoption',
                    label: { fr: 'Adoption', en: 'Adoption' },
                    definition: { fr: 'Intention, dÃ©cision initiale, ou action d\'utiliser l\'innovation', en: 'Intention, initial decision, or action to try the innovation' },
                    instruments: ['RE-AIM Adoption measure', 'Provider surveys'],
                    cfirLink: ['IN4', 'IS11'],
                    color: '#10b981'
                },
                appropriateness: {
                    id: 'appropriateness',
                    label: { fr: 'Pertinence', en: 'Appropriateness' },
                    definition: { fr: 'CompatibilitÃ© perÃ§ue de l\'innovation avec le contexte, le prestataire, le consommateur', en: 'Perceived fit, relevance, or compatibility of the innovation for the setting' },
                    instruments: ['Intervention Appropriateness Measure (IAM)', 'Perceived Characteristics of Intervention'],
                    cfirLink: ['IS6', 'IC3'],
                    color: '#8b5cf6'
                },
                feasibility: {
                    id: 'feasibility',
                    label: { fr: 'FaisabilitÃ©', en: 'Feasibility' },
                    definition: { fr: 'Mesure dans laquelle l\'innovation peut Ãªtre utilisÃ©e avec succÃ¨s dans le cadre donnÃ©', en: 'Extent to which the innovation can be successfully used within the setting' },
                    instruments: ['Feasibility of Intervention Measure (FIM)', 'Organizational Readiness'],
                    cfirLink: ['IS12', 'IC6'],
                    color: '#f59e0b'
                },
                fidelity: {
                    id: 'fidelity',
                    label: { fr: 'FidÃ©litÃ©', en: 'Fidelity' },
                    definition: { fr: 'DegrÃ© de conformitÃ© Ã  la mise en Å“uvre prÃ©vue initialement', en: 'Degree to which the innovation was implemented as prescribed' },
                    instruments: ['Fidelity checklists', 'FRAME (Stirman 2019)'],
                    cfirLink: ['PR4', 'IC4'],
                    color: '#ef4444'
                },
                cost: {
                    id: 'cost',
                    label: { fr: 'CoÃ»t d\'implÃ©mentation', en: 'Implementation Cost' },
                    definition: { fr: 'CoÃ»t de la stratÃ©gie d\'implÃ©mentation elle-mÃªme', en: 'Cost impact of the implementation strategy itself' },
                    instruments: ['Budget Impact Analysis', 'Cost-effectiveness analysis'],
                    cfirLink: ['IC8', 'OS6'],
                    color: '#14b8a6'
                },
                penetration: {
                    id: 'penetration',
                    label: { fr: 'PÃ©nÃ©tration', en: 'Penetration' },
                    definition: { fr: 'IntÃ©gration de l\'innovation dans le cadre et ses sous-systÃ¨mes', en: 'Integration of the innovation within the setting and its subsystems' },
                    instruments: ['RE-AIM Reach/Adoption', 'Service delivery data'],
                    cfirLink: ['IS1', 'OS4'],
                    color: '#a855f7'
                },
                sustainability: {
                    id: 'sustainability',
                    label: { fr: 'PÃ©rennitÃ©', en: 'Sustainability' },
                    definition: { fr: 'Maintien de l\'innovation aprÃ¨s la fin du financement initial', en: 'Extent to which the innovation is maintained after initial funding ends' },
                    instruments: ['PSAT', 'Scheirer Framework', 'RE-AIM Maintenance'],
                    cfirLink: ['OS6', 'IS14'],
                    color: '#f97316'
                }
            },
            
            evaluate: function(scores, lang) {
                lang = lang || 'fr';
                var self = this;
                var results = {};
                var totalScore = 0;
                var count = 0;
                
                Object.keys(this.outcomes).forEach(function(outcomeId) {
                    var outcome = self.outcomes[outcomeId];
                    var score = (scores && scores[outcomeId]) ? scores[outcomeId] : 0;
                    
                    results[outcomeId] = {
                        id: outcomeId,
                        label: outcome.label[lang],
                        definition: outcome.definition[lang],
                        score: score,
                        color: outcome.color,
                        instruments: outcome.instruments,
                        cfirLink: outcome.cfirLink,
                        status: score >= 70 ? 'strong' : score >= 40 ? 'moderate' : 'weak'
                    };
                    
                    totalScore += score;
                    count++;
                });
                
                return {
                    globalScore: count > 0 ? Math.round(totalScore / count) : 0,
                    outcomes: results,
                    framework: 'Proctor Implementation Outcomes',
                    citation: self.citation,
                    generatedAt: new Date().toISOString()
                };
            }
        };
        
        console.log('âœ… MOUDAR v11.0 Scientific Excellence Modules: NPTEvaluator, FRAMETracker, ImplementationOutcomes, CFIR-ERIC Matching, SMARTDesigner, DeepAIAnalyzer (LLM-Powered)');
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 5: FUNDING PROPOSAL GENERATOR - Templates bailleurs
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var FundingGenerator = {
            templates: {
                WHO: {
                    name: 'World Health Organization',
                    logo: 'ðŸ¥',
                    sections: [
                        { id: 'exec', title: { fr: 'RÃ©sumÃ© exÃ©cutif', en: 'Executive Summary' }, maxWords: 500 },
                        { id: 'background', title: { fr: 'Contexte et justification', en: 'Background & Rationale' }, maxWords: 1000 },
                        { id: 'objectives', title: { fr: 'Objectifs et rÃ©sultats attendus', en: 'Objectives & Expected Results' }, maxWords: 800 },
                        { id: 'methods', title: { fr: 'MÃ©thodologie', en: 'Methodology' }, maxWords: 1500 },
                        { id: 'implementation', title: { fr: 'Plan d\'implÃ©mentation', en: 'Implementation Plan' }, maxWords: 1000 },
                        { id: 'monitoring', title: { fr: 'Suivi et Ã©valuation', en: 'Monitoring & Evaluation' }, maxWords: 800 },
                        { id: 'budget', title: { fr: 'Budget dÃ©taillÃ©', en: 'Detailed Budget' }, maxWords: 500 },
                        { id: 'sustainability', title: { fr: 'DurabilitÃ©', en: 'Sustainability' }, maxWords: 500 },
                        { id: 'risks', title: { fr: 'Risques et mitigation', en: 'Risks & Mitigation' }, maxWords: 500 }
                    ],
                    priorities: ['equity', 'evidence_based', 'sustainability']
                },
                UNICEF: {
                    name: 'UNICEF',
                    logo: 'ðŸ‘¶',
                    sections: [
                        { id: 'summary', title: { fr: 'RÃ©sumÃ© de la proposition', en: 'Proposal Summary' }, maxWords: 400 },
                        { id: 'situation', title: { fr: 'Analyse de la situation', en: 'Situation Analysis' }, maxWords: 1200 },
                        { id: 'theory', title: { fr: 'ThÃ©orie du changement', en: 'Theory of Change' }, maxWords: 800 },
                        { id: 'strategy', title: { fr: 'StratÃ©gie d\'intervention', en: 'Intervention Strategy' }, maxWords: 1000 },
                        { id: 'workplan', title: { fr: 'Plan de travail', en: 'Workplan' }, maxWords: 800 },
                        { id: 'results', title: { fr: 'Cadre de rÃ©sultats', en: 'Results Framework' }, maxWords: 600 },
                        { id: 'budget', title: { fr: 'Budget', en: 'Budget' }, maxWords: 400 },
                        { id: 'partners', title: { fr: 'Partenariats', en: 'Partnerships' }, maxWords: 400 }
                    ],
                    priorities: ['equity', 'speed', 'cost_effectiveness']
                },
                GlobalFund: {
                    name: 'Global Fund',
                    logo: 'ðŸŒ',
                    sections: [
                        { id: 'overview', title: { fr: 'Vue d\'ensemble du programme', en: 'Program Overview' }, maxWords: 600 },
                        { id: 'epidemiology', title: { fr: 'Contexte Ã©pidÃ©miologique', en: 'Epidemiological Context' }, maxWords: 1000 },
                        { id: 'gaps', title: { fr: 'Gaps et prioritÃ©s', en: 'Gaps & Priorities' }, maxWords: 800 },
                        { id: 'interventions', title: { fr: 'Interventions proposÃ©es', en: 'Proposed Interventions' }, maxWords: 1200 },
                        { id: 'targets', title: { fr: 'Cibles et indicateurs', en: 'Targets & Indicators' }, maxWords: 800 },
                        { id: 'implementation', title: { fr: 'Arrangements d\'implÃ©mentation', en: 'Implementation Arrangements' }, maxWords: 1000 },
                        { id: 'budget', title: { fr: 'Budget par module', en: 'Budget by Module' }, maxWords: 600 },
                        { id: 'sustainability', title: { fr: 'Transition et durabilitÃ©', en: 'Transition & Sustainability' }, maxWords: 600 }
                    ],
                    priorities: ['evidence_based', 'cost_effectiveness', 'sustainability']
                },
                USAID: {
                    name: 'USAID',
                    logo: 'ðŸ‡ºðŸ‡¸',
                    sections: [
                        { id: 'abstract', title: { fr: 'RÃ©sumÃ©', en: 'Abstract' }, maxWords: 300 },
                        { id: 'problem', title: { fr: 'Ã‰noncÃ© du problÃ¨me', en: 'Problem Statement' }, maxWords: 800 },
                        { id: 'approach', title: { fr: 'Approche technique', en: 'Technical Approach' }, maxWords: 1500 },
                        { id: 'management', title: { fr: 'Approche de gestion', en: 'Management Approach' }, maxWords: 800 },
                        { id: 'staffing', title: { fr: 'Plan de dotation', en: 'Staffing Plan' }, maxWords: 500 },
                        { id: 'mel', title: { fr: 'Plan MEL', en: 'MEL Plan' }, maxWords: 800 },
                        { id: 'budget', title: { fr: 'Budget narratif', en: 'Budget Narrative' }, maxWords: 600 },
                        { id: 'past', title: { fr: 'ExpÃ©rience passÃ©e', en: 'Past Performance' }, maxWords: 500 }
                    ],
                    priorities: ['evidence_based', 'sustainability', 'speed']
                }
            },
            
            generate: function(project, strategies, budget, funder, lang) {
                lang = lang || 'fr';
                var template = this.templates[funder] || this.templates.WHO;
                var self = this;
                
                var strategyLabels = strategies.map(function(s) {
                    var strat = KnowledgeGraph.nodes.strategies[s.id || s];
                    return strat ? strat.label[lang] : (s.id || s);
                });
                
                var proposal = {
                    funder: funder,
                    funderName: template.name,
                    logo: template.logo,
                    projectTitle: project.title || (lang === 'fr' ? 'Projet d\'implÃ©mentation' : 'Implementation Project'),
                    organization: project.organization || '',
                    totalBudget: budget.summary ? budget.summary.total : 100000,
                    duration: project.duration || 24,
                    sections: [],
                    completionRate: 0,
                    generatedAt: new Date().toISOString()
                };
                
                var completedSections = 0;
                
                template.sections.forEach(function(section) {
                    var content = self.generateSectionContent(section.id, project, strategies, budget, lang);
                    var isComplete = content && content.length > 50;
                    if (isComplete) completedSections++;
                    
                    proposal.sections.push({
                        id: section.id,
                        title: section.title[lang],
                        maxWords: section.maxWords,
                        content: content,
                        wordCount: content ? content.split(/\s+/).length : 0,
                        status: isComplete ? 'complete' : 'draft',
                        tips: self.getSectionTips(section.id, lang)
                    });
                });
                
                proposal.completionRate = Math.round((completedSections / template.sections.length) * 100);
                proposal.strategies = strategyLabels;
                proposal.priorities = template.priorities;
                
                return proposal;
            },
            
            generateSectionContent: function(sectionId, project, strategies, budget, lang) {
                var contents = {
                    exec: lang === 'fr' 
                        ? 'Ce projet vise Ã  implÃ©menter une intervention basÃ©e sur des preuves dans le domaine de ' + (project.domain || 'la santÃ©') + '. Sur une durÃ©e de ' + (project.duration || 24) + ' mois, le projet touchera ' + (project.population || 100) + ' bÃ©nÃ©ficiaires Ã  travers ' + strategies.length + ' stratÃ©gies d\'implÃ©mentation validÃ©es.'
                        : 'This project aims to implement an evidence-based intervention in the field of ' + (project.domain || 'health') + '. Over ' + (project.duration || 24) + ' months, the project will reach ' + (project.population || 100) + ' beneficiaries through ' + strategies.length + ' validated implementation strategies.',
                    summary: lang === 'fr'
                        ? 'Proposition pour l\'implÃ©mentation d\'une intervention innovante ciblant ' + (project.population || 100) + ' bÃ©nÃ©ficiaires. Budget total: $' + (budget.summary ? budget.summary.total.toLocaleString() : '100,000') + ' USD.'
                        : 'Proposal for implementing an innovative intervention targeting ' + (project.population || 100) + ' beneficiaries. Total budget: $' + (budget.summary ? budget.summary.total.toLocaleString() : '100,000') + ' USD.',
                    background: project.context || (lang === 'fr' ? '[Contexte Ã  complÃ©ter]' : '[Context to complete]'),
                    objectives: lang === 'fr'
                        ? 'Objectif gÃ©nÃ©ral: AmÃ©liorer les outcomes de santÃ© de la population cible.\n\nObjectifs spÃ©cifiques:\n1. Former ' + (project.population || 100) + ' professionnels\n2. Atteindre un taux d\'adoption de 70%\n3. Maintenir les effets sur 12 mois post-projet'
                        : 'General objective: Improve health outcomes of the target population.\n\nSpecific objectives:\n1. Train ' + (project.population || 100) + ' professionals\n2. Achieve 70% adoption rate\n3. Maintain effects for 12 months post-project',
                    budget: lang === 'fr'
                        ? 'Budget total: $' + (budget.summary ? budget.summary.total.toLocaleString() : '100,000') + ' USD\n- DÃ©marrage: $' + (budget.summary ? budget.summary.setup.toLocaleString() : '20,000') + '\n- RÃ©current: $' + (budget.summary ? budget.summary.recurring.toLocaleString() : '80,000')
                        : 'Total budget: $' + (budget.summary ? budget.summary.total.toLocaleString() : '100,000') + ' USD\n- Setup: $' + (budget.summary ? budget.summary.setup.toLocaleString() : '20,000') + '\n- Recurring: $' + (budget.summary ? budget.summary.recurring.toLocaleString() : '80,000')
                };
                
                return contents[sectionId] || (lang === 'fr' ? '[Section Ã  complÃ©ter]' : '[Section to complete]');
            },
            
            getSectionTips: function(sectionId, lang) {
                var tips = {
                    exec: { fr: 'Maximum 1 page. Inclure problÃ¨me, solution, budget et rÃ©sultats attendus.', en: 'Maximum 1 page. Include problem, solution, budget and expected results.' },
                    background: { fr: 'Citer des donnÃ©es locales et internationales. RÃ©fÃ©rencer les politiques nationales.', en: 'Cite local and international data. Reference national policies.' },
                    objectives: { fr: 'Utiliser la formulation SMART. Aligner avec les ODD.', en: 'Use SMART formulation. Align with SDGs.' },
                    budget: { fr: 'DÃ©tailler par catÃ©gorie. Justifier les coÃ»ts unitaires.', en: 'Detail by category. Justify unit costs.' }
                };
                return tips[sectionId] ? tips[sectionId][lang] : '';
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 6: MONITORING DASHBOARD - Tableau de bord temps rÃ©el
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var MonitoringDashboard = {
            generate: function(project, strategies, lang) {
                lang = lang || 'fr';
                var self = this;
                
                // GÃ©nÃ©rer les KPIs par stratÃ©gie
                var kpis = [];
                strategies.forEach(function(s) {
                    var strat = KnowledgeGraph.nodes.strategies[s.id || s];
                    if (strat && strat.kpis) {
                        strat.kpis.forEach(function(kpi) {
                            kpis.push({
                                strategyId: s.id || s,
                                strategyName: strat.label[lang],
                                id: kpi.id,
                                indicator: kpi.indicator[lang],
                                target: kpi.target,
                                frequency: kpi.frequency[lang],
                                source: kpi.source[lang],
                                currentValue: null,
                                status: 'pending',
                                trend: 'stable'
                            });
                        });
                    }
                });
                
                // Structure du dashboard
                var dashboard = {
                    projectTitle: project.title || '',
                    lastUpdated: new Date().toISOString(),
                    
                    // Vue d'ensemble
                    overview: {
                        phase: project.phase || 'preparation',
                        progress: 35, // SimulÃ©
                        daysRemaining: (project.duration || 24) * 30 - 60,
                        budgetSpent: 28, // %
                        alerts: [
                            { level: 'warning', message: lang === 'fr' ? 'Retard formation site 3' : 'Training delay site 3' },
                            { level: 'info', message: lang === 'fr' ? 'Audit Q1 prÃ©vu dans 2 semaines' : 'Q1 audit scheduled in 2 weeks' }
                        ]
                    },
                    
                    // KPIs
                    kpis: kpis,
                    
                    // Indicateurs agrÃ©gÃ©s
                    indicators: {
                        reach: { label: lang === 'fr' ? 'PortÃ©e' : 'Reach', value: 65, target: 80, unit: '%' },
                        adoption: { label: lang === 'fr' ? 'Adoption' : 'Adoption', value: 72, target: 70, unit: '%' },
                        fidelity: { label: lang === 'fr' ? 'FidÃ©litÃ©' : 'Fidelity', value: 85, target: 80, unit: '%' },
                        satisfaction: { label: lang === 'fr' ? 'Satisfaction' : 'Satisfaction', value: 4.2, target: 4.0, unit: '/5' }
                    },
                    
                    // Timeline
                    timeline: {
                        milestones: [
                            { date: '2025-01', label: lang === 'fr' ? 'Lancement' : 'Launch', status: 'completed' },
                            { date: '2025-03', label: lang === 'fr' ? 'Formation terminÃ©e' : 'Training complete', status: 'completed' },
                            { date: '2025-06', label: lang === 'fr' ? 'Pilote terminÃ©' : 'Pilot complete', status: 'in-progress' },
                            { date: '2025-09', label: lang === 'fr' ? 'DÃ©ploiement' : 'Rollout', status: 'upcoming' },
                            { date: '2025-12', label: lang === 'fr' ? 'Ã‰valuation finale' : 'Final evaluation', status: 'upcoming' }
                        ]
                    },
                    
                    // Alertes prÃ©dictives
                    predictiveAlerts: self.generatePredictiveAlerts(project, strategies, lang),
                    
                    // DonnÃ©es pour graphiques
                    charts: {
                        progressByMonth: self.generateProgressData(project.duration || 24),
                        kpiTrends: self.generateKPITrends(6),
                        budgetBurndown: self.generateBudgetBurndown(project.duration || 24)
                    }
                };
                
                return dashboard;
            },
            
            generatePredictiveAlerts: function(project, strategies, lang) {
                var alerts = [];
                var strategyIds = strategies.map(function(s) { return s.id || s; });
                
                // Alerte si pas de supervision
                if (strategyIds.indexOf('S10') < 0) {
                    alerts.push({
                        type: 'risk',
                        severity: 'high',
                        message: lang === 'fr' 
                            ? 'Risque de dÃ©rive des pratiques dÃ©tectÃ©: aucune supervision prÃ©vue'
                            : 'Practice drift risk detected: no supervision planned',
                        recommendation: lang === 'fr' ? 'Ajouter S10 (Supervision clinique)' : 'Add S10 (Clinical supervision)'
                    });
                }
                
                // Alerte turnover
                if (strategyIds.indexOf('S15') < 0 && strategyIds.indexOf('S06') < 0) {
                    alerts.push({
                        type: 'prediction',
                        severity: 'medium',
                        message: lang === 'fr'
                            ? 'ProbabilitÃ© de turnover Ã©levÃ©e (>40%) sans mÃ©canismes de rÃ©tention'
                            : 'High turnover probability (>40%) without retention mechanisms',
                        recommendation: lang === 'fr' ? 'ConsidÃ©rer S15 ou S06' : 'Consider S15 or S06'
                    });
                }
                
                return alerts;
            },
            
            generateProgressData: function(durationMonths) {
                var data = [];
                for (var i = 0; i <= durationMonths; i += 3) {
                    var planned = Math.round((i / durationMonths) * 100);
                    var actual = i <= 6 ? Math.round(planned * 0.9) : null;
                    data.push({
                        month: i,
                        planned: planned,
                        actual: actual
                    });
                }
                return data;
            },
            
            generateKPITrends: function(months) {
                var data = [];
                for (var i = 1; i <= months; i++) {
                    data.push({
                        month: 'M' + i,
                        adoption: 40 + i * 8 + Math.random() * 10,
                        fidelity: 70 + i * 3 + Math.random() * 5,
                        satisfaction: 3.5 + i * 0.1 + Math.random() * 0.3
                    });
                }
                return data;
            },
            
            generateBudgetBurndown: function(durationMonths) {
                var data = [];
                var remaining = 100;
                for (var i = 0; i <= durationMonths; i += 3) {
                    var burn = i === 0 ? 0 : 15 + Math.random() * 10;
                    remaining = Math.max(0, remaining - burn);
                    data.push({
                        month: i,
                        planned: 100 - (i / durationMonths) * 100,
                        actual: i <= 9 ? remaining : null
                    });
                }
                return data;
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 7: LOGIC MODEL GENERATOR - Diagramme logique
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var LogicModelGenerator = {
            generate: function(project, strategies, lang) {
                lang = lang || 'fr';
                
                var strategyLabels = strategies.map(function(s) {
                    var strat = KnowledgeGraph.nodes.strategies[s.id || s];
                    return strat ? strat.label[lang] : (s.id || s);
                });
                
                return {
                    inputs: [
                        { id: 'I1', label: lang === 'fr' ? 'Financement' : 'Funding', value: '$' + ((project.budget || 100000) / 1000).toFixed(0) + 'K' },
                        { id: 'I2', label: lang === 'fr' ? 'Personnel' : 'Staff', value: (project.staff || 10) + ' ETP' },
                        { id: 'I3', label: lang === 'fr' ? 'Infrastructure' : 'Infrastructure', value: (project.sites || 5) + ' sites' },
                        { id: 'I4', label: lang === 'fr' ? 'Expertise technique' : 'Technical expertise', value: lang === 'fr' ? 'Ã‰quipe projet' : 'Project team' },
                        { id: 'I5', label: lang === 'fr' ? 'Partenariats' : 'Partnerships', value: (project.partners || 3) + ' partenaires' }
                    ],
                    activities: strategyLabels.slice(0, 6).map(function(label, i) {
                        return { id: 'A' + (i + 1), label: label };
                    }),
                    outputs: [
                        { id: 'O1', label: lang === 'fr' ? 'Professionnels formÃ©s' : 'Professionals trained', target: project.population || 100 },
                        { id: 'O2', label: lang === 'fr' ? 'Sessions supervision' : 'Supervision sessions', target: (project.duration || 24) * 4 },
                        { id: 'O3', label: lang === 'fr' ? 'Outils dÃ©veloppÃ©s' : 'Tools developed', target: 5 },
                        { id: 'O4', label: lang === 'fr' ? 'Sites actifs' : 'Active sites', target: project.sites || 5 },
                        { id: 'O5', label: lang === 'fr' ? 'RÃ©unions parties prenantes' : 'Stakeholder meetings', target: (project.duration || 24) / 3 }
                    ],
                    outcomes: {
                        shortTerm: [
                            { id: 'ST1', label: lang === 'fr' ? 'Connaissances amÃ©liorÃ©es' : 'Improved knowledge' },
                            { id: 'ST2', label: lang === 'fr' ? 'Attitudes positives' : 'Positive attitudes' },
                            { id: 'ST3', label: lang === 'fr' ? 'Confiance accrue' : 'Increased confidence' }
                        ],
                        mediumTerm: [
                            { id: 'MT1', label: lang === 'fr' ? 'Changement de pratiques' : 'Practice change' },
                            { id: 'MT2', label: lang === 'fr' ? 'Adoption de l\'innovation' : 'Innovation adoption' },
                            { id: 'MT3', label: lang === 'fr' ? 'QualitÃ© amÃ©liorÃ©e' : 'Improved quality' }
                        ],
                        longTerm: [
                            { id: 'LT1', label: lang === 'fr' ? 'Outcomes santÃ© amÃ©liorÃ©s' : 'Improved health outcomes' },
                            { id: 'LT2', label: lang === 'fr' ? 'SystÃ¨me renforcÃ©' : 'Strengthened system' },
                            { id: 'LT3', label: lang === 'fr' ? 'Changement pÃ©renne' : 'Sustained change' }
                        ]
                    },
                    impact: {
                        label: lang === 'fr' ? 'Impact final' : 'Final Impact',
                        statement: lang === 'fr'
                            ? 'AmÃ©lioration durable de la santÃ© et du bien-Ãªtre de la population cible'
                            : 'Sustained improvement in health and well-being of target population'
                    },
                    assumptions: [
                        lang === 'fr' ? 'Le financement reste stable' : 'Funding remains stable',
                        lang === 'fr' ? 'Le contexte politique est favorable' : 'Political context is favorable',
                        lang === 'fr' ? 'Les professionnels sont disponibles' : 'Professionals are available'
                    ],
                    externalFactors: [
                        lang === 'fr' ? 'Ã‰volution des politiques nationales' : 'National policy evolution',
                        lang === 'fr' ? 'Contexte Ã©conomique' : 'Economic context',
                        lang === 'fr' ? 'Autres interventions' : 'Other interventions'
                    ],
                    generatedAt: new Date().toISOString()
                };
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 8: MONTE CARLO SIMULATOR - Simulation probabiliste
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var MonteCarloSimulator = {
            run: function(project, strategies, iterations, lang) {
                lang = lang || 'fr';
                iterations = iterations || 10000;
                
                var results = [];
                var strategyIds = strategies.map(function(s) { return s.id || s; });
                
                // ParamÃ¨tres de base
                var baseSuccess = 0.45;
                var strategyBonus = strategyIds.length * 0.03;
                
                // ExÃ©cuter les simulations
                for (var i = 0; i < iterations; i++) {
                    // Variations alÃ©atoires
                    var contextVariation = (Math.random() - 0.5) * 0.3;
                    var implementationQuality = 0.7 + Math.random() * 0.3;
                    var externalFactors = (Math.random() - 0.5) * 0.2;
                    
                    var successProb = baseSuccess + strategyBonus + contextVariation * implementationQuality + externalFactors;
                    successProb = Math.max(0.1, Math.min(0.95, successProb));
                    
                    results.push(Math.round(successProb * 100));
                }
                
                // Calcul des statistiques
                results.sort(function(a, b) { return a - b; });
                
                var mean = results.reduce(function(a, b) { return a + b; }, 0) / iterations;
                var variance = results.reduce(function(a, b) { return a + Math.pow(b - mean, 2); }, 0) / iterations;
                var stdDev = Math.sqrt(variance);
                
                var p5 = results[Math.floor(iterations * 0.05)];
                var p25 = results[Math.floor(iterations * 0.25)];
                var p50 = results[Math.floor(iterations * 0.50)];
                var p75 = results[Math.floor(iterations * 0.75)];
                var p95 = results[Math.floor(iterations * 0.95)];
                
                // Distribution pour histogramme
                var histogram = {};
                for (var j = 0; j <= 100; j += 5) {
                    histogram[j] = 0;
                }
                results.forEach(function(r) {
                    var bucket = Math.floor(r / 5) * 5;
                    histogram[bucket]++;
                });
                
                var histogramData = Object.keys(histogram).map(function(k) {
                    return { range: k + '-' + (parseInt(k) + 5), count: histogram[k], percentage: (histogram[k] / iterations * 100).toFixed(1) };
                });
                
                return {
                    iterations: iterations,
                    statistics: {
                        mean: Math.round(mean),
                        median: p50,
                        stdDev: Math.round(stdDev * 10) / 10,
                        min: results[0],
                        max: results[iterations - 1]
                    },
                    percentiles: {
                        p5: p5,
                        p25: p25,
                        p50: p50,
                        p75: p75,
                        p95: p95
                    },
                    confidenceIntervals: {
                        ci90: { lower: p5, upper: p95 },
                        ci50: { lower: p25, upper: p75 }
                    },
                    histogram: histogramData,
                    interpretation: {
                        fr: 'Avec 90% de confiance, le taux de succÃ¨s sera entre ' + p5 + '% et ' + p95 + '%. La valeur la plus probable est ' + p50 + '%.',
                        en: 'With 90% confidence, success rate will be between ' + p5 + '% and ' + p95 + '%. Most likely value is ' + p50 + '%.'
                    }[lang],
                    riskAssessment: {
                        probabilityBelow50: Math.round(results.filter(function(r) { return r < 50; }).length / iterations * 100),
                        probabilityAbove70: Math.round(results.filter(function(r) { return r >= 70; }).length / iterations * 100)
                    },
                    generatedAt: new Date().toISOString()
                };
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 9: ADVANCED NLP ANALYZER - Analyse barriÃ¨res par IA
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var AdvancedNLPAnalyzer = {
            // Dictionnaires enrichis par catÃ©gorie de barriÃ¨re
            barrierLexicons: {
                capacity: {
                    keywords: {
                        fr: ['formation', 'compÃ©tence', 'connaissance', 'savoir', 'expertise', 'qualification', 'capacitÃ©', 'aptitude', 'maÃ®trise', 'expÃ©rience', 'novice', 'dÃ©butant', 'inexpÃ©rimentÃ©', 'apprendre', 'apprentissage'],
                        en: ['training', 'skill', 'knowledge', 'expertise', 'qualification', 'capacity', 'ability', 'mastery', 'experience', 'novice', 'beginner', 'inexperienced', 'learn', 'learning']
                    },
                    weight: 1.0,
                    strategies: ['S01', 'S14', 'S09']
                },
                motivation: {
                    keywords: {
                        fr: ['motivation', 'rÃ©sistance', 'rÃ©ticent', 'refus', 'opposition', 'engagement', 'adhÃ©sion', 'conviction', 'volontÃ©', 'intÃ©rÃªt', 'enthousiasme', 'dÃ©motivÃ©', 'burnout', 'Ã©puisement', 'lassitude'],
                        en: ['motivation', 'resistance', 'reluctant', 'refusal', 'opposition', 'engagement', 'commitment', 'willingness', 'interest', 'enthusiasm', 'demotivated', 'burnout', 'exhaustion', 'fatigue']
                    },
                    weight: 0.95,
                    strategies: ['S04', 'S06', 'S15']
                },
                resources: {
                    keywords: {
                        fr: ['budget', 'financement', 'ressource', 'argent', 'coÃ»t', 'moyens', 'matÃ©riel', 'Ã©quipement', 'infrastructure', 'personnel', 'effectif', 'temps', 'surcharge', 'manque'],
                        en: ['budget', 'funding', 'resource', 'money', 'cost', 'means', 'material', 'equipment', 'infrastructure', 'staff', 'personnel', 'time', 'overload', 'lack']
                    },
                    weight: 0.9,
                    strategies: ['S06', 'S19', 'S17']
                },
                organizational: {
                    keywords: {
                        fr: ['direction', 'leadership', 'hiÃ©rarchie', 'management', 'organisation', 'structure', 'bureaucratie', 'procÃ©dure', 'protocole', 'politique', 'dÃ©cision', 'gouvernance', 'silo', 'cloisonnement'],
                        en: ['leadership', 'management', 'hierarchy', 'organization', 'structure', 'bureaucracy', 'procedure', 'protocol', 'policy', 'decision', 'governance', 'silo', 'compartmentalization']
                    },
                    weight: 0.9,
                    strategies: ['S07', 'S20', 'S04']
                },
                cultural: {
                    keywords: {
                        fr: ['culture', 'tradition', 'croyance', 'religion', 'tabou', 'stigma', 'stigmatisation', 'discrimination', 'prÃ©jugÃ©', 'mentalitÃ©', 'attitude', 'perception', 'acceptabilitÃ©', 'norme'],
                        en: ['culture', 'tradition', 'belief', 'religion', 'taboo', 'stigma', 'stigmatization', 'discrimination', 'prejudice', 'mentality', 'attitude', 'perception', 'acceptability', 'norm']
                    },
                    weight: 0.95,
                    strategies: ['S08', 'S18', 'S11']
                },
                technical: {
                    keywords: {
                        fr: ['technique', 'technologie', 'informatique', 'systÃ¨me', 'logiciel', 'donnÃ©es', 'digital', 'numÃ©rique', 'connexion', 'internet', 'ordinateur', 'application', 'bug', 'panne'],
                        en: ['technical', 'technology', 'IT', 'system', 'software', 'data', 'digital', 'connection', 'internet', 'computer', 'application', 'bug', 'failure']
                    },
                    weight: 0.8,
                    strategies: ['S13', 'S09', 'S05']
                },
                communication: {
                    keywords: {
                        fr: ['communication', 'information', 'diffusion', 'partage', 'coordination', 'collaboration', 'rÃ©union', 'feedback', 'retour', 'Ã©change', 'dialogue', 'transparence', 'confiance'],
                        en: ['communication', 'information', 'dissemination', 'sharing', 'coordination', 'collaboration', 'meeting', 'feedback', 'exchange', 'dialogue', 'transparency', 'trust']
                    },
                    weight: 0.75,
                    strategies: ['S03', 'S20', 'S12']
                },
                contextual: {
                    keywords: {
                        fr: ['rural', 'urbain', 'gÃ©ographique', 'distance', 'accÃ¨s', 'accessibilitÃ©', 'transport', 'isolement', 'Ã©loignement', 'territoire', 'rÃ©gion', 'local'],
                        en: ['rural', 'urban', 'geographic', 'distance', 'access', 'accessibility', 'transport', 'isolation', 'remoteness', 'territory', 'region', 'local']
                    },
                    weight: 0.85,
                    strategies: ['S19', 'S17', 'S08']
                }
            },
            
            // Patterns de phrases complexes
            complexPatterns: {
                fr: [
                    { pattern: /pas\s+(de\s+)?(formation|compÃ©tence|connaissance)/i, category: 'capacity', boost: 0.3 },
                    { pattern: /manque\s+(de\s+)?(temps|ressource|moyen|personnel|budget)/i, category: 'resources', boost: 0.3 },
                    { pattern: /rÃ©sist\w+\s+(au|Ã  la)?\s*chang/i, category: 'motivation', boost: 0.4 },
                    { pattern: /(stigma|tabou|honte)\s+\w*\s*(mental|psy)/i, category: 'cultural', boost: 0.5 },
                    { pattern: /direction\s+\w*\s*(pas|ne\s+pas|non)\s+\w*\s*(soutien|support|engage)/i, category: 'organizational', boost: 0.4 },
                    { pattern: /zone\s+(rurale|isolÃ©e|Ã©loignÃ©e)/i, category: 'contextual', boost: 0.3 },
                    { pattern: /systÃ¨me\s+\w*\s*(obsolÃ¨te|ancien|dÃ©passÃ©)/i, category: 'technical', boost: 0.3 }
                ],
                en: [
                    { pattern: /lack\s+of\s+(training|skill|knowledge)/i, category: 'capacity', boost: 0.3 },
                    { pattern: /lack\s+of\s+(time|resource|staff|budget|funding)/i, category: 'resources', boost: 0.3 },
                    { pattern: /resist\w+\s+to\s+chang/i, category: 'motivation', boost: 0.4 },
                    { pattern: /(stigma|taboo|shame)\s+\w*\s*(mental|psych)/i, category: 'cultural', boost: 0.5 },
                    { pattern: /leadership\s+\w*\s*(not|no|lack)\s+\w*\s*(support|engage)/i, category: 'organizational', boost: 0.4 },
                    { pattern: /(rural|remote|isolated)\s+area/i, category: 'contextual', boost: 0.3 },
                    { pattern: /(outdated|legacy|old)\s+system/i, category: 'technical', boost: 0.3 }
                ]
            },
            
            analyzeBarriers: function(text, lang) {
                lang = lang || 'fr';
                var self = this;
                
                if (!text || text.length < 10) {
                    return { barriers: [], confidence: 0, recommendations: [] };
                }
                
                var normalizedText = text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                var scores = {};
                var matchedKeywords = {};
                
                // Initialiser
                Object.keys(this.barrierLexicons).forEach(function(cat) {
                    scores[cat] = 0;
                    matchedKeywords[cat] = [];
                });
                
                // Analyse par mots-clÃ©s
                Object.keys(this.barrierLexicons).forEach(function(category) {
                    var lexicon = self.barrierLexicons[category];
                    var keywords = lexicon.keywords[lang] || lexicon.keywords.fr;
                    
                    keywords.forEach(function(kw) {
                        var normalizedKw = kw.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                        var regex = new RegExp('\\b' + normalizedKw + '\\w*', 'gi');
                        var matches = normalizedText.match(regex);
                        if (matches) {
                            scores[category] += matches.length * lexicon.weight;
                            matchedKeywords[category].push(kw);
                        }
                    });
                });
                
                // Analyse par patterns complexes
                this.complexPatterns[lang].forEach(function(p) {
                    if (p.pattern.test(text)) {
                        scores[p.category] += p.boost * 10;
                    }
                });
                
                // Normaliser et filtrer
                var maxScore = Math.max.apply(null, Object.values(scores).concat([1]));
                var barriers = [];
                
                Object.keys(scores).forEach(function(category) {
                    var normalizedScore = scores[category] / maxScore;
                    if (normalizedScore > 0.2) {
                        barriers.push({
                            category: category,
                            label: self.getCategoryLabel(category, lang),
                            score: Math.round(normalizedScore * 100),
                            confidence: normalizedScore > 0.6 ? 'high' : normalizedScore > 0.4 ? 'medium' : 'low',
                            keywords: Array.from(new Set(matchedKeywords[category])).slice(0, 5),
                            strategies: self.barrierLexicons[category].strategies
                        });
                    }
                });
                
                // Trier par score
                barriers.sort(function(a, b) { return b.score - a.score; });
                
                // GÃ©nÃ©rer recommandations
                var recommendations = [];
                barriers.slice(0, 3).forEach(function(b) {
                    b.strategies.forEach(function(sid) {
                        var strat = KnowledgeGraph.nodes.strategies[sid];
                        if (strat && recommendations.length < 5) {
                            recommendations.push({
                                strategyId: sid,
                                strategyName: strat.label[lang],
                                reason: lang === 'fr' 
                                    ? 'Pour adresser: ' + b.label
                                    : 'To address: ' + b.label
                            });
                        }
                    });
                });
                
                // DÃ©dupliquer recommandations
                var seen = {};
                recommendations = recommendations.filter(function(r) {
                    if (seen[r.strategyId]) return false;
                    seen[r.strategyId] = true;
                    return true;
                });
                
                return {
                    text: text.substring(0, 200) + (text.length > 200 ? '...' : ''),
                    textLength: text.length,
                    barriers: barriers,
                    topBarriers: barriers.slice(0, 3),
                    recommendations: recommendations.slice(0, 5),
                    overallConfidence: barriers.length > 0 
                        ? (barriers.reduce(function(a, b) { return a + b.score; }, 0) / barriers.length / 100)
                        : 0,
                    analysisDepth: text.split(/\s+/).length > 100 ? 'deep' : 'surface',
                    generatedAt: new Date().toISOString()
                };
            },
            
            getCategoryLabel: function(category, lang) {
                var labels = {
                    capacity: { fr: 'CapacitÃ©s/CompÃ©tences', en: 'Capacity/Skills' },
                    motivation: { fr: 'Motivation/RÃ©sistance', en: 'Motivation/Resistance' },
                    resources: { fr: 'Ressources', en: 'Resources' },
                    organizational: { fr: 'Organisationnel', en: 'Organizational' },
                    cultural: { fr: 'Culturel/Social', en: 'Cultural/Social' },
                    technical: { fr: 'Technique', en: 'Technical' },
                    communication: { fr: 'Communication', en: 'Communication' },
                    contextual: { fr: 'Contextuel', en: 'Contextual' }
                };
                return labels[category] ? labels[category][lang] : category;
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE 10: POWERPOINT GENERATOR - Export prÃ©sentation bailleurs
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var PowerPointGenerator = {
            generate: function(project, protocol, lang) {
                lang = lang || 'fr';
                
                var strategies = protocol && protocol.aiRawRecommendations 
                    ? protocol.aiRawRecommendations.strategies.top 
                    : [];
                
                var strategyLabels = strategies.map(function(s) {
                    var strat = KnowledgeGraph.nodes.strategies[s.id || s];
                    return strat ? strat.label[lang] : (s.id || s);
                });
                
                var slides = [
                    {
                        id: 1,
                        type: 'title',
                        title: project.title || (lang === 'fr' ? 'Projet d\'ImplÃ©mentation' : 'Implementation Project'),
                        subtitle: project.organization || '',
                        footer: 'Moudar v8.0 - Science de la Mise en Å’uvre AugmentÃ©e'
                    },
                    {
                        id: 2,
                        type: 'agenda',
                        title: lang === 'fr' ? 'Agenda' : 'Agenda',
                        items: [
                            lang === 'fr' ? 'Contexte et problÃ©matique' : 'Context and problem',
                            lang === 'fr' ? 'StratÃ©gies d\'implÃ©mentation' : 'Implementation strategies',
                            lang === 'fr' ? 'Estimateur heuristique de succÃ¨s' : 'Heuristic success estimator',
                            lang === 'fr' ? 'Budget et ROI' : 'Budget and ROI',
                            lang === 'fr' ? 'Timeline EPIS' : 'EPIS Timeline',
                            lang === 'fr' ? 'Prochaines Ã©tapes' : 'Next steps'
                        ]
                    },
                    {
                        id: 3,
                        type: 'content',
                        title: lang === 'fr' ? 'Contexte et ProblÃ©matique' : 'Context and Problem',
                        content: project.context || (lang === 'fr' ? '[Ã€ complÃ©ter]' : '[To complete]'),
                        keyPoints: [
                            { icon: 'ðŸŽ¯', text: lang === 'fr' ? 'Population cible: ' + (project.population || 100) : 'Target population: ' + (project.population || 100) },
                            { icon: 'ðŸ“', text: lang === 'fr' ? 'Sites: ' + (project.sites || 5) : 'Sites: ' + (project.sites || 5) },
                            { icon: 'â±ï¸', text: lang === 'fr' ? 'DurÃ©e: ' + (project.duration || 24) + ' mois' : 'Duration: ' + (project.duration || 24) + ' months' }
                        ]
                    },
                    {
                        id: 4,
                        type: 'strategies',
                        title: lang === 'fr' ? 'StratÃ©gies d\'ImplÃ©mentation' : 'Implementation Strategies',
                        subtitle: lang === 'fr' ? 'BasÃ©es sur le cadre ERIC' : 'Based on ERIC framework',
                        strategies: strategyLabels.slice(0, 5).map(function(label, i) {
                            return { number: i + 1, label: label };
                        })
                    },
                    {
                        id: 5,
                        type: 'prediction',
                        title: lang === 'fr' ? 'Estimateur Heuristique de SuccÃ¨s' : 'Heuristic Success Estimator',
                        probability: protocol && protocol.aiConfidence ? Math.round(protocol.aiConfidence * 100) : 65,
                        factors: [
                            { type: 'positive', label: lang === 'fr' ? 'Formation prÃ©vue' : 'Training planned', impact: '+12%' },
                            { type: 'positive', label: lang === 'fr' ? 'Champions identifiÃ©s' : 'Champions identified', impact: '+8%' },
                            { type: 'negative', label: lang === 'fr' ? 'Ressources limitÃ©es' : 'Limited resources', impact: '-10%' }
                        ]
                    },
                    {
                        id: 6,
                        type: 'budget',
                        title: lang === 'fr' ? 'Budget et ROI' : 'Budget and ROI',
                        totalBudget: '$' + ((project.budget || 150000) / 1000).toFixed(0) + 'K USD',
                        roi: '+125%',
                        payback: lang === 'fr' ? '18 mois' : '18 months',
                        breakdown: [
                            { category: lang === 'fr' ? 'Formation' : 'Training', percentage: 35 },
                            { category: lang === 'fr' ? 'Supervision' : 'Supervision', percentage: 25 },
                            { category: lang === 'fr' ? 'Coordination' : 'Coordination', percentage: 20 },
                            { category: lang === 'fr' ? 'Ã‰valuation' : 'Evaluation', percentage: 10 },
                            { category: lang === 'fr' ? 'ImprÃ©vus' : 'Contingency', percentage: 10 }
                        ]
                    },
                    {
                        id: 7,
                        type: 'timeline',
                        title: lang === 'fr' ? 'Timeline EPIS' : 'EPIS Timeline',
                        phases: [
                            { name: 'Exploration', duration: '3 mois', color: '#3b82f6' },
                            { name: lang === 'fr' ? 'PrÃ©paration' : 'Preparation', duration: '6 mois', color: '#8b5cf6' },
                            { name: lang === 'fr' ? 'ImplÃ©mentation' : 'Implementation', duration: '12 mois', color: '#10b981' },
                            { name: lang === 'fr' ? 'PÃ©rennisation' : 'Sustainment', duration: '3 mois', color: '#f59e0b' }
                        ]
                    },
                    {
                        id: 8,
                        type: 'nextSteps',
                        title: lang === 'fr' ? 'Prochaines Ã‰tapes' : 'Next Steps',
                        steps: [
                            { timeline: lang === 'fr' ? 'Semaine 1-2' : 'Week 1-2', action: lang === 'fr' ? 'Validation du protocole' : 'Protocol validation' },
                            { timeline: lang === 'fr' ? 'Semaine 3-4' : 'Week 3-4', action: lang === 'fr' ? 'Recrutement Ã©quipe' : 'Team recruitment' },
                            { timeline: lang === 'fr' ? 'Mois 2' : 'Month 2', action: lang === 'fr' ? 'Lancement formation' : 'Training launch' },
                            { timeline: lang === 'fr' ? 'Mois 3' : 'Month 3', action: lang === 'fr' ? 'DÃ©marrage pilote' : 'Pilot start' }
                        ],
                        callToAction: lang === 'fr' ? 'PrÃªt Ã  dÃ©marrer ?' : 'Ready to start?'
                    },
                    {
                        id: 9,
                        type: 'closing',
                        title: lang === 'fr' ? 'Merci' : 'Thank You',
                        contact: project.organization || 'contact@moudar.com',
                        tagline: lang === 'fr' 
                            ? 'PropulsÃ© par Moudar - Science de la Mise en Å’uvre AugmentÃ©e'
                            : 'Powered by Moudar - Augmented Implementation Science'
                    }
                ];
                
                return {
                    title: project.title || 'Implementation Project',
                    slideCount: slides.length,
                    slides: slides,
                    theme: {
                        primaryColor: '#3b82f6',
                        secondaryColor: '#10b981',
                        accentColor: '#8b5cf6',
                        fontFamily: 'Inter, sans-serif'
                    },
                    metadata: {
                        author: project.organization || 'Moudar User',
                        created: new Date().toISOString(),
                        generator: 'Moudar v8.0'
                    },
                    generatedAt: new Date().toISOString()
                };
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULES v8.0 - WORLD REFERENCE PLATFORM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // 1. EXPLAINABLE AI (XAI) - Moteur transparent
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var ExplainableAI = {
            // GÃ©nÃ¨re une explication dÃ©taillÃ©e pour chaque stratÃ©gie recommandÃ©e
            explainStrategy: function(strategy, context, lang) {
                var l = lang || 'fr';
                var reasons = [];
                var frameworks = [];
                var confidence = 0.5;
                var evidenceLevel = 'moderate';
                
                // Analyse du contexte pour justifier la recommandation
                if (context.phase === 'implementation' && (strategy.id === 'S02' || strategy.name === 'audit_feedback')) {
                    reasons.push(l === 'fr' 
                        ? "Vous Ãªtes en phase d'implÃ©mentation oÃ¹ le suivi des indicateurs est crucial"
                        : "You are in implementation phase where indicator monitoring is crucial");
                    frameworks.push({ name: 'EPIS', construct: l === 'fr' ? 'Phase ImplÃ©mentation' : 'Implementation Phase' });
                    confidence += 0.15;
                }
                
                if (context.barriers && context.barriers.includes('low_fidelity') && (strategy.id === 'S02')) {
                    reasons.push(l === 'fr'
                        ? "Vous avez dÃ©clarÃ© une faible fidÃ©litÃ© au protocole - l'audit permet un retour correctif"
                        : "You reported low protocol fidelity - audit enables corrective feedback");
                    frameworks.push({ name: 'CFIR', construct: l === 'fr' ? 'QualitÃ© de l\'exÃ©cution' : 'Quality of Execution' });
                    confidence += 0.2;
                }
                
                if (context.barriers && context.barriers.includes('resistance') && (strategy.id === 'S04' || strategy.id === 'S08')) {
                    reasons.push(l === 'fr'
                        ? "RÃ©sistance au changement dÃ©tectÃ©e - l'engagement des parties prenantes rÃ©duit les rÃ©sistances"
                        : "Change resistance detected - stakeholder engagement reduces resistance");
                    frameworks.push({ name: 'CFIR', construct: l === 'fr' ? 'Climat d\'implÃ©mentation' : 'Implementation Climate' });
                    confidence += 0.2;
                }
                
                if (context.barriers && context.barriers.includes('workforce_shortage') && (strategy.id === 'S19' || strategy.id === 'S15')) {
                    reasons.push(l === 'fr'
                        ? "PÃ©nurie de personnel identifiÃ©e - le task-shifting optimise les ressources humaines disponibles"
                        : "Workforce shortage identified - task-shifting optimizes available human resources");
                    frameworks.push({ name: 'ERIC', construct: 'Task Shifting' });
                    confidence += 0.2;
                }
                
                if (context.barriers && context.barriers.includes('stigma') && (strategy.id === 'S08' || strategy.id === 'S18')) {
                    reasons.push(l === 'fr'
                        ? "Stigmatisation prÃ©sente - l'engagement communautaire et la communication rÃ©duisent la stigma"
                        : "Stigma present - community engagement and communication reduce stigma");
                    frameworks.push({ name: 'RE-AIM', construct: 'Reach' });
                    confidence += 0.2;
                }
                
                if (context.income === 'LIC' || context.income === 'LMIC') {
                    reasons.push(l === 'fr'
                        ? "Contexte ressources limitÃ©es - stratÃ©gies adaptÃ©es aux PRFI validÃ©es par l'OMS"
                        : "Low-resource context - LMIC-adapted strategies validated by WHO");
                    frameworks.push({ name: 'WHO mhGAP', construct: l === 'fr' ? 'Adaptation contextuelle' : 'Contextual Adaptation' });
                    confidence += 0.1;
                }
                
                if (strategy.id === 'S01' || strategy.name === 'training') {
                    reasons.push(l === 'fr'
                        ? "Formation essentielle pour renforcer les compÃ©tences de l'Ã©quipe"
                        : "Essential training to strengthen team skills");
                    frameworks.push({ name: 'ERIC', construct: l === 'fr' ? 'Formation des professionnels' : 'Train & Educate Stakeholders' });
                    confidence += 0.1;
                }
                
                // Ajouter une raison par dÃ©faut si aucune spÃ©cifique
                if (reasons.length === 0) {
                    reasons.push(l === 'fr'
                        ? "StratÃ©gie recommandÃ©e basÃ©e sur le profil gÃ©nÃ©ral de votre projet"
                        : "Strategy recommended based on your project's general profile");
                    frameworks.push({ name: 'ERIC', construct: l === 'fr' ? 'Compilation Powell et al.' : 'Powell et al. Compilation' });
                }
                
                // Calculer le niveau de preuve
                if (confidence > 0.8) evidenceLevel = 'strong';
                else if (confidence > 0.6) evidenceLevel = 'moderate';
                else evidenceLevel = 'emerging';
                
                // RÃ©fÃ©rences scientifiques
                var references = [
                    { authors: 'Powell BJ et al.', year: 2015, title: 'A refined compilation of implementation strategies', journal: 'Implementation Science' },
                    { authors: 'Damschroder LJ et al.', year: 2022, title: 'The updated CFIR', journal: 'Implementation Science' }
                ];
                if (frameworks.some(function(f) { return f.name === 'RE-AIM'; })) {
                    references.push({ authors: 'Glasgow RE et al.', year: 2019, title: 'RE-AIM Planning and Evaluation Framework', journal: 'Frontiers in Public Health' });
                }
                
                return {
                    strategyId: strategy.id,
                    strategyName: strategy.name && typeof strategy.name === 'object' ? strategy.name : { fr: strategy.name || strategy.label || strategy.id, en: strategy.name || strategy.label || strategy.id },
                    confidence: Math.min(confidence, 0.95),
                    confidenceLevel: confidence > 0.8 ? 'high' : confidence > 0.6 ? 'medium' : 'low',
                    evidenceLevel: evidenceLevel,
                    reasons: reasons,
                    frameworks: frameworks,
                    references: references,
                    generatedAt: new Date().toISOString(),
                    disclaimer: l === 'fr' 
                        ? "Cette recommandation est basÃ©e sur les cadres validÃ©s de la Science de la mise en Å“uvre. Adaptez selon votre contexte local."
                        : "This recommendation is based on validated Implementation Science frameworks. Adapt to your local context."
                };
            },
            
            // GÃ©nÃ¨re un rapport XAI complet pour tout le protocole
            generateXAIReport: function(protocol, context, lang) {
                var self = this;
                var l = lang || 'fr';
                var kg = KnowledgeGraph.nodes;
                
                // RÃ©cupÃ©rer les stratÃ©gies depuis plusieurs sources possibles
                var strategies = [];
                
                // Source 1: aiRawRecommendations.strategies.top
                if (protocol.aiRawRecommendations && protocol.aiRawRecommendations.strategies && protocol.aiRawRecommendations.strategies.top) {
                    strategies = protocol.aiRawRecommendations.strategies.top.map(function(s) {
                        var stratNode = kg.strategies[s.id || s];
                        return {
                            id: s.id || s,
                            name: stratNode ? stratNode.label : { fr: s.id || s, en: s.id || s },
                            score: s.score || 0.8
                        };
                    });
                }
                // Source 2: protocol.strategies (tableau de strings)
                else if (protocol.strategies && protocol.strategies.length > 0) {
                    strategies = protocol.strategies.slice(0, 5).map(function(s, idx) {
                        // Chercher dans le KnowledgeGraph
                        var stratNode = null;
                        Object.keys(kg.strategies).forEach(function(sid) {
                            var strat = kg.strategies[sid];
                            if (strat.label && (strat.label.fr === s || strat.label.en === s)) {
                                stratNode = strat;
                            }
                        });
                        return {
                            id: stratNode ? stratNode.id : 'S0' + (idx + 1),
                            name: stratNode ? stratNode.label : { fr: s, en: s },
                            score: 0.8 - (idx * 0.1)
                        };
                    });
                }
                // Source 3: GÃ©nÃ©rer des stratÃ©gies par dÃ©faut basÃ©es sur le contexte
                else {
                    var defaultStrategies = ['S01', 'S03', 'S04', 'S08'];
                    if (context && context.phase === 'implementation') defaultStrategies.push('S02');
                    if (context && context.barriers && context.barriers.includes('stigma')) defaultStrategies.push('S18');
                    
                    strategies = defaultStrategies.slice(0, 5).map(function(sid, idx) {
                        var stratNode = kg.strategies[sid];
                        return {
                            id: sid,
                            name: stratNode ? stratNode.label : { fr: 'StratÃ©gie ' + sid, en: 'Strategy ' + sid },
                            score: 0.85 - (idx * 0.05)
                        };
                    });
                }
                
                // Enrichir le contexte avec les donnÃ©es du protocol
                var enrichedContext = Object.assign({}, context || {}, {
                    phase: context && context.phase ? context.phase : (protocol.phase || 'preparation'),
                    barriers: context && context.barriers ? context.barriers : (protocol.aiDetectedBarriers || []),
                    domain: context && context.domain ? context.domain : (protocol.domain || 'health')
                });
                
                // GÃ©nÃ©rer les explications pour chaque stratÃ©gie
                var explanations = strategies.map(function(s) {
                    return self.explainStrategy(s, enrichedContext, l);
                });
                
                // Calculer la confiance globale
                var overallConfidence = explanations.length > 0 
                    ? explanations.reduce(function(sum, e) { return sum + e.confidence; }, 0) / explanations.length 
                    : 0.7;
                
                // Ajuster la confiance basÃ©e sur la complÃ©tude des donnÃ©es
                if (protocol.aiConfidence) {
                    overallConfidence = (overallConfidence + protocol.aiConfidence) / 2;
                }
                
                return {
                    title: l === 'fr' ? "Rapport de Transparence IA Moudar" : "Moudar AI Transparency Report",
                    projectTitle: protocol.title || (context && context.title) || "Projet",
                    overallConfidence: overallConfidence,
                    explanations: explanations,
                    methodology: l === 'fr' 
                        ? "Moudar utilise un graphe de connaissances basÃ© sur CFIR 2.0, RE-AIM, EPIS et 73 stratÃ©gies ERIC pour gÃ©nÃ©rer des recommandations contextualisÃ©es."
                        : "Moudar uses a knowledge graph based on CFIR 2.0, RE-AIM, EPIS and 73 ERIC strategies to generate contextualized recommendations.",
                    generatedAt: new Date().toISOString()
                };
            }
        };
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // 2. DOCUMENT ANALYZER - Analyse de documents existants
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var DocumentAnalyzer = {
            // Extraction d'Ã©lÃ©ments clÃ©s d'un texte de protocole
            extractElements: function(text, lang) {
                var l = lang || 'fr';
                var elements = {
                    context: null,
                    population: null,
                    intervention: null,
                    barriers: [],
                    phase: null,
                    objectives: [],
                    outcomes: { implementation: [], clinical: [] },
                    strategies: [],
                    timeline: null,
                    budget: null
                };
                
                var textLower = text.toLowerCase();
                
                // DÃ©tection de la population
                var populationPatterns = [
                    { regex: /population\s*[:\-]?\s*([^\.]+)/i, field: 'population' },
                    { regex: /patients?\s+([^\.]{10,50})/i, field: 'population' },
                    { regex: /participants?\s*[:\-]?\s*(\d+)/i, field: 'sampleSize' },
                    { regex: /(\d+)\s*(?:participants?|patients?|personnes?)/i, field: 'sampleSize' }
                ];
                
                populationPatterns.forEach(function(p) {
                    var match = text.match(p.regex);
                    if (match) {
                        if (p.field === 'population') elements.population = match[1].trim();
                        if (p.field === 'sampleSize') elements.sampleSize = parseInt(match[1]);
                    }
                });
                
                // DÃ©tection du contexte
                if (textLower.includes('hÃ´pital') || textLower.includes('hospital') || textLower.includes('chu')) {
                    elements.context = l === 'fr' ? 'HÃ´pital / Centre hospitalier' : 'Hospital / Medical center';
                }
                if (textLower.includes('centre de santÃ©') || textLower.includes('health center') || textLower.includes('primary care')) {
                    elements.context = l === 'fr' ? 'Soins primaires' : 'Primary care';
                }
                if (textLower.includes('communautÃ©') || textLower.includes('community')) {
                    elements.context = l === 'fr' ? 'Communautaire' : 'Community-based';
                }
                
                // DÃ©tection des barriÃ¨res
                var barrierKeywords = {
                    resistance: ['rÃ©sistance', 'resistance', 'refus', 'opposition'],
                    resources: ['ressources limitÃ©es', 'limited resources', 'budget contraint', 'manque de moyens'],
                    workforce: ['pÃ©nurie', 'shortage', 'manque de personnel', 'understaffed'],
                    stigma: ['stigma', 'stigmatisation', 'discrimination'],
                    training: ['formation insuffisante', 'lack of training', 'compÃ©tences manquantes']
                };
                
                Object.keys(barrierKeywords).forEach(function(barrier) {
                    barrierKeywords[barrier].forEach(function(keyword) {
                        if (textLower.includes(keyword)) {
                            elements.barriers.push(barrier);
                        }
                    });
                });
                elements.barriers = Array.from(new Set(elements.barriers)); // DÃ©dupliquer
                
                // DÃ©tection de la phase
                if (textLower.includes('exploration') || textLower.includes('feasibility') || textLower.includes('faisabilitÃ©')) {
                    elements.phase = 'exploration';
                } else if (textLower.includes('prÃ©paration') || textLower.includes('preparation') || textLower.includes('pilote')) {
                    elements.phase = 'preparation';
                } else if (textLower.includes('dÃ©ploiement') || textLower.includes('rollout') || textLower.includes('implÃ©mentation')) {
                    elements.phase = 'implementation';
                } else if (textLower.includes('pÃ©rennisation') || textLower.includes('sustainment') || textLower.includes('scale-up')) {
                    elements.phase = 'sustainment';
                }
                
                // DÃ©tection des outcomes
                var implementationOutcomes = ['adoption', 'acceptabilitÃ©', 'acceptability', 'fidÃ©litÃ©', 'fidelity', 'feasibility', 'reach', 'penetration', 'sustainability'];
                var clinicalOutcomes = ['mortalitÃ©', 'mortality', 'morbiditÃ©', 'morbidity', 'qualitÃ© de vie', 'quality of life', 'symptÃ´mes', 'symptoms'];
                
                implementationOutcomes.forEach(function(o) {
                    if (textLower.includes(o)) elements.outcomes.implementation.push(o);
                });
                clinicalOutcomes.forEach(function(o) {
                    if (textLower.includes(o)) elements.outcomes.clinical.push(o);
                });
                
                // DÃ©tection de la durÃ©e
                var durationMatch = text.match(/(\d+)\s*(?:mois|months?|ans?|years?)/i);
                if (durationMatch) {
                    var num = parseInt(durationMatch[1]);
                    var unit = durationMatch[0].toLowerCase().includes('an') || durationMatch[0].toLowerCase().includes('year') ? 'years' : 'months';
                    elements.timeline = unit === 'years' ? num * 12 : num;
                }
                
                // DÃ©tection du budget
                var budgetMatch = text.match(/(\d[\d\s,\.]*)\s*(?:â‚¬|EUR|USD|\$|MAD|CHF)/i);
                if (budgetMatch) {
                    elements.budget = budgetMatch[0];
                }
                
                return elements;
            },
            
            // Identifier les gaps IS dans un protocole
            identifyGaps: function(text, lang) {
                var l = lang || 'fr';
                var gaps = [];
                var textLower = text.toLowerCase();
                
                // Liste des Ã©lÃ©ments IS essentiels
                var isChecklist = [
                    { id: 'framework', keywords: ['cfir', 're-aim', 'epis', 'proctor', 'cadre thÃ©orique', 'theoretical framework'], 
                      missing: l === 'fr' ? "Cadre thÃ©orique d'implÃ©mentation (CFIR, RE-AIM, EPIS...)" : "Implementation theoretical framework (CFIR, RE-AIM, EPIS...)" },
                    { id: 'strategies', keywords: ['stratÃ©gie', 'strategy', 'eric', 'implementation strateg'], 
                      missing: l === 'fr' ? "StratÃ©gies d'implÃ©mentation explicites" : "Explicit implementation strategies" },
                    { id: 'outcomes_impl', keywords: ['outcome', 'adoption', 'fidÃ©litÃ©', 'fidelity', 'acceptability', 'feasibility'], 
                      missing: l === 'fr' ? "Outcomes d'implÃ©mentation (adoption, fidÃ©litÃ©, acceptabilitÃ©...)" : "Implementation outcomes (adoption, fidelity, acceptability...)" },
                    { id: 'adaptation', keywords: ['adaptation', 'contextualisation', 'tailoring', 'local context'], 
                      missing: l === 'fr' ? "Plan d'adaptation au contexte local" : "Local context adaptation plan" },
                    { id: 'stakeholders', keywords: ['parties prenantes', 'stakeholder', 'acteurs', 'champions', 'leaders'], 
                      missing: l === 'fr' ? "Identification et engagement des parties prenantes" : "Stakeholder identification and engagement" },
                    { id: 'barriers', keywords: ['barriÃ¨re', 'barrier', 'obstacle', 'facilitateur', 'facilitator'], 
                      missing: l === 'fr' ? "Analyse des barriÃ¨res et facilitateurs" : "Barriers and facilitators analysis" },
                    { id: 'sustainment', keywords: ['pÃ©rennisation', 'sustainment', 'sustainability', 'institutionnalisation', 'scale-up'], 
                      missing: l === 'fr' ? "Plan de pÃ©rennisation" : "Sustainment plan" },
                    { id: 'evaluation', keywords: ['Ã©valuation', 'evaluation', 'monitoring', 'indicateur', 'kpi', 'measure'], 
                      missing: l === 'fr' ? "Plan d'Ã©valuation et indicateurs" : "Evaluation plan and indicators" },
                    { id: 'tidier', keywords: ['tidier', 'intervention description', 'who delivered', 'where', 'when', 'how much'], 
                      missing: l === 'fr' ? "Description TIDieR de l'intervention" : "TIDieR intervention description" },
                    { id: 'equity', keywords: ['Ã©quitÃ©', 'equity', 'disparitÃ©s', 'disparities', 'vulnerable', 'marginalis'], 
                      missing: l === 'fr' ? "ConsidÃ©rations d'Ã©quitÃ© et populations vulnÃ©rables" : "Equity considerations and vulnerable populations" }
                ];
                
                isChecklist.forEach(function(item) {
                    var found = item.keywords.some(function(kw) { return textLower.includes(kw); });
                    if (!found) {
                        gaps.push({
                            id: item.id,
                            type: 'missing',
                            severity: ['framework', 'strategies', 'outcomes_impl'].includes(item.id) ? 'critical' : 'important',
                            description: item.missing,
                            suggestion: l === 'fr' 
                                ? "Moudar peut gÃ©nÃ©rer cette section automatiquement"
                                : "Moudar can generate this section automatically"
                        });
                    }
                });
                
                return gaps;
            },
            
            // GÃ©nÃ©rer un rapport d'analyse complet
            analyzeDocument: function(text, lang) {
                var l = lang || 'fr';
                var elements = this.extractElements(text, l);
                var gaps = this.identifyGaps(text, l);
                
                var wordCount = text.split(/\s+/).length;
                var criticalGaps = gaps.filter(function(g) { return g.severity === 'critical'; }).length;
                var importantGaps = gaps.filter(function(g) { return g.severity === 'important'; }).length;
                
                // Calcul du score IS
                var totalChecks = 10;
                var passed = totalChecks - gaps.length;
                var score = Math.round((passed / totalChecks) * 100);
                
                // DÃ©terminer les forces
                var strengths = [];
                if (elements.population) strengths.push(l === 'fr' ? "Population cible bien dÃ©finie" : "Well-defined target population");
                if (elements.context) strengths.push(l === 'fr' ? "Contexte d'implÃ©mentation identifiÃ©" : "Implementation context identified");
                if (elements.phase) strengths.push(l === 'fr' ? "Phase EPIS claire" : "Clear EPIS phase");
                if (elements.barriers.length > 0) strengths.push(l === 'fr' ? "BarriÃ¨res identifiÃ©es" : "Barriers identified");
                if (elements.outcomes.implementation.length > 0) strengths.push(l === 'fr' ? "Outcomes d'implÃ©mentation mentionnÃ©s" : "Implementation outcomes mentioned");
                
                return {
                    title: l === 'fr' ? "Analyse IS du Document" : "IS Document Analysis",
                    wordCount: wordCount,
                    extractedElements: elements,
                    gaps: gaps,
                    strengths: strengths,
                    score: score,
                    scoreInterpretation: score >= 80 ? (l === 'fr' ? "Excellent" : "Excellent") :
                                         score >= 60 ? (l === 'fr' ? "Bon, quelques ajouts recommandÃ©s" : "Good, some additions recommended") :
                                         score >= 40 ? (l === 'fr' ? "Partiel, plusieurs Ã©lÃ©ments IS manquants" : "Partial, several IS elements missing") :
                                         (l === 'fr' ? "Insuffisant, rÃ©vision majeure nÃ©cessaire" : "Insufficient, major revision needed"),
                    summary: {
                        criticalGaps: criticalGaps,
                        importantGaps: importantGaps,
                        strengths: strengths.length
                    },
                    generatedAt: new Date().toISOString()
                };
            },
            
            // GÃ©nÃ©rer automatiquement une section manquante
            generateSection: function(sectionId, context, lang) {
                var l = lang || 'fr';
                var sections = {
                    framework: {
                        title: l === 'fr' ? "Cadre thÃ©orique et Science de la mise en Å“uvre" : "Theoretical Framework and Implementation Science",
                        content: l === 'fr' 
                            ? "Ce projet s'appuie sur le Consolidated Framework for Implementation Research (CFIR 2.0) qui identifie 5 domaines influenÃ§ant l'implÃ©mentation : l'innovation, le contexte externe, le contexte interne, les individus, et le processus d'implÃ©mentation. Le modÃ¨le RE-AIM (Reach, Effectiveness, Adoption, Implementation, Maintenance) guidera l'Ã©valuation. Les stratÃ©gies d'implÃ©mentation seront sÃ©lectionnÃ©es selon la taxonomie ERIC (Expert Recommendations for Implementing Change)."
                            : "This project is grounded in the Consolidated Framework for Implementation Research (CFIR 2.0) which identifies 5 domains influencing implementation: the innovation, outer setting, inner setting, individuals, and implementation process. The RE-AIM model (Reach, Effectiveness, Adoption, Implementation, Maintenance) will guide evaluation. Implementation strategies will be selected according to the ERIC taxonomy (Expert Recommendations for Implementing Change)."
                    },
                    strategies: {
                        title: l === 'fr' ? "StratÃ©gies d'implÃ©mentation" : "Implementation Strategies",
                        content: l === 'fr'
                            ? "Les stratÃ©gies d'implÃ©mentation suivantes seront dÃ©ployÃ©es selon les recommandations ERIC : (1) Formation des professionnels pour renforcer les compÃ©tences, (2) Audit et feedback pour suivre la performance, (3) Engagement des parties prenantes pour favoriser l'adhÃ©sion, (4) Champions locaux pour faciliter le changement au niveau des Ã©quipes."
                            : "The following implementation strategies will be deployed according to ERIC recommendations: (1) Training of professionals to strengthen skills, (2) Audit and feedback to monitor performance, (3) Stakeholder engagement to promote buy-in, (4) Local champions to facilitate change at team level."
                    },
                    outcomes_impl: {
                        title: l === 'fr' ? "Outcomes d'implÃ©mentation" : "Implementation Outcomes",
                        content: l === 'fr'
                            ? "Selon le modÃ¨le de Proctor, les outcomes d'implÃ©mentation mesurÃ©s seront : AcceptabilitÃ© (perception par les utilisateurs), Adoption (intention et utilisation initiale), Pertinence (adÃ©quation perÃ§ue), FaisabilitÃ© (praticabilitÃ©), FidÃ©litÃ© (respect du protocole), PÃ©nÃ©tration (intÃ©gration dans le systÃ¨me), PÃ©rennisation (maintien Ã  long terme), CoÃ»ts d'implÃ©mentation."
                            : "According to Proctor's model, implementation outcomes measured will be: Acceptability (user perception), Adoption (intention and initial use), Appropriateness (perceived fit), Feasibility (practicability), Fidelity (protocol adherence), Penetration (system integration), Sustainability (long-term maintenance), Implementation costs."
                    },
                    sustainment: {
                        title: l === 'fr' ? "Plan de pÃ©rennisation" : "Sustainability Plan",
                        content: l === 'fr'
                            ? "Le plan de pÃ©rennisation comprend : (1) IntÃ©gration dans les routines institutionnelles dÃ¨s le mois 6, (2) Transfert de compÃ©tences aux formateurs locaux, (3) Documentation des processus pour rÃ©plicabilitÃ©, (4) Identification de sources de financement pÃ©rennes, (5) CrÃ©ation d'une communautÃ© de pratique pour le soutien continu."
                            : "The sustainability plan includes: (1) Integration into institutional routines from month 6, (2) Capacity transfer to local trainers, (3) Process documentation for replicability, (4) Identification of sustainable funding sources, (5) Creation of a community of practice for ongoing support."
                    }
                };
                
                return sections[sectionId] || {
                    title: l === 'fr' ? "Section non disponible" : "Section not available",
                    content: l === 'fr' ? "Cette section n'est pas encore gÃ©nÃ©rÃ©e automatiquement." : "This section is not yet automatically generated."
                };
            }
        };
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // 3. LEARNING & FEEDBACK SYSTEM - Boucle d'apprentissage
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var LearningFeedback = {
            // DonnÃ©es de feedback simulÃ©es (en production, base de donnÃ©es)
            feedbackData: {
                strategyEffectiveness: {
                    'S01': { uses: 1234, avgRating: 4.2, successRate: 0.72, contexts: { hospital: 0.75, community: 0.68, lmic: 0.71 } },
                    'S02': { uses: 987, avgRating: 4.0, successRate: 0.68, contexts: { hospital: 0.72, community: 0.61, lmic: 0.65 } },
                    'S04': { uses: 856, avgRating: 4.3, successRate: 0.74, contexts: { hospital: 0.76, community: 0.73, lmic: 0.70 } },
                    'S08': { uses: 723, avgRating: 4.5, successRate: 0.78, contexts: { hospital: 0.71, community: 0.82, lmic: 0.79 } },
                    'S19': { uses: 456, avgRating: 4.4, successRate: 0.76, contexts: { hospital: 0.65, community: 0.74, lmic: 0.82 } }
                },
                contextInsights: [
                    { context: 'lmic_mental_health', insight: { fr: "Dans les projets santÃ© mentale en PRFI, le combo champions locaux + adaptation participative surpasse la formation magistrale seule (+18% d'adoption)", en: "In LMIC mental health projects, local champions + participatory adaptation outperforms lecture-based training alone (+18% adoption)" } },
                    { context: 'hospital_chronic', insight: { fr: "En milieu hospitalier pour les maladies chroniques, l'audit-feedback combinÃ© Ã  la facilitation donne les meilleurs rÃ©sultats (fidÃ©litÃ© +22%)", en: "In hospital settings for chronic diseases, audit-feedback combined with facilitation yields best results (fidelity +22%)" } },
                    { context: 'community_prevention', insight: { fr: "Pour la prÃ©vention communautaire, l'engagement des leaders locaux avant le lancement augmente la pÃ©nÃ©tration de 35%", en: "For community prevention, engaging local leaders before launch increases reach by 35%" } }
                ],
                totalProjects: 2847,
                totalFeedbacks: 8934
            },
            
            // Soumettre un feedback sur une stratÃ©gie
            submitFeedback: function(projectId, strategyId, feedback, lang) {
                var l = lang || 'fr';
                // En production : envoyer Ã  l'API
                return {
                    success: true,
                    message: l === 'fr' ? "Merci ! Votre feedback amÃ©liore les recommandations pour tous." : "Thank you! Your feedback improves recommendations for everyone.",
                    feedbackId: 'FB' + Date.now(),
                    pointsEarned: 10
                };
            },
            
            // Obtenir des insights basÃ©s sur le contexte
            getContextInsights: function(context, lang) {
                var l = lang || 'fr';
                var insights = this.feedbackData.contextInsights.filter(function(i) {
                    return context.domain && i.context.includes(context.domain.toLowerCase());
                });
                
                if (insights.length === 0 && context.income) {
                    insights = this.feedbackData.contextInsights.filter(function(i) {
                        return i.context.includes('lmic') && (context.income === 'LIC' || context.income === 'LMIC');
                    });
                }
                
                return {
                    insights: insights.map(function(i) { return i.insight[l]; }),
                    basedOn: this.feedbackData.totalProjects + (l === 'fr' ? ' projets analysÃ©s' : ' projects analyzed'),
                    lastUpdated: new Date().toISOString()
                };
            },
            
            // Obtenir le benchmark d'une stratÃ©gie
            getStrategyBenchmark: function(strategyId, context, lang) {
                var l = lang || 'fr';
                var data = this.feedbackData.strategyEffectiveness[strategyId];
                
                if (!data) {
                    return { available: false, message: l === 'fr' ? "DonnÃ©es insuffisantes pour cette stratÃ©gie" : "Insufficient data for this strategy" };
                }
                
                var contextKey = context.income && (context.income === 'LIC' || context.income === 'LMIC') ? 'lmic' : 
                                 context.setting === 'community' ? 'community' : 'hospital';
                
                return {
                    available: true,
                    strategyId: strategyId,
                    globalSuccessRate: data.successRate,
                    contextSuccessRate: data.contexts[contextKey] || data.successRate,
                    avgRating: data.avgRating,
                    totalUses: data.uses,
                    comparison: l === 'fr' 
                        ? "Cette stratÃ©gie a un taux de succÃ¨s de " + Math.round(data.contexts[contextKey] * 100) + "% dans des contextes similaires."
                        : "This strategy has a " + Math.round(data.contexts[contextKey] * 100) + "% success rate in similar contexts."
                };
            },
            
            // Saisir des indicateurs de suivi
            submitMonitoringData: function(projectId, data, lang) {
                var l = lang || 'fr';
                // data = { adoption: 0.65, fidelity: 0.72, satisfaction: 4.2, strategiesImplemented: ['S01', 'S04'] }
                return {
                    success: true,
                    message: l === 'fr' ? "DonnÃ©es de monitoring enregistrÃ©es" : "Monitoring data recorded",
                    comparison: {
                        adoption: { value: data.adoption, benchmark: 0.58, status: data.adoption > 0.58 ? 'above' : 'below' },
                        fidelity: { value: data.fidelity, benchmark: 0.65, status: data.fidelity > 0.65 ? 'above' : 'below' }
                    },
                    recommendations: l === 'fr' 
                        ? ["Continuer le monitoring mensuel", "Partager les succÃ¨s avec l'Ã©quipe", "Documenter les adaptations rÃ©alisÃ©es"]
                        : ["Continue monthly monitoring", "Share successes with the team", "Document adaptations made"]
                };
            }
        };
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // 4. PEDAGOGY SYSTEM - Glossaire et formation
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var PedagogySystem = {
            glossary: {
                'CFIR': {
                    fullName: { fr: "Consolidated Framework for Implementation Research", en: "Consolidated Framework for Implementation Research" },
                    definition: { fr: "Cadre intÃ©grateur qui organise les dÃ©terminants de l'implÃ©mentation en 5 domaines : Innovation, Contexte externe, Contexte interne, Individus, Processus.", en: "Integrative framework organizing implementation determinants into 5 domains: Innovation, Outer Setting, Inner Setting, Individuals, Process." },
                    domains: ['Innovation', 'Outer Setting', 'Inner Setting', 'Individuals', 'Implementation Process'],
                    reference: 'Damschroder et al., 2022',
                    useCases: { fr: ["Diagnostic des barriÃ¨res", "Planification de l'implÃ©mentation", "Ã‰valuation formative"], en: ["Barrier assessment", "Implementation planning", "Formative evaluation"] }
                },
                'RE-AIM': {
                    fullName: { fr: "Reach, Effectiveness, Adoption, Implementation, Maintenance", en: "Reach, Effectiveness, Adoption, Implementation, Maintenance" },
                    definition: { fr: "Cadre d'Ã©valuation en 5 dimensions pour mesurer l'impact d'une intervention au niveau individuel et organisationnel.", en: "5-dimension evaluation framework to measure intervention impact at individual and organizational levels." },
                    domains: ['Reach', 'Effectiveness', 'Adoption', 'Implementation', 'Maintenance'],
                    reference: 'Glasgow et al., 1999; 2019',
                    useCases: { fr: ["Planification d'Ã©valuation", "Mesure de l'impact populationnel", "Comparaison d'interventions"], en: ["Evaluation planning", "Population impact measurement", "Intervention comparison"] }
                },
                'EPIS': {
                    fullName: { fr: "Exploration, Preparation, Implementation, Sustainment", en: "Exploration, Preparation, Implementation, Sustainment" },
                    definition: { fr: "ModÃ¨le de phases dÃ©crivant le parcours complet d'un projet d'implÃ©mentation, de l'identification du besoin Ã  la pÃ©rennisation.", en: "Phase model describing the complete journey of an implementation project, from need identification to sustainment." },
                    domains: ['Exploration', 'Preparation', 'Implementation', 'Sustainment'],
                    reference: 'Aarons et al., 2011',
                    useCases: { fr: ["Planification de projet", "Identification de la phase actuelle", "Anticipation des prochaines Ã©tapes"], en: ["Project planning", "Current phase identification", "Anticipating next steps"] }
                },
                'ERIC': {
                    fullName: { fr: "Expert Recommendations for Implementing Change", en: "Expert Recommendations for Implementing Change" },
                    definition: { fr: "Taxonomie de 73 stratÃ©gies d'implÃ©mentation consensuelles, organisÃ©es en clusters thÃ©matiques.", en: "Taxonomy of 73 consensus implementation strategies, organized into thematic clusters." },
                    domains: ['Train & Educate', 'Support Clinicians', 'Engage Consumers', 'Use Evaluative Strategies', 'Develop Stakeholder Relationships', 'Adapt & Tailor', 'Change Infrastructure', 'Provide Interactive Assistance', 'Financial Strategies'],
                    reference: 'Powell et al., 2015',
                    useCases: { fr: ["SÃ©lection de stratÃ©gies", "Planification d'intervention", "Comparaison de protocoles"], en: ["Strategy selection", "Intervention planning", "Protocol comparison"] }
                },
                'Proctor': {
                    fullName: { fr: "Outcomes d'implÃ©mentation de Proctor", en: "Proctor's Implementation Outcomes" },
                    definition: { fr: "8 outcomes d'implÃ©mentation distincts des outcomes cliniques : AcceptabilitÃ©, Adoption, Pertinence, FaisabilitÃ©, FidÃ©litÃ©, CoÃ»ts, PÃ©nÃ©tration, PÃ©rennisation.", en: "8 implementation outcomes distinct from clinical outcomes: Acceptability, Adoption, Appropriateness, Feasibility, Fidelity, Costs, Penetration, Sustainability." },
                    domains: ['Acceptability', 'Adoption', 'Appropriateness', 'Feasibility', 'Fidelity', 'Implementation Cost', 'Penetration', 'Sustainability'],
                    reference: 'Proctor et al., 2011',
                    useCases: { fr: ["DÃ©finition d'indicateurs", "Ã‰valuation de l'implÃ©mentation", "Distinction outcomes IS vs cliniques"], en: ["Indicator definition", "Implementation evaluation", "Distinguishing IS vs clinical outcomes"] }
                },
                'TIDieR': {
                    fullName: { fr: "Template for Intervention Description and Replication", en: "Template for Intervention Description and Replication" },
                    definition: { fr: "Checklist de 12 items pour dÃ©crire une intervention de maniÃ¨re suffisamment dÃ©taillÃ©e pour permettre sa rÃ©plication.", en: "12-item checklist to describe an intervention in enough detail to enable replication." },
                    domains: ['Why', 'What', 'Who provided', 'How', 'Where', 'When/How much', 'Tailoring', 'Modifications', 'How well (planned)', 'How well (actual)'],
                    reference: 'Hoffmann et al., 2014',
                    useCases: { fr: ["RÃ©daction de protocole", "Reporting d'essai", "Revue systÃ©matique"], en: ["Protocol writing", "Trial reporting", "Systematic review"] }
                }
            },
            
            // Obtenir une entrÃ©e du glossaire
            getGlossaryEntry: function(term, lang) {
                var l = lang || 'fr';
                var entry = this.glossary[term];
                if (!entry) return null;
                
                return {
                    term: term,
                    fullName: entry.fullName[l],
                    definition: entry.definition[l],
                    domains: entry.domains,
                    reference: entry.reference,
                    useCases: entry.useCases[l]
                };
            },
            
            // Obtenir tout le glossaire
            getFullGlossary: function(lang) {
                var self = this;
                var l = lang || 'fr';
                return Object.keys(this.glossary).map(function(term) {
                    return self.getGlossaryEntry(term, l);
                });
            },
            
            // Mini-tutoriels
            tutorials: {
                'cfir_to_questions': {
                    title: { fr: "Transformer CFIR en questions terrain", en: "Transforming CFIR into field questions" },
                    steps: [
                        { fr: "Identifiez les constructs CFIR pertinents pour votre contexte", en: "Identify CFIR constructs relevant to your context" },
                        { fr: "Pour chaque construct, formulez 1-2 questions spÃ©cifiques", en: "For each construct, formulate 1-2 specific questions" },
                        { fr: "Adaptez le langage au public cible (cliniciens, managers, patients)", en: "Adapt language to target audience (clinicians, managers, patients)" },
                        { fr: "Testez les questions avec 2-3 personnes avant dÃ©ploiement", en: "Test questions with 2-3 people before deployment" }
                    ],
                    example: { fr: "Construct 'Climat d'implÃ©mentation' â†’ Question: 'Sur une Ã©chelle de 1-10, Ã  quel point votre Ã©quipe est-elle prÃªte Ã  adopter cette nouvelle pratique ?'", en: "Construct 'Implementation Climate' â†’ Question: 'On a scale of 1-10, how ready is your team to adopt this new practice?'" }
                },
                'choosing_strategies': {
                    title: { fr: "Choisir les bonnes stratÃ©gies ERIC", en: "Choosing the right ERIC strategies" },
                    steps: [
                        { fr: "Listez les barriÃ¨res identifiÃ©es dans votre diagnostic", en: "List barriers identified in your assessment" },
                        { fr: "Pour chaque barriÃ¨re, identifiez 2-3 stratÃ©gies potentielles", en: "For each barrier, identify 2-3 potential strategies" },
                        { fr: "Ã‰valuez faisabilitÃ©, coÃ»t et expertise requise", en: "Evaluate feasibility, cost and required expertise" },
                        { fr: "Priorisez avec votre Ã©quipe et parties prenantes", en: "Prioritize with your team and stakeholders" }
                    ],
                    example: { fr: "BarriÃ¨re 'RÃ©sistance au changement' â†’ StratÃ©gies: Champions locaux (S08), Engagement direction (S04), Communication ciblÃ©e (S18)", en: "Barrier 'Resistance to change' â†’ Strategies: Local champions (S08), Leadership engagement (S04), Targeted communication (S18)" }
                }
            },
            
            // Obtenir un tutoriel
            getTutorial: function(tutorialId, lang) {
                var l = lang || 'fr';
                var t = this.tutorials[tutorialId];
                if (!t) return null;
                
                return {
                    id: tutorialId,
                    title: t.title[l],
                    steps: t.steps.map(function(s) { return s[l]; }),
                    example: t.example[l]
                };
            },
            
            // Mode apprentissage - cas fictifs
            learningCases: [
                {
                    id: 'case1',
                    title: { fr: "DÃ©ploiement mhGAP au Maroc", en: "mhGAP deployment in Morocco" },
                    domain: 'mental_health',
                    context: { fr: "Vous Ãªtes responsable du dÃ©ploiement du programme mhGAP dans 50 centres de santÃ© ruraux. Les mÃ©decins gÃ©nÃ©ralistes sont surchargÃ©s et n'ont jamais eu de formation en santÃ© mentale.", en: "You are responsible for deploying mhGAP in 50 rural health centers. GPs are overloaded and have never had mental health training." },
                    barriers: ['workforce_shortage', 'stigma', 'training_gap'],
                    expertPlan: { strategies: ['S01', 'S19', 'S08', 'S04'], rationale: { fr: "Formation + Task-shifting + Engagement communautaire + Leadership", en: "Training + Task-shifting + Community engagement + Leadership" } }
                },
                {
                    id: 'case2',
                    title: { fr: "TÃ©lÃ©travail dans une banque", en: "Remote work in a bank" },
                    domain: 'workplace',
                    context: { fr: "AprÃ¨s la pandÃ©mie, une banque de 2000 employÃ©s souhaite pÃ©renniser le tÃ©lÃ©travail hybride. Les managers intermÃ©diaires sont rÃ©ticents, craignant une perte de contrÃ´le.", en: "After the pandemic, a 2000-employee bank wants to sustain hybrid remote work. Middle managers are reluctant, fearing loss of control." },
                    barriers: ['resistance', 'culture', 'monitoring'],
                    expertPlan: { strategies: ['S04', 'S02', 'S03', 'S18'], rationale: { fr: "Engagement managers + Audit-feedback + Facilitation + Communication", en: "Manager engagement + Audit-feedback + Facilitation + Communication" } }
                }
            ],
            
            // Obtenir un cas d'apprentissage
            getLearningCase: function(caseId, lang) {
                var l = lang || 'fr';
                var c = this.learningCases.find(function(c) { return c.id === caseId; });
                if (!c) return null;
                
                return {
                    id: c.id,
                    title: c.title[l],
                    domain: c.domain,
                    context: c.context[l],
                    barriers: c.barriers,
                    expertPlan: {
                        strategies: c.expertPlan.strategies,
                        rationale: c.expertPlan.rationale[l]
                    }
                };
            }
        };
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // 5. CERTIFICATION SYSTEM - Label Moudar Ready
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        var CertificationSystem = {
            // CritÃ¨res de certification
            criteria: [
                { id: 'framework', weight: 15, label: { fr: "Cadre thÃ©orique IS explicite", en: "Explicit IS theoretical framework" } },
                { id: 'strategies', weight: 15, label: { fr: "StratÃ©gies d'implÃ©mentation dÃ©finies", en: "Implementation strategies defined" } },
                { id: 'outcomes', weight: 15, label: { fr: "Outcomes d'implÃ©mentation mesurables", en: "Measurable implementation outcomes" } },
                { id: 'barriers', weight: 10, label: { fr: "Analyse barriÃ¨res/facilitateurs", en: "Barriers/facilitators analysis" } },
                { id: 'stakeholders', weight: 10, label: { fr: "Parties prenantes identifiÃ©es", en: "Stakeholders identified" } },
                { id: 'adaptation', weight: 10, label: { fr: "Plan d'adaptation contextuelle", en: "Contextual adaptation plan" } },
                { id: 'evaluation', weight: 10, label: { fr: "Plan d'Ã©valuation", en: "Evaluation plan" } },
                { id: 'timeline', weight: 5, label: { fr: "Timeline EPIS", en: "EPIS timeline" } },
                { id: 'sustainment', weight: 5, label: { fr: "Plan de pÃ©rennisation", en: "Sustainability plan" } },
                { id: 'equity', weight: 5, label: { fr: "ConsidÃ©rations d'Ã©quitÃ©", en: "Equity considerations" } }
            ],
            
            // Ã‰valuer un protocole pour certification
            evaluateForCertification: function(protocol, context, lang) {
                var l = lang || 'fr';
                var self = this;
                var results = [];
                var totalScore = 0;
                
                console.log("[CERTIFICATION] Protocol reÃ§u:", protocol);
                console.log("[CERTIFICATION] Context reÃ§u:", context);
                
                this.criteria.forEach(function(criterion) {
                    var passed = false;
                    var score = 0;
                    
                    // Ã‰valuation basÃ©e sur la prÃ©sence d'Ã©lÃ©ments dans le protocole
                    switch(criterion.id) {
                        case 'framework':
                            // VÃ©rifie frameworks (pluriel) ou aiConfidence > 0.5
                            passed = (protocol.frameworks && protocol.frameworks.length > 0) || 
                                    (protocol.aiConfidence && protocol.aiConfidence > 0.5);
                            break;
                        case 'strategies':
                            // VÃ©rifie qu'il y a au moins 2 stratÃ©gies
                            passed = (protocol.strategies && protocol.strategies.length >= 2) ||
                                    (protocol.aiRawRecommendations && protocol.aiRawRecommendations.strategies && 
                                     protocol.aiRawRecommendations.strategies.top && protocol.aiRawRecommendations.strategies.top.length >= 2);
                            break;
                        case 'outcomes':
                            // VÃ©rifie outcomes (pluriel) ou aiRawRecommendations.outcomes
                            passed = (protocol.outcomes && protocol.outcomes.length > 0) ||
                                    (protocol.aiRawRecommendations && protocol.aiRawRecommendations.outcomes);
                            break;
                        case 'barriers':
                            // VÃ©rifie aiDetectedBarriers
                            passed = protocol.aiDetectedBarriers && protocol.aiDetectedBarriers.length > 0;
                            break;
                        case 'stakeholders':
                            // VÃ©rifie stakeholders dans context ou protocol
                            passed = (context && context.stakeholders) || protocol.stakeholders || 
                                    (context && context.organization) || (protocol.title && protocol.title.length > 0);
                            break;
                        case 'adaptation':
                            // VÃ©rifie adaptations ou contexte LMIC
                            passed = (context && context.adaptations) || protocol.adaptations || 
                                    (context && context.resourceLevel === 'LMIC') ||
                                    (protocol.aiRawRecommendations && protocol.aiRawRecommendations.input && protocol.aiRawRecommendations.input.resourceLevel);
                            break;
                        case 'evaluation':
                            // VÃ©rifie plan d'Ã©valuation
                            passed = protocol.evaluation || protocol.kpis || 
                                    (protocol.outcomes && protocol.outcomes.length > 0) ||
                                    (protocol.aiRawRecommendations && protocol.aiRawRecommendations.outcomes);
                            break;
                        case 'timeline':
                            // VÃ©rifie timeline ou phase
                            passed = protocol.timeline || (context && context.duration) || 
                                    protocol.phase || (protocol.keyActivities && protocol.keyActivities.length > 0);
                            break;
                        case 'sustainment':
                            // VÃ©rifie plan de pÃ©rennisation
                            passed = protocol.sustainment || 
                                    (context && context.phase === 'sustainment') ||
                                    (protocol.phase === 'sustainment') ||
                                    (protocol.recommendations && protocol.recommendations.length > 0);
                            break;
                        case 'equity':
                            // VÃ©rifie considÃ©rations d'Ã©quitÃ©
                            passed = protocol.equity || (context && context.equity) ||
                                    (protocol.aiRawRecommendations && protocol.aiRawRecommendations.input && 
                                     (protocol.aiRawRecommendations.input.resourceLevel === 'LMIC' || 
                                      protocol.aiRawRecommendations.input.resourceLevel === 'LIC'));
                            break;
                        default:
                            passed = false;
                    }
                    
                    score = passed ? criterion.weight : 0;
                    totalScore += score;
                    
                    console.log("[CERTIFICATION] CritÃ¨re", criterion.id, ":", passed ? "âœ“" : "âœ—", "(+" + score + "pts)");
                    
                    results.push({
                        criterion: criterion.id,
                        label: criterion.label[l],
                        weight: criterion.weight,
                        passed: passed,
                        score: score
                    });
                });
                
                console.log("[CERTIFICATION] Score total:", totalScore + "/100");
                
                // DÃ©terminer le niveau de certification
                var level = 'none';
                var levelLabel = { fr: "Non certifiable", en: "Not certifiable" };
                var color = '#ef4444';
                
                if (totalScore >= 90) {
                    level = 'gold';
                    levelLabel = { fr: "Certification Or", en: "Gold Certification" };
                    color = '#f59e0b';
                } else if (totalScore >= 75) {
                    level = 'silver';
                    levelLabel = { fr: "Certification Argent", en: "Silver Certification" };
                    color = '#9ca3af';
                } else if (totalScore >= 60) {
                    level = 'bronze';
                    levelLabel = { fr: "Certification Bronze", en: "Bronze Certification" };
                    color = '#b45309';
                }
                
                // GÃ©nÃ©rer un ID de certification unique
                var certId = 'MR-' + new Date().getFullYear() + '-' + Math.random().toString(36).substr(2, 6).toUpperCase();
                
                return {
                    projectTitle: protocol.title || context.title,
                    score: totalScore,
                    maxScore: 100,
                    level: level,
                    levelLabel: levelLabel[l],
                    color: color,
                    certified: totalScore >= 60,
                    certificationId: totalScore >= 60 ? certId : null,
                    results: results,
                    passedCriteria: results.filter(function(r) { return r.passed; }).length,
                    totalCriteria: results.length,
                    recommendations: results.filter(function(r) { return !r.passed; }).map(function(r) { 
                        return l === 'fr' ? "Ajouter : " + r.label : "Add: " + r.label; 
                    }),
                    validUntil: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    qrCodeData: 'https://moudar.com/verify/' + certId,
                    generatedAt: new Date().toISOString()
                };
            },
            
            // GÃ©nÃ©rer le badge HTML
            generateBadgeHTML: function(certification, lang) {
                var l = lang || 'fr';
                if (!certification.certified) {
                    return '<div style="padding:20px;background:#fee2e2;border:2px solid #ef4444;border-radius:12px;text-align:center;"><p style="color:#ef4444;font-weight:bold;">âš ï¸ ' + (l === 'fr' ? 'Non certifiÃ©' : 'Not certified') + '</p></div>';
                }
                
                var icon = certification.level === 'gold' ? 'ðŸ¥‡' : certification.level === 'silver' ? 'ðŸ¥ˆ' : 'ðŸ¥‰';
                
                return '<div style="padding:24px;background:linear-gradient(135deg,' + certification.color + '22,' + certification.color + '11);border:3px solid ' + certification.color + ';border-radius:16px;text-align:center;">' +
                    '<div style="font-size:48px;margin-bottom:12px;">' + icon + '</div>' +
                    '<h3 style="color:' + certification.color + ';font-size:20px;font-weight:bold;margin-bottom:8px;">MOUDAR READY</h3>' +
                    '<p style="font-size:16px;font-weight:600;color:#374151;margin-bottom:4px;">' + certification.levelLabel + '</p>' +
                    '<p style="font-size:24px;font-weight:bold;color:' + certification.color + ';">' + certification.score + '/100</p>' +
                    '<p style="font-size:12px;color:#6b7280;margin-top:8px;">ID: ' + certification.certificationId + '</p>' +
                    '<p style="font-size:11px;color:#9ca3af;">' + (l === 'fr' ? 'Valide jusqu\'au' : 'Valid until') + ' ' + certification.validUntil + '</p>' +
                    '</div>';
            }
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULES v8.0 - API PUBLIQUE + COMMUNAUTÃ‰ + INTÃ‰GRATIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        var MoudarAPI = {
            version: '1.0.0', baseUrl: 'https://<YOUR-API-ENDPOINT>/api/v1',
            endpoints: {
                auth: { login: { method: 'POST', path: '/auth/login' }, refresh: { method: 'POST', path: '/auth/refresh' } },
                projects: { list: { method: 'GET', path: '/projects' }, create: { method: 'POST', path: '/projects' }, get: { method: 'GET', path: '/projects/{id}' }, analyze: { method: 'POST', path: '/projects/{id}/analyze' } },
                strategies: { list: { method: 'GET', path: '/strategies' }, recommend: { method: 'POST', path: '/strategies/recommend' } },
                frameworks: { cfir: { method: 'POST', path: '/frameworks/cfir/evaluate' }, reaim: { method: 'POST', path: '/frameworks/reaim/evaluate' } },
                analytics: { predict: { method: 'POST', path: '/analytics/predict' }, monteCarlo: { method: 'POST', path: '/analytics/monte-carlo' }, roi: { method: 'POST', path: '/analytics/roi' } },
                exports: { spirit: { method: 'POST', path: '/exports/spirit' }, docx: { method: 'POST', path: '/exports/docx' } },
                community: { benchmarks: { method: 'GET', path: '/community/benchmarks' }, share: { method: 'POST', path: '/community/share' } },
                integrations: { redcap: { method: 'POST', path: '/integrations/redcap/sync' }, odk: { method: 'POST', path: '/integrations/odk/sync' }, dhis2: { method: 'POST', path: '/integrations/dhis2/sync' } }
            },
            generateDocumentation: function(lang) { var self = this; var docs = { title: (lang||'fr') === 'fr' ? 'API Moudar' : 'Moudar API', version: this.version, baseUrl: this.baseUrl, categories: [] }; Object.keys(this.endpoints).forEach(function(cat) { var c = { name: cat, endpoints: [] }; Object.keys(self.endpoints[cat]).forEach(function(ep) { c.endpoints.push({ name: ep, method: self.endpoints[cat][ep].method, path: self.baseUrl + self.endpoints[cat][ep].path }); }); docs.categories.push(c); }); return docs; },
            generateSDK: function() { return '// Moudar SDK - Coming soon'; },
            generateCurlExamples: function() { return { auth: 'curl -X POST ' + this.baseUrl + '/auth/login -d \'{"email":"x","password":"y"}\'', create: 'curl -X POST ' + this.baseUrl + '/projects -H "Authorization: Bearer {t}" -d \'{"title":"x"}\'' }; }
        };
        
        var CommunityHub = {
            globalBenchmarks: {
                byDomain: { mental_health: { avgSuccessRate: 62, avgAdoptionRate: 68, topStrategies: ['S01','S10','S19'], totalProjects: 847, countries: 42 }, primary_care: { avgSuccessRate: 71, avgAdoptionRate: 74, topStrategies: ['S01','S02','S03'], totalProjects: 1234, countries: 67 }, chronic_disease: { avgSuccessRate: 58, avgAdoptionRate: 63, topStrategies: ['S18','S08','S10'], totalProjects: 623, countries: 38 }, maternal_child: { avgSuccessRate: 75, avgAdoptionRate: 79, topStrategies: ['S08','S18','S01'], totalProjects: 956, countries: 54 } },
                byRegion: { 'Sub-Saharan Africa': { avgSuccess: 58, projects: 412 }, 'South Asia': { avgSuccess: 64, projects: 387 }, 'Latin America': { avgSuccess: 69, projects: 298 }, 'MENA': { avgSuccess: 61, projects: 234 }, 'Southeast Asia': { avgSuccess: 67, projects: 321 }, 'Europe': { avgSuccess: 73, projects: 456 } },
                byIncome: { LIC: { avgSuccess: 52, avgBudget: 85000 }, LMIC: { avgSuccess: 61, avgBudget: 180000 }, UMIC: { avgSuccess: 68, avgBudget: 350000 }, HIC: { avgSuccess: 74, avgBudget: 620000 } }
            },
            sharedProjects: [ { id: 'CP001', domain: 'mental_health', region: 'MENA', successRate: 78, views: 234 }, { id: 'CP002', domain: 'primary_care', region: 'Sub-Saharan Africa', successRate: 65, views: 456 }, { id: 'CP003', domain: 'chronic_disease', region: 'South Asia', successRate: 71, views: 189 } ],
            forums: { categories: [ { id: 'strategies', name: { fr: 'StratÃ©gies', en: 'Strategies' }, topics: 145 }, { id: 'frameworks', name: { fr: 'Cadres', en: 'Frameworks' }, topics: 89 }, { id: 'cases', name: { fr: 'Cas', en: 'Cases' }, topics: 234 } ] },
            getBenchmarks: function(filters, lang) { var b = { global: { totalProjects: 2497, totalCountries: 89, avgSuccessRate: 65, totalBeneficiaries: '2.3M' }, filtered: null, comparison: null }; if (filters && filters.domain) b.filtered = this.globalBenchmarks.byDomain[filters.domain]; if (filters && filters.region) b.filtered = this.globalBenchmarks.byRegion[filters.region]; if (filters && filters.projectSuccessRate) { var avg = b.filtered ? (b.filtered.avgSuccess || b.filtered.avgSuccessRate || 65) : 65; b.comparison = { yourRate: filters.projectSuccessRate, globalAvg: avg, percentile: Math.min(99, Math.max(1, 50 + filters.projectSuccessRate - avg)) }; } return b; },
            getSimilarProjects: function(project) { return this.sharedProjects.filter(function(p) { return p.domain === project.domain; }).slice(0, 5); },
            shareProject: function(project, options, lang) { return { success: true, projectId: 'CP' + Date.now(), message: (lang||'fr') === 'fr' ? 'Projet partagÃ©!' : 'Project shared!' }; },
            getLeaderboard: function() { return { topContributors: [ { rank: 1, name: 'Expert_SMOA', points: 4567, country: 'ðŸ‡¨ðŸ‡­' }, { rank: 2, name: 'GlobalHealth', points: 3890, country: 'ðŸ‡ºðŸ‡¸' }, { rank: 3, name: 'LMIC_Champion', points: 3456, country: 'ðŸ‡°ðŸ‡ª' } ], badges: [ { id: 'pioneer', icon: 'ðŸ†' }, { id: 'mentor', icon: 'ðŸŽ“' }, { id: 'innovator', icon: 'ðŸ’¡' }, { id: 'global', icon: 'ðŸŒ' } ] }; }
        };
        
        var DataIntegrations = {
            integrations: {
                redcap: { id: 'redcap', name: 'REDCap', logo: 'ðŸ”´', desc: { fr: 'Gestion donnÃ©es recherche', en: 'Research data' }, capabilities: ['import','export','sync','forms'], status: 'available' },
                odk: { id: 'odk', name: 'ODK', logo: 'ðŸ“±', desc: { fr: 'Collecte terrain', en: 'Field collection' }, capabilities: ['import','export','forms'], status: 'available' },
                dhis2: { id: 'dhis2', name: 'DHIS2', logo: 'ðŸ“Š', desc: { fr: 'SystÃ¨mes santÃ©', en: 'Health systems' }, capabilities: ['import','export','indicators'], status: 'available' },
                kobo: { id: 'kobo', name: 'KoboToolbox', logo: 'ðŸ“‹', desc: { fr: 'Humanitaire', en: 'Humanitarian' }, capabilities: ['import','export','forms'], status: 'available' },
                commcare: { id: 'commcare', name: 'CommCare', logo: 'ðŸ’š', desc: { fr: 'Agents communautaires', en: 'CHW' }, capabilities: ['import','export'], status: 'coming_soon' }
            },
            getConfigForm: function(id, lang) { var i = this.integrations[id]; if (!i) return null; var f = { redcap: [{ id: 'apiUrl', label: { fr: 'URL API', en: 'API URL' }, type: 'url' }, { id: 'apiToken', label: { fr: 'Token', en: 'Token' }, type: 'password' }, { id: 'projectId', label: 'ID', type: 'text' }], odk: [{ id: 'serverUrl', label: { fr: 'URL', en: 'URL' }, type: 'url' }, { id: 'username', label: { fr: 'User', en: 'User' }, type: 'text' }, { id: 'password', label: { fr: 'Pass', en: 'Pass' }, type: 'password' }], dhis2: [{ id: 'serverUrl', label: 'URL', type: 'url' }, { id: 'username', label: 'User', type: 'text' }, { id: 'password', label: 'Pass', type: 'password' }, { id: 'orgUnit', label: 'OrgUnit', type: 'text' }], kobo: [{ id: 'apiUrl', label: 'URL', type: 'url' }, { id: 'apiToken', label: 'Token', type: 'password' }] }; return { integration: i, fields: f[id] || [] }; },
            testConnection: function(id, config, lang) { var ok = config.apiUrl || config.serverUrl; return { success: !!ok, message: ok ? ((lang||'fr') === 'fr' ? 'Connexion OK!' : 'Connected!') : 'Failed', details: ok ? { version: '2.x', projects: 3 } : null }; },
            generateRedcapForm: function(project, protocol, lang) { lang = lang || 'fr'; return { projectTitle: project.title || 'Moudar', instruments: [ { name: 'participant', label: lang === 'fr' ? 'Participant' : 'Participant', fields: [{ name: 'id', label: 'ID', type: 'text' }, { name: 'date', label: 'Date', type: 'date' }, { name: 'consent', label: lang === 'fr' ? 'Consentement' : 'Consent', type: 'yesno' }] }, { name: 'implementation', label: lang === 'fr' ? 'ImplÃ©mentation' : 'Implementation', fields: [{ name: 'strategy', label: lang === 'fr' ? 'StratÃ©gie' : 'Strategy', type: 'checkbox' }, { name: 'fidelity', label: lang === 'fr' ? 'FidÃ©litÃ©' : 'Fidelity', type: 'slider' }] }, { name: 'outcomes', label: 'Outcomes', fields: [{ name: 'primary', label: lang === 'fr' ? 'Primaire' : 'Primary', type: 'text' }] } ], events: ['baseline', 'month_6', 'endline'], exportFormat: 'REDCap XML', generatedAt: new Date().toISOString() }; },
            generateOdkForm: function(project, protocol, lang) { lang = lang || 'fr'; var form = { settings: { title: project.title || 'Moudar', id: 'moudar_' + Date.now() }, survey: [{ type: 'text', name: 'id', label: 'ID' }, { type: 'geopoint', name: 'location', label: lang === 'fr' ? 'Localisation' : 'Location' }, { type: 'date', name: 'date', label: 'Date' }, { type: 'select_multiple strategies', name: 'strategies', label: lang === 'fr' ? 'StratÃ©gies' : 'Strategies' }, { type: 'integer', name: 'fidelity', label: lang === 'fr' ? 'FidÃ©litÃ©' : 'Fidelity' }, { type: 'image', name: 'photo', label: 'Photo' }], choices: [] }; if (protocol && protocol.aiRawRecommendations) { protocol.aiRawRecommendations.strategies.top.forEach(function(s) { var n = KnowledgeGraph.nodes.strategies[s.id || s]; form.choices.push({ list: 'strategies', name: s.id || s, label: n ? n.label[lang] : s.id }); }); } return { form: form, formats: ['XLSForm', 'XForm'], generatedAt: new Date().toISOString() }; },
            syncData: function(id, config, direction, lang) { return { success: true, integration: id, direction: direction, timestamp: new Date().toISOString(), stats: { processed: Math.floor(Math.random()*100)+50, created: Math.floor(Math.random()*30)+10, errors: Math.floor(Math.random()*3) }, message: direction === 'import' ? ((lang||'fr') === 'fr' ? 'ImportÃ©' : 'Imported') : ((lang||'fr') === 'fr' ? 'ExportÃ©' : 'Exported') }; }
        };
        
        // Exposer l'API publique
        Object.assign(MoudarEngine, {
            api: MoudarAPI, getAPIDocumentation: function(l) { return MoudarAPI.generateDocumentation(l); }, getSDK: function() { return MoudarAPI.generateSDK(); }, getCurlExamples: function() { return MoudarAPI.generateCurlExamples(); },
            community: CommunityHub, getBenchmarks: function(f, l) { return CommunityHub.getBenchmarks(f, l); }, getSimilarCommunityProjects: function(p) { return CommunityHub.getSimilarProjects(p); }, shareProject: function(p, o, l) { return CommunityHub.shareProject(p, o, l); }, getLeaderboard: function() { return CommunityHub.getLeaderboard(); },
            integrations: DataIntegrations, getIntegrations: function() { return DataIntegrations.integrations; }, getIntegrationConfig: function(id, l) { return DataIntegrations.getConfigForm(id, l); }, testIntegration: function(id, c, l) { return DataIntegrations.testConnection(id, c, l); }, generateRedcapForm: function(p, pr, l) { return DataIntegrations.generateRedcapForm(p, pr, l); }, generateOdkForm: function(p, pr, l) { return DataIntegrations.generateOdkForm(p, pr, l); }, syncIntegration: function(id, c, d, l) { return DataIntegrations.syncData(id, c, d, l); }
        });
        
        // Exposer v8.0 - World Reference Platform
        Object.assign(MoudarEngine, {
            // XAI - Explainable AI
            xai: ExplainableAI,
            explainStrategy: function(s, c, l) { return ExplainableAI.explainStrategy(s, c, l); },
            getXAIReport: function(p, c, l) { return ExplainableAI.generateXAIReport(p, c, l); },
            
            // Document Analyzer
            documentAnalyzer: DocumentAnalyzer,
            analyzeDocument: function(t, l) { return DocumentAnalyzer.analyzeDocument(t, l); },
            extractElements: function(t, l) { return DocumentAnalyzer.extractElements(t, l); },
            identifyGaps: function(t, l) { return DocumentAnalyzer.identifyGaps(t, l); },
            generateSection: function(s, c, l) { return DocumentAnalyzer.generateSection(s, c, l); },
            
            // Learning & Feedback
            learning: LearningFeedback,
            submitFeedback: function(p, s, f, l) { return LearningFeedback.submitFeedback(p, s, f, l); },
            getContextInsights: function(c, l) { return LearningFeedback.getContextInsights(c, l); },
            getStrategyBenchmark: function(s, c, l) { return LearningFeedback.getStrategyBenchmark(s, c, l); },
            submitMonitoring: function(p, d, l) { return LearningFeedback.submitMonitoringData(p, d, l); },
            
            // Pedagogy
            pedagogy: PedagogySystem,
            getGlossary: function(l) { return PedagogySystem.getFullGlossary(l); },
            getGlossaryEntry: function(t, l) { return PedagogySystem.getGlossaryEntry(t, l); },
            getTutorial: function(id, l) { return PedagogySystem.getTutorial(id, l); },
            getLearningCase: function(id, l) { return PedagogySystem.getLearningCase(id, l); },
            
            // Certification
            certification: CertificationSystem,
            evaluateCertification: function(p, c, l) { return CertificationSystem.evaluateForCertification(p, c, l); },
            getCertificationBadge: function(c, l) { return CertificationSystem.generateBadgeHTML(c, l); }
        });
    })();
    window.MoudarEngine = MoudarEngine;
    </script>
    
    <script>
/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * MOUDAR - Copilote Science de la mise en Å“uvre
 * Version 9.0 - GOLD STANDARD EDITION
 * Pour Organisations Internationales & MinistÃ¨res
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * Copyright (c) 2025 Younes MOUDAR               
 * Tous droits rÃ©servÃ©s / All rights reserved
 * 
 * Ce code source est protÃ©gÃ© par le droit d'auteur.
 * Toute reproduction ou utilisation non autorisÃ©e est interdite.
 * 
 * NOUVEAUTÃ‰S v9.0 GOLD STANDARD:
 * 1. Adaptive Implementation Engine (AIE) - Pilotage dynamique
 * 2. Grant AI Writer (GAW) - GÃ©nÃ©rateur de propositions
 * 3. Qualitative Analysis Engine (QAE) - NLP pour entretiens
 * 4. Benchmarking Engine (BE) - Intelligence collective
 * 5. Digital Twin Module (DTM) - ModÃ©lisation organisationnelle
 * 
 * Contact: contact@moudar.com
 * Website: https://moudar.com
 * 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

var useState = React.useState;
var useRef = React.useRef;
var useEffect = React.useEffect;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 1: ADAPTIVE IMPLEMENTATION ENGINE (AIE) v9.0
// DÃ©tection de dÃ©rives en temps rÃ©el + GÃ©nÃ©ration automatique de Plans B
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var AdaptiveImplementationEngine = {
  VERSION: '9.0.0',
  thresholds: {
    minor: 0.10,
    moderate: 0.20,
    critical: 0.30
  },
  driftTypes: {
    ADOPTION_DROP: {
      indicator: 'adoption_rate',
      label: {
        fr: 'Baisse du taux d\'adoption',
        en: 'Adoption rate drop'
      },
      icon: 'ðŸ“‰'
    },
    FIDELITY_DRIFT: {
      indicator: 'fidelity_score',
      label: {
        fr: 'Ã‰cart de fidÃ©litÃ©',
        en: 'Fidelity drift'
      },
      icon: 'ðŸŽ¯'
    },
    TIMELINE_DELAY: {
      indicator: 'milestone_completion',
      label: {
        fr: 'Retard sur le chronogramme',
        en: 'Timeline delay'
      },
      icon: 'â°'
    },
    BUDGET_OVERRUN: {
      indicator: 'budget_variance',
      label: {
        fr: 'DÃ©passement budgÃ©taire',
        en: 'Budget overrun'
      },
      icon: 'ðŸ’°'
    },
    ENGAGEMENT_DECLINE: {
      indicator: 'stakeholder_engagement',
      label: {
        fr: 'DÃ©clin de l\'engagement',
        en: 'Engagement decline'
      },
      icon: 'ðŸ‘¥'
    }
  },
  planBMatrix: {
    S01: {
      ADOPTION_DROP: {
        supportStrategies: ['S04', 'S03', 'S10'],
        actions: {
          fr: ['Identifier des champions parmi les formÃ©s', 'Sessions de rappel ciblÃ©es', 'Coaching individuel'],
          en: ['Identify champions among trainees', 'Targeted refresher sessions', 'Individual coaching']
        },
        budgetFactor: 1.15,
        timeWeeks: 4
      },
      FIDELITY_DRIFT: {
        supportStrategies: ['S02', 'S09', 'S05'],
        actions: {
          fr: ['Audit des pratiques', 'Aide-mÃ©moires sur site', 'Rappels automatiques'],
          en: ['Practice audit', 'On-site job aids', 'Automated reminders']
        },
        budgetFactor: 1.10,
        timeWeeks: 2
      }
    },
    S04: {
      ADOPTION_DROP: {
        supportStrategies: ['S03', 'S06', 'S08'],
        actions: {
          fr: ['Renforcer le soutien aux champions', 'Incitations supplÃ©mentaires', 'Engagement communautaire'],
          en: ['Strengthen champion support', 'Additional incentives', 'Community engagement']
        },
        budgetFactor: 1.20,
        timeWeeks: 3
      }
    },
    S19: {
      ADOPTION_DROP: {
        supportStrategies: ['S04', 'S10', 'S03'],
        actions: {
          fr: ['Activer des champions locaux', 'Renforcer la supervision', 'Facilitation d\'urgence'],
          en: ['Activate local champions', 'Strengthen supervision', 'Emergency facilitation']
        },
        budgetFactor: 1.25,
        timeWeeks: 6
      },
      FIDELITY_DRIFT: {
        supportStrategies: ['S01', 'S02', 'S09'],
        actions: {
          fr: ['Formation de rappel', 'Audit avec feedback immÃ©diat', 'Job aids visuels'],
          en: ['Refresher training', 'Audit with immediate feedback', 'Visual job aids']
        },
        budgetFactor: 1.15,
        timeWeeks: 4
      }
    },
    DEFAULT: {
      ADOPTION_DROP: {
        supportStrategies: ['S04', 'S03', 'S08'],
        actions: {
          fr: ['Mobiliser des champions', 'Facilitation intensive', 'Engagement communautaire'],
          en: ['Mobilize champions', 'Intensive facilitation', 'Community engagement']
        },
        budgetFactor: 1.20,
        timeWeeks: 4
      },
      FIDELITY_DRIFT: {
        supportStrategies: ['S02', 'S01', 'S09'],
        actions: {
          fr: ['Audit qualitÃ©', 'Formation de rappel', 'Outils aide-mÃ©moire'],
          en: ['Quality audit', 'Refresher training', 'Job aid tools']
        },
        budgetFactor: 1.15,
        timeWeeks: 3
      },
      TIMELINE_DELAY: {
        supportStrategies: ['S03', 'S10', 'S06'],
        actions: {
          fr: ['AccÃ©lÃ©rer la facilitation', 'Supervision renforcÃ©e', 'Ressources additionnelles'],
          en: ['Accelerate facilitation', 'Enhanced supervision', 'Additional resources']
        },
        budgetFactor: 1.30,
        timeWeeks: 2
      },
      BUDGET_OVERRUN: {
        supportStrategies: ['S13', 'S06'],
        actions: {
          fr: ['Optimiser les processus', 'RÃ©allouer les ressources'],
          en: ['Optimize processes', 'Reallocate resources']
        },
        budgetFactor: 1.0,
        timeWeeks: 2
      },
      ENGAGEMENT_DECLINE: {
        supportStrategies: ['S08', 'S04', 'S03'],
        actions: {
          fr: ['Campagne de communication', 'Activer les champions', 'Sessions de re-engagement'],
          en: ['Communication campaign', 'Activate champions', 'Re-engagement sessions']
        },
        budgetFactor: 1.15,
        timeWeeks: 4
      }
    }
  },
  analyzeRealTime: function (project, currentKPIs) {
    var self = this;
    var drifts = [];
    var baselineKPIs = project.baselineKPIs || {};
    Object.keys(currentKPIs).forEach(function (kpiId) {
      var current = currentKPIs[kpiId].value;
      var target = currentKPIs[kpiId].target;
      var baseline = baselineKPIs[kpiId] || target;
      if (target === 0) return;
      var variance = (target - current) / target;
      var trend = self.calculateTrend(project.kpiHistory, kpiId);
      if (Math.abs(variance) >= self.thresholds.minor) {
        drifts.push({
          kpiId: kpiId,
          type: self.identifyDriftType(kpiId),
          current: current,
          target: target,
          variance: (variance * 100).toFixed(1),
          severity: self.classifySeverity(Math.abs(variance)),
          trend: trend,
          timestamp: new Date().toISOString()
        });
      }
    });
    return drifts.sort(function (a, b) {
      return Math.abs(b.variance) - Math.abs(a.variance);
    });
  },
  classifySeverity: function (variance) {
    if (variance >= this.thresholds.critical) return 'critical';
    if (variance >= this.thresholds.moderate) return 'moderate';
    return 'minor';
  },
  identifyDriftType: function (kpiId) {
    var mapping = {
      'adoption_rate': 'ADOPTION_DROP',
      'fidelity_score': 'FIDELITY_DRIFT',
      'milestone_completion': 'TIMELINE_DELAY',
      'budget_variance': 'BUDGET_OVERRUN',
      'stakeholder_engagement': 'ENGAGEMENT_DECLINE'
    };
    return mapping[kpiId] || 'ADOPTION_DROP';
  },
  calculateTrend: function (history, kpiId) {
    if (!history || !history[kpiId] || history[kpiId].length < 2) return 'stable';
    var values = history[kpiId].slice(-5);
    var first = values[0];
    var last = values[values.length - 1];
    var change = (last - first) / first;
    if (change > 0.05) return 'improving';
    if (change < -0.05) return 'declining';
    return 'stable';
  },
  generatePlanB: function (drift, project, currentStrategies) {
    var self = this;
    var primaryStrategy = currentStrategies[0] || 'DEFAULT';
    var matrix = this.planBMatrix[primaryStrategy] || this.planBMatrix.DEFAULT;
    var planB = matrix[drift.type] || matrix.ADOPTION_DROP;
    var alreadyUsed = currentStrategies || [];
    var supportStrategies = planB.supportStrategies.filter(function (s) {
      return alreadyUsed.indexOf(s) === -1;
    });
    var baseBudget = project.budget || 100000;
    var additionalCost = baseBudget * (planB.budgetFactor - 1);
    var baseSuccess = 0.65;
    if (drift.severity === 'minor') baseSuccess = 0.85;else if (drift.severity === 'moderate') baseSuccess = 0.75;
    return {
      driftId: drift.kpiId,
      driftType: drift.type,
      severity: drift.severity,
      supportStrategies: supportStrategies,
      actions: planB.actions,
      estimatedCost: Math.round(additionalCost),
      timeline: planB.timeWeeks + ' semaines',
      successProbability: Math.round(baseSuccess * 100),
      generatedAt: new Date().toISOString()
    };
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE: SMART ADAPTIVE DESIGN ENGINE
// Sequential Multiple Assignment Randomized Trial (SMART) for IS
// Reference: Almirall D et al. (2014). Drug & Alcohol Dependence, 138:36-46
// Reference: Kilbourne AM et al. (2018). Implementation Science, 13:31
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var SMARTDesigner = {
  VERSION: '11.0.0',
  citation: 'Almirall D et al. (2014). Drug & Alcohol Dependence, 138:36-46',
  // SMART design templates
  templates: {
    twoStage: {
      id: 'twoStage',
      label: {
        fr: 'SMART 2 Ã©tapes (classique)',
        en: '2-Stage SMART (classic)'
      },
      description: {
        fr: 'Randomisation initiale â†’ Ã©valuation â†’ re-randomisation selon rÃ©ponse',
        en: 'Initial randomization â†’ assessment â†’ re-randomization based on response'
      },
      stages: 2,
      icon: 'ðŸ”€'
    },
    clustered: {
      id: 'clustered',
      label: {
        fr: 'Clustered SMART',
        en: 'Clustered SMART'
      },
      description: {
        fr: 'Randomisation au niveau du site â€” interventions organisationnelles',
        en: 'Site-level randomization â€” organizational interventions'
      },
      stages: 2,
      icon: 'ðŸ¥'
    },
    sequential: {
      id: 'sequential',
      label: {
        fr: 'SMART sÃ©quentiel multi-Ã©tapes',
        en: 'Multi-stage sequential SMART'
      },
      description: {
        fr: '3+ Ã©tapes, points de dÃ©cision multiples â€” implÃ©mentations complexes',
        en: '3+ stages, multiple decision points â€” complex implementations'
      },
      stages: 3,
      icon: 'ðŸ”„'
    }
  },
  // Response classifiers
  responseClassifiers: {
    adoption: {
      id: 'adoption',
      label: {
        fr: 'Taux d\'adoption',
        en: 'Adoption rate'
      },
      responderThreshold: 60,
      unit: '%',
      timing: {
        fr: '3 mois',
        en: '3 months'
      },
      cfirLink: ['IN4', 'IS11']
    },
    fidelity: {
      id: 'fidelity',
      label: {
        fr: 'Score de fidÃ©litÃ©',
        en: 'Fidelity score'
      },
      responderThreshold: 70,
      unit: '%',
      timing: {
        fr: '6 mois',
        en: '6 months'
      },
      cfirLink: ['PR4', 'IC4']
    },
    penetration: {
      id: 'penetration',
      label: {
        fr: 'Taux de pÃ©nÃ©tration',
        en: 'Penetration rate'
      },
      responderThreshold: 50,
      unit: '%',
      timing: {
        fr: '6 mois',
        en: '6 months'
      },
      cfirLink: ['IS1', 'OS4']
    },
    satisfaction: {
      id: 'satisfaction',
      label: {
        fr: 'Satisfaction (AIM)',
        en: 'Satisfaction (AIM)'
      },
      responderThreshold: 3.5,
      unit: '/5',
      timing: {
        fr: '3 mois',
        en: '3 months'
      },
      cfirLink: ['IC3', 'IS6']
    }
  },
  // Create SMART design
  createDesign: function (config) {
    var responder = this.responseClassifiers[config.responseMetric] || this.responseClassifiers.adoption;
    return {
      id: 'SMART_' + Date.now(),
      template: this.templates[config.template] || this.templates.twoStage,
      projectName: config.projectName || '',
      stage1: {
        label: {
          fr: 'Ã‰tape 1 â€” StratÃ©gie initiale',
          en: 'Stage 1 â€” Initial strategy'
        },
        arms: config.stage1Arms || [{
          id: 'A',
          strategy: 'S01',
          label: {
            fr: 'Bras A: Formation standard',
            en: 'Arm A: Standard training'
          },
          intensity: 'standard'
        }, {
          id: 'B',
          strategy: 'S01+S04',
          label: {
            fr: 'Bras B: Formation + Champions',
            en: 'Arm B: Training + Champions'
          },
          intensity: 'enhanced'
        }],
        duration: config.stage1Duration || 12,
        durationUnit: 'weeks'
      },
      decisionPoint: {
        label: {
          fr: 'Point de dÃ©cision',
          en: 'Decision Point'
        },
        timing: responder.timing,
        metric: responder,
        threshold: config.threshold || responder.responderThreshold,
        classification: {
          responder: {
            fr: 'RÃ©pondeur (â‰¥ seuil)',
            en: 'Responder (â‰¥ threshold)'
          },
          nonResponder: {
            fr: 'Non-rÃ©pondeur (< seuil)',
            en: 'Non-responder (< threshold)'
          }
        }
      },
      stage2: {
        label: {
          fr: 'Ã‰tape 2 â€” StratÃ©gie adaptÃ©e',
          en: 'Stage 2 â€” Tailored strategy'
        },
        responderPaths: [{
          id: 'R1',
          label: {
            fr: 'Maintenir',
            en: 'Maintain'
          },
          action: 'continue',
          intensity: 'maintenance'
        }, {
          id: 'R2',
          label: {
            fr: 'AllÃ©ger (step-down)',
            en: 'Step-down'
          },
          action: 'reduce',
          intensity: 'light'
        }],
        nonResponderPaths: [{
          id: 'NR1',
          label: {
            fr: 'Augmenter l\'intensitÃ©',
            en: 'Augment intensity'
          },
          action: 'augment',
          additionalStrategies: ['S10', 'S03'],
          intensity: 'intensive'
        }, {
          id: 'NR2',
          label: {
            fr: 'Changer de stratÃ©gie',
            en: 'Switch strategy'
          },
          action: 'switch',
          newStrategy: 'S04+S08',
          intensity: 'alternative'
        }],
        duration: config.stage2Duration || 12,
        durationUnit: 'weeks'
      },
      decisionRules: [],
      log: [],
      createdAt: new Date().toISOString(),
      status: 'design'
    };
  },
  // Generate formal decision rules
  generateDecisionRules: function (design) {
    var rules = [];
    var metric = design.decisionPoint.metric;
    var threshold = design.decisionPoint.threshold;
    design.stage1.arms.forEach(function (arm) {
      design.stage2.responderPaths.forEach(function (path) {
        rules.push({
          id: 'DR_' + arm.id + '_R_' + path.id,
          condition: {
            arm: arm.id,
            response: 'responder',
            operator: '>=',
            threshold: threshold,
            unit: metric.unit
          },
          action: path,
          label: 'IF ' + arm.id + ' AND ' + metric.id + '>=' + threshold + metric.unit + ' â†’ ' + path.action
        });
      });
      design.stage2.nonResponderPaths.forEach(function (path) {
        rules.push({
          id: 'DR_' + arm.id + '_NR_' + path.id,
          condition: {
            arm: arm.id,
            response: 'non-responder',
            operator: '<',
            threshold: threshold,
            unit: metric.unit
          },
          action: path,
          label: 'IF ' + arm.id + ' AND ' + metric.id + '<' + threshold + metric.unit + ' â†’ ' + path.action
        });
      });
    });
    return rules;
  },
  // Simulate SMART outcomes (Monte Carlo)
  simulateOutcomes: function (design, nSim) {
    nSim = nSim || 1000;
    var dtrs = [];
    design.stage1.arms.forEach(function (arm) {
      design.stage2.responderPaths.forEach(function (rPath) {
        design.stage2.nonResponderPaths.forEach(function (nrPath) {
          var baseRR = arm.intensity === 'enhanced' ? 0.55 : 0.40;
          var nrBoost = nrPath.action === 'augment' ? 0.30 : nrPath.action === 'switch' ? 0.25 : 0.10;
          var rMaintain = rPath.action === 'continue' ? 0.90 : 0.80;
          var outcomes = [];
          for (var i = 0; i < nSim; i++) {
            var isR = Math.random() < baseRR + (Math.random() - 0.5) * 0.15;
            var o = isR ? rMaintain + (Math.random() - 0.5) * 0.1 : nrBoost + (Math.random() - 0.5) * 0.15;
            outcomes.push(Math.max(0, Math.min(1, o)));
          }
          var mean = outcomes.reduce(function (a, b) {
            return a + b;
          }, 0) / nSim;
          var sorted = outcomes.slice().sort(function (a, b) {
            return a - b;
          });
          var variance = outcomes.reduce(function (a, b) {
            return a + Math.pow(b - mean, 2);
          }, 0) / nSim;
          dtrs.push({
            id: 'DTR_' + arm.id + '_' + rPath.id + '_' + nrPath.id,
            label: arm.label.en + ' â†’ R:' + rPath.action + ' / NR:' + nrPath.action,
            labelFr: arm.label.fr + ' â†’ R:' + rPath.action + ' / NR:' + nrPath.action,
            stage1: arm,
            responderPath: rPath,
            nonResponderPath: nrPath,
            mean: Math.round(mean * 100),
            median: Math.round(sorted[Math.floor(nSim * 0.5)] * 100),
            p25: Math.round(sorted[Math.floor(nSim * 0.25)] * 100),
            p75: Math.round(sorted[Math.floor(nSim * 0.75)] * 100),
            sd: Math.round(Math.sqrt(variance) * 100),
            responderRate: Math.round(baseRR * 100),
            costMultiplier: nrPath.intensity === 'intensive' ? 1.35 : nrPath.intensity === 'alternative' ? 1.25 : 1.10
          });
        });
      });
    });
    dtrs.sort(function (a, b) {
      return b.mean - a.mean;
    });
    return {
      embeddedDTRs: dtrs,
      bestDTR: dtrs[0],
      simulationCount: nSim,
      citation: this.citation,
      generatedAt: new Date().toISOString()
    };
  },
  // Sample size estimate
  estimateSampleSize: function (effectSize, responderRate, power) {
    effectSize = effectSize || 0.30;
    responderRate = responderRate || 0.50;
    power = power || 0.80;
    var zAlpha = 1.96;
    var zBeta = power >= 0.90 ? 1.28 : 0.84;
    var baseN = Math.ceil(2 * Math.pow((zAlpha + zBeta) / effectSize, 2));
    var adjustedN = Math.ceil(baseN / (1 - responderRate));
    return {
      totalN: adjustedN * 2,
      perArm: adjustedN,
      effectSize: effectSize,
      power: power,
      responderRate: responderRate,
      note: 'Almirall et al. (2014) simplified. Consult biostatistician.'
    };
  }
};
console.log('âœ… MOUDAR v11.0: SMARTDesigner module loaded');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE: LLM PROTOCOL ANALYZER â€” AI Research Copilot (GAME-CHANGER)
// The feature that transforms MOUDAR from planning tool to research copilot
// Reference: Trinkley KE et al. (2024). Implementation Science, 19:21
// Reference: Pinnock H et al. (2017). BMJ, 356:i6795 (StaRI checklist)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var LLMProtocolAnalyzer = {
  VERSION: '11.0.0',
  citation: 'Trinkley KE et al. (2024). Implementation Science, 19:21',
  stariCitation: 'Pinnock H et al. (2017). BMJ, 356:i6795',
  // ---- ANALYSIS MODES ----
  modes: {
    protocol: {
      id: 'protocol',
      label: {
        fr: 'Analyse de Protocole',
        en: 'Protocol Analysis'
      },
      icon: 'ðŸ“‹',
      description: {
        fr: 'Analysez un protocole de recherche et identifiez les Ã©lÃ©ments IS',
        en: 'Analyze a research protocol and identify IS elements'
      }
    },
    grantReview: {
      id: 'grantReview',
      label: {
        fr: 'Revue de Subvention',
        en: 'Grant Review'
      },
      icon: 'ðŸ’°',
      description: {
        fr: 'Ã‰valuez une proposition de subvention contre RE-AIM/CFIR/StaRI',
        en: 'Evaluate a grant proposal against RE-AIM/CFIR/StaRI'
      }
    },
    manuscriptReview: {
      id: 'manuscriptReview',
      label: {
        fr: 'Revue de Manuscrit',
        en: 'Manuscript Review'
      },
      icon: 'ðŸ“„',
      description: {
        fr: 'VÃ©rifiez la conformitÃ© StaRI et identifiez les sections manquantes',
        en: 'Check StaRI compliance and identify missing sections'
      }
    },
    barrierScan: {
      id: 'barrierScan',
      label: {
        fr: 'Scan de BarriÃ¨res',
        en: 'Barrier Scan'
      },
      icon: 'ðŸ”',
      description: {
        fr: 'Identifiez les barriÃ¨res et facilitateurs dans un texte',
        en: 'Identify barriers and facilitators in text'
      }
    }
  },
  // ---- StaRI CHECKLIST (Pinnock 2017) ----
  stariChecklist: {
    title: [{
      id: 'ST01',
      item: {
        fr: 'Identification comme Ã©tude d\'implÃ©mentation',
        en: 'Identification as implementation study'
      },
      section: 'Title',
      weight: 1.0
    }],
    abstract: [{
      id: 'ST02',
      item: {
        fr: 'RÃ©sumÃ© structurÃ© incluant stratÃ©gie d\'implÃ©mentation',
        en: 'Structured summary including implementation strategy'
      },
      section: 'Abstract',
      weight: 0.9
    }],
    introduction: [{
      id: 'ST03',
      item: {
        fr: 'Justification scientifique de l\'intervention',
        en: 'Scientific rationale for intervention'
      },
      section: 'Introduction',
      weight: 0.8
    }, {
      id: 'ST04',
      item: {
        fr: 'Identification des barriÃ¨res et facilitateurs',
        en: 'Identification of barriers and facilitators'
      },
      section: 'Introduction',
      weight: 0.9
    }, {
      id: 'ST05',
      item: {
        fr: 'Objectifs d\'implÃ©mentation distincts des objectifs cliniques',
        en: 'Implementation objectives distinct from clinical objectives'
      },
      section: 'Introduction',
      weight: 1.0
    }],
    methods: [{
      id: 'ST06',
      item: {
        fr: 'Design de l\'Ã©tude d\'implÃ©mentation',
        en: 'Implementation study design'
      },
      section: 'Methods',
      weight: 1.0
    }, {
      id: 'ST07',
      item: {
        fr: 'Description du contexte',
        en: 'Description of context/setting'
      },
      section: 'Methods',
      weight: 0.95
    }, {
      id: 'ST08',
      item: {
        fr: 'Cadre thÃ©orique/conceptuel',
        en: 'Theoretical/conceptual framework'
      },
      section: 'Methods',
      weight: 1.0
    }, {
      id: 'ST09',
      item: {
        fr: 'Description de l\'intervention',
        en: 'Description of intervention'
      },
      section: 'Methods',
      weight: 0.95
    }, {
      id: 'ST10',
      item: {
        fr: 'Description de la stratÃ©gie d\'implÃ©mentation',
        en: 'Description of implementation strategy'
      },
      section: 'Methods',
      weight: 1.0
    }, {
      id: 'ST11',
      item: {
        fr: 'Outcomes d\'implÃ©mentation mesurÃ©s',
        en: 'Implementation outcomes measured'
      },
      section: 'Methods',
      weight: 1.0
    }, {
      id: 'ST12',
      item: {
        fr: 'Outcomes cliniques/de service',
        en: 'Clinical/service outcomes'
      },
      section: 'Methods',
      weight: 0.85
    }, {
      id: 'ST13',
      item: {
        fr: 'Taille d\'Ã©chantillon et justification',
        en: 'Sample size and justification'
      },
      section: 'Methods',
      weight: 0.8
    }, {
      id: 'ST14',
      item: {
        fr: 'Plan d\'analyse (implÃ©mentation)',
        en: 'Analysis plan (implementation)'
      },
      section: 'Methods',
      weight: 0.9
    }, {
      id: 'ST15',
      item: {
        fr: 'ConsidÃ©rations Ã©thiques',
        en: 'Ethical considerations'
      },
      section: 'Methods',
      weight: 0.7
    }],
    results: [{
      id: 'ST16',
      item: {
        fr: 'RÃ©sultats d\'implÃ©mentation rapportÃ©s',
        en: 'Implementation outcomes reported'
      },
      section: 'Results',
      weight: 1.0
    }, {
      id: 'ST17',
      item: {
        fr: 'FidÃ©litÃ©/adaptations documentÃ©es',
        en: 'Fidelity/adaptations documented'
      },
      section: 'Results',
      weight: 0.9
    }, {
      id: 'ST18',
      item: {
        fr: 'RÃ©sultats cliniques rapportÃ©s',
        en: 'Clinical outcomes reported'
      },
      section: 'Results',
      weight: 0.85
    }],
    discussion: [{
      id: 'ST19',
      item: {
        fr: 'InterprÃ©tation des rÃ©sultats d\'implÃ©mentation',
        en: 'Interpretation of implementation results'
      },
      section: 'Discussion',
      weight: 0.9
    }, {
      id: 'ST20',
      item: {
        fr: 'Limites liÃ©es Ã  l\'implÃ©mentation',
        en: 'Implementation-related limitations'
      },
      section: 'Discussion',
      weight: 0.8
    }, {
      id: 'ST21',
      item: {
        fr: 'GÃ©nÃ©ralisabilitÃ©/transfÃ©rabilitÃ©',
        en: 'Generalizability/transferability'
      },
      section: 'Discussion',
      weight: 0.85
    }, {
      id: 'ST22',
      item: {
        fr: 'Implications pour la pratique/politique',
        en: 'Implications for practice/policy'
      },
      section: 'Discussion',
      weight: 0.9
    }, {
      id: 'ST23',
      item: {
        fr: 'Prochaines Ã©tapes / scale-up',
        en: 'Next steps / scale-up'
      },
      section: 'Discussion',
      weight: 0.75
    }]
  },
  // ---- DEEP NLP EXTRACTION PATTERNS ----
  extractionPatterns: {
    innovation: {
      patterns: [/(?:intervention|innovation|programme|program|traitement|treatment|approche|approach|modÃ¨le|model|protocole|protocol)\s*[:\-]?\s*([^\.]{10,120})/gi, /(?:we\s+(?:developed|designed|implemented|tested)|nous\s+avons\s+(?:dÃ©veloppÃ©|conÃ§u|mis en|testÃ©))\s+([^\.]{10,100})/gi, /(?:evidence[- ]based|fondÃ© sur les preuves|donnÃ©es probantes)\s+([^\.]{5,80})/gi],
      label: {
        fr: 'Innovation / Intervention',
        en: 'Innovation / Intervention'
      }
    },
    context: {
      patterns: [/(?:setting|contexte|milieu|environnement|lieu)\s*[:\-]?\s*([^\.]{5,100})/gi, /(?:conducted|menÃ©|rÃ©alisÃ©|effectuÃ©)\s+(?:in|dans|au|aux|Ã )\s+([^\.]{5,80})/gi, /(?:hospital|hÃ´pital|clinic|clinique|center|centre|community|communautÃ©|district|province|region|urban|rural|primary care|soins primaires)[^\.]{0,60}/gi],
      label: {
        fr: 'Contexte',
        en: 'Context/Setting'
      }
    },
    population: {
      patterns: [/(?:participants?|patients?|bÃ©nÃ©ficiaires|beneficiaries|population|Ã©chantillon|sample)\s*[:\-]?\s*([^\.]{10,100})/gi, /(?:eligib|inclusion|exclusion)\s*(?:criteria|critÃ¨res)\s*[:\-]?\s*([^\.]{10,120})/gi, /[Nn]\s*=\s*(\d+)/g, /(\d+)\s*(?:participants?|patients?|sites?|facilities|Ã©tablissements)/gi],
      label: {
        fr: 'Population / Ã‰chantillon',
        en: 'Population / Sample'
      }
    },
    strategies: {
      patterns: [/(?:strateg|implementation\s+strateg|stratÃ©gie d'implÃ©mentation)[^\.]{0,150}/gi, /(?:training|formation|audit|feedback|facilitation|champion|supervision|coaching|mentoring|incentive|coalition|adaptation|task.?shift)/gi],
      label: {
        fr: 'StratÃ©gies d\'implÃ©mentation',
        en: 'Implementation strategies'
      }
    },
    outcomes: {
      patterns: [/(?:primary\s+outcome|critÃ¨re\s+principal|outcome\s+measure|mesure\s+de\s+rÃ©sultat)\s*[:\-]?\s*([^\.]{10,100})/gi, /(?:secondary\s+outcome|critÃ¨re\s+secondaire)\s*[:\-]?\s*([^\.]{10,100})/gi, /(?:implementation\s+outcome|outcome\s+d'implÃ©mentation|RE-AIM|acceptab|adopt|feasib|fidelit|penetrat|sustainab)/gi],
      label: {
        fr: 'Outcomes',
        en: 'Outcomes'
      }
    },
    framework: {
      patterns: [/(?:CFIR|Consolidated Framework|RE-AIM|EPIS|NPT|Normalization Process|COM-B|TDF|Theoretical Domains|Proctor|FRAME|Precede.?Proceed|Getting to Outcomes|Quality Implementation|Interactive Systems|PARIHS|i-PARIHS)/gi],
      label: {
        fr: 'Cadres thÃ©oriques',
        en: 'Theoretical frameworks'
      }
    },
    equity: {
      patterns: [/(?:equit|equity|inÃ©galitÃ©|inequality|disparit|health disparit|social determinant|dÃ©terminant social|vulnerable|vulnÃ©rable|marginal|underserved|sous-desservi|gender|genre|ethnic|ethnique|racial|race|socioeconomic|socioÃ©conomique|rural|disability|handicap|indigenous|autochtone|refugee|rÃ©fugiÃ©|migrant|low.?income|faible revenu)/gi],
      label: {
        fr: 'Ã‰quitÃ© en santÃ©',
        en: 'Health Equity'
      }
    },
    sustainability: {
      patterns: [/(?:sustainab|pÃ©rennit|pÃ©rennisation|scale.?up|mise Ã  l'Ã©chelle|institutionnal|routiniz|routinis|embed|ancrage|long.?term|long terme|maintenance|maintien|after\s+funding|aprÃ¨s\s+financement|capacity\s+building|renforcement\s+des\s+capacitÃ©s)/gi],
      label: {
        fr: 'PÃ©rennitÃ© / Scaling',
        en: 'Sustainability / Scaling'
      }
    },
    design: {
      patterns: [/(?:randomized|randomisÃ©|RCT|essai contrÃ´lÃ©|stepped.?wedge|hybrid|cluster|quasi.?experiment|pre.?post|mixed.?method|mÃ©thode mixte|qualitative|quantitative|SMART design|pragmatic trial|effectiveness.?implementation)/gi],
      label: {
        fr: 'Design de l\'Ã©tude',
        en: 'Study design'
      }
    }
  },
  // ---- CFIR 2.0 KEYWORD DETECTOR ----
  cfirDetectors: {
    IC2: ['evidence', 'preuves', 'donnÃ©es probantes', 'efficacy', 'efficacitÃ©', 'systematic review', 'revue systÃ©matique', 'meta-analysis', 'mÃ©ta-analyse'],
    IC4: ['adaptab', 'adaptation', 'tailoring', 'cultural adaptation', 'adaptation culturelle', 'flexible', 'modifiable'],
    IC6: ['complex', 'difficul', 'barrier', 'barriÃ¨re', 'obstacle', 'challenge', 'dÃ©fi'],
    IC7: ['design', 'conception', 'packaging', 'bundl', 'user-friendly', 'interface'],
    OS3: ['local conditions', 'conditions locales', 'community needs', 'besoins communautaires', 'social determinant', 'dÃ©terminant social'],
    OS5: ['policy', 'politique', 'regulation', 'rÃ©glementation', 'guideline', 'recommandation', 'mandate', 'mandat'],
    IS4: ['culture', 'norms', 'normes', 'values', 'valeurs', 'beliefs', 'croyances'],
    IS6: ['compatibility', 'compatibilitÃ©', 'fit', 'alignment', 'alignement', 'workflow', 'flux de travail'],
    IS11: ['leadership', 'leader', 'manager', 'gestionnaire', 'director', 'directeur', 'champion', 'sponsor'],
    IS12: ['resource', 'ressource', 'funding', 'financement', 'budget', 'staff', 'personnel', 'time', 'temps'],
    IN2: ['capability', 'capacitÃ©', 'competence', 'compÃ©tence', 'skill', 'ability', 'training need', 'besoin de formation'],
    IN4: ['motivation', 'willingness', 'volontÃ©', 'readiness', 'prÃ©paration', 'buy-in', 'adhÃ©sion'],
    PR2: ['planning', 'planification', 'action plan', 'plan d\'action', 'timeline', 'chronogramme', 'workplan'],
    PR3: ['engaging', 'engagement', 'stakeholder', 'partie prenante', 'involving', 'implication', 'participat'],
    PR5: ['evaluat', 'Ã©valuat', 'monitor', 'suivi', 'feedback', 'retour', 'reflect', 'rÃ©flex', 'audit']
  },
  // ---- RE-AIM DETECTOR ----
  reaimDetectors: {
    reach: ['reach', 'portÃ©e', 'coverage', 'couverture', 'participation rate', 'taux de participation', 'who participates', 'qui participe', 'representativeness', 'reprÃ©sentativitÃ©', 'target population'],
    effectiveness: ['effectiveness', 'efficacitÃ©', 'clinical outcome', 'rÃ©sultat clinique', 'quality of life', 'qualitÃ© de vie', 'patient outcome', 'health outcome', 'symptom', 'symptÃ´me', 'mortality', 'mortalitÃ©'],
    adoption: ['adoption', 'uptake', 'implementation rate', 'taux d\'implÃ©mentation', 'provider', 'prestataire', 'setting', 'organization'],
    implementation: ['implementation', 'implÃ©mentation', 'mise en Å“uvre', 'fidelity', 'fidÃ©litÃ©', 'cost', 'coÃ»t', 'protocol adherence', 'adherence', 'delivery'],
    maintenance: ['maintenance', 'maintien', 'sustainability', 'pÃ©rennitÃ©', 'sustained', 'long-term', 'institutionalization', 'institutionnalisation', 'after funding', 'aprÃ¨s financement']
  },
  // ---- MAIN ANALYSIS FUNCTION ----
  analyze: function (text, mode, lang) {
    lang = lang || 'fr';
    mode = mode || 'protocol';
    var self = this;
    var textLower = text.toLowerCase();
    var result = {
      mode: mode,
      lang: lang,
      wordCount: text.split(/\s+/).length,
      extractedElements: {},
      cfirMapping: {},
      reaimMapping: {},
      stariCompliance: null,
      gaps: [],
      strengths: [],
      recommendations: [],
      scores: {},
      generatedAt: new Date().toISOString()
    };

    // 1. EXTRACT ELEMENTS
    Object.keys(self.extractionPatterns).forEach(function (category) {
      var config = self.extractionPatterns[category];
      var matches = [];
      config.patterns.forEach(function (pattern) {
        var re = new RegExp(pattern.source, pattern.flags);
        var m;
        while ((m = re.exec(text)) !== null) {
          var extracted = (m[1] || m[0]).trim();
          if (extracted.length > 3 && extracted.length < 200) {
            matches.push(extracted);
          }
        }
      });
      // Deduplicate
      var unique = [];
      matches.forEach(function (m) {
        var isDuplicate = unique.some(function (u) {
          return u.toLowerCase() === m.toLowerCase();
        });
        if (!isDuplicate) unique.push(m);
      });
      result.extractedElements[category] = {
        label: config.label[lang],
        count: unique.length,
        items: unique.slice(0, 10),
        detected: unique.length > 0
      };
    });

    // 2. MAP TO CFIR 2.0
    var cfirTotal = 0;
    var cfirDetected = 0;
    Object.keys(self.cfirDetectors).forEach(function (constructId) {
      var keywords = self.cfirDetectors[constructId];
      var found = keywords.filter(function (kw) {
        return textLower.includes(kw.toLowerCase());
      });
      cfirTotal++;
      var detected = found.length > 0;
      if (detected) cfirDetected++;
      result.cfirMapping[constructId] = {
        detected: detected,
        matches: found,
        strength: found.length >= 3 ? 'strong' : found.length >= 1 ? 'partial' : 'absent'
      };
    });
    result.scores.cfir = Math.round(cfirDetected / cfirTotal * 100);

    // 3. MAP TO RE-AIM
    var reaimTotal = 0;
    var reaimDetected = 0;
    Object.keys(self.reaimDetectors).forEach(function (dimId) {
      var keywords = self.reaimDetectors[dimId];
      var found = keywords.filter(function (kw) {
        return textLower.includes(kw.toLowerCase());
      });
      reaimTotal++;
      var detected = found.length > 0;
      if (detected) reaimDetected++;
      result.reaimMapping[dimId] = {
        detected: detected,
        matches: found,
        strength: found.length >= 3 ? 'strong' : found.length >= 1 ? 'partial' : 'absent'
      };
    });
    result.scores.reaim = Math.round(reaimDetected / reaimTotal * 100);

    // 4. StaRI COMPLIANCE CHECK
    if (mode === 'manuscriptReview' || mode === 'grantReview' || mode === 'protocol') {
      result.stariCompliance = self.checkStaRI(text, lang);
      result.scores.stari = result.stariCompliance.score;
    }

    // 5. GAP IDENTIFICATION
    result.gaps = self.identifyGaps(result, lang);

    // 6. STRENGTHS
    result.strengths = self.identifyStrengths(result, lang);

    // 7. RECOMMENDATIONS
    result.recommendations = self.generateRecommendations(result, lang);

    // 8. GLOBAL SCORE
    result.scores.global = Math.round(result.scores.cfir * 0.30 + result.scores.reaim * 0.25 + (result.scores.stari || 0) * 0.25 + (result.extractedElements.equity.detected ? 100 : 0) * 0.10 + (result.extractedElements.sustainability.detected ? 100 : 0) * 0.10);
    return result;
  },
  // ---- StaRI COMPLIANCE ----
  checkStaRI: function (text, lang) {
    var self = this;
    var textLower = text.toLowerCase();
    var items = [];
    var totalWeight = 0;
    var scoredWeight = 0;
    var stariKeywords = {
      ST01: ['implementation', 'implÃ©mentation', 'mise en Å“uvre', 'implementation study', 'Ã©tude d\'implÃ©mentation'],
      ST04: ['barrier', 'barriÃ¨re', 'facilitator', 'facilitateur', 'determinant', 'dÃ©terminant'],
      ST05: ['implementation objective', 'objectif d\'implÃ©mentation', 'implementation outcome', 'outcome d\'implÃ©mentation'],
      ST07: ['setting', 'contexte', 'context', 'site', 'facility', 'Ã©tablissement'],
      ST08: ['CFIR', 'RE-AIM', 'framework', 'cadre', 'theory', 'thÃ©orie', 'conceptual', 'conceptuel'],
      ST09: ['intervention', 'innovation', 'evidence-based', 'fondÃ© sur les preuves'],
      ST10: ['implementation strategy', 'stratÃ©gie d\'implÃ©mentation', 'ERIC', 'strategy'],
      ST11: ['acceptability', 'acceptabilitÃ©', 'adoption', 'feasibility', 'faisabilitÃ©', 'fidelity', 'fidÃ©litÃ©', 'penetration', 'sustainability', 'pÃ©rennitÃ©'],
      ST13: ['sample size', 'taille d\'Ã©chantillon', 'power', 'puissance', 'N =', 'n ='],
      ST17: ['fidelity', 'fidÃ©litÃ©', 'adaptation', 'modification', 'FRAME'],
      ST21: ['generalizab', 'gÃ©nÃ©ralisab', 'transferab', 'transfÃ©rab', 'external validity', 'validitÃ© externe'],
      ST22: ['implication', 'policy', 'politique', 'practice', 'pratique', 'recommendation']
    };
    Object.keys(self.stariChecklist).forEach(function (section) {
      self.stariChecklist[section].forEach(function (stariItem) {
        var keywords = stariKeywords[stariItem.id] || [];
        var found = keywords.filter(function (kw) {
          return textLower.includes(kw.toLowerCase());
        });
        var detected = found.length > 0;
        totalWeight += stariItem.weight;
        if (detected) scoredWeight += stariItem.weight;
        items.push({
          id: stariItem.id,
          item: stariItem.item[lang],
          section: stariItem.section,
          weight: stariItem.weight,
          detected: detected,
          matches: found.slice(0, 3),
          status: detected ? 'present' : 'missing'
        });
      });
    });
    return {
      score: totalWeight > 0 ? Math.round(scoredWeight / totalWeight * 100) : 0,
      items: items,
      totalItems: items.length,
      detectedItems: items.filter(function (i) {
        return i.detected;
      }).length,
      missingItems: items.filter(function (i) {
        return !i.detected;
      }),
      citation: self.stariCitation
    };
  },
  // ---- GAP IDENTIFICATION ----
  identifyGaps: function (result, lang) {
    var gaps = [];
    var t = function (fr, en) {
      return lang === 'fr' ? fr : en;
    };

    // Critical gaps
    if (!result.extractedElements.equity.detected) {
      gaps.push({
        severity: 'critical',
        category: 'equity',
        message: t('âŒ Aucune analyse d\'Ã©quitÃ© dÃ©tectÃ©e. Depuis 2022, c\'est une exigence pour toute publication IS.', 'âŒ No equity analysis detected. Since 2022, this is a requirement for any IS publication.'),
        reference: 'Woodward et al. (2019)',
        action: t('Ajouter un module Health Equity Implementation Framework', 'Add Health Equity Implementation Framework module')
      });
    }
    if (!result.extractedElements.sustainability.detected) {
      gaps.push({
        severity: 'critical',
        category: 'sustainability',
        message: t('âŒ PÃ©rennitÃ© non abordÃ©e. Les Ã©valuateurs vÃ©rifieront ce point en premier.', 'âŒ Sustainability not addressed. Reviewers will check this first.'),
        reference: 'Scheirer & Dearing (2011)',
        action: t('Ajouter un plan de pÃ©rennitÃ© et utiliser le module Scheirer de MOUDAR', 'Add sustainability plan using MOUDAR\'s Scheirer module')
      });
    }
    if (!result.extractedElements.framework.detected) {
      gaps.push({
        severity: 'critical',
        category: 'framework',
        message: t('âŒ Aucun cadre thÃ©orique/conceptuel dÃ©tectÃ©. C\'est la base de toute Ã©tude IS.', 'âŒ No theoretical/conceptual framework detected. This is the foundation of any IS study.'),
        reference: 'Nilsen (2015)',
        action: t('SÃ©lectionner et appliquer un cadre (CFIR 2.0, RE-AIM, NPT, etc.)', 'Select and apply a framework (CFIR 2.0, RE-AIM, NPT, etc.)')
      });
    }

    // RE-AIM gaps
    Object.keys(result.reaimMapping).forEach(function (dim) {
      if (!result.reaimMapping[dim].detected) {
        gaps.push({
          severity: 'important',
          category: 'reaim',
          message: t('âš ï¸ Dimension RE-AIM "' + dim.charAt(0).toUpperCase() + dim.slice(1) + '" non dÃ©tectÃ©e', 'âš ï¸ RE-AIM dimension "' + dim.charAt(0).toUpperCase() + dim.slice(1) + '" not detected'),
          reference: 'Glasgow et al. (2019)',
          action: t('Ajouter des mesures pour la dimension ' + dim, 'Add measures for ' + dim + ' dimension')
        });
      }
    });

    // Proctor outcome gaps
    var proctorTerms = ['acceptability', 'adoption', 'appropriateness', 'feasibility', 'fidelity', 'implementation cost', 'penetration'];
    var textLower = (result.extractedElements.outcomes.items || []).join(' ').toLowerCase();
    var proctorDetected = proctorTerms.filter(function (term) {
      return textLower.includes(term) || (result.extractedElements.outcomes.items || []).some(function (i) {
        return i.toLowerCase().includes(term);
      });
    });
    if (proctorDetected.length < 3) {
      gaps.push({
        severity: 'important',
        category: 'outcomes',
        message: t('âš ï¸ Seulement ' + proctorDetected.length + '/8 outcomes d\'implÃ©mentation (Proctor) dÃ©tectÃ©s', 'âš ï¸ Only ' + proctorDetected.length + '/8 implementation outcomes (Proctor) detected'),
        reference: 'Proctor et al. (2011)',
        action: t('Utiliser le module Proctor Outcomes de MOUDAR pour complÃ©ter', 'Use MOUDAR\'s Proctor Outcomes module to complete')
      });
    }

    // Design gap
    if (!result.extractedElements.design.detected) {
      gaps.push({
        severity: 'important',
        category: 'design',
        message: t('âš ï¸ Design d\'Ã©tude non clairement identifiÃ©', 'âš ï¸ Study design not clearly identified'),
        action: t('SpÃ©cifier le design (hybrid, stepped-wedge, etc.)', 'Specify the design (hybrid, stepped-wedge, etc.)')
      });
    }
    return gaps.sort(function (a, b) {
      return a.severity === 'critical' ? -1 : b.severity === 'critical' ? 1 : 0;
    });
  },
  // ---- STRENGTH IDENTIFICATION ----
  identifyStrengths: function (result, lang) {
    var strengths = [];
    var t = function (fr, en) {
      return lang === 'fr' ? fr : en;
    };
    if (result.extractedElements.framework.detected) strengths.push({
      message: t('âœ… Cadre thÃ©orique identifiÃ©', 'âœ… Theoretical framework identified'),
      items: result.extractedElements.framework.items
    });
    if (result.extractedElements.equity.detected) strengths.push({
      message: t('âœ… Analyse d\'Ã©quitÃ© prÃ©sente', 'âœ… Equity analysis present'),
      items: result.extractedElements.equity.items
    });
    if (result.extractedElements.sustainability.detected) strengths.push({
      message: t('âœ… Plan de pÃ©rennitÃ© abordÃ©', 'âœ… Sustainability plan addressed'),
      items: result.extractedElements.sustainability.items
    });
    if (result.scores.cfir >= 60) strengths.push({
      message: t('âœ… Bonne couverture CFIR (' + result.scores.cfir + '%)', 'âœ… Good CFIR coverage (' + result.scores.cfir + '%)')
    });
    if (result.scores.reaim >= 80) strengths.push({
      message: t('âœ… Couverture RE-AIM complÃ¨te', 'âœ… Complete RE-AIM coverage')
    });
    if (result.extractedElements.strategies.count >= 3) strengths.push({
      message: t('âœ… StratÃ©gies d\'implÃ©mentation multiples dÃ©tectÃ©es', 'âœ… Multiple implementation strategies detected'),
      items: result.extractedElements.strategies.items
    });
    return strengths;
  },
  // ---- RECOMMENDATION GENERATOR ----
  generateRecommendations: function (result, lang) {
    var recs = [];
    var t = function (fr, en) {
      return lang === 'fr' ? fr : en;
    };
    if (result.scores.global < 40) {
      recs.push({
        priority: 'critical',
        icon: 'ðŸ”´',
        message: t('Ce protocole nÃ©cessite une refonte majeure de sa composante IS. Utilisez l\'assistant MOUDAR pour reconstruire le design.', 'This protocol needs a major overhaul of its IS component. Use the MOUDAR wizard to rebuild the design.')
      });
    }
    if (!result.extractedElements.framework.detected) {
      recs.push({
        priority: 'critical',
        icon: 'ðŸ”´',
        message: t('Adoptez CFIR 2.0 + RE-AIM comme cadres complÃ©mentaires. CFIR pour les dÃ©terminants, RE-AIM pour les outcomes. Utilisez l\'Ã©valuateur CFIR 2.0 de MOUDAR.', 'Adopt CFIR 2.0 + RE-AIM as complementary frameworks. CFIR for determinants, RE-AIM for outcomes. Use MOUDAR\'s CFIR 2.0 evaluator.')
      });
    }

    // CFIR-specific recommendations
    var weakCFIR = Object.keys(result.cfirMapping).filter(function (c) {
      return !result.cfirMapping[c].detected;
    });
    if (weakCFIR.length > 5) {
      recs.push({
        priority: 'high',
        icon: 'ðŸŸ ',
        message: t(weakCFIR.length + ' construits CFIR non couverts: ' + weakCFIR.slice(0, 5).join(', ') + '... Utilisez le module CFIR-ERIC de MOUDAR pour identifier les stratÃ©gies recommandÃ©es.', weakCFIR.length + ' CFIR constructs not covered: ' + weakCFIR.slice(0, 5).join(', ') + '... Use MOUDAR\'s CFIR-ERIC module to identify recommended strategies.')
      });
    }

    // StaRI recommendations
    if (result.stariCompliance && result.stariCompliance.missingItems.length > 0) {
      var missing = result.stariCompliance.missingItems.slice(0, 3);
      recs.push({
        priority: 'high',
        icon: 'ðŸŸ ',
        message: t('Ã‰lÃ©ments StaRI manquants: ' + missing.map(function (m) {
          return m.item;
        }).join('; '), 'Missing StaRI items: ' + missing.map(function (m) {
          return m.item;
        }).join('; '))
      });
    }

    // Proctor outcomes
    if (!result.extractedElements.outcomes.detected || result.extractedElements.outcomes.count < 3) {
      recs.push({
        priority: 'high',
        icon: 'ðŸŸ ',
        message: t('Ajoutez des outcomes d\'implÃ©mentation explicites (Proctor 2011): acceptabilitÃ©, adoption, faisabilitÃ©, fidÃ©litÃ© au minimum. Utilisez le module Outcomes de MOUDAR.', 'Add explicit implementation outcomes (Proctor 2011): acceptability, adoption, feasibility, fidelity at minimum. Use MOUDAR\'s Outcomes module.')
      });
    }

    // NPT recommendation
    recs.push({
      priority: 'medium',
      icon: 'ðŸŸ¡',
      message: t('ConsidÃ©rez l\'ajout d\'une Ã©valuation NPT (Normalisation Process Theory) pour anticiper l\'ancrage dans la routine. Utilisez le module NPT de MOUDAR.', 'Consider adding NPT (Normalization Process Theory) assessment to anticipate routine embedding. Use MOUDAR\'s NPT module.')
    });

    // FRAME recommendation
    if (result.extractedElements.innovation.detected) {
      recs.push({
        priority: 'medium',
        icon: 'ðŸŸ¡',
        message: t('Planifiez la documentation des adaptations avec FRAME (Stirman 2019). Utilisez le FRAME Tracker de MOUDAR pour un suivi systÃ©matique.', 'Plan adaptation documentation with FRAME (Stirman 2019). Use MOUDAR\'s FRAME Tracker for systematic tracking.')
      });
    }

    // SMART recommendation
    if (result.extractedElements.design.detected) {
      recs.push({
        priority: 'medium',
        icon: 'ðŸŸ¡',
        message: t('Pour un design adaptatif, considÃ©rez un SMART (Sequential Multiple Assignment Randomized Trial). Utilisez le SMART Designer de MOUDAR.', 'For adaptive design, consider a SMART (Sequential Multiple Assignment Randomized Trial). Use MOUDAR\'s SMART Designer.')
      });
    }
    return recs;
  }
};
console.log('âœ… MOUDAR v11.0: LLMProtocolAnalyzer loaded â€” Research Copilot ready');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE: DEEP AI ANALYZER â€” LLM-Powered Protocol Analysis
// GAME-CHANGER: Real AI analysis via Anthropic API
// First-ever AI copilot purpose-built for Implementation Science
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var DeepAIAnalyzer = {
  VERSION: '11.0.0',
  MODEL: 'claude-sonnet-4-20250514',
  MAX_TOKENS: 4096,
  systemPrompts: {
    protocol: {
      fr: 'Tu es un expert mondial en Science de l\'ImplÃ©mentation. Tu connais CFIR 2.0 (Damschroder 2022, 39 construits), RE-AIM (Glasgow 2019), 73 stratÃ©gies ERIC (Powell 2015), 8 outcomes Proctor (2011), NPT (May 2009), FRAME (Stirman 2019), StaRI (Pinnock 2017), SMART (Almirall 2014). Identifie forces, faiblesses, gaps critiques avec rÃ©fÃ©rences exactes.',
      en: 'You are a world-class Implementation Science expert. You know CFIR 2.0 (Damschroder 2022, 39 constructs), RE-AIM (Glasgow 2019), 73 ERIC strategies (Powell 2015), 8 Proctor outcomes (2011), NPT (May 2009), FRAME (Stirman 2019), StaRI (Pinnock 2017), SMART (Almirall 2014). Identify strengths, weaknesses, critical gaps with exact references.'
    },
    grantReview: {
      fr: 'Tu es Ã©valuateur expert de subventions IS (NIH/Fonds Mondial/Wellcome Trust). Ã‰value cadre thÃ©orique, design, outcomes Proctor, Ã©quitÃ©, pÃ©rennitÃ©, budget. Donne un score de finanÃ§abilitÃ©.',
      en: 'You are an expert IS grant reviewer (NIH/Global Fund/Wellcome Trust). Evaluate framework, design, Proctor outcomes, equity, sustainability, budget. Provide fundability score.'
    },
    manuscriptReview: {
      fr: 'Tu es reviewer pour Implementation Science journal/BMJ. Ã‰value conformitÃ© StaRI (Pinnock 2017), rigueur mÃ©thodologique, transparence du reporting.',
      en: 'You are a reviewer for Implementation Science journal/BMJ. Assess StaRI compliance (Pinnock 2017), methodological rigor, reporting transparency.'
    },
    barrierScan: {
      fr: 'Tu es expert en analyse de barriÃ¨res/facilitateurs IS. Mappe chaque barriÃ¨re sur les 39 construits CFIR 2.0 et recommande des stratÃ©gies ERIC (Waltz 2019).',
      en: 'You are an expert in IS barrier/facilitator analysis. Map each barrier to 39 CFIR 2.0 constructs and recommend ERIC strategies (Waltz 2019).'
    },
    sectionGen: {
      fr: 'Tu es expert en rÃ©daction scientifique IS. GÃ©nÃ¨re des sections selon StaRI (Pinnock 2017) avec rÃ©fÃ©rences exactes.',
      en: 'You are an expert IS scientific writer. Generate sections per StaRI (Pinnock 2017) with exact references.'
    }
  },
  generableSections: {
    theoreticalFramework: {
      label: {
        fr: 'Cadre thÃ©orique (CFIR 2.0 + RE-AIM)',
        en: 'Theoretical framework (CFIR 2.0 + RE-AIM)'
      },
      stariRef: 'ST08'
    },
    implementationStrategies: {
      label: {
        fr: 'StratÃ©gies ERIC',
        en: 'ERIC Strategies'
      },
      stariRef: 'ST10'
    },
    implementationOutcomes: {
      label: {
        fr: 'Outcomes Proctor',
        en: 'Proctor Outcomes'
      },
      stariRef: 'ST11'
    },
    contextDescription: {
      label: {
        fr: 'Description du contexte',
        en: 'Context description'
      },
      stariRef: 'ST07'
    },
    equityPlan: {
      label: {
        fr: 'Plan d\'Ã©quitÃ©',
        en: 'Equity plan'
      },
      stariRef: 'N/A'
    },
    sustainabilityPlan: {
      label: {
        fr: 'Plan de pÃ©rennitÃ©',
        en: 'Sustainability plan'
      },
      stariRef: 'ST23'
    },
    adaptationMonitoring: {
      label: {
        fr: 'Suivi des adaptations (FRAME)',
        en: 'Adaptation monitoring (FRAME)'
      },
      stariRef: 'ST17'
    },
    analysisMethodology: {
      label: {
        fr: 'MÃ©thodologie d\'analyse',
        en: 'Analysis methodology'
      },
      stariRef: 'ST14'
    }
  },
  callAPI: function (systemPrompt, userPrompt, onSuccess, onError) {
    // â”€â”€ SECURITY: Never call LLM APIs directly from browser â”€â”€
    // In production, route through YOUR backend proxy:
    //   var PROXY_URL = 'https://your-domain.com/api/llm-proxy';
    // The proxy holds the API key server-side and forwards the request.
    // For local demo, we use the configured MOUDAR_API endpoint.
    var proxyUrl = (window.MOUDAR_LLM_PROXY || '').trim();
    if (!proxyUrl) {
      // Fallback: check if user configured a proxy
      proxyUrl = (localStorage.getItem('MOUDAR_LLM_PROXY') || '').trim();
    }
    if (!proxyUrl) {
      var msg = 'LLM Proxy non configurÃ©. En production, configurez window.MOUDAR_LLM_PROXY = "https://votre-proxy.com/api/llm"';
      console.warn('[MOUDAR Security] ' + msg);
      if (onError) onError(new Error(msg));
      return;
    }
    fetch(proxyUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: this.MODEL,
        max_tokens: this.MAX_TOKENS,
        system: systemPrompt,
        messages: [{
          role: 'user',
          content: userPrompt
        }]
      })
    }).then(function (r) {
      if (!r.ok) throw new Error('API Error: ' + r.status);
      return r.json();
    }).then(function (data) {
      var text = data.content.map(function (c) {
        return c.text || '';
      }).join('\n');
      onSuccess(text);
    }).catch(function (err) {
      console.error('[MOUDAR DeepAI]', err);
      if (onError) onError(err);
    });
  },
  analyzeDeep: function (text, mode, lang, onSuccess, onError) {
    var sys = this.systemPrompts[mode] ? this.systemPrompts[mode][lang] || this.systemPrompts[mode].en : this.systemPrompts.protocol[lang];
    var prompt = (lang === 'fr' ? 'Analyse ce protocole IS. RÃ©ponds en JSON: ' : 'Analyze this IS protocol. Respond in JSON: ') + '{"globalScore":(0-100),"publishabilityScore":(0-100),"fundabilityScore":(0-100),' + '"cfirCoverage":{"score":0,"coveredConstructs":[],"missingCritical":[],"analysis":""},' + '"reaimCoverage":{"score":0,"dimensions":{}},' + '"stariCompliance":{"score":0,"compliantItems":[],"missingItems":[]},' + '"equityAnalysis":{"present":false,"dimensions":[],"gaps":[]},' + '"designQuality":{"type":"","score":0,"strengths":[],"weaknesses":[]},' + '"outcomesAssessment":{"implementationOutcomes":[],"missingProctorOutcomes":[]},' + '"strategiesIdentified":[{"name":"","ericCode":"","cfirTargets":[]}],' + '"strengths":[{"item":"","reference":""}],' + '"criticalGaps":[{"gap":"","severity":"","recommendation":"","reference":"","moudarModule":""}],' + '"recommendations":[{"priority":1,"action":"","reference":"","moudarModule":""}],' + '"executiveSummary":""}\n\nTexte:\n' + text;
    this.callAPI(sys, prompt, function (raw) {
      try {
        var clean = raw.replace(/```json|```/g, '').trim();
        var parsed = JSON.parse(clean);
        parsed._source = 'deep_ai';
        parsed._model = 'claude-sonnet-4-20250514';
        parsed._timestamp = new Date().toISOString();
        onSuccess(parsed);
      } catch (e) {
        onSuccess({
          _source: 'deep_ai',
          _rawText: raw,
          _parseError: true,
          executiveSummary: raw.substring(0, 500),
          globalScore: 0,
          _timestamp: new Date().toISOString()
        });
      }
    }, onError);
  },
  generateSection: function (sectionType, context, lang, onSuccess, onError) {
    var sys = this.systemPrompts.sectionGen[lang] || this.systemPrompts.sectionGen.en;
    var prompt = (lang === 'fr' ? 'GÃ©nÃ¨re la section "' : 'Generate the "') + sectionType + (lang === 'fr' ? '" selon StaRI. Contexte:\n' : '" per StaRI. Context:\n') + context;
    this.callAPI(sys, prompt, onSuccess, onError);
  },
  compareProtocols: function (text1, text2, lang, onSuccess, onError) {
    var sys = this.systemPrompts.protocol[lang] || this.systemPrompts.protocol.en;
    var prompt = (lang === 'fr' ? 'Compare ces 2 protocoles IS. JSON: {"protocol1Score":0,"protocol2Score":0,"comparativeStrengths":{},"comparativeWeaknesses":{},"recommendation":"","synthesis":""}\n\nPROTOCOLE 1:\n' : 'Compare these 2 IS protocols. JSON: {"protocol1Score":0,"protocol2Score":0,"comparativeStrengths":{},"comparativeWeaknesses":{},"recommendation":"","synthesis":""}\n\nPROTOCOL 1:\n') + text1 + '\n\nPROTOCOL 2:\n' + text2;
    this.callAPI(sys, prompt, function (raw) {
      try {
        var p = JSON.parse(raw.replace(/```json|```/g, '').trim());
        p._source = 'compare';
        onSuccess(p);
      } catch (e) {
        onSuccess({
          _rawText: raw,
          _parseError: true
        });
      }
    }, onError);
  }
};
console.log('âœ… MOUDAR v11.0: DeepAIAnalyzer loaded â€” LLM-Powered Research Copilot (Anthropic API)');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE C1: IMPLEMENTATION SCIENCE ONTOLOGY ENGINE
// Formal knowledge graph connecting all IS frameworks, strategies & outcomes
// Creates an unreplicable structured knowledge base
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var ISOntologyEngine = {
  VERSION: '11.0.0',
  // Registered frameworks with metadata
  frameworks: {
    CFIR: {
      id: 'CFIR',
      fullName: 'Consolidated Framework for Implementation Research',
      version: '2.0',
      year: 2022,
      authors: 'Damschroder LJ et al.',
      doi: '10.1186/s13012-022-01245-0',
      type: 'determinant',
      domains: 5,
      constructs: 39,
      scope: 'multilevel'
    },
    REAIM: {
      id: 'REAIM',
      fullName: 'RE-AIM Framework',
      version: '2.0',
      year: 2019,
      authors: 'Glasgow RE et al.',
      doi: '10.1146/annurev-publhealth-040218-043905',
      type: 'evaluation',
      domains: 5,
      constructs: 5,
      scope: 'outcomes'
    },
    ERIC: {
      id: 'ERIC',
      fullName: 'Expert Recommendations for Implementing Change',
      version: '1.0',
      year: 2015,
      authors: 'Powell BJ et al.',
      doi: '10.1186/s13012-015-0209-1',
      type: 'strategies',
      domains: 9,
      constructs: 73,
      scope: 'strategies'
    },
    COMB: {
      id: 'COMB',
      fullName: 'Capability-Opportunity-Motivation-Behaviour',
      version: '1.0',
      year: 2011,
      authors: 'Michie S et al.',
      doi: '10.1186/1748-5908-6-42',
      type: 'behavioral',
      domains: 3,
      constructs: 6,
      scope: 'individual'
    },
    NPT: {
      id: 'NPT',
      fullName: 'Normalization Process Theory',
      version: '1.0',
      year: 2009,
      authors: 'May C & Finch T',
      doi: '10.1186/1748-5908-4-29',
      type: 'process',
      domains: 4,
      constructs: 16,
      scope: 'normalization'
    },
    PROCTOR: {
      id: 'PROCTOR',
      fullName: 'Implementation Outcomes Taxonomy',
      version: '1.0',
      year: 2011,
      authors: 'Proctor E et al.',
      doi: '10.1007/s10488-010-0319-7',
      type: 'outcomes',
      domains: 1,
      constructs: 8,
      scope: 'outcomes'
    },
    FRAME: {
      id: 'FRAME',
      fullName: 'Framework for Reporting Adaptations and Modifications',
      version: '1.0',
      year: 2019,
      authors: 'Stirman SW et al.',
      doi: '10.1186/s13012-019-0898-y',
      type: 'adaptation',
      domains: 6,
      constructs: 6,
      scope: 'fidelity'
    },
    EPIS: {
      id: 'EPIS',
      fullName: 'Exploration-Preparation-Implementation-Sustainment',
      version: '1.0',
      year: 2011,
      authors: 'Aarons GA et al.',
      doi: '10.1007/s10488-011-0355-4',
      type: 'process',
      domains: 4,
      constructs: 4,
      scope: 'phases'
    },
    TDF: {
      id: 'TDF',
      fullName: 'Theoretical Domains Framework',
      version: '2.0',
      year: 2012,
      authors: 'Cane J et al.',
      doi: '10.1186/1748-5908-7-37',
      type: 'behavioral',
      domains: 14,
      constructs: 84,
      scope: 'individual'
    },
    STARI: {
      id: 'STARI',
      fullName: 'Standards for Reporting Implementation Studies',
      version: '1.0',
      year: 2017,
      authors: 'Pinnock H et al.',
      doi: '10.1136/bmj.i6795',
      type: 'reporting',
      domains: 5,
      constructs: 27,
      scope: 'reporting'
    }
  },
  // Cross-framework relationships (ontological links)
  relationships: [{
    from: 'CFIR.IC4',
    to: 'FRAME',
    type: 'monitored_by',
    label: 'Adaptability is tracked via FRAME'
  }, {
    from: 'CFIR.IN2',
    to: 'COMB.Capability',
    type: 'maps_to',
    label: 'CFIR Capability maps to COM-B Capability'
  }, {
    from: 'CFIR.IN3',
    to: 'COMB.Opportunity',
    type: 'maps_to',
    label: 'CFIR Opportunity maps to COM-B Opportunity'
  }, {
    from: 'CFIR.IN4',
    to: 'COMB.Motivation',
    type: 'maps_to',
    label: 'CFIR Motivation maps to COM-B Motivation'
  }, {
    from: 'CFIR.IS11',
    to: 'ERIC.S04',
    type: 'addressed_by',
    label: 'Leadership engagement addressed by champions strategy'
  }, {
    from: 'CFIR.IS12',
    to: 'ERIC.S13',
    type: 'addressed_by',
    label: 'Available resources addressed by resource optimization'
  }, {
    from: 'CFIR.PR1',
    to: 'NPT.Coherence',
    type: 'complements',
    label: 'Assessing context complements NPT sense-making'
  }, {
    from: 'CFIR.PR5',
    to: 'NPT.ReflexiveMonitoring',
    type: 'complements',
    label: 'Reflecting complements NPT reflexive monitoring'
  }, {
    from: 'PROCTOR.Adoption',
    to: 'REAIM.Adoption',
    type: 'measures',
    label: 'Proctor adoption measured by RE-AIM adoption'
  }, {
    from: 'PROCTOR.Sustainability',
    to: 'REAIM.Maintenance',
    type: 'measures',
    label: 'Proctor sustainability measured by RE-AIM maintenance'
  }, {
    from: 'PROCTOR.Fidelity',
    to: 'FRAME',
    type: 'tracked_by',
    label: 'Fidelity tracked by FRAME adaptation documentation'
  }, {
    from: 'ERIC',
    to: 'CFIR',
    type: 'targets',
    label: 'ERIC strategies target CFIR constructs (Waltz 2019)'
  }, {
    from: 'EPIS.Exploration',
    to: 'CFIR.PR1',
    type: 'phase_includes',
    label: 'Exploration phase includes context assessment'
  }, {
    from: 'EPIS.Implementation',
    to: 'CFIR.PR4',
    type: 'phase_includes',
    label: 'Implementation phase includes executing'
  }, {
    from: 'EPIS.Sustainment',
    to: 'PROCTOR.Sustainability',
    type: 'phase_targets',
    label: 'Sustainment targets sustainability outcome'
  }, {
    from: 'TDF',
    to: 'COMB',
    type: 'operationalizes',
    label: 'TDF 14 domains operationalize COM-B components'
  }, {
    from: 'STARI',
    to: 'PROCTOR',
    type: 'reports_on',
    label: 'StaRI requires reporting implementation outcomes'
  }, {
    from: 'STARI',
    to: 'CFIR',
    type: 'reports_on',
    label: 'StaRI requires reporting framework use'
  }],
  // Causal mechanisms: how strategies produce outcomes
  causalMechanisms: [{
    strategy: 'Training',
    ericCode: 'S01',
    mechanism: 'Knowledge & skill acquisition â†’ behavioral capability â†’ adoption',
    cfirTargets: ['IN2', 'IS13'],
    proctorOutcome: 'Adoption',
    evidenceLevel: 'strong'
  }, {
    strategy: 'Audit & Feedback',
    ericCode: 'S02',
    mechanism: 'Performance awareness â†’ motivation â†’ fidelity improvement',
    cfirTargets: ['PR5', 'IS8'],
    proctorOutcome: 'Fidelity',
    evidenceLevel: 'strong'
  }, {
    strategy: 'Facilitation',
    ericCode: 'S03',
    mechanism: 'Barrier resolution â†’ process optimization â†’ penetration',
    cfirTargets: ['PR3', 'IS3'],
    proctorOutcome: 'Penetration',
    evidenceLevel: 'moderate'
  }, {
    strategy: 'Champions',
    ericCode: 'S04',
    mechanism: 'Social influence â†’ normative change â†’ organizational adoption',
    cfirTargets: ['IS11', 'IN4'],
    proctorOutcome: 'Adoption',
    evidenceLevel: 'strong'
  }, {
    strategy: 'Supervision',
    ericCode: 'S10',
    mechanism: 'Competence maintenance â†’ quality assurance â†’ fidelity',
    cfirTargets: ['IN2', 'PR4'],
    proctorOutcome: 'Fidelity',
    evidenceLevel: 'moderate'
  }, {
    strategy: 'Incentives',
    ericCode: 'S06',
    mechanism: 'Extrinsic motivation â†’ behavioral change â†’ initial adoption',
    cfirTargets: ['IN4', 'IS8'],
    proctorOutcome: 'Adoption',
    evidenceLevel: 'weak'
  }, {
    strategy: 'Coalition Building',
    ericCode: 'S08',
    mechanism: 'Stakeholder alignment â†’ resource pooling â†’ sustainability',
    cfirTargets: ['OS4', 'PR3'],
    proctorOutcome: 'Sustainability',
    evidenceLevel: 'moderate'
  }, {
    strategy: 'Adaptation',
    ericCode: 'S05',
    mechanism: 'Contextual fit â†’ acceptability â†’ sustained adoption',
    cfirTargets: ['IC4', 'IC7'],
    proctorOutcome: 'Appropriateness',
    evidenceLevel: 'strong'
  }],
  // Query the ontology
  query: function (params) {
    var self = this;
    var results = {
      frameworks: [],
      relationships: [],
      mechanisms: [],
      timestamp: new Date().toISOString()
    };
    if (params.framework) {
      results.frameworks = Object.values(self.frameworks).filter(function (f) {
        return f.id === params.framework || f.type === params.framework;
      });
    }
    if (params.construct) {
      results.relationships = self.relationships.filter(function (r) {
        return r.from.indexOf(params.construct) !== -1 || r.to.indexOf(params.construct) !== -1 || r.to === params.construct;
      });
      results.mechanisms = self.causalMechanisms.filter(function (m) {
        return m.cfirTargets.indexOf(params.construct) !== -1;
      });
    }
    if (params.strategy) {
      results.mechanisms = self.causalMechanisms.filter(function (m) {
        return m.ericCode === params.strategy || m.strategy.toLowerCase().indexOf((params.strategy || '').toLowerCase()) !== -1;
      });
    }
    if (params.outcome) {
      results.mechanisms = self.causalMechanisms.filter(function (m) {
        return m.proctorOutcome.toLowerCase() === (params.outcome || '').toLowerCase();
      });
      results.relationships = self.relationships.filter(function (r) {
        return r.from.indexOf(params.outcome) !== -1 || r.to.indexOf(params.outcome) !== -1;
      });
    }
    if (params.type) {
      results.frameworks = Object.values(self.frameworks).filter(function (f) {
        return f.type === params.type;
      });
    }
    return results;
  },
  // Get framework compatibility matrix
  getCompatibilityMatrix: function () {
    var fwIds = Object.keys(this.frameworks);
    var matrix = {};
    var self = this;
    fwIds.forEach(function (f1) {
      matrix[f1] = {};
      fwIds.forEach(function (f2) {
        if (f1 === f2) {
          matrix[f1][f2] = {
            compatible: true,
            type: 'same'
          };
          return;
        }
        var links = self.relationships.filter(function (r) {
          return r.from.indexOf(f1) !== -1 && r.to.indexOf(f2) !== -1 || r.from.indexOf(f2) !== -1 && r.to.indexOf(f1) !== -1 || r.from === f2 || r.to === f1;
        });
        matrix[f1][f2] = {
          compatible: links.length > 0,
          links: links.length,
          type: links.length > 2 ? 'strong' : links.length > 0 ? 'complementary' : 'independent'
        };
      });
    });
    return matrix;
  },
  // Export ontology as JSON-LD
  exportJSONLD: function () {
    return {
      '@context': {
        'is': 'https://moudar.org/ontology/',
        'schema': 'https://schema.org/'
      },
      '@type': 'is:ImplementationScienceOntology',
      'is:version': this.VERSION,
      'is:frameworks': Object.values(this.frameworks),
      'is:relationships': this.relationships,
      'is:causalMechanisms': this.causalMechanisms,
      'schema:dateCreated': new Date().toISOString(),
      'schema:creator': 'MOUDARÂ® v11.0 â€” Younes MOUDAR'
    };
  },
  // Get all paths from construct to outcome
  tracePath: function (constructId, outcomeId) {
    var self = this;
    var paths = [];
    self.causalMechanisms.forEach(function (m) {
      if (m.cfirTargets.indexOf(constructId) !== -1 && m.proctorOutcome.toLowerCase() === (outcomeId || '').toLowerCase()) {
        paths.push({
          construct: constructId,
          strategy: m.strategy,
          ericCode: m.ericCode,
          mechanism: m.mechanism,
          outcome: m.proctorOutcome,
          evidence: m.evidenceLevel
        });
      }
    });
    return paths;
  }
};
console.log('âœ… MOUDAR v11.0: ISOntologyEngine loaded â€” ' + Object.keys(ISOntologyEngine.frameworks).length + ' frameworks, ' + ISOntologyEngine.relationships.length + ' relationships, ' + ISOntologyEngine.causalMechanisms.length + ' causal mechanisms');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE C2: COLLABORATIVE EVIDENCE REPOSITORY
// Shared database of IS implementation cases with network effects
// More users â†’ better recommendations
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var EvidenceRepository = {
  VERSION: '11.0.0',
  // Case template
  caseTemplate: {
    id: '',
    title: '',
    country: '',
    region: '',
    setting: '',
    population: '',
    innovation: '',
    frameworks: [],
    strategies: [],
    cfirScores: {},
    reaimScores: {},
    proctorOutcomes: {},
    equityDimensions: [],
    barriersSummary: '',
    facilitatorsSummary: '',
    adaptations: [],
    nptScore: 0,
    designType: '',
    sampleSize: 0,
    duration: '',
    keyFindings: '',
    lessonsLearned: '',
    publicationDOI: '',
    status: 'draft',
    contributedBy: '',
    anonymized: true,
    createdAt: '',
    tags: []
  },
  // In-memory repository (in production: persistent storage API)
  cases: [],
  // Demo cases seeded from literature
  seedCases: [{
    id: 'CASE_001',
    title: 'mhGAP Integration in Morocco Primary Care',
    country: 'Morocco',
    region: 'Rabat-SalÃ©-KÃ©nitra',
    setting: 'Primary care centers',
    population: 'Healthcare workers (N=120), Patients (N=2400)',
    innovation: 'WHO mhGAP-IG v2.0 mental health integration',
    frameworks: ['CFIR', 'REAIM', 'PROCTOR'],
    strategies: ['S01', 'S04', 'S10', 'S03', 'S08'],
    cfirScores: {
      innovation: 78,
      outerSetting: 65,
      innerSetting: 72,
      individuals: 68,
      process: 74
    },
    reaimScores: {
      reach: 72,
      effectiveness: 68,
      adoption: 65,
      implementation: 70,
      maintenance: 55
    },
    proctorOutcomes: {
      acceptability: 78,
      adoption: 65,
      appropriateness: 72,
      feasibility: 68,
      fidelity: 70,
      cost: 60,
      penetration: 55,
      sustainability: 50
    },
    designType: 'Hybrid Type 2 stepped-wedge',
    sampleSize: 2520,
    duration: '24 months',
    keyFindings: 'Training + champions strategy achieved 65% adoption at 12 months',
    lessonsLearned: 'Sustainability requires institutional anchoring and ongoing supervision',
    tags: ['mental-health', 'primary-care', 'LMIC', 'mhGAP', 'task-shifting'],
    status: 'published',
    createdAt: '2025-01-15'
  }, {
    id: 'CASE_002',
    title: 'Evidence-Based Practice in Swiss Emergency Departments',
    country: 'Switzerland',
    region: 'Geneva',
    setting: 'Emergency departments',
    population: 'Emergency nurses and physicians (N=85)',
    innovation: 'Standardized triage protocol with decision support',
    frameworks: ['CFIR', 'NPT', 'PROCTOR'],
    strategies: ['S01', 'S02', 'S09', 'S10'],
    cfirScores: {
      innovation: 82,
      outerSetting: 75,
      innerSetting: 80,
      individuals: 77,
      process: 85
    },
    reaimScores: {
      reach: 90,
      effectiveness: 82,
      adoption: 78,
      implementation: 85,
      maintenance: 72
    },
    proctorOutcomes: {
      acceptability: 82,
      adoption: 78,
      appropriateness: 85,
      feasibility: 80,
      fidelity: 88,
      cost: 70,
      penetration: 75,
      sustainability: 68
    },
    designType: 'Pre-post with concurrent control',
    sampleSize: 85,
    duration: '18 months',
    keyFindings: 'Audit & feedback cycle improved fidelity from 45% to 88%',
    lessonsLearned: 'NPT coherence was the strongest predictor of sustained adoption',
    tags: ['emergency', 'triage', 'high-income', 'audit-feedback', 'decision-support'],
    status: 'published',
    createdAt: '2024-11-20'
  }, {
    id: 'CASE_003',
    title: 'Community Health Worker Digital Health in Rwanda',
    country: 'Rwanda',
    region: 'Eastern Province',
    setting: 'Community health posts',
    population: 'CHWs (N=340), Households (N=15000)',
    innovation: 'mHealth app for integrated community case management',
    frameworks: ['CFIR', 'REAIM', 'FRAME'],
    strategies: ['S01', 'S05', 'S04', 'S06', 'S08'],
    cfirScores: {
      innovation: 70,
      outerSetting: 68,
      innerSetting: 60,
      individuals: 72,
      process: 65
    },
    reaimScores: {
      reach: 85,
      effectiveness: 62,
      adoption: 70,
      implementation: 65,
      maintenance: 48
    },
    proctorOutcomes: {
      acceptability: 75,
      adoption: 70,
      appropriateness: 68,
      feasibility: 62,
      fidelity: 58,
      cost: 55,
      penetration: 80,
      sustainability: 45
    },
    designType: 'Cluster RCT',
    sampleSize: 15340,
    duration: '30 months',
    keyFindings: 'High reach but fidelity challenges due to network connectivity',
    lessonsLearned: 'FRAME tracking revealed 12 adaptations, 8 preserving core components',
    tags: ['digital-health', 'CHW', 'LMIC', 'mHealth', 'Africa', 'community'],
    status: 'published',
    createdAt: '2024-09-10'
  }, {
    id: 'CASE_004',
    title: 'Palliative Care Integration in Moroccan Oncology',
    country: 'Morocco',
    region: 'Casablanca-Settat',
    setting: 'Oncology departments',
    population: 'Oncologists, nurses, social workers (N=65)',
    innovation: 'Integrated palliative care pathway based on WHO guidelines',
    frameworks: ['CFIR', 'REAIM', 'NPT'],
    strategies: ['S01', 'S03', 'S04', 'S10', 'S13'],
    cfirScores: {
      innovation: 75,
      outerSetting: 58,
      innerSetting: 65,
      individuals: 70,
      process: 68
    },
    reaimScores: {
      reach: 55,
      effectiveness: 70,
      adoption: 50,
      implementation: 62,
      maintenance: 40
    },
    proctorOutcomes: {
      acceptability: 72,
      adoption: 50,
      appropriateness: 78,
      feasibility: 55,
      fidelity: 65,
      cost: 48,
      penetration: 42,
      sustainability: 38
    },
    designType: 'Mixed methods (quant + qual)',
    sampleSize: 65,
    duration: '12 months',
    keyFindings: 'Cultural barriers to palliative care discussions significantly impacted adoption',
    lessonsLearned: 'NPT Cognitive Participation was the main bottleneck â€” need early clinician buy-in',
    tags: ['palliative-care', 'oncology', 'LMIC', 'cultural-barriers', 'Morocco'],
    status: 'published',
    createdAt: '2025-02-01'
  }],
  // Initialize with seed cases
  init: function () {
    this.cases = this.seedCases.slice();
    return this;
  },
  // Add a new case
  addCase: function (caseData) {
    var newCase = Object.assign({}, this.caseTemplate, caseData, {
      id: 'CASE_' + Date.now(),
      createdAt: new Date().toISOString(),
      anonymized: true
    });
    this.cases.push(newCase);
    return newCase;
  },
  // Search cases by criteria
  search: function (criteria) {
    var results = this.cases.slice();
    if (criteria.country) results = results.filter(function (c) {
      return c.country.toLowerCase().indexOf(criteria.country.toLowerCase()) !== -1;
    });
    if (criteria.setting) results = results.filter(function (c) {
      return c.setting.toLowerCase().indexOf(criteria.setting.toLowerCase()) !== -1;
    });
    if (criteria.framework) results = results.filter(function (c) {
      return c.frameworks.indexOf(criteria.framework) !== -1;
    });
    if (criteria.strategy) results = results.filter(function (c) {
      return c.strategies.indexOf(criteria.strategy) !== -1;
    });
    if (criteria.tag) results = results.filter(function (c) {
      return c.tags.some(function (t) {
        return t.indexOf(criteria.tag) !== -1;
      });
    });
    if (criteria.designType) results = results.filter(function (c) {
      return c.designType.toLowerCase().indexOf(criteria.designType.toLowerCase()) !== -1;
    });
    return results;
  },
  // Get pattern-based recommendations (ML-lite)
  getRecommendations: function (userContext) {
    var self = this;
    var similar = this.cases.filter(function (c) {
      var score = 0;
      if (userContext.country && c.country.toLowerCase() === userContext.country.toLowerCase()) score += 3;
      if (userContext.setting && c.setting.toLowerCase().indexOf(userContext.setting.toLowerCase()) !== -1) score += 2;
      if (userContext.frameworks) {
        userContext.frameworks.forEach(function (f) {
          if (c.frameworks.indexOf(f) !== -1) score += 1;
        });
      }
      if (userContext.tags) {
        userContext.tags.forEach(function (t) {
          if (c.tags.indexOf(t) !== -1) score += 1;
        });
      }
      c._similarityScore = score;
      return score >= 2;
    });
    similar.sort(function (a, b) {
      return b._similarityScore - a._similarityScore;
    });

    // Extract patterns from similar cases
    var strategyFreq = {};
    var avgOutcomes = {
      acceptability: 0,
      adoption: 0,
      fidelity: 0,
      sustainability: 0
    };
    var count = similar.length || 1;
    similar.forEach(function (c) {
      c.strategies.forEach(function (s) {
        strategyFreq[s] = (strategyFreq[s] || 0) + 1;
      });
      Object.keys(avgOutcomes).forEach(function (o) {
        if (c.proctorOutcomes[o]) avgOutcomes[o] += c.proctorOutcomes[o] / count;
      });
    });
    var topStrategies = Object.keys(strategyFreq).sort(function (a, b) {
      return strategyFreq[b] - strategyFreq[a];
    }).slice(0, 5);
    return {
      similarCases: similar.slice(0, 5),
      recommendedStrategies: topStrategies,
      strategyFrequency: strategyFreq,
      averageOutcomes: avgOutcomes,
      confidence: similar.length >= 3 ? 'high' : similar.length >= 1 ? 'moderate' : 'low',
      basedOn: similar.length + ' similar cases',
      note: 'Recommendations improve as more cases are contributed to the repository'
    };
  },
  // Get repository stats
  getStats: function () {
    var countries = {};
    var frameworks = {};
    var strategies = {};
    this.cases.forEach(function (c) {
      countries[c.country] = (countries[c.country] || 0) + 1;
      c.frameworks.forEach(function (f) {
        frameworks[f] = (frameworks[f] || 0) + 1;
      });
      c.strategies.forEach(function (s) {
        strategies[s] = (strategies[s] || 0) + 1;
      });
    });
    return {
      totalCases: this.cases.length,
      countries: countries,
      countryCount: Object.keys(countries).length,
      frameworkUsage: frameworks,
      strategyUsage: strategies
    };
  }
};
EvidenceRepository.init();
console.log('âœ… MOUDAR v11.0: EvidenceRepository loaded â€” ' + EvidenceRepository.cases.length + ' seed cases from ' + EvidenceRepository.getStats().countryCount + ' countries');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE C3: API & SDK FOR ACADEMIC ECOSYSTEM
// REST API specification + R/Python/Stata package documentation
// Technical lock-in through workflow integration
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var MoudarSDK = {
  VERSION: '11.0.0',
  API_VERSION: 'v1',
  BASE_URL: 'https://api.moudar.org/v1',
  // API endpoint documentation
  endpoints: {
    // CFIR 2.0
    'POST /cfir/evaluate': {
      description: 'Evaluate a project against CFIR 2.0 (39 constructs)',
      params: ['project_data (JSON)', 'version: 1.0|2.0'],
      returns: 'CFIR evaluation with scores, gaps, ERIC recommendations',
      auth: 'API key'
    },
    'GET /cfir/constructs': {
      description: 'List all 39 CFIR 2.0 constructs with metadata',
      params: ['domain (optional)', 'lang: fr|en'],
      returns: 'Array of constructs',
      auth: 'none'
    },
    'GET /cfir/construct/{id}': {
      description: 'Get single construct details + ERIC mapping',
      params: ['id: IC1-PR5'],
      returns: 'Construct with ERIC recommendations (Waltz 2019)',
      auth: 'none'
    },
    // RE-AIM
    'POST /reaim/evaluate': {
      description: 'Evaluate against RE-AIM framework',
      params: ['project_data (JSON)'],
      returns: 'RE-AIM scores per dimension',
      auth: 'API key'
    },
    // Proctor Outcomes
    'POST /proctor/evaluate': {
      description: 'Evaluate 8 implementation outcomes (Proctor 2011)',
      params: ['outcome_scores (JSON)'],
      returns: 'Outcomes evaluation + instrument recommendations',
      auth: 'API key'
    },
    // NPT
    'POST /npt/evaluate': {
      description: 'Evaluate NPT normalization (May & Finch 2009)',
      params: ['npt_scores (JSON)'],
      returns: 'Normalization assessment (16 dimensions)',
      auth: 'API key'
    },
    // FRAME
    'POST /frame/adaptation': {
      description: 'Document an adaptation (Stirman 2019)',
      params: ['adaptation_data (JSON)'],
      returns: 'FRAME record + fidelity impact',
      auth: 'API key'
    },
    'GET /frame/adaptations/{project_id}': {
      description: 'List all adaptations for a project',
      params: [],
      returns: 'Timeline + fidelity score',
      auth: 'API key'
    },
    // SMART Design
    'POST /smart/design': {
      description: 'Create SMART adaptive design',
      params: ['config (JSON)'],
      returns: 'Design + decision rules + DTRs',
      auth: 'API key'
    },
    'POST /smart/simulate': {
      description: 'Monte Carlo simulation of SMART outcomes',
      params: ['design_id', 'n_simulations'],
      returns: 'DTR rankings + statistics',
      auth: 'API key'
    },
    // Protocol Analyzer
    'POST /analyze/protocol': {
      description: 'NLP + AI analysis of IS protocol',
      params: ['text (string)', 'mode: protocol|grant|manuscript|barriers', 'engine: nlp|deep|both'],
      returns: 'Multi-framework analysis + gaps + recommendations',
      auth: 'API key'
    },
    'POST /analyze/compare': {
      description: 'Compare two protocols',
      params: ['text1', 'text2'],
      returns: 'Comparative analysis',
      auth: 'API key'
    },
    'POST /generate/section': {
      description: 'Generate protocol section via AI',
      params: ['section_type', 'context'],
      returns: 'StaRI-compliant section text',
      auth: 'API key'
    },
    // Ontology
    'GET /ontology/frameworks': {
      description: 'List all registered IS frameworks',
      params: ['type (optional)'],
      returns: 'Framework metadata + DOIs',
      auth: 'none'
    },
    'GET /ontology/query': {
      description: 'Query the IS ontology',
      params: ['construct', 'strategy', 'outcome'],
      returns: 'Relationships + causal mechanisms',
      auth: 'none'
    },
    'GET /ontology/export': {
      description: 'Export ontology as JSON-LD',
      params: [],
      returns: 'JSON-LD formatted ontology',
      auth: 'none'
    },
    // Evidence Repository
    'GET /evidence/search': {
      description: 'Search implementation cases',
      params: ['country', 'setting', 'framework', 'strategy', 'tag'],
      returns: 'Matching cases',
      auth: 'API key'
    },
    'POST /evidence/case': {
      description: 'Contribute a new case',
      params: ['case_data (JSON)'],
      returns: 'Created case (anonymized)',
      auth: 'API key'
    },
    'GET /evidence/recommendations': {
      description: 'Get pattern-based recommendations',
      params: ['context (JSON)'],
      returns: 'Similar cases + recommended strategies',
      auth: 'API key'
    },
    'GET /evidence/stats': {
      description: 'Repository statistics',
      params: [],
      returns: 'Case counts, countries, framework usage',
      auth: 'none'
    },
    // Export
    'GET /export/r': {
      description: 'Export project data for R analysis',
      params: ['project_id', 'format: csv|rds'],
      returns: 'R-compatible data file',
      auth: 'API key'
    },
    'GET /export/python': {
      description: 'Export for Python/Jupyter',
      params: ['project_id', 'format: csv|json|parquet'],
      returns: 'Python-compatible data',
      auth: 'API key'
    },
    'GET /export/stata': {
      description: 'Export for Stata',
      params: ['project_id'],
      returns: '.dta file',
      auth: 'API key'
    },
    'GET /export/redcap': {
      description: 'Export REDCap data dictionary',
      params: ['project_id'],
      returns: 'REDCap-compatible CSV',
      auth: 'API key'
    },
    'GET /export/dhis2': {
      description: 'Export DHIS2 metadata package',
      params: ['project_id'],
      returns: 'DHIS2 JSON package',
      auth: 'API key'
    }
  },
  // SDK code samples for each language
  codeSamples: {
    r: {
      install: '# install.packages("moudar")\nlibrary(moudar)\nmoudar_auth("YOUR_API_KEY")',
      evaluate: '# Evaluate CFIR 2.0\nresult <- moudar_cfir_evaluate(project_data)\nprint(result$global_score)\nplot(result$domain_scores)',
      export: '# Export for analysis\ndf <- moudar_export(project_id, format = "rds")\nlibrary(ggplot2)\nggplot(df, aes(x = construct, y = score)) + geom_col()',
      evidence: '# Search evidence repository\ncases <- moudar_evidence_search(country = "Morocco", framework = "CFIR")\nrecs <- moudar_recommendations(my_context)'
    },
    python: {
      install: '# pip install moudar\nimport moudar\nclient = moudar.Client(api_key="YOUR_API_KEY")',
      evaluate: '# Evaluate CFIR 2.0\nresult = client.cfir.evaluate(project_data)\nprint(f"Global score: {result.global_score}%")\nresult.plot_domains()',
      export: '# Export for Jupyter\nimport pandas as pd\ndf = client.export(project_id, format="parquet")\ndf.describe()',
      evidence: '# Pattern-based recommendations\ncases = client.evidence.search(country="Morocco")\nrecs = client.evidence.recommendations(my_context)\nprint(recs.recommended_strategies)'
    },
    stata: {
      install: '* net install moudar, from("https://moudar.org/stata")',
      evaluate: '* Evaluate CFIR 2.0\nmoudar_cfir project_data.dta\nlist cfir_score domain_score',
      export: '* Export from MOUDAR\nmoudar_export project_id, format(dta)\ndescribe'
    },
    redcap: {
      description: 'REDCap Integration: MOUDAR generates REDCap-compatible data dictionaries for implementation outcome data collection. Fields map directly to Proctor outcomes (2011) and CFIR 2.0 constructs.',
      fields: ['record_id', 'cfir_ic1_score', 'cfir_ic2_score', '... (39 CFIR fields)', 'proctor_acceptability', 'proctor_adoption', '... (8 Proctor fields)', 'reaim_reach', '... (5 RE-AIM fields)']
    },
    dhis2: {
      description: 'DHIS2 Integration: Export MOUDAR implementation indicators as DHIS2 metadata packages for national health information systems. Compatible with WHO Digital Health Atlas.',
      dataElements: ['IS_adoption_rate', 'IS_fidelity_score', 'IS_penetration_rate', 'IS_sustainability_index']
    }
  },
  // Generate API documentation
  generateDocs: function (lang) {
    var t = function (fr, en) {
      return lang === 'fr' ? fr : en;
    };
    var docs = {
      title: 'MOUDARÂ® API & SDK v' + this.API_VERSION,
      baseUrl: this.BASE_URL,
      authentication: t('ClÃ© API dans le header: Authorization: Bearer YOUR_API_KEY', 'API key in header: Authorization: Bearer YOUR_API_KEY'),
      rateLimit: '1000 requests/hour',
      endpoints: this.endpoints,
      sdkLanguages: Object.keys(this.codeSamples),
      totalEndpoints: Object.keys(this.endpoints).length,
      citation: 'MOUDARÂ® v' + this.VERSION + ' â€” Younes MOUDAR (2025)'
    };
    return docs;
  },
  // Simulate API call (for demo)
  mockCall: function (endpoint, params) {
    var ep = this.endpoints[endpoint];
    if (!ep) return {
      error: 'Endpoint not found',
      available: Object.keys(this.endpoints)
    };
    return {
      endpoint: endpoint,
      description: ep.description,
      params: params || {},
      status: 200,
      mock: true,
      note: 'This is a simulated response. Deploy MOUDAR API server for production use.',
      timestamp: new Date().toISOString()
    };
  }
};
console.log('âœ… MOUDAR v11.0: MoudarSDK loaded â€” ' + Object.keys(MoudarSDK.endpoints).length + ' API endpoints, ' + Object.keys(MoudarSDK.codeSamples).length + ' SDK languages');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE D1: CFIR 2.0 USER GUIDE ENGINE
// Operationalizes Reardon et al. (2025) Implementation Science 20:39
// First tool in the world to digitalize the official CFIR User Guide
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var CFIRUserGuide = {
  VERSION: '11.0.0',
  citation: 'Reardon CM et al. (2025). Implementation Science, 20:39. doi:10.1186/s13012-025-01450-7',
  // The 5 official steps from the User Guide
  steps: {
    step1: {
      id: 'studyDesign',
      number: 1,
      label: {
        fr: 'Conception de l\'Ã©tude',
        en: 'Study Design'
      },
      description: {
        fr: 'SÃ©lectionner les construits CFIR pertinents, dÃ©finir le pÃ©rimÃ¨tre de l\'Ã©tude, choisir mÃ©thodes',
        en: 'Select relevant CFIR constructs, define study scope, choose methods'
      },
      tasks: [{
        id: 'T1.1',
        task: {
          fr: 'Identifier la question de recherche IS',
          en: 'Identify the IS research question'
        },
        guidance: {
          fr: 'La question doit spÃ©cifier quels dÃ©terminants (CFIR) influencent quels outcomes',
          en: 'Question should specify which determinants (CFIR) influence which outcomes'
        }
      }, {
        id: 'T1.2',
        task: {
          fr: 'SÃ©lectionner les construits CFIR pertinents',
          en: 'Select relevant CFIR constructs'
        },
        guidance: {
          fr: 'NE PAS utiliser les 39 construits â€” sÃ©lectionner ceux pertinents au contexte. Justifier les exclusions.',
          en: 'Do NOT use all 39 constructs â€” select those relevant to context. Justify exclusions.'
        }
      }, {
        id: 'T1.3',
        task: {
          fr: 'DÃ©finir l\'Inner Setting (unitÃ© d\'analyse)',
          en: 'Define the Inner Setting (unit of analysis)'
        },
        guidance: {
          fr: 'L\'Inner Setting peut Ãªtre un service, un hÃ´pital, une clinique, un programme',
          en: 'Inner Setting can be a department, hospital, clinic, program'
        }
      }, {
        id: 'T1.4',
        task: {
          fr: 'Choisir le design et les mÃ©thodes',
          en: 'Choose design and methods'
        },
        guidance: {
          fr: 'Qualitatif, quantitatif ou mixte â€” la plupart des Ã©tudes CFIR sont qualitatives',
          en: 'Qualitative, quantitative, or mixed â€” most CFIR studies are qualitative'
        }
      }, {
        id: 'T1.5',
        task: {
          fr: 'IntÃ©grer le CFIR Outcomes Addendum',
          en: 'Integrate the CFIR Outcomes Addendum'
        },
        guidance: {
          fr: 'Distinguer outcomes d\'implÃ©mentation vs outcomes d\'innovation (Proctor 2011)',
          en: 'Distinguish implementation outcomes vs innovation outcomes (Proctor 2011)'
        }
      }]
    },
    step2: {
      id: 'dataCollection',
      number: 2,
      label: {
        fr: 'Collecte de donnÃ©es',
        en: 'Data Collection'
      },
      description: {
        fr: 'DÃ©velopper instruments, guides d\'entretien, questionnaires basÃ©s sur les construits sÃ©lectionnÃ©s',
        en: 'Develop instruments, interview guides, questionnaires based on selected constructs'
      },
      tasks: [{
        id: 'T2.1',
        task: {
          fr: 'CrÃ©er le guide d\'entretien CFIR',
          en: 'Create CFIR interview guide'
        },
        guidance: {
          fr: 'Utiliser les questions exemples du User Guide (Additional File 1) comme point de dÃ©part',
          en: 'Use example questions from User Guide (Additional File 1) as starting point'
        }
      }, {
        id: 'T2.2',
        task: {
          fr: 'Adapter les questions au contexte',
          en: 'Adapt questions to context'
        },
        guidance: {
          fr: 'Les questions DOIVENT Ãªtre contextualisÃ©es â€” ne jamais utiliser les questions gÃ©nÃ©riques telles quelles',
          en: 'Questions MUST be contextualized â€” never use generic questions as-is'
        }
      }, {
        id: 'T2.3',
        task: {
          fr: 'Identifier les rÃ©pondants par construit',
          en: 'Identify respondents per construct'
        },
        guidance: {
          fr: 'Certains construits nÃ©cessitent des informants spÃ©cifiques (ex: Leadership â†’ dirigeants)',
          en: 'Some constructs require specific informants (e.g., Leadership â†’ directors)'
        }
      }]
    },
    step3: {
      id: 'dataAnalysis',
      number: 3,
      label: {
        fr: 'Analyse des donnÃ©es',
        en: 'Data Analysis'
      },
      description: {
        fr: 'Coder les donnÃ©es selon les construits CFIR, utiliser les coding guidelines',
        en: 'Code data according to CFIR constructs, use coding guidelines'
      },
      tasks: [{
        id: 'T3.1',
        task: {
          fr: 'Appliquer les Coding Guidelines CFIR',
          en: 'Apply CFIR Coding Guidelines'
        },
        guidance: {
          fr: 'Utiliser Additional File 2 du User Guide â€” dÃ©finitions opÃ©rationnelles par construit',
          en: 'Use Additional File 2 from User Guide â€” operational definitions per construct'
        }
      }, {
        id: 'T3.2',
        task: {
          fr: 'Coder de maniÃ¨re dÃ©ductive ET inductive',
          en: 'Code deductively AND inductively'
        },
        guidance: {
          fr: 'Commencer par les codes CFIR (dÃ©ductif), puis ajouter des codes Ã©mergents (inductif)',
          en: 'Start with CFIR codes (deductive), then add emergent codes (inductive)'
        }
      }, {
        id: 'T3.3',
        task: {
          fr: 'ComplÃ©ter le Inner Setting Memo Template',
          en: 'Complete Inner Setting Memo Template'
        },
        guidance: {
          fr: 'RÃ©sumer les donnÃ©es par Inner Setting (Additional File 3)',
          en: 'Summarize data per Inner Setting (Additional File 3)'
        }
      }, {
        id: 'T3.4',
        task: {
          fr: 'Assigner les ratings par construit',
          en: 'Assign ratings per construct'
        },
        guidance: {
          fr: 'Utiliser les Rating Guidelines (Additional File 4) : -2 Ã  +2 ou 1-5',
          en: 'Use Rating Guidelines (Additional File 4): -2 to +2 or 1-5'
        }
      }]
    },
    step4: {
      id: 'dataInterpretation',
      number: 4,
      label: {
        fr: 'InterprÃ©tation des donnÃ©es',
        en: 'Data Interpretation'
      },
      description: {
        fr: 'Construire la matrice Construit Ã— Inner Setting, identifier patterns',
        en: 'Build Construct Ã— Inner Setting matrix, identify patterns'
      },
      tasks: [{
        id: 'T4.1',
        task: {
          fr: 'Construire la matrice CFIR',
          en: 'Build the CFIR matrix'
        },
        guidance: {
          fr: 'Matrice Construct Ã— Inner Setting (Additional File 5) â€” ratings + rÃ©sumÃ©s par cellule',
          en: 'Construct Ã— Inner Setting matrix (Additional File 5) â€” ratings + summaries per cell'
        }
      }, {
        id: 'T4.2',
        task: {
          fr: 'Analyser les patterns cross-case',
          en: 'Analyze cross-case patterns'
        },
        guidance: {
          fr: 'Comparer les ratings entre Inner Settings pour identifier barriÃ¨res/facilitateurs systÃ©miques',
          en: 'Compare ratings across Inner Settings to identify systemic barriers/facilitators'
        }
      }, {
        id: 'T4.3',
        task: {
          fr: 'Distinguer construits faiblement vs fortement distinguants',
          en: 'Distinguish weakly vs strongly distinguishing constructs'
        },
        guidance: {
          fr: 'Les construits qui varient le plus entre sites performants et non-performants sont les plus informatifs',
          en: 'Constructs that vary most between high and low performing sites are most informative'
        }
      }]
    },
    step5: {
      id: 'knowledgeDissemination',
      number: 5,
      label: {
        fr: 'DissÃ©mination des connaissances',
        en: 'Knowledge Dissemination'
      },
      description: {
        fr: 'Rapporter les rÃ©sultats CFIR de maniÃ¨re transparente et reproductible',
        en: 'Report CFIR findings transparently and reproducibly'
      },
      tasks: [{
        id: 'T5.1',
        task: {
          fr: 'Utiliser le CFIR Implementation Research Worksheet',
          en: 'Use CFIR Implementation Research Worksheet'
        },
        guidance: {
          fr: 'Additional File 6 â€” checklist de reporting transparent',
          en: 'Additional File 6 â€” transparent reporting checklist'
        }
      }, {
        id: 'T5.2',
        task: {
          fr: 'Rapporter conformÃ©ment Ã  StaRI',
          en: 'Report in accordance with StaRI'
        },
        guidance: {
          fr: 'Pinnock et al. (2017) â€” 27 items de reporting',
          en: 'Pinnock et al. (2017) â€” 27 reporting items'
        }
      }, {
        id: 'T5.3',
        task: {
          fr: 'Publier les outils et donnÃ©es de codage',
          en: 'Publish coding tools and data'
        },
        guidance: {
          fr: 'Rendre les codebooks et matrices disponibles en matÃ©riel supplÃ©mentaire',
          en: 'Make codebooks and matrices available as supplementary material'
        }
      }]
    }
  },
  // 6 official templates from User Guide
  templates: {
    AF1: {
      id: 'AF1',
      label: {
        fr: 'Questions exemples par construit CFIR',
        en: 'CFIR Construct Example Questions'
      },
      type: 'interview',
      stariRef: 'ST07'
    },
    AF2: {
      id: 'AF2',
      label: {
        fr: 'Directives de codage CFIR',
        en: 'CFIR Construct Coding Guidelines'
      },
      type: 'analysis',
      stariRef: 'ST14'
    },
    AF3: {
      id: 'AF3',
      label: {
        fr: 'Template Memo Inner Setting',
        en: 'Inner Setting Memo Template'
      },
      type: 'analysis',
      stariRef: 'ST14'
    },
    AF4: {
      id: 'AF4',
      label: {
        fr: 'Directives de notation CFIR',
        en: 'CFIR Construct Rating Guidelines'
      },
      type: 'analysis',
      stariRef: 'ST14'
    },
    AF5: {
      id: 'AF5',
      label: {
        fr: 'Matrice Construit Ã— Inner Setting',
        en: 'CFIR Construct Ã— Inner Setting Matrix'
      },
      type: 'interpretation',
      stariRef: 'ST15'
    },
    AF6: {
      id: 'AF6',
      label: {
        fr: 'Worksheet de recherche CFIR',
        en: 'CFIR Implementation Research Worksheet'
      },
      type: 'reporting',
      stariRef: 'ST23'
    }
  },
  // CFIR Outcomes Addendum (Damschroder 2022)
  outcomesAddendum: {
    implementationOutcomes: ['Acceptability', 'Adoption', 'Appropriateness', 'Feasibility', 'Fidelity', 'Cost', 'Penetration', 'Sustainability'],
    innovationOutcomes: ['Reach', 'Effectiveness', 'Safety'],
    distinction: {
      fr: 'Les outcomes d\'implÃ©mentation (Proctor) â‰  outcomes d\'innovation (cliniques). Le CFIR Ã©value les dÃ©terminants qui influencent les outcomes d\'implÃ©mentation.',
      en: 'Implementation outcomes (Proctor) â‰  innovation outcomes (clinical). CFIR evaluates determinants that influence implementation outcomes.'
    }
  },
  // FAQ from User Guide
  faqs: [{
    q: {
      fr: 'Dois-je utiliser les 39 construits ?',
      en: 'Do I need to use all 39 constructs?'
    },
    a: {
      fr: 'NON. SÃ©lectionnez uniquement les construits pertinents Ã  votre contexte. Justifiez les exclusions.',
      en: 'NO. Select only constructs relevant to your context. Justify exclusions.'
    }
  }, {
    q: {
      fr: 'Le CFIR est-il une thÃ©orie ?',
      en: 'Is CFIR a theory?'
    },
    a: {
      fr: 'Non. Le CFIR est un cadre de dÃ©terminants (determinant framework), pas une thÃ©orie. Il identifie des facteurs mais ne spÃ©cifie pas les mÃ©canismes causaux.',
      en: 'No. CFIR is a determinant framework, not a theory. It identifies factors but does not specify causal mechanisms.'
    }
  }, {
    q: {
      fr: 'Puis-je combiner CFIR avec d\'autres cadres ?',
      en: 'Can I combine CFIR with other frameworks?'
    },
    a: {
      fr: 'OUI, c\'est recommandÃ©. CFIR pour les dÃ©terminants + ERIC pour les stratÃ©gies + Proctor pour les outcomes + RE-AIM pour l\'Ã©valuation.',
      en: 'YES, it is recommended. CFIR for determinants + ERIC for strategies + Proctor for outcomes + RE-AIM for evaluation.'
    }
  }, {
    q: {
      fr: 'Comment citer le CFIR ?',
      en: 'How to cite CFIR?'
    },
    a: {
      fr: 'Citer Damschroder 2009 (original) ET Damschroder 2022 (mise Ã  jour) ET Reardon 2025 (User Guide)',
      en: 'Cite Damschroder 2009 (original) AND Damschroder 2022 (update) AND Reardon 2025 (User Guide)'
    }
  }],
  // Assess study progress through 5 steps
  assessProgress: function (projectData) {
    var self = this;
    var progress = {};
    Object.keys(self.steps).forEach(function (stepKey) {
      var step = self.steps[stepKey];
      var completed = 0;
      step.tasks.forEach(function (task) {
        if (projectData[task.id]) completed++;
      });
      progress[stepKey] = {
        total: step.tasks.length,
        completed: completed,
        percent: Math.round(completed / step.tasks.length * 100)
      };
    });
    var totalTasks = 0;
    var totalCompleted = 0;
    Object.values(progress).forEach(function (p) {
      totalTasks += p.total;
      totalCompleted += p.completed;
    });
    progress.overall = {
      total: totalTasks,
      completed: totalCompleted,
      percent: Math.round(totalCompleted / totalTasks * 100)
    };
    return progress;
  }
};
console.log('âœ… MOUDAR v11.0: CFIRUserGuide loaded â€” 5 steps, 18 tasks, 6 templates (Reardon 2025)');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE D2: PRISM-RE-AIM EVALUATOR
// Practical, Robust Implementation and Sustainability Model
// Glasgow RE et al. (2019) + Trinkley KE et al. (2023) iPRISM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var PRISMEvaluator = {
  VERSION: '11.0.0',
  citation: 'Glasgow RE et al. (2019). Ann Rev Public Health, 40:191-207',
  iPRISMcitation: 'Trinkley KE et al. (2023). Implementation Science Communications, 4:116',
  // PRISM contextual domains
  domains: {
    interventionCharacteristics: {
      id: 'intervention',
      label: {
        fr: 'CaractÃ©ristiques de l\'intervention',
        en: 'Intervention Characteristics'
      },
      color: '#3b82f6',
      items: [{
        id: 'P_IC1',
        name: {
          fr: 'Preuves de base',
          en: 'Evidence base'
        },
        weight: 1.0
      }, {
        id: 'P_IC2',
        name: {
          fr: 'Avantage relatif perÃ§u',
          en: 'Perceived relative advantage'
        },
        weight: 0.9
      }, {
        id: 'P_IC3',
        name: {
          fr: 'ObservabilitÃ© des rÃ©sultats',
          en: 'Observability of results'
        },
        weight: 0.8
      }, {
        id: 'P_IC4',
        name: {
          fr: 'AdaptabilitÃ©/rÃ©invention',
          en: 'Adaptability/reinvention'
        },
        weight: 0.95
      }, {
        id: 'P_IC5',
        name: {
          fr: 'ComplexitÃ©/coÃ»t',
          en: 'Complexity/cost'
        },
        weight: 0.85
      }, {
        id: 'P_IC6',
        name: {
          fr: 'CompatibilitÃ© avec le workflow',
          en: 'Compatibility with workflow'
        },
        weight: 0.9
      }]
    },
    externalEnvironment: {
      id: 'external',
      label: {
        fr: 'Environnement externe',
        en: 'External Environment'
      },
      color: '#059669',
      items: [{
        id: 'P_EE1',
        name: {
          fr: 'Politiques et rÃ©gulations',
          en: 'Policies and regulations'
        },
        weight: 0.9
      }, {
        id: 'P_EE2',
        name: {
          fr: 'Incitations/mandats',
          en: 'Incentives/mandates'
        },
        weight: 0.8
      }, {
        id: 'P_EE3',
        name: {
          fr: 'Environnement concurrentiel',
          en: 'Competitive environment'
        },
        weight: 0.7
      }, {
        id: 'P_EE4',
        name: {
          fr: 'Besoins des patients',
          en: 'Patient/client needs'
        },
        weight: 1.0
      }]
    },
    organizationalCharacteristics: {
      id: 'organization',
      label: {
        fr: 'CaractÃ©ristiques organisationnelles',
        en: 'Organizational Characteristics'
      },
      color: '#7c3aed',
      items: [{
        id: 'P_OC1',
        name: {
          fr: 'Culture organisationnelle',
          en: 'Organizational culture'
        },
        weight: 0.95
      }, {
        id: 'P_OC2',
        name: {
          fr: 'Leadership et soutien',
          en: 'Leadership and support'
        },
        weight: 1.0
      }, {
        id: 'P_OC3',
        name: {
          fr: 'Ressources disponibles',
          en: 'Available resources'
        },
        weight: 0.9
      }, {
        id: 'P_OC4',
        name: {
          fr: 'Climat d\'apprentissage',
          en: 'Learning climate'
        },
        weight: 0.85
      }, {
        id: 'P_OC5',
        name: {
          fr: 'RÃ©seaux et communication',
          en: 'Networks and communication'
        },
        weight: 0.8
      }]
    },
    recipientCharacteristics: {
      id: 'recipients',
      label: {
        fr: 'CaractÃ©ristiques des bÃ©nÃ©ficiaires',
        en: 'Recipient Characteristics'
      },
      color: '#dc2626',
      items: [{
        id: 'P_RC1',
        name: {
          fr: 'Motivation au changement',
          en: 'Motivation for change'
        },
        weight: 1.0
      }, {
        id: 'P_RC2',
        name: {
          fr: 'CompÃ©tences et auto-efficacitÃ©',
          en: 'Skills and self-efficacy'
        },
        weight: 0.9
      }, {
        id: 'P_RC3',
        name: {
          fr: 'BarriÃ¨res perÃ§ues',
          en: 'Perceived barriers'
        },
        weight: 0.85
      }, {
        id: 'P_RC4',
        name: {
          fr: 'CaractÃ©ristiques dÃ©mographiques',
          en: 'Demographic characteristics'
        },
        weight: 0.7
      }]
    },
    implementationInfrastructure: {
      id: 'infrastructure',
      label: {
        fr: 'Infrastructure d\'implÃ©mentation',
        en: 'Implementation Infrastructure'
      },
      color: '#d97706',
      items: [{
        id: 'P_II1',
        name: {
          fr: 'Ã‰quipe d\'implÃ©mentation dÃ©diÃ©e',
          en: 'Dedicated implementation team'
        },
        weight: 1.0
      }, {
        id: 'P_II2',
        name: {
          fr: 'Plan de formation continu',
          en: 'Ongoing training plan'
        },
        weight: 0.9
      }, {
        id: 'P_II3',
        name: {
          fr: 'SystÃ¨mes de feedback',
          en: 'Feedback systems'
        },
        weight: 0.85
      }, {
        id: 'P_II4',
        name: {
          fr: 'Plan de pÃ©rennisation',
          en: 'Sustainability plan'
        },
        weight: 0.95
      }]
    }
  },
  // RE-AIM outcomes integrated with PRISM
  reaimOutcomes: {
    reach: {
      id: 'reach',
      label: {
        fr: 'PortÃ©e (Reach)',
        en: 'Reach'
      },
      color: '#3b82f6',
      questions: [{
        fr: 'Quel % de la population cible est atteint ?',
        en: 'What % of target population is reached?'
      }, {
        fr: 'La portÃ©e est-elle reprÃ©sentative (Ã©quitÃ©) ?',
        en: 'Is reach representative (equity)?'
      }]
    },
    effectiveness: {
      id: 'effectiveness',
      label: {
        fr: 'EfficacitÃ© (Effectiveness)',
        en: 'Effectiveness'
      },
      color: '#10b981',
      questions: [{
        fr: 'Quels sont les rÃ©sultats cliniques/comportementaux ?',
        en: 'What are clinical/behavioral outcomes?'
      }, {
        fr: 'Y a-t-il des effets nÃ©gatifs ou inattendus ?',
        en: 'Are there negative or unintended effects?'
      }]
    },
    adoption: {
      id: 'adoption',
      label: {
        fr: 'Adoption',
        en: 'Adoption'
      },
      color: '#8b5cf6',
      questions: [{
        fr: 'Quel % des sites/cliniciens a adoptÃ© ?',
        en: 'What % of sites/clinicians adopted?'
      }, {
        fr: 'L\'adoption est-elle reprÃ©sentative ?',
        en: 'Is adoption representative?'
      }]
    },
    implementation: {
      id: 'implementation',
      label: {
        fr: 'ImplÃ©mentation',
        en: 'Implementation'
      },
      color: '#f59e0b',
      questions: [{
        fr: 'L\'intervention est-elle fidÃ¨lement dÃ©livrÃ©e ?',
        en: 'Is intervention delivered with fidelity?'
      }, {
        fr: 'Quelles adaptations ont Ã©tÃ© nÃ©cessaires ?',
        en: 'What adaptations were needed?'
      }]
    },
    maintenance: {
      id: 'maintenance',
      label: {
        fr: 'Maintenance/PÃ©rennisation',
        en: 'Maintenance'
      },
      color: '#ef4444',
      questions: [{
        fr: 'Les rÃ©sultats sont-ils maintenus Ã  6+ mois ?',
        en: 'Are results maintained at 6+ months?'
      }, {
        fr: 'Le programme est-il institutionnalisÃ© ?',
        en: 'Is the program institutionalized?'
      }]
    }
  },
  // Evaluate PRISM context + RE-AIM outcomes
  evaluate: function (contextScores, reaimScores, lang) {
    var self = this;
    var t = function (fr, en) {
      return lang === 'fr' ? fr : en;
    };
    var contextResult = {
      domains: {},
      globalScore: 0
    };
    var totalWeight = 0;
    var weightedSum = 0;
    Object.keys(self.domains).forEach(function (domKey) {
      var dom = self.domains[domKey];
      var domScore = 0;
      var domWeight = 0;
      dom.items.forEach(function (item) {
        var score = contextScores[item.id] || 0;
        domScore += score * item.weight;
        domWeight += item.weight * 100;
      });
      var pct = domWeight > 0 ? Math.round(domScore / domWeight * 100) : 0;
      contextResult.domains[domKey] = {
        label: dom.label,
        score: pct,
        color: dom.color,
        itemCount: dom.items.length
      };
      totalWeight += domWeight;
      weightedSum += domScore;
    });
    contextResult.globalScore = totalWeight > 0 ? Math.round(weightedSum / totalWeight * 100) : 0;
    var reaimResult = {};
    var reaimTotal = 0;
    var reaimCount = 0;
    Object.keys(self.reaimOutcomes).forEach(function (dim) {
      reaimResult[dim] = reaimScores[dim] || 0;
      reaimTotal += reaimResult[dim];
      reaimCount++;
    });
    reaimResult.average = reaimCount > 0 ? Math.round(reaimTotal / reaimCount) : 0;
    return {
      context: contextResult,
      reaim: reaimResult,
      phase: self.determinePhase(contextResult.globalScore, reaimResult.average),
      citation: self.citation
    };
  },
  determinePhase: function (contextScore, reaimScore) {
    if (contextScore < 40) return {
      phase: 'planning',
      label: {
        fr: 'Planification',
        en: 'Planning'
      },
      icon: 'ðŸ“‹'
    };
    if (contextScore < 70 && reaimScore < 50) return {
      phase: 'implementation',
      label: {
        fr: 'ImplÃ©mentation',
        en: 'Implementation'
      },
      icon: 'ðŸš€'
    };
    return {
      phase: 'sustainment',
      label: {
        fr: 'PÃ©rennisation',
        en: 'Sustainment'
      },
      icon: 'ðŸ—ï¸'
    };
  }
};
console.log('âœ… MOUDAR v11.0: PRISMEvaluator loaded â€” 5 contextual domains, 25 items, RE-AIM integrated (Glasgow 2019)');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE D3: IMPLEMENTATION RESEARCH LOGIC MODEL (IRLM) GENERATOR
// Smith JD et al. (2020) Implementation Science 15:84
// First automated IRLM generator in the world
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var IRLMGenerator = {
  VERSION: '11.0.0',
  citation: 'Smith JD, Li DH, Rafferty MR. (2020). Implementation Science, 15:84. doi:10.1186/s13012-020-01041-8',
  // IRLM components
  components: {
    determinants: {
      id: 'determinants',
      label: {
        fr: 'DÃ©terminants',
        en: 'Determinants'
      },
      color: '#7c3aed',
      description: {
        fr: 'Facteurs contextuels qui influencent l\'implÃ©mentation (cadres: CFIR, TDF, COM-B)',
        en: 'Contextual factors influencing implementation (frameworks: CFIR, TDF, COM-B)'
      }
    },
    strategies: {
      id: 'strategies',
      label: {
        fr: 'StratÃ©gies d\'implÃ©mentation',
        en: 'Implementation Strategies'
      },
      color: '#2563eb',
      description: {
        fr: 'Actions prises pour adopter/mettre en Å“uvre l\'intervention (ERIC)',
        en: 'Actions taken to adopt/deliver the intervention (ERIC)'
      }
    },
    mechanisms: {
      id: 'mechanisms',
      label: {
        fr: 'MÃ©canismes',
        en: 'Mechanisms'
      },
      color: '#059669',
      description: {
        fr: 'Processus causaux par lesquels les stratÃ©gies produisent des changements',
        en: 'Causal processes through which strategies produce change'
      }
    },
    implementationOutcomes: {
      id: 'implOutcomes',
      label: {
        fr: 'Outcomes d\'implÃ©mentation',
        en: 'Implementation Outcomes'
      },
      color: '#d97706',
      description: {
        fr: 'Proctor 2011: acceptabilitÃ©, adoption, faisabilitÃ©, fidÃ©litÃ©, coÃ»t, pÃ©nÃ©tration, pÃ©rennisation',
        en: 'Proctor 2011: acceptability, adoption, feasibility, fidelity, cost, penetration, sustainability'
      }
    },
    clinicalOutcomes: {
      id: 'clinOutcomes',
      label: {
        fr: 'Outcomes cliniques/service',
        en: 'Clinical/Service Outcomes'
      },
      color: '#dc2626',
      description: {
        fr: 'RÃ©sultats pour les patients et le systÃ¨me de santÃ©',
        en: 'Results for patients and health system'
      }
    }
  },
  // Generate IRLM from project data
  generate: function (projectData, lang) {
    var t = function (fr, en) {
      return lang === 'fr' ? fr : en;
    };
    var irlm = {
      title: projectData.title || t('ModÃ¨le Logique IS', 'IS Logic Model'),
      determinants: {
        barriers: (projectData.barriers || []).map(function (b) {
          return {
            text: b.text || b,
            cfirConstruct: b.cfirConstruct || '',
            severity: b.severity || 'medium'
          };
        }),
        facilitators: (projectData.facilitators || []).map(function (f) {
          return {
            text: f.text || f,
            cfirConstruct: f.cfirConstruct || ''
          };
        })
      },
      strategies: (projectData.strategies || []).map(function (s) {
        return {
          name: s.name || s,
          ericCode: s.ericCode || '',
          targetDeterminants: s.targets || [],
          justification: s.justification || ''
        };
      }),
      mechanisms: (projectData.strategies || []).map(function (s) {
        var mechs = ISOntologyEngine.causalMechanisms.filter(function (m) {
          return m.ericCode === s.ericCode;
        });
        return {
          strategy: s.name || s,
          mechanism: mechs.length > 0 ? mechs[0].mechanism : t('Ã€ dÃ©finir', 'To be defined'),
          evidence: mechs.length > 0 ? mechs[0].evidenceLevel : 'unknown'
        };
      }),
      implementationOutcomes: (projectData.implOutcomes || ['Adoption', 'Fidelity', 'Acceptability', 'Feasibility']).map(function (o) {
        return {
          outcome: o,
          measure: '',
          timeline: ''
        };
      }),
      clinicalOutcomes: (projectData.clinOutcomes || []).map(function (o) {
        return {
          outcome: o,
          measure: '',
          timeline: ''
        };
      }),
      causalChain: t('DÃ©terminants (CFIR) â†’ StratÃ©gies (ERIC) â†’ MÃ©canismes â†’ Outcomes implÃ©mentation (Proctor) â†’ Outcomes cliniques', 'Determinants (CFIR) â†’ Strategies (ERIC) â†’ Mechanisms â†’ Implementation Outcomes (Proctor) â†’ Clinical Outcomes'),
      generatedAt: new Date().toISOString(),
      citation: this.citation
    };
    return irlm;
  },
  // Generate visual ASCII representation
  // Generate Mermaid.js diagram code for professional rendering
  generateMermaid: function (irlm, lang) {
    var t = function (fr, en) {
      return lang === 'fr' ? fr : en;
    };
    var safe = function (s) {
      return (s || '').replace(/"/g, "'").replace(/[[\]()]/g, '').substring(0, 45);
    };
    var lines = ['graph LR'];
    lines.push('  classDef det fill:#ede9fe,stroke:#7c3aed,stroke-width:2px,color:#5b21b6');
    lines.push('  classDef barr fill:#fee2e2,stroke:#dc2626,stroke-width:2px,color:#991b1b');
    lines.push('  classDef fac fill:#dcfce7,stroke:#16a34a,stroke-width:2px,color:#166534');
    lines.push('  classDef strat fill:#dbeafe,stroke:#2563eb,stroke-width:2px,color:#1e40af');
    lines.push('  classDef mech fill:#d1fae5,stroke:#059669,stroke-width:2px,color:#065f46');
    lines.push('  classDef impl fill:#fef3c7,stroke:#d97706,stroke-width:2px,color:#92400e');
    lines.push('  classDef clin fill:#ffe4e6,stroke:#e11d48,stroke-width:2px,color:#9f1239');
    // Subgraph: Determinants
    lines.push('  subgraph DET["' + t('DETERMINANTS CFIR', 'CFIR DETERMINANTS') + '"]');
    (irlm.determinants.barriers || []).forEach(function (b, i) {
      lines.push('    B' + i + '["' + safe(b.text || b) + '"]:::barr');
    });
    (irlm.determinants.facilitators || []).forEach(function (f, i) {
      lines.push('    F' + i + '["' + safe(f.text || f) + '"]:::fac');
    });
    lines.push('  end');
    // Subgraph: Strategies
    lines.push('  subgraph STR["' + t('STRATEGIES ERIC', 'ERIC STRATEGIES') + '"]');
    (irlm.strategies || []).forEach(function (s, i) {
      lines.push('    S' + i + '["' + safe(s.name || s) + '"]:::strat');
    });
    lines.push('  end');
    // Subgraph: Mechanisms
    lines.push('  subgraph MCH["' + t('MECANISMES', 'MECHANISMS') + '"]');
    (irlm.mechanisms || []).forEach(function (m, i) {
      lines.push('    M' + i + '["' + safe(m.mechanism || m.strategy || '') + '"]:::mech');
    });
    lines.push('  end');
    // Subgraph: Implementation Outcomes
    lines.push('  subgraph IMP["' + t('OUTCOMES Proctor', 'Proctor OUTCOMES') + '"]');
    (irlm.implementationOutcomes || []).forEach(function (o, i) {
      lines.push('    IO' + i + '["' + safe(o.outcome || o) + '"]:::impl');
    });
    lines.push('  end');
    // Subgraph: Clinical Outcomes
    lines.push('  subgraph CLN["' + t('OUTCOMES CLINIQUES', 'CLINICAL OUTCOMES') + '"]');
    (irlm.clinicalOutcomes || []).forEach(function (o, i) {
      lines.push('    CO' + i + '["' + safe(o.outcome || o) + '"]:::clin');
    });
    lines.push('  end');
    // Arrows
    var nB = (irlm.determinants.barriers || []).length;
    var nF = (irlm.determinants.facilitators || []).length;
    var nS = (irlm.strategies || []).length;
    var nM = (irlm.mechanisms || []).length;
    var nIO = (irlm.implementationOutcomes || []).length;
    var nCO = (irlm.clinicalOutcomes || []).length;
    for (var bi = 0; bi < nB; bi++) {
      for (var si = 0; si < Math.min(nS, 2); si++) {
        lines.push('  B' + bi + ' -->|' + t('cible', 'target') + '| S' + si);
      }
    }
    for (var fi = 0; fi < nF; fi++) {
      for (var sj = 0; sj < Math.min(nS, 2); sj++) {
        lines.push('  F' + fi + ' -->|' + t('facilite', 'enables') + '| S' + sj);
      }
    }
    for (var sk = 0; sk < nS; sk++) {
      var mk = sk < nM ? sk : nM - 1;
      if (mk >= 0) lines.push('  S' + sk + ' --> M' + mk);
    }
    for (var mi = 0; mi < nM; mi++) {
      for (var io = 0; io < Math.min(nIO, 3); io++) {
        lines.push('  M' + mi + ' --> IO' + io);
      }
    }
    for (var ii = 0; ii < nIO; ii++) {
      for (var ci = 0; ci < nCO; ci++) {
        lines.push('  IO' + ii + ' --> CO' + ci);
      }
    }
    return lines.join('\n');
  },
  generateVisual: function (irlm, lang) {
    return {
      mermaid: this.generateMermaid(irlm, lang),
      components: irlm
    };
  }
};
console.log('âœ… MOUDAR v11.0: IRLMGenerator loaded â€” Automated Logic Model (Smith 2020) â€” WORLD FIRST');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE D4: COM-B / TDF BEHAVIORAL DIAGNOSIS
// Michie S et al. (2011) Implementation Science 6:42
// Cane J et al. (2012) Implementation Science 7:37
// Bridge between IS and Behaviour Change Science
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var COMBDiagnostic = {
  VERSION: '11.0.0',
  citation: 'Michie S, van Stralen MM, West R. (2011). Implementation Science, 6:42',
  tdfCitation: 'Cane J, O\'Connor D, Michie S. (2012). Implementation Science, 7:37',
  // COM-B model
  comB: {
    capability: {
      id: 'capability',
      label: {
        fr: 'CapacitÃ©',
        en: 'Capability'
      },
      color: '#3b82f6',
      subComponents: {
        physical: {
          id: 'cap_physical',
          label: {
            fr: 'Physique',
            en: 'Physical'
          },
          description: {
            fr: 'CompÃ©tences, force, endurance nÃ©cessaires',
            en: 'Skills, strength, stamina needed'
          }
        },
        psychological: {
          id: 'cap_psychological',
          label: {
            fr: 'Psychologique',
            en: 'Psychological'
          },
          description: {
            fr: 'Connaissances, mÃ©moire, processus dÃ©cisionnels',
            en: 'Knowledge, memory, decision processes'
          }
        }
      }
    },
    opportunity: {
      id: 'opportunity',
      label: {
        fr: 'OpportunitÃ©',
        en: 'Opportunity'
      },
      color: '#059669',
      subComponents: {
        physical: {
          id: 'opp_physical',
          label: {
            fr: 'Physique',
            en: 'Physical'
          },
          description: {
            fr: 'Temps, ressources, accÃ¨s, environnement',
            en: 'Time, resources, access, environment'
          }
        },
        social: {
          id: 'opp_social',
          label: {
            fr: 'Sociale',
            en: 'Social'
          },
          description: {
            fr: 'Normes sociales, influences interpersonnelles',
            en: 'Social norms, interpersonal influences'
          }
        }
      }
    },
    motivation: {
      id: 'motivation',
      label: {
        fr: 'Motivation',
        en: 'Motivation'
      },
      color: '#d97706',
      subComponents: {
        reflective: {
          id: 'mot_reflective',
          label: {
            fr: 'RÃ©flective',
            en: 'Reflective'
          },
          description: {
            fr: 'Plans, Ã©valuations, intentions conscientes',
            en: 'Plans, evaluations, conscious intentions'
          }
        },
        automatic: {
          id: 'mot_automatic',
          label: {
            fr: 'Automatique',
            en: 'Automatic'
          },
          description: {
            fr: 'Ã‰motions, habitudes, dÃ©sirs, pulsions',
            en: 'Emotions, habits, desires, impulses'
          }
        }
      }
    }
  },
  // TDF 14 domains mapped to COM-B
  tdfDomains: [{
    id: 'TDF01',
    name: {
      fr: 'Connaissances',
      en: 'Knowledge'
    },
    comB: 'cap_psychological',
    description: {
      fr: 'Conscience de l\'existence de quelque chose',
      en: 'Awareness of the existence of something'
    }
  }, {
    id: 'TDF02',
    name: {
      fr: 'CompÃ©tences',
      en: 'Skills'
    },
    comB: 'cap_physical',
    description: {
      fr: 'CapacitÃ© ou maÃ®trise acquise par la pratique',
      en: 'Ability or proficiency acquired through practice'
    }
  }, {
    id: 'TDF03',
    name: {
      fr: 'RÃ´le social/professionnel et identitÃ©',
      en: 'Social/Professional Role and Identity'
    },
    comB: 'mot_reflective',
    description: {
      fr: 'Ensemble de comportements attendus d\'un individu dans sa position',
      en: 'Set of behaviors expected of an individual in their position'
    }
  }, {
    id: 'TDF04',
    name: {
      fr: 'Croyances sur les capacitÃ©s',
      en: 'Beliefs about Capabilities'
    },
    comB: 'mot_reflective',
    description: {
      fr: 'Acceptation de la vÃ©ritÃ©/rÃ©alitÃ© de sa capacitÃ©/talent',
      en: 'Acceptance of truth/reality about ability/talent'
    }
  }, {
    id: 'TDF05',
    name: {
      fr: 'Optimisme',
      en: 'Optimism'
    },
    comB: 'mot_reflective',
    description: {
      fr: 'Confiance que les choses iront bien',
      en: 'Confidence that things will happen for the best'
    }
  }, {
    id: 'TDF06',
    name: {
      fr: 'Croyances sur les consÃ©quences',
      en: 'Beliefs about Consequences'
    },
    comB: 'mot_reflective',
    description: {
      fr: 'Acceptation de la vÃ©ritÃ©/rÃ©alitÃ© des rÃ©sultats d\'un comportement',
      en: 'Acceptance of truth/reality about outcomes of behavior'
    }
  }, {
    id: 'TDF07',
    name: {
      fr: 'Renforcement',
      en: 'Reinforcement'
    },
    comB: 'mot_automatic',
    description: {
      fr: 'Augmenter la probabilitÃ© d\'une rÃ©ponse par un stimulus',
      en: 'Increasing probability of a response through a stimulus'
    }
  }, {
    id: 'TDF08',
    name: {
      fr: 'Intentions',
      en: 'Intentions'
    },
    comB: 'mot_reflective',
    description: {
      fr: 'DÃ©cision consciente d\'adopter un comportement',
      en: 'Conscious decision to adopt a behavior'
    }
  }, {
    id: 'TDF09',
    name: {
      fr: 'Objectifs',
      en: 'Goals'
    },
    comB: 'mot_reflective',
    description: {
      fr: 'ReprÃ©sentation mentale de rÃ©sultats ou fins visÃ©s',
      en: 'Mental representation of outcomes or end states to aim for'
    }
  }, {
    id: 'TDF10',
    name: {
      fr: 'MÃ©moire, attention et processus dÃ©cisionnels',
      en: 'Memory, Attention and Decision Processes'
    },
    comB: 'cap_psychological',
    description: {
      fr: 'CapacitÃ© Ã  retenir, se concentrer et choisir entre alternatives',
      en: 'Ability to retain, focus, and choose between alternatives'
    }
  }, {
    id: 'TDF11',
    name: {
      fr: 'Contexte environnemental et ressources',
      en: 'Environmental Context and Resources'
    },
    comB: 'opp_physical',
    description: {
      fr: 'Circonstances de la situation ou de l\'environnement',
      en: 'Circumstances of situation or environment'
    }
  }, {
    id: 'TDF12',
    name: {
      fr: 'Influences sociales',
      en: 'Social Influences'
    },
    comB: 'opp_social',
    description: {
      fr: 'Processus interpersonnels qui modifient les pensÃ©es, sentiments ou comportements',
      en: 'Interpersonal processes that alter thoughts, feelings, or behaviors'
    }
  }, {
    id: 'TDF13',
    name: {
      fr: 'Ã‰motion',
      en: 'Emotion'
    },
    comB: 'mot_automatic',
    description: {
      fr: 'Patron complexe de rÃ©action incluant sentiments et rÃ©ponses physiologiques',
      en: 'Complex pattern of reaction including feelings and physiological responses'
    }
  }, {
    id: 'TDF14',
    name: {
      fr: 'RÃ©gulation comportementale',
      en: 'Behavioural Regulation'
    },
    comB: 'cap_psychological',
    description: {
      fr: 'Tout ce qui vise Ã  gÃ©rer ou modifier les actions',
      en: 'Anything aimed at managing or changing actions'
    }
  }],
  // BCW Intervention Functions mapped to COM-B
  interventionFunctions: {
    education: {
      comB: ['cap_psychological'],
      label: {
        fr: 'Ã‰ducation',
        en: 'Education'
      },
      description: {
        fr: 'Augmenter connaissances/comprÃ©hension',
        en: 'Increase knowledge/understanding'
      }
    },
    persuasion: {
      comB: ['mot_reflective', 'mot_automatic'],
      label: {
        fr: 'Persuasion',
        en: 'Persuasion'
      },
      description: {
        fr: 'Utiliser la communication pour susciter des sentiments positifs',
        en: 'Use communication to induce positive feelings'
      }
    },
    incentivisation: {
      comB: ['mot_reflective', 'mot_automatic'],
      label: {
        fr: 'Incitation',
        en: 'Incentivisation'
      },
      description: {
        fr: 'CrÃ©er une attente de rÃ©compense',
        en: 'Create expectation of reward'
      }
    },
    coercion: {
      comB: ['mot_reflective', 'mot_automatic'],
      label: {
        fr: 'Coercition',
        en: 'Coercion'
      },
      description: {
        fr: 'CrÃ©er une attente de punition',
        en: 'Create expectation of punishment'
      }
    },
    training: {
      comB: ['cap_physical', 'cap_psychological'],
      label: {
        fr: 'Formation',
        en: 'Training'
      },
      description: {
        fr: 'Transmettre des compÃ©tences',
        en: 'Impart skills'
      }
    },
    restriction: {
      comB: ['opp_physical', 'opp_social'],
      label: {
        fr: 'Restriction',
        en: 'Restriction'
      },
      description: {
        fr: 'Utiliser des rÃ¨gles pour rÃ©duire l\'opportunitÃ©',
        en: 'Use rules to reduce opportunity'
      }
    },
    environmentalRestructuring: {
      comB: ['opp_physical', 'opp_social'],
      label: {
        fr: 'Restructuration environnementale',
        en: 'Environmental Restructuring'
      },
      description: {
        fr: 'Modifier l\'environnement physique ou social',
        en: 'Change physical or social environment'
      }
    },
    modelling: {
      comB: ['mot_reflective', 'cap_psychological'],
      label: {
        fr: 'ModÃ©lisation',
        en: 'Modelling'
      },
      description: {
        fr: 'Fournir un exemple Ã  imiter',
        en: 'Provide example to aspire to or imitate'
      }
    },
    enablement: {
      comB: ['cap_physical', 'cap_psychological', 'opp_physical'],
      label: {
        fr: 'Facilitation',
        en: 'Enablement'
      },
      description: {
        fr: 'Augmenter les moyens/rÃ©duire les barriÃ¨res',
        en: 'Increase means/reduce barriers'
      }
    }
  },
  // Diagnose behavior using COM-B
  diagnose: function (scores, lang) {
    var self = this;
    var t = function (fr, en) {
      return lang === 'fr' ? fr : en;
    };
    var result = {
      components: {},
      tdfAnalysis: [],
      recommendations: [],
      globalScore: 0
    };
    var totalScore = 0;
    var count = 0;
    Object.keys(self.comB).forEach(function (compKey) {
      var comp = self.comB[compKey];
      var subScores = {};
      Object.keys(comp.subComponents).forEach(function (subKey) {
        var sub = comp.subComponents[subKey];
        subScores[subKey] = scores[sub.id] || 0;
      });
      var avg = 0;
      var n = 0;
      Object.values(subScores).forEach(function (s) {
        avg += s;
        n++;
      });
      avg = n > 0 ? Math.round(avg / n) : 0;
      result.components[compKey] = {
        label: comp.label,
        color: comp.color,
        score: avg,
        subScores: subScores
      };
      totalScore += avg;
      count++;
    });
    result.globalScore = count > 0 ? Math.round(totalScore / count) : 0;

    // Map low COM-B to TDF domains
    Object.keys(result.components).forEach(function (compKey) {
      if (result.components[compKey].score < 60) {
        Object.keys(result.components[compKey].subScores).forEach(function (subKey) {
          if (result.components[compKey].subScores[subKey] < 60) {
            self.tdfDomains.forEach(function (tdf) {
              if (tdf.comB === subKey) {
                result.tdfAnalysis.push({
                  domain: tdf.name,
                  comB: compKey,
                  score: result.components[compKey].subScores[subKey]
                });
              }
            });
          }
        });
      }
    });

    // Recommend intervention functions
    Object.keys(result.components).forEach(function (compKey) {
      if (result.components[compKey].score < 60) {
        Object.keys(self.interventionFunctions).forEach(function (funcKey) {
          var func = self.interventionFunctions[funcKey];
          var subs = Object.keys(self.comB[compKey].subComponents);
          subs.forEach(function (sub) {
            if (func.comB.indexOf(sub) >= 0) {
              result.recommendations.push({
                function: func.label,
                target: self.comB[compKey].label,
                rationale: func.description
              });
            }
          });
        });
      }
    });
    return result;
  }
};
console.log('âœ… MOUDAR v11.0: COMBDiagnostic loaded â€” COM-B (3+6), TDF (14 domains), BCW (9 functions)');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE D5: HYBRID EFFECTIVENESS-IMPLEMENTATION DESIGN WIZARD
// Curran GM et al. (2012) Medical Care 50:217-226
// First automated Hybrid Design Wizard in the world
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var HybridDesignWizard = {
  VERSION: '11.0.0',
  citation: 'Curran GM et al. (2012). Medical Care, 50:217-226',
  // Three Hybrid Design Types
  types: {
    type1: {
      id: 'type1',
      label: {
        fr: 'Hybride Type 1',
        en: 'Hybrid Type 1'
      },
      focus: {
        fr: 'Focus primaire: EfficacitÃ© clinique | Secondaire: ImplÃ©mentation',
        en: 'Primary focus: Clinical effectiveness | Secondary: Implementation'
      },
      description: {
        fr: 'Teste l\'intervention clinique tout en observant/recueillant des donnÃ©es sur l\'implÃ©mentation. UtilisÃ© quand l\'intervention a des preuves prÃ©liminaires.',
        en: 'Tests clinical intervention while observing/gathering implementation data. Used when intervention has preliminary evidence.'
      },
      color: '#3b82f6',
      whenToUse: [{
        fr: 'L\'intervention a des preuves prÃ©liminaires mais pas de RCT large',
        en: 'Intervention has preliminary evidence but no large RCT'
      }, {
        fr: 'Le risque clinique de l\'intervention est faible',
        en: 'Clinical risk of intervention is low'
      }, {
        fr: 'Il y a un besoin urgent de donnÃ©es d\'efficacitÃ©',
        en: 'There is urgent need for effectiveness data'
      }],
      clinicalWeight: 0.7,
      implementationWeight: 0.3,
      typicalDesigns: ['RCT', 'Stepped-wedge', 'Pragmatic trial'],
      implementationMeasures: ['Feasibility', 'Acceptability', 'Adoption (descriptive)'],
      clinicalMeasures: ['Primary clinical outcomes', 'Secondary clinical outcomes', 'Safety']
    },
    type2: {
      id: 'type2',
      label: {
        fr: 'Hybride Type 2',
        en: 'Hybrid Type 2'
      },
      focus: {
        fr: 'Focus dual: EfficacitÃ© clinique = ImplÃ©mentation',
        en: 'Dual focus: Clinical effectiveness = Implementation'
      },
      description: {
        fr: 'Teste simultanÃ©ment l\'intervention clinique ET la stratÃ©gie d\'implÃ©mentation. Requiert un design factorial ou cluster.',
        en: 'Simultaneously tests clinical intervention AND implementation strategy. Requires factorial or cluster design.'
      },
      color: '#7c3aed',
      whenToUse: [{
        fr: 'L\'intervention a des preuves solides mais est peu adoptÃ©e',
        en: 'Intervention has strong evidence but low adoption'
      }, {
        fr: 'Les stratÃ©gies d\'implÃ©mentation ont aussi besoin de preuves',
        en: 'Implementation strategies also need evidence'
      }, {
        fr: 'Budget et ressources suffisants pour un design complexe',
        en: 'Sufficient budget and resources for complex design'
      }],
      clinicalWeight: 0.5,
      implementationWeight: 0.5,
      typicalDesigns: ['Factorial RCT', 'Cluster RCT', 'Stepped-wedge cluster', 'SMART'],
      implementationMeasures: ['Adoption', 'Fidelity', 'Penetration', 'Cost-effectiveness'],
      clinicalMeasures: ['Primary clinical outcomes', 'Patient-reported outcomes']
    },
    type3: {
      id: 'type3',
      label: {
        fr: 'Hybride Type 3',
        en: 'Hybrid Type 3'
      },
      focus: {
        fr: 'Focus primaire: ImplÃ©mentation | Secondaire: EfficacitÃ© clinique',
        en: 'Primary focus: Implementation | Secondary: Clinical effectiveness'
      },
      description: {
        fr: 'Teste la stratÃ©gie d\'implÃ©mentation tout en surveillant les outcomes cliniques. UtilisÃ© quand l\'intervention est dÃ©jÃ  prouvÃ©e.',
        en: 'Tests implementation strategy while monitoring clinical outcomes. Used when intervention is already evidence-based.'
      },
      color: '#059669',
      whenToUse: [{
        fr: 'L\'intervention est dÃ©jÃ  evidence-based (multiples RCTs)',
        en: 'Intervention is already evidence-based (multiple RCTs)'
      }, {
        fr: 'Le gap est dans l\'implÃ©mentation, pas dans l\'efficacitÃ©',
        en: 'Gap is in implementation, not in effectiveness'
      }, {
        fr: 'Il est Ã©thiquement difficile de retenir l\'intervention',
        en: 'It is ethically difficult to withhold the intervention'
      }],
      clinicalWeight: 0.3,
      implementationWeight: 0.7,
      typicalDesigns: ['Cluster RCT (of strategy)', 'Stepped-wedge', 'SMART', 'Interrupted time series'],
      implementationMeasures: ['Adoption (primary)', 'Fidelity (primary)', 'Penetration', 'Sustainability', 'Cost'],
      clinicalMeasures: ['Clinical outcomes (monitoring)', 'Safety monitoring']
    }
  },
  // Decision algorithm to recommend Hybrid type
  recommend: function (answers, lang) {
    var t = function (fr, en) {
      return lang === 'fr' ? fr : en;
    };
    var score = {
      type1: 0,
      type2: 0,
      type3: 0
    };

    // Evidence level
    if (answers.evidenceLevel === 'preliminary') {
      score.type1 += 3;
      score.type2 += 1;
    } else if (answers.evidenceLevel === 'moderate') {
      score.type1 += 1;
      score.type2 += 3;
      score.type3 += 1;
    } else if (answers.evidenceLevel === 'strong') {
      score.type2 += 1;
      score.type3 += 3;
    }

    // Primary question
    if (answers.primaryQuestion === 'effectiveness') {
      score.type1 += 3;
      score.type2 += 1;
    } else if (answers.primaryQuestion === 'both') {
      score.type2 += 3;
    } else if (answers.primaryQuestion === 'implementation') {
      score.type2 += 1;
      score.type3 += 3;
    }

    // Adoption concern
    if (answers.adoptionConcern === 'high') {
      score.type2 += 2;
      score.type3 += 2;
    } else if (answers.adoptionConcern === 'low') {
      score.type1 += 2;
    }

    // Resources
    if (answers.resources === 'high') {
      score.type2 += 2;
    } else if (answers.resources === 'low') {
      score.type1 += 1;
      score.type3 += 1;
    }

    // Ethical concern
    if (answers.ethicalWithhold === 'yes') {
      score.type3 += 3;
    }
    var best = 'type1';
    if (score.type2 > score[best]) best = 'type2';
    if (score.type3 > score[best]) best = 'type3';
    var type = this.types[best];
    return {
      recommended: best,
      type: type,
      scores: score,
      confidence: score[best] > 8 ? 'high' : score[best] > 5 ? 'moderate' : 'low',
      rationale: t('BasÃ© sur le niveau de preuve (' + answers.evidenceLevel + '), la question primaire (' + answers.primaryQuestion + '), et les ressources disponibles.', 'Based on evidence level (' + answers.evidenceLevel + '), primary question (' + answers.primaryQuestion + '), and available resources.'),
      citation: this.citation
    };
  }
};
console.log('âœ… MOUDAR v11.0: HybridDesignWizard loaded â€” Types 1, 2, 3 (Curran 2012)');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE D6: SUSTAINABILITY ASSESSMENT ENGINE
// Luke DA et al. (2014) Implementation Science 9:130 (PSAT)
// Chambers DA et al. (2013) Implementation Science 8:117 (DSF)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var SustainabilityEngine = {
  VERSION: '11.0.0',
  psatCitation: 'Luke DA et al. (2014). Implementation Science, 9:130',
  dsfCitation: 'Chambers DA, Glasgow RE, Stange KC. (2013). Implementation Science, 8:117',
  nhsCitation: 'Maher L et al. (2010). NHS Institute for Innovation and Improvement',
  // PSAT - 8 sustainability domains (40 items)
  psatDomains: {
    politicalSupport: {
      id: 'political',
      label: {
        fr: 'Soutien politique',
        en: 'Political Support'
      },
      color: '#dc2626',
      items: [{
        fr: 'Les champions dÃ©fendent le programme',
        en: 'Champions advocate for the program'
      }, {
        fr: 'Le programme a un soutien au niveau politique',
        en: 'Program has political-level support'
      }, {
        fr: 'Les dÃ©cideurs sont engagÃ©s',
        en: 'Decision-makers are engaged'
      }]
    },
    funding: {
      id: 'funding',
      label: {
        fr: 'StabilitÃ© du financement',
        en: 'Funding Stability'
      },
      color: '#059669',
      items: [{
        fr: 'Le programme a un financement stable',
        en: 'Program has stable funding'
      }, {
        fr: 'Des sources de financement diversifiÃ©es existent',
        en: 'Diversified funding sources exist'
      }, {
        fr: 'Un plan financier Ã  long terme est en place',
        en: 'Long-term financial plan is in place'
      }]
    },
    partnerships: {
      id: 'partnerships',
      label: {
        fr: 'Partenariats',
        en: 'Partnerships'
      },
      color: '#2563eb',
      items: [{
        fr: 'Des partenariats solides sont Ã©tablis',
        en: 'Strong partnerships are established'
      }, {
        fr: 'Les partenaires contribuent activement',
        en: 'Partners actively contribute'
      }, {
        fr: 'Les partenariats sont diversifiÃ©s',
        en: 'Partnerships are diversified'
      }]
    },
    orgCapacity: {
      id: 'orgCapacity',
      label: {
        fr: 'CapacitÃ© organisationnelle',
        en: 'Organizational Capacity'
      },
      color: '#7c3aed',
      items: [{
        fr: 'L\'organisation a les compÃ©tences internes',
        en: 'Organization has internal competencies'
      }, {
        fr: 'Le leadership soutient le programme',
        en: 'Leadership supports the program'
      }, {
        fr: 'Des processus de dÃ©cision efficaces existent',
        en: 'Effective decision processes exist'
      }]
    },
    evaluation: {
      id: 'evaluation',
      label: {
        fr: 'Ã‰valuation du programme',
        en: 'Program Evaluation'
      },
      color: '#d97706',
      items: [{
        fr: 'Le programme est rÃ©guliÃ¨rement Ã©valuÃ©',
        en: 'Program is regularly evaluated'
      }, {
        fr: 'Les donnÃ©es sont utilisÃ©es pour l\'amÃ©lioration',
        en: 'Data is used for improvement'
      }, {
        fr: 'Les rÃ©sultats sont communiquÃ©s',
        en: 'Results are communicated'
      }]
    },
    adaptation: {
      id: 'adaptation',
      label: {
        fr: 'Adaptation du programme',
        en: 'Program Adaptation'
      },
      color: '#0891b2',
      items: [{
        fr: 'Le programme s\'adapte aux besoins changeants',
        en: 'Program adapts to changing needs'
      }, {
        fr: 'Des mÃ©canismes de feedback existent',
        en: 'Feedback mechanisms exist'
      }, {
        fr: 'Les adaptations prÃ©servent les composantes essentielles',
        en: 'Adaptations preserve core components'
      }]
    },
    communications: {
      id: 'communications',
      label: {
        fr: 'Communications',
        en: 'Communications'
      },
      color: '#be185d',
      items: [{
        fr: 'Le programme communique ses rÃ©sultats',
        en: 'Program communicates its results'
      }, {
        fr: 'Les parties prenantes sont rÃ©guliÃ¨rement informÃ©es',
        en: 'Stakeholders are regularly informed'
      }, {
        fr: 'La communication est stratÃ©gique',
        en: 'Communication is strategic'
      }]
    },
    strategicPlanning: {
      id: 'strategic',
      label: {
        fr: 'Planification stratÃ©gique',
        en: 'Strategic Planning'
      },
      color: '#4f46e5',
      items: [{
        fr: 'Un plan de pÃ©rennisation existe',
        en: 'Sustainability plan exists'
      }, {
        fr: 'Des objectifs Ã  long terme sont dÃ©finis',
        en: 'Long-term goals are defined'
      }, {
        fr: 'Le programme est alignÃ© avec la mission institutionnelle',
        en: 'Program aligns with institutional mission'
      }]
    }
  },
  // Dynamic Sustainability Framework dimensions (Chambers 2013)
  dsfDimensions: {
    intervention: {
      id: 'dsf_intervention',
      label: {
        fr: 'Ã‰volution de l\'intervention',
        en: 'Intervention Evolution'
      },
      description: {
        fr: 'Comment l\'intervention s\'adapte dans le temps tout en maintenant l\'efficacitÃ©',
        en: 'How intervention adapts over time while maintaining effectiveness'
      }
    },
    context: {
      id: 'dsf_context',
      label: {
        fr: 'Ã‰volution du contexte',
        en: 'Context Evolution'
      },
      description: {
        fr: 'Comment le contexte change et affecte la pÃ©rennisation',
        en: 'How context changes and affects sustainability'
      }
    },
    ecosystem: {
      id: 'dsf_ecosystem',
      label: {
        fr: 'Ã‰cosystÃ¨me Ã©largi',
        en: 'Broader Ecosystem'
      },
      description: {
        fr: 'Facteurs systÃ©miques, politiques et sociaux qui Ã©voluent',
        en: 'Systemic, policy, and social factors that evolve'
      }
    },
    fit: {
      id: 'dsf_fit',
      label: {
        fr: 'AdÃ©quation continue (Fit)',
        en: 'Ongoing Fit'
      },
      description: {
        fr: 'L\'alignement dynamique entre intervention, contexte et Ã©cosystÃ¨me',
        en: 'Dynamic alignment between intervention, context, and ecosystem'
      }
    }
  },
  // Evaluate sustainability
  evaluate: function (psatScores, dsfScores, lang) {
    var self = this;
    var t = function (fr, en) {
      return lang === 'fr' ? fr : en;
    };
    var result = {
      psat: {
        domains: {},
        globalScore: 0
      },
      dsf: {},
      risks: [],
      recommendations: []
    };
    var total = 0;
    var count = 0;
    Object.keys(self.psatDomains).forEach(function (domKey) {
      var score = psatScores[domKey] || 0;
      result.psat.domains[domKey] = {
        label: self.psatDomains[domKey].label,
        score: score,
        color: self.psatDomains[domKey].color
      };
      total += score;
      count++;
      if (score < 50) {
        result.risks.push({
          domain: self.psatDomains[domKey].label,
          score: score,
          severity: score < 30 ? 'critical' : 'moderate'
        });
      }
    });
    result.psat.globalScore = count > 0 ? Math.round(total / count) : 0;
    Object.keys(self.dsfDimensions).forEach(function (dimKey) {
      result.dsf[dimKey] = {
        label: self.dsfDimensions[dimKey].label,
        score: dsfScores[dimKey] || 0,
        description: self.dsfDimensions[dimKey].description
      };
    });

    // Recommendations based on weak areas
    result.risks.forEach(function (risk) {
      if (risk.domain.fr === 'StabilitÃ© du financement' || risk.domain.en === 'Funding Stability') {
        result.recommendations.push(t('Diversifier les sources de financement et dÃ©velopper un business case pour la pÃ©rennisation', 'Diversify funding sources and develop a business case for sustainability'));
      }
      if (risk.domain.fr === 'Soutien politique' || risk.domain.en === 'Political Support') {
        result.recommendations.push(t('Identifier et mobiliser des champions institutionnels et des parties prenantes clÃ©s', 'Identify and mobilize institutional champions and key stakeholders'));
      }
    });
    result.sustainabilityIndex = Math.round(result.psat.globalScore * 0.6 + Object.values(dsfScores).reduce(function (a, b) {
      return a + b;
    }, 0) / Math.max(Object.keys(dsfScores).length, 1) * 0.4);
    return result;
  }
};
console.log('âœ… MOUDAR v11.0: SustainabilityEngine loaded â€” PSAT (8 domains) + DSF (4 dimensions)');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// v11.0 MODULE D7: QUALITATIVE DATA ANALYSIS ASSISTANT
// Operationalizes CFIR coding guidelines from Reardon et al. (2025)
// AI-assisted qualitative coding for IS research
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var QualitativeAssistant = {
  VERSION: '11.0.0',
  citation: 'Reardon CM et al. (2025). CFIR Coding Guidelines. Implementation Science, 20:39',
  hamiltonCitation: 'Hamilton AB. (2013). Qualitative Methods in Rapid Turn-Around Health Services Research. VA HSR&D.',
  // CFIR coding scheme (deductive codes)
  codingScheme: {
    innovation: {
      domain: {
        fr: 'Innovation',
        en: 'Innovation'
      },
      color: '#3b82f6',
      codes: ['IC1', 'IC2', 'IC3', 'IC4', 'IC5', 'IC6', 'IC7', 'IC8']
    },
    outerSetting: {
      domain: {
        fr: 'Cadre externe',
        en: 'Outer Setting'
      },
      color: '#059669',
      codes: ['OS1', 'OS2', 'OS3', 'OS4', 'OS5', 'OS6']
    },
    innerSetting: {
      domain: {
        fr: 'Cadre interne',
        en: 'Inner Setting'
      },
      color: '#7c3aed',
      codes: ['IS1', 'IS2', 'IS3', 'IS4', 'IS5', 'IS6', 'IS7', 'IS8', 'IS9', 'IS10', 'IS11', 'IS12', 'IS13', 'IS14']
    },
    individuals: {
      domain: {
        fr: 'Individus',
        en: 'Individuals'
      },
      color: '#d97706',
      codes: ['IN1', 'IN2', 'IN3', 'IN4', 'IN5']
    },
    process: {
      domain: {
        fr: 'Processus',
        en: 'Process'
      },
      color: '#dc2626',
      codes: ['PR1', 'PR2', 'PR3', 'PR4', 'PR5', 'PR6']
    }
  },
  // Rating scale from CFIR User Guide
  ratingScale: {
    '+2': {
      label: {
        fr: 'Facilite fortement',
        en: 'Strongly facilitates'
      },
      color: '#059669'
    },
    '+1': {
      label: {
        fr: 'Facilite faiblement',
        en: 'Weakly facilitates'
      },
      color: '#34d399'
    },
    '0': {
      label: {
        fr: 'Neutre/Mixte',
        en: 'Neutral/Mixed'
      },
      color: '#9ca3af'
    },
    '-1': {
      label: {
        fr: 'BarriÃ¨re faible',
        en: 'Weak barrier'
      },
      color: '#fb923c'
    },
    '-2': {
      label: {
        fr: 'BarriÃ¨re forte',
        en: 'Strong barrier'
      },
      color: '#dc2626'
    },
    'X': {
      label: {
        fr: 'Non applicable/DonnÃ©es insuffisantes',
        en: 'Not applicable/Insufficient data'
      },
      color: '#6b7280'
    }
  },
  // Keyword patterns for auto-coding (keyword matching, not NLP/ML)
  patterns: {
    IC1: {
      keywords: ['developed', 'created', 'origin', 'source', 'external', 'internal', 'dÃ©veloppÃ©', 'crÃ©Ã©', 'origine', 'source']
    },
    IC2: {
      keywords: ['evidence', 'proof', 'study', 'research', 'data', 'preuve', 'Ã©tude', 'recherche', 'donnÃ©es']
    },
    IC3: {
      keywords: ['advantage', 'better', 'superior', 'compared to', 'avantage', 'meilleur', 'supÃ©rieur', 'comparÃ©']
    },
    IC4: {
      keywords: ['adapt', 'modify', 'tailor', 'flexible', 'customize', 'adapter', 'modifier', 'personnaliser', 'flexible']
    },
    IC6: {
      keywords: ['complex', 'difficult', 'complicated', 'hard', 'challenging', 'complexe', 'difficile', 'compliquÃ©']
    },
    IS4: {
      keywords: ['culture', 'values', 'norms', 'tradition', 'custom', 'culture', 'valeurs', 'normes', 'tradition']
    },
    IS6: {
      keywords: ['compatible', 'fit', 'align', 'match', 'workflow', 'compatible', 'adÃ©quation', 'aligner']
    },
    IS11: {
      keywords: ['leader', 'champion', 'support', 'director', 'manager', 'leader', 'champion', 'soutien', 'directeur']
    },
    IS12: {
      keywords: ['resource', 'budget', 'staff', 'time', 'money', 'equipment', 'ressource', 'budget', 'personnel', 'temps']
    },
    IN2: {
      keywords: ['knowledge', 'skill', 'competence', 'training', 'education', 'connaissance', 'compÃ©tence', 'formation']
    },
    IN4: {
      keywords: ['motivation', 'willing', 'resist', 'attitude', 'belief', 'motivation', 'volontÃ©', 'rÃ©sistance', 'attitude']
    },
    PR3: {
      keywords: ['engage', 'involve', 'participate', 'stakeholder', 'champion', 'engager', 'impliquer', 'participer']
    },
    PR5: {
      keywords: ['monitor', 'evaluate', 'feedback', 'assess', 'reflect', 'surveiller', 'Ã©valuer', 'feedback', 'rÃ©flÃ©chir']
    }
  },
  // Auto-code a text segment
  autoCode: function (text) {
    var self = this;
    var codes = [];
    var lowerText = text.toLowerCase();
    Object.keys(self.patterns).forEach(function (codeId) {
      var pattern = self.patterns[codeId];
      var matchCount = 0;
      pattern.keywords.forEach(function (kw) {
        if (lowerText.indexOf(kw.toLowerCase()) >= 0) matchCount++;
      });
      if (matchCount >= 2) {
        codes.push({
          code: codeId,
          confidence: matchCount >= 4 ? 'high' : matchCount >= 2 ? 'moderate' : 'low',
          matchCount: matchCount
        });
      }
    });
    codes.sort(function (a, b) {
      return b.matchCount - a.matchCount;
    });
    return codes;
  },
  // Generate Inner Setting Memo from coded data
  generateMemo: function (innerSettingId, codedData, lang) {
    var t = function (fr, en) {
      return lang === 'fr' ? fr : en;
    };
    var memo = {
      innerSetting: innerSettingId,
      date: new Date().toISOString(),
      constructSummaries: {},
      overallAssessment: '',
      template: 'AF3'
    };
    Object.keys(codedData).forEach(function (code) {
      memo.constructSummaries[code] = {
        rating: codedData[code].rating || 0,
        summary: codedData[code].summary || '',
        quotes: codedData[code].quotes || [],
        sources: codedData[code].sources || []
      };
    });
    return memo;
  },
  // Generate Construct x Inner Setting Matrix
  generateMatrix: function (innerSettings, codedByIS, constructs) {
    var matrix = {
      constructs: constructs,
      innerSettings: innerSettings,
      cells: {}
    };
    innerSettings.forEach(function (is) {
      matrix.cells[is] = {};
      constructs.forEach(function (c) {
        matrix.cells[is][c] = codedByIS[is] && codedByIS[is][c] ? codedByIS[is][c] : {
          rating: 'X',
          summary: ''
        };
      });
    });

    // Identify distinguishing constructs
    matrix.distinguishing = constructs.filter(function (c) {
      var ratings = innerSettings.map(function (is) {
        return matrix.cells[is][c].rating;
      }).filter(function (r) {
        return r !== 'X';
      });
      if (ratings.length < 2) return false;
      var max = Math.max.apply(null, ratings);
      var min = Math.min.apply(null, ratings);
      return max - min >= 2;
    });
    return matrix;
  }
};
console.log('âœ… MOUDAR v11.0: QualitativeAssistant loaded â€” CFIR coding, rating -2/+2, auto-coding par mots-cles, matrix generator');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 2: GRANT AI WRITER (GAW) v9.0
// GÃ©nÃ©ration de propositions adaptÃ©es par bailleur
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var GrantAIWriter = {
  VERSION: '9.0.0',
  funders: {
    GLOBAL_FUND: {
      id: 'GLOBAL_FUND',
      name: 'Global Fund',
      fullName: 'The Global Fund to Fight AIDS, Tuberculosis and Malaria',
      logo: 'ðŸŒ',
      color: '#00A651',
      maxBudget: 50000000,
      minBudget: 500000,
      domains: ['health', 'mental_health', 'hiv_aids', 'tuberculosis', 'malaria'],
      sections: [{
        id: 'executive_summary',
        label: {
          fr: 'RÃ©sumÃ© exÃ©cutif',
          en: 'Executive Summary'
        },
        maxWords: 500
      }, {
        id: 'context',
        label: {
          fr: 'Contexte et justification',
          en: 'Context and Rationale'
        },
        maxWords: 1500
      }, {
        id: 'objectives',
        label: {
          fr: 'Objectifs et rÃ©sultats',
          en: 'Objectives and Results'
        },
        maxWords: 1000
      }, {
        id: 'implementation',
        label: {
          fr: 'StratÃ©gie de mise en Å“uvre',
          en: 'Implementation Strategy'
        },
        maxWords: 2000
      }, {
        id: 'monitoring',
        label: {
          fr: 'Suivi et Ã©valuation',
          en: 'Monitoring and Evaluation'
        },
        maxWords: 1000
      }, {
        id: 'sustainability',
        label: {
          fr: 'DurabilitÃ©',
          en: 'Sustainability'
        },
        maxWords: 800
      }, {
        id: 'budget',
        label: {
          fr: 'Budget',
          en: 'Budget'
        },
        maxWords: 500
      }, {
        id: 'risks',
        label: {
          fr: 'Risques et mitigation',
          en: 'Risks and Mitigation'
        },
        maxWords: 600
      }],
      evaluationCriteria: {
        technical: 25,
        feasibility: 20,
        cost_effectiveness: 15,
        sustainability: 15,
        innovation: 10,
        equity: 15
      }
    },
    USAID: {
      id: 'USAID',
      name: 'USAID',
      fullName: 'United States Agency for International Development',
      logo: 'ðŸ‡ºðŸ‡¸',
      color: '#002F6C',
      maxBudget: 25000000,
      minBudget: 100000,
      domains: ['health', 'education', 'governance', 'economic_growth', 'humanitarian'],
      sections: [{
        id: 'technical_approach',
        label: {
          fr: 'Approche technique',
          en: 'Technical Approach'
        },
        maxWords: 3000
      }, {
        id: 'management',
        label: {
          fr: 'Plan de gestion',
          en: 'Management Plan'
        },
        maxWords: 1500
      }, {
        id: 'staffing',
        label: {
          fr: 'Personnel clÃ©',
          en: 'Key Personnel'
        },
        maxWords: 1000
      }, {
        id: 'past_performance',
        label: {
          fr: 'Performances passÃ©es',
          en: 'Past Performance'
        },
        maxWords: 1000
      }, {
        id: 'cost_proposal',
        label: {
          fr: 'Proposition financiÃ¨re',
          en: 'Cost Proposal'
        },
        maxWords: 500
      }],
      evaluationCriteria: {
        technical: 40,
        management: 25,
        past_performance: 20,
        cost: 15
      }
    },
    GATES: {
      id: 'GATES',
      name: 'Gates Foundation',
      fullName: 'Bill & Melinda Gates Foundation',
      logo: 'ðŸ”¬',
      color: '#1D70B8',
      maxBudget: 100000000,
      minBudget: 100000,
      domains: ['health', 'education', 'poverty', 'agriculture', 'financial_services'],
      sections: [{
        id: 'problem',
        label: {
          fr: 'ProblÃ¨me',
          en: 'Problem Statement'
        },
        maxWords: 800
      }, {
        id: 'solution',
        label: {
          fr: 'Solution proposÃ©e',
          en: 'Proposed Solution'
        },
        maxWords: 1500
      }, {
        id: 'innovation',
        label: {
          fr: 'Innovation',
          en: 'Innovation'
        },
        maxWords: 1000
      }, {
        id: 'evidence',
        label: {
          fr: 'Base de preuves',
          en: 'Evidence Base'
        },
        maxWords: 1000
      }, {
        id: 'scale',
        label: {
          fr: 'Potentiel de mise Ã  l\'Ã©chelle',
          en: 'Scale Potential'
        },
        maxWords: 800
      }, {
        id: 'team',
        label: {
          fr: 'Ã‰quipe',
          en: 'Team'
        },
        maxWords: 500
      }],
      evaluationCriteria: {
        innovation: 30,
        scalability: 25,
        evidence: 20,
        team: 15,
        cost_effectiveness: 10
      }
    },
    NIH: {
      id: 'NIH',
      name: 'NIH',
      fullName: 'National Institutes of Health',
      logo: 'ðŸ”¬',
      color: '#20558A',
      maxBudget: 5000000,
      minBudget: 50000,
      domains: ['health', 'mental_health', 'research', 'biomedical'],
      sections: [{
        id: 'specific_aims',
        label: {
          fr: 'Objectifs spÃ©cifiques',
          en: 'Specific Aims'
        },
        maxWords: 500
      }, {
        id: 'significance',
        label: {
          fr: 'Importance',
          en: 'Significance'
        },
        maxWords: 1500
      }, {
        id: 'innovation',
        label: {
          fr: 'Innovation',
          en: 'Innovation'
        },
        maxWords: 1000
      }, {
        id: 'approach',
        label: {
          fr: 'Approche',
          en: 'Approach'
        },
        maxWords: 3000
      }, {
        id: 'environment',
        label: {
          fr: 'Environnement',
          en: 'Environment'
        },
        maxWords: 500
      }],
      evaluationCriteria: {
        significance: 25,
        innovation: 25,
        approach: 25,
        investigators: 15,
        environment: 10
      }
    },
    WHO: {
      id: 'WHO',
      name: 'WHO',
      fullName: 'World Health Organization',
      logo: 'âš•ï¸',
      color: '#009CDE',
      maxBudget: 10000000,
      minBudget: 50000,
      domains: ['health', 'mental_health', 'ncd', 'emergencies', 'health_systems'],
      sections: [{
        id: 'background',
        label: {
          fr: 'Contexte',
          en: 'Background'
        },
        maxWords: 1000
      }, {
        id: 'objectives',
        label: {
          fr: 'Objectifs',
          en: 'Objectives'
        },
        maxWords: 800
      }, {
        id: 'activities',
        label: {
          fr: 'ActivitÃ©s',
          en: 'Activities'
        },
        maxWords: 1500
      }, {
        id: 'workplan',
        label: {
          fr: 'Plan de travail',
          en: 'Workplan'
        },
        maxWords: 800
      }, {
        id: 'budget',
        label: {
          fr: 'Budget',
          en: 'Budget'
        },
        maxWords: 500
      }, {
        id: 'monitoring',
        label: {
          fr: 'Suivi',
          en: 'Monitoring'
        },
        maxWords: 600
      }],
      evaluationCriteria: {
        alignment_who_priorities: 30,
        technical_quality: 25,
        feasibility: 20,
        sustainability: 15,
        value_for_money: 10
      }
    }
  },
  calculateAlignment: function (project, funderId) {
    var funder = this.funders[funderId];
    if (!funder) return {
      score: 0,
      factors: [],
      recommendation: 'unknown'
    };
    var score = 0;
    var factors = [];

    // Domain match (30 points)
    var domainMatch = funder.domains.indexOf(project.domain) !== -1;
    if (domainMatch) {
      score += 30;
      factors.push({
        factor: 'domain',
        points: 30,
        status: 'match'
      });
    } else {
      factors.push({
        factor: 'domain',
        points: 0,
        status: 'mismatch'
      });
    }

    // Budget fit (25 points)
    var budget = project.budget || 500000;
    if (budget >= funder.minBudget && budget <= funder.maxBudget) {
      score += 25;
      factors.push({
        factor: 'budget',
        points: 25,
        status: 'fit'
      });
    } else if (budget < funder.minBudget) {
      score += 10;
      factors.push({
        factor: 'budget',
        points: 10,
        status: 'low'
      });
    } else {
      factors.push({
        factor: 'budget',
        points: 0,
        status: 'high'
      });
    }

    // Framework usage (20 points)
    var hasFramework = project.framework || project.cfirScores;
    if (hasFramework) {
      score += 20;
      factors.push({
        factor: 'framework',
        points: 20,
        status: 'present'
      });
    } else {
      score += 5;
      factors.push({
        factor: 'framework',
        points: 5,
        status: 'missing'
      });
    }

    // Evidence base (15 points)
    var hasEvidence = project.evidenceBase || project.references;
    if (hasEvidence) {
      score += 15;
      factors.push({
        factor: 'evidence',
        points: 15,
        status: 'strong'
      });
    } else {
      score += 5;
      factors.push({
        factor: 'evidence',
        points: 5,
        status: 'weak'
      });
    }

    // Bonus for implementation science approach (10 points)
    if (project.strategies && project.strategies.length > 0) {
      score += 10;
      factors.push({
        factor: 'implementation_science',
        points: 10,
        status: 'yes'
      });
    }
    var recommendation = 'not_recommended';
    if (score >= 80) recommendation = 'highly_recommended';else if (score >= 60) recommendation = 'recommended';else if (score >= 40) recommendation = 'possible';
    return {
      score: score,
      factors: factors,
      recommendation: recommendation,
      tips: this.generateTips(factors, funder)
    };
  },
  generateTips: function (factors, funder) {
    var tips = [];
    factors.forEach(function (f) {
      if (f.status === 'mismatch') {
        tips.push({
          fr: 'Domaine non prioritaire pour ' + funder.name + '. ConsidÃ©rez de souligner les liens avec: ' + funder.domains.join(', '),
          en: 'Domain not priority for ' + funder.name + '. Consider highlighting links to: ' + funder.domains.join(', ')
        });
      }
      if (f.status === 'low') {
        tips.push({
          fr: 'Budget infÃ©rieur au minimum. Envisagez des partenariats pour atteindre ' + funder.minBudget.toLocaleString() + ' USD',
          en: 'Budget below minimum. Consider partnerships to reach ' + funder.minBudget.toLocaleString() + ' USD'
        });
      }
      if (f.status === 'missing') {
        tips.push({
          fr: 'Ajoutez un cadre thÃ©orique (CFIR, RE-AIM) pour renforcer la proposition',
          en: 'Add a theoretical framework (CFIR, RE-AIM) to strengthen the proposal'
        });
      }
    });
    return tips;
  },
  generateProposal: function (project, funderId, lang) {
    var funder = this.funders[funderId];
    if (!funder) return null;
    lang = lang || 'fr';
    var sections = [];
    var self = this;
    funder.sections.forEach(function (section) {
      sections.push({
        id: section.id,
        label: section.label[lang],
        maxWords: section.maxWords,
        content: self.generateSectionContent(section.id, project, funder, lang)
      });
    });
    return {
      funderId: funderId,
      funderName: funder.name,
      projectTitle: project.title,
      sections: sections,
      alignment: this.calculateAlignment(project, funderId),
      generatedAt: new Date().toISOString()
    };
  },
  generateSectionContent: function (sectionId, project, funder, lang) {
    var templates = {
      executive_summary: {
        fr: 'Ce projet vise Ã  ' + (project.objectives ? project.objectives.join(', ') : 'amÃ©liorer les rÃ©sultats de santÃ©') + ' dans le contexte de ' + (project.context || 'ressources limitÃ©es') + '. En utilisant une approche basÃ©e sur la Science de l\'ImplÃ©mentation, nous proposons...',
        en: 'This project aims to ' + (project.objectives ? project.objectives.join(', ') : 'improve health outcomes') + ' in the context of ' + (project.context || 'limited resources') + '. Using an Implementation Science approach, we propose...'
      },
      context: {
        fr: 'Le contexte d\'implÃ©mentation prÃ©sente les caractÃ©ristiques suivantes: ' + (project.context || '[Ã€ complÃ©ter]') + '. Les barriÃ¨res identifiÃ©es incluent: ' + (project.barriers || '[Ã€ complÃ©ter]') + '.',
        en: 'The implementation context has the following characteristics: ' + (project.context || '[To complete]') + '. Identified barriers include: ' + (project.barriers || '[To complete]') + '.'
      },
      objectives: {
        fr: 'Objectif principal: AmÃ©liorer ' + (project.domain || 'la santÃ©') + ' via une implÃ©mentation structurÃ©e.\n\nRÃ©sultats attendus:\n- Adoption: Taux cible de 70%+\n- FidÃ©litÃ©: Score de fidÃ©litÃ© >80%\n- DurabilitÃ©: Maintien Ã  12 mois post-intervention',
        en: 'Main objective: Improve ' + (project.domain || 'health') + ' through structured implementation.\n\nExpected results:\n- Adoption: Target rate 70%+\n- Fidelity: Fidelity score >80%\n- Sustainability: Maintenance at 12 months post-intervention'
      },
      implementation: {
        fr: 'La stratÃ©gie d\'implÃ©mentation s\'appuie sur le cadre CFIR 2.0 et les stratÃ©gies ERIC validÃ©es. Les stratÃ©gies sÃ©lectionnÃ©es: ' + (project.strategies ? project.strategies.join(', ') : 'Formation, Champions, Facilitation') + '.',
        en: 'The implementation strategy builds on the CFIR 2.0 framework and validated ERIC strategies. Selected strategies: ' + (project.strategies ? project.strategies.join(', ') : 'Training, Champions, Facilitation') + '.'
      }
    };
    return templates[sectionId] ? templates[sectionId][lang] : '[Section Ã  complÃ©ter / Section to complete]';
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 3: QUALITATIVE ANALYSIS ENGINE (QAE) v9.0
// Extraction NLP des barriÃ¨res depuis transcriptions d'entretiens
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var QualitativeAnalysisEngine = {
  VERSION: '9.0.0',
  supportedLanguages: ['fr', 'en', 'ar', 'es'],
  barrierLexicon: {
    fr: {
      B01: {
        id: 'B01',
        label: 'Manque de formation',
        keywords: ['formation', 'compÃ©tence', 'savoir', 'connaissance', 'apprentissage', 'capacitÃ©'],
        phrases: ['pas formÃ©', 'manque de formation', 'besoin de formation', 'ne sait pas', 'n\'a pas appris'],
        sentiments: ['difficile', 'incapable', 'confus', 'perdu']
      },
      B02: {
        id: 'B02',
        label: 'Ressources insuffisantes',
        keywords: ['ressource', 'budget', 'argent', 'financement', 'moyens', 'Ã©quipement', 'matÃ©riel'],
        phrases: ['pas de budget', 'manque de moyens', 'pas assez', 'insuffisant'],
        sentiments: ['limitÃ©', 'contraint', 'restreint']
      },
      B05: {
        id: 'B05',
        label: 'RÃ©sistance au changement',
        keywords: ['rÃ©sistance', 'refus', 'opposition', 'rÃ©ticence', 'habitude', 'tradition'],
        phrases: ['ne veut pas', 'refuse de', 'toujours fait comme Ã§a', 'pas envie de changer'],
        sentiments: ['hostile', 'mÃ©fiant', 'sceptique']
      },
      B06: {
        id: 'B06',
        label: 'ProblÃ¨mes de leadership',
        keywords: ['leadership', 'direction', 'management', 'chef', 'responsable', 'hiÃ©rarchie'],
        phrases: ['pas de soutien', 'direction absente', 'pas de vision'],
        sentiments: ['abandonnÃ©', 'seul', 'sans guidance']
      },
      B07: {
        id: 'B07',
        label: 'Charge de travail excessive',
        keywords: ['charge', 'travail', 'surcharge', 'temps', 'disponibilitÃ©', 'occupation'],
        phrases: ['trop de travail', 'pas le temps', 'surchargÃ©', 'dÃ©bordÃ©'],
        sentiments: ['Ã©puisÃ©', 'fatiguÃ©', 'stressÃ©']
      },
      B09: {
        id: 'B09',
        label: 'Manque de communication',
        keywords: ['communication', 'information', 'message', 'coordination', 'Ã©change'],
        phrases: ['pas informÃ©', 'ne sait pas', 'personne ne dit', 'pas au courant'],
        sentiments: ['isolÃ©', 'dans le noir', 'dÃ©connectÃ©']
      }
    },
    en: {
      B01: {
        id: 'B01',
        label: 'Lack of training',
        keywords: ['training', 'skill', 'knowledge', 'competence', 'learning', 'capacity'],
        phrases: ['not trained', 'lack of training', 'need training', 'don\'t know how'],
        sentiments: ['difficult', 'unable', 'confused', 'lost']
      },
      B02: {
        id: 'B02',
        label: 'Insufficient resources',
        keywords: ['resource', 'budget', 'money', 'funding', 'equipment', 'material'],
        phrases: ['no budget', 'lack of resources', 'not enough', 'insufficient'],
        sentiments: ['limited', 'constrained', 'restricted']
      },
      B05: {
        id: 'B05',
        label: 'Resistance to change',
        keywords: ['resistance', 'refuse', 'opposition', 'reluctance', 'habit', 'tradition'],
        phrases: ['don\'t want to', 'refuse to', 'always done it this way', 'no desire to change'],
        sentiments: ['hostile', 'suspicious', 'skeptical']
      },
      B06: {
        id: 'B06',
        label: 'Leadership issues',
        keywords: ['leadership', 'management', 'supervisor', 'boss', 'hierarchy'],
        phrases: ['no support', 'absent leadership', 'no vision'],
        sentiments: ['abandoned', 'alone', 'without guidance']
      },
      B07: {
        id: 'B07',
        label: 'Excessive workload',
        keywords: ['workload', 'overload', 'time', 'availability', 'busy'],
        phrases: ['too much work', 'no time', 'overloaded', 'overwhelmed'],
        sentiments: ['exhausted', 'tired', 'stressed']
      },
      B09: {
        id: 'B09',
        label: 'Lack of communication',
        keywords: ['communication', 'information', 'message', 'coordination'],
        phrases: ['not informed', 'don\'t know', 'nobody tells', 'not aware'],
        sentiments: ['isolated', 'in the dark', 'disconnected']
      }
    }
  },
  sentimentLexicon: {
    fr: {
      positive: ['bien', 'bon', 'excellent', 'satisfait', 'content', 'heureux', 'positif', 'rÃ©ussi', 'efficace', 'utile'],
      negative: ['mal', 'mauvais', 'difficile', 'problÃ¨me', 'Ã©chec', 'frustrÃ©', 'nÃ©gatif', 'impossible', 'inutile', 'pire'],
      neutral: ['normal', 'habituel', 'standard', 'moyen', 'ordinaire']
    },
    en: {
      positive: ['good', 'great', 'excellent', 'satisfied', 'happy', 'positive', 'successful', 'effective', 'useful'],
      negative: ['bad', 'poor', 'difficult', 'problem', 'failure', 'frustrated', 'negative', 'impossible', 'useless', 'worse'],
      neutral: ['normal', 'usual', 'standard', 'average', 'ordinary']
    }
  },
  analyzeText: function (text, lang) {
    lang = lang || 'fr';
    var lexicon = this.barrierLexicon[lang] || this.barrierLexicon.fr;
    var sentiments = this.sentimentLexicon[lang] || this.sentimentLexicon.fr;
    var textLower = text.toLowerCase();
    var words = textLower.split(/\s+/);
    var barriers = [];
    var themes = {};
    var sentiment = {
      positive: 0,
      negative: 0,
      neutral: 0
    };
    var keyQuotes = [];

    // Analyze barriers
    var self = this;
    Object.keys(lexicon).forEach(function (barrierId) {
      var barrier = lexicon[barrierId];
      var score = 0;
      var mentions = [];

      // Check keywords
      barrier.keywords.forEach(function (keyword) {
        var regex = new RegExp('\\b' + keyword + '\\b', 'gi');
        var matches = textLower.match(regex);
        if (matches) {
          score += matches.length;
          mentions.push({
            type: 'keyword',
            term: keyword,
            count: matches.length
          });
        }
      });

      // Check phrases (higher weight)
      barrier.phrases.forEach(function (phrase) {
        if (textLower.indexOf(phrase) !== -1) {
          score += 3;
          mentions.push({
            type: 'phrase',
            term: phrase,
            count: 1
          });
        }
      });

      // Check sentiments
      barrier.sentiments.forEach(function (sent) {
        if (textLower.indexOf(sent) !== -1) {
          score += 0.5;
        }
      });
      if (score > 0) {
        var confidence = Math.min(score / 10, 1);
        barriers.push({
          id: barrier.id,
          label: barrier.label,
          confidence: Math.round(confidence * 100),
          severity: confidence > 0.7 ? 'high' : confidence > 0.4 ? 'medium' : 'low',
          mentions: mentions
        });
      }
    });

    // Sentiment analysis
    words.forEach(function (word) {
      if (sentiments.positive.indexOf(word) !== -1) sentiment.positive++;else if (sentiments.negative.indexOf(word) !== -1) sentiment.negative++;else if (sentiments.neutral.indexOf(word) !== -1) sentiment.neutral++;
    });
    var totalSentiment = sentiment.positive + sentiment.negative + sentiment.neutral;
    if (totalSentiment === 0) totalSentiment = 1;

    // Extract key quotes (sentences with high barrier content)
    var sentences = text.split(/[.!?]+/);
    sentences.forEach(function (sentence) {
      if (sentence.length > 20 && sentence.length < 200) {
        var sentLower = sentence.toLowerCase();
        var hasBarrier = barriers.some(function (b) {
          return b.mentions.some(function (m) {
            return sentLower.indexOf(m.term) !== -1;
          });
        });
        if (hasBarrier && keyQuotes.length < 5) {
          keyQuotes.push(sentence.trim());
        }
      }
    });
    return {
      barriers: barriers.sort(function (a, b) {
        return b.confidence - a.confidence;
      }),
      themes: Object.keys(themes).map(function (t) {
        return {
          name: t,
          count: themes[t]
        };
      }),
      sentiment: {
        positive: Math.round(sentiment.positive / totalSentiment * 100),
        negative: Math.round(sentiment.negative / totalSentiment * 100),
        neutral: Math.round(sentiment.neutral / totalSentiment * 100),
        overall: sentiment.positive > sentiment.negative ? 'positive' : sentiment.negative > sentiment.positive ? 'negative' : 'neutral'
      },
      keyQuotes: keyQuotes,
      wordCount: words.length,
      analyzedAt: new Date().toISOString()
    };
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 4: BENCHMARKING ENGINE (BE) v9.0
// Comparaison anonymisÃ©e avec pool global de projets
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var BenchmarkingEngine = {
  VERSION: '9.0.0',
  anonymousPool: [{
    id: 'P001',
    domain: 'mental_health',
    region: 'SSA',
    income: 'LMIC',
    outcome: 'success',
    adoptionRate: 72,
    fidelityScore: 81,
    strategies: ['S19', 'S08', 'S04'],
    duration: 24
  }, {
    id: 'P002',
    domain: 'mental_health',
    region: 'MENA',
    income: 'UMIC',
    outcome: 'success',
    adoptionRate: 68,
    fidelityScore: 78,
    strategies: ['S01', 'S04', 'S10'],
    duration: 18
  }, {
    id: 'P003',
    domain: 'health',
    region: 'SEA',
    income: 'LMIC',
    outcome: 'partial',
    adoptionRate: 55,
    fidelityScore: 65,
    strategies: ['S01', 'S02'],
    duration: 12
  }, {
    id: 'P004',
    domain: 'education',
    region: 'LAC',
    income: 'UMIC',
    outcome: 'success',
    adoptionRate: 78,
    fidelityScore: 85,
    strategies: ['S04', 'S08', 'S03'],
    duration: 30
  }, {
    id: 'P005',
    domain: 'health',
    region: 'SSA',
    income: 'LIC',
    outcome: 'partial',
    adoptionRate: 45,
    fidelityScore: 58,
    strategies: ['S19', 'S01'],
    duration: 18
  }, {
    id: 'P006',
    domain: 'mental_health',
    region: 'EUR',
    income: 'HIC',
    outcome: 'success',
    adoptionRate: 82,
    fidelityScore: 88,
    strategies: ['S01', 'S02', 'S04', 'S10'],
    duration: 24
  }, {
    id: 'P007',
    domain: 'governance',
    region: 'MENA',
    income: 'UMIC',
    outcome: 'failed',
    adoptionRate: 32,
    fidelityScore: 45,
    strategies: ['S01'],
    duration: 12
  }, {
    id: 'P008',
    domain: 'health',
    region: 'SEA',
    income: 'LMIC',
    outcome: 'success',
    adoptionRate: 65,
    fidelityScore: 72,
    strategies: ['S19', 'S04', 'S08'],
    duration: 24
  }, {
    id: 'P009',
    domain: 'education',
    region: 'SSA',
    income: 'LIC',
    outcome: 'partial',
    adoptionRate: 48,
    fidelityScore: 62,
    strategies: ['S01', 'S03'],
    duration: 18
  }, {
    id: 'P010',
    domain: 'mental_health',
    region: 'LAC',
    income: 'UMIC',
    outcome: 'success',
    adoptionRate: 71,
    fidelityScore: 79,
    strategies: ['S19', 'S04', 'S10', 'S08'],
    duration: 30
  }, {
    id: 'P011',
    domain: 'health',
    region: 'EUR',
    income: 'HIC',
    outcome: 'success',
    adoptionRate: 85,
    fidelityScore: 91,
    strategies: ['S01', 'S02', 'S04', 'S09'],
    duration: 18
  }, {
    id: 'P012',
    domain: 'governance',
    region: 'SEA',
    income: 'LMIC',
    outcome: 'partial',
    adoptionRate: 52,
    fidelityScore: 68,
    strategies: ['S04', 'S03'],
    duration: 24
  }],
  calculateBenchmarks: function (filters) {
    var pool = this.anonymousPool;
    if (filters) {
      if (filters.domain) {
        pool = pool.filter(function (p) {
          return p.domain === filters.domain;
        });
      }
      if (filters.region) {
        pool = pool.filter(function (p) {
          return p.region === filters.region;
        });
      }
      if (filters.income) {
        pool = pool.filter(function (p) {
          return p.income === filters.income;
        });
      }
    }
    if (pool.length < 3) {
      return {
        error: 'Insufficient data for benchmarking (minimum 3 projects required)'
      };
    }
    var adoptionRates = pool.map(function (p) {
      return p.adoptionRate;
    }).sort(function (a, b) {
      return a - b;
    });
    var fidelityScores = pool.map(function (p) {
      return p.fidelityScore;
    }).sort(function (a, b) {
      return a - b;
    });
    var successCount = pool.filter(function (p) {
      return p.outcome === 'success';
    }).length;
    var strategyCount = {};
    pool.forEach(function (p) {
      p.strategies.forEach(function (s) {
        strategyCount[s] = (strategyCount[s] || 0) + 1;
      });
    });
    var topStrategies = Object.keys(strategyCount).sort(function (a, b) {
      return strategyCount[b] - strategyCount[a];
    }).slice(0, 5).map(function (s) {
      return {
        strategy: s,
        count: strategyCount[s],
        percentage: Math.round(strategyCount[s] / pool.length * 100)
      };
    });
    return {
      poolSize: pool.length,
      successRate: Math.round(successCount / pool.length * 100),
      avgAdoptionRate: Math.round(adoptionRates.reduce(function (a, b) {
        return a + b;
      }, 0) / adoptionRates.length),
      avgFidelityScore: Math.round(fidelityScores.reduce(function (a, b) {
        return a + b;
      }, 0) / fidelityScores.length),
      topStrategies: topStrategies,
      percentiles: {
        adoption: {
          p25: adoptionRates[Math.floor(adoptionRates.length * 0.25)],
          p50: adoptionRates[Math.floor(adoptionRates.length * 0.50)],
          p75: adoptionRates[Math.floor(adoptionRates.length * 0.75)]
        },
        fidelity: {
          p25: fidelityScores[Math.floor(fidelityScores.length * 0.25)],
          p50: fidelityScores[Math.floor(fidelityScores.length * 0.50)],
          p75: fidelityScores[Math.floor(fidelityScores.length * 0.75)]
        }
      }
    };
  },
  compareToPool: function (project) {
    var benchmarks = this.calculateBenchmarks({
      domain: project.domain
    });
    if (benchmarks.error) {
      benchmarks = this.calculateBenchmarks(null);
    }
    var projectAdoption = project.adoptionRate || project.predictedAdoption || 60;
    var projectFidelity = project.fidelityScore || project.predictedFidelity || 70;
    var adoptionVsAvg = projectAdoption - benchmarks.avgAdoptionRate;
    var fidelityVsAvg = projectFidelity - benchmarks.avgFidelityScore;

    // Calculate percentile rank
    var pool = this.anonymousPool;
    var belowCount = pool.filter(function (p) {
      return p.adoptionRate < projectAdoption;
    }).length;
    var percentileRank = Math.round(belowCount / pool.length * 100);
    var category = 'Average';
    if (percentileRank >= 75) category = 'Excellence';else if (percentileRank >= 50) category = 'Above Average';else if (percentileRank >= 25) category = 'Below Average';else category = 'Needs Improvement';

    // Generate insights
    var insights = [];
    if (adoptionVsAvg < -10) {
      insights.push({
        type: 'performance_gap',
        priority: 'high',
        message: {
          fr: 'Taux d\'adoption infÃ©rieur de ' + Math.abs(adoptionVsAvg) + '% Ã  la moyenne du pool',
          en: 'Adoption rate ' + Math.abs(adoptionVsAvg) + '% below pool average'
        }
      });
    }
    var projectStrategies = project.strategies || [];
    benchmarks.topStrategies.forEach(function (ts) {
      if (ts.percentage > 70 && projectStrategies.indexOf(ts.strategy) === -1) {
        insights.push({
          type: 'strategy_gap',
          priority: 'medium',
          message: {
            fr: 'StratÃ©gie ' + ts.strategy + ' utilisÃ©e par ' + ts.percentage + '% des projets Ã  succÃ¨s mais absente de votre projet',
            en: 'Strategy ' + ts.strategy + ' used by ' + ts.percentage + '% of successful projects but missing from yours'
          }
        });
      }
    });
    return {
      vsAverage: {
        adoption: (adoptionVsAvg >= 0 ? '+' : '') + adoptionVsAvg + '%',
        fidelity: (fidelityVsAvg >= 0 ? '+' : '') + fidelityVsAvg + '%'
      },
      percentileRank: percentileRank,
      category: category,
      insights: insights,
      benchmarks: benchmarks
    };
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 5: DIGITAL TWIN MODULE (DTM) v9.0
// ModÃ©lisation organisationnelle pour prÃ©diction de prÃ©cision chirurgicale
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var DigitalTwinModule = {
  VERSION: '9.0.0',
  constraintTypes: {
    MAX_TRAINEES_PER_MONTH: {
      id: 'maxTraineesPerMonth',
      label: {
        fr: 'Max formÃ©s/mois',
        en: 'Max trainees/month'
      },
      default: 20,
      unit: 'persons'
    },
    MAX_SIMULTANEOUS_SITES: {
      id: 'maxSimultaneousSites',
      label: {
        fr: 'Max sites simultanÃ©s',
        en: 'Max simultaneous sites'
      },
      default: 3,
      unit: 'sites'
    },
    LEADERSHIP_BANDWIDTH: {
      id: 'leadershipBandwidth',
      label: {
        fr: 'DisponibilitÃ© leadership',
        en: 'Leadership bandwidth'
      },
      default: 0.5,
      unit: 'ratio'
    },
    TECH_READINESS: {
      id: 'techReadiness',
      label: {
        fr: 'MaturitÃ© technologique',
        en: 'Tech readiness'
      },
      default: 0.6,
      unit: 'ratio'
    },
    BUDGET_FLEXIBILITY: {
      id: 'budgetFlexibility',
      label: {
        fr: 'FlexibilitÃ© budgÃ©taire',
        en: 'Budget flexibility'
      },
      default: 0.3,
      unit: 'ratio'
    },
    STAFF_AVAILABILITY: {
      id: 'staffAvailability',
      label: {
        fr: 'DisponibilitÃ© du personnel',
        en: 'Staff availability'
      },
      default: 0.7,
      unit: 'ratio'
    },
    SUSTAINMENT_RISK: {
      id: 'sustainmentRisk',
      label: {
        fr: 'Risque de pÃ©rennitÃ©',
        en: 'Sustainment risk'
      },
      default: 0.4,
      unit: 'ratio'
    }
  },
  createDigitalTwin: function (orgData) {
    var twin = {
      id: 'DT_' + Date.now(),
      name: orgData.name || 'Organization',
      createdAt: new Date().toISOString(),
      structure: {
        totalStaff: orgData.totalStaff || 100,
        departments: orgData.departments || 5,
        sites: orgData.sites || 1,
        hierarchyLevels: orgData.hierarchyLevels || 4
      },
      resources: {
        annualBudget: orgData.annualBudget || 500000,
        implementationBudget: orgData.implementationBudget || 100000,
        dedicatedFTE: orgData.dedicatedFTE || 2
      },
      culture: {
        changeReadiness: orgData.changeReadiness || 0.5,
        innovationHistory: orgData.innovationHistory || 0.5,
        leadershipSupport: orgData.leadershipSupport || 0.6
      },
      constraints: {
        maxTraineesPerMonth: orgData.maxTraineesPerMonth || 20,
        maxSimultaneousSites: orgData.maxSimultaneousSites || 3,
        leadershipBandwidth: orgData.leadershipBandwidth || 0.5,
        techReadiness: orgData.techReadiness || 0.6,
        budgetFlexibility: orgData.budgetFlexibility || 0.3,
        staffAvailability: orgData.staffAvailability || 0.7,
        sustainmentRisk: orgData.sustainmentRisk || 0.4
      }
    };
    twin.maturityScore = this.calculateMaturityScore(twin);
    return twin;
  },
  calculateMaturityScore: function (twin) {
    var score = 0;

    // Structure score (25 points)
    if (twin.structure.totalStaff > 50) score += 10;
    if (twin.structure.departments >= 3) score += 8;
    if (twin.structure.sites >= 2) score += 7;

    // Resources score (25 points)
    if (twin.resources.implementationBudget > 50000) score += 10;
    if (twin.resources.dedicatedFTE >= 2) score += 8;
    if (twin.resources.annualBudget > 200000) score += 7;

    // Culture score (25 points)
    score += Math.round(twin.culture.changeReadiness * 10);
    score += Math.round(twin.culture.innovationHistory * 8);
    score += Math.round(twin.culture.leadershipSupport * 7);

    // Constraints score (25 points - inverse of risk)
    score += Math.round((1 - twin.constraints.sustainmentRisk) * 10);
    score += Math.round(twin.constraints.techReadiness * 8);
    score += Math.round(twin.constraints.staffAvailability * 7);
    return Math.min(100, Math.max(0, score));
  },
  runConstrainedMonteCarlo: function (project, strategies, digitalTwin, iterations) {
    iterations = iterations || 5000;
    var self = this;
    var results = [];
    var constraints = digitalTwin.constraints;
    for (var i = 0; i < iterations; i++) {
      // Base success probability from project
      var baseSuccess = project.predictedSuccess || 0.65;

      // Apply constraint adjustments
      if (constraints.budgetFlexibility < 0.2) {
        baseSuccess *= 0.85;
      }
      if (constraints.leadershipBandwidth < 0.3) {
        baseSuccess *= 0.8;
      }
      if (constraints.techReadiness < 0.5 && strategies.some(function (s) {
        return ['S13', 'S05'].indexOf(s) !== -1;
      })) {
        baseSuccess *= 0.75;
      }
      if (constraints.staffAvailability < 0.5) {
        baseSuccess *= 0.85;
      }
      if (constraints.sustainmentRisk > 0.7) {
        baseSuccess *= 0.80;
      }

      // Add culture bonus
      baseSuccess *= 0.9 + digitalTwin.culture.changeReadiness * 0.2;
      baseSuccess *= 0.95 + digitalTwin.culture.leadershipSupport * 0.1;

      // Add random variance
      var variance = (Math.random() - 0.5) * 0.2;
      var finalSuccess = Math.max(0, Math.min(1, baseSuccess + variance));

      // Calculate adoption rate with constraints
      var baseAdoption = 70;
      var traineeConstraint = constraints.maxTraineesPerMonth / 20;
      var siteConstraint = constraints.maxSimultaneousSites / 3;
      var adoptionRate = baseAdoption * traineeConstraint * siteConstraint * (0.9 + Math.random() * 0.2);
      results.push({
        success: finalSuccess > 0.5,
        successProbability: finalSuccess,
        adoptionRate: Math.round(adoptionRate)
      });
    }
    var successCount = results.filter(function (r) {
      return r.success;
    }).length;
    var adoptionRates = results.map(function (r) {
      return r.adoptionRate;
    }).sort(function (a, b) {
      return a - b;
    });
    var mean = adoptionRates.reduce(function (a, b) {
      return a + b;
    }, 0) / adoptionRates.length;
    var variance = adoptionRates.reduce(function (a, b) {
      return a + Math.pow(b - mean, 2);
    }, 0) / adoptionRates.length;
    var stdDev = Math.sqrt(variance);

    // Identify risk factors
    var riskFactors = [];
    if (constraints.budgetFlexibility < 0.2) {
      riskFactors.push({
        factor: 'budgetFlexibility',
        severity: 'high',
        message: {
          fr: 'FlexibilitÃ© budgÃ©taire trÃ¨s faible',
          en: 'Very low budget flexibility'
        }
      });
    }
    if (constraints.leadershipBandwidth < 0.3) {
      riskFactors.push({
        factor: 'leadershipBandwidth',
        severity: 'high',
        message: {
          fr: 'DisponibilitÃ© leadership insuffisante',
          en: 'Insufficient leadership bandwidth'
        }
      });
    }
    if (constraints.sustainmentRisk > 0.6) {
      riskFactors.push({
        factor: 'sustainmentRisk',
        severity: 'medium',
        message: {
          fr: 'Risque de pÃ©rennitÃ© Ã©levÃ©',
          en: 'High sustainment risk'
        }
      });
    }
    if (constraints.techReadiness < 0.4) {
      riskFactors.push({
        factor: 'techReadiness',
        severity: 'medium',
        message: {
          fr: 'MaturitÃ© technologique faible',
          en: 'Low tech readiness'
        }
      });
    }
    return {
      iterations: iterations,
      successProbability: Math.round(successCount / iterations * 100),
      adoption: {
        mean: Math.round(mean),
        median: adoptionRates[Math.floor(adoptionRates.length / 2)],
        stdDev: Math.round(stdDev * 10) / 10,
        p10: adoptionRates[Math.floor(adoptionRates.length * 0.1)],
        p25: adoptionRates[Math.floor(adoptionRates.length * 0.25)],
        p75: adoptionRates[Math.floor(adoptionRates.length * 0.75)],
        p90: adoptionRates[Math.floor(adoptionRates.length * 0.9)]
      },
      riskFactors: riskFactors,
      maturityScore: digitalTwin.maturityScore,
      simulatedAt: new Date().toISOString()
    };
  }
};

// Configuration Supabase (auth + stockage cloud)
// Remplacez les valeurs ci-dessous par celles de votre projet Supabase
var SUPABASE_URL = window.MOUDAR_SUPABASE && window.MOUDAR_SUPABASE.url || "https://YOUR-PROJECT.supabase.co";
var SUPABASE_ANON_KEY = window.MOUDAR_SUPABASE && window.MOUDAR_SUPABASE.anonKey || "YOUR-ANON-KEY";
var supabaseClient = null;
if (typeof window !== "undefined" && window.supabase && SUPABASE_URL && SUPABASE_ANON_KEY && SUPABASE_ANON_KEY !== "YOUR-ANON-KEY") {
  try {
    supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log("[MOUDAR] Supabase initialisÃ©");
  } catch (e) {
    console.warn("[MOUDAR] Erreur d'initialisation Supabase:", e);
  }
}
function getSupabaseUser() {
  if (!supabaseClient || !supabaseClient.auth) return null;
  try {
    return supabaseClient.auth.user();
  } catch (e) {
    return null;
  }
}
function moudarSyncProjectToSupabase(project) {
  if (!supabaseClient || !project) return;
  var user = getSupabaseUser();
  if (!user) return;
  var payload = {
    id: project.id,
    user_id: user.id,
    title: project.title || "",
    description: project.description || project.shortDescription || "",
    domain: project.domain || null,
    context: project.context || "",
    phase: project.phase || null,
    resource_level: project.resourceLevel || project.resource_level || null,
    barriers: project.barriers || [],
    objectives: project.objectives || [],
    status: project.status || null,
    engine_version: "8.5.0"
  };
  supabaseClient.from("projects").upsert(payload).then(function (result) {
    if (result.error) {
      console.error("[MOUDAR] Supabase sync error", result.error);
    }
  });
}

// Configuration API backend Moudar (IA)
// Cloud API configuration (reads from MOUDAR.API, not window globals)
var MOUDAR_API_BASE = (typeof MOUDAR !== 'undefined' && MOUDAR.API ? MOUDAR.API.base : "").trim();
var MOUDAR_API_KEY = (typeof MOUDAR !== 'undefined' && MOUDAR.API ? MOUDAR.API.key : "").trim();

// Cloud/IA calls are opt-in: prompt for configuration if not set.
function ensureCloudAIConfig() {
  try {
    // Refresh from localStorage (in case user configured after page load)
    if (!MOUDAR_API_BASE) {
      var storedBase = (sessionStorage.getItem('MOUDAR_API_BASE') || '').trim();
      if (storedBase) MOUDAR_API_BASE = storedBase;
    }
    if (!MOUDAR_API_KEY) {
      var storedKey = (sessionStorage.getItem('MOUDAR_API_KEY') || '').trim();
      if (storedKey) MOUDAR_API_KEY = storedKey;
    }
    if (!MOUDAR_API_BASE) {
      var ok = window.confirm(`Les fonctions Cloud/IA ne sont pas configurÃ©es. Voulez-vous les activer maintenant ?

Aucune donnÃ©e n'est envoyÃ©e tant que vous n'activez pas explicitement ces fonctions.`);
      if (!ok) return null;
      var base = window.prompt("URL de l'API MOUDAR (ex: https://â€¦/api/v1) :", "");
      if (!base) return null;
      base = String(base).trim().replace(/\/+$/, "");
      var key = window.prompt("ClÃ© API (optionnelle) :", "") || "";
      key = String(key).trim();
      sessionStorage.setItem('MOUDAR_API_BASE', base);
      sessionStorage.setItem('MOUDAR_API_KEY', key);
      MOUDAR_API_BASE = base;
      MOUDAR_API_KEY = key;
    }
    return {
      base: MOUDAR_API_BASE,
      key: MOUDAR_API_KEY
    };
  } catch (e) {
    return null;
  }
}
function safeMoudarFetch(path, options) {
  var cfg = ensureCloudAIConfig();
  if (!cfg) {
    return Promise.reject(new Error("Cloud/IA dÃ©sactivÃ©e"));
  }
  var url = cfg.base.replace(/\/+$/, "") + path;
  var opts = options || {};
  opts.headers = opts.headers || {};
  if (cfg.key && !opts.headers["Authorization"]) {
    opts.headers["Authorization"] = "Bearer " + cfg.key;
  }
  return fetch(url, opts);
}
// ============================================
// STORAGE MANAGER - Sauvegarde complÃ¨te avec protocole et diagnostic
// ============================================
var StorageManager = {
  getProjects: function () {
    try {
      return JSON.parse(localStorage.getItem("moudar_projects") || "[]");
    } catch (e) {
      return [];
    }
  },
  saveProject: function (project) {
    var projects = this.getProjects();
    var idx = projects.findIndex(function (p) {
      return p.id === project.id;
    });
    var now = new Date().toISOString();
    var finalProject;
    if (idx >= 0) {
      finalProject = Object.assign({}, projects[idx], project, {
        updatedAt: now
      });
      projects[idx] = finalProject;
    } else {
      finalProject = Object.assign({}, project, {
        id: Date.now().toString(),
        createdAt: now,
        updatedAt: now,
        status: "draft"
      });
      projects.push(finalProject);
    }
    localStorage.setItem("moudar_projects", JSON.stringify(projects));
    try {
      moudarSyncProjectToSupabase(finalProject);
    } catch (e) {
      console.warn("[MOUDAR] Sync Supabase Ã©chouÃ©e (non bloquant)", e);
    }
    return finalProject;
  },
  deleteProject: function (id) {
    var projects = this.getProjects().filter(function (p) {
      return p.id !== id;
    });
    localStorage.setItem("moudar_projects", JSON.stringify(projects));
    return projects;
  },
  updateProjectStatus: function (id, status) {
    var projects = this.getProjects();
    var idx = projects.findIndex(function (p) {
      return p.id === id;
    });
    if (idx >= 0) {
      projects[idx].status = status;
      projects[idx].updatedAt = new Date().toISOString();
      localStorage.setItem("moudar_projects", JSON.stringify(projects));
    }
    return projects;
  },
  attachDiagnostic: function (projectId, diagnosticResults) {
    var projects = this.getProjects();
    var idx = projects.findIndex(function (p) {
      return p.id === projectId;
    });
    if (idx >= 0) {
      projects[idx].diagnostic = {
        scores: diagnosticResults.scores,
        global: diagnosticResults.global,
        strengths: diagnosticResults.strengths,
        watchpoints: diagnosticResults.watchpoints,
        priorities: diagnosticResults.priorities,
        date: new Date().toISOString()
      };
      projects[idx].status = "diagnosed";
      projects[idx].updatedAt = new Date().toISOString();
      localStorage.setItem("moudar_projects", JSON.stringify(projects));
    }
    return projects;
  },
  getProject: function (id) {
    return this.getProjects().find(function (p) {
      return p.id === id;
    });
  },
  // Dupliquer un projet existant
  duplicateProject: function (id) {
    var original = this.getProject(id);
    if (!original) return null;
    var now = new Date().toISOString();
    var duplicate = Object.assign({}, JSON.parse(JSON.stringify(original)), {
      id: Date.now().toString(),
      title: original.title + " (copie)",
      createdAt: now,
      updatedAt: now,
      status: "draft",
      diagnostic: null,
      // RÃ©initialiser le diagnostic
      aiProtocol: null // RÃ©initialiser le protocole IA
    });
    var projects = this.getProjects();
    projects.push(duplicate);
    localStorage.setItem("moudar_projects", JSON.stringify(projects));
    return duplicate;
  },
  // Exporter un projet en JSON
  exportProject: function (id, format) {
    var project = this.getProject(id);
    if (!project) return null;
    var exportData = {
      exportedAt: new Date().toISOString(),
      exportFormat: format || 'json',
      moudarVersion: MoudarEngine.VERSION,
      project: project,
      metadata: {
        domain: project.domain,
        phase: project.phase,
        status: project.status,
        hasDiagnostic: !!project.diagnostic,
        hasAIProtocol: !!project.aiProtocol
      }
    };
    if (format === 'csv') {
      // Format CSV pour recherche
      var csvLines = ['field,value', 'id,' + project.id, 'title,"' + (project.title || '').replace(/"/g, '""') + '"', 'domain,' + (project.domain || ''), 'phase,' + (project.phase || ''), 'status,' + (project.status || ''), 'createdAt,' + (project.createdAt || ''), 'updatedAt,' + (project.updatedAt || '')];
      if (project.diagnostic) {
        csvLines.push('diagnostic_global,' + (project.diagnostic.global || ''));
        Object.keys(project.diagnostic.scores || {}).forEach(function (key) {
          csvLines.push('score_' + key + ',' + project.diagnostic.scores[key]);
        });
      }
      if (project.aiProtocol && project.aiProtocol.strategies) {
        project.aiProtocol.strategies.forEach(function (s, i) {
          csvLines.push('strategy_' + (i + 1) + ',"' + (s.name || s.id) + '"');
        });
      }
      return csvLines.join('\n');
    }
    return JSON.stringify(exportData, null, 2);
  },
  // Exporter tous les projets (pour backup ou recherche)
  exportAllProjects: function (format) {
    var projects = this.getProjects();
    var exportData = {
      exportedAt: new Date().toISOString(),
      moudarVersion: MoudarEngine.VERSION,
      totalProjects: projects.length,
      projects: projects
    };
    if (format === 'csv') {
      var headers = ['id', 'title', 'domain', 'phase', 'status', 'createdAt', 'hasDiagnostic', 'diagnosticScore'];
      var csvLines = [headers.join(',')];
      projects.forEach(function (p) {
        csvLines.push([p.id, '"' + (p.title || '').replace(/"/g, '""') + '"', p.domain || '', p.phase || '', p.status || '', p.createdAt || '', p.diagnostic ? 'true' : 'false', p.diagnostic ? p.diagnostic.global || '' : ''].join(','));
      });
      return csvLines.join('\n');
    }
    return JSON.stringify(exportData, null, 2);
  },
  // Statistiques des projets
  getProjectStats: function () {
    var projects = this.getProjects();
    var stats = {
      total: projects.length,
      byStatus: {
        draft: 0,
        protocol: 0,
        diagnosed: 0
      },
      byDomain: {},
      withDiagnostic: 0,
      withAIProtocol: 0,
      avgDiagnosticScore: 0,
      recentActivity: null
    };
    var diagScores = [];
    projects.forEach(function (p) {
      stats.byStatus[p.status] = (stats.byStatus[p.status] || 0) + 1;
      stats.byDomain[p.domain] = (stats.byDomain[p.domain] || 0) + 1;
      if (p.diagnostic) {
        stats.withDiagnostic++;
        if (p.diagnostic.global) diagScores.push(p.diagnostic.global);
      }
      if (p.aiProtocol) stats.withAIProtocol++;
    });
    if (diagScores.length > 0) {
      stats.avgDiagnosticScore = (diagScores.reduce(function (a, b) {
        return a + b;
      }, 0) / diagScores.length).toFixed(1);
    }
    if (projects.length > 0) {
      var sorted = projects.sort(function (a, b) {
        return new Date(b.updatedAt) - new Date(a.updatedAt);
      });
      stats.recentActivity = sorted[0].updatedAt;
    }
    return stats;
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MOUDAR v8.1 - NOUVEAUX MODULES D'AMÃ‰LIORATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 1. MOUDAR DATA MANAGER - Export/Import robuste avec format .moudar
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var MoudarDataManager = {
  VERSION: '1.0.0',
  FILE_EXTENSION: '.moudar',
  MAGIC_HEADER: 'MOUDAR_PROJECT_V1',
  generateChecksum: function (data) {
    var str = JSON.stringify(data);
    var hash = 0;
    for (var i = 0; i < str.length; i++) {
      var char = str.charCodeAt(i);
      hash = (hash << 5) - hash + char;
      hash = hash & hash;
    }
    return Math.abs(hash).toString(16);
  },
  encodeData: function (data) {
    try {
      var jsonStr = JSON.stringify(data);
      return btoa(unescape(encodeURIComponent(jsonStr)));
    } catch (e) {
      return null;
    }
  },
  decodeData: function (encoded) {
    try {
      var jsonStr = decodeURIComponent(escape(atob(encoded)));
      return JSON.parse(jsonStr);
    } catch (e) {
      return null;
    }
  },
  exportProject: function (project, options) {
    options = options || {};
    var exportPackage = {
      header: this.MAGIC_HEADER,
      version: this.VERSION,
      exportedAt: new Date().toISOString(),
      moudarVersion: MoudarEngine.VERSION || '8.1',
      projectData: project,
      metadata: {
        title: project.title || 'Sans titre',
        domain: project.domain || null,
        phase: project.phase || null,
        status: project.status || 'draft',
        hasDiagnostic: !!project.diagnostic,
        hasProtocol: !!project.protocol || !!project.aiProtocol,
        strategiesCount: project.protocol && project.protocol.strategies ? project.protocol.strategies.length : 0
      }
    };
    exportPackage.checksum = this.generateChecksum(exportPackage.projectData);
    return {
      format: 'json',
      data: JSON.stringify(exportPackage, null, 2),
      filename: this.sanitizeFilename(project.title) + this.FILE_EXTENSION
    };
  },
  exportAllProjects: function (options) {
    options = options || {};
    var projects = StorageManager.getProjects();
    var exportPackage = {
      header: this.MAGIC_HEADER + '_BACKUP',
      version: this.VERSION,
      exportedAt: new Date().toISOString(),
      moudarVersion: MoudarEngine.VERSION || '8.1',
      totalProjects: projects.length,
      projects: projects,
      settings: {
        lang: localStorage.getItem('moudar_lang') || 'fr',
        theme: localStorage.getItem('moudar_theme') || 'light'
      },
      learningData: {
        feedback: JSON.parse(localStorage.getItem('moudar_feedback') || '[]'),
        learningState: JSON.parse(localStorage.getItem('moudar_learning_state') || 'null')
      }
    };
    exportPackage.checksum = this.generateChecksum(exportPackage.projects);
    return {
      format: 'json',
      data: JSON.stringify(exportPackage, null, 2),
      filename: 'MOUDAR_BACKUP_' + new Date().toISOString().split('T')[0] + this.FILE_EXTENSION
    };
  },
  importProject: function (fileContent, options) {
    options = options || {};
    var result = {
      success: false,
      project: null,
      error: null,
      warnings: []
    };
    try {
      var data;
      try {
        data = JSON.parse(fileContent);
      } catch (e) {
        data = this.decodeData(fileContent);
        if (!data) {
          result.error = 'Format de fichier invalide';
          return result;
        }
      }
      if (!data.header || !data.header.startsWith('MOUDAR_PROJECT')) {
        result.error = 'Ce fichier n\'est pas un projet MOUDAR valide';
        return result;
      }
      if (data.checksum) {
        var computedChecksum = this.generateChecksum(data.projectData || data.projects);
        if (computedChecksum !== data.checksum) {
          result.warnings.push('Le fichier semble avoir Ã©tÃ© modifiÃ©.');
        }
      }
      if (data.projectData) {
        var project = data.projectData;
        if (options.generateNewId || StorageManager.getProject(project.id)) {
          project.id = Date.now().toString();
          project.title = project.title + ' (importÃ©)';
        }
        project.importedAt = new Date().toISOString();
        var saved = StorageManager.saveProject(project);
        result.success = true;
        result.project = saved;
        result.isBackup = false;
      } else if (data.projects && Array.isArray(data.projects)) {
        var importedCount = 0;
        data.projects.forEach(function (project) {
          if (options.skipExisting && StorageManager.getProject(project.id)) return;
          if (options.generateNewIds || StorageManager.getProject(project.id)) {
            project.id = Date.now().toString() + '_' + Math.random().toString(36).substr(2, 5);
          }
          project.importedAt = new Date().toISOString();
          StorageManager.saveProject(project);
          importedCount++;
        });
        if (data.settings && options.restoreSettings) {
          if (data.settings.lang) localStorage.setItem('moudar_lang', data.settings.lang);
        }
        if (data.learningData && options.restoreLearning) {
          if (data.learningData.feedback) localStorage.setItem('moudar_feedback', JSON.stringify(data.learningData.feedback));
        }
        result.success = true;
        result.isBackup = true;
        result.importedCount = importedCount;
        result.totalInBackup = data.projects.length;
      }
    } catch (e) {
      result.error = 'Erreur lors de l\'import: ' + e.message;
    }
    return result;
  },
  sanitizeFilename: function (name) {
    if (!name) return 'projet_moudar';
    return name.toLowerCase().replace(/[Ã Ã¡Ã¢Ã£Ã¤Ã¥]/g, 'a').replace(/[Ã¨Ã©ÃªÃ«]/g, 'e').replace(/[Ã¬Ã­Ã®Ã¯]/g, 'i').replace(/[Ã²Ã³Ã´ÃµÃ¶]/g, 'o').replace(/[Ã¹ÃºÃ»Ã¼]/g, 'u').replace(/[Ã§]/g, 'c').replace(/[^a-z0-9]/g, '_').replace(/_+/g, '_').substring(0, 50);
  },
  downloadFile: function (content, filename, mimeType) {
    mimeType = mimeType || 'application/json';
    var blob = new Blob([content], {
      type: mimeType
    });
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  },
  readFile: function (file, callback) {
    var reader = new FileReader();
    reader.onload = function (e) {
      callback(null, e.target.result);
    };
    reader.onerror = function (e) {
      callback(new Error('Erreur de lecture'), null);
    };
    reader.readAsText(file);
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 2. ONBOARDING WIZARD - Assistant de dÃ©marrage interactif
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var OnboardingWizard = {
  STORAGE_KEY: 'moudar_onboarding_completed',
  isCompleted: function () {
    return localStorage.getItem(this.STORAGE_KEY) === 'true';
  },
  markCompleted: function () {
    localStorage.setItem(this.STORAGE_KEY, 'true');
  },
  reset: function () {
    localStorage.removeItem(this.STORAGE_KEY);
  },
  getSteps: function (lang) {
    var l = lang || 'fr';
    return [{
      id: 'welcome',
      icon: 'ðŸ‘‹',
      title: l === 'fr' ? 'Bienvenue sur MOUDAR' : 'Welcome to MOUDAR',
      subtitle: l === 'fr' ? 'Votre copilote IA pour la Science de l\'ImplÃ©mentation' : 'Your AI copilot for Implementation Science',
      content: l === 'fr' ? 'MOUDAR vous aide Ã  concevoir des projets de changement efficaces en utilisant les meilleures pratiques scientifiques.' : 'MOUDAR helps you design effective change projects using scientific best practices.',
      showSkip: true
    }, {
      id: 'profile',
      type: 'choice',
      icon: 'ðŸ‘¤',
      title: l === 'fr' ? 'Quel est votre profil ?' : 'What is your profile?',
      subtitle: l === 'fr' ? 'Cela nous permet d\'adapter l\'interface' : 'This helps us adapt the interface',
      choices: [{
        id: 'researcher',
        icon: 'ðŸ”¬',
        label: l === 'fr' ? 'Chercheur' : 'Researcher',
        description: l === 'fr' ? 'Protocoles de recherche' : 'Research protocols'
      }, {
        id: 'manager',
        icon: 'ðŸ‘”',
        label: l === 'fr' ? 'Gestionnaire' : 'Manager',
        description: l === 'fr' ? 'Pilotage de projets' : 'Project management'
      }, {
        id: 'clinician',
        icon: 'âš•ï¸',
        label: l === 'fr' ? 'Professionnel terrain' : 'Field professional',
        description: l === 'fr' ? 'Pratiques cliniques' : 'Clinical practices'
      }, {
        id: 'decider',
        icon: 'ðŸ›ï¸',
        label: l === 'fr' ? 'DÃ©cideur' : 'Decision maker',
        description: l === 'fr' ? 'Politiques et stratÃ©gies' : 'Policies'
      }]
    }, {
      id: 'objective',
      type: 'choice',
      icon: 'ðŸŽ¯',
      title: l === 'fr' ? 'Votre objectif principal ?' : 'Your main objective?',
      subtitle: l === 'fr' ? 'Nous activerons les modules pertinents' : 'We\'ll activate relevant modules',
      choices: [{
        id: 'design',
        icon: 'ðŸ“',
        label: l === 'fr' ? 'Concevoir un projet' : 'Design a project',
        description: l === 'fr' ? 'Partir de zÃ©ro' : 'Start from scratch'
      }, {
        id: 'analyze',
        icon: 'ðŸ”',
        label: l === 'fr' ? 'Analyser un protocole' : 'Analyze a protocol',
        description: l === 'fr' ? 'Ã‰valuer un document' : 'Evaluate a document'
      }, {
        id: 'evaluate',
        icon: 'ðŸ“Š',
        label: l === 'fr' ? 'Diagnostiquer' : 'Diagnose',
        description: l === 'fr' ? 'Ã‰valuer la maturitÃ©' : 'Assess maturity'
      }, {
        id: 'explore',
        icon: 'ðŸ§­',
        label: l === 'fr' ? 'Explorer l\'outil' : 'Explore the tool',
        description: l === 'fr' ? 'DÃ©couvrir tout' : 'Discover all'
      }]
    }, {
      id: 'features',
      type: 'tour',
      icon: 'âš¡',
      title: l === 'fr' ? 'Les fonctionnalitÃ©s clÃ©s' : 'Key features',
      features: [{
        icon: 'ðŸ§™â€â™‚ï¸',
        title: l === 'fr' ? 'Assistant Projet' : 'Project Wizard',
        description: l === 'fr' ? '7 questions pour crÃ©er votre protocole' : '7 questions to create your protocol'
      }, {
        icon: 'ðŸŽ¯',
        title: l === 'fr' ? 'StratÃ©gies ERIC' : 'ERIC Strategies',
        description: l === 'fr' ? '20 stratÃ©gies Ã©valuÃ©es par l\'IA' : '20 AI-evaluated strategies'
      }, {
        icon: 'ðŸ“‹',
        title: l === 'fr' ? 'Cadres CFIR & RE-AIM' : 'CFIR & RE-AIM',
        description: l === 'fr' ? '39 critÃ¨res d\'Ã©valuation' : '39 evaluation criteria'
      }, {
        icon: 'ðŸ†',
        title: l === 'fr' ? 'Certification' : 'Certification',
        description: l === 'fr' ? 'Label Moudar Ready' : 'Moudar Ready label'
      }]
    }, {
      id: 'ready',
      icon: 'ðŸš€',
      title: l === 'fr' ? 'Vous Ãªtes prÃªt !' : 'You\'re ready!',
      content: l === 'fr' ? 'Commencez par crÃ©er votre premier projet ou explorez les cas d\'Ã©tude.' : 'Start by creating your first project or explore case studies.',
      actions: [{
        id: 'create',
        label: l === 'fr' ? 'CrÃ©er un projet' : 'Create a project',
        primary: true
      }, {
        id: 'cases',
        label: l === 'fr' ? 'Voir les cas d\'Ã©tude' : 'View case studies',
        primary: false
      }]
    }];
  },
  savePreferences: function (preferences) {
    localStorage.setItem('moudar_user_profile', preferences.profile || 'researcher');
    localStorage.setItem('moudar_user_objective', preferences.objective || 'explore');
  },
  getPreferences: function () {
    return {
      profile: localStorage.getItem('moudar_user_profile') || null,
      objective: localStorage.getItem('moudar_user_objective') || null
    };
  }
};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// 3. INTERACTIVE CHARTS - Graphiques budget et timeline
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var InteractiveCharts = {
  generateBudgetPieData: function (budget, lang) {
    var l = lang || 'fr';
    if (!budget || !budget.breakdown) return null;
    var categories = {
      personnel: {
        label: l === 'fr' ? 'Personnel' : 'Personnel',
        color: '#3b82f6'
      },
      equipment: {
        label: l === 'fr' ? 'Ã‰quipement' : 'Equipment',
        color: '#10b981'
      },
      training: {
        label: l === 'fr' ? 'Formation' : 'Training',
        color: '#f59e0b'
      },
      materials: {
        label: l === 'fr' ? 'MatÃ©riel' : 'Materials',
        color: '#8b5cf6'
      },
      overhead: {
        label: l === 'fr' ? 'Frais gÃ©nÃ©raux' : 'Overhead',
        color: '#6b7280'
      },
      contingency: {
        label: l === 'fr' ? 'Contingence' : 'Contingency',
        color: '#ef4444'
      }
    };
    var data = [];
    var total = 0;
    Object.keys(budget.breakdown).forEach(function (key) {
      total += budget.breakdown[key] || 0;
    });
    Object.keys(budget.breakdown).forEach(function (key) {
      var value = budget.breakdown[key] || 0;
      if (value > 0 && categories[key]) {
        data.push({
          category: key,
          label: categories[key].label,
          value: value,
          percentage: Math.round(value / total * 100),
          color: categories[key].color
        });
      }
    });
    data.sort(function (a, b) {
      return b.value - a.value;
    });
    return {
      data: data,
      total: total,
      currency: budget.currency || 'EUR'
    };
  },
  generateGanttData: function (timeline, lang) {
    var l = lang || 'fr';
    if (!timeline || !timeline.phases) return null;
    var phaseColors = {
      exploration: '#3b82f6',
      preparation: '#f59e0b',
      implementation: '#10b981',
      sustainment: '#8b5cf6'
    };
    var phaseLabels = {
      exploration: {
        fr: 'Exploration',
        en: 'Exploration'
      },
      preparation: {
        fr: 'PrÃ©paration',
        en: 'Preparation'
      },
      implementation: {
        fr: 'ImplÃ©mentation',
        en: 'Implementation'
      },
      sustainment: {
        fr: 'PÃ©rennisation',
        en: 'Sustainment'
      }
    };
    var ganttData = [];
    var startMonth = 0;
    timeline.phases.forEach(function (phase, index) {
      var phaseId = phase.id || phase.name || 'phase_' + index;
      var duration = phase.duration || 6;
      ganttData.push({
        id: phaseId,
        label: phaseLabels[phaseId] && phaseLabels[phaseId][l] || phase.name || phaseId,
        start: startMonth,
        duration: duration,
        end: startMonth + duration,
        color: phaseColors[phaseId] || '#6b7280',
        milestones: phase.milestones || [],
        activities: phase.activities || []
      });
      startMonth += duration;
    });
    return {
      phases: ganttData,
      totalDuration: startMonth,
      unit: l === 'fr' ? 'mois' : 'months'
    };
  },
  generateProgressData: function (project, lang) {
    var l = lang || 'fr';
    var data = {
      overall: 0,
      sections: []
    };
    var sections = [{
      id: 'basics',
      label: l === 'fr' ? 'Informations de base' : 'Basic info',
      fields: ['title', 'domain', 'context', 'country'],
      weight: 15
    }, {
      id: 'population',
      label: l === 'fr' ? 'Population & Objectifs' : 'Population & Goals',
      fields: ['population', 'targets', 'objectives'],
      weight: 15
    }, {
      id: 'barriers',
      label: l === 'fr' ? 'BarriÃ¨res' : 'Barriers',
      fields: ['barriers'],
      weight: 20
    }, {
      id: 'strategies',
      label: l === 'fr' ? 'StratÃ©gies' : 'Strategies',
      check: function (p) {
        return p.protocol && p.protocol.strategies && p.protocol.strategies.length > 0;
      },
      weight: 25
    }, {
      id: 'evaluation',
      label: l === 'fr' ? 'Ã‰valuation' : 'Evaluation',
      check: function (p) {
        return p.protocol && (p.protocol.reaim || p.protocol.kpis);
      },
      weight: 15
    }, {
      id: 'diagnostic',
      label: l === 'fr' ? 'Diagnostic CFIR' : 'CFIR Diagnostic',
      check: function (p) {
        return !!p.diagnostic;
      },
      weight: 10
    }];
    var totalWeight = 0,
      completedWeight = 0;
    sections.forEach(function (section) {
      var completed = 0,
        total = 0;
      if (section.fields) {
        total = section.fields.length;
        section.fields.forEach(function (field) {
          if (project[field] && (typeof project[field] === 'string' ? project[field].trim() !== '' : true)) completed++;
        });
      } else if (section.check) {
        total = 1;
        completed = section.check(project) ? 1 : 0;
      }
      var progress = total > 0 ? Math.round(completed / total * 100) : 0;
      data.sections.push({
        id: section.id,
        label: section.label,
        progress: progress,
        weight: section.weight
      });
      totalWeight += section.weight;
      completedWeight += progress / 100 * section.weight;
    });
    data.overall = Math.round(completedWeight / totalWeight * 100);
    return data;
  },
  generateDonutSVG: function (data, options) {
    options = options || {};
    var size = options.size || 200;
    var strokeWidth = options.strokeWidth || 30;
    var centerX = size / 2,
      centerY = size / 2;
    var radius = (size - strokeWidth) / 2;
    var circumference = 2 * Math.PI * radius;
    var svg = '<svg width="' + size + '" height="' + size + '" viewBox="0 0 ' + size + ' ' + size + '">';
    svg += '<circle cx="' + centerX + '" cy="' + centerY + '" r="' + radius + '" fill="none" stroke="#e5e7eb" stroke-width="' + strokeWidth + '"/>';
    var currentOffset = 0;
    data.forEach(function (item) {
      var segmentLength = item.percentage / 100 * circumference;
      svg += '<circle cx="' + centerX + '" cy="' + centerY + '" r="' + radius + '" fill="none" stroke="' + item.color + '" stroke-width="' + strokeWidth + '" stroke-dasharray="' + segmentLength + ' ' + circumference + '" stroke-dashoffset="' + -currentOffset + '" transform="rotate(-90 ' + centerX + ' ' + centerY + ')"/>';
      currentOffset += segmentLength;
    });
    svg += '</svg>';
    return svg;
  },
  generateGanttHTML: function (ganttData, options) {
    options = options || {};
    var barHeight = options.barHeight || 36;
    var monthWidth = options.monthWidth || 40;
    if (!ganttData || !ganttData.phases) return '';
    var html = '<div class="gantt-chart" style="overflow-x:auto;">';
    html += '<div style="display:flex;border-bottom:1px solid #e5e7eb;margin-bottom:8px;">';
    for (var m = 0; m < ganttData.totalDuration; m++) {
      html += '<div style="width:' + monthWidth + 'px;text-align:center;font-size:11px;color:#6b7280;padding:4px 0;">M' + (m + 1) + '</div>';
    }
    html += '</div>';
    ganttData.phases.forEach(function (phase) {
      html += '<div style="display:flex;align-items:center;margin-bottom:8px;">';
      html += '<div style="width:120px;font-size:12px;font-weight:500;color:#374151;padding-right:12px;text-align:right;">' + phase.label + '</div>';
      html += '<div style="flex:1;position:relative;height:' + barHeight + 'px;background:#f3f4f6;border-radius:4px;">';
      var leftOffset = phase.start * monthWidth;
      var barWidth = phase.duration * monthWidth;
      html += '<div style="position:absolute;left:' + leftOffset + 'px;width:' + barWidth + 'px;height:100%;background:' + phase.color + ';border-radius:4px;display:flex;align-items:center;justify-content:center;">';
      html += '<span style="color:white;font-size:11px;font-weight:500;">' + phase.duration + ' ' + ganttData.unit + '</span>';
      html += '</div></div></div>';
    });
    html += '</div>';
    return html;
  }
};
console.log('âœ… MOUDAR v8.1 Modules chargÃ©s: MoudarDataManager, OnboardingWizard, InteractiveCharts');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE v8.2 - VALIDATION RIGOUREUSE DES DONNÃ‰ES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var MoudarValidator = function () {
  'use strict';

  // DÃ©tection de texte absurde / spam
  function isGibberish(text) {
    if (!text || typeof text !== 'string') return true;
    var cleaned = text.trim().toLowerCase();
    if (cleaned.length < 3) return true;

    // MÃªme caractÃ¨re rÃ©pÃ©tÃ© (kkkkk, aaaaa)
    if (/^(.)\1{3,}$/.test(cleaned.replace(/\s/g, ''))) return true;

    // Alternance de 2 caractÃ¨res (ababab)
    if (/^(.)(.)(\1\2){2,}$/.test(cleaned.replace(/\s/g, ''))) return true;

    // SÃ©quences clavier
    var keyboards = ['qwerty', 'azerty', 'asdfgh', 'zxcvbn', '123456'];
    for (var i = 0; i < keyboards.length; i++) {
      if (cleaned.indexOf(keyboards[i]) !== -1) return true;
    }

    // Trop peu de voyelles
    var vowels = cleaned.match(/[aeiouyÃ Ã¢Ã¤Ã©Ã¨ÃªÃ«Ã¯Ã®Ã´Ã¹Ã»Ã¼]/gi) || [];
    var consonants = cleaned.match(/[bcdfghjklmnpqrstvwxz]/gi) || [];
    if (consonants.length > 0 && vowels.length / consonants.length < 0.15) return true;

    // Trop de majuscules consÃ©cutives
    if (/[A-Z]{10,}/.test(text)) return true;
    return false;
  }

  // VÃ©rifie si contient de vrais mots
  function hasRealWords(text, minWords) {
    minWords = minWords || 2;
    if (!text) return false;
    var commonWords = ['le', 'la', 'les', 'un', 'une', 'des', 'de', 'du', 'et', 'ou', 'mais', 'pour', 'avec', 'dans', 'sur', 'par', 'ce', 'cette', 'mon', 'ma', 'projet', 'santÃ©', 'formation', 'Ã©quipe', 'personnel', 'patient', 'centre', 'hÃ´pital', 'clinique', 'service', 'programme', 'intervention', 'objectif', 'the', 'a', 'an', 'and', 'or', 'for', 'with', 'in', 'on', 'to', 'project', 'health', 'training', 'team', 'staff', 'patient', 'center'];
    var words = text.toLowerCase().split(/\s+/);
    var realWordCount = 0;
    for (var i = 0; i < words.length; i++) {
      var word = words[i].replace(/[^a-zÃ Ã¢Ã¤Ã©Ã¨ÃªÃ«Ã¯Ã®Ã´Ã¹Ã»Ã¼Ã§]/gi, '');
      if (word.length >= 2) {
        if (commonWords.indexOf(word) !== -1) {
          realWordCount++;
        } else if (word.length >= 4 && /[aeiouyÃ Ã¢Ã¤Ã©Ã¨ÃªÃ«Ã¯Ã®Ã´Ã¹Ã»Ã¼]/i.test(word)) {
          realWordCount++;
        }
      }
    }
    return realWordCount >= minWords;
  }

  // RÃ¨gles de validation - v9.0 ASSOUPLIES pour dÃ©mo
  var rules = {
    title: {
      required: true,
      minLength: 5,
      minWords: 1
    },
    organization: {
      required: false,
      minLength: 2
    },
    context: {
      required: true,
      minLength: 20,
      minWords: 3
    },
    population: {
      required: true,
      minLength: 5,
      minWords: 1
    },
    barriers: {
      required: false,
      minLength: 10,
      minWords: 2
    },
    objectives: {
      required: false,
      minLength: 10,
      minWords: 1
    },
    // v8.2 - Champs simplifiÃ©s pour dÃ©mo
    country: {
      required: false
    },
    domain: {
      required: true
    },
    phase: {
      required: false
    },
    settingType: {
      required: false
    },
    settingCount: {
      required: false
    },
    geographicScope: {
      required: false
    },
    populationSize: {
      required: false
    },
    teamSize: {
      required: false
    },
    expectedOutcomes: {
      required: false,
      minSelect: 1
    },
    barrierCategories: {
      required: false,
      minSelect: 0
    },
    timeline: {
      required: false
    },
    // Optionnels
    beneficiaries: {
      required: false
    },
    facilitators: {
      required: false
    },
    budget: {
      required: false
    },
    experience: {
      required: false
    },
    additionalInfo: {
      required: false
    }
  };

  // Messages d'erreur
  var messages = {
    fr: {
      title: {
        required: "Le titre est obligatoire",
        minLength: "Le titre doit contenir au moins 10 caractÃ¨res",
        minWords: "Le titre doit contenir au moins 3 mots significatifs",
        gibberish: "Le titre ne semble pas valide. Entrez un vrai titre de projet."
      },
      context: {
        required: "Le contexte est obligatoire",
        minLength: "Le contexte doit contenir au moins 100 caractÃ¨res (actuellement: {length}). DÃ©crivez votre situation plus en dÃ©tail.",
        minWords: "Le contexte doit contenir au moins 20 mots significatifs pour gÃ©nÃ©rer des recommandations pertinentes.",
        gibberish: "Le contexte ne contient pas de texte valide."
      },
      population: {
        required: "La population cible est obligatoire",
        minLength: "PrÃ©cisez la population cible (au moins 15 caractÃ¨res)",
        gibberish: "La description de la population ne semble pas valide"
      },
      barriers: {
        required: "Les barriÃ¨res anticipÃ©es sont obligatoires",
        minLength: "DÃ©crivez les barriÃ¨res en au moins 50 caractÃ¨res",
        minWords: "DÃ©crivez les barriÃ¨res avec au moins 10 mots pour une analyse pertinente",
        gibberish: "La description des barriÃ¨res ne semble pas valide"
      },
      organization: {
        required: "L'organisation est obligatoire",
        minLength: "Le nom de l'organisation doit contenir au moins 5 caractÃ¨res",
        gibberish: "Le nom de l'organisation ne semble pas valide"
      },
      generic: {
        required: "Ce champ est obligatoire",
        gibberish: "Le texte entrÃ© ne semble pas valide"
      }
    },
    en: {
      title: {
        required: "Title is required",
        minLength: "Title must be at least 10 characters",
        minWords: "Title must contain at least 3 meaningful words",
        gibberish: "Title doesn't appear valid. Enter a real project title."
      },
      context: {
        required: "Context is required",
        minLength: "Context must be at least 100 characters (currently: {length}). Describe your situation in more detail.",
        minWords: "Context must contain at least 20 meaningful words to generate relevant recommendations.",
        gibberish: "Context doesn't contain valid text."
      },
      population: {
        required: "Target population is required",
        minLength: "Specify target population (at least 15 characters)",
        gibberish: "Population description doesn't appear valid"
      },
      barriers: {
        required: "Anticipated barriers are required",
        minLength: "Describe barriers with at least 50 characters",
        minWords: "Describe barriers with at least 10 words for relevant analysis",
        gibberish: "Barriers description doesn't appear valid"
      },
      organization: {
        required: "Organization is required",
        minLength: "Organization name must be at least 5 characters",
        gibberish: "Organization name doesn't appear valid"
      },
      generic: {
        required: "This field is required",
        gibberish: "The entered text doesn't appear valid"
      }
    }
  };
  function validateField(fieldId, value, lang) {
    lang = lang || 'fr';
    var rule = rules[fieldId];
    if (!rule) return {
      valid: true,
      errors: [],
      warnings: []
    };
    var errors = [];
    var fieldMsgs = messages[lang][fieldId] || messages[lang].generic;

    // v8.2 - Gestion des tableaux (multiselect)
    if (Array.isArray(value)) {
      if (rule.required && value.length === 0) {
        errors.push(fieldMsgs.required || messages[lang].generic.required);
        return {
          valid: false,
          errors: errors,
          warnings: []
        };
      }
      if (rule.minSelect && value.length < rule.minSelect) {
        errors.push((lang === 'fr' ? 'SÃ©lectionnez au moins ' : 'Select at least ') + rule.minSelect + (lang === 'fr' ? ' option(s)' : ' option(s)'));
        return {
          valid: false,
          errors: errors,
          warnings: []
        };
      }
      return {
        valid: true,
        errors: [],
        warnings: []
      };
    }

    // v8.2 - Gestion des nombres
    if (typeof value === 'number') {
      if (rule.required && (value === 0 || isNaN(value))) {
        errors.push(fieldMsgs.required || messages[lang].generic.required);
        return {
          valid: false,
          errors: errors,
          warnings: []
        };
      }
      return {
        valid: true,
        errors: [],
        warnings: []
      };
    }
    var cleanValue = (value || '').toString().trim();

    // VÃ©rification obligatoire
    if (rule.required && !cleanValue) {
      errors.push(fieldMsgs.required || messages[lang].generic.required);
      return {
        valid: false,
        errors: errors,
        warnings: []
      };
    }
    if (!cleanValue) return {
      valid: true,
      errors: [],
      warnings: []
    };

    // DÃ©tection charabia (sauf pour les selects)
    if (rule.minLength && isGibberish(cleanValue)) {
      errors.push(fieldMsgs.gibberish || messages[lang].generic.gibberish);
      return {
        valid: false,
        errors: errors,
        warnings: []
      };
    }

    // Longueur minimale
    if (rule.minLength && cleanValue.length < rule.minLength) {
      var msg = (fieldMsgs.minLength || 'Minimum ' + rule.minLength + ' caractÃ¨res').replace('{length}', cleanValue.length);
      errors.push(msg);
    }

    // Nombre de mots minimum
    if (rule.minWords && !hasRealWords(cleanValue, rule.minWords)) {
      errors.push(fieldMsgs.minWords || 'Minimum ' + rule.minWords + ' mots requis');
    }
    return {
      valid: errors.length === 0,
      errors: errors,
      warnings: []
    };
  }
  function validateProject(project, lang) {
    lang = lang || 'fr';
    var results = {};
    var allValid = true;
    var totalErrors = [];

    // v8.2 - Liste Ã©tendue des champs obligatoires
    var fields = ['title', 'organization', 'country', 'domain',
    // Phase 1
    'context', 'settingType', 'settingCount', 'geographicScope',
    // Phase 2
    'population', 'populationSize', 'teamSize',
    // Phase 3
    'objectives', 'expectedOutcomes', 'phase',
    // Phase 4
    'barriers', 'barrierCategories',
    // Phase 5
    'timeline' // Phase 6
    ];
    for (var i = 0; i < fields.length; i++) {
      var fieldId = fields[i];
      var result = validateField(fieldId, project[fieldId], lang);
      results[fieldId] = result;
      if (!result.valid) {
        allValid = false;
        for (var j = 0; j < result.errors.length; j++) {
          totalErrors.push({
            field: fieldId,
            message: result.errors[j]
          });
        }
      }
    }
    return {
      valid: allValid,
      fieldResults: results,
      errors: totalErrors,
      qualityScore: calculateQualityScore(project, results)
    };
  }
  function calculateQualityScore(project, validationResults) {
    var score = 0;
    // v8.2 - Poids mis Ã  jour pour les nouveaux champs
    var weights = {
      title: 5,
      organization: 3,
      country: 5,
      domain: 5,
      context: 15,
      settingType: 3,
      settingCount: 2,
      geographicScope: 2,
      population: 8,
      populationSize: 2,
      teamSize: 2,
      beneficiaries: 2,
      objectives: 10,
      expectedOutcomes: 5,
      phase: 3,
      barriers: 12,
      barrierCategories: 5,
      facilitators: 3,
      timeline: 3,
      budget: 2,
      experience: 2,
      additionalInfo: 1
    };
    for (var field in weights) {
      var value = project[field];
      var validation = validationResults && validationResults[field];
      if (value && (!validation || validation.valid)) {
        var fieldScore = weights[field];
        if (typeof value === 'string') {
          var length = value.trim().length;
          if (field === 'context' && length > 300) fieldScore *= 1.2;
          if (field === 'barriers' && length > 150) fieldScore *= 1.2;
        }
        score += Math.min(fieldScore, weights[field] * 1.3);
      }
    }
    score = Math.round(Math.min(score, 100));
    return {
      score: score,
      level: score >= 80 ? 'excellent' : score >= 60 ? 'good' : score >= 40 ? 'fair' : 'poor',
      label: {
        fr: score >= 80 ? 'Excellent' : score >= 60 ? 'Bon' : score >= 40 ? 'Passable' : 'Insuffisant',
        en: score >= 80 ? 'Excellent' : score >= 60 ? 'Good' : score >= 40 ? 'Fair' : 'Poor'
      },
      color: score >= 80 ? 'green' : score >= 60 ? 'blue' : score >= 40 ? 'yellow' : 'red'
    };
  }
  return {
    VERSION: '8.2.0',
    validateField: validateField,
    validateProject: validateProject,
    isGibberish: isGibberish,
    hasRealWords: hasRealWords,
    calculateQualityScore: calculateQualityScore
  };
}();
window.MoudarValidator = MoudarValidator;
console.log('âœ… MOUDAR v8.2 Validator chargÃ© - Validation rigoureuse activÃ©e');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— MOUDAR v8.3 - MODULES INTELLIGENCE PRESCRIPTIVE â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 1: SENSITIVITY ANALYZER - Analyse Tornado des barriÃ¨res
// Identifie quelle barriÃ¨re impacte le plus la probabilitÃ© de succÃ¨s
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var SensitivityAnalyzer = function () {
  'use strict';

  // Poids d'impact de base pour chaque type de barriÃ¨re
  var barrierImpactWeights = {
    "lack_training": {
      baseImpact: 0.18,
      variability: 0.08,
      category: "capacity"
    },
    "staff_resistance": {
      baseImpact: 0.22,
      variability: 0.10,
      category: "human"
    },
    "it_infrastructure": {
      baseImpact: 0.15,
      variability: 0.12,
      category: "technical"
    },
    "data_management": {
      baseImpact: 0.12,
      variability: 0.06,
      category: "technical"
    },
    "stigma": {
      baseImpact: 0.20,
      variability: 0.15,
      category: "cultural"
    },
    "funding": {
      baseImpact: 0.25,
      variability: 0.10,
      category: "resources"
    },
    "leadership_support": {
      baseImpact: 0.23,
      variability: 0.08,
      category: "governance"
    },
    "time_constraints": {
      baseImpact: 0.16,
      variability: 0.07,
      category: "operational"
    },
    "cultural_barriers": {
      baseImpact: 0.19,
      variability: 0.12,
      category: "cultural"
    },
    "complexity": {
      baseImpact: 0.17,
      variability: 0.09,
      category: "operational"
    },
    "communication": {
      baseImpact: 0.14,
      variability: 0.06,
      category: "operational"
    },
    "policy_alignment": {
      baseImpact: 0.21,
      variability: 0.11,
      category: "governance"
    },
    "patient_engagement": {
      baseImpact: 0.15,
      variability: 0.08,
      category: "human"
    },
    "staff_turnover": {
      baseImpact: 0.18,
      variability: 0.10,
      category: "human"
    },
    "evidence_gaps": {
      baseImpact: 0.13,
      variability: 0.07,
      category: "knowledge"
    }
  };

  // Labels traduits pour les barriÃ¨res
  var barrierLabels = {
    "lack_training": {
      fr: "Manque de formation",
      en: "Lack of training"
    },
    "staff_resistance": {
      fr: "RÃ©sistance du personnel",
      en: "Staff resistance"
    },
    "it_infrastructure": {
      fr: "Infrastructure IT",
      en: "IT infrastructure"
    },
    "data_management": {
      fr: "Gestion des donnÃ©es",
      en: "Data management"
    },
    "stigma": {
      fr: "Stigmatisation",
      en: "Stigma"
    },
    "funding": {
      fr: "Financement insuffisant",
      en: "Insufficient funding"
    },
    "leadership_support": {
      fr: "Soutien leadership",
      en: "Leadership support"
    },
    "time_constraints": {
      fr: "Contraintes de temps",
      en: "Time constraints"
    },
    "cultural_barriers": {
      fr: "BarriÃ¨res culturelles",
      en: "Cultural barriers"
    },
    "complexity": {
      fr: "ComplexitÃ© intervention",
      en: "Intervention complexity"
    },
    "communication": {
      fr: "Communication",
      en: "Communication"
    },
    "policy_alignment": {
      fr: "Alignement politique",
      en: "Policy alignment"
    },
    "patient_engagement": {
      fr: "Engagement patients",
      en: "Patient engagement"
    },
    "staff_turnover": {
      fr: "Rotation personnel",
      en: "Staff turnover"
    },
    "evidence_gaps": {
      fr: "Lacunes preuves",
      en: "Evidence gaps"
    }
  };

  /**
   * Calcule le score de succÃ¨s de base avec toutes les barriÃ¨res
   */
  function calculateBaseSuccess(project) {
    var baseSuccess = 0.75; // Score de dÃ©part optimiste
    var barriers = project.barriers || [];
    var phase = project.phase || "implementation";
    var resourceLevel = project.resourceLevel || "R03";

    // Ajustement par phase EPIS
    var phaseMultipliers = {
      "exploration": 1.1,
      "preparation": 1.0,
      "implementation": 0.85,
      "sustainment": 0.9
    };
    baseSuccess *= phaseMultipliers[phase] || 1.0;

    // Ajustement par niveau de ressources
    var resourceMultipliers = {
      "R01": 1.15,
      "R02": 1.0,
      "R03": 0.85,
      "R04": 0.70
    };
    baseSuccess *= resourceMultipliers[resourceLevel] || 1.0;

    // RÃ©duction par barriÃ¨re active
    barriers.forEach(function (barrierId) {
      var weight = barrierImpactWeights[barrierId];
      if (weight) {
        var impact = weight.baseImpact * (0.8 + Math.random() * 0.4);
        baseSuccess *= 1 - impact;
      }
    });
    return Math.max(0.05, Math.min(0.95, baseSuccess));
  }

  /**
   * Analyse de sensibilitÃ© Tornado
   * Calcule l'impact de chaque barriÃ¨re sur le succÃ¨s global
   */
  function runTornadoAnalysis(project, lang) {
    lang = lang || 'fr';
    var barriers = project.barriers || [];
    var baseSuccess = calculateBaseSuccess(project);
    var impacts = [];
    barriers.forEach(function (barrierId) {
      // Simuler la suppression de cette barriÃ¨re
      var improvedBarriers = barriers.filter(function (b) {
        return b !== barrierId;
      });
      var improvedProject = Object.assign({}, project, {
        barriers: improvedBarriers
      });
      var improvedSuccess = calculateBaseSuccess(improvedProject);

      // Impact = gain de probabilitÃ© si barriÃ¨re rÃ©solue
      var impactGain = improvedSuccess - baseSuccess;
      var percentageGain = impactGain / baseSuccess * 100;
      var weight = barrierImpactWeights[barrierId] || {
        baseImpact: 0.15,
        category: "other"
      };
      var label = barrierLabels[barrierId] || {
        fr: barrierId,
        en: barrierId
      };
      impacts.push({
        barrierId: barrierId,
        barrierName: label[lang] || label.fr,
        category: weight.category,
        impactFactor: impactGain,
        percentageGain: percentageGain,
        baseSuccessWithout: improvedSuccess,
        priority: percentageGain > 15 ? "critical" : percentageGain > 8 ? "high" : percentageGain > 4 ? "medium" : "low",
        recommendation: getRecommendation(barrierId, percentageGain, lang)
      });
    });

    // Trier par impact dÃ©croissant
    impacts.sort(function (a, b) {
      return b.impactFactor - a.impactFactor;
    });
    return {
      baseSuccess: baseSuccess,
      baseSuccessPercent: Math.round(baseSuccess * 100),
      barriers: impacts,
      topBarrier: impacts[0] || null,
      criticalBarriers: impacts.filter(function (i) {
        return i.priority === "critical";
      }),
      totalPotentialGain: impacts.reduce(function (sum, i) {
        return sum + i.impactFactor;
      }, 0),
      analysisDate: new Date().toISOString()
    };
  }

  /**
   * GÃ©nÃ¨re une recommandation contextuelle pour rÃ©soudre une barriÃ¨re
   */
  function getRecommendation(barrierId, percentageGain, lang) {
    var recommendations = {
      "lack_training": {
        fr: "Investir dans un programme de formation structurÃ© avec accompagnement sur site",
        en: "Invest in a structured training program with on-site coaching"
      },
      "staff_resistance": {
        fr: "Identifier des champions locaux et organiser des sessions de co-conception",
        en: "Identify local champions and organize co-design sessions"
      },
      "funding": {
        fr: "DÃ©velopper un business case et explorer les sources de financement alternatives",
        en: "Develop a business case and explore alternative funding sources"
      },
      "leadership_support": {
        fr: "Engager la direction dans des rÃ©unions de pilotage rÃ©guliÃ¨res",
        en: "Engage leadership in regular steering meetings"
      },
      "stigma": {
        fr: "Lancer une campagne de sensibilisation communautaire",
        en: "Launch a community awareness campaign"
      },
      "cultural_barriers": {
        fr: "Adapter l'intervention au contexte culturel local avec des facilitateurs communautaires",
        en: "Adapt intervention to local cultural context with community facilitators"
      },
      "it_infrastructure": {
        fr: "Ã‰valuer les besoins IT et planifier un upgrade progressif",
        en: "Assess IT needs and plan a progressive upgrade"
      },
      "time_constraints": {
        fr: "RÃ©organiser les flux de travail et dÃ©dier du temps protÃ©gÃ©",
        en: "Reorganize workflows and dedicate protected time"
      },
      "policy_alignment": {
        fr: "Engager un dialogue politique et aligner sur les prioritÃ©s nationales",
        en: "Engage in policy dialogue and align with national priorities"
      },
      "complexity": {
        fr: "Simplifier l'intervention ou la dÃ©ployer par phases",
        en: "Simplify the intervention or deploy in phases"
      },
      "staff_turnover": {
        fr: "CrÃ©er un systÃ¨me de formation continue et de transfert de connaissances",
        en: "Create a continuous training and knowledge transfer system"
      }
    };
    var rec = recommendations[barrierId];
    if (!rec) {
      return lang === 'fr' ? "Analyser cette barriÃ¨re plus en dÃ©tail" : "Analyze this barrier in more detail";
    }
    var prefix = percentageGain > 15 ? lang === 'fr' ? "ðŸ”´ PRIORITÃ‰ CRITIQUE: " : "ðŸ”´ CRITICAL PRIORITY: " : percentageGain > 8 ? lang === 'fr' ? "ðŸŸ  PrioritÃ© haute: " : "ðŸŸ  High priority: " : "";
    return prefix + (rec[lang] || rec.fr);
  }

  /**
   * GÃ©nÃ¨re les donnÃ©es pour un graphique Tornado
   */
  function generateTornadoChartData(analysis, lang) {
    lang = lang || 'fr';
    var labels = [];
    var data = [];
    var colors = [];
    var borderColors = [];
    analysis.barriers.slice(0, 8).forEach(function (barrier) {
      labels.push(barrier.barrierName);
      data.push(Math.round(barrier.percentageGain * 10) / 10);
      var color = barrier.priority === "critical" ? "rgba(239, 68, 68, 0.8)" : barrier.priority === "high" ? "rgba(249, 115, 22, 0.8)" : barrier.priority === "medium" ? "rgba(234, 179, 8, 0.8)" : "rgba(34, 197, 94, 0.8)";
      colors.push(color);
      borderColors.push(color.replace("0.8", "1"));
    });
    return {
      labels: labels,
      datasets: [{
        label: lang === 'fr' ? "Gain potentiel (%)" : "Potential gain (%)",
        data: data,
        backgroundColor: colors,
        borderColor: borderColors,
        borderWidth: 2
      }],
      options: {
        indexAxis: 'y',
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: lang === 'fr' ? "Impact des barriÃ¨res sur le succÃ¨s (Analyse Tornado)" : "Barrier Impact on Success (Tornado Analysis)"
          }
        }
      }
    };
  }
  return {
    VERSION: '8.3.0',
    runTornadoAnalysis: runTornadoAnalysis,
    calculateBaseSuccess: calculateBaseSuccess,
    generateTornadoChartData: generateTornadoChartData,
    getBarrierLabels: function () {
      return barrierLabels;
    },
    getBarrierWeights: function () {
      return barrierImpactWeights;
    }
  };
}();
window.SensitivityAnalyzer = SensitivityAnalyzer;
console.log('âœ… MOUDAR v8.3 SensitivityAnalyzer (Tornado) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 2: SEMANTIC NLP ENGINE - ComprÃ©hension sÃ©mantique avancÃ©e
// Alternative lÃ©gÃ¨re Ã  Transformers.js avec embeddings prÃ©-calculÃ©s
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var SemanticNLP = function () {
  'use strict';

  // Embeddings sÃ©mantiques prÃ©-calculÃ©s pour les concepts clÃ©s
  // Chaque concept a des synonymes et des expressions associÃ©es avec poids
  var semanticConcepts = {
    "burnout": {
      barrier: "staff_turnover",
      synonyms: ["Ã©puisÃ©", "Ã©puisement", "burnout", "fatiguÃ©", "surmenage", "stress", "dÃ©motivÃ©", "usure", "lassitude", "Ã  bout"],
      expressions: ["personnel Ã©puisÃ©", "Ã©quipe fatiguÃ©e", "charge mentale", "ne peut plus", "trop de travail", "sous pression"],
      weight: 0.95
    },
    "resistance_change": {
      barrier: "staff_resistance",
      synonyms: ["rÃ©siste", "refuse", "bloque", "rÃ©ticent", "opposÃ©", "hostile", "mÃ©fiant", "sceptique"],
      expressions: ["ne veut pas", "pas convaincu", "contre le changement", "prÃ©fÃ¨re l'ancien", "Ã§a marchait avant", "pourquoi changer"],
      weight: 0.92
    },
    "financial_constraints": {
      barrier: "funding",
      synonyms: ["argent", "budget", "financement", "coÃ»t", "cher", "onÃ©reux", "moyens", "ressources"],
      expressions: ["pas de budget", "trop cher", "manque d'argent", "restrictions budgÃ©taires", "coupes", "pas les moyens"],
      weight: 0.90
    },
    "tech_problems": {
      barrier: "it_infrastructure",
      synonyms: ["ordinateur", "logiciel", "systÃ¨me", "application", "internet", "rÃ©seau", "plantage", "bug"],
      expressions: ["Ã§a plante", "trop lent", "pas d'ordinateur", "systÃ¨me obsolÃ¨te", "pas compatible", "problÃ¨me technique"],
      weight: 0.88
    },
    "knowledge_gap": {
      barrier: "lack_training",
      synonyms: ["sait pas", "comprend pas", "formation", "compÃ©tence", "apprendre", "capacitÃ©", "savoir"],
      expressions: ["ne sait pas comment", "pas formÃ©", "besoin d'apprendre", "manque de compÃ©tences", "pas les connaissances"],
      weight: 0.90
    },
    "stigma_mental": {
      barrier: "stigma",
      synonyms: ["honte", "tabou", "jugement", "prÃ©jugÃ©", "discrimination", "fou", "psychiatrique", "mental"],
      expressions: ["mal vu", "on en parle pas", "c'est tabou", "les gens pensent que", "peur du regard"],
      weight: 0.93
    },
    "time_pressure": {
      barrier: "time_constraints",
      synonyms: ["temps", "urgent", "vite", "deadline", "dÃ©lai", "prioritÃ©", "agenda", "surchargÃ©"],
      expressions: ["pas le temps", "trop de travail", "journÃ©e trop courte", "toujours pressÃ©", "autres prioritÃ©s"],
      weight: 0.85
    },
    "leadership_absent": {
      barrier: "leadership_support",
      synonyms: ["direction", "chef", "manager", "responsable", "hiÃ©rarchie", "dÃ©cideur", "pilotage"],
      expressions: ["direction absente", "pas de soutien", "chef pas impliquÃ©", "personne ne dÃ©cide", "manque de leadership"],
      weight: 0.91
    },
    "cultural_context": {
      barrier: "cultural_barriers",
      synonyms: ["culture", "tradition", "religion", "croyance", "coutume", "communautÃ©", "local"],
      expressions: ["pas dans notre culture", "tradition diffÃ©rente", "croyances locales", "Ã§a ne se fait pas ici", "contexte culturel"],
      weight: 0.89
    },
    "complexity_high": {
      barrier: "complexity",
      synonyms: ["compliquÃ©", "complexe", "difficile", "lourd", "multiple", "fragmentÃ©", "hÃ©tÃ©rogÃ¨ne"],
      expressions: ["trop compliquÃ©", "usine Ã  gaz", "difficile Ã  mettre en place", "beaucoup de parties prenantes"],
      weight: 0.84
    }
  };

  /**
   * Analyse sÃ©mantique d'un texte pour dÃ©tecter les barriÃ¨res
   * Retourne un score de confiance pour chaque barriÃ¨re dÃ©tectÃ©e
   */
  function analyzeText(text, lang) {
    lang = lang || 'fr';
    if (!text || typeof text !== 'string') return {
      barriers: [],
      confidence: 0
    };
    var normalizedText = text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "") // Enlever accents pour matching
    .replace(/['']/g, "'").replace(/[""]/g, '"');
    var detectedBarriers = {};
    var totalMatches = 0;

    // Analyser chaque concept sÃ©mantique
    for (var conceptId in semanticConcepts) {
      var concept = semanticConcepts[conceptId];
      var matchScore = 0;
      var matchCount = 0;

      // VÃ©rifier les synonymes
      concept.synonyms.forEach(function (synonym) {
        var normalizedSynonym = synonym.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        if (normalizedText.indexOf(normalizedSynonym) !== -1) {
          matchScore += 0.3;
          matchCount++;
        }
      });

      // VÃ©rifier les expressions (plus de poids)
      concept.expressions.forEach(function (expr) {
        var normalizedExpr = expr.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        if (normalizedText.indexOf(normalizedExpr) !== -1) {
          matchScore += 0.6;
          matchCount++;
        }
      });
      if (matchCount > 0) {
        var finalScore = Math.min(matchScore * concept.weight, 1.0);
        var barrierId = concept.barrier;
        if (!detectedBarriers[barrierId] || detectedBarriers[barrierId].score < finalScore) {
          detectedBarriers[barrierId] = {
            barrierId: barrierId,
            score: finalScore,
            matchCount: matchCount,
            sourceConceptId: conceptId,
            confidence: finalScore > 0.7 ? "high" : finalScore > 0.4 ? "medium" : "low"
          };
        }
        totalMatches += matchCount;
      }
    }

    // Convertir en tableau et trier
    var barriersList = Object.values(detectedBarriers);
    barriersList.sort(function (a, b) {
      return b.score - a.score;
    });
    return {
      barriers: barriersList,
      totalMatches: totalMatches,
      overallConfidence: barriersList.length > 0 ? barriersList.reduce(function (sum, b) {
        return sum + b.score;
      }, 0) / barriersList.length : 0,
      analyzedAt: new Date().toISOString()
    };
  }

  /**
   * Analyse sÃ©mantique pour identifier le domaine principal
   */
  function detectDomain(text) {
    if (!text) return null;
    var normalized = text.toLowerCase();
    var domainKeywords = {
      "mentalHealth": ["mental", "psychiatr", "dÃ©pression", "anxiÃ©tÃ©", "psycholog", "suicide", "mhgap", "santÃ© mentale"],
      "primaryCare": ["soins primaires", "mÃ©decin gÃ©nÃ©raliste", "centre de santÃ©", "dispensaire", "consultation"],
      "digitalHealth": ["tÃ©lÃ©", "numÃ©rique", "digital", "application", "e-santÃ©", "tÃ©lÃ©mÃ©decine", "tÃ©lÃ©santÃ©"],
      "education": ["Ã©cole", "formation", "Ã©tudiant", "enseignant", "pÃ©dagog", "Ã©ducation", "apprentissage"],
      "maternalChild": ["matern", "pÃ©rinatal", "enfant", "pÃ©diatr", "grossesse", "accouchement", "nÃ©onatal"]
    };
    var scores = {};
    for (var domain in domainKeywords) {
      scores[domain] = 0;
      domainKeywords[domain].forEach(function (kw) {
        if (normalized.indexOf(kw) !== -1) scores[domain]++;
      });
    }
    var maxDomain = null;
    var maxScore = 0;
    for (var d in scores) {
      if (scores[d] > maxScore) {
        maxScore = scores[d];
        maxDomain = d;
      }
    }
    return maxScore > 0 ? {
      domain: maxDomain,
      confidence: Math.min(maxScore / 3, 1)
    } : null;
  }

  /**
   * SuggÃ¨re des barriÃ¨res basÃ©es sur l'analyse sÃ©mantique complÃ¨te
   */
  function suggestBarriers(projectData, lang) {
    lang = lang || 'fr';
    var fullText = [projectData.context || "", projectData.barriers || "", projectData.population || "", projectData.objectives || "", projectData.additionalInfo || ""].join(" ");
    var analysis = analyzeText(fullText, lang);
    return {
      suggested: analysis.barriers.filter(function (b) {
        return b.score > 0.3;
      }),
      highConfidence: analysis.barriers.filter(function (b) {
        return b.confidence === "high";
      }),
      overallConfidence: analysis.overallConfidence,
      detectedDomain: detectDomain(fullText)
    };
  }
  return {
    VERSION: '8.3.0',
    analyzeText: analyzeText,
    detectDomain: detectDomain,
    suggestBarriers: suggestBarriers,
    getSemanticConcepts: function () {
      return semanticConcepts;
    }
  };
}();
window.SemanticNLP = SemanticNLP;
console.log('âœ… MOUDAR v8.3 SemanticNLP (ComprÃ©hension sÃ©mantique) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 3: THEORY OF CHANGE ENGINE - ModÃ¨le logique interactif
// GÃ©nÃ¨re un diagramme de flux dynamique Input â†’ Activities â†’ Outputs â†’ Outcomes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var TheoryOfChangeEngine = function () {
  'use strict';

  // Structure du modÃ¨le logique
  var tocTemplate = {
    inputs: [],
    activities: [],
    outputs: [],
    outcomes: {
      shortTerm: [],
      mediumTerm: [],
      longTerm: []
    },
    assumptions: [],
    links: []
  };

  // BibliothÃ¨que de composants prÃ©-dÃ©finis par domaine
  var componentLibrary = {
    "mentalHealth": {
      inputs: [{
        id: "I01",
        label: {
          fr: "Formation mhGAP",
          en: "mhGAP training"
        },
        icon: "ðŸ“š"
      }, {
        id: "I02",
        label: {
          fr: "Champions locaux",
          en: "Local champions"
        },
        icon: "ðŸŒŸ"
      }, {
        id: "I03",
        label: {
          fr: "Budget allouÃ©",
          en: "Allocated budget"
        },
        icon: "ðŸ’°"
      }, {
        id: "I04",
        label: {
          fr: "Outils de dÃ©pistage",
          en: "Screening tools"
        },
        icon: "ðŸ“‹"
      }],
      activities: [{
        id: "A01",
        label: {
          fr: "Sessions de formation",
          en: "Training sessions"
        },
        icon: "ðŸŽ“",
        linkedInputs: ["I01", "I02"]
      }, {
        id: "A02",
        label: {
          fr: "Supervision clinique",
          en: "Clinical supervision"
        },
        icon: "ðŸ‘ï¸",
        linkedInputs: ["I02"]
      }, {
        id: "A03",
        label: {
          fr: "Sensibilisation communautaire",
          en: "Community awareness"
        },
        icon: "ðŸ“¢",
        linkedInputs: ["I03"]
      }, {
        id: "A04",
        label: {
          fr: "IntÃ©gration protocoles",
          en: "Protocol integration"
        },
        icon: "ðŸ“‘",
        linkedInputs: ["I04"]
      }],
      outputs: [{
        id: "O01",
        label: {
          fr: "X professionnels formÃ©s",
          en: "X professionals trained"
        },
        icon: "âœ…",
        linkedActivities: ["A01"]
      }, {
        id: "O02",
        label: {
          fr: "Protocoles en place",
          en: "Protocols in place"
        },
        icon: "ðŸ“„",
        linkedActivities: ["A04"]
      }, {
        id: "O03",
        label: {
          fr: "X patients dÃ©pistÃ©s",
          en: "X patients screened"
        },
        icon: "ðŸ”",
        linkedActivities: ["A02", "A04"]
      }],
      shortTermOutcomes: [{
        id: "ST01",
        label: {
          fr: "â†‘ Connaissances personnel",
          en: "â†‘ Staff knowledge"
        },
        linkedOutputs: ["O01"]
      }, {
        id: "ST02",
        label: {
          fr: "â†‘ Confiance dÃ©pistage",
          en: "â†‘ Screening confidence"
        },
        linkedOutputs: ["O01", "O02"]
      }],
      mediumTermOutcomes: [{
        id: "MT01",
        label: {
          fr: "â†‘ Taux dÃ©tection",
          en: "â†‘ Detection rate"
        },
        linkedShortTerm: ["ST01", "ST02"]
      }, {
        id: "MT02",
        label: {
          fr: "â†“ DÃ©lai prise en charge",
          en: "â†“ Time to treatment"
        },
        linkedShortTerm: ["ST02"]
      }],
      longTermOutcomes: [{
        id: "LT01",
        label: {
          fr: "â†“ Charge morbiditÃ©",
          en: "â†“ Morbidity burden"
        },
        linkedMediumTerm: ["MT01", "MT02"]
      }, {
        id: "LT02",
        label: {
          fr: "â†“ Stigmatisation",
          en: "â†“ Stigmatization"
        },
        linkedMediumTerm: ["MT01"]
      }]
    },
    "education": {
      inputs: [{
        id: "I01",
        label: {
          fr: "Curriculum rÃ©visÃ©",
          en: "Revised curriculum"
        },
        icon: "ðŸ“–"
      }, {
        id: "I02",
        label: {
          fr: "Formateurs certifiÃ©s",
          en: "Certified trainers"
        },
        icon: "ðŸŽ“"
      }, {
        id: "I03",
        label: {
          fr: "Ressources pÃ©dagogiques",
          en: "Teaching resources"
        },
        icon: "ðŸ“š"
      }],
      activities: [{
        id: "A01",
        label: {
          fr: "Formation des enseignants",
          en: "Teacher training"
        },
        icon: "ðŸ‘¨â€ðŸ«",
        linkedInputs: ["I01", "I02"]
      }, {
        id: "A02",
        label: {
          fr: "DÃ©ploiement curriculum",
          en: "Curriculum deployment"
        },
        icon: "ðŸš€",
        linkedInputs: ["I01", "I03"]
      }],
      outputs: [{
        id: "O01",
        label: {
          fr: "X enseignants formÃ©s",
          en: "X teachers trained"
        },
        icon: "âœ…",
        linkedActivities: ["A01"]
      }, {
        id: "O02",
        label: {
          fr: "X Ã©coles Ã©quipÃ©es",
          en: "X schools equipped"
        },
        icon: "ðŸ«",
        linkedActivities: ["A02"]
      }],
      shortTermOutcomes: [{
        id: "ST01",
        label: {
          fr: "â†‘ QualitÃ© enseignement",
          en: "â†‘ Teaching quality"
        },
        linkedOutputs: ["O01"]
      }],
      mediumTermOutcomes: [{
        id: "MT01",
        label: {
          fr: "â†‘ RÃ©sultats scolaires",
          en: "â†‘ Academic results"
        },
        linkedShortTerm: ["ST01"]
      }],
      longTermOutcomes: [{
        id: "LT01",
        label: {
          fr: "â†‘ Capital humain",
          en: "â†‘ Human capital"
        },
        linkedMediumTerm: ["MT01"]
      }]
    }
  };

  /**
   * GÃ©nÃ¨re une Theory of Change complÃ¨te pour un projet
   */
  function generateToC(project, lang) {
    lang = lang || 'fr';
    var domain = project.domain || "mentalHealth";
    var template = componentLibrary[domain] || componentLibrary["mentalHealth"];

    // Adapter les composants au projet
    var toc = {
      projectId: project.id,
      projectTitle: project.title,
      domain: domain,
      generatedAt: new Date().toISOString(),
      inputs: template.inputs.map(function (i) {
        return Object.assign({}, i, {
          label: i.label[lang] || i.label.fr,
          status: "planned",
          linked: true
        });
      }),
      activities: template.activities.map(function (a) {
        return Object.assign({}, a, {
          label: a.label[lang] || a.label.fr,
          status: "planned",
          linked: true
        });
      }),
      outputs: template.outputs.map(function (o) {
        return Object.assign({}, o, {
          label: o.label[lang] || o.label.fr,
          status: "pending",
          linked: true
        });
      }),
      outcomes: {
        shortTerm: (template.shortTermOutcomes || []).map(function (st) {
          return Object.assign({}, st, {
            label: st.label[lang] || st.label.fr,
            linked: true
          });
        }),
        mediumTerm: (template.mediumTermOutcomes || []).map(function (mt) {
          return Object.assign({}, mt, {
            label: mt.label[lang] || mt.label.fr,
            linked: true
          });
        }),
        longTerm: (template.longTermOutcomes || []).map(function (lt) {
          return Object.assign({}, lt, {
            label: lt.label[lang] || lt.label.fr,
            linked: true
          });
        })
      },
      assumptions: generateAssumptions(project, lang),
      risks: identifyRisks(project, lang)
    };

    // GÃ©nÃ©rer les liens visuels
    toc.links = generateLinks(toc);
    return toc;
  }

  /**
   * GÃ©nÃ¨re les hypothÃ¨ses critiques
   */
  function generateAssumptions(project, lang) {
    var assumptions = [];
    var barriers = project.barriers || [];
    if (barriers.indexOf("staff_resistance") !== -1 || barriers.indexOf("staff_turnover") !== -1) {
      assumptions.push({
        id: "ASS01",
        text: lang === 'fr' ? "Le personnel reste motivÃ© et stable" : "Staff remains motivated and stable",
        risk: "high"
      });
    }
    if (barriers.indexOf("funding") !== -1) {
      assumptions.push({
        id: "ASS02",
        text: lang === 'fr' ? "Le financement reste disponible" : "Funding remains available",
        risk: "high"
      });
    }
    if (barriers.indexOf("leadership_support") !== -1) {
      assumptions.push({
        id: "ASS03",
        text: lang === 'fr' ? "La direction continue Ã  soutenir le projet" : "Leadership continues to support the project",
        risk: "medium"
      });
    }

    // HypothÃ¨ses par dÃ©faut
    assumptions.push({
      id: "ASS99",
      text: lang === 'fr' ? "Le contexte politique reste stable" : "Political context remains stable",
      risk: "low"
    });
    return assumptions;
  }

  /**
   * Identifie les risques majeurs
   */
  function identifyRisks(project, lang) {
    var risks = [];
    var analysis = SensitivityAnalyzer.runTornadoAnalysis(project, lang);
    if (analysis.criticalBarriers) {
      analysis.criticalBarriers.forEach(function (barrier) {
        risks.push({
          id: "RISK_" + barrier.barrierId,
          barrierSource: barrier.barrierId,
          description: barrier.barrierName,
          impact: barrier.percentageGain,
          mitigation: barrier.recommendation,
          level: barrier.priority
        });
      });
    }
    return risks;
  }

  /**
   * GÃ©nÃ¨re les liens entre composants pour visualisation
   */
  function generateLinks(toc) {
    var links = [];

    // Inputs â†’ Activities
    toc.activities.forEach(function (activity) {
      (activity.linkedInputs || []).forEach(function (inputId) {
        links.push({
          from: inputId,
          to: activity.id,
          type: "input-activity",
          status: activity.linked && toc.inputs.find(function (i) {
            return i.id === inputId && i.linked;
          }) ? "active" : "broken"
        });
      });
    });

    // Activities â†’ Outputs
    toc.outputs.forEach(function (output) {
      (output.linkedActivities || []).forEach(function (activityId) {
        links.push({
          from: activityId,
          to: output.id,
          type: "activity-output",
          status: output.linked ? "active" : "broken"
        });
      });
    });
    return links;
  }

  /**
   * Simule le retrait d'un composant et montre les liens brisÃ©s
   */
  function simulateRemoval(toc, componentId) {
    var updatedToc = JSON.parse(JSON.stringify(toc));
    var brokenLinks = [];

    // Trouver et dÃ©sactiver le composant
    ['inputs', 'activities', 'outputs'].forEach(function (section) {
      updatedToc[section].forEach(function (item) {
        if (item.id === componentId) {
          item.linked = false;
          item.status = "removed";
        }
      });
    });

    // Identifier les liens brisÃ©s
    updatedToc.links.forEach(function (link) {
      if (link.from === componentId || link.to === componentId) {
        link.status = "broken";
        brokenLinks.push(link);
      }
    });
    return {
      toc: updatedToc,
      brokenLinks: brokenLinks,
      impactedComponents: brokenLinks.map(function (l) {
        return l.to;
      })
    };
  }
  return {
    VERSION: '8.3.0',
    generateToC: generateToC,
    simulateRemoval: simulateRemoval,
    getComponentLibrary: function () {
      return componentLibrary;
    }
  };
}();
window.TheoryOfChangeEngine = TheoryOfChangeEngine;
console.log('âœ… MOUDAR v8.3 TheoryOfChangeEngine (ModÃ¨le logique interactif) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 4: BIBLIOGRAPHIC API - Connexion PubMed/Evidence Base
// Recherche de preuves scientifiques pour les stratÃ©gies recommandÃ©es
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var BibliographicAPI = function () {
  'use strict';

  // Base de donnÃ©es locale de rÃ©fÃ©rences clÃ©s (fallback si API indisponible)
  var localEvidenceBase = {
    "training_educational": [{
      pmid: "28648777",
      authors: "Powell BJ et al.",
      year: 2017,
      title: "A refined compilation of implementation strategies",
      journal: "Implement Sci",
      doi: "10.1186/s13012-015-0209-1"
    }, {
      pmid: "30458875",
      authors: "Proctor EK et al.",
      year: 2011,
      title: "Outcomes for Implementation Research",
      journal: "Adm Policy Ment Health",
      relevance: 0.95
    }],
    "champion_identification": [{
      pmid: "26801605",
      authors: "Miech EJ et al.",
      year: 2018,
      title: "Inside help: An integrative review of champions in healthcare-related implementation",
      journal: "SAGE Open Med",
      relevance: 0.92
    }],
    "audit_feedback": [{
      pmid: "23076942",
      authors: "Ivers N et al.",
      year: 2012,
      title: "Audit and feedback: effects on professional practice",
      journal: "Cochrane Database Syst Rev",
      relevance: 0.98
    }],
    "stakeholder_engagement": [{
      pmid: "29187192",
      authors: "Concannon TW et al.",
      year: 2014,
      title: "A systematic review of stakeholder engagement in comparative effectiveness",
      journal: "J Gen Intern Med",
      relevance: 0.88
    }],
    "facilitation": [{
      pmid: "27760536",
      authors: "Baskerville NB et al.",
      year: 2012,
      title: "Systematic review and meta-analysis of practice facilitation",
      journal: "Ann Fam Med",
      relevance: 0.91
    }],
    "adaptation": [{
      pmid: "30905323",
      authors: "Chambers DA et al.",
      year: 2013,
      title: "The dynamic sustainability framework",
      journal: "Implement Sci",
      relevance: 0.89
    }],
    "task_shifting": [{
      pmid: "24485016",
      authors: "Joshi R et al.",
      year: 2014,
      title: "Task Shifting for Non-Communicable Disease Management",
      journal: "PLoS One",
      relevance: 0.87
    }],
    "mhgap": [{
      pmid: "28137273",
      authors: "Keynejad RC et al.",
      year: 2018,
      title: "WHO mhGAP Intervention Guide: updated systematic review",
      journal: "Lancet Psychiatry",
      relevance: 0.96
    }, {
      pmid: "31043197",
      authors: "Spagnolo J et al.",
      year: 2021,
      title: "Implementation of mhGAP in Francophone West Africa",
      journal: "Int J Ment Health Syst",
      relevance: 0.93
    }]
  };

  // Mapping stratÃ©gies ERIC â†’ termes de recherche
  var strategySearchTerms = {
    "S01": {
      terms: ["educational training", "implementation training"],
      category: "training_educational"
    },
    "S02": {
      terms: ["clinical supervision", "mentoring healthcare"],
      category: "facilitation"
    },
    "S03": {
      terms: ["champion healthcare", "opinion leader"],
      category: "champion_identification"
    },
    "S04": {
      terms: ["audit feedback healthcare"],
      category: "audit_feedback"
    },
    "S05": {
      terms: ["stakeholder engagement implementation"],
      category: "stakeholder_engagement"
    },
    "S06": {
      terms: ["practice facilitation primary care"],
      category: "facilitation"
    },
    "S07": {
      terms: ["task shifting mental health"],
      category: "task_shifting"
    },
    "S08": {
      terms: ["cultural adaptation intervention"],
      category: "adaptation"
    },
    "S09": {
      terms: ["mhGAP implementation"],
      category: "mhgap"
    }
  };

  /**
   * Recherche des rÃ©fÃ©rences pour une stratÃ©gie donnÃ©e
   * Utilise la base locale (rapide) ou peut Ãªtre Ã©tendu avec API PubMed
   */
  function searchReferences(strategyId, options) {
    options = options || {};
    var maxResults = options.maxResults || 3;
    var lang = options.lang || 'fr';
    var searchConfig = strategySearchTerms[strategyId];
    if (!searchConfig) {
      return {
        references: [],
        query: null,
        source: "none"
      };
    }

    // Utiliser la base locale
    var localRefs = localEvidenceBase[searchConfig.category] || [];
    var results = localRefs.slice(0, maxResults).map(function (ref) {
      return Object.assign({}, ref, {
        citation: formatCitation(ref, lang),
        url: ref.pmid ? "https://pubmed.ncbi.nlm.nih.gov/" + ref.pmid : null
      });
    });
    return {
      strategyId: strategyId,
      references: results,
      query: searchConfig.terms.join(" OR "),
      source: "local_evidence_base",
      searchedAt: new Date().toISOString()
    };
  }

  /**
   * Recherche asynchrone via PubMed API (si disponible)
   */
  async function searchPubMed(query, maxResults) {
    maxResults = maxResults || 5;
    var baseUrl = "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/";
    try {
      // Ã‰tape 1: Recherche pour obtenir les IDs
      var searchUrl = baseUrl + "esearch.fcgi?db=pubmed&retmode=json&retmax=" + maxResults + "&term=" + encodeURIComponent(query + " AND implementation science");
      var searchResponse = await fetch(searchUrl);
      var searchData = await searchResponse.json();
      if (!searchData.esearchresult || !searchData.esearchresult.idlist) {
        return {
          references: [],
          error: "No results found"
        };
      }
      var ids = searchData.esearchresult.idlist;
      if (ids.length === 0) return {
        references: [],
        error: "No results found"
      };

      // Ã‰tape 2: RÃ©cupÃ©rer les dÃ©tails
      var fetchUrl = baseUrl + "esummary.fcgi?db=pubmed&retmode=json&id=" + ids.join(",");
      var fetchResponse = await fetch(fetchUrl);
      var fetchData = await fetchResponse.json();
      var references = [];
      ids.forEach(function (id) {
        var article = fetchData.result[id];
        if (article) {
          references.push({
            pmid: id,
            title: article.title,
            authors: article.authors ? article.authors.slice(0, 3).map(function (a) {
              return a.name;
            }).join(", ") + (article.authors.length > 3 ? " et al." : "") : "Unknown",
            journal: article.source,
            year: article.pubdate ? article.pubdate.split(" ")[0] : "N/A",
            url: "https://pubmed.ncbi.nlm.nih.gov/" + id
          });
        }
      });
      return {
        references: references,
        source: "pubmed_api",
        query: query
      };
    } catch (error) {
      console.warn("[BibliographicAPI] PubMed API error, falling back to local:", error);
      return {
        references: [],
        error: error.message,
        source: "error"
      };
    }
  }

  /**
   * Formate une citation en style acadÃ©mique
   */
  function formatCitation(ref, lang) {
    lang = lang || 'fr';
    var authors = ref.authors || "Unknown";
    var year = ref.year || "N/A";
    var title = ref.title || "Untitled";
    var journal = ref.journal || "";
    return authors + " (" + year + "). " + title + ". " + journal + ".";
  }

  /**
   * Obtient les rÃ©fÃ©rences pour toutes les stratÃ©gies d'un protocole
   */
  function getProtocolReferences(protocol, options) {
    options = options || {};
    var allRefs = [];
    if (!protocol || !protocol.strategies) return allRefs;
    protocol.strategies.forEach(function (strategyName, index) {
      // Mapper le nom de stratÃ©gie vers un ID (simplifiÃ©)
      var strategyId = "S0" + (index + 1);
      var refs = searchReferences(strategyId, options);
      if (refs.references.length > 0) {
        allRefs.push({
          strategy: strategyName,
          strategyId: strategyId,
          references: refs.references
        });
      }
    });
    return allRefs;
  }
  return {
    VERSION: '8.3.0',
    searchReferences: searchReferences,
    searchPubMed: searchPubMed,
    getProtocolReferences: getProtocolReferences,
    formatCitation: formatCitation,
    getLocalEvidenceBase: function () {
      return localEvidenceBase;
    }
  };
}();
window.BibliographicAPI = BibliographicAPI;
console.log('âœ… MOUDAR v8.3 BibliographicAPI (RÃ©fÃ©rences PubMed) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 5: PORTFOLIO MANAGER - Vue multi-projets agrÃ©gÃ©e
// Tableau de bord pour gestionnaires de programmes/ministÃ¨res
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var PortfolioManager = function () {
  'use strict';

  /**
   * AgrÃ¨ge les donnÃ©es de tous les projets d'une organisation
   */
  function aggregatePortfolio(projects, options) {
    options = options || {};
    var lang = options.lang || 'fr';
    if (!projects || projects.length === 0) {
      return {
        totalProjects: 0,
        summary: null,
        riskMap: [],
        recommendations: []
      };
    }

    // Calculs agrÃ©gÃ©s
    var totalProjects = projects.length;
    var projectsWithProtocol = projects.filter(function (p) {
      return p.protocol;
    }).length;

    // Analyse de risque par projet
    var riskAnalyses = [];
    var allBarriers = {};
    var domainCounts = {};
    var phaseCounts = {};
    projects.forEach(function (project) {
      // Analyse de sensibilitÃ©
      var sensitivity = SensitivityAnalyzer.runTornadoAnalysis(project, lang);
      riskAnalyses.push({
        projectId: project.id,
        projectTitle: project.title,
        domain: project.domain,
        phase: project.phase,
        successProbability: sensitivity.baseSuccessPercent,
        riskLevel: sensitivity.baseSuccessPercent < 40 ? "critical" : sensitivity.baseSuccessPercent < 60 ? "high" : sensitivity.baseSuccessPercent < 75 ? "medium" : "low",
        topBarrier: sensitivity.topBarrier ? sensitivity.topBarrier.barrierName : null,
        criticalBarriersCount: sensitivity.criticalBarriers.length
      });

      // Comptage des barriÃ¨res
      (project.barriers || []).forEach(function (barrier) {
        allBarriers[barrier] = (allBarriers[barrier] || 0) + 1;
      });

      // Comptage par domaine
      domainCounts[project.domain] = (domainCounts[project.domain] || 0) + 1;

      // Comptage par phase
      phaseCounts[project.phase] = (phaseCounts[project.phase] || 0) + 1;
    });

    // Trier les projets par risque
    riskAnalyses.sort(function (a, b) {
      return a.successProbability - b.successProbability;
    });

    // Identifier les barriÃ¨res les plus frÃ©quentes
    var topBarriers = Object.entries(allBarriers).sort(function (a, b) {
      return b[1] - a[1];
    }).slice(0, 5).map(function (entry) {
      var labels = SensitivityAnalyzer.getBarrierLabels()[entry[0]] || {
        fr: entry[0],
        en: entry[0]
      };
      return {
        barrierId: entry[0],
        barrierName: labels[lang] || labels.fr,
        count: entry[1],
        percentage: Math.round(entry[1] / totalProjects * 100)
      };
    });

    // Recommandations portfolio
    var recommendations = generatePortfolioRecommendations(riskAnalyses, topBarriers, lang);

    // Score global du portfolio
    var avgSuccess = riskAnalyses.reduce(function (sum, r) {
      return sum + r.successProbability;
    }, 0) / totalProjects;
    var criticalCount = riskAnalyses.filter(function (r) {
      return r.riskLevel === "critical";
    }).length;
    return {
      totalProjects: totalProjects,
      projectsWithProtocol: projectsWithProtocol,
      averageSuccessRate: Math.round(avgSuccess),
      riskDistribution: {
        critical: riskAnalyses.filter(function (r) {
          return r.riskLevel === "critical";
        }).length,
        high: riskAnalyses.filter(function (r) {
          return r.riskLevel === "high";
        }).length,
        medium: riskAnalyses.filter(function (r) {
          return r.riskLevel === "medium";
        }).length,
        low: riskAnalyses.filter(function (r) {
          return r.riskLevel === "low";
        }).length
      },
      projectRisks: riskAnalyses,
      topBarriers: topBarriers,
      domainDistribution: domainCounts,
      phaseDistribution: phaseCounts,
      recommendations: recommendations,
      healthScore: calculatePortfolioHealth(avgSuccess, criticalCount, totalProjects),
      generatedAt: new Date().toISOString()
    };
  }

  /**
   * GÃ©nÃ¨re des recommandations au niveau portfolio
   */
  function generatePortfolioRecommendations(riskAnalyses, topBarriers, lang) {
    var recommendations = [];

    // Recommandation si beaucoup de projets critiques
    var criticalCount = riskAnalyses.filter(function (r) {
      return r.riskLevel === "critical";
    }).length;
    if (criticalCount > 0) {
      recommendations.push({
        priority: "critical",
        type: "risk_mitigation",
        title: lang === 'fr' ? "Projets Ã  risque critique" : "Critical risk projects",
        description: lang === 'fr' ? criticalCount + " projet(s) ont une probabilitÃ© de succÃ¨s < 40%. Action immÃ©diate requise." : criticalCount + " project(s) have success probability < 40%. Immediate action required.",
        action: lang === 'fr' ? "Revoir les ressources allouÃ©es et les stratÃ©gies de ces projets" : "Review allocated resources and strategies for these projects"
      });
    }

    // Recommandation basÃ©e sur les barriÃ¨res frÃ©quentes
    if (topBarriers.length > 0 && topBarriers[0].percentage > 50) {
      recommendations.push({
        priority: "high",
        type: "systemic_barrier",
        title: lang === 'fr' ? "BarriÃ¨re systÃ©mique identifiÃ©e" : "Systemic barrier identified",
        description: lang === 'fr' ? "\"" + topBarriers[0].barrierName + "\" affecte " + topBarriers[0].percentage + "% des projets." : "\"" + topBarriers[0].barrierName + "\" affects " + topBarriers[0].percentage + "% of projects.",
        action: lang === 'fr' ? "ConsidÃ©rer une intervention au niveau organisationnel" : "Consider an organizational-level intervention"
      });
    }

    // Recommandation d'Ã©quilibrage des phases
    var implementationCount = riskAnalyses.filter(function (r) {
      return r.phase === "implementation";
    }).length;
    if (implementationCount > riskAnalyses.length * 0.6) {
      recommendations.push({
        priority: "medium",
        type: "phase_balance",
        title: lang === 'fr' ? "DÃ©sÃ©quilibre des phases" : "Phase imbalance",
        description: lang === 'fr' ? "Trop de projets en phase d'implÃ©mentation simultanÃ©ment." : "Too many projects in implementation phase simultaneously.",
        action: lang === 'fr' ? "Ã‰chelonner les lancements pour mieux rÃ©partir les ressources" : "Stagger launches to better distribute resources"
      });
    }
    return recommendations;
  }

  /**
   * Calcule un score de santÃ© global du portfolio
   */
  function calculatePortfolioHealth(avgSuccess, criticalCount, totalProjects) {
    var score = avgSuccess;

    // PÃ©nalitÃ© pour projets critiques
    score -= criticalCount / totalProjects * 20;

    // Normaliser entre 0 et 100
    score = Math.max(0, Math.min(100, score));
    return {
      score: Math.round(score),
      level: score >= 70 ? "healthy" : score >= 50 ? "moderate" : score >= 30 ? "at_risk" : "critical",
      label: {
        fr: score >= 70 ? "Sain" : score >= 50 ? "ModÃ©rÃ©" : score >= 30 ? "Ã€ risque" : "Critique",
        en: score >= 70 ? "Healthy" : score >= 50 ? "Moderate" : score >= 30 ? "At risk" : "Critical"
      },
      color: score >= 70 ? "green" : score >= 50 ? "yellow" : score >= 30 ? "orange" : "red"
    };
  }

  /**
   * GÃ©nÃ¨re les donnÃ©es pour une carte de risque gÃ©ographique
   */
  function generateRiskMap(projects, regions) {
    var regionRisks = {};
    projects.forEach(function (project) {
      var region = project.region || project.geographicScope || "unknown";
      if (!regionRisks[region]) {
        regionRisks[region] = {
          projects: [],
          totalRisk: 0
        };
      }
      var sensitivity = SensitivityAnalyzer.runTornadoAnalysis(project, 'fr');
      regionRisks[region].projects.push({
        id: project.id,
        title: project.title,
        success: sensitivity.baseSuccessPercent
      });
      regionRisks[region].totalRisk += 100 - sensitivity.baseSuccessPercent;
    });

    // Calculer le risque moyen par rÃ©gion
    for (var region in regionRisks) {
      var data = regionRisks[region];
      data.averageRisk = Math.round(data.totalRisk / data.projects.length);
      data.riskLevel = data.averageRisk > 60 ? "critical" : data.averageRisk > 40 ? "high" : data.averageRisk > 20 ? "medium" : "low";
    }
    return regionRisks;
  }

  /**
   * Exporte le rapport portfolio en format structurÃ©
   */
  function exportPortfolioReport(portfolio, format) {
    format = format || 'json';
    var report = {
      title: "MOUDAR Portfolio Analysis Report",
      generatedAt: new Date().toISOString(),
      summary: {
        totalProjects: portfolio.totalProjects,
        averageSuccess: portfolio.averageSuccessRate + "%",
        healthScore: portfolio.healthScore.score + "/100 (" + portfolio.healthScore.label.en + ")"
      },
      riskDistribution: portfolio.riskDistribution,
      topBarriers: portfolio.topBarriers,
      recommendations: portfolio.recommendations,
      projectDetails: portfolio.projectRisks
    };
    if (format === 'json') {
      return JSON.stringify(report, null, 2);
    }
    return report;
  }
  return {
    VERSION: '8.3.0',
    aggregatePortfolio: aggregatePortfolio,
    generateRiskMap: generateRiskMap,
    exportPortfolioReport: exportPortfolioReport,
    calculatePortfolioHealth: calculatePortfolioHealth
  };
}();
window.PortfolioManager = PortfolioManager;
console.log('âœ… MOUDAR v8.3 PortfolioManager (Vue multi-projets) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— MOUDAR v8.4 - COLLABORATION & EXPORT PRO â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 1: REALTIME COLLABORATION - Supabase Realtime Integration
// Permet aux Ã©quipes de voir les modifications en temps rÃ©el
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var RealtimeCollaboration = function () {
  'use strict';

  var supabaseClient = null;
  var currentChannel = null;
  var collaborators = {};
  var callbacks = {
    onUserJoin: null,
    onUserLeave: null,
    onProjectUpdate: null,
    onCursorMove: null,
    onCommentAdd: null
  };

  // Configuration Supabase (Ã  remplir par l'utilisateur)
  var config = {
    supabaseUrl: null,
    supabaseKey: null,
    isConnected: false,
    currentUser: null,
    currentRoom: null
  };

  /**
   * Initialise la connexion Supabase
   */
  function init(supabaseUrl, supabaseKey, user) {
    if (!supabaseUrl || !supabaseKey) {
      console.warn('[RealtimeCollaboration] Configuration Supabase manquante');
      return {
        success: false,
        error: 'Configuration manquante'
      };
    }
    config.supabaseUrl = supabaseUrl;
    config.supabaseKey = supabaseKey;
    config.currentUser = user || {
      id: 'user_' + Math.random().toString(36).substr(2, 9),
      name: 'Anonyme',
      color: getRandomColor(),
      avatar: 'ðŸ‘¤'
    };

    // Charger le SDK Supabase dynamiquement si pas dÃ©jÃ  chargÃ©
    if (typeof window.supabase === 'undefined') {
      return loadSupabaseSDK().then(function () {
        return createClient();
      });
    }
    return createClient();
  }

  /**
   * Charge le SDK Supabase depuis CDN
   */
  function loadSupabaseSDK() {
    return new Promise(function (resolve, reject) {
      if (typeof window.supabase !== 'undefined') {
        resolve();
        return;
      }
      var script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
      script.onload = resolve;
      script.onerror = function () {
        reject(new Error('Impossible de charger Supabase SDK'));
      };
      document.head.appendChild(script);
    });
  }

  /**
   * CrÃ©e le client Supabase
   */
  function createClient() {
    try {
      supabaseClient = window.supabase.createClient(config.supabaseUrl, config.supabaseKey);
      config.isConnected = true;
      console.log('[RealtimeCollaboration] âœ… ConnectÃ© Ã  Supabase');
      return {
        success: true
      };
    } catch (e) {
      console.error('[RealtimeCollaboration] Erreur connexion:', e);
      return {
        success: false,
        error: e.message
      };
    }
  }

  /**
   * Rejoint une room de projet pour collaboration
   */
  function joinProjectRoom(projectId) {
    if (!supabaseClient) {
      console.warn('[RealtimeCollaboration] Client non initialisÃ©');
      return null;
    }
    config.currentRoom = projectId;

    // CrÃ©er le canal de collaboration
    currentChannel = supabaseClient.channel('project:' + projectId, {
      config: {
        presence: {
          key: config.currentUser.id
        }
      }
    });

    // Ã‰couter les Ã©vÃ©nements de prÃ©sence
    currentChannel.on('presence', {
      event: 'sync'
    }, function () {
      var state = currentChannel.presenceState();
      collaborators = {};
      for (var id in state) {
        if (state[id] && state[id][0]) {
          collaborators[id] = state[id][0];
        }
      }
      console.log('[RealtimeCollaboration] Collaborateurs:', Object.keys(collaborators).length);
    }).on('presence', {
      event: 'join'
    }, function (payload) {
      if (callbacks.onUserJoin) {
        callbacks.onUserJoin(payload.newPresences);
      }
    }).on('presence', {
      event: 'leave'
    }, function (payload) {
      if (callbacks.onUserLeave) {
        callbacks.onUserLeave(payload.leftPresences);
      }
    }).on('broadcast', {
      event: 'project_update'
    }, function (payload) {
      if (callbacks.onProjectUpdate && payload.payload.userId !== config.currentUser.id) {
        callbacks.onProjectUpdate(payload.payload);
      }
    }).on('broadcast', {
      event: 'cursor_move'
    }, function (payload) {
      if (callbacks.onCursorMove && payload.payload.userId !== config.currentUser.id) {
        callbacks.onCursorMove(payload.payload);
      }
    }).on('broadcast', {
      event: 'comment_add'
    }, function (payload) {
      if (callbacks.onCommentAdd) {
        callbacks.onCommentAdd(payload.payload);
      }
    }).subscribe(async function (status) {
      if (status === 'SUBSCRIBED') {
        await currentChannel.track(config.currentUser);
        console.log('[RealtimeCollaboration] âœ… Rejoint room:', projectId);
      }
    });
    return currentChannel;
  }

  /**
   * Quitte la room actuelle
   */
  function leaveRoom() {
    if (currentChannel) {
      currentChannel.unsubscribe();
      currentChannel = null;
      config.currentRoom = null;
      collaborators = {};
    }
  }

  /**
   * Envoie une mise Ã  jour de projet aux collaborateurs
   */
  function broadcastProjectUpdate(field, value, metadata) {
    if (!currentChannel) return;
    currentChannel.send({
      type: 'broadcast',
      event: 'project_update',
      payload: {
        userId: config.currentUser.id,
        userName: config.currentUser.name,
        field: field,
        value: value,
        metadata: metadata || {},
        timestamp: new Date().toISOString()
      }
    });
  }

  /**
   * Envoie la position du curseur
   */
  function broadcastCursor(x, y, elementId) {
    if (!currentChannel) return;
    currentChannel.send({
      type: 'broadcast',
      event: 'cursor_move',
      payload: {
        userId: config.currentUser.id,
        userName: config.currentUser.name,
        userColor: config.currentUser.color,
        x: x,
        y: y,
        elementId: elementId
      }
    });
  }

  /**
   * Ajoute un commentaire
   */
  function addComment(elementId, text) {
    if (!currentChannel) return;
    var comment = {
      id: 'comment_' + Date.now(),
      userId: config.currentUser.id,
      userName: config.currentUser.name,
      userColor: config.currentUser.color,
      elementId: elementId,
      text: text,
      timestamp: new Date().toISOString(),
      resolved: false
    };
    currentChannel.send({
      type: 'broadcast',
      event: 'comment_add',
      payload: comment
    });
    return comment;
  }

  /**
   * DÃ©finit les callbacks d'Ã©vÃ©nements
   */
  function on(event, callback) {
    if (callbacks.hasOwnProperty('on' + event.charAt(0).toUpperCase() + event.slice(1))) {
      callbacks['on' + event.charAt(0).toUpperCase() + event.slice(1)] = callback;
    }
  }

  /**
   * GÃ©nÃ¨re une couleur alÃ©atoire pour un utilisateur
   */
  function getRandomColor() {
    var colors = ['#EF4444', '#F97316', '#EAB308', '#22C55E', '#06B6D4', '#3B82F6', '#8B5CF6', '#EC4899'];
    return colors[Math.floor(Math.random() * colors.length)];
  }

  /**
   * Retourne la liste des collaborateurs actuels
   */
  function getCollaborators() {
    return Object.values(collaborators);
  }

  /**
   * Simule une collaboration (mode dÃ©mo sans Supabase)
   */
  function simulateCollaboration(projectId) {
    config.currentRoom = projectId;
    config.currentUser = {
      id: 'demo_user_1',
      name: 'Vous (DÃ©mo)',
      color: '#3B82F6',
      avatar: 'ðŸ‘¤'
    };

    // Simuler des collaborateurs
    collaborators = {
      'demo_user_2': {
        id: 'demo_user_2',
        name: 'Dr. Sarah M.',
        color: '#22C55E',
        avatar: 'ðŸ‘©â€âš•ï¸'
      },
      'demo_user_3': {
        id: 'demo_user_3',
        name: 'Prof. Ahmed B.',
        color: '#F97316',
        avatar: 'ðŸ‘¨â€ðŸ«'
      }
    };
    console.log('[RealtimeCollaboration] ðŸŽ­ Mode dÃ©mo activÃ© avec', Object.keys(collaborators).length, 'collaborateurs simulÃ©s');
    return {
      success: true,
      mode: 'demo',
      collaborators: getCollaborators()
    };
  }
  return {
    VERSION: '8.4.0',
    init: init,
    joinProjectRoom: joinProjectRoom,
    leaveRoom: leaveRoom,
    broadcastProjectUpdate: broadcastProjectUpdate,
    broadcastCursor: broadcastCursor,
    addComment: addComment,
    on: on,
    getCollaborators: getCollaborators,
    simulateCollaboration: simulateCollaboration,
    getConfig: function () {
      return config;
    },
    isConnected: function () {
      return config.isConnected;
    }
  };
}();
window.RealtimeCollaboration = RealtimeCollaboration;
console.log('âœ… MOUDAR v8.4 RealtimeCollaboration (Supabase Realtime) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 2: LOCAL LLM ENGINE - Analyse de texte avec modÃ¨le local (WebGPU)
// Utilise WebLLM pour exÃ©cuter un LLM directement dans le navigateur
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var LocalLLMEngine = function () {
  'use strict';

  var engine = null;
  var isLoading = false;
  var isReady = false;
  var currentModel = null;
  var loadProgress = 0;

  // ModÃ¨les supportÃ©s (du plus lÃ©ger au plus lourd)
  var supportedModels = {
    'TinyLlama-1.1B': {
      id: 'TinyLlama-1.1B-Chat-v1.0-q4f16_1-MLC',
      name: 'TinyLlama 1.1B',
      size: '600 MB',
      description: 'ModÃ¨le lÃ©ger, rapide, idÃ©al pour l\'analyse de barriÃ¨res',
      recommended: true
    },
    'Phi-2': {
      id: 'Phi-2-q4f16_1-MLC',
      name: 'Microsoft Phi-2',
      size: '1.5 GB',
      description: 'Excellent rapport qualitÃ©/taille'
    },
    'Llama-3-8B': {
      id: 'Llama-3-8B-Instruct-q4f16_1-MLC',
      name: 'Llama 3 8B',
      size: '4 GB',
      description: 'Meilleure qualitÃ©, nÃ©cessite GPU puissant'
    },
    'Gemma-2B': {
      id: 'Gemma-2-2b-it-q4f16_1-MLC',
      name: 'Google Gemma 2B',
      size: '1.2 GB',
      description: 'Bon Ã©quilibre performance/taille'
    }
  };

  // Prompts spÃ©cialisÃ©s pour l'implÃ©mentation science
  var specializedPrompts = {
    barrierAnalysis: {
      system: "Tu es un expert en science de l'implÃ©mentation. Analyse le texte suivant pour identifier les barriÃ¨res Ã  l'implÃ©mentation selon le framework CFIR (Consolidated Framework for Implementation Research). CatÃ©gorise chaque barriÃ¨re identifiÃ©e.",
      template: "Texte Ã  analyser:\n\n{text}\n\nIdentifie les barriÃ¨res d'implÃ©mentation et classe-les par catÃ©gorie (Inner Setting, Outer Setting, Individual, Intervention, Process):"
    },
    strategyRecommendation: {
      system: "Tu es un consultant expert en stratÃ©gies d'implÃ©mentation ERIC (Expert Recommendations for Implementing Change). Recommande les stratÃ©gies les plus adaptÃ©es.",
      template: "Contexte du projet:\n{context}\n\nBarriÃ¨res identifiÃ©es:\n{barriers}\n\nRecommande 5 stratÃ©gies ERIC prioritaires avec justification:"
    },
    textImprovement: {
      system: "Tu es un rÃ©dacteur scientifique spÃ©cialisÃ© en santÃ© publique. AmÃ©liore le texte suivant pour le rendre plus prÃ©cis et professionnel.",
      template: "Texte original:\n\n{text}\n\nVersion amÃ©liorÃ©e:"
    },
    summaryGeneration: {
      system: "Tu es un expert en rÃ©sumÃ©s exÃ©cutifs pour dÃ©cideurs en santÃ©. GÃ©nÃ¨re un rÃ©sumÃ© concis et impactant.",
      template: "Document Ã  rÃ©sumer:\n\n{text}\n\nRÃ©sumÃ© exÃ©cutif (max 200 mots):"
    }
  };

  /**
   * VÃ©rifie si WebGPU est supportÃ©
   */
  function checkWebGPUSupport() {
    if (typeof navigator === 'undefined') return {
      supported: false,
      reason: 'Not in browser'
    };
    if (!navigator.gpu) return {
      supported: false,
      reason: 'WebGPU not available'
    };
    return {
      supported: true
    };
  }

  /**
   * Charge le SDK WebLLM
   */
  function loadWebLLMSDK() {
    return new Promise(function (resolve, reject) {
      if (typeof window.webllm !== 'undefined') {
        resolve();
        return;
      }
      var script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm@0.2.46/lib/index.min.js';
      script.onload = function () {
        console.log('[LocalLLMEngine] WebLLM SDK chargÃ©');
        resolve();
      };
      script.onerror = function () {
        reject(new Error('Impossible de charger WebLLM SDK'));
      };
      document.head.appendChild(script);
    });
  }

  /**
   * Initialise le moteur LLM avec un modÃ¨le
   */
  async function init(modelKey, onProgress) {
    var webgpuCheck = checkWebGPUSupport();
    if (!webgpuCheck.supported) {
      return {
        success: false,
        error: 'WebGPU non supportÃ©: ' + webgpuCheck.reason,
        fallback: 'Utilisez l\'analyse sÃ©mantique (SemanticNLP) comme alternative'
      };
    }
    modelKey = modelKey || 'TinyLlama-1.1B';
    var modelConfig = supportedModels[modelKey];
    if (!modelConfig) {
      return {
        success: false,
        error: 'ModÃ¨le non supportÃ©: ' + modelKey
      };
    }
    isLoading = true;
    loadProgress = 0;
    try {
      await loadWebLLMSDK();

      // CrÃ©er le moteur WebLLM
      engine = new window.webllm.MLCEngine();

      // Callback de progression
      engine.setInitProgressCallback(function (report) {
        loadProgress = report.progress * 100;
        if (onProgress) {
          onProgress({
            progress: loadProgress,
            text: report.text,
            timeElapsed: report.timeElapsed
          });
        }
      });

      // Charger le modÃ¨le
      await engine.reload(modelConfig.id);
      currentModel = modelKey;
      isReady = true;
      isLoading = false;
      console.log('[LocalLLMEngine] âœ… ModÃ¨le', modelConfig.name, 'prÃªt');
      return {
        success: true,
        model: modelConfig.name,
        size: modelConfig.size
      };
    } catch (error) {
      isLoading = false;
      console.error('[LocalLLMEngine] Erreur:', error);
      return {
        success: false,
        error: error.message,
        fallback: 'Utilisez SemanticNLP comme alternative'
      };
    }
  }

  /**
   * GÃ©nÃ¨re une rÃ©ponse avec le LLM
   */
  async function generate(prompt, options) {
    options = options || {};
    if (!isReady || !engine) {
      return {
        success: false,
        error: 'Moteur non initialisÃ©. Appelez init() d\'abord.',
        fallback: analyzeWithFallback(prompt)
      };
    }
    try {
      var messages = [{
        role: 'system',
        content: options.systemPrompt || 'Tu es un assistant expert en implÃ©mentation de programmes de santÃ©.'
      }, {
        role: 'user',
        content: prompt
      }];
      var reply = await engine.chat.completions.create({
        messages: messages,
        temperature: options.temperature || 0.7,
        max_tokens: options.maxTokens || 500,
        stream: false
      });
      return {
        success: true,
        response: reply.choices[0].message.content,
        usage: reply.usage,
        model: currentModel
      };
    } catch (error) {
      console.error('[LocalLLMEngine] Erreur gÃ©nÃ©ration:', error);
      return {
        success: false,
        error: error.message,
        fallback: analyzeWithFallback(prompt)
      };
    }
  }

  /**
   * Analyse les barriÃ¨res avec le LLM
   */
  async function analyzeBarriers(text, lang) {
    lang = lang || 'fr';
    if (!isReady) {
      return analyzeWithFallback(text, 'barriers', lang);
    }
    var prompt = specializedPrompts.barrierAnalysis.template.replace('{text}', text);
    return generate(prompt, {
      systemPrompt: specializedPrompts.barrierAnalysis.system,
      temperature: 0.3,
      maxTokens: 800
    });
  }

  /**
   * Recommande des stratÃ©gies avec le LLM
   */
  async function recommendStrategies(context, barriers, lang) {
    lang = lang || 'fr';
    if (!isReady) {
      return {
        success: false,
        fallback: 'Utilisez MoudarEngine.recommend()'
      };
    }
    var prompt = specializedPrompts.strategyRecommendation.template.replace('{context}', context).replace('{barriers}', Array.isArray(barriers) ? barriers.join('\n- ') : barriers);
    return generate(prompt, {
      systemPrompt: specializedPrompts.strategyRecommendation.system,
      temperature: 0.5,
      maxTokens: 1000
    });
  }

  /**
   * AmÃ©liore un texte avec le LLM
   */
  async function improveText(text, lang) {
    if (!isReady) {
      return {
        success: false,
        error: 'LLM non initialisÃ©',
        original: text
      };
    }
    var prompt = specializedPrompts.textImprovement.template.replace('{text}', text);
    return generate(prompt, {
      systemPrompt: specializedPrompts.textImprovement.system,
      temperature: 0.6,
      maxTokens: text.length * 2
    });
  }

  /**
   * GÃ©nÃ¨re un rÃ©sumÃ© exÃ©cutif
   */
  async function generateSummary(text, lang) {
    if (!isReady) {
      return {
        success: false,
        error: 'LLM non initialisÃ©'
      };
    }
    var prompt = specializedPrompts.summaryGeneration.template.replace('{text}', text);
    return generate(prompt, {
      systemPrompt: specializedPrompts.summaryGeneration.system,
      temperature: 0.4,
      maxTokens: 400
    });
  }

  /**
   * Fallback avec SemanticNLP si LLM non disponible
   */
  function analyzeWithFallback(text, type, lang) {
    console.log('[LocalLLMEngine] Utilisation du fallback SemanticNLP');
    if (window.SemanticNLP) {
      var result = SemanticNLP.analyzeText(text, lang || 'fr');
      return {
        success: true,
        source: 'fallback_semantic_nlp',
        barriers: result.barriers,
        confidence: result.overallConfidence,
        message: 'Analyse effectuÃ©e avec SemanticNLP (LLM non disponible)'
      };
    }
    return {
      success: false,
      error: 'Ni LLM ni SemanticNLP disponible'
    };
  }

  /**
   * DÃ©charge le modÃ¨le de la mÃ©moire
   */
  async function unload() {
    if (engine) {
      await engine.unload();
      engine = null;
      isReady = false;
      currentModel = null;
      console.log('[LocalLLMEngine] ModÃ¨le dÃ©chargÃ©');
    }
  }

  /**
   * Retourne l'Ã©tat du moteur
   */
  function getStatus() {
    return {
      isReady: isReady,
      isLoading: isLoading,
      currentModel: currentModel,
      loadProgress: loadProgress,
      webgpuSupported: checkWebGPUSupport().supported
    };
  }
  return {
    VERSION: '8.4.0',
    init: init,
    generate: generate,
    analyzeBarriers: analyzeBarriers,
    recommendStrategies: recommendStrategies,
    improveText: improveText,
    generateSummary: generateSummary,
    unload: unload,
    getStatus: getStatus,
    getSupportedModels: function () {
      return supportedModels;
    },
    checkWebGPUSupport: checkWebGPUSupport
  };
}();
window.LocalLLMEngine = LocalLLMEngine;
console.log('âœ… MOUDAR v8.4 LocalLLMEngine (WebGPU LLM) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 3: POWERPOINT EXPORTER - Export automatisÃ© de prÃ©sentations PPTX
// GÃ©nÃ¨re des prÃ©sentations professionnelles Ã  partir des protocoles
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var PowerPointExporter = function () {
  'use strict';

  var pptxgenjs = null;
  var isReady = false;

  // ThÃ¨mes de prÃ©sentation
  var themes = {
    'professional': {
      name: 'Professionnel',
      colors: {
        primary: '1E3A5F',
        secondary: '2E7D32',
        accent: 'FF6B35',
        text: '333333',
        lightBg: 'F5F7FA',
        darkBg: '1E3A5F'
      },
      fonts: {
        title: 'Helvetica Neue',
        body: 'Helvetica Neue'
      }
    },
    'modern': {
      name: 'Moderne',
      colors: {
        primary: '6366F1',
        secondary: '10B981',
        accent: 'F59E0B',
        text: '1F2937',
        lightBg: 'F9FAFB',
        darkBg: '111827'
      },
      fonts: {
        title: 'Helvetica Neue',
        body: 'Helvetica Neue'
      }
    },
    'health': {
      name: 'SantÃ©',
      colors: {
        primary: '0891B2',
        secondary: '059669',
        accent: 'DC2626',
        text: '1F2937',
        lightBg: 'ECFEFF',
        darkBg: '164E63'
      },
      fonts: {
        title: 'Helvetica Neue',
        body: 'Helvetica Neue'
      }
    },
    'anthropic': {
      name: 'Anthropic',
      colors: {
        primary: 'DA7756',
        secondary: '1A1A2E',
        accent: 'E8DCC4',
        text: '1A1A2E',
        lightBg: 'FDF8F4',
        darkBg: '1A1A2E'
      },
      fonts: {
        title: 'Helvetica Neue',
        body: 'Helvetica Neue'
      }
    }
  };

  /**
   * Charge la bibliothÃ¨que PptxGenJS
   */
  function loadPptxGenJS() {
    return new Promise(function (resolve, reject) {
      if (typeof window.PptxGenJS !== 'undefined') {
        pptxgenjs = window.PptxGenJS;
        isReady = true;
        resolve();
        return;
      }
      var script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js';
      script.onload = function () {
        pptxgenjs = window.PptxGenJS;
        isReady = true;
        console.log('[PowerPointExporter] âœ… PptxGenJS chargÃ©');
        resolve();
      };
      script.onerror = function () {
        reject(new Error('Impossible de charger PptxGenJS'));
      };
      document.head.appendChild(script);
    });
  }

  /**
   * Initialise l'exporteur
   */
  async function init() {
    try {
      await loadPptxGenJS();
      return {
        success: true
      };
    } catch (error) {
      return {
        success: false,
        error: error.message
      };
    }
  }

  /**
   * CrÃ©e une prÃ©sentation complÃ¨te Ã  partir d'un protocole MOUDAR
   */
  async function createFromProtocol(project, protocol, options) {
    options = options || {};
    var lang = options.lang || 'fr';
    var themeName = options.theme || 'professional';
    var theme = themes[themeName] || themes.professional;
    if (!isReady) {
      await init();
    }
    var pptx = new pptxgenjs();

    // MÃ©tadonnÃ©es
    pptx.author = 'MOUDAR Platform v8.4';
    pptx.title = project.title || 'Protocole d\'implÃ©mentation';
    pptx.subject = 'Protocole gÃ©nÃ©rÃ© par MOUDAR';
    pptx.company = project.organization || 'MOUDAR';

    // Layout
    pptx.defineLayout({
      name: 'MOUDAR',
      width: 13.33,
      height: 7.5
    });
    pptx.layout = 'MOUDAR';

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SLIDE 1: Page de titre
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    var slide1 = pptx.addSlide();
    slide1.background = {
      color: theme.colors.darkBg
    };

    // Logo MOUDAR
    slide1.addText('ðŸ”¬ MOUDAR', {
      x: 0.5,
      y: 0.5,
      w: 3,
      h: 0.6,
      fontSize: 18,
      color: 'FFFFFF',
      fontFace: theme.fonts.title
    });

    // Titre principal
    slide1.addText(project.title || 'Protocole d\'implÃ©mentation', {
      x: 0.5,
      y: 2.5,
      w: 12.33,
      h: 1.2,
      fontSize: 36,
      color: 'FFFFFF',
      fontFace: theme.fonts.title,
      bold: true
    });

    // Sous-titre
    slide1.addText(project.organization || '', {
      x: 0.5,
      y: 3.8,
      w: 12.33,
      h: 0.6,
      fontSize: 20,
      color: theme.colors.accent,
      fontFace: theme.fonts.body
    });

    // Phase EPIS
    var phaseLabels = {
      exploration: 'Exploration',
      preparation: 'PrÃ©paration',
      implementation: 'ImplÃ©mentation',
      sustainment: 'PÃ©rennisation'
    };
    slide1.addText('Phase EPIS: ' + (phaseLabels[project.phase] || project.phase || 'Non dÃ©finie'), {
      x: 0.5,
      y: 5,
      w: 5,
      h: 0.5,
      fontSize: 14,
      color: 'FFFFFF',
      fontFace: theme.fonts.body
    });

    // Date
    slide1.addText(new Date().toLocaleDateString(lang === 'fr' ? 'fr-FR' : 'en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    }), {
      x: 0.5,
      y: 6.5,
      w: 5,
      h: 0.4,
      fontSize: 12,
      color: 'AAAAAA',
      fontFace: theme.fonts.body
    });

    // GÃ©nÃ©rÃ© par MOUDAR
    slide1.addText('GÃ©nÃ©rÃ© par MOUDAR v8.4 - Intelligence Prescriptive', {
      x: 7,
      y: 6.5,
      w: 5.83,
      h: 0.4,
      fontSize: 10,
      color: 'AAAAAA',
      fontFace: theme.fonts.body,
      align: 'right'
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SLIDE 2: Contexte et ProblÃ©matique
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    var slide2 = pptx.addSlide();
    addSlideHeader(slide2, lang === 'fr' ? 'Contexte et ProblÃ©matique' : 'Context and Problem', theme, '1/8');
    slide2.addText(project.context || 'Non renseignÃ©', {
      x: 0.5,
      y: 1.5,
      w: 12.33,
      h: 4,
      fontSize: 14,
      color: theme.colors.text,
      fontFace: theme.fonts.body,
      valign: 'top',
      breakLine: true
    });

    // EncadrÃ© population cible
    slide2.addShape(pptxgenjs.shapes.RECTANGLE, {
      x: 0.5,
      y: 5.8,
      w: 6,
      h: 1,
      fill: {
        color: theme.colors.lightBg
      },
      line: {
        color: theme.colors.primary,
        width: 1
      }
    });
    slide2.addText('ðŸ‘¥ ' + (lang === 'fr' ? 'Population cible' : 'Target Population') + '\n' + (project.population || 'Non dÃ©finie'), {
      x: 0.6,
      y: 5.9,
      w: 5.8,
      h: 0.8,
      fontSize: 11,
      color: theme.colors.text,
      fontFace: theme.fonts.body,
      valign: 'middle'
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SLIDE 3: BarriÃ¨res IdentifiÃ©es
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    var slide3 = pptx.addSlide();
    addSlideHeader(slide3, lang === 'fr' ? 'BarriÃ¨res IdentifiÃ©es' : 'Identified Barriers', theme, '2/8');
    var barriers = project.barriers || project.barrierCategories || [];
    var barrierLabels = {
      "knowledge": "ðŸ“š Connaissances / Formation",
      "attitudes": "ðŸ§  Attitudes / RÃ©sistance",
      "resources": "ðŸ’µ Ressources",
      "infrastructure": "ðŸ—ï¸ Infrastructure",
      "leadership": "ðŸ‘” Leadership",
      "culture": "ðŸŒ Culture / Stigma",
      "policy": "ðŸ“œ Politiques",
      "coordination": "ðŸ”— Coordination",
      "turnover": "ðŸ”„ Turnover",
      "complexity": "ðŸ§© ComplexitÃ©"
    };
    if (typeof barriers === 'string') {
      slide3.addText(barriers, {
        x: 0.5,
        y: 1.5,
        w: 12.33,
        h: 5,
        fontSize: 14,
        color: theme.colors.text,
        fontFace: theme.fonts.body,
        valign: 'top'
      });
    } else if (Array.isArray(barriers) && barriers.length > 0) {
      var barrierText = barriers.map(function (b) {
        return barrierLabels[b] || b;
      }).join('\n');
      slide3.addText(barrierText, {
        x: 0.5,
        y: 1.5,
        w: 12.33,
        h: 5,
        fontSize: 16,
        color: theme.colors.text,
        fontFace: theme.fonts.body,
        valign: 'top',
        bullet: true
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SLIDE 4: StratÃ©gies RecommandÃ©es
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    var slide4 = pptx.addSlide();
    addSlideHeader(slide4, lang === 'fr' ? 'StratÃ©gies RecommandÃ©es' : 'Recommended Strategies', theme, '3/8');
    var strategies = protocol.strategies || [];
    if (strategies.length > 0) {
      var strategyText = strategies.slice(0, 8).map(function (s, i) {
        return i + 1 + '. ' + (typeof s === 'string' ? s : s.name || s.label || JSON.stringify(s));
      }).join('\n');
      slide4.addText(strategyText, {
        x: 0.5,
        y: 1.5,
        w: 12.33,
        h: 5,
        fontSize: 14,
        color: theme.colors.text,
        fontFace: theme.fonts.body,
        valign: 'top'
      });
    }

    // Badge confiance
    var confidence = protocol.confidence || protocol.aiConfidence || 0.75;
    slide4.addShape(pptxgenjs.shapes.OVAL, {
      x: 11,
      y: 6,
      w: 1.8,
      h: 0.8,
      fill: {
        color: confidence > 0.7 ? '22C55E' : confidence > 0.5 ? 'EAB308' : 'EF4444'
      }
    });
    slide4.addText(Math.round(confidence * 100) + '%', {
      x: 11,
      y: 6.15,
      w: 1.8,
      h: 0.5,
      fontSize: 14,
      color: 'FFFFFF',
      fontFace: theme.fonts.title,
      bold: true,
      align: 'center'
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SLIDE 5: Frameworks & Outcomes
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    var slide5 = pptx.addSlide();
    addSlideHeader(slide5, 'Frameworks & Outcomes', theme, '4/8');

    // Colonne Frameworks
    slide5.addText('ðŸ“ Frameworks', {
      x: 0.5,
      y: 1.5,
      w: 6,
      h: 0.5,
      fontSize: 16,
      color: theme.colors.primary,
      fontFace: theme.fonts.title,
      bold: true
    });
    var frameworks = protocol.frameworks || ['CFIR 2.0', 'EPIS', 'RE-AIM', 'Proctor Outcomes'];
    slide5.addText(frameworks.join('\n'), {
      x: 0.5,
      y: 2.2,
      w: 6,
      h: 3,
      fontSize: 14,
      color: theme.colors.text,
      fontFace: theme.fonts.body,
      bullet: true
    });

    // Colonne Outcomes
    slide5.addText('ðŸŽ¯ Outcomes', {
      x: 6.83,
      y: 1.5,
      w: 6,
      h: 0.5,
      fontSize: 16,
      color: theme.colors.secondary,
      fontFace: theme.fonts.title,
      bold: true
    });
    var outcomes = protocol.outcomes || project.expectedOutcomes || ['AcceptabilitÃ©', 'Adoption', 'FidÃ©litÃ©', 'PÃ©rennitÃ©'];
    var outcomeLabels = {
      acceptability: 'AcceptabilitÃ©',
      adoption: 'Adoption',
      fidelity: 'FidÃ©litÃ©',
      coverage: 'Couverture',
      sustainability: 'PÃ©rennitÃ©',
      cost: 'CoÃ»t-efficacitÃ©'
    };
    var outcomesText = (Array.isArray(outcomes) ? outcomes : [outcomes]).map(function (o) {
      return outcomeLabels[o] || o;
    }).join('\n');
    slide5.addText(outcomesText, {
      x: 6.83,
      y: 2.2,
      w: 6,
      h: 3,
      fontSize: 14,
      color: theme.colors.text,
      fontFace: theme.fonts.body,
      bullet: true
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SLIDE 6: Timeline EPIS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    var slide6 = pptx.addSlide();
    addSlideHeader(slide6, 'Timeline EPIS', theme, '5/8');
    var phases = [{
      id: 'exploration',
      icon: 'ðŸ”',
      name: 'Exploration',
      color: '6366F1'
    }, {
      id: 'preparation',
      icon: 'ðŸ“‹',
      name: 'PrÃ©paration',
      color: 'F59E0B'
    }, {
      id: 'implementation',
      icon: 'âš™ï¸',
      name: 'ImplÃ©mentation',
      color: '22C55E'
    }, {
      id: 'sustainment',
      icon: 'ðŸ”„',
      name: 'PÃ©rennisation',
      color: '8B5CF6'
    }];
    var xPos = 0.5;
    phases.forEach(function (phase, idx) {
      var isActive = project.phase === phase.id;

      // Box de phase
      slide6.addShape(pptxgenjs.shapes.RECTANGLE, {
        x: xPos,
        y: 2.5,
        w: 3,
        h: 2,
        fill: {
          color: isActive ? phase.color : 'E5E7EB'
        },
        line: {
          color: phase.color,
          width: isActive ? 3 : 1
        }
      });
      slide6.addText(phase.icon + '\n' + phase.name, {
        x: xPos,
        y: 2.7,
        w: 3,
        h: 1.6,
        fontSize: isActive ? 16 : 14,
        color: isActive ? 'FFFFFF' : '6B7280',
        fontFace: theme.fonts.title,
        align: 'center',
        valign: 'middle',
        bold: isActive
      });

      // FlÃ¨che vers la suite
      if (idx < phases.length - 1) {
        slide6.addText('â†’', {
          x: xPos + 3,
          y: 3.2,
          w: 0.33,
          h: 0.5,
          fontSize: 24,
          color: '9CA3AF',
          align: 'center'
        });
      }
      xPos += 3.33;
    });

    // DurÃ©e estimÃ©e
    var timelineLabels = {
      '3': '3 mois',
      '6': '6 mois',
      '12': '12 mois',
      '18': '18 mois',
      '24': '24 mois',
      '36': '36 mois'
    };
    slide6.addText('â±ï¸ ' + (lang === 'fr' ? 'DurÃ©e estimÃ©e: ' : 'Estimated duration: ') + (timelineLabels[project.timeline] || project.timeline || 'Non dÃ©finie'), {
      x: 0.5,
      y: 5.5,
      w: 12.33,
      h: 0.5,
      fontSize: 14,
      color: theme.colors.text,
      fontFace: theme.fonts.body
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SLIDE 7: Analyse de Risque
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    var slide7 = pptx.addSlide();
    addSlideHeader(slide7, lang === 'fr' ? 'Analyse des Risques' : 'Risk Analysis', theme, '6/8');

    // Analyse Tornado si disponible
    if (window.SensitivityAnalyzer && project.barriers) {
      var analysis = SensitivityAnalyzer.runTornadoAnalysis(project, lang);
      slide7.addText('ðŸŒªï¸ ' + (lang === 'fr' ? 'ProbabilitÃ© de succÃ¨s: ' : 'Success probability: ') + analysis.baseSuccessPercent + '%', {
        x: 0.5,
        y: 1.5,
        w: 12.33,
        h: 0.6,
        fontSize: 18,
        color: analysis.baseSuccessPercent >= 60 ? '22C55E' : analysis.baseSuccessPercent >= 40 ? 'EAB308' : 'EF4444',
        fontFace: theme.fonts.title,
        bold: true
      });

      // Top 5 barriÃ¨res par impact
      var yPos = 2.3;
      analysis.barriers.slice(0, 5).forEach(function (barrier) {
        var barWidth = Math.min(barrier.percentageGain * 0.4, 10);
        var barColor = barrier.priority === 'critical' ? 'EF4444' : barrier.priority === 'high' ? 'F97316' : barrier.priority === 'medium' ? 'EAB308' : '22C55E';
        slide7.addText(barrier.barrierName, {
          x: 0.5,
          y: yPos,
          w: 3.5,
          h: 0.5,
          fontSize: 11,
          color: theme.colors.text,
          fontFace: theme.fonts.body,
          align: 'right'
        });
        slide7.addShape(pptxgenjs.shapes.RECTANGLE, {
          x: 4.2,
          y: yPos + 0.1,
          w: barWidth,
          h: 0.35,
          fill: {
            color: barColor
          }
        });
        slide7.addText('+' + Math.round(barrier.percentageGain) + '%', {
          x: 4.3 + barWidth,
          y: yPos,
          w: 1,
          h: 0.5,
          fontSize: 10,
          color: barColor,
          fontFace: theme.fonts.body
        });
        yPos += 0.6;
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SLIDE 8: Prochaines Ã‰tapes
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    var slide8 = pptx.addSlide();
    addSlideHeader(slide8, lang === 'fr' ? 'Prochaines Ã‰tapes' : 'Next Steps', theme, '7/8');
    var nextSteps = [lang === 'fr' ? '1. Valider le protocole avec les parties prenantes clÃ©s' : '1. Validate protocol with key stakeholders', lang === 'fr' ? '2. Former l\'Ã©quipe projet aux stratÃ©gies sÃ©lectionnÃ©es' : '2. Train project team on selected strategies', lang === 'fr' ? '3. Mettre en place le systÃ¨me de monitoring' : '3. Set up monitoring system', lang === 'fr' ? '4. Lancer la phase pilote' : '4. Launch pilot phase', lang === 'fr' ? '5. Ã‰valuer et ajuster selon les retours' : '5. Evaluate and adjust based on feedback'];
    slide8.addText(nextSteps.join('\n\n'), {
      x: 0.5,
      y: 1.5,
      w: 12.33,
      h: 5,
      fontSize: 16,
      color: theme.colors.text,
      fontFace: theme.fonts.body,
      valign: 'top'
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SLIDE 9: Contact & Ressources
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    var slide9 = pptx.addSlide();
    slide9.background = {
      color: theme.colors.darkBg
    };
    slide9.addText(lang === 'fr' ? 'Merci !' : 'Thank You!', {
      x: 0.5,
      y: 2,
      w: 12.33,
      h: 1,
      fontSize: 44,
      color: 'FFFFFF',
      fontFace: theme.fonts.title,
      bold: true,
      align: 'center'
    });
    slide9.addText(project.organization || '', {
      x: 0.5,
      y: 3.5,
      w: 12.33,
      h: 0.6,
      fontSize: 18,
      color: theme.colors.accent,
      fontFace: theme.fonts.body,
      align: 'center'
    });
    slide9.addText('ðŸ”¬ MOUDAR Platform v8.4\nIntelligence Prescriptive pour l\'ImplÃ©mentation', {
      x: 0.5,
      y: 5.5,
      w: 12.33,
      h: 1,
      fontSize: 12,
      color: 'AAAAAA',
      fontFace: theme.fonts.body,
      align: 'center'
    });
    return pptx;
  }

  /**
   * Ajoute un en-tÃªte standard Ã  une slide
   */
  function addSlideHeader(slide, title, theme, pageNum) {
    // Bande de titre
    slide.addShape(pptxgenjs.shapes ? pptxgenjs.shapes.RECTANGLE : 'rect', {
      x: 0,
      y: 0,
      w: 13.33,
      h: 1.2,
      fill: {
        color: theme.colors.primary
      }
    });
    slide.addText(title, {
      x: 0.5,
      y: 0.35,
      w: 10,
      h: 0.5,
      fontSize: 24,
      color: 'FFFFFF',
      fontFace: theme.fonts.title,
      bold: true
    });

    // NumÃ©ro de page
    if (pageNum) {
      slide.addText(pageNum, {
        x: 12,
        y: 0.4,
        w: 1,
        h: 0.4,
        fontSize: 12,
        color: 'FFFFFF',
        fontFace: theme.fonts.body,
        align: 'right'
      });
    }

    // Logo MOUDAR petit
    slide.addText('ðŸ”¬', {
      x: 12.5,
      y: 6.8,
      w: 0.5,
      h: 0.5,
      fontSize: 16
    });
  }

  /**
   * Exporte la prÃ©sentation
   */
  async function exportPPTX(project, protocol, options) {
    options = options || {};
    try {
      var pptx = await createFromProtocol(project, protocol, options);
      var filename = options.filename || 'MOUDAR_Protocol_' + (project.title || 'Export').replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30) + '.pptx';
      await pptx.writeFile({
        fileName: filename
      });
      console.log('[PowerPointExporter] âœ… PrÃ©sentation exportÃ©e:', filename);
      return {
        success: true,
        filename: filename,
        slides: 9
      };
    } catch (error) {
      console.error('[PowerPointExporter] Erreur export:', error);
      return {
        success: false,
        error: error.message
      };
    }
  }

  /**
   * GÃ©nÃ¨re un aperÃ§u de la prÃ©sentation (HTML)
   */
  function generatePreview(project, protocol, options) {
    options = options || {};
    var lang = options.lang || 'fr';
    var themeName = options.theme || 'professional';
    var theme = themes[themeName] || themes.professional;
    var slides = [{
      title: project.title,
      type: 'title'
    }, {
      title: lang === 'fr' ? 'Contexte' : 'Context',
      content: (project.context || '').substring(0, 100) + '...'
    }, {
      title: lang === 'fr' ? 'BarriÃ¨res' : 'Barriers',
      content: Array.isArray(project.barrierCategories) ? project.barrierCategories.length + ' identifiÃ©es' : 'Texte libre'
    }, {
      title: lang === 'fr' ? 'StratÃ©gies' : 'Strategies',
      content: (protocol.strategies || []).length + ' recommandÃ©es'
    }, {
      title: 'Frameworks',
      content: (protocol.frameworks || []).join(', ')
    }, {
      title: 'Timeline EPIS',
      content: 'Phase: ' + (project.phase || 'N/A')
    }, {
      title: lang === 'fr' ? 'Risques' : 'Risks',
      content: 'Analyse Tornado'
    }, {
      title: lang === 'fr' ? 'Prochaines Ã©tapes' : 'Next steps',
      content: '5 actions'
    }, {
      title: lang === 'fr' ? 'Merci' : 'Thank You',
      type: 'end'
    }];
    return {
      slides: slides,
      theme: theme,
      totalSlides: slides.length
    };
  }
  return {
    VERSION: '8.4.0',
    init: init,
    createFromProtocol: createFromProtocol,
    exportPPTX: exportPPTX,
    generatePreview: generatePreview,
    getThemes: function () {
      return themes;
    },
    isReady: function () {
      return isReady;
    }
  };
}();
window.PowerPointExporter = PowerPointExporter;
console.log('âœ… MOUDAR v8.4 PowerPointExporter (PPTX) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIN DES MODULES v8.4 - Collaboration & Export Pro
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
console.log('ðŸš€ MOUDAR v8.4 - Collaboration & Export Pro - Tous modules chargÃ©s');
console.log('   â€¢ RealtimeCollaboration (Supabase Realtime)');
console.log('   â€¢ LocalLLMEngine (WebGPU/WebLLM)');
console.log('   â€¢ PowerPointExporter (PptxGenJS)');
console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— MOUDAR v8.5 - MONITORING & ECOSYSTÃˆME CONNECTÃ‰ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 1: SOCIAL NETWORK ANALYZER - Analyse des rÃ©seaux de parties prenantes
// Cartographie les relations d'influence pour identifier les champions clÃ©s
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var SocialNetworkAnalyzer = function () {
  'use strict';

  // Types de parties prenantes
  var stakeholderTypes = {
    "champion": {
      icon: "â­",
      label: {
        fr: "Champion",
        en: "Champion"
      },
      influence: 0.9,
      color: "#22C55E"
    },
    "decision_maker": {
      icon: "ðŸ‘”",
      label: {
        fr: "DÃ©cideur",
        en: "Decision Maker"
      },
      influence: 0.95,
      color: "#3B82F6"
    },
    "implementer": {
      icon: "âš™ï¸",
      label: {
        fr: "ImplÃ©menteur",
        en: "Implementer"
      },
      influence: 0.7,
      color: "#8B5CF6"
    },
    "beneficiary": {
      icon: "ðŸ‘¥",
      label: {
        fr: "BÃ©nÃ©ficiaire",
        en: "Beneficiary"
      },
      influence: 0.4,
      color: "#06B6D4"
    },
    "opponent": {
      icon: "ðŸš«",
      label: {
        fr: "Opposant",
        en: "Opponent"
      },
      influence: 0.8,
      color: "#EF4444"
    },
    "neutral": {
      icon: "âšª",
      label: {
        fr: "Neutre",
        en: "Neutral"
      },
      influence: 0.3,
      color: "#9CA3AF"
    },
    "funder": {
      icon: "ðŸ’°",
      label: {
        fr: "Bailleur",
        en: "Funder"
      },
      influence: 0.85,
      color: "#F59E0B"
    },
    "technical_expert": {
      icon: "ðŸ”¬",
      label: {
        fr: "Expert technique",
        en: "Technical Expert"
      },
      influence: 0.75,
      color: "#EC4899"
    }
  };

  // Types de relations
  var relationTypes = {
    "hierarchical": {
      label: {
        fr: "HiÃ©rarchique",
        en: "Hierarchical"
      },
      strength: 0.9,
      style: "solid"
    },
    "collaborative": {
      label: {
        fr: "Collaborative",
        en: "Collaborative"
      },
      strength: 0.7,
      style: "solid"
    },
    "advisory": {
      label: {
        fr: "Conseil",
        en: "Advisory"
      },
      strength: 0.5,
      style: "dashed"
    },
    "funding": {
      label: {
        fr: "Financement",
        en: "Funding"
      },
      strength: 0.85,
      style: "solid"
    },
    "opposition": {
      label: {
        fr: "Opposition",
        en: "Opposition"
      },
      strength: -0.6,
      style: "dotted"
    },
    "influence": {
      label: {
        fr: "Influence",
        en: "Influence"
      },
      strength: 0.6,
      style: "dashed"
    }
  };

  /**
   * CrÃ©e un nouveau rÃ©seau de parties prenantes
   */
  function createNetwork(projectId) {
    return {
      projectId: projectId,
      nodes: [],
      edges: [],
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };
  }

  /**
   * Ajoute une partie prenante au rÃ©seau
   */
  function addStakeholder(network, stakeholder) {
    var node = {
      id: stakeholder.id || 'SH_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5),
      name: stakeholder.name,
      type: stakeholder.type || 'neutral',
      organization: stakeholder.organization || '',
      role: stakeholder.role || '',
      influence: stakeholder.influence || stakeholderTypes[stakeholder.type]?.influence || 0.5,
      support: stakeholder.support || 0,
      // -1 (opposant) Ã  +1 (champion)
      reach: stakeholder.reach || 1,
      // Nombre de personnes influencÃ©es
      notes: stakeholder.notes || '',
      x: stakeholder.x || Math.random() * 800,
      y: stakeholder.y || Math.random() * 600
    };
    network.nodes.push(node);
    network.updatedAt = new Date().toISOString();
    return node;
  }

  /**
   * Ajoute une relation entre deux parties prenantes
   */
  function addRelation(network, sourceId, targetId, relationType, metadata) {
    metadata = metadata || {};
    var edge = {
      id: 'REL_' + Date.now(),
      source: sourceId,
      target: targetId,
      type: relationType || 'collaborative',
      strength: metadata.strength || relationTypes[relationType]?.strength || 0.5,
      bidirectional: metadata.bidirectional !== false,
      label: metadata.label || '',
      notes: metadata.notes || ''
    };
    network.edges.push(edge);
    network.updatedAt = new Date().toISOString();
    return edge;
  }

  /**
   * Calcule les mÃ©triques de centralitÃ© pour chaque nÅ“ud
   */
  function calculateCentrality(network) {
    var nodes = network.nodes;
    var edges = network.edges;

    // Degree Centrality (nombre de connexions)
    nodes.forEach(function (node) {
      var connections = edges.filter(function (e) {
        return e.source === node.id || e.target === node.id;
      });
      node.degreeCentrality = connections.length / Math.max(nodes.length - 1, 1);
    });

    // Betweenness Centrality (approximation simplifiÃ©e)
    nodes.forEach(function (node) {
      var pathsThrough = 0;
      var totalPaths = 0;
      nodes.forEach(function (source) {
        if (source.id === node.id) return;
        nodes.forEach(function (target) {
          if (target.id === node.id || target.id === source.id) return;
          totalPaths++;

          // VÃ©rifier si le chemin passe par ce nÅ“ud
          var sourceToNode = edges.some(function (e) {
            return e.source === source.id && e.target === node.id || e.target === source.id && e.source === node.id;
          });
          var nodeToTarget = edges.some(function (e) {
            return e.source === node.id && e.target === target.id || e.target === node.id && e.source === target.id;
          });
          if (sourceToNode && nodeToTarget) pathsThrough++;
        });
      });
      node.betweennessCentrality = totalPaths > 0 ? pathsThrough / totalPaths : 0;
    });

    // Influence Score combinÃ©
    nodes.forEach(function (node) {
      node.influenceScore = node.influence * 0.4 + node.degreeCentrality * 0.3 + node.betweennessCentrality * 0.2 + Math.abs(node.support) * 0.1;
    });
    return nodes;
  }

  /**
   * Identifie les champions clÃ©s (plus haut score d'influence positif)
   */
  function identifyChampions(network, limit) {
    limit = limit || 5;
    calculateCentrality(network);
    return network.nodes.filter(function (n) {
      return n.support > 0;
    }).sort(function (a, b) {
      return b.influenceScore - a.influenceScore;
    }).slice(0, limit);
  }

  /**
   * Identifie les opposants Ã  surveiller
   */
  function identifyOpponents(network, limit) {
    limit = limit || 5;
    calculateCentrality(network);
    return network.nodes.filter(function (n) {
      return n.support < 0;
    }).sort(function (a, b) {
      return b.influenceScore - a.influenceScore;
    }).slice(0, limit);
  }

  /**
   * Identifie les "ponts" (personnes connectant diffÃ©rents groupes)
   */
  function identifyBridges(network) {
    calculateCentrality(network);
    return network.nodes.filter(function (n) {
      return n.betweennessCentrality > 0.3;
    }).sort(function (a, b) {
      return b.betweennessCentrality - a.betweennessCentrality;
    });
  }

  /**
   * GÃ©nÃ¨re des recommandations de stratÃ©gie basÃ©es sur le rÃ©seau
   */
  function generateNetworkRecommendations(network, lang) {
    lang = lang || 'fr';
    var recommendations = [];
    var champions = identifyChampions(network, 3);
    var opponents = identifyOpponents(network, 3);
    var bridges = identifyBridges(network);

    // Recommandations basÃ©es sur les champions
    if (champions.length > 0) {
      recommendations.push({
        type: 'champion_engagement',
        priority: 'high',
        title: lang === 'fr' ? 'Mobiliser les champions clÃ©s' : 'Engage key champions',
        description: lang === 'fr' ? 'Impliquez activement ' + champions[0].name + ' (score: ' + Math.round(champions[0].influenceScore * 100) + '%) comme ambassadeur principal.' : 'Actively involve ' + champions[0].name + ' (score: ' + Math.round(champions[0].influenceScore * 100) + '%) as primary ambassador.',
        stakeholders: champions.map(function (c) {
          return c.name;
        })
      });
    }

    // Recommandations basÃ©es sur les opposants
    if (opponents.length > 0) {
      recommendations.push({
        type: 'opposition_management',
        priority: 'high',
        title: lang === 'fr' ? 'GÃ©rer l\'opposition' : 'Manage opposition',
        description: lang === 'fr' ? 'Attention Ã  ' + opponents[0].name + ' - influence Ã©levÃ©e avec position nÃ©gative. StratÃ©gie de dialogue recommandÃ©e.' : 'Watch ' + opponents[0].name + ' - high influence with negative position. Dialogue strategy recommended.',
        stakeholders: opponents.map(function (o) {
          return o.name;
        })
      });
    }

    // Recommandations basÃ©es sur les ponts
    if (bridges.length > 0) {
      recommendations.push({
        type: 'bridge_leverage',
        priority: 'medium',
        title: lang === 'fr' ? 'Exploiter les connecteurs' : 'Leverage connectors',
        description: lang === 'fr' ? bridges[0].name + ' connecte diffÃ©rents groupes. Utilisez cette personne pour diffuser l\'information.' : bridges[0].name + ' connects different groups. Use this person to spread information.',
        stakeholders: bridges.map(function (b) {
          return b.name;
        })
      });
    }
    return recommendations;
  }

  /**
   * GÃ©nÃ¨re les donnÃ©es pour visualisation D3/vis.js
   */
  function getVisualizationData(network) {
    calculateCentrality(network);
    return {
      nodes: network.nodes.map(function (n) {
        var typeInfo = stakeholderTypes[n.type] || stakeholderTypes.neutral;
        return {
          id: n.id,
          label: n.name,
          title: n.organization + ' - ' + n.role,
          value: n.influenceScore * 50,
          color: typeInfo.color,
          icon: typeInfo.icon,
          shape: 'dot',
          font: {
            size: 12
          }
        };
      }),
      edges: network.edges.map(function (e) {
        var typeInfo = relationTypes[e.type] || relationTypes.collaborative;
        return {
          from: e.source,
          to: e.target,
          arrows: e.bidirectional ? undefined : 'to',
          dashes: typeInfo.style === 'dashed',
          color: e.strength < 0 ? '#EF4444' : '#6B7280',
          width: Math.abs(e.strength) * 3
        };
      })
    };
  }

  /**
   * CrÃ©e un rÃ©seau d'exemple pour dÃ©monstration
   */
  function createDemoNetwork(projectTitle, lang) {
    lang = lang || 'fr';
    var network = createNetwork('demo');

    // Ajouter des parties prenantes typiques
    var stakeholders = [{
      id: 'SH1',
      name: lang === 'fr' ? 'Dr. Fatima B.' : 'Dr. Fatima B.',
      type: 'champion',
      organization: lang === 'fr' ? 'HÃ´pital Central' : 'Central Hospital',
      role: lang === 'fr' ? 'Chef de service' : 'Department Head',
      support: 0.9
    }, {
      id: 'SH2',
      name: lang === 'fr' ? 'M. Ahmed K.' : 'Mr. Ahmed K.',
      type: 'decision_maker',
      organization: lang === 'fr' ? 'MinistÃ¨re SantÃ©' : 'Ministry of Health',
      role: lang === 'fr' ? 'Directeur rÃ©gional' : 'Regional Director',
      support: 0.6
    }, {
      id: 'SH3',
      name: lang === 'fr' ? 'Mme. Sarah L.' : 'Ms. Sarah L.',
      type: 'funder',
      organization: 'OMS',
      role: lang === 'fr' ? 'Coordinatrice' : 'Coordinator',
      support: 0.8
    }, {
      id: 'SH4',
      name: lang === 'fr' ? 'Dr. Mohammed R.' : 'Dr. Mohammed R.',
      type: 'opponent',
      organization: lang === 'fr' ? 'HÃ´pital Central' : 'Central Hospital',
      role: lang === 'fr' ? 'MÃ©decin senior' : 'Senior Physician',
      support: -0.7
    }, {
      id: 'SH5',
      name: lang === 'fr' ? 'Ã‰quipe infirmiÃ¨re' : 'Nursing Team',
      type: 'implementer',
      organization: lang === 'fr' ? 'Centre de santÃ©' : 'Health Center',
      role: lang === 'fr' ? 'Personnel soignant' : 'Care Staff',
      support: 0.3
    }, {
      id: 'SH6',
      name: lang === 'fr' ? 'Association patients' : 'Patient Association',
      type: 'beneficiary',
      organization: lang === 'fr' ? 'SociÃ©tÃ© civile' : 'Civil Society',
      role: lang === 'fr' ? 'ReprÃ©sentants' : 'Representatives',
      support: 0.7
    }, {
      id: 'SH7',
      name: lang === 'fr' ? 'Prof. Youssef M.' : 'Prof. Youssef M.',
      type: 'technical_expert',
      organization: lang === 'fr' ? 'UniversitÃ©' : 'University',
      role: lang === 'fr' ? 'Chercheur' : 'Researcher',
      support: 0.5
    }];
    stakeholders.forEach(function (s) {
      addStakeholder(network, s);
    });

    // Ajouter des relations
    addRelation(network, 'SH1', 'SH2', 'hierarchical', {
      label: lang === 'fr' ? 'Rapport Ã ' : 'Reports to'
    });
    addRelation(network, 'SH1', 'SH5', 'hierarchical', {
      label: lang === 'fr' ? 'Supervise' : 'Supervises'
    });
    addRelation(network, 'SH3', 'SH2', 'funding', {
      label: lang === 'fr' ? 'Finance' : 'Funds'
    });
    addRelation(network, 'SH1', 'SH4', 'opposition', {
      label: lang === 'fr' ? 'Conflit' : 'Conflict'
    });
    addRelation(network, 'SH7', 'SH1', 'advisory', {
      label: lang === 'fr' ? 'Conseille' : 'Advises'
    });
    addRelation(network, 'SH6', 'SH1', 'collaborative', {
      label: lang === 'fr' ? 'Partenariat' : 'Partnership'
    });
    addRelation(network, 'SH5', 'SH6', 'collaborative', {
      label: lang === 'fr' ? 'Soigne' : 'Cares for'
    });
    return network;
  }
  return {
    VERSION: '8.5.0',
    createNetwork: createNetwork,
    addStakeholder: addStakeholder,
    addRelation: addRelation,
    calculateCentrality: calculateCentrality,
    identifyChampions: identifyChampions,
    identifyOpponents: identifyOpponents,
    identifyBridges: identifyBridges,
    generateNetworkRecommendations: generateNetworkRecommendations,
    getVisualizationData: getVisualizationData,
    createDemoNetwork: createDemoNetwork,
    getStakeholderTypes: function () {
      return stakeholderTypes;
    },
    getRelationTypes: function () {
      return relationTypes;
    }
  };
}();
window.SocialNetworkAnalyzer = SocialNetworkAnalyzer;
console.log('âœ… MOUDAR v8.5 SocialNetworkAnalyzer (SNA) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 2: IMPLEMENTATION MONITOR - Suivi KPIs en temps rÃ©el
// Compare prÃ©dictions Monte Carlo vs donnÃ©es rÃ©elles (Adaptive Implementation)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var ImplementationMonitor = function () {
  'use strict';

  // KPIs standards pour l'implÃ©mentation
  var standardKPIs = {
    // Proctor Outcomes
    "adoption_rate": {
      label: {
        fr: "Taux d'adoption",
        en: "Adoption Rate"
      },
      unit: "%",
      target: 80,
      warning: 60,
      critical: 40,
      category: "proctor",
      icon: "ðŸ“ˆ"
    },
    "fidelity_score": {
      label: {
        fr: "Score de fidÃ©litÃ©",
        en: "Fidelity Score"
      },
      unit: "%",
      target: 85,
      warning: 70,
      critical: 50,
      category: "proctor",
      icon: "ðŸŽ¯"
    },
    "reach": {
      label: {
        fr: "PortÃ©e (bÃ©nÃ©ficiaires)",
        en: "Reach (beneficiaries)"
      },
      unit: "n",
      target: null,
      warning: null,
      critical: null,
      category: "reaim",
      icon: "ðŸ‘¥"
    },
    "acceptability": {
      label: {
        fr: "AcceptabilitÃ©",
        en: "Acceptability"
      },
      unit: "%",
      target: 75,
      warning: 60,
      critical: 40,
      category: "proctor",
      icon: "ðŸ‘"
    },
    // Ressources
    "budget_spent": {
      label: {
        fr: "Budget consommÃ©",
        en: "Budget Spent"
      },
      unit: "%",
      target: null,
      warning: 90,
      critical: 100,
      category: "resources",
      icon: "ðŸ’°"
    },
    "staff_trained": {
      label: {
        fr: "Personnel formÃ©",
        en: "Staff Trained"
      },
      unit: "n",
      target: null,
      warning: null,
      critical: null,
      category: "capacity",
      icon: "ðŸŽ“"
    },
    // Temps
    "timeline_progress": {
      label: {
        fr: "Avancement timeline",
        en: "Timeline Progress"
      },
      unit: "%",
      target: null,
      warning: null,
      critical: null,
      category: "time",
      icon: "ðŸ“…"
    },
    "milestones_completed": {
      label: {
        fr: "Jalons complÃ©tÃ©s",
        en: "Milestones Completed"
      },
      unit: "n",
      target: null,
      warning: null,
      critical: null,
      category: "time",
      icon: "âœ…"
    }
  };

  /**
   * CrÃ©e un nouveau monitoring pour un projet
   */
  function createMonitoring(projectId, predictions) {
    return {
      projectId: projectId,
      predictions: predictions || {},
      dataPoints: [],
      alerts: [],
      createdAt: new Date().toISOString(),
      updatedAt: new Date().toISOString()
    };
  }

  /**
   * Enregistre une mesure pour un KPI
   */
  function recordDataPoint(monitoring, kpiId, value, metadata) {
    metadata = metadata || {};
    var dataPoint = {
      id: 'DP_' + Date.now(),
      kpiId: kpiId,
      value: value,
      timestamp: metadata.timestamp || new Date().toISOString(),
      source: metadata.source || 'manual',
      notes: metadata.notes || '',
      recordedBy: metadata.recordedBy || 'unknown'
    };
    monitoring.dataPoints.push(dataPoint);
    monitoring.updatedAt = new Date().toISOString();

    // VÃ©rifier les alertes
    checkAlerts(monitoring, kpiId, value);
    return dataPoint;
  }

  /**
   * VÃ©rifie si une valeur dÃ©clenche une alerte
   */
  function checkAlerts(monitoring, kpiId, value) {
    var kpiConfig = standardKPIs[kpiId];
    if (!kpiConfig) return;
    var alert = null;
    if (kpiConfig.critical !== null && value <= kpiConfig.critical) {
      alert = {
        id: 'ALERT_' + Date.now(),
        kpiId: kpiId,
        level: 'critical',
        value: value,
        threshold: kpiConfig.critical,
        timestamp: new Date().toISOString(),
        message: kpiConfig.label.fr + ' critique: ' + value + kpiConfig.unit
      };
    } else if (kpiConfig.warning !== null && value <= kpiConfig.warning) {
      alert = {
        id: 'ALERT_' + Date.now(),
        kpiId: kpiId,
        level: 'warning',
        value: value,
        threshold: kpiConfig.warning,
        timestamp: new Date().toISOString(),
        message: kpiConfig.label.fr + ' en vigilance: ' + value + kpiConfig.unit
      };
    }
    if (alert) {
      monitoring.alerts.push(alert);
    }
    return alert;
  }

  /**
   * Calcule l'Ã©cart entre prÃ©dictions et rÃ©alitÃ©
   */
  function calculateVariance(monitoring, kpiId) {
    var prediction = monitoring.predictions[kpiId];
    if (!prediction) return null;
    var latestData = getLatestValue(monitoring, kpiId);
    if (latestData === null) return null;
    var variance = latestData - prediction;
    var variancePercent = variance / prediction * 100;
    return {
      kpiId: kpiId,
      predicted: prediction,
      actual: latestData,
      variance: variance,
      variancePercent: variancePercent,
      status: variancePercent >= -10 ? 'on_track' : variancePercent >= -25 ? 'warning' : 'critical'
    };
  }

  /**
   * RÃ©cupÃ¨re la derniÃ¨re valeur d'un KPI
   */
  function getLatestValue(monitoring, kpiId) {
    var kpiData = monitoring.dataPoints.filter(function (dp) {
      return dp.kpiId === kpiId;
    }).sort(function (a, b) {
      return new Date(b.timestamp) - new Date(a.timestamp);
    });
    return kpiData.length > 0 ? kpiData[0].value : null;
  }

  /**
   * GÃ©nÃ¨re l'historique d'un KPI pour graphique
   */
  function getKPIHistory(monitoring, kpiId, limit) {
    limit = limit || 30;
    return monitoring.dataPoints.filter(function (dp) {
      return dp.kpiId === kpiId;
    }).sort(function (a, b) {
      return new Date(a.timestamp) - new Date(b.timestamp);
    }).slice(-limit).map(function (dp) {
      return {
        date: dp.timestamp.split('T')[0],
        value: dp.value
      };
    });
  }

  /**
   * GÃ©nÃ¨re un tableau de bord complet
   */
  function generateDashboard(monitoring, lang) {
    lang = lang || 'fr';
    var dashboard = {
      projectId: monitoring.projectId,
      generatedAt: new Date().toISOString(),
      summary: {
        totalDataPoints: monitoring.dataPoints.length,
        activeAlerts: monitoring.alerts.filter(function (a) {
          return !a.resolved;
        }).length,
        kpisTracked: function () {
          var uniqueKpis = {};
          monitoring.dataPoints.forEach(function (dp) {
            uniqueKpis[dp.kpiId] = true;
          });
          return Object.keys(uniqueKpis).length;
        }()
      },
      kpis: [],
      alerts: monitoring.alerts.slice(-10),
      variances: []
    };

    // Calculer le statut de chaque KPI
    for (var kpiId in standardKPIs) {
      var kpiConfig = standardKPIs[kpiId];
      var latest = getLatestValue(monitoring, kpiId);
      var variance = calculateVariance(monitoring, kpiId);
      dashboard.kpis.push({
        id: kpiId,
        label: kpiConfig.label[lang] || kpiConfig.label.fr,
        icon: kpiConfig.icon,
        unit: kpiConfig.unit,
        target: kpiConfig.target,
        current: latest,
        status: latest === null ? 'no_data' : kpiConfig.target && latest >= kpiConfig.target ? 'achieved' : kpiConfig.warning && latest <= kpiConfig.warning ? 'warning' : kpiConfig.critical && latest <= kpiConfig.critical ? 'critical' : 'on_track',
        history: getKPIHistory(monitoring, kpiId, 10)
      });
      if (variance) {
        dashboard.variances.push(variance);
      }
    }

    // Score global d'implÃ©mentation
    var achievedKPIs = dashboard.kpis.filter(function (k) {
      return k.status === 'achieved' || k.status === 'on_track';
    }).length;
    var trackedKPIs = dashboard.kpis.filter(function (k) {
      return k.status !== 'no_data';
    }).length;
    dashboard.summary.implementationScore = trackedKPIs > 0 ? Math.round(achievedKPIs / trackedKPIs * 100) : 0;
    return dashboard;
  }

  /**
   * GÃ©nÃ¨re des recommandations adaptatives basÃ©es sur les Ã©carts
   */
  function generateAdaptiveRecommendations(monitoring, lang) {
    lang = lang || 'fr';
    var recommendations = [];
    for (var kpiId in standardKPIs) {
      var variance = calculateVariance(monitoring, kpiId);
      if (!variance || variance.status === 'on_track') continue;
      var kpiConfig = standardKPIs[kpiId];
      if (variance.status === 'critical') {
        recommendations.push({
          priority: 'critical',
          kpiId: kpiId,
          kpiLabel: kpiConfig.label[lang],
          title: lang === 'fr' ? 'ðŸ”´ Ã‰cart critique sur ' + kpiConfig.label.fr : 'ðŸ”´ Critical gap on ' + kpiConfig.label.en,
          description: lang === 'fr' ? 'PrÃ©dit: ' + variance.predicted + kpiConfig.unit + ' | RÃ©el: ' + variance.actual + kpiConfig.unit + ' (' + Math.round(variance.variancePercent) + '%)' : 'Predicted: ' + variance.predicted + kpiConfig.unit + ' | Actual: ' + variance.actual + kpiConfig.unit + ' (' + Math.round(variance.variancePercent) + '%)',
          action: getAdaptiveAction(kpiId, variance, lang)
        });
      } else if (variance.status === 'warning') {
        recommendations.push({
          priority: 'warning',
          kpiId: kpiId,
          kpiLabel: kpiConfig.label[lang],
          title: lang === 'fr' ? 'ðŸŸ  Vigilance sur ' + kpiConfig.label.fr : 'ðŸŸ  Watch ' + kpiConfig.label.en,
          description: lang === 'fr' ? 'Ã‰cart de ' + Math.round(variance.variancePercent) + '% par rapport aux prÃ©visions' : Math.round(variance.variancePercent) + '% gap from predictions',
          action: getAdaptiveAction(kpiId, variance, lang)
        });
      }
    }
    return recommendations.sort(function (a, b) {
      var priorityOrder = {
        critical: 0,
        warning: 1
      };
      return priorityOrder[a.priority] - priorityOrder[b.priority];
    });
  }

  /**
   * GÃ©nÃ¨re une action adaptative pour un KPI spÃ©cifique
   */
  function getAdaptiveAction(kpiId, variance, lang) {
    var actions = {
      "adoption_rate": {
        fr: "Intensifier la formation et identifier de nouveaux champions locaux",
        en: "Intensify training and identify new local champions"
      },
      "fidelity_score": {
        fr: "Renforcer la supervision et simplifier les protocoles si nÃ©cessaire",
        en: "Strengthen supervision and simplify protocols if necessary"
      },
      "budget_spent": {
        fr: "RÃ©viser le budget et identifier les sources de surcoÃ»t",
        en: "Review budget and identify cost overrun sources"
      },
      "acceptability": {
        fr: "Organiser des sessions d'Ã©coute avec les utilisateurs",
        en: "Organize listening sessions with users"
      }
    };
    var action = actions[kpiId];
    return action ? action[lang] || action.fr : lang === 'fr' ? 'Analyser les causes et ajuster la stratÃ©gie' : 'Analyze causes and adjust strategy';
  }

  /**
   * CrÃ©e des donnÃ©es de dÃ©mo pour illustration
   */
  function createDemoMonitoring(projectId, predictions) {
    var monitoring = createMonitoring(projectId, predictions || {
      adoption_rate: 75,
      fidelity_score: 80,
      reach: 500,
      acceptability: 70
    });

    // Simuler 6 mois de donnÃ©es
    var months = ['2024-07', '2024-08', '2024-09', '2024-10', '2024-11', '2024-12'];
    var adoptionValues = [15, 35, 52, 61, 68, 72];
    var fidelityValues = [60, 72, 78, 75, 80, 82];
    var reachValues = [50, 120, 210, 320, 410, 485];
    months.forEach(function (month, i) {
      recordDataPoint(monitoring, 'adoption_rate', adoptionValues[i], {
        timestamp: month + '-15T10:00:00Z'
      });
      recordDataPoint(monitoring, 'fidelity_score', fidelityValues[i], {
        timestamp: month + '-15T10:00:00Z'
      });
      recordDataPoint(monitoring, 'reach', reachValues[i], {
        timestamp: month + '-15T10:00:00Z'
      });
    });
    return monitoring;
  }
  return {
    VERSION: '8.5.0',
    createMonitoring: createMonitoring,
    recordDataPoint: recordDataPoint,
    calculateVariance: calculateVariance,
    getLatestValue: getLatestValue,
    getKPIHistory: getKPIHistory,
    generateDashboard: generateDashboard,
    generateAdaptiveRecommendations: generateAdaptiveRecommendations,
    createDemoMonitoring: createDemoMonitoring,
    getStandardKPIs: function () {
      return standardKPIs;
    }
  };
}();
window.ImplementationMonitor = ImplementationMonitor;
console.log('âœ… MOUDAR v8.5 ImplementationMonitor (KPIs temps rÃ©el) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 3: GEO MAP ENGINE - Cartographie gÃ©o-spatiale (Leaflet)
// Visualise les sites d'implÃ©mentation et disparitÃ©s rÃ©gionales
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var GeoMapEngine = function () {
  'use strict';

  var leafletLoaded = false;
  var mapInstance = null;

  // CoordonnÃ©es des pays par dÃ©faut
  var countryCoordinates = {
    "morocco": {
      lat: 31.7917,
      lng: -7.0926,
      zoom: 6
    },
    "tunisia": {
      lat: 33.8869,
      lng: 9.5375,
      zoom: 7
    },
    "senegal": {
      lat: 14.4974,
      lng: -14.4524,
      zoom: 7
    },
    "algeria": {
      lat: 28.0339,
      lng: 1.6596,
      zoom: 5
    },
    "france": {
      lat: 46.2276,
      lng: 2.2137,
      zoom: 6
    },
    "switzerland": {
      lat: 46.8182,
      lng: 8.2275,
      zoom: 8
    },
    "mali": {
      lat: 17.5707,
      lng: -3.9962,
      zoom: 5
    },
    "cameroon": {
      lat: 7.3697,
      lng: 12.3547,
      zoom: 6
    },
    "cote_ivoire": {
      lat: 7.5400,
      lng: -5.5471,
      zoom: 7
    },
    "burkina_faso": {
      lat: 12.2383,
      lng: -1.5616,
      zoom: 7
    }
  };

  // RÃ©gions du Maroc avec coordonnÃ©es
  var moroccoRegions = {
    "casablanca_settat": {
      lat: 33.5731,
      lng: -7.5898,
      name: "Casablanca-Settat"
    },
    "rabat_sale_kenitra": {
      lat: 34.0209,
      lng: -6.8416,
      name: "Rabat-SalÃ©-KÃ©nitra"
    },
    "marrakech_safi": {
      lat: 31.6295,
      lng: -7.9811,
      name: "Marrakech-Safi"
    },
    "fes_meknes": {
      lat: 34.0181,
      lng: -5.0078,
      name: "FÃ¨s-MeknÃ¨s"
    },
    "tanger_tetouan": {
      lat: 35.7595,
      lng: -5.8340,
      name: "Tanger-TÃ©touan-Al HoceÃ¯ma"
    },
    "oriental": {
      lat: 34.6867,
      lng: -1.9114,
      name: "Oriental"
    },
    "beni_mellal": {
      lat: 32.3373,
      lng: -6.3498,
      name: "BÃ©ni Mellal-KhÃ©nifra"
    },
    "draa_tafilalet": {
      lat: 31.9314,
      lng: -4.4288,
      name: "DrÃ¢a-Tafilalet"
    },
    "souss_massa": {
      lat: 30.4278,
      lng: -9.5981,
      name: "Souss-Massa"
    },
    "guelmim_oued_noun": {
      lat: 28.9870,
      lng: -10.0574,
      name: "Guelmim-Oued Noun"
    },
    "laayoune_sakia": {
      lat: 27.1536,
      lng: -13.1990,
      name: "LaÃ¢youne-Sakia El Hamra"
    },
    "dakhla_oued": {
      lat: 23.6847,
      lng: -15.9580,
      name: "Dakhla-Oued Ed-Dahab"
    }
  };

  /**
   * Charge Leaflet depuis CDN
   */
  function loadLeaflet() {
    return new Promise(function (resolve, reject) {
      if (leafletLoaded && window.L) {
        resolve();
        return;
      }

      // Charger le CSS
      var css = document.createElement('link');
      css.rel = 'stylesheet';
      css.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
      document.head.appendChild(css);

      // Charger le JS
      var script = document.createElement('script');
      script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
      script.onload = function () {
        leafletLoaded = true;
        console.log('[GeoMapEngine] Leaflet chargÃ©');
        resolve();
      };
      script.onerror = function () {
        reject(new Error('Impossible de charger Leaflet'));
      };
      document.head.appendChild(script);
    });
  }

  /**
   * Initialise une carte dans un conteneur
   */
  async function initMap(containerId, options) {
    options = options || {};
    await loadLeaflet();
    var country = options.country || 'morocco';
    var coords = countryCoordinates[country] || countryCoordinates.morocco;
    mapInstance = L.map(containerId).setView([coords.lat, coords.lng], options.zoom || coords.zoom);

    // Ajouter la couche de tuiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(mapInstance);
    return mapInstance;
  }

  /**
   * Ajoute un site d'implÃ©mentation sur la carte
   */
  function addSite(site, options) {
    options = options || {};
    if (!mapInstance || !window.L) return null;
    var color = options.color || getStatusColor(site.status);
    var icon = L.divIcon({
      className: 'custom-marker',
      html: '<div style="background-color: ' + color + '; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">' + (site.icon || 'ðŸ“') + '</div>',
      iconSize: [24, 24]
    });
    var marker = L.marker([site.lat, site.lng], {
      icon: icon
    }).addTo(mapInstance);

    // Popup avec informations
    var popupContent = '<div style="min-width: 200px;">' + '<h4 style="margin: 0 0 8px 0; font-weight: bold;">' + site.name + '</h4>' + '<p style="margin: 4px 0; font-size: 12px; color: #666;">' + (site.type || '') + '</p>' + (site.stats ? '<div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #eee;">' + '<p style="margin: 2px 0; font-size: 11px;">ðŸ‘¥ ' + (site.stats.beneficiaries || 0) + ' bÃ©nÃ©ficiaires</p>' + '<p style="margin: 2px 0; font-size: 11px;">ðŸ“ˆ ' + (site.stats.adoptionRate || 0) + '% adoption</p>' + '</div>' : '') + '</div>';
    marker.bindPopup(popupContent);
    return marker;
  }

  /**
   * Retourne la couleur selon le statut
   */
  function getStatusColor(status) {
    var colors = {
      'success': '#22C55E',
      'on_track': '#3B82F6',
      'warning': '#F59E0B',
      'critical': '#EF4444',
      'not_started': '#9CA3AF'
    };
    return colors[status] || colors.on_track;
  }

  /**
   * Ajoute plusieurs sites en une fois
   */
  function addSites(sites) {
    var markers = [];
    sites.forEach(function (site) {
      var marker = addSite(site);
      if (marker) markers.push(marker);
    });
    return markers;
  }

  /**
   * Ajoute une zone (cercle) de couverture
   */
  function addCoverageZone(center, radiusKm, options) {
    options = options || {};
    if (!mapInstance || !window.L) return null;
    var circle = L.circle([center.lat, center.lng], {
      radius: radiusKm * 1000,
      color: options.color || '#3B82F6',
      fillColor: options.fillColor || '#3B82F6',
      fillOpacity: options.opacity || 0.2,
      weight: 2
    }).addTo(mapInstance);
    return circle;
  }

  /**
   * Ajoute une heatmap des performances
   */
  function addHeatmapLayer(sites) {
    // NÃ©cessite leaflet.heat plugin - version simplifiÃ©e avec cercles
    if (!mapInstance || !window.L) return;
    sites.forEach(function (site) {
      if (!site.intensity) return;
      var color = site.intensity > 0.7 ? '#22C55E' : site.intensity > 0.4 ? '#F59E0B' : '#EF4444';
      L.circle([site.lat, site.lng], {
        radius: site.intensity * 50000,
        color: 'transparent',
        fillColor: color,
        fillOpacity: 0.3
      }).addTo(mapInstance);
    });
  }

  /**
   * GÃ©nÃ¨re des sites de dÃ©mo pour le Maroc
   */
  function generateDemoSites(country) {
    country = country || 'morocco';
    var sites = [];
    if (country === 'morocco') {
      sites = [{
        id: 'S1',
        name: 'CHU Ibn Sina',
        lat: 34.0209,
        lng: -6.8416,
        type: 'HÃ´pital universitaire',
        status: 'success',
        stats: {
          beneficiaries: 12500,
          adoptionRate: 85
        }
      }, {
        id: 'S2',
        name: 'Centre de santÃ© Hay Mohammadi',
        lat: 33.5731,
        lng: -7.5898,
        type: 'Centre de santÃ©',
        status: 'on_track',
        stats: {
          beneficiaries: 3200,
          adoptionRate: 72
        }
      }, {
        id: 'S3',
        name: 'HÃ´pital rÃ©gional Marrakech',
        lat: 31.6295,
        lng: -7.9811,
        type: 'HÃ´pital rÃ©gional',
        status: 'warning',
        stats: {
          beneficiaries: 5800,
          adoptionRate: 58
        }
      }, {
        id: 'S4',
        name: 'Centre rural Ouarzazate',
        lat: 30.9189,
        lng: -6.8936,
        type: 'Centre rural',
        status: 'critical',
        stats: {
          beneficiaries: 890,
          adoptionRate: 35
        }
      }, {
        id: 'S5',
        name: 'CHU FÃ¨s',
        lat: 34.0181,
        lng: -5.0078,
        type: 'HÃ´pital universitaire',
        status: 'success',
        stats: {
          beneficiaries: 9400,
          adoptionRate: 81
        }
      }, {
        id: 'S6',
        name: 'Centre Tanger',
        lat: 35.7595,
        lng: -5.8340,
        type: 'Centre de santÃ©',
        status: 'on_track',
        stats: {
          beneficiaries: 4100,
          adoptionRate: 68
        }
      }, {
        id: 'S7',
        name: 'Dispensaire Errachidia',
        lat: 31.9314,
        lng: -4.4288,
        type: 'Dispensaire rural',
        status: 'warning',
        stats: {
          beneficiaries: 620,
          adoptionRate: 45
        }
      }];
    }
    return sites;
  }

  /**
   * Calcule les statistiques gÃ©ographiques
   */
  function calculateGeoStats(sites) {
    var stats = {
      totalSites: sites.length,
      totalBeneficiaries: 0,
      avgAdoptionRate: 0,
      byStatus: {
        success: 0,
        on_track: 0,
        warning: 0,
        critical: 0
      },
      urbanVsRural: {
        urban: 0,
        rural: 0
      }
    };
    var adoptionSum = 0;
    sites.forEach(function (site) {
      if (site.stats) {
        stats.totalBeneficiaries += site.stats.beneficiaries || 0;
        adoptionSum += site.stats.adoptionRate || 0;
      }
      stats.byStatus[site.status] = (stats.byStatus[site.status] || 0) + 1;
      var isRural = site.type && (site.type.toLowerCase().indexOf('rural') !== -1 || site.type.toLowerCase().indexOf('dispensaire') !== -1);
      if (isRural) stats.urbanVsRural.rural++;else stats.urbanVsRural.urban++;
    });
    stats.avgAdoptionRate = sites.length > 0 ? Math.round(adoptionSum / sites.length) : 0;
    return stats;
  }

  /**
   * Centre la carte sur un pays
   */
  function centerOnCountry(country) {
    if (!mapInstance) return;
    var coords = countryCoordinates[country];
    if (coords) {
      mapInstance.setView([coords.lat, coords.lng], coords.zoom);
    }
  }

  /**
   * Nettoie la carte
   */
  function clearMap() {
    if (mapInstance) {
      mapInstance.eachLayer(function (layer) {
        if (layer instanceof L.Marker || layer instanceof L.Circle) {
          mapInstance.removeLayer(layer);
        }
      });
    }
  }
  return {
    VERSION: '8.5.0',
    loadLeaflet: loadLeaflet,
    initMap: initMap,
    addSite: addSite,
    addSites: addSites,
    addCoverageZone: addCoverageZone,
    addHeatmapLayer: addHeatmapLayer,
    generateDemoSites: generateDemoSites,
    calculateGeoStats: calculateGeoStats,
    centerOnCountry: centerOnCountry,
    clearMap: clearMap,
    getCountryCoordinates: function () {
      return countryCoordinates;
    },
    getMoroccoRegions: function () {
      return moroccoRegions;
    }
  };
}();
window.GeoMapEngine = GeoMapEngine;
console.log('âœ… MOUDAR v8.5 GeoMapEngine (Leaflet) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 4: SCALING SIMULATOR - ModÃ©lisation de mise Ã  l'Ã©chelle
// Calcule les besoins et risques pour passer du pilote au national
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var ScalingSimulator = function () {
  'use strict';

  // Facteurs de scaling par dimension
  var scalingFactors = {
    // Ã‰conomies d'Ã©chelle (rÃ©duction des coÃ»ts unitaires)
    economiesOfScale: {
      training: {
        threshold: 100,
        reduction: 0.15
      },
      // -15% aprÃ¨s 100 formÃ©s
      materials: {
        threshold: 1000,
        reduction: 0.25
      },
      // -25% aprÃ¨s 1000 unitÃ©s
      supervision: {
        threshold: 50,
        reduction: 0.10
      } // -10% aprÃ¨s 50 sites
    },
    // CoÃ»ts additionnels du scaling
    scalingCosts: {
      coordination: 0.12,
      // +12% pour coordination inter-sites
      qualityAssurance: 0.08,
      // +8% pour assurance qualitÃ©
      monitoring: 0.10,
      // +10% pour systÃ¨me de suivi
      adaptation: 0.05 // +5% pour adaptation locale
    },
    // Risques de scaling
    scalingRisks: {
      fidelityDilution: {
        baseRisk: 0.15,
        perSiteFactor: 0.002
      },
      staffTurnover: {
        baseRisk: 0.20,
        perSiteFactor: 0.003
      },
      qualityVariance: {
        baseRisk: 0.18,
        perSiteFactor: 0.0025
      },
      coordinationBreakdown: {
        baseRisk: 0.12,
        perSiteFactor: 0.004
      },
      supplyChainIssues: {
        baseRisk: 0.10,
        perSiteFactor: 0.002
      }
    }
  };

  /**
   * Calcule le coÃ»t de mise Ã  l'Ã©chelle
   */
  function calculateScalingCost(pilotData, targetScale) {
    var pilotCost = pilotData.totalCost || 100000;
    var pilotSites = pilotData.sites || 5;
    var pilotBeneficiaries = pilotData.beneficiaries || 500;
    var targetSites = targetScale.sites || 100;
    var targetBeneficiaries = targetScale.beneficiaries || 10000;

    // CoÃ»t unitaire pilote
    var costPerSite = pilotCost / pilotSites;
    var costPerBeneficiary = pilotCost / pilotBeneficiaries;

    // Appliquer les Ã©conomies d'Ã©chelle
    var siteMultiplier = 1;
    var beneficiaryMultiplier = 1;
    if (targetSites > scalingFactors.economiesOfScale.supervision.threshold) {
      siteMultiplier = 1 - scalingFactors.economiesOfScale.supervision.reduction;
    }
    if (targetBeneficiaries > scalingFactors.economiesOfScale.training.threshold) {
      beneficiaryMultiplier = 1 - scalingFactors.economiesOfScale.training.reduction;
    }

    // CoÃ»t de base scalÃ©
    var baseCost = costPerSite * siteMultiplier * targetSites + costPerBeneficiary * beneficiaryMultiplier * targetBeneficiaries * 0.3;

    // Ajouter les coÃ»ts additionnels de scaling
    var additionalCosts = {};
    var totalAdditional = 0;
    for (var costType in scalingFactors.scalingCosts) {
      var factor = scalingFactors.scalingCosts[costType];
      var amount = baseCost * factor;
      additionalCosts[costType] = amount;
      totalAdditional += amount;
    }
    var totalCost = baseCost + totalAdditional;
    return {
      baseCost: Math.round(baseCost),
      additionalCosts: additionalCosts,
      totalAdditional: Math.round(totalAdditional),
      totalCost: Math.round(totalCost),
      costPerSite: Math.round(totalCost / targetSites),
      costPerBeneficiary: Math.round(totalCost / targetBeneficiaries),
      scalingRatio: targetSites / pilotSites,
      economiesRealized: Math.round((1 - totalCost / (pilotCost * (targetSites / pilotSites))) * 100)
    };
  }

  /**
   * Ã‰value les risques de mise Ã  l'Ã©chelle
   */
  function assessScalingRisks(pilotData, targetScale, lang) {
    lang = lang || 'fr';
    var targetSites = targetScale.sites || 100;
    var risks = [];
    for (var riskType in scalingFactors.scalingRisks) {
      var config = scalingFactors.scalingRisks[riskType];
      var riskLevel = Math.min(config.baseRisk + config.perSiteFactor * targetSites, 0.9);
      var riskLabels = {
        fidelityDilution: {
          fr: "Dilution de la fidÃ©litÃ©",
          en: "Fidelity Dilution"
        },
        staffTurnover: {
          fr: "Rotation du personnel",
          en: "Staff Turnover"
        },
        qualityVariance: {
          fr: "Variance de qualitÃ©",
          en: "Quality Variance"
        },
        coordinationBreakdown: {
          fr: "Rupture de coordination",
          en: "Coordination Breakdown"
        },
        supplyChainIssues: {
          fr: "ProblÃ¨mes logistiques",
          en: "Supply Chain Issues"
        }
      };
      var mitigations = {
        fidelityDilution: {
          fr: "Renforcer la supervision et les audits",
          en: "Strengthen supervision and audits"
        },
        staffTurnover: {
          fr: "CrÃ©er un systÃ¨me de formation continue",
          en: "Create continuous training system"
        },
        qualityVariance: {
          fr: "Standardiser les protocoles et outils",
          en: "Standardize protocols and tools"
        },
        coordinationBreakdown: {
          fr: "Ã‰tablir une structure de gouvernance claire",
          en: "Establish clear governance structure"
        },
        supplyChainIssues: {
          fr: "Diversifier les fournisseurs et stocks tampons",
          en: "Diversify suppliers and buffer stocks"
        }
      };
      risks.push({
        id: riskType,
        label: riskLabels[riskType][lang],
        probability: riskLevel,
        probabilityPercent: Math.round(riskLevel * 100),
        severity: riskLevel > 0.5 ? 'high' : riskLevel > 0.3 ? 'medium' : 'low',
        mitigation: mitigations[riskType][lang]
      });
    }
    return risks.sort(function (a, b) {
      return b.probability - a.probability;
    });
  }

  /**
   * Calcule les besoins en ressources humaines
   */
  function calculateHRNeeds(pilotData, targetScale) {
    var pilotStaff = pilotData.staff || {
      trainers: 2,
      supervisors: 1,
      coordinators: 1
    };
    var scalingRatio = (targetScale.sites || 100) / (pilotData.sites || 5);

    // Ratios de scaling diffÃ©rents par type de personnel
    var hrNeeds = {
      trainers: Math.ceil(pilotStaff.trainers * scalingRatio * 0.6),
      // Ã‰conomies d'Ã©chelle
      supervisors: Math.ceil(pilotStaff.supervisors * scalingRatio * 0.8),
      coordinators: Math.ceil(pilotStaff.coordinators * Math.sqrt(scalingRatio)),
      // Scaling sous-linÃ©aire
      regionalManagers: Math.ceil(scalingRatio / 20),
      // 1 par 20 sites
      qualityOfficers: Math.ceil(scalingRatio / 25),
      // 1 par 25 sites
      dataManagers: Math.ceil(scalingRatio / 30) // 1 par 30 sites
    };
    hrNeeds.total = Object.values(hrNeeds).reduce(function (a, b) {
      return a + b;
    }, 0);
    return hrNeeds;
  }

  /**
   * Calcule le temps estimÃ© pour le scaling
   */
  function estimateTimeline(pilotData, targetScale) {
    var pilotDuration = pilotData.durationMonths || 12;
    var scalingRatio = (targetScale.sites || 100) / (pilotData.sites || 5);

    // Le scaling n'est pas linÃ©aire - formule logarithmique
    var baseScalingTime = pilotDuration * Math.log10(scalingRatio + 1) * 1.5;
    var phases = {
      preparation: Math.ceil(baseScalingTime * 0.2),
      training: Math.ceil(baseScalingTime * 0.3),
      rollout: Math.ceil(baseScalingTime * 0.35),
      stabilization: Math.ceil(baseScalingTime * 0.15)
    };
    phases.total = phases.preparation + phases.training + phases.rollout + phases.stabilization;
    return phases;
  }

  /**
   * GÃ©nÃ¨re un rapport complet de scaling
   */
  function generateScalingReport(pilotData, targetScale, lang) {
    lang = lang || 'fr';
    var costs = calculateScalingCost(pilotData, targetScale);
    var risks = assessScalingRisks(pilotData, targetScale, lang);
    var hr = calculateHRNeeds(pilotData, targetScale);
    var timeline = estimateTimeline(pilotData, targetScale);

    // Score de faisabilitÃ©
    var avgRisk = risks.reduce(function (sum, r) {
      return sum + r.probability;
    }, 0) / risks.length;
    var feasibilityScore = Math.round((1 - avgRisk) * 100);
    return {
      generatedAt: new Date().toISOString(),
      pilot: pilotData,
      target: targetScale,
      scalingRatio: Math.round((targetScale.sites || 100) / (pilotData.sites || 5) * 10) / 10,
      costs: costs,
      risks: risks,
      humanResources: hr,
      timeline: timeline,
      feasibility: {
        score: feasibilityScore,
        level: feasibilityScore >= 70 ? 'high' : feasibilityScore >= 50 ? 'medium' : 'low',
        label: feasibilityScore >= 70 ? lang === 'fr' ? 'Bonne faisabilitÃ©' : 'Good feasibility' : feasibilityScore >= 50 ? lang === 'fr' ? 'FaisabilitÃ© modÃ©rÃ©e' : 'Moderate feasibility' : lang === 'fr' ? 'FaisabilitÃ© difficile' : 'Difficult feasibility'
      },
      recommendations: generateScalingRecommendations(costs, risks, lang)
    };
  }

  /**
   * GÃ©nÃ¨re des recommandations pour le scaling
   */
  function generateScalingRecommendations(costs, risks, lang) {
    lang = lang || 'fr';
    var recommendations = [];

    // Recommandation sur les coÃ»ts
    if (costs.economiesRealized > 20) {
      recommendations.push({
        type: 'cost',
        priority: 'info',
        text: lang === 'fr' ? 'Ã‰conomies d\'Ã©chelle significatives (' + costs.economiesRealized + '%) - bon potentiel de scaling' : 'Significant economies of scale (' + costs.economiesRealized + '%) - good scaling potential'
      });
    }

    // Recommandations sur les risques majeurs
    risks.filter(function (r) {
      return r.probability > 0.4;
    }).forEach(function (risk) {
      recommendations.push({
        type: 'risk',
        priority: 'high',
        text: lang === 'fr' ? 'Risque Ã©levÃ©: ' + risk.label + '. Mitigation: ' + risk.mitigation : 'High risk: ' + risk.label + '. Mitigation: ' + risk.mitigation
      });
    });
    return recommendations;
  }

  /**
   * CrÃ©e des donnÃ©es de dÃ©mo
   */
  function createDemoPilot() {
    return {
      sites: 5,
      beneficiaries: 750,
      totalCost: 150000,
      durationMonths: 12,
      staff: {
        trainers: 3,
        supervisors: 2,
        coordinators: 1
      },
      adoptionRate: 78,
      fidelityScore: 82
    };
  }
  return {
    VERSION: '8.5.0',
    calculateScalingCost: calculateScalingCost,
    assessScalingRisks: assessScalingRisks,
    calculateHRNeeds: calculateHRNeeds,
    estimateTimeline: estimateTimeline,
    generateScalingReport: generateScalingReport,
    createDemoPilot: createDemoPilot,
    getScalingFactors: function () {
      return scalingFactors;
    }
  };
}();
window.ScalingSimulator = ScalingSimulator;
console.log('âœ… MOUDAR v8.5 ScalingSimulator (Mise Ã  l\'Ã©chelle) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 5: DHIS2 CONNECTOR - InteropÃ©rabilitÃ© avec les systÃ¨mes de santÃ©
// Importe les donnÃ©es de santÃ© depuis DHIS2 et autres systÃ¨mes
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var DHIS2Connector = function () {
  'use strict';

  var config = {
    baseUrl: null,
    username: null,
    password: null,
    isConnected: false
  };

  // Indicateurs DHIS2 standards pour la santÃ© mentale
  var standardIndicators = {
    "mental_health": [{
      id: "mh_consultations",
      name: "Consultations santÃ© mentale",
      dhis2Id: "Uvn6LCg7dVU"
    }, {
      id: "mh_depression_cases",
      name: "Cas de dÃ©pression diagnostiquÃ©s",
      dhis2Id: "Y6f5c6T5J9W"
    }, {
      id: "mh_psychosis_cases",
      name: "Cas de psychose",
      dhis2Id: "Z8g7d8U6K0X"
    }, {
      id: "mh_trained_staff",
      name: "Personnel formÃ© mhGAP",
      dhis2Id: "A9h8e9V7L1Y"
    }],
    "maternal_child": [{
      id: "anc_visits",
      name: "Visites prÃ©natales",
      dhis2Id: "B0i9f0W8M2Z"
    }, {
      id: "deliveries",
      name: "Accouchements assistÃ©s",
      dhis2Id: "C1j0g1X9N3A"
    }, {
      id: "child_vaccinations",
      name: "Vaccinations enfants",
      dhis2Id: "D2k1h2Y0O4B"
    }],
    "general": [{
      id: "opd_visits",
      name: "Consultations externes",
      dhis2Id: "E3l2i3Z1P5C"
    }, {
      id: "bed_occupancy",
      name: "Taux d'occupation lits",
      dhis2Id: "F4m3j4A2Q6D"
    }]
  };

  /**
   * Configure la connexion DHIS2
   */
  function configure(options) {
    config.baseUrl = options.baseUrl;
    config.username = options.username;
    config.password = options.password;
    console.log('[DHIS2Connector] Configuration mise Ã  jour');
    return {
      success: true
    };
  }

  /**
   * Teste la connexion DHIS2
   */
  async function testConnection() {
    if (!config.baseUrl) {
      return {
        success: false,
        error: 'URL non configurÃ©e'
      };
    }
    try {
      var response = await fetch(config.baseUrl + '/api/me', {
        headers: {
          'Authorization': 'Basic ' + btoa(config.username + ':' + config.password)
        }
      });
      if (response.ok) {
        var data = await response.json();
        config.isConnected = true;
        return {
          success: true,
          user: data.displayName,
          organization: data.organisationUnits ? data.organisationUnits[0]?.displayName : 'N/A'
        };
      } else {
        return {
          success: false,
          error: 'Authentification Ã©chouÃ©e'
        };
      }
    } catch (error) {
      return {
        success: false,
        error: error.message
      };
    }
  }

  /**
   * RÃ©cupÃ¨re les donnÃ©es d'un indicateur
   */
  async function fetchIndicatorData(indicatorId, options) {
    options = options || {};
    if (!config.isConnected) {
      // Mode dÃ©mo si non connectÃ©
      return generateDemoData(indicatorId, options);
    }
    try {
      var url = config.baseUrl + '/api/analytics.json?' + 'dimension=dx:' + indicatorId + '&dimension=pe:' + (options.periods || 'LAST_12_MONTHS') + '&dimension=ou:' + (options.orgUnit || 'USER_ORGUNIT');
      var response = await fetch(url, {
        headers: {
          'Authorization': 'Basic ' + btoa(config.username + ':' + config.password)
        }
      });
      if (response.ok) {
        var data = await response.json();
        return parseAnalyticsResponse(data);
      }
      return {
        success: false,
        error: 'Erreur rÃ©cupÃ©ration donnÃ©es'
      };
    } catch (error) {
      return {
        success: false,
        error: error.message
      };
    }
  }

  /**
   * Parse la rÃ©ponse analytics DHIS2
   */
  function parseAnalyticsResponse(data) {
    if (!data.rows) return {
      success: false,
      error: 'Format invalide'
    };
    var results = data.rows.map(function (row) {
      return {
        period: row[1],
        value: parseFloat(row[2]) || 0,
        orgUnit: row[3] || 'N/A'
      };
    });
    return {
      success: true,
      data: results,
      metadata: {
        headers: data.headers,
        dimensions: data.metaData?.dimensions
      }
    };
  }

  /**
   * GÃ©nÃ¨re des donnÃ©es de dÃ©mo
   */
  function generateDemoData(indicatorId, options) {
    var months = ['Jan', 'FÃ©v', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'AoÃ»', 'Sep', 'Oct', 'Nov', 'DÃ©c'];
    var baseValue = indicatorId.indexOf('mental') !== -1 ? 150 : 500;
    var data = months.map(function (month, i) {
      return {
        period: '2024' + String(i + 1).padStart(2, '0'),
        periodLabel: month + ' 2024',
        value: Math.round(baseValue * (0.8 + Math.random() * 0.4) + i * 5),
        orgUnit: 'RÃ©gion dÃ©mo'
      };
    });
    return {
      success: true,
      source: 'demo',
      data: data,
      metadata: {
        indicatorId: indicatorId
      }
    };
  }

  /**
   * Importe les donnÃ©es dans MOUDAR
   */
  async function importToMoudar(indicatorIds, options) {
    options = options || {};
    var results = {};
    for (var i = 0; i < indicatorIds.length; i++) {
      var id = indicatorIds[i];
      results[id] = await fetchIndicatorData(id, options);
    }
    return {
      success: true,
      importedAt: new Date().toISOString(),
      indicators: results,
      summary: {
        total: indicatorIds.length,
        successful: Object.values(results).filter(function (r) {
          return r.success;
        }).length
      }
    };
  }

  /**
   * RÃ©cupÃ¨re les unitÃ©s d'organisation (sites)
   */
  async function fetchOrganisationUnits(level) {
    level = level || 3;
    if (!config.isConnected) {
      return {
        success: true,
        source: 'demo',
        orgUnits: [{
          id: 'OU1',
          name: 'RÃ©gion Casablanca-Settat',
          level: 2
        }, {
          id: 'OU2',
          name: 'RÃ©gion Rabat-SalÃ©-KÃ©nitra',
          level: 2
        }, {
          id: 'OU3',
          name: 'CHU Ibn Sina',
          level: 3,
          parent: 'OU2'
        }, {
          id: 'OU4',
          name: 'HÃ´pital Moulay Youssef',
          level: 3,
          parent: 'OU1'
        }]
      };
    }
    try {
      var response = await fetch(config.baseUrl + '/api/organisationUnits?level=' + level + '&fields=id,name,level,parent', {
        headers: {
          'Authorization': 'Basic ' + btoa(config.username + ':' + config.password)
        }
      });
      if (response.ok) {
        var data = await response.json();
        return {
          success: true,
          orgUnits: data.organisationUnits
        };
      }
      return {
        success: false,
        error: 'Erreur rÃ©cupÃ©ration'
      };
    } catch (error) {
      return {
        success: false,
        error: error.message
      };
    }
  }

  /**
   * Convertit les donnÃ©es DHIS2 en format KPI pour ImplementationMonitor
   */
  function convertToKPIs(dhis2Data, mapping) {
    var kpis = {};
    for (var indicatorId in dhis2Data.indicators) {
      var indicatorData = dhis2Data.indicators[indicatorId];
      var kpiMapping = mapping[indicatorId];
      if (kpiMapping && indicatorData.success && indicatorData.data) {
        var latestValue = indicatorData.data[indicatorData.data.length - 1];
        kpis[kpiMapping.kpiId] = {
          value: latestValue.value,
          period: latestValue.period,
          source: 'dhis2',
          indicatorId: indicatorId
        };
      }
    }
    return kpis;
  }
  return {
    VERSION: '8.5.0',
    configure: configure,
    testConnection: testConnection,
    fetchIndicatorData: fetchIndicatorData,
    fetchOrganisationUnits: fetchOrganisationUnits,
    importToMoudar: importToMoudar,
    convertToKPIs: convertToKPIs,
    generateDemoData: generateDemoData,
    getStandardIndicators: function () {
      return standardIndicators;
    },
    isConnected: function () {
      return config.isConnected;
    }
  };
}();
window.DHIS2Connector = DHIS2Connector;
console.log('âœ… MOUDAR v8.5 DHIS2Connector (InteropÃ©rabilitÃ©) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 6: VOICE ASSISTANT - Assistant vocal et mode offline
// Permet la saisie vocale sur le terrain et fonctionne hors connexion
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var VoiceAssistant = function () {
  'use strict';

  var recognition = null;
  var synthesis = null;
  var isListening = false;
  var offlineQueue = [];
  var callbacks = {
    onResult: null,
    onError: null,
    onStart: null,
    onEnd: null
  };

  // Commandes vocales reconnues
  var voiceCommands = {
    fr: {
      "nouvelle barriÃ¨re": {
        action: "add_barrier"
      },
      "ajouter observation": {
        action: "add_observation"
      },
      "statut du projet": {
        action: "get_status"
      },
      "gÃ©nÃ©rer rapport": {
        action: "generate_report"
      },
      "aide": {
        action: "help"
      },
      "arrÃªter": {
        action: "stop"
      }
    },
    en: {
      "new barrier": {
        action: "add_barrier"
      },
      "add observation": {
        action: "add_observation"
      },
      "project status": {
        action: "get_status"
      },
      "generate report": {
        action: "generate_report"
      },
      "help": {
        action: "help"
      },
      "stop": {
        action: "stop"
      }
    }
  };

  /**
   * Initialise l'assistant vocal
   */
  function init(lang) {
    lang = lang || 'fr';

    // VÃ©rifier le support
    var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      return {
        success: false,
        error: 'Reconnaissance vocale non supportÃ©e',
        fallback: 'Utilisez la saisie texte'
      };
    }
    recognition = new SpeechRecognition();
    recognition.continuous = true;
    recognition.interimResults = true;
    recognition.lang = lang === 'fr' ? 'fr-FR' : 'en-US';
    recognition.onstart = function () {
      isListening = true;
      if (callbacks.onStart) callbacks.onStart();
    };
    recognition.onend = function () {
      isListening = false;
      if (callbacks.onEnd) callbacks.onEnd();
    };
    recognition.onresult = function (event) {
      var transcript = '';
      for (var i = event.resultIndex; i < event.results.length; i++) {
        transcript += event.results[i][0].transcript;
      }
      if (event.results[event.resultIndex].isFinal) {
        processVoiceInput(transcript.toLowerCase().trim(), lang);
      }
      if (callbacks.onResult) {
        callbacks.onResult({
          transcript: transcript,
          isFinal: event.results[event.resultIndex].isFinal,
          confidence: event.results[event.resultIndex][0].confidence
        });
      }
    };
    recognition.onerror = function (event) {
      if (callbacks.onError) callbacks.onError(event.error);
    };

    // SynthÃ¨se vocale
    synthesis = window.speechSynthesis;
    console.log('[VoiceAssistant] InitialisÃ© en', lang);
    return {
      success: true,
      lang: lang
    };
  }

  /**
   * DÃ©marre l'Ã©coute
   */
  function startListening() {
    if (recognition && !isListening) {
      try {
        recognition.start();
        return {
          success: true
        };
      } catch (e) {
        return {
          success: false,
          error: e.message
        };
      }
    }
    return {
      success: false,
      error: 'DÃ©jÃ  en Ã©coute ou non initialisÃ©'
    };
  }

  /**
   * ArrÃªte l'Ã©coute
   */
  function stopListening() {
    if (recognition && isListening) {
      recognition.stop();
      return {
        success: true
      };
    }
    return {
      success: false
    };
  }

  /**
   * Traite l'entrÃ©e vocale
   */
  function processVoiceInput(text, lang) {
    lang = lang || 'fr';
    var commands = voiceCommands[lang] || voiceCommands.fr;

    // Chercher une commande correspondante
    for (var command in commands) {
      if (text.indexOf(command) !== -1) {
        executeCommand(commands[command].action, text, lang);
        return;
      }
    }

    // Si pas de commande, traiter comme observation libre
    var observation = {
      id: 'OBS_' + Date.now(),
      text: text,
      timestamp: new Date().toISOString(),
      source: 'voice',
      processed: false
    };

    // Ajouter Ã  la file offline
    offlineQueue.push(observation);
    saveOfflineQueue();

    // Analyser avec SemanticNLP si disponible
    if (window.SemanticNLP) {
      var analysis = SemanticNLP.analyzeText(text, lang);
      observation.analysis = analysis;
      observation.processed = true;
    }
    return observation;
  }

  /**
   * ExÃ©cute une commande vocale
   */
  function executeCommand(action, originalText, lang) {
    var response = '';
    switch (action) {
      case 'add_barrier':
        response = lang === 'fr' ? 'BarriÃ¨re enregistrÃ©e. DÃ©crivez la barriÃ¨re observÃ©e.' : 'Barrier recorded. Describe the observed barrier.';
        break;
      case 'add_observation':
        response = lang === 'fr' ? 'PrÃªt Ã  enregistrer votre observation.' : 'Ready to record your observation.';
        break;
      case 'get_status':
        response = lang === 'fr' ? 'Consultation du statut du projet en cours.' : 'Checking project status.';
        break;
      case 'help':
        response = lang === 'fr' ? 'Commandes disponibles: nouvelle barriÃ¨re, ajouter observation, statut du projet, gÃ©nÃ©rer rapport, arrÃªter.' : 'Available commands: new barrier, add observation, project status, generate report, stop.';
        break;
      case 'stop':
        stopListening();
        response = lang === 'fr' ? 'Ã‰coute arrÃªtÃ©e.' : 'Listening stopped.';
        break;
    }
    speak(response, lang);
  }

  /**
   * Fait parler l'assistant
   */
  function speak(text, lang) {
    if (!synthesis) return;
    var utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang === 'fr' ? 'fr-FR' : 'en-US';
    utterance.rate = 1;
    synthesis.speak(utterance);
  }

  /**
   * Sauvegarde la file offline
   */
  function saveOfflineQueue() {
    try {
      localStorage.setItem('moudar_offline_queue', JSON.stringify(offlineQueue));
    } catch (e) {
      console.warn('[VoiceAssistant] Erreur sauvegarde offline:', e);
    }
  }

  /**
   * Charge la file offline
   */
  function loadOfflineQueue() {
    try {
      var saved = localStorage.getItem('moudar_offline_queue');
      if (saved) {
        offlineQueue = JSON.parse(saved);
      }
    } catch (e) {
      console.warn('[VoiceAssistant] Erreur chargement offline:', e);
    }
    return offlineQueue;
  }

  /**
   * Synchronise les observations en attente
   */
  function syncOfflineData(onSync) {
    var queue = loadOfflineQueue();
    var synced = [];
    queue.forEach(function (obs) {
      if (!obs.synced) {
        if (onSync) onSync(obs);
        obs.synced = true;
        obs.syncedAt = new Date().toISOString();
        synced.push(obs);
      }
    });
    saveOfflineQueue();
    return {
      total: queue.length,
      synced: synced.length,
      pending: queue.filter(function (o) {
        return !o.synced;
      }).length
    };
  }

  /**
   * DÃ©finit les callbacks
   */
  function on(event, callback) {
    var eventName = 'on' + event.charAt(0).toUpperCase() + event.slice(1);
    if (callbacks.hasOwnProperty(eventName)) {
      callbacks[eventName] = callback;
    }
  }

  /**
   * VÃ©rifie si on est offline
   */
  function isOffline() {
    return !navigator.onLine;
  }

  /**
   * Retourne le statut
   */
  function getStatus() {
    return {
      isListening: isListening,
      isOffline: isOffline(),
      queueLength: offlineQueue.length,
      pendingSync: offlineQueue.filter(function (o) {
        return !o.synced;
      }).length,
      speechRecognitionSupported: !!(window.SpeechRecognition || window.webkitSpeechRecognition),
      speechSynthesisSupported: !!window.speechSynthesis
    };
  }
  return {
    VERSION: '8.5.0',
    init: init,
    startListening: startListening,
    stopListening: stopListening,
    speak: speak,
    on: on,
    processVoiceInput: processVoiceInput,
    loadOfflineQueue: loadOfflineQueue,
    syncOfflineData: syncOfflineData,
    isOffline: isOffline,
    getStatus: getStatus,
    getVoiceCommands: function () {
      return voiceCommands;
    }
  };
}();
window.VoiceAssistant = VoiceAssistant;
console.log('âœ… MOUDAR v8.5 VoiceAssistant (Vocal + Offline) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE 7: DEMO GUIDE - Mode dÃ©mo auto-guidÃ© et badges simulation
// Rend la dÃ©mo "impossible Ã  rater" avec narration et clarifications
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var DemoGuide = function () {
  'use strict';

  var currentStep = 0;
  var isRunning = false;
  var callbacks = {
    onStep: null,
    onComplete: null
  };

  // Ã‰tapes de la dÃ©mo guidÃ©e (3 minutes)
  var demoSteps = {
    fr: [{
      id: 'welcome',
      title: 'ðŸŽ¯ Bienvenue dans MOUDAR v8.5',
      description: 'Plateforme de Science de l\'ImplÃ©mentation pour gouvernements et ONG',
      action: 'overview',
      duration: 5000
    }, {
      id: 'load_project',
      title: 'ðŸ“‹ Chargement du projet dÃ©mo',
      description: 'INNOV5-MH-MAROC : 5 innovations OMS intÃ©grÃ©es au Maroc',
      action: 'load_demo_project',
      duration: 4000
    }, {
      id: 'analysis',
      title: 'ðŸ”¬ Analyse IA des barriÃ¨res',
      description: 'DÃ©tection automatique des barriÃ¨res d\'implÃ©mentation via CFIR 2.0',
      action: 'show_analysis',
      duration: 6000
    }, {
      id: 'tornado',
      title: 'ðŸŒªï¸ Analyse de sensibilitÃ© Tornado',
      description: 'Quelle barriÃ¨re a le plus d\'impact sur le succÃ¨s ?',
      action: 'show_tornado',
      duration: 6000
    }, {
      id: 'monitoring',
      title: 'ðŸ“ˆ Tableau de bord de suivi',
      description: 'Comparez les prÃ©dictions Monte Carlo avec les donnÃ©es rÃ©elles',
      action: 'show_monitoring',
      duration: 6000
    }, {
      id: 'adaptive',
      title: 'ðŸ”„ Boucle adaptative',
      description: 'KPI dÃ©vie â†’ Alerte â†’ Recommandation â†’ Action â†’ KPI corrigÃ©',
      action: 'show_adaptive_loop',
      duration: 7000
    }, {
      id: 'geomap',
      title: 'ðŸ—ºï¸ Cartographie des sites',
      description: 'Visualisez les performances par rÃ©gion et identifiez les disparitÃ©s',
      action: 'show_geomap',
      duration: 5000
    }, {
      id: 'scaling',
      title: 'ðŸ“ Simulation de mise Ã  l\'Ã©chelle',
      description: 'Passez de 5 sites pilotes Ã  100 sites nationaux',
      action: 'show_scaling',
      duration: 6000
    }, {
      id: 'export',
      title: 'ðŸ“Š Export PowerPoint',
      description: 'GÃ©nÃ©rez une prÃ©sentation professionnelle en 1 clic',
      action: 'show_export',
      duration: 4000
    }, {
      id: 'complete',
      title: 'âœ… DÃ©mo terminÃ©e !',
      description: 'MOUDAR v8.5 : Du diagnostic au pilotage adaptatif',
      action: 'complete',
      duration: 3000
    }],
    en: [{
      id: 'welcome',
      title: 'ðŸŽ¯ Welcome to MOUDAR v8.5',
      description: 'Implementation Science Platform for governments and NGOs',
      action: 'overview',
      duration: 5000
    }, {
      id: 'load_project',
      title: 'ðŸ“‹ Loading demo project',
      description: 'INNOV5-MH-MOROCCO: 5 integrated WHO innovations in Morocco',
      action: 'load_demo_project',
      duration: 4000
    }, {
      id: 'analysis',
      title: 'ðŸ”¬ AI barrier analysis',
      description: 'Automatic detection of implementation barriers via CFIR 2.0',
      action: 'show_analysis',
      duration: 6000
    }, {
      id: 'tornado',
      title: 'ðŸŒªï¸ Tornado sensitivity analysis',
      description: 'Which barrier has the most impact on success?',
      action: 'show_tornado',
      duration: 6000
    }, {
      id: 'monitoring',
      title: 'ðŸ“ˆ Monitoring dashboard',
      description: 'Compare Monte Carlo predictions with real data',
      action: 'show_monitoring',
      duration: 6000
    }, {
      id: 'adaptive',
      title: 'ðŸ”„ Adaptive loop',
      description: 'KPI deviates â†’ Alert â†’ Recommendation â†’ Action â†’ KPI corrected',
      action: 'show_adaptive_loop',
      duration: 7000
    }, {
      id: 'geomap',
      title: 'ðŸ—ºï¸ Site mapping',
      description: 'Visualize performance by region and identify disparities',
      action: 'show_geomap',
      duration: 5000
    }, {
      id: 'scaling',
      title: 'ðŸ“ Scaling simulation',
      description: 'Scale from 5 pilot sites to 100 national sites',
      action: 'show_scaling',
      duration: 6000
    }, {
      id: 'export',
      title: 'ðŸ“Š PowerPoint export',
      description: 'Generate a professional presentation in 1 click',
      action: 'show_export',
      duration: 4000
    }, {
      id: 'complete',
      title: 'âœ… Demo complete!',
      description: 'MOUDAR v8.5: From diagnosis to adaptive management',
      action: 'complete',
      duration: 3000
    }]
  };

  // Badges de simulation avec explications
  var simulationBadges = {
    kpi_data: {
      label: {
        fr: 'DonnÃ©es simulÃ©es',
        en: 'Simulated data'
      },
      tooltip: {
        fr: 'Ces KPIs sont gÃ©nÃ©rÃ©s pour la dÃ©mo. En production, connectez DHIS2 ou saisissez vos donnÃ©es rÃ©elles.',
        en: 'These KPIs are generated for demo. In production, connect DHIS2 or enter your real data.'
      },
      color: 'amber'
    },
    network_analysis: {
      label: {
        fr: 'Heuristique rapide',
        en: 'Fast heuristic'
      },
      tooltip: {
        fr: 'La centralitÃ© betweenness est une approximation. Algorithme exact disponible avec plus de donnÃ©es.',
        en: 'Betweenness centrality is an approximation. Exact algorithm available with more data.'
      },
      color: 'blue'
    },
    scaling_model: {
      label: {
        fr: 'ModÃ¨le paramÃ©trique',
        en: 'Parametric model'
      },
      tooltip: {
        fr: 'Simulation basÃ©e sur des facteurs standards. Calibration possible avec vos donnÃ©es historiques.',
        en: 'Simulation based on standard factors. Calibration possible with your historical data.'
      },
      color: 'purple'
    },
    monte_carlo: {
      label: {
        fr: 'Simulation Monte Carlo',
        en: 'Monte Carlo simulation'
      },
      tooltip: {
        fr: '1000 itÃ©rations pour estimer la probabilitÃ© de succÃ¨s.',
        en: '1000 iterations to estimate success probability.'
      },
      color: 'green'
    },
    dhis2_demo: {
      label: {
        fr: 'Mode dÃ©mo DHIS2',
        en: 'DHIS2 demo mode'
      },
      tooltip: {
        fr: 'DonnÃ©es simulÃ©es. La connexion rÃ©elle nÃ©cessite un proxy backend (CORS).',
        en: 'Simulated data. Real connection requires backend proxy (CORS).'
      },
      color: 'teal'
    }
  };

  /**
   * DÃ©marre la dÃ©mo guidÃ©e
   */
  function startDemo(lang, onStepCallback) {
    lang = lang || 'fr';
    currentStep = 0;
    isRunning = true;
    callbacks.onStep = onStepCallback;
    console.log('[DemoGuide] ðŸŽ¬ DÃ©marrage de la dÃ©mo guidÃ©e');
    runStep(lang);
  }

  /**
   * ExÃ©cute une Ã©tape de la dÃ©mo
   */
  function runStep(lang) {
    if (!isRunning) return;
    var steps = demoSteps[lang] || demoSteps.fr;
    if (currentStep >= steps.length) {
      isRunning = false;
      if (callbacks.onComplete) callbacks.onComplete();
      return;
    }
    var step = steps[currentStep];
    console.log('[DemoGuide] Ã‰tape ' + (currentStep + 1) + '/' + steps.length + ': ' + step.title);
    if (callbacks.onStep) {
      callbacks.onStep({
        step: currentStep,
        total: steps.length,
        data: step,
        progress: Math.round(currentStep / steps.length * 100)
      });
    }
    currentStep++;

    // Passer Ã  l'Ã©tape suivante aprÃ¨s la durÃ©e
    setTimeout(function () {
      runStep(lang);
    }, step.duration);
  }

  /**
   * ArrÃªte la dÃ©mo
   */
  function stopDemo() {
    isRunning = false;
    currentStep = 0;
    console.log('[DemoGuide] â¹ï¸ DÃ©mo arrÃªtÃ©e');
  }

  /**
   * Saute Ã  une Ã©tape spÃ©cifique
   */
  function goToStep(stepIndex, lang) {
    lang = lang || 'fr';
    var steps = demoSteps[lang] || demoSteps.fr;
    if (stepIndex >= 0 && stepIndex < steps.length) {
      currentStep = stepIndex;
      if (callbacks.onStep) {
        callbacks.onStep({
          step: currentStep,
          total: steps.length,
          data: steps[currentStep],
          progress: Math.round(currentStep / steps.length * 100)
        });
      }
    }
  }

  /**
   * GÃ©nÃ¨re le HTML d'un badge de simulation
   */
  function getBadgeHTML(badgeType, lang) {
    lang = lang || 'fr';
    var badge = simulationBadges[badgeType];
    if (!badge) return '';
    var colors = {
      amber: 'bg-amber-100 text-amber-700 border-amber-300',
      blue: 'bg-blue-100 text-blue-700 border-blue-300',
      purple: 'bg-purple-100 text-purple-700 border-purple-300',
      green: 'bg-green-100 text-green-700 border-green-300',
      teal: 'bg-teal-100 text-teal-700 border-teal-300'
    };
    return '<span class="inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full border ' + colors[badge.color] + '" title="' + badge.tooltip[lang] + '">âš¡ ' + badge.label[lang] + '</span>';
  }

  /**
   * DonnÃ©es pour le widget Closed-Loop Adaptatif
   */
  function getClosedLoopDemo(lang) {
    lang = lang || 'fr';
    return {
      title: lang === 'fr' ? 'Boucle de Pilotage Adaptatif' : 'Adaptive Management Loop',
      steps: [{
        icon: 'ðŸ“Š',
        label: lang === 'fr' ? 'KPI dÃ©vie' : 'KPI deviates',
        detail: lang === 'fr' ? 'Adoption: 68% (prÃ©dit: 75%)' : 'Adoption: 68% (predicted: 75%)',
        status: 'alert'
      }, {
        icon: 'ðŸš¨',
        label: lang === 'fr' ? 'Alerte gÃ©nÃ©rÃ©e' : 'Alert generated',
        detail: lang === 'fr' ? 'Ã‰cart -9.3% dÃ©tectÃ©' : '-9.3% gap detected',
        status: 'warning'
      }, {
        icon: 'ðŸ’¡',
        label: lang === 'fr' ? 'Recommandation IA' : 'AI recommendation',
        detail: lang === 'fr' ? 'Intensifier formation champions locaux' : 'Intensify local champion training',
        status: 'action'
      }, {
        icon: 'âœ…',
        label: lang === 'fr' ? 'Action implÃ©mentÃ©e' : 'Action implemented',
        detail: lang === 'fr' ? '3 sessions de coaching ajoutÃ©es' : '3 coaching sessions added',
        status: 'done'
      }, {
        icon: 'ðŸ“ˆ',
        label: lang === 'fr' ? 'KPI corrigÃ©' : 'KPI corrected',
        detail: lang === 'fr' ? 'Adoption: 76% (+8%)' : 'Adoption: 76% (+8%)',
        status: 'success'
      }]
    };
  }

  /**
   * LÃ©gende pour GeoMap
   */
  function getGeoMapLegend(lang) {
    lang = lang || 'fr';
    return [{
      color: '#22C55E',
      label: lang === 'fr' ? 'SuccÃ¨s (>80%)' : 'Success (>80%)',
      status: 'success'
    }, {
      color: '#3B82F6',
      label: lang === 'fr' ? 'En cours (60-80%)' : 'On track (60-80%)',
      status: 'on_track'
    }, {
      color: '#F59E0B',
      label: lang === 'fr' ? 'Vigilance (40-60%)' : 'Warning (40-60%)',
      status: 'warning'
    }, {
      color: '#EF4444',
      label: lang === 'fr' ? 'Critique (<40%)' : 'Critical (<40%)',
      status: 'critical'
    }];
  }

  /**
   * Filtres pour GeoMap
   */
  function getGeoMapFilters(lang) {
    lang = lang || 'fr';
    return [{
      id: 'all',
      label: lang === 'fr' ? 'Tous les sites' : 'All sites'
    }, {
      id: 'urban',
      label: lang === 'fr' ? 'ðŸ™ï¸ Urbain' : 'ðŸ™ï¸ Urban'
    }, {
      id: 'rural',
      label: lang === 'fr' ? 'ðŸŒ¾ Rural' : 'ðŸŒ¾ Rural'
    }, {
      id: 'critical',
      label: lang === 'fr' ? 'ðŸ”´ Critiques seulement' : 'ðŸ”´ Critical only'
    }];
  }

  /**
   * Retourne l'Ã©tat de la dÃ©mo
   */
  function getStatus() {
    return {
      isRunning: isRunning,
      currentStep: currentStep,
      totalSteps: demoSteps.fr.length
    };
  }
  return {
    VERSION: '8.5.0',
    startDemo: startDemo,
    stopDemo: stopDemo,
    goToStep: goToStep,
    getStatus: getStatus,
    getBadgeHTML: getBadgeHTML,
    getClosedLoopDemo: getClosedLoopDemo,
    getGeoMapLegend: getGeoMapLegend,
    getGeoMapFilters: getGeoMapFilters,
    getSimulationBadges: function () {
      return simulationBadges;
    },
    getDemoSteps: function (lang) {
      return demoSteps[lang] || demoSteps.fr;
    }
  };
}();
window.DemoGuide = DemoGuide;
console.log('âœ… MOUDAR v8.5 DemoGuide (Mode dÃ©mo auto-guidÃ©) chargÃ©');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIN DES MODULES v8.5 - Monitoring & EcosystÃ¨me ConnectÃ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
console.log('ðŸš€ MOUDAR v8.5 - Monitoring & EcosystÃ¨me - Tous modules chargÃ©s');
console.log('   â€¢ SocialNetworkAnalyzer (Parties prenantes)');
console.log('   â€¢ ImplementationMonitor (KPIs temps rÃ©el)');
console.log('   â€¢ GeoMapEngine (Leaflet cartographie)');
console.log('   â€¢ ScalingSimulator (Mise Ã  l\'Ã©chelle)');
console.log('   â€¢ DHIS2Connector (InteropÃ©rabilitÃ©)');
console.log('   â€¢ VoiceAssistant (Vocal + Offline)');
console.log('   â€¢ DemoGuide (Mode dÃ©mo auto-guidÃ©)');
console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIN DES MODULES v8.3 - Intelligence Prescriptive
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ============================================
// PROJETS D'EXEMPLE PRÃ‰-REMPLIS
// ============================================
var EXAMPLE_PROJECTS = [
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCÃ‰NARIO PHARE : INNOV5-MH-MAROC (Projet rÃ©el de Younes MOUDAR)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{
  id: "DEMO_INNOV5_FULL",
  title: "INNOV5-MH-MAROC â€“ 5 innovations OMS intÃ©grÃ©es",
  organization: "CERSS Rabat + MinistÃ¨re de la SantÃ© Maroc",
  domain: "mentalHealth",
  phase: "preparation",
  resourceLevel: "LMIC",
  context: "Projet de recherche pilote (essai contrÃ´lÃ© randomisÃ© en prÃ©paration) intÃ©grant simultanÃ©ment les 5 innovations OMS validÃ©es en santÃ© mentale : (1) Soins collaboratifs, (2) Task-shifting mhGAP, (3) Interventions digitales, (4) ThÃ©rapie VR exposition, (5) Ã‰coles promotrices de santÃ© mentale. Ã‰tude sur 36 mois avec 146 participants rÃ©partis sur 6 sites au Maroc. Budget total : 6,46 millions DH.",
  population: "146 participants (adultes avec troubles anxio-dÃ©pressifs), 6 sites : Casablanca, Rabat, Marrakech, FÃ¨s, Tanger, Agadir. Personnel : 45 mÃ©decins gÃ©nÃ©ralistes, 30 infirmiers, 12 psychologues.",
  barriers: "Coordination inter-sites complexe, formation simultanÃ©e aux 5 innovations, rÃ©sistance culturelle Ã  la santÃ© mentale, infrastructure numÃ©rique variable selon les sites, rÃ©tention des participants sur 36 mois, harmonisation des protocoles OMS, collecte de donnÃ©es multi-sources.",
  objectives: ["equity", "sustainability", "cost_effectiveness", "evidence_based"],
  status: "active",
  createdAt: "2025-01-01T08:00:00Z",
  updatedAt: "2025-06-15T14:30:00Z",
  tags: ["INNOV5", "OMS", "RCT", "5 innovations", "Maroc", "CERSS", "SantÃ© mentale"],
  isDemo: true,
  demoType: "flagship"
},
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCÃ‰NARIO DÃ‰MO : Campagne Vaccination Multi-acteurs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{
  id: "DEMO_VACCINATION",
  title: "Campagne Vaccination COVID-19 â€“ Coordination Multi-acteurs",
  organization: "MinistÃ¨re de la SantÃ© + OMS + UNICEF + ONG locales",
  domain: "health",
  phase: "implementation",
  resourceLevel: "LMIC",
  context: "DÃ©ploiement d'une campagne de vaccination de masse impliquant 4 types d'acteurs : MinistÃ¨re de la SantÃ© (logistique nationale), OMS (protocoles et formation), UNICEF (communication communautaire), ONG locales (mobilisation terrain). Objectif : vacciner 5 millions de personnes en 6 mois dans les zones rurales et pÃ©ri-urbaines.",
  population: "5 millions de personnes cibles, 200 centres de vaccination, 1500 vaccinateurs, 50 superviseurs rÃ©gionaux, 100 relais communautaires.",
  barriers: "ChaÃ®ne du froid dans zones reculÃ©es, hÃ©sitation vaccinale, coordination inter-organisationnelle, turnover du personnel, rumeurs sur rÃ©seaux sociaux, accÃ¨s aux populations nomades, reporting multi-sources, langues locales multiples.",
  objectives: ["speed", "equity", "cost_effectiveness"],
  status: "active",
  createdAt: "2025-02-01T09:00:00Z",
  updatedAt: "2025-06-01T16:00:00Z",
  tags: ["Vaccination", "COVID-19", "Multi-acteurs", "OMS", "UNICEF", "Coordination"],
  isDemo: true,
  demoType: "multiactor"
},
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCÃ‰NARIO DÃ‰MO : Recherche Multisite
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{
  id: "DEMO_RESEARCH_MULTISITE",
  title: "Essai clinique multisite â€“ DiabÃ¨te type 2",
  organization: "CHU Ibn Sina + CHU Ibn Rochd + HÃ´pital Cheikh Khalifa",
  domain: "health",
  phase: "implementation",
  resourceLevel: "UMIC",
  context: "Essai contrÃ´lÃ© randomisÃ© comparant 3 protocoles de prise en charge du diabÃ¨te de type 2 : standard, intensif, et avec accompagnement numÃ©rique. 3 sites hospitaliers, 450 patients, suivi sur 24 mois. Coordination des donnÃ©es, harmonisation des pratiques, et monitoring centralisÃ©.",
  population: "450 patients diabÃ©tiques type 2, 3 CHU, 15 endocrinologues, 30 infirmiÃ¨res spÃ©cialisÃ©es, 6 coordinateurs de recherche.",
  barriers: "Harmonisation des protocoles entre sites, rÃ©tention des patients sur 24 mois, qualitÃ© des donnÃ©es multi-sources, rotation des internes, diffÃ©rences de pratiques entre CHU, gestion des Ã©vÃ©nements indÃ©sirables, respect du calendrier de visite.",
  objectives: ["evidence_based", "sustainability"],
  status: "active",
  createdAt: "2025-03-01T10:00:00Z",
  updatedAt: "2025-06-10T11:00:00Z",
  tags: ["Recherche", "Multisite", "RCT", "DiabÃ¨te", "CHU"],
  isDemo: true,
  demoType: "research"
},
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEMPLATES SECTORIELS PRÃ‰-REMPLIS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{
  id: "TEMPLATE_HEALTH_PUBLIC",
  title: "ðŸ¥ Template : Programme de santÃ© publique",
  organization: "[Votre organisation]",
  domain: "health",
  phase: "exploration",
  resourceLevel: "LMIC",
  context: "Template pour programmes de santÃ© publique : campagnes de prÃ©vention, dÃ©pistage de masse, promotion de la santÃ©. AdaptÃ© aux contextes PRFI avec ressources limitÃ©es.",
  population: "Ã€ dÃ©finir selon votre projet",
  barriers: "AccÃ¨s aux populations vulnÃ©rables, financement pÃ©renne, coordination intersectorielle, formation du personnel, suivi-Ã©valuation.",
  objectives: ["equity", "sustainability"],
  status: "template",
  createdAt: "2025-01-01T00:00:00Z",
  updatedAt: "2025-01-01T00:00:00Z",
  tags: ["Template", "SantÃ© publique", "PrÃ©vention"],
  isTemplate: true,
  templateSector: "health"
}, {
  id: "TEMPLATE_EDUCATION",
  title: "ðŸŽ“ Template : Programme Ã©ducatif",
  organization: "[Votre Ã©tablissement]",
  domain: "education",
  phase: "exploration",
  resourceLevel: "LMIC",
  context: "Template pour projets Ã©ducatifs : rÃ©forme pÃ©dagogique, formation des enseignants, introduction de nouvelles mÃ©thodes, programmes de soutien scolaire.",
  population: "Ã€ dÃ©finir selon votre projet",
  barriers: "RÃ©sistance au changement, formation continue, ressources pÃ©dagogiques, Ã©valuation des apprentissages, engagement des parents.",
  objectives: ["equity", "sustainability", "evidence_based"],
  status: "template",
  createdAt: "2025-01-01T00:00:00Z",
  updatedAt: "2025-01-01T00:00:00Z",
  tags: ["Template", "Ã‰ducation", "PÃ©dagogie"],
  isTemplate: true,
  templateSector: "education"
}, {
  id: "TEMPLATE_SOCIAL",
  title: "ðŸ¤ Template : Programme social / humanitaire",
  organization: "[Votre ONG / Institution]",
  domain: "social",
  phase: "exploration",
  resourceLevel: "LMIC",
  context: "Template pour interventions sociales et humanitaires : aide aux rÃ©fugiÃ©s, protection de l'enfance, lutte contre la pauvretÃ©, insertion professionnelle.",
  population: "Ã€ dÃ©finir selon votre projet",
  barriers: "AccÃ¨s aux bÃ©nÃ©ficiaires, financement projet, coordination ONG, sÃ©curitÃ© terrain, mesure d'impact social.",
  objectives: ["equity", "sustainability"],
  status: "template",
  createdAt: "2025-01-01T00:00:00Z",
  updatedAt: "2025-01-01T00:00:00Z",
  tags: ["Template", "Social", "Humanitaire"],
  isTemplate: true,
  templateSector: "social"
}, {
  id: "TEMPLATE_INDUSTRY",
  title: "ðŸ­ Template : Transformation organisationnelle",
  organization: "[Votre entreprise]",
  domain: "workplace",
  phase: "exploration",
  resourceLevel: "HIC",
  context: "Template pour projets de transformation en entreprise : conduite du changement, digitalisation, amÃ©lioration continue, culture d'innovation.",
  population: "Ã€ dÃ©finir selon votre projet",
  barriers: "RÃ©sistance au changement, communication interne, formation, alignement managÃ©rial, mesure de performance.",
  objectives: ["speed", "cost_effectiveness", "sustainability"],
  status: "template",
  createdAt: "2025-01-01T00:00:00Z",
  updatedAt: "2025-01-01T00:00:00Z",
  tags: ["Template", "Industrie", "Transformation"],
  isTemplate: true,
  templateSector: "industry"
},
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EXEMPLES EXISTANTS (conservÃ©s)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{
  id: "EXAMPLE_001",
  title: "INNOV5-MH â€“ IntÃ©gration mhGAP en soins primaires",
  organization: "MinistÃ¨re de la SantÃ© - RÃ©gion Souss-Massa (Maroc)",
  domain: "mentalHealth",
  phase: "preparation",
  resourceLevel: "LMIC",
  context: "Le Maroc fait face Ã  un dÃ©ficit majeur en psychiatres (1 pour 100 000 habitants). Le projet vise Ã  former les mÃ©decins gÃ©nÃ©ralistes et infirmiers des centres de santÃ© primaires au guide mhGAP de l'OMS pour la dÃ©tection et la prise en charge des troubles mentaux courants (dÃ©pression, anxiÃ©tÃ©, psychoses). Ce projet pilote cible 6 sites dans la rÃ©gion Souss-Massa.",
  population: "Personnel soignant de 45 centres de santÃ© (environ 200 professionnels) et population cible de 500 000 habitants",
  barriers: "RÃ©sistance culturelle Ã  parler de santÃ© mentale, surcharge de travail des Ã©quipes, manque de formation initiale en psychiatrie, absence de systÃ¨me de donnÃ©es sur les consultations psy, stigmatisation des patients, turnover du personnel",
  objectives: ["equity", "sustainability", "cost_effectiveness"],
  status: "draft",
  createdAt: "2025-01-15T10:00:00Z",
  updatedAt: "2025-01-15T10:00:00Z",
  tags: ["INNOV5", "mhGAP", "OMS", "LMIC", "Maroc"]
}, {
  id: "EXAMPLE_002",
  title: "Chirurgie sÃ©curisÃ©e â€“ CHU Ibn Rochd",
  organization: "CHU Ibn Rochd - Casablanca",
  domain: "health",
  phase: "implementation",
  resourceLevel: "UMIC",
  context: "ImplÃ©mentation du checklist chirurgical OMS et des protocoles de sÃ©curitÃ© patient dans les 12 blocs opÃ©ratoires du CHU. Le projet vise Ã  rÃ©duire les Ã©vÃ©nements indÃ©sirables graves et amÃ©liorer la communication inter-Ã©quipes. Formation de 150 chirurgiens, anesthÃ©sistes et infirmiers de bloc.",
  population: "150 professionnels de bloc opÃ©ratoire, 8 000 interventions/an",
  barriers: "RÃ©sistance au changement des chirurgiens seniors, manque de temps en bloc, absence de champion mÃ©dical identifiÃ©, culture hiÃ©rarchique limitant la prise de parole des infirmiers, turnover des internes",
  objectives: ["evidence_based", "speed"],
  status: "draft",
  createdAt: "2025-02-01T09:00:00Z",
  updatedAt: "2025-02-01T09:00:00Z",
  tags: ["Chirurgie", "SÃ©curitÃ© patient", "CHU", "Checklist OMS"]
}, {
  id: "EXAMPLE_003",
  title: "SantÃ© mentale en milieu scolaire â€“ LycÃ©es Rabat",
  organization: "AcadÃ©mie RÃ©gionale Rabat-SalÃ©-KÃ©nitra + Fondation SHAM",
  domain: "prevention",
  phase: "exploration",
  resourceLevel: "LMIC",
  context: "Programme pilote de dÃ©tection prÃ©coce et orientation des Ã©lÃ¨ves prÃ©sentant des signes de mal-Ãªtre psychologique (anxiÃ©tÃ©, dÃ©pression, risque suicidaire). Formation des conseillers d'orientation et infirmiers scolaires. Partenariat avec les centres de santÃ© mentale locaux pour les rÃ©fÃ©rences.",
  population: "20 lycÃ©es, 15 000 Ã©lÃ¨ves, 60 professionnels formÃ©s",
  barriers: "Stigmatisation de la santÃ© mentale chez les adolescents, manque de ressources humaines spÃ©cialisÃ©es, absence de protocole de rÃ©fÃ©rence, rÃ©ticence des familles, charge de travail des conseillers",
  objectives: ["equity", "sustainability"],
  status: "draft",
  createdAt: "2025-02-15T14:00:00Z",
  updatedAt: "2025-02-15T14:00:00Z",
  tags: ["PrÃ©vention", "Scolaire", "Adolescents", "SantÃ© mentale"]
}, {
  id: "EXAMPLE_004",
  title: "TÃ©lÃ©mÃ©decine dermatologie â€“ Zones rurales",
  organization: "Direction RÃ©gionale SantÃ© BÃ©ni Mellal-KhÃ©nifra",
  domain: "health",
  phase: "preparation",
  resourceLevel: "LMIC",
  context: "DÃ©ploiement d'une plateforme de tÃ©lÃ©dermatologie pour les centres de santÃ© ruraux sans dermatologue. Les mÃ©decins gÃ©nÃ©ralistes prennent des photos des lÃ©sions et reÃ§oivent un avis spÃ©cialisÃ© sous 48h. Objectif : rÃ©duire les dÃ©placements inutiles et amÃ©liorer le diagnostic prÃ©coce des cancers cutanÃ©s.",
  population: "30 centres de santÃ© ruraux, 200 000 habitants, 50 mÃ©decins gÃ©nÃ©ralistes",
  barriers: "ConnectivitÃ© internet limitÃ©e, rÃ©sistance technologique des mÃ©decins seniors, manque de smartphones adaptÃ©s, absence de formation Ã  la photographie mÃ©dicale, cadre rÃ©glementaire flou sur la tÃ©lÃ©mÃ©decine",
  objectives: ["cost_effectiveness", "equity"],
  status: "draft",
  createdAt: "2025-03-01T11:00:00Z",
  updatedAt: "2025-03-01T11:00:00Z",
  tags: ["TÃ©lÃ©mÃ©decine", "Dermatologie", "Rural", "Digital Health"]
}];

// Projet dÃ©mo par dÃ©faut (premier de la liste)
var DEMO_PROJECT = EXAMPLE_PROJECTS[0];
var DEMO_DIAGNOSTIC_ANSWERS = {
  L1: 4,
  L2: 3,
  L3: 4,
  L4: 3,
  C1: 3,
  C2: 2,
  C3: 3,
  C4: 2,
  R1: 2,
  R2: 3,
  R3: 2,
  R4: 2,
  D1: 2,
  D2: 2,
  D3: 3,
  D4: 2,
  A1: 2,
  A2: 3,
  A3: 3,
  A4: 2,
  P1: 4,
  P2: 3,
  P3: 4,
  P4: 3
};

// Fonction pour charger tous les projets d'exemple
function loadExampleProjects() {
  var existing = StorageManager.getProjects();
  var exampleIds = EXAMPLE_PROJECTS.map(function (p) {
    return p.id;
  });

  // Ne pas recharger si dÃ©jÃ  prÃ©sents
  var alreadyLoaded = existing.some(function (p) {
    return exampleIds.indexOf(p.id) >= 0;
  });
  if (alreadyLoaded) return {
    loaded: false,
    reason: "Examples already loaded"
  };
  var now = new Date().toISOString();
  EXAMPLE_PROJECTS.forEach(function (example) {
    var project = Object.assign({}, example, {
      createdAt: now,
      updatedAt: now
    });
    existing.push(project);
  });
  localStorage.setItem("moudar_projects", JSON.stringify(existing));
  return {
    loaded: true,
    count: EXAMPLE_PROJECTS.length
  };
}

// ============================================
// DOMAINES
// ============================================
var DOMAINS = {
  health: {
    fr: "SantÃ©",
    en: "Health",
    icon: "ðŸ¥"
  },
  mentalHealth: {
    fr: "SantÃ© mentale",
    en: "Mental Health",
    icon: "ðŸ§ "
  },
  education: {
    fr: "Ã‰ducation",
    en: "Education",
    icon: "ðŸŽ“"
  },
  management: {
    fr: "Management",
    en: "Management",
    icon: "ðŸ“Š"
  },
  agriculture: {
    fr: "Agriculture",
    en: "Agriculture",
    icon: "ðŸŒ¾"
  },
  prfi: {
    fr: "PRFI / Global Health",
    en: "LMIC / Global Health",
    icon: "ðŸŒ"
  },
  prevention: {
    fr: "PrÃ©vention",
    en: "Prevention",
    icon: "ðŸ›¡ï¸"
  },
  // v8.0 - Nouveaux secteurs non-santÃ©
  social: {
    fr: "Action sociale",
    en: "Social Services",
    icon: "ðŸ¤"
  },
  justice: {
    fr: "Justice / RÃ©insertion",
    en: "Justice / Reentry",
    icon: "âš–ï¸"
  },
  workplace: {
    fr: "Transformation organisationnelle",
    en: "Organizational Change",
    icon: "ðŸ¢"
  },
  environment: {
    fr: "Environnement / Climat",
    en: "Environment / Climate",
    icon: "ðŸŒ±"
  },
  humanitarian: {
    fr: "Humanitaire",
    en: "Humanitarian",
    icon: "ðŸ†˜"
  },
  digital: {
    fr: "Transformation digitale",
    en: "Digital Transformation",
    icon: "ðŸ’»"
  }
};

// v8.0 - Exemples multi-secteurs pour dÃ©mos
var SECTOR_EXAMPLES = {
  health: {
    title: {
      fr: "IntÃ©gration mhGAP en soins primaires",
      en: "mhGAP integration in primary care"
    },
    context: {
      fr: "Centres de santÃ© ruraux au Maroc",
      en: "Rural health centers in Morocco"
    },
    challenge: {
      fr: "Former 500 infirmiers Ã  la dÃ©tection des troubles mentaux",
      en: "Train 500 nurses in mental health detection"
    }
  },
  education: {
    title: {
      fr: "PÃ©dagogie par projets en lycÃ©e professionnel",
      en: "Project-based learning in vocational school"
    },
    context: {
      fr: "15 Ã©tablissements techniques en rÃ©gion",
      en: "15 technical schools in the region"
    },
    challenge: {
      fr: "Changer les pratiques de 200 enseignants habituÃ©s au cours magistral",
      en: "Change practices of 200 teachers used to lectures"
    }
  },
  social: {
    title: {
      fr: "Programme Logement d'Abord",
      en: "Housing First Program"
    },
    context: {
      fr: "MÃ©tropole de 500,000 habitants",
      en: "Metropolitan area of 500,000"
    },
    challenge: {
      fr: "Coordonner 12 services diffÃ©rents pour un accompagnement global",
      en: "Coordinate 12 different services for comprehensive support"
    }
  },
  justice: {
    title: {
      fr: "PrÃ©paration Ã  la sortie de prison",
      en: "Prison Reentry Preparation"
    },
    context: {
      fr: "3 Ã©tablissements pÃ©nitentiaires",
      en: "3 correctional facilities"
    },
    challenge: {
      fr: "RÃ©duire la rÃ©cidive de 40% via un suivi intensif",
      en: "Reduce recidivism by 40% through intensive follow-up"
    }
  },
  workplace: {
    title: {
      fr: "DÃ©ploiement du tÃ©lÃ©travail hybride",
      en: "Hybrid Remote Work Deployment"
    },
    context: {
      fr: "Entreprise de 2,000 employÃ©s",
      en: "Company of 2,000 employees"
    },
    challenge: {
      fr: "Maintenir la culture d'entreprise et la productivitÃ©",
      en: "Maintain company culture and productivity"
    }
  },
  environment: {
    title: {
      fr: "Adoption de l'agroÃ©cologie",
      en: "Agroecology Adoption"
    },
    context: {
      fr: "CoopÃ©rative de 150 agriculteurs",
      en: "Cooperative of 150 farmers"
    },
    challenge: {
      fr: "Transition sans perte de revenus pendant 3 ans",
      en: "Transition without income loss for 3 years"
    }
  },
  digital: {
    title: {
      fr: "Dossier patient informatisÃ© en EHPAD",
      en: "Electronic Health Records in Nursing Homes"
    },
    context: {
      fr: "25 Ã©tablissements, personnel peu digitalisÃ©",
      en: "25 facilities, low digital literacy staff"
    },
    challenge: {
      fr: "Former 800 soignants en 6 mois tout en maintenant les soins",
      en: "Train 800 caregivers in 6 months while maintaining care"
    }
  }
};

// Vocabulaire contextuel par secteur (labels dynamiques)
var SECTOR_TERMS = {
  "default": {
    actor: {
      fr: "bÃ©nÃ©ficiaire",
      en: "beneficiary"
    },
    actors: {
      fr: "bÃ©nÃ©ficiaires",
      en: "beneficiaries"
    },
    service: {
      fr: "service / structure",
      en: "service / facility"
    },
    program: {
      fr: "programme / projet",
      en: "program / project"
    }
  },
  "health": {
    actor: {
      fr: "patient",
      en: "patient"
    },
    actors: {
      fr: "patients",
      en: "patients"
    },
    service: {
      fr: "service de santÃ© / Ã©tablissement",
      en: "health service / facility"
    },
    program: {
      fr: "programme / protocole",
      en: "program / protocol"
    }
  },
  "mentalHealth": {
    actor: {
      fr: "personne suivie en santÃ© mentale",
      en: "service user in mental health"
    },
    actors: {
      fr: "personnes suivies en santÃ© mentale",
      en: "service users in mental health"
    },
    service: {
      fr: "service de santÃ© mentale",
      en: "mental health service"
    },
    program: {
      fr: "programme de santÃ© mentale",
      en: "mental health program"
    }
  },
  "education": {
    actor: {
      fr: "Ã©lÃ¨ve / Ã©tudiantÂ·e",
      en: "student"
    },
    actors: {
      fr: "Ã©lÃ¨ves / Ã©tudiantÂ·eÂ·s",
      en: "students"
    },
    service: {
      fr: "Ã©tablissement scolaire / universitÃ©",
      en: "school / university"
    },
    program: {
      fr: "programme Ã©ducatif",
      en: "educational program"
    }
  },
  "social": {
    actor: {
      fr: "bÃ©nÃ©ficiaire / usager",
      en: "service user"
    },
    actors: {
      fr: "bÃ©nÃ©ficiaires / usagers",
      en: "service users"
    },
    service: {
      fr: "service social / association",
      en: "social service / NGO"
    },
    program: {
      fr: "programme social",
      en: "social program"
    }
  },
  "justice": {
    actor: {
      fr: "personne suivie",
      en: "participant"
    },
    actors: {
      fr: "personnes suivies",
      en: "participants"
    },
    service: {
      fr: "service pÃ©nitentiaire / de probation",
      en: "correctional / probation service"
    },
    program: {
      fr: "programme de rÃ©insertion",
      en: "reentry program"
    }
  },
  "humanitarian": {
    actor: {
      fr: "bÃ©nÃ©ficiaire",
      en: "beneficiary"
    },
    actors: {
      fr: "bÃ©nÃ©ficiaires",
      en: "beneficiaries"
    },
    service: {
      fr: "ONG / agence humanitaire",
      en: "NGO / humanitarian agency"
    },
    program: {
      fr: "intervention humanitaire",
      en: "humanitarian intervention"
    }
  },
  "environment": {
    actor: {
      fr: "agriculteur / mÃ©nage",
      en: "farmer / household"
    },
    actors: {
      fr: "agriculteurs / mÃ©nages",
      en: "farmers / households"
    },
    service: {
      fr: "service agricole / environnemental",
      en: "agricultural / environment service"
    },
    program: {
      fr: "programme agro-environnemental",
      en: "agro-environmental program"
    }
  },
  "workplace": {
    actor: {
      fr: "employÃ©Â·e / collaborateurÂ·trice",
      en: "worker / employee"
    },
    actors: {
      fr: "employÃ©Â·eÂ·s / collaborateurs",
      en: "workers / employees"
    },
    service: {
      fr: "entreprise / organisation",
      en: "company / organization"
    },
    program: {
      fr: "programme en entreprise",
      en: "workplace program"
    }
  },
  "digital": {
    actor: {
      fr: "utilisateur / usager",
      en: "user"
    },
    actors: {
      fr: "utilisateurs / usagers",
      en: "users"
    },
    service: {
      fr: "service numÃ©rique / plateforme",
      en: "digital service / platform"
    },
    program: {
      fr: "programme de transformation digitale",
      en: "digital transformation program"
    }
  }
};

// Helper pour rÃ©cupÃ©rer les bons termes selon le domaine/secteur
function getSectorTerms(domainMeta, lang) {
  var sectorKey = domainMeta && domainMeta.key ? domainMeta.key : domainMeta && domainMeta.sector ? domainMeta.sector : "default";
  if (!SECTOR_TERMS[sectorKey]) {
    // Fallback: essayer quelques mappings simples
    if (sectorKey === "agriculture" || sectorKey === "environment") {
      sectorKey = "environment";
    } else if (sectorKey === "management" || sectorKey === "workplace") {
      sectorKey = "workplace";
    } else if (sectorKey === "prfi" || sectorKey === "prevention" || sectorKey === "health") {
      sectorKey = "health";
    } else {
      sectorKey = "default";
    }
  }
  var pack = SECTOR_TERMS[sectorKey] || SECTOR_TERMS["default"];
  var lg = lang === "en" ? "en" : "fr";
  return {
    actor: pack.actor[lg],
    actors: pack.actors[lg],
    service: pack.service[lg],
    program: pack.program[lg]
  };
}

// ============================================
// SECTOR CATEGORIES v8.0 - CatÃ©gories multi-sectorielles
// ============================================
var SECTOR_CATEGORIES = {
  health: {
    label: {
      fr: 'ðŸ¥ SantÃ©',
      en: 'ðŸ¥ Health'
    },
    domains: ['D01', 'D02', 'D03', 'D04', 'D05', 'D06', 'D07', 'D08', 'D09', 'D10'],
    color: '#3B82F6'
  },
  education: {
    label: {
      fr: 'ðŸŽ“ Ã‰ducation',
      en: 'ðŸŽ“ Education'
    },
    domains: ['D11', 'D12'],
    color: '#8B5CF6'
  },
  management: {
    label: {
      fr: 'ðŸ¢ Management',
      en: 'ðŸ¢ Management'
    },
    domains: ['D13', 'D14'],
    color: '#F59E0B'
  },
  environment: {
    label: {
      fr: 'ðŸŒ Environnement',
      en: 'ðŸŒ Environment'
    },
    domains: ['D15', 'D16'],
    color: '#10B981'
  },
  industry: {
    label: {
      fr: 'ðŸ­ Industrie',
      en: 'ðŸ­ Industry'
    },
    domains: ['D17', 'D18'],
    color: '#6B7280'
  },
  social: {
    label: {
      fr: 'ðŸ¤ Social',
      en: 'ðŸ¤ Social'
    },
    domains: ['D19', 'D20'],
    color: '#EC4899'
  },
  research: {
    label: {
      fr: 'ðŸ”¬ Recherche',
      en: 'ðŸ”¬ Research'
    },
    domains: ['D21'],
    color: '#14B8A6'
  },
  humanitarian: {
    label: {
      fr: 'ðŸŒ Humanitaire',
      en: 'ðŸŒ Humanitarian'
    },
    domains: ['D22', 'D23'],
    color: '#EF4444'
  }
};

// ============================================
// PHASES EPIS
// ============================================
var PHASES = {
  exploration: {
    fr: "Exploration",
    en: "Exploration",
    icon: "ðŸ”",
    description: {
      fr: "Identifier le problÃ¨me et les solutions potentielles",
      en: "Identify problem and potential solutions"
    },
    keyActivities: {
      fr: ["Analyse des besoins", "Revue de littÃ©rature", "Consultation parties prenantes"],
      en: ["Needs assessment", "Literature review", "Stakeholder consultation"]
    }
  },
  preparation: {
    fr: "PrÃ©paration",
    en: "Preparation",
    icon: "ðŸ“‹",
    description: {
      fr: "Planifier et adapter l'intervention",
      en: "Plan and adapt the intervention"
    },
    keyActivities: {
      fr: ["Adaptation contextuelle", "Formation Ã©quipes", "Pilote"],
      en: ["Contextual adaptation", "Team training", "Pilot testing"]
    }
  },
  implementation: {
    fr: "ImplÃ©mentation",
    en: "Implementation",
    icon: "ðŸš€",
    description: {
      fr: "DÃ©ployer et monitorer l'intervention",
      en: "Deploy and monitor the intervention"
    },
    keyActivities: {
      fr: ["DÃ©ploiement", "Suivi indicateurs", "RÃ©solution problÃ¨mes"],
      en: ["Rollout", "Indicator monitoring", "Problem-solving"]
    }
  },
  sustainment: {
    fr: "PÃ©rennisation",
    en: "Sustainment",
    icon: "ðŸ”„",
    description: {
      fr: "Maintenir et institutionnaliser",
      en: "Maintain and institutionalize"
    },
    keyActivities: {
      fr: ["IntÃ©gration routines", "Transfert compÃ©tences", "Financement pÃ©renne"],
      en: ["Routine integration", "Capacity transfer", "Sustainable funding"]
    }
  }
};

// ============================================
// DIAGNOSTIC QUESTIONS
// ============================================
var DIAGNOSTIC_QUESTIONS = {
  leadership: {
    label: {
      fr: "Leadership",
      en: "Leadership"
    },
    questions: [{
      id: "L1",
      text: {
        fr: "Les dirigeants communiquent clairement la vision du changement",
        en: "Leaders clearly communicate the vision for change"
      }
    }, {
      id: "L2",
      text: {
        fr: "Des ressources sont allouÃ©es au projet",
        en: "Resources are allocated to the project"
      }
    }, {
      id: "L3",
      text: {
        fr: "Un sponsor exÃ©cutif est identifiÃ© et actif",
        en: "An executive sponsor is identified and active"
      }
    }, {
      id: "L4",
      text: {
        fr: "Les managers de proximitÃ© soutiennent le changement",
        en: "Middle managers support the change"
      }
    }]
  },
  culture: {
    label: {
      fr: "Culture organisationnelle",
      en: "Organizational Culture"
    },
    questions: [{
      id: "C1",
      text: {
        fr: "L'amÃ©lioration continue est valorisÃ©e",
        en: "Continuous improvement is valued"
      }
    }, {
      id: "C2",
      text: {
        fr: "Les erreurs sont vues comme des opportunitÃ©s d'apprentissage",
        en: "Mistakes are seen as learning opportunities"
      }
    }, {
      id: "C3",
      text: {
        fr: "L'organisation est ouverte aux nouvelles pratiques",
        en: "Organization is open to new practices"
      }
    }, {
      id: "C4",
      text: {
        fr: "La collaboration inter-services est effective",
        en: "Cross-department collaboration is effective"
      }
    }]
  },
  resources: {
    label: {
      fr: "Ressources",
      en: "Resources"
    },
    questions: [{
      id: "R1",
      text: {
        fr: "Du temps est dÃ©gagÃ© pour la formation",
        en: "Time is allocated for training"
      }
    }, {
      id: "R2",
      text: {
        fr: "Les Ã©quipements nÃ©cessaires sont disponibles",
        en: "Necessary equipment is available"
      }
    }, {
      id: "R3",
      text: {
        fr: "Le budget est suffisant pour le projet",
        en: "Budget is sufficient for the project"
      }
    }, {
      id: "R4",
      text: {
        fr: "Le personnel est en nombre suffisant",
        en: "Staffing levels are adequate"
      }
    }]
  },
  data: {
    label: {
      fr: "DonnÃ©es et Ã©valuation",
      en: "Data and Evaluation"
    },
    questions: [{
      id: "D1",
      text: {
        fr: "Des donnÃ©es de performance sont collectÃ©es rÃ©guliÃ¨rement",
        en: "Performance data is collected regularly"
      }
    }, {
      id: "D2",
      text: {
        fr: "Les donnÃ©es sont utilisÃ©es pour prendre des dÃ©cisions",
        en: "Data is used for decision-making"
      }
    }, {
      id: "D3",
      text: {
        fr: "Des indicateurs clairs sont dÃ©finis pour le projet",
        en: "Clear indicators are defined for the project"
      }
    }, {
      id: "D4",
      text: {
        fr: "Le feedback est partagÃ© rÃ©guliÃ¨rement avec les Ã©quipes",
        en: "Feedback is shared regularly with teams"
      }
    }]
  },
  capacity: {
    label: {
      fr: "CapacitÃ©s",
      en: "Capacity"
    },
    questions: [{
      id: "A1",
      text: {
        fr: "Le personnel possÃ¨de les compÃ©tences techniques requises",
        en: "Staff has required technical skills"
      }
    }, {
      id: "A2",
      text: {
        fr: "Des formations sont accessibles et de qualitÃ©",
        en: "Quality training is accessible"
      }
    }, {
      id: "A3",
      text: {
        fr: "Des champions internes sont identifiÃ©s",
        en: "Internal champions are identified"
      }
    }, {
      id: "A4",
      text: {
        fr: "L'Ã©quipe a de l'expÃ©rience en gestion du changement",
        en: "Team has change management experience"
      }
    }]
  },
  partnerships: {
    label: {
      fr: "Partenariats",
      en: "Partnerships"
    },
    questions: [{
      id: "P1",
      text: {
        fr: "Des partenariats externes pertinents existent",
        en: "Relevant external partnerships exist"
      }
    }, {
      id: "P2",
      text: {
        fr: "Les bÃ©nÃ©ficiaires sont impliquÃ©s dans la conception",
        en: "Beneficiaries are involved in design"
      }
    }, {
      id: "P3",
      text: {
        fr: "Des liens avec la recherche/expertise existent",
        en: "Links with research/expertise exist"
      }
    }, {
      id: "P4",
      text: {
        fr: "Le rÃ©seau de parties prenantes est actif",
        en: "Stakeholder network is active"
      }
    }]
  }
};

// ============================================
// CAS D'USAGE
// ============================================
var USE_CASES = [{
  id: 1,
  title: {
    fr: "TÃ©lÃ©psychiatrie rurale",
    en: "Rural telepsychiatry"
  },
  country: "Canada ðŸ‡¨ðŸ‡¦",
  domain: "mentalHealth",
  duration: "18 mois",
  budget: "450K CAD",
  context: {
    fr: "DÃ©lais d'accÃ¨s psychiatrie : 18 mois. Population rurale isolÃ©e.",
    en: "18-month psychiatry access delays. Isolated rural population."
  },
  outcomes: {
    fr: "Adoption 78%, dÃ©lais -60%",
    en: "78% adoption, -60% delays"
  },
  roi: {
    fr: "ROI 3.2x en 2 ans",
    en: "3.2x ROI in 2 years"
  }
}, {
  id: 2,
  title: {
    fr: "Lean Management Urgences",
    en: "ED Lean Management"
  },
  country: "Suisse ðŸ‡¨ðŸ‡­",
  domain: "management",
  duration: "24 mois",
  budget: "320K CHF",
  context: {
    fr: "45 000 passages/an, temps d'attente 4h30",
    en: "45,000 visits/year, 4h30 wait time"
  },
  outcomes: {
    fr: "Temps d'attente -35%, satisfaction +28pts",
    en: "-35% wait time, +28pts satisfaction"
  },
  roi: {
    fr: "180K CHF/an Ã©conomisÃ©s",
    en: "180K CHF/year savings"
  }
}, {
  id: 3,
  title: {
    fr: "mHealth DiabÃ¨te",
    en: "mHealth Diabetes"
  },
  country: "Kenya ðŸ‡°ðŸ‡ª",
  domain: "prfi",
  duration: "36 mois",
  budget: "280K USD",
  context: {
    fr: "DiabÃ¨te 8%, 1 mÃ©decin / 50 000 habitants",
    en: "8% diabetes, 1 doctor / 50,000 population"
  },
  outcomes: {
    fr: "AdhÃ©rence +40%, HbA1c -1.2pts",
    en: "+40% adherence, -1.2 HbA1c"
  },
  roi: {
    fr: "12 USD/patient/an",
    en: "$12/patient/year"
  }
}, {
  id: 4,
  title: {
    fr: "PrÃ©vention suicide scolaire",
    en: "School suicide prevention"
  },
  country: "Maroc ðŸ‡²ðŸ‡¦",
  domain: "prevention",
  duration: "24 mois",
  budget: "$18K USD",
  context: {
    fr: "Tabou culturel fort, pas de psychologues scolaires",
    en: "Strong cultural taboo, no school psychologists"
  },
  outcomes: {
    fr: "Adoption 90%, dÃ©tection x3",
    en: "90% adoption, 3x detection"
  },
  roi: {
    fr: "Impact : vies sauvÃ©es",
    en: "Impact: lives saved"
  }
}, {
  id: 5,
  title: {
    fr: "Innovation agricole",
    en: "Agricultural innovation"
  },
  country: "SÃ©nÃ©gal ðŸ‡¸ðŸ‡³",
  domain: "agriculture",
  duration: "30 mois",
  budget: "$100K USD",
  context: {
    fr: "Changement climatique, rendements en baisse",
    en: "Climate change, declining yields"
  },
  outcomes: {
    fr: "Adoption 45%, rendements +25%",
    en: "45% adoption, +25% yields"
  },
  roi: {
    fr: "$200 investi â†’ $360/an revenus",
    en: "$200 invested â†’ $360/year income"
  }
}];

// ============================================
// PRICING
// ============================================
var PRICING = {
  plans: [{
    id: "discovery",
    name: {
      fr: "DÃ©couverte",
      en: "Starter"
    },
    price: {
      fr: "Gratuit",
      en: "Free"
    },
    period: "",
    description: {
      fr: "Pour explorer Moudar",
      en: "To explore Moudar"
    },
    features: [{
      fr: "1 projet actif",
      en: "1 active project"
    }, {
      fr: "3 diagnostics/mois",
      en: "3 diagnostics/month"
    }, {
      fr: "Export PDF",
      en: "PDF export"
    }, {
      fr: "Stockage local navigateur",
      en: "Local browser storage"
    }],
    cta: {
      fr: "Commencer gratuitement",
      en: "Start free"
    },
    popular: false
  }, {
    id: "professional",
    name: {
      fr: "Professionnel",
      en: "Professional"
    },
    price: {
      fr: "$95",
      en: "$95"
    },
    period: {
      fr: "/mois",
      en: "/month"
    },
    description: {
      fr: "Pour consultants et chercheurs",
      en: "For consultants and researchers"
    },
    features: [{
      fr: "10 projets actifs",
      en: "10 active projects"
    }, {
      fr: "Diagnostics illimitÃ©s",
      en: "Unlimited diagnostics"
    }, {
      fr: "Export PDF + Word",
      en: "PDF + Word export"
    }, {
      fr: "Assistant IA avancÃ©",
      en: "Advanced AI assistant"
    }, {
      fr: "Templates TIDieR / SPIRIT",
      en: "TIDieR / SPIRIT templates"
    }, {
      fr: "Stockage cloud sÃ©curisÃ©",
      en: "Secure cloud storage"
    }],
    cta: {
      fr: "Essai gratuit 14 jours",
      en: "14-day free trial"
    },
    popular: true
  }, {
    id: "institution",
    name: {
      fr: "Institution",
      en: "Institution"
    },
    price: {
      fr: "Ã€ partir de $520",
      en: "From $520"
    },
    period: {
      fr: "/mois",
      en: "/month"
    },
    description: {
      fr: "Pour CHU, ministÃ¨res, ONG",
      en: "For hospitals, ministries, NGOs"
    },
    features: [{
      fr: "Projets illimitÃ©s",
      en: "Unlimited projects"
    }, {
      fr: "10 comptes utilisateurs",
      en: "10 user accounts"
    }, {
      fr: "Collaboration temps rÃ©el",
      en: "Real-time collaboration"
    }, {
      fr: "Templates bailleurs (OMS, UNICEF)",
      en: "Funder templates (WHO, UNICEF)"
    }, {
      fr: "Formation incluse (1 jour)",
      en: "Training included (1 day)"
    }, {
      fr: "Support dÃ©diÃ© + conformitÃ© RGPD",
      en: "Dedicated support + GDPR compliance"
    }],
    cta: {
      fr: "Demander un devis",
      en: "Request quote"
    },
    popular: false
  }],
  addons: [{
    name: {
      fr: "Formation sur site",
      en: "On-site training"
    },
    price: "$1,600/day",
    desc: {
      fr: "Formation Ã©quipe complÃ¨te",
      en: "Full team training"
    }
  }, {
    name: {
      fr: "Diagnostic accompagnÃ©",
      en: "Guided diagnostic"
    },
    price: "$2,700",
    desc: {
      fr: "Avec consultant expert",
      en: "With expert consultant"
    }
  }, {
    name: {
      fr: "Comptes supplÃ©mentaires",
      en: "Additional accounts"
    },
    price: "$31/month",
    desc: {
      fr: "Par utilisateur",
      en: "Per user"
    }
  }, {
    name: {
      fr: "HÃ©bergement privÃ©",
      en: "Private hosting"
    },
    price: {
      fr: "Sur devis",
      en: "Custom quote"
    },
    desc: {
      fr: "Serveur dÃ©diÃ©",
      en: "Dedicated server"
    }
  }]
};

// ============================================
// HELPER FUNCTIONS
// ============================================
function tObj(obj, lang) {
  if (!obj) return "";
  if (typeof obj === "string") return obj;
  return obj[lang] || obj.fr || obj.en || "";
}
function getStatusBadge(status, lang) {
  var configs = {
    draft: {
      label: {
        fr: "Brouillon",
        en: "Draft"
      },
      bg: "bg-gray-100",
      text: "text-gray-600",
      icon: "ðŸ“"
    },
    protocol: {
      label: {
        fr: "Protocole gÃ©nÃ©rÃ©",
        en: "Protocol generated"
      },
      bg: "bg-blue-100",
      text: "text-blue-700",
      icon: "âœ¨"
    },
    diagnosed: {
      label: {
        fr: "DiagnostiquÃ©",
        en: "Diagnosed"
      },
      bg: "bg-green-100",
      text: "text-green-700",
      icon: "ðŸ“Š"
    },
    active: {
      label: {
        fr: "En cours",
        en: "Active"
      },
      bg: "bg-purple-100",
      text: "text-blue-700",
      icon: "ðŸš€"
    }
  };
  var config = configs[status] || configs.draft;
  return {
    label: tObj(config.label, lang),
    bg: config.bg,
    text: config.text,
    icon: config.icon
  };
}

// ============================================
// INTELLIGENT PROTOCOL GENERATOR - POWERED BY MOUDAR ENGINE
// ============================================
function generateIntelligentProtocol(answers, lang) {
  var phase = answers.phase || "preparation";
  var phaseConfig = PHASES[phase] || PHASES.preparation;

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // v8.1 FIX - MAPPING COMPLET DES DOMAINES WIZARD â†’ ENGINE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // Mapping domaine wizard â†’ domaine KnowledgeGraph (COMPLET)
  var domainMapping = {
    // Domaines santÃ© classiques
    "health": "primary_care",
    "mentalHealth": "mental_health",
    "primaryCare": "primary_care",
    "surgery": "surgery",
    "digitalHealth": "digital_health",
    "maternalChild": "maternal_child",
    "chronicDisease": "chronic_disease",
    "infectiousDisease": "infectious_disease",
    "geriatrics": "geriatrics",
    "emergency": "emergency",
    "rehabilitation": "rehabilitation",
    "prevention": "chronic_disease",
    "prfi": "humanitarian",
    // v8.0+ Domaines multi-sectoriels
    "education": "education_k12",
    "management": "management_corporate",
    "agriculture": "agriculture",
    "social": "social_work",
    "justice": "justice_reentry",
    "workplace": "manufacturing",
    "environment": "environment_climate",
    "humanitarian": "humanitarian",
    "digital": "digital_transformation",
    // Aliases additionnels pour robustesse
    "education_k12": "education_k12",
    "higher_education": "higher_education",
    "public_administration": "public_administration",
    "social_work": "social_work",
    "justice_reentry": "justice_reentry",
    "scientific_research": "scientific_research",
    "development": "development"
  };

  // Mapping contexte wizard â†’ contexte engine (Ã‰TENDU)
  var contextMapping = {
    "hospital": "hospital",
    "clinic": "primary_health_center",
    "community": "community",
    "school": "school",
    "workplace": "workplace",
    "nursingHome": "nursing_home",
    "prison": "prison",
    "telehealth": "telehealth",
    "rural": "rural",
    "urban": "urban",
    // Aliases
    "primary_health_center": "primary_health_center",
    "nursing_home": "nursing_home"
  };

  // Log pour debug
  console.log("[MOUDAR v8.1] Domain input:", answers.domain, "â†’ mapped to:", domainMapping[answers.domain] || "primary_care (default)");

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // v8.2 - UTILISATION DES NOUVELLES DONNÃ‰ES DU WIZARD Ã‰TENDU
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  // Mapping des catÃ©gories de barriÃ¨res sÃ©lectionnÃ©es â†’ barriÃ¨res engine
  var barrierCategoryToEngine = {
    "knowledge": "lack_training",
    "attitudes": "staff_resistance",
    "resources": "funding",
    "infrastructure": "it_infrastructure",
    "leadership": "leadership_support",
    "culture": "cultural_barriers",
    "policy": "policy_alignment",
    "coordination": "communication",
    "turnover": "staff_turnover",
    "complexity": "complexity"
  };

  // Mapping du pays vers le niveau de ressources
  var countryToResourceLevel = {
    "morocco": "LMIC",
    "tunisia": "LMIC",
    "algeria": "UMIC",
    "senegal": "LIC",
    "mali": "LIC",
    "cotedivoire": "LMIC",
    "france": "HIC",
    "switzerland": "HIC",
    "belgium": "HIC",
    "canada": "HIC",
    "usa": "HIC",
    "uk": "HIC",
    "other_hic": "HIC",
    "other_umic": "UMIC",
    "other_lmic": "LMIC",
    "other_lic": "LIC"
  };

  // Mapping du type de setting
  var settingToContext = {
    "hospital": "hospital",
    "clinic": "primary_health_center",
    "community": "community",
    "school": "school",
    "workplace": "workplace",
    "nursingHome": "nursing_home",
    "prison": "prison",
    "telehealth": "telehealth",
    "rural": "rural",
    "urban": "urban",
    "mixed": "primary_health_center"
  };

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // v8.2 - DÃ‰TECTION AMÃ‰LIORÃ‰E DES BARRIÃˆRES
  // Combine: texte libre + catÃ©gories sÃ©lectionnÃ©es + domaine
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // v9.0 FIX: GÃ©rer les champs qui peuvent Ãªtre des tableaux ou des chaÃ®nes
  var barriersText = Array.isArray(answers.barriers) ? answers.barriers.join(" ").toLowerCase() : (answers.barriers || "").toLowerCase();
  var contextText = (answers.context || "").toLowerCase();
  var populationText = (answers.population || "").toLowerCase();
  var objectivesText = Array.isArray(answers.objectives) ? answers.objectives.join(" ").toLowerCase() : (answers.objectives || "").toLowerCase();
  var facilitatorsText = Array.isArray(answers.facilitators) ? answers.facilitators.join(" ").toLowerCase() : (answers.facilitators || "").toLowerCase();
  var additionalText = (answers.additionalInfo || "").toLowerCase();
  var fullText = barriersText + " " + contextText + " " + populationText + " " + objectivesText + " " + facilitatorsText + " " + additionalText;
  var detectedBarriers = [];

  // 1. D'abord, ajouter les barriÃ¨res des catÃ©gories sÃ©lectionnÃ©es par l'utilisateur
  if (answers.barrierCategories && Array.isArray(answers.barrierCategories)) {
    answers.barrierCategories.forEach(function (cat) {
      var engineBarrier = barrierCategoryToEngine[cat];
      if (engineBarrier && detectedBarriers.indexOf(engineBarrier) === -1) {
        detectedBarriers.push(engineBarrier);
      }
    });
    console.log("[MOUDAR v8.2] BarriÃ¨res des catÃ©gories sÃ©lectionnÃ©es:", detectedBarriers);
  }

  // DÃ©tection intelligente avec synonymes Ã©tendus
  var barrierKeywords = {
    "lack_training": ["formation", "training", "compÃ©tence", "skill", "knowledge", "connaissance", "savoir", "expertise", "qualification", "apprentissage", "capacitÃ©", "ability", "apprendre", "former", "enseigner"],
    "staff_resistance": ["rÃ©sistance", "resistance", "rÃ©ticence", "reluctance", "peur", "fear", "refus", "opposition", "blocage", "rejet", "mÃ©fiance", "hostil", "rÃ©fractaire", "contre", "hostile"],
    "it_infrastructure": ["informatique", "it", "systÃ¨me", "system", "logiciel", "software", "technologie", "numÃ©rique", "digital", "ordinateur", "computer", "rÃ©seau", "network", "internet", "serveur", "application", "app"],
    "data_management": ["donnÃ©e", "data", "indicateur", "indicator", "mesure", "measurement", "monitoring", "suivi", "collecte", "reporting", "statistique", "base de donnÃ©es", "database", "tableau de bord", "dashboard"],
    "stigma": ["stigma", "stigmatisation", "discrimination", "prÃ©jugÃ©", "honte", "tabou", "jugement", "exclusion", "marginalisation", "rejet social", "Ã©tiquette", "mental", "psychiatr"],
    "funding": ["financement", "funding", "budget", "argent", "money", "ressource", "coÃ»t", "cost", "investissement", "subvention", "fonds", "Ã©conomique", "financier", "dÃ©pense", "moyens"],
    "leadership_support": ["direction", "leadership", "management", "soutien", "support", "dÃ©cision", "hiÃ©rarchie", "responsable", "chef", "directeur", "engagement institutionnel", "sponsor", "pilotage", "gouvernance"],
    "time_constraints": ["temps", "time", "charge", "workload", "surcharge", "overload", "dÃ©lai", "deadline", "urgent", "prioritÃ©", "disponibilitÃ©", "agenda", "planning", "calendrier", "durÃ©e"],
    "cultural_barriers": ["culture", "cultural", "tradition", "religion", "croyance", "belief", "coutume", "valeur", "norme", "sociale", "communautÃ©", "ethnique", "langue", "language", "local"],
    "complexity": ["complexe", "complex", "compliquÃ©", "difficult", "difficile", "multiple", "coordination", "multi-site", "hÃ©tÃ©rogÃ¨ne", "diversitÃ©", "variabilitÃ©", "fragmentation"],
    "communication": ["communication", "information", "sensibilisation", "awareness", "message", "diffusion", "partage", "Ã©change", "rÃ©union", "meeting", "coordination", "collaboration"],
    "policy_alignment": ["politique", "policy", "rÃ©glementation", "regulation", "loi", "law", "norme", "standard", "procÃ©dure", "protocole", "directive", "cadre lÃ©gal", "conformitÃ©", "compliance"],
    "patient_engagement": ["patient", "usager", "client", "adhÃ©sion", "engagement", "participation", "motivation", "compliance", "observance", "bÃ©nÃ©ficiaire", "population cible", "acceptation"],
    "staff_turnover": ["turnover", "rotation", "dÃ©part", "attrition", "remplacement", "recrutement", "fidÃ©lisation", "rÃ©tention", "mobilitÃ©", "instabilitÃ©", "changement de personnel"],
    "evidence_gaps": ["preuve", "evidence", "recherche", "research", "Ã©tude", "study", "donnÃ©e probante", "littÃ©rature", "scientifique", "validation", "efficacitÃ©", "effectiveness"]
  };

  // DÃ©tection avec pondÃ©ration
  var barrierScores = {};
  for (var barrierName in barrierKeywords) {
    barrierScores[barrierName] = 0;
    var keywords = barrierKeywords[barrierName];
    for (var k = 0; k < keywords.length; k++) {
      if (fullText.indexOf(keywords[k]) !== -1) {
        barrierScores[barrierName] += 1;
      }
    }
  }

  // SÃ©lectionner les barriÃ¨res avec score > 0
  for (var bn in barrierScores) {
    if (barrierScores[bn] > 0) {
      detectedBarriers.push(bn);
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // v8.1 FIX - BARRIÃˆRES PAR DÃ‰FAUT CONTEXTUELLES ET DIVERSIFIÃ‰ES
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  if (detectedBarriers.length < 2) {
    // BarriÃ¨res spÃ©cifiques par DOMAINE
    var domainBarriers = {
      "mentalHealth": ["stigma", "staff_resistance", "cultural_barriers", "patient_engagement"],
      "prfi": ["stigma", "cultural_barriers", "funding", "evidence_gaps"],
      "primaryCare": ["time_constraints", "staff_turnover", "it_infrastructure", "communication"],
      "surgery": ["complexity", "lack_training", "it_infrastructure", "policy_alignment"],
      "digitalHealth": ["it_infrastructure", "data_management", "staff_resistance", "lack_training"],
      "maternalChild": ["cultural_barriers", "patient_engagement", "funding", "communication"],
      "chronicDisease": ["patient_engagement", "time_constraints", "communication", "staff_turnover"],
      "infectiousDisease": ["funding", "complexity", "cultural_barriers", "policy_alignment"],
      "geriatrics": ["staff_turnover", "time_constraints", "cultural_barriers", "patient_engagement"],
      "emergency": ["time_constraints", "complexity", "staff_turnover", "communication"],
      "rehabilitation": ["patient_engagement", "time_constraints", "funding", "evidence_gaps"],
      "education": ["lack_training", "staff_resistance", "funding", "policy_alignment"],
      "workplace": ["staff_resistance", "leadership_support", "time_constraints", "communication"],
      "agriculture": ["cultural_barriers", "funding", "evidence_gaps", "communication"],
      "environment": ["policy_alignment", "funding", "complexity", "communication"],
      "social": ["funding", "cultural_barriers", "stigma", "staff_turnover"],
      "justice": ["stigma", "policy_alignment", "staff_resistance", "cultural_barriers"],
      "humanitarian": ["funding", "complexity", "cultural_barriers", "time_constraints"],
      "research": ["funding", "evidence_gaps", "complexity", "data_management"]
    };

    // BarriÃ¨res spÃ©cifiques par CONTEXTE
    var contextBarriers = {
      "hospital": ["complexity", "staff_turnover", "it_infrastructure"],
      "clinic": ["time_constraints", "funding", "staff_turnover"],
      "community": ["cultural_barriers", "patient_engagement", "funding"],
      "school": ["policy_alignment", "lack_training", "funding"],
      "workplace": ["staff_resistance", "leadership_support", "time_constraints"],
      "nursingHome": ["staff_turnover", "time_constraints", "funding"],
      "prison": ["policy_alignment", "stigma", "staff_resistance"],
      "telehealth": ["it_infrastructure", "data_management", "patient_engagement"],
      "rural": ["funding", "staff_turnover", "it_infrastructure"],
      "urban": ["complexity", "time_constraints", "communication"]
    };

    // RÃ©cupÃ©rer les barriÃ¨res du domaine
    var domain = answers.domain || "health";
    var domainKey = domain;
    // Normaliser certains domaines
    if (domain === "health") domainKey = "primaryCare";
    if (domain === "education_k12" || domain === "higher_education") domainKey = "education";
    if (domain === "social_work") domainKey = "social";
    if (domain === "justice_reentry") domainKey = "justice";
    if (domain === "agriculture" || domain === "environment_climate") domainKey = "agriculture";
    var domainDefaults = domainBarriers[domainKey] || domainBarriers["primaryCare"];
    var contextDefaults = contextBarriers[answers.context] || [];

    // Combiner et dÃ©dupliquer
    var allDefaults = domainDefaults.concat(contextDefaults);
    var uniqueDefaults = [];
    for (var i = 0; i < allDefaults.length; i++) {
      if (uniqueDefaults.indexOf(allDefaults[i]) === -1 && detectedBarriers.indexOf(allDefaults[i]) === -1) {
        uniqueDefaults.push(allDefaults[i]);
      }
    }

    // Ajouter de la variation en mÃ©langeant l'ordre
    var timestamp = Date.now();
    var seed = timestamp % uniqueDefaults.length;
    var shuffled = uniqueDefaults.slice(seed).concat(uniqueDefaults.slice(0, seed));

    // Prendre 2-3 barriÃ¨res supplÃ©mentaires
    var toAdd = Math.min(3 - detectedBarriers.length, shuffled.length);
    for (var j = 0; j < toAdd; j++) {
      detectedBarriers.push(shuffled[j]);
    }
  }

  // Limiter Ã  5 barriÃ¨res max
  detectedBarriers = detectedBarriers.slice(0, 5);
  console.log("[MOUDAR v8.1] BarriÃ¨res dÃ©tectÃ©es:", detectedBarriers, "pour domaine:", answers.domain, "contexte:", answers.context);

  // DÃ©terminer le niveau de ressources (v8.2 - depuis le pays sÃ©lectionnÃ©)
  var resourceLevel = "LMIC"; // dÃ©faut
  if (answers.country) {
    resourceLevel = countryToResourceLevel[answers.country] || "LMIC";
  } else if (answers.resourceLevel) {
    resourceLevel = answers.resourceLevel;
  }
  // Fallback sur le texte si pas de pays sÃ©lectionnÃ©
  if (!answers.country) {
    var countryText = (answers.context || "").toLowerCase();
    if (countryText.indexOf("maroc") !== -1 || countryText.indexOf("morocco") !== -1) {
      resourceLevel = "LMIC";
    } else if (countryText.indexOf("suisse") !== -1 || countryText.indexOf("switzerland") !== -1 || countryText.indexOf("france") !== -1 || countryText.indexOf("allemagne") !== -1 || countryText.indexOf("usa") !== -1 || countryText.indexOf("canada") !== -1) {
      resourceLevel = "HIC";
    }
  }

  // Mapping resourceLevel nom â†’ ID pour le moteur
  var resourceLevelMapping = {
    "HIC": "R01",
    "UMIC": "R02",
    "LMIC": "R03",
    "LIC": "R04",
    "R01": "R01",
    "R02": "R02",
    "R03": "R03",
    "R04": "R04"
  };
  var mappedResourceLevel = resourceLevelMapping[resourceLevel] || "R03";

  // DÃ©terminer le contexte (v8.2 - depuis settingType)
  var contextValue = "primary_health_center";
  if (answers.settingType) {
    contextValue = settingToContext[answers.settingType] || contextMapping[answers.settingType] || "primary_health_center";
  } else if (answers.context && contextMapping[answers.context]) {
    contextValue = contextMapping[answers.context];
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // APPEL AU MOTEUR MOUDAR ENGINE (v8.2 - donnÃ©es enrichies)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var engineProject = {
    domain: domainMapping[answers.domain] || "primary_care",
    context: contextValue,
    phase: phase,
    resourceLevel: mappedResourceLevel,
    barriers: detectedBarriers,
    // v8.2 - DonnÃ©es enrichies
    objectives: answers.objectives || "",
    expectedOutcomes: answers.expectedOutcomes || [],
    country: answers.country || "",
    settingCount: answers.settingCount || 1,
    geographicScope: answers.geographicScope || "local",
    populationSize: answers.populationSize || 0,
    teamSize: answers.teamSize || "3-5",
    timeline: answers.timeline || "12",
    budget: answers.budget || "unknown",
    experience: answers.experience || "none"
  };
  console.log("[MOUDAR v8.2] Projet envoyÃ© au moteur:", JSON.stringify(engineProject));
  var aiRecommendations = null;
  try {
    aiRecommendations = MoudarEngine.recommend(engineProject);
  } catch (e) {
    console.error("MoudarEngine error:", e);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // TRANSFORMATION DES RÃ‰SULTATS POUR L'AFFICHAGE
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var frameworks = [];
  var strategies = [];
  var outcomes = [];
  var recommendations = [];
  var aiConfidence = 0.5;
  if (aiRecommendations) {
    aiConfidence = aiRecommendations.confidence || 0.5;

    // Frameworks depuis le moteur IA
    if (aiRecommendations.recommendations.frameworks.primary) {
      frameworks.push(aiRecommendations.recommendations.frameworks.primary.name);
    }
    (aiRecommendations.recommendations.frameworks.secondary || []).forEach(function (fw) {
      frameworks.push(fw.name);
    });
    // Ajouter frameworks standards
    if (frameworks.indexOf("EPIS") === -1) frameworks.push("EPIS");
    if (frameworks.indexOf("Proctor") === -1) frameworks.push("Proctor Outcomes");
    frameworks = frameworks.slice(0, 4);

    // StratÃ©gies depuis le moteur IA (top 5 avec labels traduits)
    (aiRecommendations.recommendations.strategies.top || []).forEach(function (strat) {
      var label = strat.label ? strat.label[lang] || strat.label.fr || strat.name : strat.name;
      strategies.push(label);
    });
    // Ajouter stratÃ©gies additionnelles
    (aiRecommendations.recommendations.strategies.additional || []).slice(0, 3).forEach(function (strat) {
      var label = strat.label ? strat.label[lang] || strat.label.fr || strat.name : strat.name;
      strategies.push(label);
    });
    strategies = strategies.slice(0, 8);

    // Outcomes depuis le moteur IA (prioritaires)
    (aiRecommendations.recommendations.outcomes.priority || []).forEach(function (out) {
      var label = out.label ? out.label[lang] || out.label.fr || out.name : out.name;
      outcomes.push(label);
    });
    (aiRecommendations.recommendations.outcomes.secondary || []).slice(0, 3).forEach(function (out) {
      var label = out.label ? out.label[lang] || out.label.fr || out.name : out.name;
      outcomes.push(label);
    });
    outcomes = outcomes.slice(0, 6);

    // GÃ©nÃ©rer des recommandations contextuelles basÃ©es sur l'analyse IA
    var topStrategy = aiRecommendations.recommendations.strategies.top[0];
    if (topStrategy) {
      var stratLabel = topStrategy.label ? topStrategy.label[lang] || topStrategy.label.fr : topStrategy.name;
      recommendations.push(lang === "fr" ? "Prioriser la stratÃ©gie \"" + stratLabel + "\" (score IA: " + (topStrategy.confidence * 100).toFixed(0) + "%)" : "Prioritize \"" + stratLabel + "\" strategy (AI score: " + (topStrategy.confidence * 100).toFixed(0) + "%)");
    }

    // Recommandations basÃ©es sur les barriÃ¨res dÃ©tectÃ©es
    if (detectedBarriers.indexOf("stigma") !== -1) {
      recommendations.push(lang === "fr" ? "PrÃ©voir une campagne de dÃ©stigmatisation avant le dÃ©ploiement" : "Plan destigmatization campaign before rollout");
    }
    if (detectedBarriers.indexOf("lack_training") !== -1) {
      recommendations.push(lang === "fr" ? "DÃ©velopper un programme de formation adaptÃ© au contexte local" : "Develop training program adapted to local context");
    }
    if (resourceLevel === "LMIC" || resourceLevel === "LIC") {
      recommendations.push(lang === "fr" ? "Adapter les stratÃ©gies aux ressources limitÃ©es (task-shifting recommandÃ©)" : "Adapt strategies to limited resources (task-shifting recommended)");
    }
  } else {
    // Fallback si le moteur IA Ã©choue
    frameworks = ["CFIR 2.0", "EPIS", "RE-AIM", "Proctor Outcomes"];
    strategies = [lang === "fr" ? "Champions locaux" : "Local champions", lang === "fr" ? "Formation / coaching" : "Training / coaching", lang === "fr" ? "Audit et feedback" : "Audit and feedback"];
    outcomes = [lang === "fr" ? "AcceptabilitÃ©" : "Acceptability", lang === "fr" ? "FaisabilitÃ©" : "Feasibility", lang === "fr" ? "Adoption" : "Adoption"];
    recommendations.push(lang === "fr" ? "Consulter un expert en implementation science" : "Consult an implementation science expert");
  }

  // Recommandations par phase (toujours pertinentes)
  if (phase === "exploration") {
    recommendations.push(lang === "fr" ? "Conduire une analyse des parties prenantes" : "Conduct stakeholder analysis");
  } else if (phase === "preparation") {
    recommendations.push(lang === "fr" ? "PrÃ©voir un pilote avant dÃ©ploiement" : "Plan pilot before rollout");
  } else if (phase === "implementation") {
    recommendations.push(lang === "fr" ? "Suivi rapprochÃ© les 3 premiers mois" : "Close monitoring first 3 months");
  } else if (phase === "sustainment") {
    recommendations.push(lang === "fr" ? "Planifier l'ancrage institutionnel" : "Plan institutional anchoring");
  }
  var keyActivities = tObj(phaseConfig.keyActivities, lang) || [];
  return {
    frameworks: frameworks,
    strategies: strategies,
    outcomes: outcomes,
    keyActivities: keyActivities,
    recommendations: recommendations,
    phaseDescription: tObj(phaseConfig.description, lang),
    // Nouvelles donnÃ©es IA
    aiConfidence: aiConfidence,
    aiDetectedBarriers: detectedBarriers,
    aiEngineVersion: MoudarEngine ? MoudarEngine.VERSION : "N/A",
    aiRawRecommendations: aiRecommendations ? {
      metadata: aiRecommendations.metadata,
      input: aiRecommendations.input,
      strategies: aiRecommendations.recommendations.strategies,
      frameworks: aiRecommendations.recommendations.frameworks,
      outcomes: aiRecommendations.recommendations.outcomes,
      recommendations: aiRecommendations.recommendations
    } : null
  };
}

// ============================================
// HEADER
// ============================================
function Header(props) {
  var currentView = props.currentView;
  var onNavigate = props.onNavigate;
  var lang = props.lang;
  var setLang = props.setLang;
  var projectCount = StorageManager.getProjects().length;
  var navItems = [{
    key: "home",
    icon: "ðŸ ",
    label: lang === "fr" ? "Accueil" : "Home"
  }, {
    key: "adaptive",
    icon: "ðŸŽ›ï¸",
    label: lang === "fr" ? "Cockpit" : "Cockpit",
    isGold: true
  }, {
    key: "grants",
    icon: "ðŸ’°",
    label: "Grants",
    isGold: true
  }, {
    key: "benchmark",
    icon: "ðŸ“Š",
    label: "Benchmark",
    isGold: true
  }, {
    key: "digitaltwin",
    icon: "ðŸ—ï¸",
    label: "Twin",
    isGold: true
  }, {
    key: "budgetimpact",
    icon: "ðŸ’µ",
    label: "BIA",
    isGold: true,
    isNew: true
  }, {
    key: "stakeholders",
    icon: "ðŸŒ",
    label: "SNA",
    isGold: true,
    isNew: true
  }, {
    key: "consensus",
    icon: "ðŸ¤",
    label: lang === "fr" ? "Consensus" : "Consensus",
    isGold: true,
    isNew: true,
    isV10: true
  }, {
    key: "security",
    icon: "ðŸ”",
    label: lang === "fr" ? "SÃ©curitÃ©" : "Security",
    isGold: true,
    isNew: true,
    isV10: true
  }, {
    key: "npt",
    icon: "ðŸ§©",
    label: "NPT",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "frameTracker",
    icon: "ðŸ”„",
    label: "FRAME",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "proctorOutcomes",
    icon: "ðŸŽ¯",
    label: lang === "fr" ? "Outcomes" : "Outcomes",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "smartDesign",
    icon: "ðŸ”€",
    label: "SMART",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "protocolAnalyzer",
    icon: "ðŸ¤–",
    label: lang === "fr" ? "AI Copilot" : "AI Copilot",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "ontology",
    icon: "ðŸ§¬",
    label: lang === "fr" ? "Ontologie IS" : "IS Ontology",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "evidenceRepo",
    icon: "ðŸ—„ï¸",
    label: lang === "fr" ? "RÃ©pertoire" : "Repository",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "apiSdk",
    icon: "ðŸ”Œ",
    label: "API & SDK",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "cfirGuide",
    icon: "ðŸ“–",
    label: lang === "fr" ? "Guide CFIR" : "CFIR Guide",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "prism",
    icon: "ðŸ¥",
    label: "PRISM + RE-AIM",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "irlm",
    icon: "ðŸ”—",
    label: "IRLM",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "comB",
    icon: "ðŸ§ ",
    label: "COM-B / TDF",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "hybridDesign",
    icon: "ðŸ§ª",
    label: lang === "fr" ? "Design Hybride" : "Hybrid Design",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "sustainability",
    icon: "ðŸŒ±",
    label: lang === "fr" ? "PÃ©rennisation" : "Sustainability",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "qualitative",
    icon: "ðŸ“",
    label: lang === "fr" ? "Qualitatif" : "Qualitative",
    isGold: true,
    isNew: true,
    isV11: true
  }, {
    key: "product",
    icon: "ðŸ“¦",
    label: lang === "fr" ? "Produit" : "Product"
  }, {
    key: "myProjects",
    icon: "ðŸ“‚",
    label: lang === "fr" ? "Projets" : "Projects",
    badge: projectCount
  }, {
    key: "space",
    icon: "ðŸ‘¤",
    label: lang === "fr" ? "Mon espace" : "My space"
  }, {
    key: "analyzer",
    icon: "ðŸ”¬",
    label: lang === "fr" ? "Analyser" : "Analyze"
  }, {
    key: "wizard",
    icon: "âœ¨",
    label: lang === "fr" ? "Nouveau" : "New"
  }, {
    key: "diagnostic",
    icon: "ðŸ“‹",
    label: "Diagnostic"
  }];
  return /*#__PURE__*/React.createElement("header", {
    className: "gradient-main text-white py-3 px-4 shadow-xl sticky top-0 z-50",
    role: "banner",
    "aria-label": "En-t\xEAte principal MOUDAR"
  }, /*#__PURE__*/React.createElement("div", {
    className: "max-w-7xl mx-auto flex items-center justify-between flex-wrap gap-2"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 cursor-pointer",
    onClick: function () {
      onNavigate("home");
    }
  }, /*#__PURE__*/React.createElement("svg", {
    width: "36",
    height: "36",
    viewBox: "0 0 40 40",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, /*#__PURE__*/React.createElement("circle", {
    cx: "20",
    cy: "20",
    r: "18",
    fill: "url(#logoGrad)",
    stroke: "white",
    strokeWidth: "2"
  }), /*#__PURE__*/React.createElement("path", {
    d: "M12 28V14L20 22L28 14V28",
    stroke: "white",
    strokeWidth: "3",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }), /*#__PURE__*/React.createElement("circle", {
    cx: "20",
    cy: "12",
    r: "3",
    fill: "#34d399"
  }), /*#__PURE__*/React.createElement("defs", null, /*#__PURE__*/React.createElement("linearGradient", {
    id: "logoGrad",
    x1: "0",
    y1: "0",
    x2: "40",
    y2: "40"
  }, /*#__PURE__*/React.createElement("stop", {
    offset: "0%",
    stopColor: "#3b82f6"
  }), /*#__PURE__*/React.createElement("stop", {
    offset: "100%",
    stopColor: "#10b981"
  })))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("h1", {
    className: "text-lg font-bold"
  }, "MOUDAR"), /*#__PURE__*/React.createElement("span", {
    className: "px-1.5 py-0.5 bg-gradient-to-r from-yellow-400 to-yellow-300 text-yellow-900 text-xs font-bold rounded"
  }, "v9.0"), /*#__PURE__*/React.createElement("span", {
    className: "px-1.5 py-0.5 bg-yellow-500/20 text-yellow-400 text-xs font-bold rounded border border-yellow-500/30"
  }, "GOLD")), /*#__PURE__*/React.createElement("p", {
    className: "text-blue-200 text-xs hidden md:block"
  }, lang === "fr" ? "Co-pilote Science de la mise en Å“uvre â€” Gold Standard" : "Implementation Science Co-pilot â€” Gold Standard"))), /*#__PURE__*/React.createElement("nav", {
    className: "flex items-center gap-1 flex-wrap",
    role: "navigation",
    "aria-label": "Navigation principale"
  }, navItems.map(function (item) {
    return /*#__PURE__*/React.createElement("button", {
      key: item.key,
      onClick: function () {
        onNavigate(item.key);
      },
      className: "px-2 py-1 rounded-lg text-xs font-medium transition-all relative " + (currentView === item.key ? "bg-white text-blue-900" : item.isGold ? "bg-yellow-500/20 hover:bg-yellow-500/30 text-yellow-300" : "bg-blue-800/30 hover:bg-blue-700/50"),
      "aria-label": item.label,
      "aria-current": currentView === item.key ? "page" : undefined
    }, /*#__PURE__*/React.createElement("span", {
      "aria-hidden": "true"
    }, item.icon), " ", /*#__PURE__*/React.createElement("span", {
      className: "hidden lg:inline"
    }, item.label), item.badge > 0 && /*#__PURE__*/React.createElement("span", {
      className: "absolute -top-1 -right-1 bg-orange-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center",
      "aria-label": item.badge + " projets"
    }, item.badge), item.isNew && /*#__PURE__*/React.createElement("span", {
      className: "absolute -top-1 -right-1 bg-green-500 text-white text-[8px] rounded px-0.5 font-bold animate-pulse",
      "aria-label": "Nouveau"
    }, "NEW"), item.isGold && !item.isNew && /*#__PURE__*/React.createElement("span", {
      className: "absolute -top-1 -right-1 bg-yellow-500 text-yellow-900 text-[8px] rounded px-0.5 font-bold",
      "aria-label": "Version 9.0"
    }, "9.0"));
  }), /*#__PURE__*/React.createElement("div", {
    className: "flex ml-2 bg-blue-800/50 rounded-lg overflow-hidden",
    role: "group",
    "aria-label": "S\xE9lection de la langue"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setLang("fr");
    },
    className: "px-2 py-1 text-xs " + (lang === "fr" ? "bg-white text-blue-900" : ""),
    "aria-label": "Fran\xE7ais",
    "aria-pressed": lang === "fr"
  }, "FR"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setLang("en");
    },
    className: "px-2 py-1 text-xs " + (lang === "en" ? "bg-white text-blue-900" : ""),
    "aria-label": "English",
    "aria-pressed": lang === "en"
  }, "EN")))));
}

// ============================================
// TOOLTIPS PÃ‰DAGOGIQUES
// ============================================
var TECHNICAL_TERMS = {
  CFIR: {
    fr: "Consolidated Framework for Implementation Research - Cadre structurÃ© identifiant les facteurs influenÃ§ant l'implÃ©mentation d'interventions en santÃ© (Damschroder, 2009)",
    en: "Consolidated Framework for Implementation Research - Structured framework identifying factors influencing healthcare intervention implementation (Damschroder, 2009)"
  },
  EPIS: {
    fr: "Exploration, Preparation, Implementation, Sustainment - Phases du cycle d'implÃ©mentation (Aarons et al., 2011)",
    en: "Exploration, Preparation, Implementation, Sustainment - Implementation cycle phases (Aarons et al., 2011)"
  },
  ERIC: {
    fr: "Expert Recommendations for Implementing Change - 73 stratÃ©gies d'implÃ©mentation validÃ©es par consensus (Powell et al., 2015)",
    en: "Expert Recommendations for Implementing Change - 73 consensus-validated implementation strategies (Powell et al., 2015)"
  },
  REAIM: {
    fr: "Reach, Effectiveness, Adoption, Implementation, Maintenance - Cadre d'Ã©valuation des interventions (Glasgow, 1999)",
    en: "Reach, Effectiveness, Adoption, Implementation, Maintenance - Intervention evaluation framework (Glasgow, 1999)"
  },
  Proctor: {
    fr: "Taxonomie des outcomes d'implÃ©mentation : AcceptabilitÃ©, Adoption, Pertinence, CoÃ»ts, FaisabilitÃ©, FidÃ©litÃ©, PÃ©nÃ©tration, DurabilitÃ© (Proctor et al., 2011)",
    en: "Implementation outcomes taxonomy: Acceptability, Adoption, Appropriateness, Costs, Feasibility, Fidelity, Penetration, Sustainability (Proctor et al., 2011)"
  },
  mhGAP: {
    fr: "Mental Health Gap Action Programme - Guide OMS pour la prise en charge des troubles mentaux en soins primaires",
    en: "Mental Health Gap Action Programme - WHO guide for mental health management in primary care"
  }
};
function Tooltip(props) {
  var term = props.term;
  var lang = props.lang || "fr";
  var children = props.children;
  var [show, setShow] = useState(false);
  var definition = TECHNICAL_TERMS[term] ? TECHNICAL_TERMS[term][lang] : null;
  if (!definition) return children;
  return /*#__PURE__*/React.createElement("span", {
    className: "relative cursor-help border-b border-dotted border-gray-400",
    onMouseEnter: function () {
      setShow(true);
    },
    onMouseLeave: function () {
      setShow(false);
    }
  }, children, /*#__PURE__*/React.createElement("span", {
    className: "text-xs text-blue-500 ml-0.5"
  }, "\u24D8"), show && /*#__PURE__*/React.createElement("span", {
    className: "absolute z-50 bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-72 p-3 bg-slate-800 text-white text-xs rounded-lg shadow-xl"
  }, /*#__PURE__*/React.createElement("strong", {
    className: "text-blue-300"
  }, term), /*#__PURE__*/React.createElement("br", null), /*#__PURE__*/React.createElement("span", {
    className: "text-slate-300"
  }, definition), /*#__PURE__*/React.createElement("span", {
    className: "absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 rotate-45 w-2 h-2 bg-slate-800"
  })));
}

// ============================================
// HOME VIEW
// ============================================
function HomeView(props) {
  var onNavigate = props.onNavigate;
  var onLoadDemo = props.onLoadDemo;
  var lang = props.lang;
  var onStartSectorExample = props.onStartSectorExample || function () {};
  var sectorState = useState("health");
  var selectedSector = sectorState[0];
  var setSelectedSector = sectorState[1];
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    className: "gradient-hero rounded-2xl p-8 text-white text-center mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-center mb-4"
  }, /*#__PURE__*/React.createElement("svg", {
    width: "60",
    height: "60",
    viewBox: "0 0 40 40",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, /*#__PURE__*/React.createElement("circle", {
    cx: "20",
    cy: "20",
    r: "18",
    fill: "rgba(255,255,255,0.2)",
    stroke: "white",
    strokeWidth: "2"
  }), /*#__PURE__*/React.createElement("path", {
    d: "M12 28V14L20 22L28 14V28",
    stroke: "white",
    strokeWidth: "3",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }), /*#__PURE__*/React.createElement("circle", {
    cx: "20",
    cy: "12",
    r: "3",
    fill: "#34d399"
  }))), /*#__PURE__*/React.createElement("h1", {
    className: "text-3xl md:text-4xl font-bold mb-3"
  }, "Moudar"), /*#__PURE__*/React.createElement("p", {
    className: "text-xl text-white/90 mb-2"
  }, lang === "fr" ? "Le copilote numÃ©rique pour la Science de la mise en Å“uvre" : "The digital co-pilot for Implementation Science"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/70 mb-6"
  }, lang === "fr" ? "Concevez et pilotez vos projets de changement pour votre secteur d'activitÃ©" : "Design and manage your change projects for your industry"), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap justify-center gap-3 mb-4"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("wizard");
    },
    className: "px-6 py-3 bg-white text-blue-700 rounded-xl font-bold hover:bg-blue-50 transition shadow-lg"
  }, "\u2728 ", lang === "fr" ? "Nouveau projet" : "New project"), /*#__PURE__*/React.createElement("button", {
    onClick: onLoadDemo,
    className: "px-6 py-3 bg-white/20 text-white rounded-xl font-medium hover:bg-white/30 transition border border-white/30"
  }, "\uD83C\uDFAF ", lang === "fr" ? "Voir la dÃ©mo" : "See demo")), /*#__PURE__*/React.createElement("a", {
    href: "mailto:contact@moudar.com?subject=Demande%20de%20d\xE9mo%20Moudar",
    className: "text-white/80 hover:text-white text-sm underline"
  }, "\uD83D\uDCE9 ", lang === "fr" ? "Demander une dÃ©mo" : "Request a demo", " : contact@moudar.com")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl shadow-md p-4 mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-3"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "text-sm font-semibold text-gray-800"
  }, lang === "fr" ? "Choisissez votre secteur" : "Choose your sector"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Moudar s'adapte Ã  la santÃ©, Ã  l'Ã©ducation, au social, Ã  l'humanitaire, Ã  l'agriculture..." : "Moudar adapts to health, education, social services, humanitarian, agriculture...")), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-2"
  }, Object.keys(SECTOR_CATEGORIES).map(function (key) {
    var cat = SECTOR_CATEGORIES[key];
    var isSelected = key === selectedSector;
    return /*#__PURE__*/React.createElement("button", {
      key: key,
      type: "button",
      onClick: function () {
        setSelectedSector(key);
      },
      className: "px-3 py-1.5 rounded-full text-xs border transition " + (isSelected ? "bg-indigo-600 text-white border-indigo-600" : "bg-white text-gray-700 border-gray-300 hover:bg-gray-50")
    }, cat.label[lang] || cat.label.fr || cat.label.en);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mt-3 border-t pt-3 grid md:grid-cols-3 gap-3 items-start"
  }, /*#__PURE__*/React.createElement("div", {
    className: "md:col-span-2"
  }, function () {
    var meta = SECTOR_EXAMPLES[selectedSector] || null;
    if (!meta) {
      return /*#__PURE__*/React.createElement("p", {
        className: "text-sm text-gray-500"
      }, lang === "fr" ? "SÃ©lectionnez un secteur pour voir un scÃ©nario type." : "Select a sector to view a typical scenario.");
    }
    return /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("p", {
      className: "text-xs uppercase text-gray-400 mb-1"
    }, lang === "fr" ? "ScÃ©nario type" : "Typical scenario"), /*#__PURE__*/React.createElement("h4", {
      className: "font-semibold text-gray-800"
    }, meta.title[lang] || meta.title.fr || meta.title.en), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mt-1"
    }, meta.context[lang] || meta.context.fr || meta.context.en), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mt-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium"
    }, lang === "fr" ? "DÃ©fi :" : "Challenge:"), " ", meta.challenge[lang] || meta.challenge.fr || meta.challenge.en));
  }()), /*#__PURE__*/React.createElement("div", {
    className: "md:col-span-1 flex md:justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    type: "button",
    onClick: function () {
      onStartSectorExample(selectedSector);
    },
    className: "w-full md:w-auto px-4 py-2 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-700 text-white text-sm font-semibold shadow hover:from-blue-700 hover:to-indigo-800"
  }, lang === "fr" ? "Utiliser ce scÃ©nario dans le Wizard" : "Use this scenario in the Wizard")))), /*#__PURE__*/React.createElement("div", {
    className: "mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-6"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block px-4 py-1 bg-gradient-to-r from-emerald-500 to-teal-600 text-white text-sm font-bold rounded-full mb-2"
  }, "\uD83C\uDFAF ", lang === "fr" ? "CAS CONCRETS" : "REAL CASES"), /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800"
  }, lang === "fr" ? "ScÃ©narios de dÃ©monstration" : "Demo Scenarios"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500 text-sm mt-1"
  }, lang === "fr" ? "DÃ©couvrez comment Moudar rÃ©sout des problÃ¨mes rÃ©els de coordination et d'implÃ©mentation" : "See how Moudar solves real coordination and implementation challenges")), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-blue-900 via-indigo-900 to-purple-900 rounded-2xl p-6 mb-6 text-white relative overflow-hidden"
  }, /*#__PURE__*/React.createElement("div", {
    className: "absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -translate-y-1/2 translate-x-1/2"
  }), /*#__PURE__*/React.createElement("div", {
    className: "absolute bottom-0 left-0 w-48 h-48 bg-white/5 rounded-full translate-y-1/2 -translate-x-1/2"
  }), /*#__PURE__*/React.createElement("div", {
    className: "relative z-10"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap items-center gap-2 mb-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-yellow-400 text-yellow-900 text-xs font-bold rounded-full"
  }, "\u2B50 PROJET PHARE"), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/20 text-white text-xs rounded-full"
  }, "\uD83C\uDF0D OMS"), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/20 text-white text-xs rounded-full"
  }, "\uD83D\uDD2C RCT"), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/20 text-white text-xs rounded-full"
  }, "\uD83C\uDDF2\uD83C\uDDE6 Maroc")), /*#__PURE__*/React.createElement("h3", {
    className: "text-2xl font-bold mb-2"
  }, "INNOV5-MH-MAROC"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/90 mb-4 text-sm leading-relaxed"
  }, lang === "fr" ? "Projet de recherche pilote (essai contrÃ´lÃ© randomisÃ© en prÃ©paration) intÃ©grant simultanÃ©ment les 5 innovations OMS validÃ©es en santÃ© mentale. 146 participants, 6 sites, 36 mois." : "World's first RCT simultaneously integrating all 5 WHO-validated mental health innovations. 146 participants, 6 sites, 36 months."), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 md:grid-cols-5 gap-4 mb-5"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center p-3 bg-white/10 rounded-xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, "5"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-white/70"
  }, lang === "fr" ? "Innovations OMS" : "WHO Innovations")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-3 bg-white/10 rounded-xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, "146"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-white/70"
  }, lang === "fr" ? "Participants" : "Participants")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-3 bg-white/10 rounded-xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, "6"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-white/70"
  }, lang === "fr" ? "Sites" : "Sites")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-3 bg-white/10 rounded-xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, "36"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-white/70"
  }, lang === "fr" ? "Mois" : "Months")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-3 bg-white/10 rounded-xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, "6.46M"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-white/70"
  }, "DH"))), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var demo = EXAMPLE_PROJECTS.find(function (p) {
        return p.id === "DEMO_INNOV5_FULL";
      });
      if (demo) {
        localStorage.setItem("moudar_current_project", JSON.stringify(demo));
        onNavigate("wizard");
      }
    },
    className: "px-5 py-2.5 bg-white text-indigo-900 rounded-xl font-bold hover:bg-gray-100 transition shadow-lg"
  }, "\uD83D\uDE80 ", lang === "fr" ? "Explorer ce projet" : "Explore this project"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("about");
    },
    className: "px-5 py-2.5 bg-white/20 text-white rounded-xl font-medium hover:bg-white/30 transition border border-white/30"
  }, "\u2139\uFE0F ", lang === "fr" ? "En savoir plus" : "Learn more")))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl shadow-lg overflow-hidden card-hover"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-green-500 to-emerald-600 p-4 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-white/20 text-xs rounded-full"
  }, "\uD83C\uDF0D Multi-acteurs"), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-white/20 text-xs rounded-full"
  }, "\uD83D\uDC89 Vaccination")), /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold"
  }, lang === "fr" ? "Campagne Vaccination COVID-19" : "COVID-19 Vaccination Campaign"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/80 text-sm"
  }, lang === "fr" ? "Coordination OMS + UNICEF + MinistÃ¨re + ONG" : "WHO + UNICEF + Ministry + NGO Coordination")), /*#__PURE__*/React.createElement("div", {
    className: "p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-3 gap-2 mb-4 text-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xl font-bold text-green-600"
  }, "5M"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Personnes" : "People")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xl font-bold text-green-600"
  }, "200"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Centres" : "Centers")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xl font-bold text-green-600"
  }, "4"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Acteurs" : "Actors"))), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-4"
  }, lang === "fr" ? "Comment coordonner une campagne massive avec des acteurs aux cultures et processus diffÃ©rents ?" : "How to coordinate a massive campaign with actors having different cultures and processes?"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var demo = EXAMPLE_PROJECTS.find(function (p) {
        return p.id === "DEMO_VACCINATION";
      });
      if (demo) {
        localStorage.setItem("moudar_current_project", JSON.stringify(demo));
        onNavigate("wizard");
      }
    },
    className: "w-full py-2 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition"
  }, lang === "fr" ? "Voir la dÃ©mo" : "See demo"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl shadow-lg overflow-hidden card-hover"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-purple-500 to-indigo-600 p-4 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-white/20 text-xs rounded-full"
  }, "\uD83D\uDD2C Recherche"), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-white/20 text-xs rounded-full"
  }, "\uD83C\uDFE5 3 CHU")), /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold"
  }, lang === "fr" ? "Essai clinique multisite" : "Multisite Clinical Trial"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/80 text-sm"
  }, lang === "fr" ? "DiabÃ¨te type 2 â€“ 3 protocoles comparÃ©s" : "Type 2 Diabetes â€“ 3 protocols compared")), /*#__PURE__*/React.createElement("div", {
    className: "p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-3 gap-2 mb-4 text-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xl font-bold text-purple-600"
  }, "450"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Patients" : "Patients")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xl font-bold text-purple-600"
  }, "3"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Sites" : "Sites")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xl font-bold text-purple-600"
  }, "24"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Mois" : "Months"))), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-4"
  }, lang === "fr" ? "Comment harmoniser les pratiques et garantir la qualitÃ© des donnÃ©es entre 3 CHU ?" : "How to harmonize practices and ensure data quality across 3 university hospitals?"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var demo = EXAMPLE_PROJECTS.find(function (p) {
        return p.id === "DEMO_RESEARCH_MULTISITE";
      });
      if (demo) {
        localStorage.setItem("moudar_current_project", JSON.stringify(demo));
        onNavigate("wizard");
      }
    },
    className: "w-full py-2 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 transition"
  }, lang === "fr" ? "Voir la dÃ©mo" : "See demo")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-gray-50 to-slate-100 rounded-xl p-5 border border-gray-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 mb-4"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-2xl"
  }, "\uD83D\uDCCB"), /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800"
  }, lang === "fr" ? "Templates sectoriels prÃªts Ã  l'emploi" : "Ready-to-use sector templates")), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 md:grid-cols-4 gap-3"
  }, [{
    id: "TEMPLATE_HEALTH_PUBLIC",
    icon: "ðŸ¥",
    name: {
      fr: "SantÃ© publique",
      en: "Public Health"
    },
    color: "from-blue-500 to-cyan-500"
  }, {
    id: "TEMPLATE_EDUCATION",
    icon: "ðŸŽ“",
    name: {
      fr: "Ã‰ducation",
      en: "Education"
    },
    color: "from-amber-500 to-orange-500"
  }, {
    id: "TEMPLATE_SOCIAL",
    icon: "ðŸ¤",
    name: {
      fr: "Social / Humanitaire",
      en: "Social / Humanitarian"
    },
    color: "from-rose-500 to-pink-500"
  }, {
    id: "TEMPLATE_INDUSTRY",
    icon: "ðŸ­",
    name: {
      fr: "Industrie",
      en: "Industry"
    },
    color: "from-slate-500 to-gray-600"
  }].map(function (tpl) {
    return /*#__PURE__*/React.createElement("button", {
      key: tpl.id,
      onClick: function () {
        var template = EXAMPLE_PROJECTS.find(function (p) {
          return p.id === tpl.id;
        });
        if (template) {
          var newProject = Object.assign({}, template, {
            id: "PROJECT_" + Date.now(),
            status: "draft",
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
          });
          localStorage.setItem("moudar_current_project", JSON.stringify(newProject));
          onNavigate("wizard");
        }
      },
      className: "p-4 rounded-xl text-white text-center card-hover bg-gradient-to-br " + tpl.color
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, tpl.icon), /*#__PURE__*/React.createElement("div", {
      className: "text-sm font-medium"
    }, tpl.name[lang] || tpl.name.fr));
  })))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4 mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    onClick: function () {
      onNavigate("wizard");
    },
    className: "bg-gradient-to-br from-blue-500 to-teal-600 rounded-xl p-6 text-white card-hover cursor-pointer"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-3"
  }, "\u2728"), /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold mb-2"
  }, lang === "fr" ? "Assistant de conception" : "Design Assistant"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/90 text-sm mb-3"
  }, lang === "fr" ? "En 10-15 minutes, obtenez un squelette de protocole CFIR/RE-AIM exportable en Word" : "In 10-15 minutes, get a CFIR/RE-AIM protocol skeleton exportable to Word"), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 flex-wrap"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-1 bg-white/20 rounded text-xs"
  }, "CFIR 2.0"), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-1 bg-white/20 rounded text-xs"
  }, "RE-AIM"), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-1 bg-white/20 rounded text-xs"
  }, "ERIC"))), /*#__PURE__*/React.createElement("div", {
    onClick: function () {
      onNavigate("analyzer");
    },
    className: "bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl p-6 text-white card-hover cursor-pointer relative overflow-hidden"
  }, /*#__PURE__*/React.createElement("span", {
    className: "absolute top-2 right-2 px-2 py-0.5 bg-green-400 text-green-900 text-xs font-bold rounded animate-pulse"
  }, "NEW"), /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-3"
  }, "\uD83D\uDD2C"), /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold mb-2"
  }, lang === "fr" ? "Analyseur de protocole" : "Protocol Analyzer"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/90 text-sm mb-3"
  }, lang === "fr" ? "Collez votre protocole existant et obtenez un score de complÃ©tude" : "Paste your existing protocol and get an Implementation Science completeness score"), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 flex-wrap"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-1 bg-white/20 rounded text-xs"
  }, lang === "fr" ? "20 stratÃ©gies" : "20 strategies"), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-1 bg-white/20 rounded text-xs"
  }, lang === "fr" ? "Audit" : "Audit"), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-1 bg-white/20 rounded text-xs"
  }, lang === "fr" ? "Gaps" : "Gaps"))), /*#__PURE__*/React.createElement("div", {
    onClick: function () {
      onNavigate("diagnostic");
    },
    className: "bg-gradient-to-br from-orange-500 to-red-600 rounded-xl p-6 text-white card-hover cursor-pointer"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-3"
  }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold mb-2"
  }, lang === "fr" ? "Diagnostic de maturitÃ©" : "Maturity Diagnostic"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/90 text-sm mb-3"
  }, lang === "fr" ? "En 30 minutes, un rapport structurÃ© avec forces, vigilances et plan d'action" : "In 30 minutes, a structured report with strengths, concerns and action plan"), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 flex-wrap"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-1 bg-white/20 rounded text-xs"
  }, "24 questions"), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-1 bg-white/20 rounded text-xs"
  }, "6 dimensions"), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-1 bg-white/20 rounded text-xs"
  }, "PDF/Word")))), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 md:grid-cols-4 gap-3 mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-4 text-center shadow-sm tooltip-container"
  }, /*#__PURE__*/React.createElement("span", {
    className: "tooltip-text"
  }, "CFIR, RE-AIM, EPIS, Proctor, TIDieR, Kotter..."), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, "6+"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500 mt-1"
  }, lang === "fr" ? "Cadres thÃ©oriques" : "Frameworks")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-4 text-center shadow-sm tooltip-container"
  }, /*#__PURE__*/React.createElement("span", {
    className: "tooltip-text"
  }, lang === "fr" ? "73 stratÃ©gies d'implÃ©mentation standardisÃ©es (Powell et al.)" : "73 standardized implementation strategies (Powell et al.)"), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, "73"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500 mt-1"
  }, lang === "fr" ? "StratÃ©gies ERIC" : "ERIC Strategies")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-4 text-center shadow-sm tooltip-container"
  }, /*#__PURE__*/React.createElement("span", {
    className: "tooltip-text"
  }, lang === "fr" ? "SantÃ©, santÃ© mentale, Ã©ducation, agriculture, PRFI..." : "Health, mental health, education, agriculture, LMIC..."), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, Object.keys(DOMAINS).length), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500 mt-1"
  }, lang === "fr" ? "Domaines" : "Domains")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-4 text-center shadow-sm tooltip-container"
  }, /*#__PURE__*/React.createElement("span", {
    className: "tooltip-text"
  }, lang === "fr" ? "Cas inspirÃ©s de projets rÃ©els avec ROI documentÃ©" : "Cases inspired by real projects with documented ROI"), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, USE_CASES.length), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500 mt-1"
  }, lang === "fr" ? "Cas d'usage" : "Use Cases"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 mb-8 border border-green-100"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4 text-center"
  }, "\uD83C\uDFAF ", lang === "fr" ? "Pourquoi Moudar ?" : "Why Moudar?"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-green-600 mb-1"
  }, "30-50h"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Ã‰conomisÃ©es sur la rÃ©daction du protocole d'implÃ©mentation" : "Saved on implementation protocol writing")), /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-blue-600 mb-1"
  }, "30 min"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Pour visualiser la maturitÃ© organisationnelle" : "To visualize organizational maturity")), /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-purple-600 mb-1"
  }, "100%"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Rapports standardisÃ©s prÃªts pour bailleurs" : "Standardized reports ready for funders")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-md mb-8 border-l-4 border-purple-500"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4 text-center"
  }, "\uD83D\uDE80 ", lang === "fr" ? "Comment utiliser Moudar en 3 Ã©tapes" : "How to use Moudar in 3 steps"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center mx-auto mb-3 text-lg font-bold"
  }, "1"), /*#__PURE__*/React.createElement("h4", {
    className: "font-semibold text-gray-800 mb-2"
  }, lang === "fr" ? "CrÃ©ez un projet" : "Create a project"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "DÃ©finissez un titre, une organisation, un domaine et une phase (exploration, prÃ©paration, implÃ©mentation, pÃ©rennisation)." : "Define a title, organization, domain and phase (exploration, preparation, implementation, sustainment).")), /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center mx-auto mb-3 text-lg font-bold"
  }, "2"), /*#__PURE__*/React.createElement("h4", {
    className: "font-semibold text-gray-800 mb-2"
  }, lang === "fr" ? "Lancez le Wizard" : "Run the Wizard"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "RÃ©pondez Ã  quelques questions clÃ©s. Moudar gÃ©nÃ¨re un squelette de protocole exportable en Word." : "Answer a few key questions. Moudar generates a draft protocol you can export to Word.")), /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center mx-auto mb-3 text-lg font-bold"
  }, "3"), /*#__PURE__*/React.createElement("h4", {
    className: "font-semibold text-gray-800 mb-2"
  }, lang === "fr" ? "Diagnostic de maturitÃ©" : "Maturity diagnostic"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "En 30 minutes, obtenez un rapport Word (forces, faiblesses, prioritÃ©s) pour la direction ou le bailleur." : "In 30 minutes, get a Word report (strengths, weaknesses, priorities) for management or funders."))), /*#__PURE__*/React.createElement("p", {
    className: "text-center text-sm text-blue-700 mt-4 font-medium"
  }, "\uD83D\uDCA1 ", lang === "fr" ? "Moudar devient votre Â« dossier vivant Â» d'implÃ©mentation : tous vos projets, protocoles et diagnostics au mÃªme endroit." : "Moudar becomes your living implementation file: all your projects, protocols and diagnostics in one place.")), /*#__PURE__*/React.createElement("div", {
    className: "mb-8"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4 text-center text-xl"
  }, "\uD83D\uDCCB ", lang === "fr" ? "Cas d'usage concrets" : "Concrete use cases"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl shadow-sm overflow-hidden"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-blue-600 px-5 py-3"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-white"
  }, "\uD83C\uDFE5 ", lang === "fr" ? "Cas 1 â€“ CHU : dÃ©ploiement d'un nouveau parcours clinique" : "Case 1 â€“ Hospital: deploying a new clinical pathway"), /*#__PURE__*/React.createElement("p", {
    className: "text-blue-100 text-sm"
  }, lang === "fr" ? "Standardiser la mise en Å“uvre d'un projet complexe dans un grand hÃ´pital" : "Standardize implementation of a complex project in a large hospital")), /*#__PURE__*/React.createElement("div", {
    className: "p-5"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4 text-sm"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h5", {
    className: "font-semibold text-gray-700 mb-1"
  }, "\uD83D\uDCCD ", lang === "fr" ? "Contexte" : "Context"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Un CHU dÃ©ploie un nouveau parcours clinique dans plusieurs services. Les Ã©quipes sont motivÃ©es mais avancent avec leurs propres outils." : "A teaching hospital deploys a new clinical pathway across departments. Teams are motivated but use their own tools.")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h5", {
    className: "font-semibold text-gray-700 mb-1"
  }, "\u26A0\uFE0F ", lang === "fr" ? "DÃ©fis" : "Challenges"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Pas de protocole partagÃ©, pas de vue sur la maturitÃ© des services, rapports rÃ©digÃ©s au cas par cas." : "No shared protocol, no view on service maturity, reports written case by case.")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h5", {
    className: "font-semibold text-gray-700 mb-1"
  }, "\u2705 ", lang === "fr" ? "Solution Moudar" : "Moudar Solution"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Protocole gÃ©nÃ©rÃ© en 15 min, diagnostic par service en 30 min, rapports standardisÃ©s pour la direction." : "Protocol generated in 15 min, diagnostic per service in 30 min, standardized reports for management."))))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl shadow-sm overflow-hidden"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-green-600 px-5 py-3"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-white"
  }, "\uD83C\uDF0D ", lang === "fr" ? "Cas 2 â€“ ONG : programme multi-sites en PRFI" : "Case 2 â€“ NGO: multi-site program in LMIC"), /*#__PURE__*/React.createElement("p", {
    className: "text-green-100 text-sm"
  }, lang === "fr" ? "Aligner terrain, bailleurs et recherche autour d'un langage commun" : "Align field, funders and research around a common language")), /*#__PURE__*/React.createElement("div", {
    className: "p-5"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4 text-sm"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h5", {
    className: "font-semibold text-gray-700 mb-1"
  }, "\uD83D\uDCCD ", lang === "fr" ? "Contexte" : "Context"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Une ONG met en Å“uvre un programme de santÃ© dans 5-10 districts d'un PRFI, financÃ© par un bailleur international." : "An NGO implements a health program in 5-10 districts of a LMIC, funded by an international funder.")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h5", {
    className: "font-semibold text-gray-700 mb-1"
  }, "\u26A0\uFE0F ", lang === "fr" ? "DÃ©fis" : "Challenges"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Contraintes locales variables, coordinateurs non formÃ©s Ã  l'IS, exigences de documentation bailleur." : "Variable local constraints, coordinators not trained in IS, funder documentation requirements.")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h5", {
    className: "font-semibold text-gray-700 mb-1"
  }, "\u2705 ", lang === "fr" ? "Solution Moudar" : "Moudar Solution"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Protocole commun adaptÃ© PRFI, diagnostic par district, rapports Word pour bailleurs et Ã©thique." : "Common protocol adapted for LMIC, diagnostic per district, Word reports for funders and ethics."))))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl shadow-sm overflow-hidden"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-blue-600 px-5 py-3"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-white"
  }, "\uD83D\uDD2C ", lang === "fr" ? "Cas 3 â€“ Recherche : essai pragmatique multi-centrique" : "Case 3 â€“ Research: multicenter pragmatic trial"), /*#__PURE__*/React.createElement("p", {
    className: "text-purple-100 text-sm"
  }, lang === "fr" ? "IntÃ©grer la Science de la mise en Å“uvre dans un protocole de recherche" : "Integrate Implementation Science into a research protocol")), /*#__PURE__*/React.createElement("div", {
    className: "p-5"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4 text-sm"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h5", {
    className: "font-semibold text-gray-700 mb-1"
  }, "\uD83D\uDCCD ", lang === "fr" ? "Contexte" : "Context"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Une Ã©quipe prÃ©pare un essai pragmatique dans plusieurs centres. Le comitÃ© demande un volet solide en Science de la mise en Å“uvre." : "A team prepares a pragmatic trial in multiple centers. The committee requires a solid Implementation Science component.")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h5", {
    className: "font-semibold text-gray-700 mb-1"
  }, "\u26A0\uFE0F ", lang === "fr" ? "DÃ©fis" : "Challenges"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Choisir et justifier les cadres, documenter stratÃ©gies et outcomes, peu de temps et peu de soutien mÃ©thodologique." : "Choose and justify frameworks, document strategies and outcomes, little time and methodological support.")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h5", {
    className: "font-semibold text-gray-700 mb-1"
  }, "\u2705 ", lang === "fr" ? "Solution Moudar" : "Moudar Solution"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Protocole IS prÃ©-structurÃ© pour SPIRIT/CONSORT, cadres/outcomes/stratÃ©gies cohÃ©rents, Word prÃªt pour Ã©thique." : "Pre-structured IS protocol for SPIRIT/CONSORT, coherent frameworks/outcomes/strategies, Word ready for ethics."))))))), /*#__PURE__*/React.createElement("div", {
    className: "mb-8"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4 text-center text-xl"
  }, "\uD83C\uDF10 ", lang === "fr" ? "Au-delÃ  de la santÃ© : tous les secteurs" : "Beyond health: all sectors"), /*#__PURE__*/React.createElement("p", {
    className: "text-center text-gray-600 mb-6"
  }, lang === "fr" ? "Moudar s'adapte Ã  tous les projets de changement, pas seulement la santÃ©" : "Moudar adapts to all change projects, not just healthcare"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-yellow-50 to-amber-50 rounded-xl p-5 border border-yellow-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl mb-2"
  }, "\uD83C\uDF93"), /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "Ã‰ducation" : "Education"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-3"
  }, lang === "fr" ? "PÃ©dagogie par projets en lycÃ©e professionnel" : "Project-based learning in vocational school"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-amber-700 bg-amber-100 px-2 py-1 rounded inline-block"
  }, lang === "fr" ? "200 enseignants â€¢ 15 Ã©tablissements" : "200 teachers â€¢ 15 schools")), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-pink-50 to-rose-50 rounded-xl p-5 border border-pink-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl mb-2"
  }, "\uD83E\uDD1D"), /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "Action sociale" : "Social Services"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-3"
  }, lang === "fr" ? "Programme Logement d'Abord" : "Housing First Program"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-rose-700 bg-rose-100 px-2 py-1 rounded inline-block"
  }, lang === "fr" ? "12 services â€¢ 500k habitants" : "12 services â€¢ 500k pop.")), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-slate-50 to-gray-100 rounded-xl p-5 border border-slate-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl mb-2"
  }, "\u2696\uFE0F"), /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "Justice" : "Justice"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-3"
  }, lang === "fr" ? "PrÃ©paration Ã  la sortie de prison" : "Prison Reentry Preparation"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-slate-700 bg-slate-200 px-2 py-1 rounded inline-block"
  }, lang === "fr" ? "RÃ©duire rÃ©cidive de 40%" : "Reduce recidivism by 40%")), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-5 border border-blue-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl mb-2"
  }, "\uD83C\uDFE2"), /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "Transformation RH" : "HR Transformation"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-3"
  }, lang === "fr" ? "DÃ©ploiement du tÃ©lÃ©travail hybride" : "Hybrid Remote Work Deployment"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-blue-700 bg-blue-100 px-2 py-1 rounded inline-block"
  }, lang === "fr" ? "2,000 employÃ©s" : "2,000 employees")), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-5 border border-green-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl mb-2"
  }, "\uD83C\uDF31"), /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "Agriculture / Climat" : "Agriculture / Climate"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-3"
  }, lang === "fr" ? "Adoption de l'agroÃ©cologie" : "Agroecology Adoption"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-green-700 bg-green-100 px-2 py-1 rounded inline-block"
  }, lang === "fr" ? "150 agriculteurs" : "150 farmers")), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl p-5 border border-purple-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl mb-2"
  }, "\uD83D\uDCBB"), /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "Transformation digitale" : "Digital Transformation"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-3"
  }, lang === "fr" ? "Dossier patient en EHPAD" : "EHR in Nursing Homes"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-purple-700 bg-purple-100 px-2 py-1 rounded inline-block"
  }, lang === "fr" ? "25 Ã©tablissements â€¢ 800 soignants" : "25 facilities â€¢ 800 staff"))), /*#__PURE__*/React.createElement("p", {
    className: "text-center text-sm text-gray-500 mt-4 italic"
  }, lang === "fr" ? "ðŸ’¡ La Science de la mise en Å“uvre s'applique Ã  tout changement de pratiques, quel que soit le secteur." : "ðŸ’¡ Implementation Science applies to any practice change, regardless of sector.")), /*#__PURE__*/React.createElement("div", {
    className: "text-center text-sm text-gray-500 mb-8"
  }, /*#__PURE__*/React.createElement("p", null, lang === "fr" ? "DÃ©veloppÃ© par Younes MOUDAR" : "Developed by Younes MOUDAR")), /*#__PURE__*/React.createElement("div", {
    className: "bg-amber-50 border border-amber-200 rounded-xl p-4 mb-8"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-amber-800 text-sm text-center"
  }, /*#__PURE__*/React.createElement("strong", null, "\u26A0\uFE0F ", lang === "fr" ? "Version dÃ©mo" : "Demo version"), " \u2014 ", lang === "fr" ? "Merci de ne pas saisir de donnÃ©es patients nominatives. Les donnÃ©es sont stockÃ©es localement dans votre navigateur." : "Please do not enter patient-identifying data. Data is stored locally in your browser.")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-6 bg-gradient-to-r from-blue-600 to-teal-600 rounded-2xl text-white"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold mb-2"
  }, lang === "fr" ? "PrÃªt Ã  structurer votre projet ?" : "Ready to structure your project?"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/80 mb-4"
  }, lang === "fr" ? "Demandez une dÃ©monstration personnalisÃ©e" : "Request a personalized demonstration"), /*#__PURE__*/React.createElement("a", {
    href: "mailto:contact@moudar.com?subject=Demande%20de%20d\xE9mo%20Moudar",
    className: "px-8 py-4 bg-white text-blue-700 rounded-xl font-bold text-lg hover:bg-blue-50 inline-block transition shadow-lg"
  }, "\uD83D\uDCE9 ", lang === "fr" ? "Demander une dÃ©mo" : "Request a demo")));
}

// ============================================
// PRODUCT PAGE (/product) - Version dÃ©taillÃ©e
// ============================================
function ProductView(props) {
  var onNavigate = props.onNavigate;
  var lang = props.lang;
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in max-w-5xl mx-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-12"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-semibold uppercase tracking-wide mb-4"
  }, lang === "fr" ? "DÃ©tail du produit" : "Product details"), /*#__PURE__*/React.createElement("h1", {
    className: "text-3xl md:text-4xl font-bold text-gray-900 mb-4"
  }, lang === "fr" ? "Tout ce que fait Moudar pour vos projets d'implÃ©mentation" : "Everything Moudar does for your implementation projects"), /*#__PURE__*/React.createElement("p", {
    className: "text-lg text-gray-600 max-w-3xl mx-auto mb-6"
  }, lang === "fr" ? "Un assistant de conception, un diagnostic de maturitÃ© et un dossier vivant, dans un seul outil, pour les hÃ´pitaux, ONG, ministÃ¨res et Ã©quipes de recherche." : "A design assistant, maturity diagnostic and living file, in one tool, for hospitals, NGOs, ministries and research teams."), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap justify-center gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("pricing");
    },
    className: "px-6 py-3 bg-blue-600 text-white rounded-full font-semibold hover:bg-blue-700 transition"
  }, lang === "fr" ? "Voir les offres" : "See pricing"), /*#__PURE__*/React.createElement("a", {
    href: "mailto:contact@moudar.com?subject=Demande%20de%20d\xE9mo%20Moudar",
    className: "px-6 py-3 bg-white text-gray-800 rounded-full font-semibold border border-gray-300 hover:bg-gray-50 transition"
  }, lang === "fr" ? "Demander une dÃ©mo" : "Request a demo"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-sm p-8 mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-5 gap-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "md:col-span-3"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-900 mb-4"
  }, "\u2728 ", lang === "fr" ? "Assistant de conception â€“ du contexte au protocole structurÃ©" : "Design Assistant â€“ from context to structured protocol"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 mb-4"
  }, lang === "fr" ? "L'assistant de Moudar transforme quelques rÃ©ponses clÃ©s en un protocole d'implÃ©mentation argumentÃ©, appuyÃ© sur les principaux cadres de la Science de la mise en Å“uvre. Pas besoin d'Ãªtre expert CFIR/RE-AIM pour produire un document solide." : "Moudar's assistant transforms a few key answers into an evidence-based implementation protocol, supported by major Implementation Science frameworks. No need to be a CFIR/RE-AIM expert to produce a solid document."), /*#__PURE__*/React.createElement("p", {
    className: "font-semibold text-gray-800 mb-2"
  }, lang === "fr" ? "Vous rÃ©pondez Ã  des questions simples sur :" : "You answer simple questions about:"), /*#__PURE__*/React.createElement("ul", {
    className: "text-gray-600 space-y-1 mb-4 list-disc list-inside"
  }, /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "le contexte (type d'Ã©tablissement, rÃ©gion, contraintes, ressources)" : "context (facility type, region, constraints, resources)"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "la population cible (patients, professionnels, communautÃ©, Ã©lÃ¨vesâ€¦)" : "target population (patients, professionals, community, students...)"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "les barriÃ¨res perÃ§ues (rÃ©sistance, surcharge, manque de donnÃ©es, culture, stigmaâ€¦)" : "perceived barriers (resistance, overload, lack of data, culture, stigma...)"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "la phase EPIS (exploration, prÃ©paration, implÃ©mentation, pÃ©rennisation)" : "EPIS phase (exploration, preparation, implementation, sustainment)")), /*#__PURE__*/React.createElement("p", {
    className: "font-semibold text-gray-800 mb-2"
  }, lang === "fr" ? "Moudar suggÃ¨re alors automatiquement :" : "Moudar then automatically suggests:"), /*#__PURE__*/React.createElement("ul", {
    className: "text-gray-600 space-y-1 list-disc list-inside"
  }, /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "des cadres d'implÃ©mentation adaptÃ©s (CFIR 2.0, EPIS, RE-AIM, Proctor, TIDieR)" : "suitable implementation frameworks (CFIR 2.0, EPIS, RE-AIM, Proctor, TIDieR)"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "des stratÃ©gies d'implÃ©mentation (inspirÃ©es d'ERIC)" : "implementation strategies (inspired by ERIC)"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "des rÃ©sultats d'implÃ©mentation Ã  suivre (acceptabilitÃ©, faisabilitÃ©, adoption, pÃ©rennitÃ©, coÃ»t, Ã©quitÃ©â€¦)" : "implementation outcomes to track (acceptability, feasibility, adoption, sustainability, cost, equity...)"))), /*#__PURE__*/React.createElement("div", {
    className: "md:col-span-2"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gray-50 rounded-xl p-6 border border-gray-100"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block px-2 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-semibold uppercase mb-3"
  }, lang === "fr" ? "Livrable" : "Deliverable"), /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-gray-900 mb-3"
  }, lang === "fr" ? "Protocole d'implÃ©mentation (Word)" : "Implementation Protocol (Word)"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 text-sm mb-3"
  }, lang === "fr" ? "Le document gÃ©nÃ©rÃ© contient :" : "The generated document contains:"), /*#__PURE__*/React.createElement("ul", {
    className: "text-gray-600 text-sm space-y-1 list-disc list-inside"
  }, /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "RÃ©sumÃ© du projet (objet, contexte, population, objectifs)" : "Project summary (subject, context, population, objectives)"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Cadre conceptuel d'implÃ©mentation (CFIR/EPIS/RE-AIM)" : "Implementation conceptual framework (CFIR/EPIS/RE-AIM)"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "StratÃ©gies sÃ©lectionnÃ©es et justifications" : "Selected strategies and justifications"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "BarriÃ¨res et leviers identifiÃ©s" : "Identified barriers and facilitators"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "RÃ©sultats d'implÃ©mentation visÃ©s" : "Targeted implementation outcomes"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Plan d'action initial" : "Initial action plan"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Notes TIDieR pour dÃ©crire l'intervention" : "TIDieR notes to describe the intervention")), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500 text-xs mt-4"
  }, lang === "fr" ? "Le protocole peut ensuite Ãªtre affinÃ© avec vos Ã©quipes, intÃ©grÃ© Ã  un dossier Ã©thique ou utilisÃ© comme base pour un article scientifique." : "The protocol can then be refined with your teams, integrated into an ethics file or used as a basis for a scientific article.")))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 text-center"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("wizard");
    },
    className: "px-6 py-3 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition"
  }, "\u2728 ", lang === "fr" ? "CrÃ©er un protocole" : "Create a protocol"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-sm p-8 mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-5 gap-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "md:col-span-3"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-900 mb-4"
  }, "\uD83D\uDCCA ", lang === "fr" ? "Diagnostic de maturitÃ© â€“ savoir d'oÃ¹ vous partez" : "Maturity Diagnostic â€“ know where you stand"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 mb-4"
  }, lang === "fr" ? "Moudar propose un diagnostic de maturitÃ© d'implÃ©mentation en 6 dimensions, pour Ã©valuer Ã  quel point votre organisation est prÃªte Ã  porter une innovation." : "Moudar offers an implementation maturity diagnostic in 6 dimensions, to assess how ready your organization is to carry an innovation."), /*#__PURE__*/React.createElement("p", {
    className: "font-semibold text-gray-800 mb-2"
  }, lang === "fr" ? "Les 6 dimensions Ã©valuÃ©es :" : "The 6 dimensions assessed:"), /*#__PURE__*/React.createElement("ul", {
    className: "text-gray-600 space-y-1 mb-4 list-disc list-inside"
  }, /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Leadership & gouvernance" : "Leadership & governance"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Culture & climat organisationnel" : "Culture & organizational climate"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Ressources & capacitÃ©s opÃ©rationnelles" : "Resources & operational capabilities"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "SystÃ¨mes d'information & donnÃ©es" : "Information systems & data"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "CompÃ©tences & capacitÃ© de changement" : "Skills & change capacity"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Partenariats & ancrage externe" : "Partnerships & external anchoring")), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "En 30 Ã  45 minutes, une Ã©quipe projet ou un groupe d'acteurs clÃ©s peut complÃ©ter le questionnaire et obtenir une vision claire de ses atouts et de ses zones Ã  renforcer." : "In 30 to 45 minutes, a project team or group of key stakeholders can complete the questionnaire and get a clear view of their strengths and areas to strengthen.")), /*#__PURE__*/React.createElement("div", {
    className: "md:col-span-2"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-orange-50 rounded-xl p-6 border border-orange-100"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block px-2 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-semibold uppercase mb-3"
  }, lang === "fr" ? "RÃ©sultats" : "Results"), /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-gray-900 mb-3"
  }, lang === "fr" ? "Score global, forces, prioritÃ©s" : "Global score, strengths, priorities"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 text-sm mb-3"
  }, lang === "fr" ? "Le diagnostic produit :" : "The diagnostic produces:"), /*#__PURE__*/React.createElement("ul", {
    className: "text-gray-600 text-sm space-y-1 list-disc list-inside"
  }, /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "un score global de maturitÃ©" : "a global maturity score"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "des scores par dimension" : "scores by dimension"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "une liste de forces : ce qui fonctionne dÃ©jÃ  bien" : "a list of strengths: what already works well"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "des points de vigilance et des prioritÃ©s d'action" : "areas of concern and action priorities"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "un rapport Word/PDF avec rÃ©sumÃ© exÃ©cutif" : "a Word/PDF report with executive summary")), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500 text-xs mt-4"
  }, lang === "fr" ? "Ce rapport peut Ãªtre utilisÃ© dans vos comitÃ©s de pilotage, rÃ©unions de direction ou Ã©changes avec les bailleurs." : "This report can be used in your steering committees, management meetings or exchanges with funders.")))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 text-center"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("diagnostic");
    },
    className: "px-6 py-3 bg-orange-500 text-white rounded-xl font-semibold hover:bg-orange-600 transition"
  }, "\uD83D\uDCCA ", lang === "fr" ? "Lancer un diagnostic" : "Start a diagnostic"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-sm p-8 mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-5 gap-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "md:col-span-3"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-900 mb-4"
  }, "\uD83D\uDCC2 ", lang === "fr" ? "Dossier vivant â€“ l'histoire complÃ¨te de chaque projet" : "Living File â€“ the complete history of each project"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 mb-4"
  }, lang === "fr" ? "Dans Moudar, chaque projet devient un dossier vivant d'implÃ©mentation. Vous ne perdez plus la trace des dÃ©cisions et des versions." : "In Moudar, each project becomes a living implementation file. You no longer lose track of decisions and versions."), /*#__PURE__*/React.createElement("p", {
    className: "font-semibold text-gray-800 mb-2"
  }, lang === "fr" ? "Pour chaque projet, vous conservez :" : "For each project, you keep:"), /*#__PURE__*/React.createElement("ul", {
    className: "text-gray-600 space-y-1 mb-4 list-disc list-inside"
  }, /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Une fiche projet : titre, organisation, domaine, phase EPIS, tags" : "A project sheet: title, organization, domain, EPIS phase, tags"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Un statut : brouillon, protocole gÃ©nÃ©rÃ©, diagnostiquÃ©, en cours, clÃ´turÃ©" : "A status: draft, protocol generated, diagnosed, in progress, closed"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Un historique des diagnostics : dates, scores, Ã©volution" : "A diagnostic history: dates, scores, evolution"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Un historique des protocoles : versions successives exportables" : "A protocol history: successive exportable versions")), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Vous pouvez suivre un projet sur 6, 12 ou 24 mois, et produire Ã  tout moment une trace structurÃ©e pour vos directions, vos bailleurs ou vos audits." : "You can track a project over 6, 12 or 24 months, and produce a structured record at any time for your management, funders or audits.")), /*#__PURE__*/React.createElement("div", {
    className: "md:col-span-2"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-green-50 rounded-xl p-6 border border-green-100"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-semibold uppercase mb-3"
  }, lang === "fr" ? "Vue \"Mes projets\"" : "\"My Projects\" view"), /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-gray-900 mb-3"
  }, lang === "fr" ? "Une vue claire pour piloter" : "A clear view for steering"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 text-sm mb-3"
  }, lang === "fr" ? "La vue \"Mes projets\" permet de voir :" : "The \"My Projects\" view shows:"), /*#__PURE__*/React.createElement("ul", {
    className: "text-gray-600 text-sm space-y-1 list-disc list-inside"
  }, /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "le statut de chaque projet" : "the status of each project"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "la phase EPIS et le domaine concernÃ©" : "the EPIS phase and related domain"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "la date du dernier diagnostic et du dernier protocole" : "the date of the last diagnostic and last protocol"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "les tags (ex. \"mhGAP\", \"suicide\", \"Digital health\")" : "tags (e.g. \"mhGAP\", \"suicide\", \"Digital health\")")), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500 text-xs mt-4"
  }, lang === "fr" ? "C'est votre \"cockpit\" d'implÃ©mentation : vous savez oÃ¹ vous en Ãªtes et ce qui doit Ãªtre retravaillÃ© en prioritÃ©." : "It's your implementation \"cockpit\": you know where you stand and what needs to be reworked as a priority.")))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 text-center"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("myProjects");
    },
    className: "px-6 py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition"
  }, "\uD83D\uDCC2 ", lang === "fr" ? "Voir mes projets" : "View my projects"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-sm p-8 mb-8"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-900 mb-4"
  }, "\uD83D\uDD2C ", lang === "fr" ? "La science de la mise en Å“uvre, sans la lourdeur du jargon" : "Implementation science, without the jargon"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 mb-4"
  }, lang === "fr" ? "Moudar s'appuie sur les principaux cadres de la Science de la mise en Å“uvre, mais les rend utilisables par des Ã©quipes qui n'ont pas le temps de lire des dizaines d'articles scientifiques." : "Moudar builds on major Implementation Science frameworks, but makes them usable by teams who don't have time to read dozens of scientific articles."), /*#__PURE__*/React.createElement("p", {
    className: "font-semibold text-gray-800 mb-3"
  }, lang === "fr" ? "Parmi les rÃ©fÃ©rences intÃ©grÃ©es :" : "Among the integrated references:"), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-2 mb-6"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"
  }, "CFIR 2.0"), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"
  }, "EPIS"), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"
  }, "RE-AIM"), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"
  }, "Proctor et al."), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"
  }, "TIDieR"), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm"
  }, lang === "fr" ? "73 stratÃ©gies ERIC" : "73 ERIC strategies")), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 mb-6"
  }, lang === "fr" ? "Le moteur de Moudar fait le lien entre vos rÃ©ponses et ces cadres pour gÃ©nÃ©rer des propositions cohÃ©rentes (cadres, stratÃ©gies, rÃ©sultats d'implÃ©mentation), que vous pouvez ensuite ajuster et enrichir avec vos Ã©quipes." : "Moudar's engine links your answers to these frameworks to generate consistent proposals (frameworks, strategies, implementation outcomes), which you can then adjust and enrich with your teams."), /*#__PURE__*/React.createElement("div", {
    className: "bg-blue-50 rounded-xl p-4 border border-blue-100"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-blue-800 text-sm"
  }, /*#__PURE__*/React.createElement("strong", null, lang === "fr" ? "Version actuelle :" : "Current version:"), " ", lang === "fr" ? "Moudar est disponible en version MVP dÃ©mo avec stockage local (navigateur). La version SaaS (backend cloud, multi-utilisateurs, RGPD) est en cours de prÃ©paration." : "Moudar is available as a demo MVP version with local storage (browser). The SaaS version (cloud backend, multi-user, GDPR) is in preparation."))), /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("wizard");
    },
    className: "px-8 py-4 bg-blue-600 text-white rounded-xl font-bold text-lg hover:bg-blue-700 transition shadow-lg"
  }, "\u2728 ", lang === "fr" ? "Commencer maintenant" : "Start now")));
}

// ============================================
// ABOUT PAGE (/about)
// ============================================
function AboutView(props) {
  var lang = props.lang;
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in max-w-4xl mx-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-12"
  }, /*#__PURE__*/React.createElement("h1", {
    className: "text-3xl md:text-4xl font-bold text-gray-900 mb-4"
  }, lang === "fr" ? "Qui sommes-nous ?" : "Who are we?")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-8 shadow-sm mb-8 border-l-4 border-blue-600"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 mb-4"
  }, lang === "fr" ? "Younes MOUDAR, crÃ©ateur de MOUDARÂ®" : "Younes MOUDAR, creator of MOUDARÂ®"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 mb-4"
  }, lang === "fr" ? "SpÃ©cialiste de la Science de la mise en Å“uvre et des politiques sociales complexes, Younes MOUDAR combine de solides qualifications acadÃ©miques Ã  une expertise pratique en recherche et Ã©valuation. Son parcours est axÃ© sur la traduction des donnÃ©es probantes en pratiques opÃ©rationnelles pÃ©rennes, y compris dans des environnements exigeants. Actuellement, directeur pÃ©dagogique de ArdÃ©vaz Medical School en Suisse et fondateur de Swiss Medical Academy Maroc. Perspective globale : fort de son expÃ©rience acquise en Suisse ðŸ‡¨ðŸ‡­ et au Maroc ðŸ‡²ðŸ‡¦, l'approche de MOUDAR est ancrÃ©e dans une comprÃ©hension nuancÃ©e des facteurs organisationnels et culturels (CFIR) essentiels Ã  la rÃ©ussite des politiques et des innovations en santÃ©." : "Specialist in Implementation Science and complex social policies, Younes MOUDAR combines strong academic credentials with hands-on expertise in research and evaluation. His career focuses on translating evidence into sustainable operational practices, including in demanding environments. He is currently Academic Director of ArdÃ©vaz Medical School in Switzerland and founder of Swiss Medical Academy Morocco. Global perspective: drawing on experience in Switzerland ðŸ‡¨ðŸ‡­ and Morocco ðŸ‡²ðŸ‡¦, MOUDARâ€™s approach is grounded in a nuanced understanding of organisational and cultural factors (CFIR) that are essential for successful health policies and innovations."), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-3 gap-4 text-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-blue-600"
  }, "146"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, "Participants")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-blue-600"
  }, "6"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, "Sites")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-blue-600"
  }, "36"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Mois" : "Months")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-8 shadow-sm mb-8"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 mb-4"
  }, "\uD83C\uDFAF ", lang === "fr" ? "Notre mission" : "Our mission"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "DÃ©mocratiser la Science de la mise en Å“uvre en offrant des outils accessibles et intelligents pour concevoir, piloter et Ã©valuer les projets de changement dans tous les secteurs d'activitÃ©." : "Democratize Implementation Science by providing accessible and intelligent tools to design, manage and evaluate change projects across all industries.")), /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("a", {
    href: "mailto:contact@moudar.com",
    className: "inline-block px-6 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition"
  }, "\uD83D\uDCE7 contact@moudar.com")));
}

// ============================================
// INVESTORS PAGE (/investors)
// ============================================
function InvestorsView(props) {
  var lang = props.lang;
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in max-w-5xl mx-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-12"
  }, /*#__PURE__*/React.createElement("h1", {
    className: "text-3xl md:text-4xl font-bold text-gray-900 mb-4"
  }, "\uD83D\uDCC8 ", lang === "fr" ? "Pour les investisseurs" : "For investors"), /*#__PURE__*/React.createElement("p", {
    className: "text-lg text-gray-600"
  }, lang === "fr" ? "Moudar â€” Le copilote numÃ©rique pour la Science de la mise en Å“uvre" : "Moudar â€” The digital co-pilot for Implementation Science")), /*#__PURE__*/React.createElement("div", {
    className: "bg-green-50 rounded-xl p-6 mb-8 border border-green-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-green-600 text-white rounded-full text-xs font-bold uppercase"
  }, lang === "fr" ? "MVP fonctionnel" : "Working MVP")), /*#__PURE__*/React.createElement("p", {
    className: "text-green-800 font-medium mb-2"
  }, lang === "fr" ? "Ce que vous pouvez tester dÃ¨s maintenant :" : "What you can test right now:"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-4 gap-4 text-sm text-green-700"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", null, "\u2713"), " ", lang === "fr" ? "Wizard conception protocole" : "Protocol design wizard"), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", null, "\u2713"), " ", lang === "fr" ? "Diagnostic maturitÃ© 6 dimensions" : "6-dimension maturity diagnostic"), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", null, "\u2713"), " ", lang === "fr" ? "Export Word professionnel" : "Professional Word export"), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", null, "\u2713"), " ", lang === "fr" ? "Gestion multi-projets" : "Multi-project management"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-8 shadow-sm mb-8 border-l-4 border-blue-600"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 mb-4"
  }, "\uD83D\uDE80 ", lang === "fr" ? "Vision produit" : "Product vision"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gray-50 rounded-lg"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-semibold text-gray-700 mb-2"
  }, lang === "fr" ? "Aujourd'hui (MVP)" : "Today (MVP)"), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-gray-600 space-y-1"
  }, /*#__PURE__*/React.createElement("li", null, "\u2022 Application web standalone"), /*#__PURE__*/React.createElement("li", null, "\u2022 Stockage local navigateur"), /*#__PURE__*/React.createElement("li", null, "\u2022 Export Word professionnel"), /*#__PURE__*/React.createElement("li", null, "\u2022 Diagnostic de maturit\xE9"))), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-blue-50 rounded-lg"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-semibold text-blue-700 mb-2"
  }, lang === "fr" ? "Demain (SaaS)" : "Tomorrow (SaaS)"), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-blue-600 space-y-1"
  }, /*#__PURE__*/React.createElement("li", null, "\u2022 Plateforme multi-organisations"), /*#__PURE__*/React.createElement("li", null, "\u2022 Cloud UE (RGPD), SSO/SAML"), /*#__PURE__*/React.createElement("li", null, "\u2022 API REDCap, modules IA"), /*#__PURE__*/React.createElement("li", null, "\u2022 Tableaux de bord IHI"))))), /*#__PURE__*/React.createElement("div", {
    className: "bg-blue-50 rounded-xl p-8 mb-8 border border-blue-100"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 mb-6"
  }, "\uD83C\uDFAF ", lang === "fr" ? "MarchÃ© cible" : "Target market"), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 md:grid-cols-4 gap-6 text-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, "400+"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, "CHU")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, "50+"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "MinistÃ¨res" : "Ministries")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, "200+"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, "ONG")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, "~10k"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, "Consultants"))), /*#__PURE__*/React.createElement("p", {
    className: "text-center text-gray-500 text-sm mt-4"
  }, lang === "fr" ? "Potentiel ARR estimÃ© : ~$245k (650+ cibles Ã— $375/an)" : "Estimated ARR potential: ~$245k (650+ targets Ã— $375/year)")), /*#__PURE__*/React.createElement("div", {
    className: "bg-amber-50 rounded-xl p-8 mb-8 border border-amber-200"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 mb-4"
  }, "\u23F0 ", lang === "fr" ? "Pourquoi maintenant ?" : "Why now?"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-white rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl mb-2"
  }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Pression OMS croissante sur la preuve d'impact des interventions" : "Growing WHO pressure on intervention impact evidence")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-white rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl mb-2"
  }, "\uD83D\uDCBB"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Explosion de la digital health et des outils d'aide Ã  la dÃ©cision" : "Digital health explosion and decision support tools")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-white rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl mb-2"
  }, "\uD83C\uDF0D"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Gap critique dans les pays Ã  revenus faibles et intermÃ©diaires (PRFI)" : "Critical gap in low and middle-income countries (LMICs)")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-8 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-2xl font-bold mb-2"
  }, lang === "fr" ? "Objectif de levÃ©e" : "Funding goal"), /*#__PURE__*/React.createElement("div", {
    className: "text-4xl font-bold text-teal-400 mb-2"
  }, "$85 \u2013 $130K USD"), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-300"
  }, lang === "fr" ? "PrÃ©-seed / Seed pour 18 mois" : "Pre-seed / Seed for 18 months")), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4 mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-slate-700/50 rounded-lg text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl mb-1"
  }, "\uD83D\uDC68\u200D\uD83D\uDCBB"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-slate-300"
  }, lang === "fr" ? "Tech & Dev (backend SaaS, sÃ©curitÃ©, API)" : "Tech & Dev (SaaS backend, security, API)")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-slate-700/50 rounded-lg text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl mb-1"
  }, "\uD83C\uDFA8"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-slate-300"
  }, lang === "fr" ? "UX/UI (expÃ©rience utilisateur)" : "UX/UI (user experience)")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-slate-700/50 rounded-lg text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl mb-1"
  }, "\uD83E\uDD1D"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-slate-300"
  }, lang === "fr" ? "Premiers clients pilotes" : "First pilot customers"))), /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("a", {
    href: "mailto:contact@moudar.com?subject=Moudar%20-%20Investisseur",
    className: "inline-block px-8 py-4 bg-white text-slate-800 rounded-xl font-bold text-lg hover:bg-slate-100 transition shadow-lg"
  }, "\uD83D\uDCE9 ", lang === "fr" ? "Demander une dÃ©mo" : "Request a demo", " : contact@moudar.com"))));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PITCH VIEW v8.0 - Page de prÃ©sentation pour thÃ¨se/investisseurs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function PitchView(props) {
  var lang = props.lang;
  var onNavigate = props.onNavigate;
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-3xl p-8 md:p-12 text-white mb-8 relative overflow-hidden"
  }, /*#__PURE__*/React.createElement("div", {
    className: "absolute inset-0 opacity-10"
  }, /*#__PURE__*/React.createElement("div", {
    className: "absolute top-10 left-10 w-32 h-32 bg-red-500 rounded-full blur-3xl"
  }), /*#__PURE__*/React.createElement("div", {
    className: "absolute bottom-10 right-10 w-40 h-40 bg-blue-500 rounded-full blur-3xl"
  })), /*#__PURE__*/React.createElement("div", {
    className: "relative z-10"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-8"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block px-4 py-1 bg-red-500/20 text-red-400 rounded-full text-sm font-medium mb-4"
  }, lang === "fr" ? "LE PROBLÃˆME" : "THE PROBLEM"), /*#__PURE__*/React.createElement("h1", {
    className: "text-4xl md:text-6xl font-bold mb-4"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-red-400"
  }, "70%"), " ", lang === "fr" ? "des projets de changement" : "of change projects"), /*#__PURE__*/React.createElement("h2", {
    className: "text-3xl md:text-5xl font-bold text-white/80 mb-6"
  }, lang === "fr" ? "Ã©chouent ou sous-performent" : "fail or underperform"), /*#__PURE__*/React.createElement("p", {
    className: "text-xl text-slate-300 max-w-3xl mx-auto"
  }, lang === "fr" ? "Pas par manque de volontÃ©, mais par manque de mÃ©thodologie scientifique d'implÃ©mentation." : "Not from lack of will, but from lack of scientific implementation methodology.")), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-6 mt-10"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white/5 rounded-xl p-5 text-center border border-white/10"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-2"
  }, "\uD83D\uDCB0"), /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-red-400"
  }, "$17B"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-slate-400"
  }, lang === "fr" ? "perdus en Ã©checs d'implÃ©mentation/an (US santÃ©)" : "lost to implementation failures/year (US health)")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white/5 rounded-xl p-5 text-center border border-white/10"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-2"
  }, "\u23F1\uFE0F"), /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-amber-400"
  }, "17 ", lang === "fr" ? "ans" : "years"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-slate-400"
  }, lang === "fr" ? "pour traduire la recherche en pratique clinique" : "to translate research into clinical practice")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white/5 rounded-xl p-5 text-center border border-white/10"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-2"
  }, "\uD83D\uDCC9"), /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-orange-400"
  }, "85%"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-slate-400"
  }, lang === "fr" ? "des interventions efficaces ne sont jamais adoptÃ©es" : "of effective interventions are never adopted"))))), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-blue-600 via-indigo-600 to-purple-600 rounded-3xl p-8 md:p-12 text-white mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-8"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block px-4 py-1 bg-white/20 text-white rounded-full text-sm font-medium mb-4"
  }, lang === "fr" ? "LA SOLUTION" : "THE SOLUTION"), /*#__PURE__*/React.createElement("h2", {
    className: "text-3xl md:text-5xl font-bold mb-4"
  }, "Moudar"), /*#__PURE__*/React.createElement("p", {
    className: "text-xl text-white/80 max-w-2xl mx-auto"
  }, lang === "fr" ? "Le copilote IA pour la Science de la mise en Å“uvre" : "The AI copilot for Implementation Science")), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white/10 rounded-xl p-6 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-5xl mb-4"
  }, "1\uFE0F\u20E3"), /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold mb-2"
  }, lang === "fr" ? "DÃ©crivez votre projet" : "Describe your project"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/70"
  }, lang === "fr" ? "7 questions simples sur votre contexte, population, barriÃ¨res" : "7 simple questions about your context, population, barriers")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white/10 rounded-xl p-6 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-5xl mb-4"
  }, "2\uFE0F\u20E3"), /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold mb-2"
  }, lang === "fr" ? "L'IA recommande" : "AI recommends"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/70"
  }, lang === "fr" ? "StratÃ©gies ERIC, cadres CFIR/RE-AIM, timeline EPIS, budget estimÃ©" : "ERIC strategies, CFIR/RE-AIM frameworks, EPIS timeline, estimated budget")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white/10 rounded-xl p-6 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-5xl mb-4"
  }, "3\uFE0F\u20E3"), /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold mb-2"
  }, lang === "fr" ? "Exportez & Certifiez" : "Export & Certify"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/70"
  }, lang === "fr" ? "Protocole Word, certification Moudar Ready, intÃ©gration REDCap" : "Word protocol, Moudar Ready certification, REDCap integration")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-3xl p-8 md:p-12 mb-8 shadow-xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-8"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block px-4 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-medium mb-4"
  }, lang === "fr" ? "DIFFÃ‰RENCIANTS" : "DIFFERENTIATORS"), /*#__PURE__*/React.createElement("h2", {
    className: "text-3xl md:text-4xl font-bold text-gray-900"
  }, lang === "fr" ? "Ce que personne d'autre ne fait" : "What no one else does")), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl p-6 border border-indigo-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-start gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl"
  }, "\uD83D\uDD0D"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "IA ExpliquÃ©e (XAI)" : "Explainable AI (XAI)"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Moudar explique POURQUOI il recommande chaque stratÃ©gie. Pas une boÃ®te noire, mais un copilote transparent." : "Moudar explains WHY it recommends each strategy. Not a black box, but a transparent copilot.")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-amber-50 to-yellow-50 rounded-2xl p-6 border border-amber-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-start gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl"
  }, "\uD83C\uDFC6"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "Certification Moudar Ready" : "Moudar Ready Certification"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Un label qualitÃ© pour les protocoles d'implÃ©mentation. Score 0-100 basÃ© sur 10 critÃ¨res IS." : "A quality label for implementation protocols. Score 0-100 based on 10 IS criteria.")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-pink-50 to-rose-50 rounded-2xl p-6 border border-pink-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-start gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl"
  }, "\uD83D\uDCC4"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "Analyseur de Document" : "Document Analyzer"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Collez un protocole existant â†’ Moudar identifie les gaps IS et gÃ©nÃ¨re les sections manquantes." : "Paste an existing protocol â†’ Moudar identifies IS gaps and generates missing sections.")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-6 border border-green-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-start gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl"
  }, "\uD83C\uDF0D"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "Multi-secteurs" : "Multi-sector"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "SantÃ©, Ã©ducation, justice, RH, environnement... La Science de l'implÃ©mentation s'applique Ã  tout changement." : "Health, education, justice, HR, environment... Implementation Science applies to any change.")))))), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-slate-800 to-slate-900 rounded-3xl p-8 md:p-12 text-white mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-8"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block px-4 py-1 bg-teal-500/20 text-teal-400 rounded-full text-sm font-medium mb-4"
  }, lang === "fr" ? "PLATEFORME MONDIALE" : "GLOBAL PLATFORM"), /*#__PURE__*/React.createElement("h2", {
    className: "text-3xl md:text-4xl font-bold"
  }, lang === "fr" ? "DonnÃ©es de rÃ©fÃ©rence mondiale" : "Global reference data")), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 md:grid-cols-4 gap-6 text-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl md:text-5xl font-bold text-teal-400"
  }, "2,847"), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-400"
  }, lang === "fr" ? "Projets analysÃ©s" : "Projects analyzed")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl md:text-5xl font-bold text-blue-400"
  }, "89"), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-400"
  }, lang === "fr" ? "Pays" : "Countries")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl md:text-5xl font-bold text-purple-400"
  }, "73"), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-400"
  }, lang === "fr" ? "StratÃ©gies ERIC" : "ERIC strategies")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl md:text-5xl font-bold text-amber-400"
  }, "24"), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-400"
  }, lang === "fr" ? "Modules IA" : "AI modules")))), /*#__PURE__*/React.createElement("div", {
    className: "text-center py-12"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-2xl font-bold text-gray-800 mb-4"
  }, lang === "fr" ? "PrÃªt Ã  voir Moudar en action ?" : "Ready to see Moudar in action?"), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap justify-center gap-4"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("wizard");
    },
    className: "px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-bold text-lg hover:from-blue-700 hover:to-purple-700 transition shadow-lg"
  }, "\u2728 ", lang === "fr" ? "Essayer maintenant" : "Try now"), /*#__PURE__*/React.createElement("a", {
    href: "mailto:contact@moudar.com?subject=Demande%20de%20d\xE9mo%20Moudar",
    className: "px-8 py-4 bg-white text-gray-800 rounded-xl font-bold text-lg border-2 border-gray-200 hover:border-gray-300 hover:bg-gray-50 transition"
  }, "\uD83D\uDCE9 ", lang === "fr" ? "Demander une dÃ©mo" : "Request a demo"))));
}

// ============================================
// MY PROJECTS VIEW
// ============================================
function MyProjectsView(props) {
  var onNavigate = props.onNavigate;
  var onOpenProject = props.onOpenProject;
  var onStartDiagnostic = props.onStartDiagnostic;
  var lang = props.lang;
  var onShowImportExport = props.onShowImportExport; // v8.1
  var projectsState = useState(StorageManager.getProjects());
  var projects = projectsState[0];
  var setProjects = projectsState[1];
  function formatDate(dateStr) {
    if (!dateStr) return "-";
    var d = new Date(dateStr);
    return d.toLocaleDateString(lang === "fr" ? "fr-FR" : "en-US", {
      day: "numeric",
      month: "short",
      year: "numeric"
    });
  }
  function getMaturityColor(score) {
    if (score >= 70) return "text-green-600 bg-green-100";
    if (score >= 50) return "text-yellow-600 bg-yellow-100";
    return "text-red-600 bg-red-100";
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl p-4 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap justify-center gap-6 text-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "w-6 h-6 bg-white/20 rounded-full flex items-center justify-center text-xs font-bold"
  }, "1"), /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "CrÃ©ez un projet" : "Create a project")), /*#__PURE__*/React.createElement("div", {
    className: "text-white/50"
  }, "\u2192"), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "w-6 h-6 bg-white/20 rounded-full flex items-center justify-center text-xs font-bold"
  }, "2"), /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "GÃ©nÃ©rez le protocole" : "Generate protocol")), /*#__PURE__*/React.createElement("div", {
    className: "text-white/50"
  }, "\u2192"), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "w-6 h-6 bg-white/20 rounded-full flex items-center justify-center text-xs font-bold"
  }, "3"), /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "Lancez le diagnostic" : "Run diagnostic")), /*#__PURE__*/React.createElement("div", {
    className: "text-white/50"
  }, "\u2192"), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "w-6 h-6 bg-white/20 rounded-full flex items-center justify-center text-xs font-bold"
  }, "4"), /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "Exportez en Word" : "Export to Word")))), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-6 flex-wrap gap-3"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800"
  }, "\uD83D\uDCC2 ", lang === "fr" ? "Mes Projets" : "My Projects"), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2"
  }, onShowImportExport && /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onShowImportExport(null);
    },
    className: "px-3 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition text-sm"
  }, "\uD83D\uDCE6 ", lang === "fr" ? "Import/Export" : "Import/Export"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var result = loadExampleProjects();
      if (result.loaded) {
        setProjects(StorageManager.getProjects());
        alert(lang === "fr" ? "âœ“ " + result.count + " projets d'exemple chargÃ©s !" : "âœ“ " + result.count + " example projects loaded!");
      } else {
        alert(lang === "fr" ? "Les projets d'exemple sont dÃ©jÃ  chargÃ©s." : "Example projects are already loaded.");
      }
    },
    className: "px-3 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition text-sm"
  }, "\uD83D\uDCDA ", lang === "fr" ? "Charger exemples" : "Load examples"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("wizard");
    },
    className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
  }, "\u2728 ", lang === "fr" ? "Nouveau projet" : "New project"))), projects.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 md:grid-cols-4 gap-3 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-lg p-3 text-center shadow-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-blue-600"
  }, projects.length), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Projets" : "Projects")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-lg p-3 text-center shadow-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-green-600"
  }, projects.filter(function (p) {
    return p.protocol && p.protocol.frameworks;
  }).length), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Protocoles" : "Protocols")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-lg p-3 text-center shadow-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-orange-600"
  }, projects.filter(function (p) {
    return p.diagnostic && p.diagnostic.global;
  }).length), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Diagnostics" : "Diagnostics")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-lg p-3 text-center shadow-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-purple-600"
  }, function () {
    var withDiag = projects.filter(function (p) {
      return p.diagnostic && p.diagnostic.global;
    });
    if (withDiag.length === 0) return "â€”";
    var avg = withDiag.reduce(function (sum, p) {
      return sum + p.diagnostic.global;
    }, 0) / withDiag.length;
    return avg.toFixed(0) + "%";
  }()), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "MaturitÃ© moy." : "Avg. maturity"))), projects.length === 0 ? /*#__PURE__*/React.createElement("div", {
    className: "text-center py-16 bg-white rounded-xl shadow-md"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-6xl mb-4"
  }, "\uD83D\uDCED"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500 mb-6"
  }, lang === "fr" ? "Aucun projet sauvegardÃ©" : "No saved projects"), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-col sm:flex-row gap-3 justify-center"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("wizard");
    },
    className: "px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition"
  }, "\u2728 ", lang === "fr" ? "CrÃ©er mon premier projet" : "Create my first project"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var result = loadExampleProjects();
      if (result.loaded) {
        setProjects(StorageManager.getProjects());
        alert(lang === "fr" ? "âœ“ " + result.count + " projets d'exemple chargÃ©s !" : "âœ“ " + result.count + " example projects loaded!");
      }
    },
    className: "px-6 py-3 bg-purple-100 text-purple-700 rounded-xl hover:bg-purple-200 transition"
  }, "\uD83D\uDCDA ", lang === "fr" ? "Charger 4 exemples de projets" : "Load 4 example projects")), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-400 mt-4"
  }, lang === "fr" ? "Les exemples incluent : mhGAP, Chirurgie sÃ©curisÃ©e, SantÃ© scolaire, TÃ©lÃ©mÃ©decine" : "Examples include: mhGAP, Safe Surgery, School Health, Telemedicine")) : /*#__PURE__*/React.createElement("div", {
    className: "grid gap-4"
  }, projects.sort(function (a, b) {
    return new Date(b.updatedAt) - new Date(a.updatedAt);
  }).map(function (p) {
    var domainInfo = DOMAINS[p.domain] || {};
    var phaseInfo = PHASES[p.phase] || {};
    var statusBadge = getStatusBadge(p.status || "draft", lang);
    var hasProtocol = p.protocol && p.protocol.frameworks;
    var hasDiagnostic = p.diagnostic && p.diagnostic.global;
    return /*#__PURE__*/React.createElement("div", {
      key: p.id,
      className: "bg-white rounded-xl shadow-sm hover:shadow-md transition border-l-4 border-purple-500 overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "p-5"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex-1"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2 mb-1 flex-wrap"
    }, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-lg text-gray-800"
    }, p.title || (lang === "fr" ? "Sans titre" : "Untitled")), /*#__PURE__*/React.createElement("span", {
      className: "status-badge " + statusBadge.bg + " " + statusBadge.text
    }, statusBadge.icon, " ", statusBadge.label)), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-gray-500 mb-2"
    }, p.organization), /*#__PURE__*/React.createElement("div", {
      className: "flex flex-wrap gap-2 mb-2"
    }, p.domain && /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs"
    }, domainInfo.icon, " ", tObj(domainInfo, lang)), p.phase && /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 bg-purple-100 text-blue-700 rounded text-xs"
    }, phaseInfo.icon, " ", tObj(phaseInfo, lang))), hasProtocol && /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-400 mb-1"
    }, "\uD83D\uDD2C ", lang === "fr" ? "Cadres" : "Frameworks", ": ", p.protocol.frameworks.slice(0, 3).join(", "))), hasDiagnostic && /*#__PURE__*/React.createElement("div", {
      className: "ml-4 px-4 py-3 rounded-xl text-center " + getMaturityColor(p.diagnostic.global)
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl font-bold"
    }, p.diagnostic.global, "%"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs"
    }, lang === "fr" ? "MaturitÃ©" : "Maturity"))), /*#__PURE__*/React.createElement("div", {
      className: "flex flex-wrap gap-2 mt-4 pt-4 border-t border-gray-100"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        onOpenProject(p);
      },
      className: "px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition"
    }, hasProtocol ? "ðŸ“ " + (lang === "fr" ? "Modifier protocole" : "Edit protocol") : "âœ¨ " + (lang === "fr" ? "GÃ©nÃ©rer protocole" : "Generate protocol")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        onStartDiagnostic(p);
      },
      className: "px-3 py-2 bg-orange-600 text-white rounded-lg text-sm hover:bg-orange-700 transition"
    }, hasDiagnostic ? "ðŸ“Š " + (lang === "fr" ? "Nouveau diagnostic" : "New diagnostic") : "ðŸ“Š " + (lang === "fr" ? "Lancer diagnostic" : "Run diagnostic")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        var dup = StorageManager.duplicateProject(p.id);
        if (dup) {
          setProjects(StorageManager.getProjects());
          alert(lang === "fr" ? "âœ“ Projet dupliquÃ©" : "âœ“ Project duplicated");
        }
      },
      className: "px-3 py-2 bg-purple-100 text-purple-600 rounded-lg text-sm hover:bg-purple-200 transition",
      title: lang === "fr" ? "CrÃ©er une copie" : "Create a copy"
    }, "\uD83D\uDCCB ", lang === "fr" ? "Dupliquer" : "Duplicate"), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        var data = StorageManager.exportProject(p.id, 'json');
        if (data) {
          var blob = new Blob([data], {
            type: 'application/json'
          });
          var url = URL.createObjectURL(blob);
          var a = document.createElement('a');
          a.href = url;
          a.download = 'moudar_projet_' + p.id + '.json';
          a.click();
          URL.revokeObjectURL(url);
        }
      },
      className: "px-3 py-2 bg-teal-100 text-teal-600 rounded-lg text-sm hover:bg-teal-200 transition",
      title: lang === "fr" ? "Exporter en JSON" : "Export as JSON"
    }, "\uD83D\uDCE5 ", lang === "fr" ? "Exporter" : "Export"), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        if (confirm(lang === "fr" ? "Supprimer ce projet ?" : "Delete this project?")) setProjects(StorageManager.deleteProject(p.id));
      },
      className: "px-3 py-2 bg-red-100 text-red-600 rounded-lg text-sm hover:bg-red-200 transition"
    }, "\uD83D\uDDD1\uFE0F ", lang === "fr" ? "Supprimer" : "Delete"))), /*#__PURE__*/React.createElement("div", {
      className: "bg-gray-50 px-5 py-2 flex justify-between text-xs text-gray-400"
    }, /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "ModifiÃ© le" : "Modified", ": ", formatDate(p.updatedAt)), hasDiagnostic && /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "Diagnostic du" : "Diagnostic from", ": ", formatDate(p.diagnostic.date))));
  })));
}

// ============================================
// ANALYZER VIEW - Analyse de protocoles existants
// ============================================
function AnalyzerView(props) {
  var lang = props.lang;
  var onNavigate = props.onNavigate;
  var textState = useState("");
  var protocolText = textState[0];
  var setProtocolText = textState[1];
  var analysisState = useState(null);
  var analysis = analysisState[0];
  var setAnalysis = analysisState[1];
  var recommendationsState = useState([]);
  var recommendations = recommendationsState[0];
  var setRecommendations = recommendationsState[1];
  var loadingState = useState(false);
  var loading = loadingState[0];
  var setLoading = loadingState[1];
  var llmAnalysisState = useState(null);
  var llmAnalysis = llmAnalysisState[0];
  var setLlmAnalysis = llmAnalysisState[1];
  var llmLoadingState = useState(false);
  var llmLoading = llmLoadingState[0];
  var setLlmLoading = llmLoadingState[1];
  var llmErrorState = useState(null);
  var llmError = llmErrorState[0];
  var setLlmError = llmErrorState[1];

  // Exemple de protocole pour dÃ©mo
  var exampleProtocol = lang === "fr" ? "Le programme prÃ©voit une formation de 5 jours pour les mÃ©decins gÃ©nÃ©ralistes et les infirmiers des centres de santÃ© primaires. Cette formation sera suivie d'une supervision mensuelle par un psychiatre rÃ©fÃ©rent de la rÃ©gion. Un systÃ¨me de collecte de donnÃ©es sera mis en place pour suivre le nombre de consultations. Des brochures d'information seront distribuÃ©es aux patients. Le programme sera adaptÃ© au contexte local marocain et des champions locaux seront identifiÃ©s dans chaque centre pour porter le changement." : "The program includes a 5-day training course for general practitioners and nurses at primary health centers. This training will be followed by monthly supervision by a regional psychiatrist. A data collection system will be set up to track consultations. Patient information brochures will be distributed. The program will be adapted to the local Moroccan context and local champions will be identified in each center to drive change.";
  function handleAnalyze() {
    if (!protocolText.trim()) return;
    setLoading(true);

    // Simulation d'un dÃ©lai pour effet "analyse en cours"
    setTimeout(function () {
      var result = MoudarEngine.analyzeProtocol(protocolText, lang);
      setAnalysis(result);
      var recs = MoudarEngine.getProtocolRecommendations(result, lang);
      setRecommendations(recs);
      setLoading(false);
    }, 800);
  }
  function handleAnalyzeLLM() {
    if (!protocolText.trim()) return;
    if (!MOUDAR_API_BASE) {
      setLlmError(lang === "fr" ? "API Moudar non configurÃ©e (MOUDAR_API_BASE)." : "Moudar API not configured (MOUDAR_API_BASE).");
      return;
    }
    setLlmLoading(true);
    setLlmError(null);
    var payload = {
      text: protocolText,
      language: lang === "fr" ? "fr" : "en",
      options: {
        inferPhase: true,
        inferResourceLevel: true,
        maxBarriers: 10,
        maxStrategies: 15
      }
    };
    safeMoudarFetch("/llm_analyze", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": MOUDAR_API_KEY ? "Bearer " + MOUDAR_API_KEY : ""
      },
      body: JSON.stringify(payload)
    }).then(function (res) {
      if (!res.ok) {
        throw new Error("HTTP " + res.status);
      }
      return res.json();
    }).then(function (data) {
      setLlmAnalysis(data || null);
    }).catch(function (err) {
      console.error("Moudar /llm_analyze error", err);
      setLlmError((lang === "fr" ? "Erreur LLM : " : "LLM error: ") + err.message);
    }).finally(function () {
      setLlmLoading(false);
    });
  }
  function handleLoadExample() {
    setProtocolText(exampleProtocol);
    setAnalysis(null);
    setRecommendations([]);
  }
  function getScoreColor(score) {
    if (score >= 70) return "text-green-600 bg-green-100";
    if (score >= 40) return "text-yellow-600 bg-yellow-100";
    return "text-red-600 bg-red-100";
  }
  function getScoreBarColor(score) {
    if (score >= 70) return "bg-green-500";
    if (score >= 40) return "bg-yellow-500";
    return "bg-red-500";
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "max-w-6xl mx-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-4xl"
  }, "\uD83D\uDD2C"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-3xl font-bold text-gray-800"
  }, lang === "fr" ? "Analyseur de Protocole" : "Protocol Analyzer"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Ã‰valuez la complÃ©tude de votre protocole existant" : "Evaluate the Implementation Science completeness of your existing protocol"))), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 mt-4"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("projects");
    },
    className: "px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200"
  }, "\u2190 ", lang === "fr" ? "Mes projets" : "My projects"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("wizard");
    },
    className: "px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm hover:bg-blue-200"
  }, "\u2728 ", lang === "fr" ? "CrÃ©er un projet" : "Create a project"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-lg p-6 mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-4"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "font-bold text-lg text-gray-800"
  }, "\uD83D\uDCCB ", lang === "fr" ? "Collez votre protocole" : "Paste your protocol"), /*#__PURE__*/React.createElement("button", {
    onClick: handleLoadExample,
    className: "px-3 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-sm hover:bg-purple-200"
  }, "\uD83D\uDCDD ", lang === "fr" ? "Charger exemple" : "Load example")), /*#__PURE__*/React.createElement("textarea", {
    value: protocolText,
    onChange: function (e) {
      setProtocolText(e.target.value);
      setAnalysis(null);
    },
    placeholder: lang === "fr" ? "Collez ici le texte de votre protocole d'implÃ©mentation, description de projet, ou document de conception..." : "Paste here the text of your implementation protocol, project description, or design document...",
    className: "w-full h-48 p-4 border-2 border-gray-200 rounded-xl focus:border-blue-400 focus:outline-none resize-none text-gray-700"
  }), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mt-4"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-sm text-gray-500"
  }, protocolText.length, " ", lang === "fr" ? "caractÃ¨res" : "characters"), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: handleAnalyze,
    disabled: !protocolText.trim() || loading,
    className: "px-6 py-3 rounded-xl text-white shadow-md transition-all " + (protocolText.trim() && !loading ? "bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-700" : "bg-gray-300 cursor-not-allowed")
  }, loading ? /*#__PURE__*/React.createElement("span", null, "\u23F3 ", lang === "fr" ? "Analyse en cours..." : "Analyzing...") : /*#__PURE__*/React.createElement("span", null, "\uD83D\uDD0D ", lang === "fr" ? "Analyser le protocole" : "Analyze protocol")), /*#__PURE__*/React.createElement("button", {
    onClick: handleAnalyzeLLM,
    disabled: !protocolText.trim() || llmLoading,
    className: "px-6 py-3 rounded-xl text-white shadow-md transition-all flex items-center gap-2 " + (protocolText.trim() && !llmLoading ? "bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700" : "bg-gray-300 cursor-not-allowed")
  }, llmLoading ? /*#__PURE__*/React.createElement("span", null, "\uD83E\uDDE0 ", lang === "fr" ? "Analyse LLM..." : "LLM analyzing...") : /*#__PURE__*/React.createElement("span", null, "\uD83E\uDDE0 ", lang === "fr" ? "Analyse LLM (beta)" : "LLM analysis (beta)"))))), analysis && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-lg p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex flex-col md:flex-row md:items-center md:justify-between gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-24 h-24 rounded-2xl flex flex-col items-center justify-center " + getScoreColor(analysis.globalScore)
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-4xl font-bold"
  }, analysis.globalScore, "%"), /*#__PURE__*/React.createElement("span", {
    className: "text-xs"
  }, lang === "fr" ? "ComplÃ©tude" : "Completeness")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-xl text-gray-800 mb-1"
  }, lang === "fr" ? "Score de complÃ©tude" : "Implementation Science Completeness Score"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, analysis.totalDetected, " / ", analysis.totalStrategies, " ", lang === "fr" ? "stratÃ©gies ERIC dÃ©tectÃ©es" : "ERIC strategies detected"))), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-4 bg-gray-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl mb-1"
  }, analysis.globalScore >= 70 ? "ðŸŽ¯" : analysis.globalScore >= 40 ? "ðŸ“Š" : "âš ï¸"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, analysis.globalScore >= 70 ? lang === "fr" ? "Protocole bien structurÃ©" : "Well-structured protocol" : analysis.globalScore >= 40 ? lang === "fr" ? "Protocole partiel" : "Partial protocol" : lang === "fr" ? "Protocole Ã  renforcer" : "Protocol needs strengthening")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-lg p-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-lg text-gray-800 mb-4"
  }, "\uD83D\uDCCA ", lang === "fr" ? "Analyse par dimension" : "Analysis by dimension"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 lg:grid-cols-3 gap-4"
  }, Object.entries(analysis.categoryScores).map(function (entry) {
    var catId = entry[0];
    var cat = entry[1];
    return /*#__PURE__*/React.createElement("div", {
      key: catId,
      className: "bg-gray-50 rounded-xl p-4"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-center mb-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-gray-800"
    }, cat.label), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 rounded text-sm font-bold " + getScoreColor(cat.score)
    }, cat.score, "%")), /*#__PURE__*/React.createElement("div", {
      className: "w-full bg-gray-200 rounded-full h-2 mb-3"
    }, /*#__PURE__*/React.createElement("div", {
      className: "h-2 rounded-full transition-all " + getScoreBarColor(cat.score),
      style: {
        width: cat.score + "%"
      }
    })), /*#__PURE__*/React.createElement("div", {
      className: "space-y-1"
    }, cat.strategies.map(function (s) {
      return /*#__PURE__*/React.createElement("div", {
        key: s.id,
        className: "flex items-center gap-2 text-xs"
      }, /*#__PURE__*/React.createElement("span", {
        className: s.detected ? "text-green-600" : "text-gray-400"
      }, s.detected ? "âœ“" : "â—‹"), /*#__PURE__*/React.createElement("span", {
        className: s.detected ? "text-gray-800" : "text-gray-400"
      }, s.label), s.detected && s.keywords.length > 0 && /*#__PURE__*/React.createElement("span", {
        className: "text-blue-500 text-xs italic"
      }, "(", s.keywords.slice(0, 2).join(", "), ")"));
    })));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-lg p-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-lg text-gray-800 mb-4 flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "w-8 h-8 bg-green-100 text-green-600 rounded-lg flex items-center justify-center"
  }, "\u2713"), lang === "fr" ? "StratÃ©gies dÃ©tectÃ©es" : "Detected strategies", " (", analysis.totalDetected, ")"), Object.keys(analysis.detected).length > 0 ? /*#__PURE__*/React.createElement("div", {
    className: "space-y-2 max-h-80 overflow-y-auto"
  }, Object.entries(analysis.detected).map(function (entry) {
    var sid = entry[0];
    var data = entry[1];
    return /*#__PURE__*/React.createElement("div", {
      key: sid,
      className: "p-3 bg-green-50 rounded-lg border border-green-200"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-green-800"
    }, data.strategy.label[lang]), /*#__PURE__*/React.createElement("span", {
      className: "ml-2 text-xs text-green-600"
    }, "(", sid, ")")), /*#__PURE__*/React.createElement("span", {
      className: "text-xs bg-green-200 text-green-800 px-2 py-0.5 rounded"
    }, Math.round(data.confidence * 100), "%")), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-green-600 mt-1"
    }, lang === "fr" ? "Mots-clÃ©s:" : "Keywords:", " ", data.keywords.join(", ")));
  })) : /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500 text-center py-8"
  }, lang === "fr" ? "Aucune stratÃ©gie dÃ©tectÃ©e" : "No strategies detected")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-lg p-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-lg text-gray-800 mb-4 flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "w-8 h-8 bg-orange-100 text-orange-600 rounded-lg flex items-center justify-center"
  }, "!"), lang === "fr" ? "Ã€ ajouter (prioritaires)" : "To add (priority)", " (", analysis.missing.length, ")"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2 max-h-80 overflow-y-auto"
  }, analysis.missing.map(function (m, idx) {
    return /*#__PURE__*/React.createElement("div", {
      key: m.id,
      className: "p-3 bg-orange-50 rounded-lg border border-orange-200"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-start gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "w-6 h-6 bg-orange-200 text-orange-800 rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0"
    }, idx + 1), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-orange-800"
    }, m.label), /*#__PURE__*/React.createElement("span", {
      className: "ml-2 text-xs text-orange-600"
    }, "(", m.id, ")"), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-orange-700 mt-1"
    }, "\uD83D\uDCA1 ", MoudarEngine.analyzeProtocol.call ? "" : "", m.strategy ? function () {
      var rationales = {
        S01: {
          fr: "Renforce les compÃ©tences des professionnels",
          en: "Strengthens professional skills"
        },
        S02: {
          fr: "Permet de mesurer les progrÃ¨s et d'ajuster",
          en: "Enables progress measurement and adjustment"
        },
        S03: {
          fr: "Accompagne le changement sur le terrain",
          en: "Supports field-level change"
        },
        S04: {
          fr: "CrÃ©e des modÃ¨les locaux et motive les Ã©quipes",
          en: "Creates local role models and motivates teams"
        },
        S05: {
          fr: "RÃ©duit les oublis et standardise les pratiques",
          en: "Reduces oversights and standardizes practices"
        },
        S06: {
          fr: "Motive l'adoption par des incitations",
          en: "Motivates adoption through incentives"
        },
        S07: {
          fr: "Ancre le changement dans les politiques",
          en: "Anchors change in policies"
        },
        S08: {
          fr: "Implique la communautÃ© et rÃ©duit la stigmatisation",
          en: "Involves community and reduces stigma"
        },
        S09: {
          fr: "RÃ©sout les problÃ¨mes techniques rapidement",
          en: "Resolves technical issues quickly"
        },
        S10: {
          fr: "Assure la qualitÃ© et le soutien aux Ã©quipes",
          en: "Ensures quality and team support"
        },
        S11: {
          fr: "Adapte l'intervention au contexte local",
          en: "Adapts intervention to local context"
        },
        S12: {
          fr: "CrÃ©e des alliances durables",
          en: "Creates lasting alliances"
        },
        S13: {
          fr: "Permet le suivi et la prise de dÃ©cision basÃ©e sur les donnÃ©es",
          en: "Enables monitoring and data-driven decisions"
        },
        S14: {
          fr: "Favorise l'apprentissage collectif",
          en: "Promotes collective learning"
        },
        S15: {
          fr: "Apporte le soutien de personnes avec vÃ©cu similaire",
          en: "Provides support from people with similar experiences"
        },
        S16: {
          fr: "Institutionnalise l'amÃ©lioration continue",
          en: "Institutionalizes continuous improvement"
        },
        S17: {
          fr: "Coordonne et harmonise Ã  grande Ã©chelle",
          en: "Coordinates and harmonizes at scale"
        },
        S18: {
          fr: "AmÃ©liore l'adhÃ©sion des patients",
          en: "Improves patient adherence"
        },
        S19: {
          fr: "Optimise les ressources humaines disponibles",
          en: "Optimizes available human resources"
        },
        S20: {
          fr: "Assure l'appropriation par toutes les parties",
          en: "Ensures ownership by all parties"
        }
      };
      return rationales[m.id] ? rationales[m.id][lang] : "";
    }() : ""))));
  })))), recommendations.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl shadow-lg p-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-lg text-gray-800 mb-4 flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-2xl"
  }, "\uD83D\uDCA1"), lang === "fr" ? "Recommandations Moudar" : "Moudar Recommendations"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, recommendations.map(function (rec, idx) {
    return /*#__PURE__*/React.createElement("div", {
      key: idx,
      className: "bg-white rounded-xl p-4 border border-blue-200"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2 mb-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 rounded text-xs font-bold " + getScoreColor(rec.score)
    }, rec.score, "%"), /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-blue-900"
    }, rec.categoryLabel)), /*#__PURE__*/React.createElement("p", {
      className: "text-gray-700 text-sm mb-3"
    }, rec.message), /*#__PURE__*/React.createElement("div", {
      className: "space-y-2"
    }, rec.suggestions.map(function (sug) {
      return /*#__PURE__*/React.createElement("div", {
        key: sug.id,
        className: "flex items-start gap-2 p-2 bg-blue-50 rounded-lg"
      }, /*#__PURE__*/React.createElement("span", {
        className: "text-blue-500"
      }, "\u2192"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
        className: "font-medium text-blue-800"
      }, sug.label), /*#__PURE__*/React.createElement("p", {
        className: "text-xs text-blue-600"
      }, sug.rationale)));
    })));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-lg p-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-lg text-gray-800 mb-4"
  }, "\uD83D\uDE80 ", lang === "fr" ? "Prochaines Ã©tapes" : "Next steps"), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onNavigate("wizard");
    },
    className: "px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg hover:from-blue-700 hover:to-indigo-700 transition flex items-center gap-2"
  }, "\u2728 ", lang === "fr" ? "CrÃ©er un projet complet avec Moudar" : "Create a complete project with Moudar"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var report = "ANALYSE DE PROTOCOLE - MOUDAR v" + MoudarEngine.VERSION + "\n";
      report += "Date: " + new Date().toLocaleDateString() + "\n\n";
      report += "SCORE GLOBAL: " + analysis.globalScore + "%\n";
      report += "StratÃ©gies dÃ©tectÃ©es: " + analysis.totalDetected + "/" + analysis.totalStrategies + "\n\n";
      report += "DÃ‰TAIL PAR CATÃ‰GORIE:\n";
      Object.entries(analysis.categoryScores).forEach(function (e) {
        report += "- " + e[1].label + ": " + e[1].score + "%\n";
      });
      report += "\nSTRATÃ‰GIES MANQUANTES PRIORITAIRES:\n";
      analysis.missing.forEach(function (m, i) {
        report += i + 1 + ". " + m.label + " (" + m.id + ")\n";
      });
      var blob = new Blob([report], {
        type: 'text/plain'
      });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'moudar_analyse_protocole_' + new Date().toISOString().split('T')[0] + '.txt';
      a.click();
    },
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition flex items-center gap-2"
  }, "\uD83D\uDCE5 ", lang === "fr" ? "Exporter l'analyse" : "Export analysis")))), !analysis && /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-slate-50 to-blue-50 rounded-2xl p-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-lg text-gray-800 mb-4"
  }, "\u2139\uFE0F ", lang === "fr" ? "Comment Ã§a marche ?" : "How does it work?"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-4 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl mb-2"
  }, "\uD83D\uDCCB"), /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-gray-800 mb-1"
  }, lang === "fr" ? "1. Collez votre texte" : "1. Paste your text"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Protocole, description de projet, document Word..." : "Protocol, project description, Word document...")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-4 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl mb-2"
  }, "\uD83E\uDD16"), /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-gray-800 mb-1"
  }, lang === "fr" ? "2. Moudar analyse" : "2. Moudar analyzes"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "DÃ©tection des 20 stratÃ©gies ERIC via mots-clÃ©s" : "Detection of 20 ERIC strategies via keywords")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-4 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl mb-2"
  }, "\uD83D\uDCA1"), /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-gray-800 mb-1"
  }, lang === "fr" ? "3. Recommandations" : "3. Recommendations"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "StratÃ©gies manquantes Ã  ajouter prioritairement" : "Missing strategies to add as priority"))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-blue-100 rounded-xl"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-blue-800"
  }, /*#__PURE__*/React.createElement("strong", null, "\uD83D\uDCA1 ", lang === "fr" ? "Astuce" : "Tip", ":"), " ", lang === "fr" ? "Cliquez sur \"Charger exemple\" pour voir une analyse type sur un protocole de formation mhGAP." : "Click \"Load example\" to see a sample analysis on an mhGAP training protocol."))));
}

// ============================================
// THEORY OF CHANGE - Diagramme visuel
// ============================================
function TheoryOfChangeView(props) {
  var project = props.project;
  var protocol = props.protocol;
  var lang = props.lang;
  var onClose = props.onClose;
  if (!project || !protocol) return null;

  // Extraire les donnÃ©es du projet
  var problem = project.context ? project.context.substring(0, 150) + "..." : lang === "fr" ? "ProblÃ¨me non dÃ©fini" : "Problem not defined";
  var barriers = project.barriers ? project.barriers.split(/[,;\n]/).slice(0, 4).map(function (b) {
    return b.trim();
  }) : [];
  var strategies = protocol.aiRawRecommendations ? protocol.aiRawRecommendations.strategies.top.slice(0, 4) : [];
  var outcomes = protocol.outcomes ? protocol.outcomes.slice(0, 4) : ["Adoption", "FidÃ©litÃ©", "PÃ©rennitÃ©"];
  var domainInfo = DOMAINS[project.domain] || {};
  var phaseInfo = PHASES[project.phase] || {};
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDD17 ", lang === "fr" ? "ThÃ©orie du Changement" : "Theory of Change"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, project.title)), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3 flex-wrap"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm"
  }, domainInfo.icon, " ", tObj(domainInfo, lang)), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm"
  }, phaseInfo.icon, " ", tObj(phaseInfo, lang)), project.resourceLevel && /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm"
  }, "\uD83D\uDCB0 ", project.resourceLevel))), /*#__PURE__*/React.createElement("div", {
    className: "relative"
  }, /*#__PURE__*/React.createElement("svg", {
    className: "absolute inset-0 w-full h-full pointer-events-none",
    style: {
      zIndex: 0
    }
  }, /*#__PURE__*/React.createElement("defs", null, /*#__PURE__*/React.createElement("marker", {
    id: "arrowhead",
    markerWidth: "10",
    markerHeight: "7",
    refX: "9",
    refY: "3.5",
    orient: "auto"
  }, /*#__PURE__*/React.createElement("polygon", {
    points: "0 0, 10 3.5, 0 7",
    fill: "#94a3b8"
  })))), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-1 md:grid-cols-4 gap-4 relative",
    style: {
      zIndex: 1
    }
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-red-500 to-orange-500 rounded-xl p-4 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 mb-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center"
  }, "\uD83C\uDFAF"), /*#__PURE__*/React.createElement("h3", {
    className: "font-bold"
  }, lang === "fr" ? "ProblÃ¨me" : "Problem")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-white/90 leading-relaxed"
  }, problem), /*#__PURE__*/React.createElement("div", {
    className: "mt-3 text-right text-2xl"
  }, "\u2192")), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-amber-500 to-yellow-500 rounded-xl p-4 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 mb-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center"
  }, "\uD83D\uDEA7"), /*#__PURE__*/React.createElement("h3", {
    className: "font-bold"
  }, lang === "fr" ? "BarriÃ¨res" : "Barriers")), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-2"
  }, barriers.length > 0 ? barriers.map(function (b, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i,
      className: "text-sm bg-white/20 rounded px-2 py-1"
    }, "\u2022 ", b);
  }) : /*#__PURE__*/React.createElement("li", {
    className: "text-sm italic"
  }, lang === "fr" ? "Non spÃ©cifiÃ©es" : "Not specified")), /*#__PURE__*/React.createElement("div", {
    className: "mt-3 text-right text-2xl"
  }, "\u2192")), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-blue-500 to-indigo-500 rounded-xl p-4 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 mb-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center"
  }, "\u26A1"), /*#__PURE__*/React.createElement("h3", {
    className: "font-bold"
  }, lang === "fr" ? "StratÃ©gies" : "Strategies")), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-2"
  }, strategies.map(function (s, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i,
      className: "text-sm bg-white/20 rounded px-2 py-1 flex items-center gap-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xs opacity-70"
    }, s.id), " ", s.label ? s.label[lang] : s.label);
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-3 text-right text-2xl"
  }, "\u2192")), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-green-500 to-emerald-500 rounded-xl p-4 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 mb-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center"
  }, "\uD83C\uDFAF"), /*#__PURE__*/React.createElement("h3", {
    className: "font-bold"
  }, lang === "fr" ? "RÃ©sultats attendus" : "Expected Outcomes")), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-2"
  }, outcomes.map(function (o, i) {
    var outcomeLabel = typeof o === "string" ? o : o.label ? o.label[lang] : o;
    return /*#__PURE__*/React.createElement("li", {
      key: i,
      className: "text-sm bg-white/20 rounded px-2 py-1"
    }, "\u2713 ", outcomeLabel);
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-3 text-right text-2xl"
  }, "\uD83C\uDFC6")))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-gray-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-gray-700 mb-2"
  }, lang === "fr" ? "ðŸ’¡ Lecture du diagramme" : "ðŸ’¡ How to read this diagram"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Ce diagramme montre la logique causale de votre projet : le problÃ¨me identifiÃ© gÃ©nÃ¨re des barriÃ¨res, que les stratÃ©gies sÃ©lectionnÃ©es visent Ã  surmonter, pour atteindre les rÃ©sultats attendus." : "This diagram shows the causal logic of your project: the identified problem creates barriers, which the selected strategies aim to overcome, to achieve the expected outcomes.")), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 p-4 bg-amber-50 rounded-xl border border-amber-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-amber-800 mb-2"
  }, "\u26A0\uFE0F ", lang === "fr" ? "HypothÃ¨ses critiques" : "Critical Assumptions"), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-amber-700 space-y-1"
  }, /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Les ressources humaines et financiÃ¨res sont disponibles" : "Human and financial resources are available"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Le contexte politique reste stable" : "Political context remains stable"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Les parties prenantes maintiennent leur engagement" : "Stakeholders maintain their commitment")))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// SCENARIO COMPARATOR - Comparaison de scÃ©narios
// ============================================
function ScenarioComparatorView(props) {
  var project = props.project;
  var lang = props.lang;
  var onClose = props.onClose;
  var onSelectScenario = props.onSelectScenario;
  if (!project) return null;

  // DÃ©finir les 3 scÃ©narios types
  var scenarios = [{
    id: "equity",
    name: {
      fr: "ðŸŽ¯ Ã‰quitÃ© maximale",
      en: "ðŸŽ¯ Maximum Equity"
    },
    objectives: ["equity", "sustainability"],
    description: {
      fr: "Priorise l'accÃ¨s Ã©quitable et la pÃ©rennitÃ©. IdÃ©al pour les contextes LMIC et les programmes de santÃ© publique.",
      en: "Prioritizes equitable access and sustainability. Ideal for LMIC contexts and public health programs."
    },
    color: "from-purple-500 to-indigo-600",
    icon: "âš–ï¸"
  }, {
    id: "budget",
    name: {
      fr: "ðŸ’° Budget optimisÃ©",
      en: "ðŸ’° Optimized Budget"
    },
    objectives: ["cost_effectiveness", "speed"],
    description: {
      fr: "Minimise les coÃ»ts tout en maximisant l'impact. AdaptÃ© aux ressources limitÃ©es et aux dÃ©ploiements rapides.",
      en: "Minimizes costs while maximizing impact. Suited for limited resources and rapid deployments."
    },
    color: "from-green-500 to-emerald-600",
    icon: "ðŸ“Š"
  }, {
    id: "evidence",
    name: {
      fr: "ðŸ“š Evidence-based",
      en: "ðŸ“š Evidence-based"
    },
    objectives: ["evidence_based", "sustainability"],
    description: {
      fr: "S'appuie sur les preuves scientifiques les plus solides. RecommandÃ© pour les projets de recherche et les CHU.",
      en: "Relies on the strongest scientific evidence. Recommended for research projects and university hospitals."
    },
    color: "from-blue-500 to-cyan-600",
    icon: "ðŸ”¬"
  }];

  // GÃ©nÃ©rer les recommandations pour chaque scÃ©nario
  var scenarioResults = scenarios.map(function (scenario) {
    var baseStrategies = MoudarEngine.scoreStrategies(project);
    var adjustedStrategies = MoudarEngine.applyObjectives(baseStrategies, scenario.objectives, project.resourceLevel || null);
    var topStrategies = adjustedStrategies.slice(0, 5);

    // Calculer les mÃ©triques
    var avgCost = topStrategies.reduce(function (sum, s) {
      var costMap = {
        low: 1,
        medium: 2,
        high: 3,
        variable: 2
      };
      return sum + (costMap[s.cost] || 2);
    }, 0) / topStrategies.length;
    var avgComplexity = topStrategies.reduce(function (sum, s) {
      var compMap = {
        low: 1,
        medium: 2,
        high: 3
      };
      return sum + (compMap[s.complexity] || 2);
    }, 0) / topStrategies.length;
    var totalScore = topStrategies.reduce(function (sum, s) {
      return sum + s.score;
    }, 0);

    // Calculer l'impact Ã©quitÃ© (basÃ© sur stratÃ©gies community/stakeholder)
    var equityStrategies = ["S08", "S18", "S19", "S20", "S12"];
    var equityCount = topStrategies.filter(function (s) {
      return equityStrategies.includes(s.id);
    }).length;
    var equityScore = equityCount >= 3 ? "high" : equityCount >= 1 ? "medium" : "low";

    // Calculer durÃ©e estimÃ©e
    var durationMonths = avgComplexity <= 1.5 ? 6 : avgComplexity <= 2.2 ? 12 : 18;
    return {
      scenario: scenario,
      strategies: topStrategies,
      metrics: {
        cost: avgCost,
        complexity: avgComplexity,
        score: totalScore,
        costLabel: avgCost <= 1.5 ? "$" : avgCost <= 2.2 ? "$$" : "$$$",
        costLevel: avgCost <= 1.5 ? "low" : avgCost <= 2.2 ? "medium" : "high",
        complexityLabel: avgComplexity <= 1.5 ? lang === "fr" ? "Simple" : "Simple" : avgComplexity <= 2.2 ? lang === "fr" ? "ModÃ©rÃ©e" : "Moderate" : lang === "fr" ? "Complexe" : "Complex",
        complexityLevel: avgComplexity <= 1.5 ? "low" : avgComplexity <= 2.2 ? "medium" : "high",
        equityScore: equityScore,
        equityLabel: equityScore === "high" ? lang === "fr" ? "Fort" : "High" : equityScore === "medium" ? lang === "fr" ? "Moyen" : "Medium" : lang === "fr" ? "Faible" : "Low",
        duration: durationMonths,
        durationLabel: durationMonths + " " + (lang === "fr" ? "mois" : "months")
      }
    };
  });

  // Fonction pour obtenir la couleur selon le niveau
  function getLevelColor(level, inverted) {
    if (inverted) {
      return level === "low" ? "text-green-600 bg-green-100" : level === "medium" ? "text-yellow-600 bg-yellow-100" : "text-red-600 bg-red-100";
    }
    return level === "high" ? "text-green-600 bg-green-100" : level === "medium" ? "text-yellow-600 bg-yellow-100" : "text-red-600 bg-red-100";
  }
  function getLevelIcon(level, type) {
    if (type === "equity") {
      return level === "high" ? "ðŸŒðŸŒðŸŒ" : level === "medium" ? "ðŸŒðŸŒ" : "ðŸŒ";
    }
    if (type === "cost") {
      return level === "low" ? "ðŸ’¸" : level === "medium" ? "ðŸ’¸ðŸ’¸" : "ðŸ’¸ðŸ’¸ðŸ’¸";
    }
    if (type === "complexity") {
      return level === "low" ? "âš™ï¸" : level === "medium" ? "âš™ï¸âš™ï¸" : "âš™ï¸âš™ï¸âš™ï¸";
    }
    return "";
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-7xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\u2696\uFE0F ", lang === "fr" ? "Studio de ScÃ©narios d'ImplÃ©mentation" : "Implementation Scenarios Studio"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "3 trajectoires possibles â€” Choisissez le compromis qui vous convient" : "3 possible trajectories â€” Choose the trade-off that suits you")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl border"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-gray-700 mb-3"
  }, lang === "fr" ? "ðŸ“Š Comparaison rapide" : "ðŸ“Š Quick Comparison"), /*#__PURE__*/React.createElement("div", {
    className: "overflow-x-auto"
  }, /*#__PURE__*/React.createElement("table", {
    className: "w-full text-sm"
  }, /*#__PURE__*/React.createElement("thead", null, /*#__PURE__*/React.createElement("tr", {
    className: "border-b"
  }, /*#__PURE__*/React.createElement("th", {
    className: "py-2 text-left text-gray-500"
  }, lang === "fr" ? "CritÃ¨re" : "Criteria"), scenarioResults.map(function (r) {
    return /*#__PURE__*/React.createElement("th", {
      key: r.scenario.id,
      className: "py-2 text-center font-medium"
    }, r.scenario.icon, " ", r.scenario.name[lang].split(" ")[1]);
  }))), /*#__PURE__*/React.createElement("tbody", null, /*#__PURE__*/React.createElement("tr", {
    className: "border-b"
  }, /*#__PURE__*/React.createElement("td", {
    className: "py-2 text-gray-600"
  }, "\uD83C\uDF0D ", lang === "fr" ? "Impact Ã©quitÃ©" : "Equity impact"), scenarioResults.map(function (r) {
    return /*#__PURE__*/React.createElement("td", {
      key: r.scenario.id,
      className: "py-2 text-center"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 rounded text-xs font-medium " + getLevelColor(r.metrics.equityScore, false)
    }, getLevelIcon(r.metrics.equityScore, "equity"), " ", r.metrics.equityLabel));
  })), /*#__PURE__*/React.createElement("tr", {
    className: "border-b"
  }, /*#__PURE__*/React.createElement("td", {
    className: "py-2 text-gray-600"
  }, "\uD83D\uDCB8 ", lang === "fr" ? "Niveau de coÃ»ts" : "Cost level"), scenarioResults.map(function (r) {
    return /*#__PURE__*/React.createElement("td", {
      key: r.scenario.id,
      className: "py-2 text-center"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 rounded text-xs font-medium " + getLevelColor(r.metrics.costLevel, true)
    }, getLevelIcon(r.metrics.costLevel, "cost"), " ", r.metrics.costLabel));
  })), /*#__PURE__*/React.createElement("tr", {
    className: "border-b"
  }, /*#__PURE__*/React.createElement("td", {
    className: "py-2 text-gray-600"
  }, "\u2699\uFE0F ", lang === "fr" ? "ComplexitÃ©" : "Complexity"), scenarioResults.map(function (r) {
    return /*#__PURE__*/React.createElement("td", {
      key: r.scenario.id,
      className: "py-2 text-center"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 rounded text-xs font-medium " + getLevelColor(r.metrics.complexityLevel, true)
    }, getLevelIcon(r.metrics.complexityLevel, "complexity"), " ", r.metrics.complexityLabel));
  })), /*#__PURE__*/React.createElement("tr", null, /*#__PURE__*/React.createElement("td", {
    className: "py-2 text-gray-600"
  }, "\u23F1\uFE0F ", lang === "fr" ? "DurÃ©e estimÃ©e" : "Estimated duration"), scenarioResults.map(function (r) {
    return /*#__PURE__*/React.createElement("td", {
      key: r.scenario.id,
      className: "py-2 text-center"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium"
    }, r.metrics.durationLabel));
  })))))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-6"
  }, scenarioResults.map(function (result, idx) {
    return /*#__PURE__*/React.createElement("div", {
      key: result.scenario.id,
      className: "bg-white rounded-xl border-2 border-gray-200 hover:border-blue-400 transition overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "bg-gradient-to-r " + result.scenario.color + " p-4 text-white"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2 mb-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-2xl"
    }, result.scenario.icon), /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-lg"
    }, result.scenario.name[lang])), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-white/90"
    }, result.scenario.description[lang])), /*#__PURE__*/React.createElement("div", {
      className: "p-3 bg-gray-50 border-b"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-around text-center"
    }, /*#__PURE__*/React.createElement("div", {
      title: lang === "fr" ? "Impact Ã©quitÃ©" : "Equity impact"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-lg"
    }, getLevelIcon(result.metrics.equityScore, "equity")), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, lang === "fr" ? "Ã‰quitÃ©" : "Equity")), /*#__PURE__*/React.createElement("div", {
      title: lang === "fr" ? "Niveau coÃ»ts" : "Cost level"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-lg"
    }, getLevelIcon(result.metrics.costLevel, "cost")), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, lang === "fr" ? "CoÃ»ts" : "Costs")), /*#__PURE__*/React.createElement("div", {
      title: lang === "fr" ? "ComplexitÃ©" : "Complexity"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-lg"
    }, getLevelIcon(result.metrics.complexityLevel, "complexity")), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, lang === "fr" ? "ComplexitÃ©" : "Complexity")), /*#__PURE__*/React.createElement("div", {
      title: lang === "fr" ? "DurÃ©e" : "Duration"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-lg font-bold text-blue-600"
    }, result.metrics.duration, "m"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, lang === "fr" ? "DurÃ©e" : "Duration")))), /*#__PURE__*/React.createElement("div", {
      className: "p-4"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-medium text-gray-700 mb-3 text-sm"
    }, lang === "fr" ? "StratÃ©gies recommandÃ©es" : "Recommended strategies"), /*#__PURE__*/React.createElement("ul", {
      className: "space-y-2"
    }, result.strategies.map(function (s, i) {
      var costColor = s.cost === "low" ? "bg-green-100 text-green-700" : s.cost === "medium" ? "bg-yellow-100 text-yellow-700" : "bg-red-100 text-red-700";
      return /*#__PURE__*/React.createElement("li", {
        key: s.id,
        className: "flex items-center gap-2 text-sm"
      }, /*#__PURE__*/React.createElement("span", {
        className: "w-5 h-5 bg-blue-100 text-blue-700 rounded flex items-center justify-center text-xs font-bold"
      }, i + 1), /*#__PURE__*/React.createElement("span", {
        className: "flex-1"
      }, s.label[lang]), /*#__PURE__*/React.createElement("span", {
        className: "px-1.5 py-0.5 rounded text-xs " + costColor
      }, s.cost === "low" ? "$" : s.cost === "medium" ? "$$" : "$$$"));
    }))), /*#__PURE__*/React.createElement("div", {
      className: "p-4 border-t"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        onSelectScenario(result);
      },
      className: "w-full py-2 rounded-lg font-medium text-white bg-gradient-to-r " + result.scenario.color + " hover:opacity-90 transition"
    }, lang === "fr" ? "Choisir ce scÃ©nario" : "Choose this scenario")));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-blue-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-blue-800 mb-2"
  }, "\uD83D\uDCA1 ", lang === "fr" ? "Comment choisir ?" : "How to choose?"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4 text-sm text-blue-700"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("strong", null, "\u2696\uFE0F ", lang === "fr" ? "Ã‰quitÃ©" : "Equity", ":"), " ", lang === "fr" ? "Pour les programmes visant les populations vulnÃ©rables ou en contexte LMIC" : "For programs targeting vulnerable populations or LMIC contexts"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("strong", null, "\uD83D\uDCB0 ", lang === "fr" ? "Budget" : "Budget", ":"), " ", lang === "fr" ? "Quand les ressources sont limitÃ©es et le dÃ©lai court" : "When resources are limited and timeline is short"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("strong", null, "\uD83D\uDCDA ", lang === "fr" ? "Evidence" : "Evidence", ":"), " ", lang === "fr" ? "Pour les projets de recherche ou les contextes Ã  haute exigence scientifique" : "For research projects or contexts with high scientific requirements")))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// KPI PANEL - Indicateurs par stratÃ©gie
// ============================================
function KPIPanelView(props) {
  var strategies = props.strategies;
  var lang = props.lang;
  var onClose = props.onClose;
  if (!strategies || strategies.length === 0) return null;

  // RÃ©cupÃ©rer les KPIs des stratÃ©gies
  var kg = MoudarEngine.getKnowledgeGraph();
  var strategiesWithKPIs = strategies.map(function (s) {
    var fullStrategy = kg.nodes.strategies[s.id];
    return {
      id: s.id,
      label: s.label,
      score: s.score,
      kpis: fullStrategy && fullStrategy.kpis ? fullStrategy.kpis : []
    };
  }).filter(function (s) {
    return s.kpis.length > 0;
  });
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDCCA ", lang === "fr" ? "Indicateurs de Suivi (KPIs)" : "Key Performance Indicators (KPIs)"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Mesurez l'implÃ©mentation de chaque stratÃ©gie" : "Measure the implementation of each strategy")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, strategiesWithKPIs.length === 0 ? /*#__PURE__*/React.createElement("p", {
    className: "text-center text-gray-500 py-8"
  }, lang === "fr" ? "Aucun indicateur disponible" : "No indicators available") : /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, strategiesWithKPIs.map(function (strategy) {
    return /*#__PURE__*/React.createElement("div", {
      key: strategy.id,
      className: "bg-white rounded-xl border border-gray-200 overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "bg-gradient-to-r from-blue-500 to-indigo-500 px-4 py-3 text-white flex items-center justify-between"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center text-sm font-bold"
    }, strategy.id), /*#__PURE__*/React.createElement("span", {
      className: "font-medium"
    }, strategy.label[lang])), /*#__PURE__*/React.createElement("span", {
      className: "text-sm bg-white/20 px-2 py-1 rounded"
    }, "Score: ", (strategy.score * 100).toFixed(0), "%")), /*#__PURE__*/React.createElement("div", {
      className: "overflow-x-auto"
    }, /*#__PURE__*/React.createElement("table", {
      className: "w-full text-sm"
    }, /*#__PURE__*/React.createElement("thead", {
      className: "bg-gray-50"
    }, /*#__PURE__*/React.createElement("tr", null, /*#__PURE__*/React.createElement("th", {
      className: "px-4 py-2 text-left text-gray-600 font-medium"
    }, lang === "fr" ? "Indicateur" : "Indicator"), /*#__PURE__*/React.createElement("th", {
      className: "px-4 py-2 text-center text-gray-600 font-medium"
    }, lang === "fr" ? "Cible" : "Target"), /*#__PURE__*/React.createElement("th", {
      className: "px-4 py-2 text-center text-gray-600 font-medium"
    }, lang === "fr" ? "FrÃ©quence" : "Frequency"), /*#__PURE__*/React.createElement("th", {
      className: "px-4 py-2 text-left text-gray-600 font-medium"
    }, lang === "fr" ? "Source" : "Source"))), /*#__PURE__*/React.createElement("tbody", null, strategy.kpis.map(function (kpi, idx) {
      return /*#__PURE__*/React.createElement("tr", {
        key: kpi.id,
        className: idx % 2 === 0 ? "bg-white" : "bg-gray-50"
      }, /*#__PURE__*/React.createElement("td", {
        className: "px-4 py-3 font-medium text-gray-800"
      }, kpi.indicator[lang]), /*#__PURE__*/React.createElement("td", {
        className: "px-4 py-3 text-center"
      }, /*#__PURE__*/React.createElement("span", {
        className: "px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-medium"
      }, kpi.target)), /*#__PURE__*/React.createElement("td", {
        className: "px-4 py-3 text-center text-gray-600"
      }, kpi.frequency[lang]), /*#__PURE__*/React.createElement("td", {
        className: "px-4 py-3 text-gray-500 text-xs"
      }, kpi.source[lang]));
    })))));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-amber-50 rounded-xl border border-amber-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-amber-800 mb-2"
  }, "\uD83D\uDCA1 ", lang === "fr" ? "Conseils de suivi" : "Monitoring Tips"), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-amber-700 space-y-1"
  }, /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "IntÃ©grez ces indicateurs dans votre tableau de bord projet" : "Integrate these indicators into your project dashboard"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Collectez les donnÃ©es dÃ¨s le dÃ©marrage pour avoir une baseline" : "Collect data from the start to establish a baseline"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Partagez les rÃ©sultats avec les Ã©quipes pour maintenir la motivation" : "Share results with teams to maintain motivation")))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-between gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var csvLines = [lang === "fr" ? "StratÃ©gie;Indicateur;Cible;FrÃ©quence;Source" : "Strategy;Indicator;Target;Frequency;Source"];
      strategiesWithKPIs.forEach(function (s) {
        s.kpis.forEach(function (kpi) {
          csvLines.push([s.label[lang], kpi.indicator[lang], kpi.target, kpi.frequency[lang], kpi.source[lang]].join(";"));
        });
      });
      var blob = new Blob([csvLines.join("\n")], {
        type: "text/csv"
      });
      var url = URL.createObjectURL(blob);
      var a = document.createElement("a");
      a.href = url;
      a.download = "moudar_kpis_" + new Date().toISOString().split("T")[0] + ".csv";
      a.click();
    },
    className: "px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 flex items-center gap-2"
  }, "\uD83D\uDCE5 ", lang === "fr" ? "Exporter CSV" : "Export CSV"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// STAKEHOLDER MAP MODAL - Cartographie parties prenantes (Modal)
// ============================================
function StakeholderMapModal(props) {
  var project = props.project;
  var protocol = props.protocol;
  var lang = props.lang;
  var onClose = props.onClose;
  var onSave = props.onSave;
  var stakeholdersState = useState(project.stakeholders || []);
  var stakeholders = stakeholdersState[0];
  var setStakeholders = stakeholdersState[1];
  var newStakeholderState = useState({
    name: "",
    role: "",
    influence: "medium",
    position: "neutral"
  });
  var newStakeholder = newStakeholderState[0];
  var setNewStakeholder = newStakeholderState[1];

  // Ajouter un stakeholder
  function addStakeholder() {
    if (!newStakeholder.name.trim()) return;
    var updated = stakeholders.concat([Object.assign({}, newStakeholder, {
      id: Date.now()
    })]);
    setStakeholders(updated);
    setNewStakeholder({
      name: "",
      role: "",
      influence: "medium",
      position: "neutral"
    });
  }

  // Supprimer un stakeholder
  function removeStakeholder(id) {
    setStakeholders(stakeholders.filter(function (s) {
      return s.id !== id;
    }));
  }

  // GÃ©nÃ©rer le plan d'engagement
  function generateEngagementPlan() {
    var plan = [];

    // Trier par prioritÃ© d'engagement
    var sorted = stakeholders.slice().sort(function (a, b) {
      var scoreA = (a.influence === "high" ? 3 : a.influence === "medium" ? 2 : 1) * (a.position === "opposed" ? 3 : a.position === "neutral" ? 2 : 1);
      var scoreB = (b.influence === "high" ? 3 : b.influence === "medium" ? 2 : 1) * (b.position === "opposed" ? 3 : b.position === "neutral" ? 2 : 1);
      return scoreB - scoreA;
    });
    sorted.forEach(function (s) {
      var action = {};
      action.stakeholder = s.name;
      action.role = s.role;

      // DÃ©terminer l'action basÃ©e sur influence Ã— position
      if (s.influence === "high" && s.position === "opposed") {
        action.priority = lang === "fr" ? "ðŸ”´ Critique" : "ðŸ”´ Critical";
        action.action = lang === "fr" ? "RÃ©union bilatÃ©rale urgente" : "Urgent bilateral meeting";
        action.strategy = "S20, S12";
        action.detail = lang === "fr" ? "Comprendre les rÃ©sistances, nÃ©gocier, chercher un terrain d'entente" : "Understand resistance, negotiate, find common ground";
      } else if (s.influence === "high" && s.position === "neutral") {
        action.priority = lang === "fr" ? "ðŸŸ  Haute" : "ðŸŸ  High";
        action.action = lang === "fr" ? "PrÃ©sentation du projet + invitation Ã  devenir champion" : "Project presentation + invitation to become champion";
        action.strategy = "S04, S20";
        action.detail = lang === "fr" ? "Transformer en alliÃ© actif, proposer un rÃ´le visible" : "Transform into active ally, offer visible role";
      } else if (s.influence === "high" && s.position === "favorable") {
        action.priority = lang === "fr" ? "ðŸŸ¢ Maintien" : "ðŸŸ¢ Maintain";
        action.action = lang === "fr" ? "Formaliser comme champion, intÃ©grer dans coalition" : "Formalize as champion, integrate into coalition";
        action.strategy = "S04, S12";
        action.detail = lang === "fr" ? "Capitaliser sur le soutien, donner de la visibilitÃ©" : "Capitalize on support, provide visibility";
      } else if (s.influence === "medium" && s.position === "opposed") {
        action.priority = lang === "fr" ? "ðŸŸ  Haute" : "ðŸŸ  High";
        action.action = lang === "fr" ? "Communication ciblÃ©e, Ã©coute des prÃ©occupations" : "Targeted communication, listen to concerns";
        action.strategy = "S08, S18";
        action.detail = lang === "fr" ? "RÃ©duire l'opposition par l'information et le dialogue" : "Reduce opposition through information and dialogue";
      } else if (s.influence === "medium") {
        action.priority = lang === "fr" ? "ðŸŸ¡ Moyenne" : "ðŸŸ¡ Medium";
        action.action = lang === "fr" ? "Information rÃ©guliÃ¨re, invitation aux Ã©vÃ©nements" : "Regular information, event invitations";
        action.strategy = "S08, S14";
        action.detail = lang === "fr" ? "Maintenir informÃ© et engagÃ©" : "Keep informed and engaged";
      } else {
        action.priority = lang === "fr" ? "âšª Standard" : "âšª Standard";
        action.action = lang === "fr" ? "Communication de masse, newsletters" : "Mass communication, newsletters";
        action.strategy = "S18";
        action.detail = lang === "fr" ? "Informer sans surcharger" : "Inform without overloading";
      }
      plan.push(action);
    });
    return plan;
  }
  var engagementPlan = generateEngagementPlan();

  // Position sur la matrice
  function getMatrixPosition(s) {
    var influenceMap = {
      high: 0,
      medium: 1,
      low: 2
    };
    var positionMap = {
      opposed: 0,
      neutral: 1,
      favorable: 2
    };
    return {
      row: influenceMap[s.influence],
      col: positionMap[s.position]
    };
  }

  // Grouper les stakeholders par cellule de la matrice
  var matrix = [[[], [], []],
  // high influence
  [[], [], []],
  // medium influence
  [[], [], []] // low influence
  ];
  stakeholders.forEach(function (s) {
    var pos = getMatrixPosition(s);
    matrix[pos.row][pos.col].push(s);
  });
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDC65 ", lang === "fr" ? "Cartographie des Parties Prenantes" : "Stakeholder Mapping"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Identifiez les acteurs clÃ©s et gÃ©nÃ©rez un plan d'engagement" : "Identify key actors and generate engagement plan")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-medium text-blue-800 mb-3"
  }, lang === "fr" ? "âž• Ajouter une partie prenante" : "âž• Add stakeholder"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-5 gap-3"
  }, /*#__PURE__*/React.createElement("input", {
    type: "text",
    placeholder: lang === "fr" ? "Nom / Groupe" : "Name / Group",
    value: newStakeholder.name,
    onChange: function (e) {
      setNewStakeholder(Object.assign({}, newStakeholder, {
        name: e.target.value
      }));
    },
    className: "px-3 py-2 border rounded-lg focus:border-blue-500 focus:outline-none"
  }), /*#__PURE__*/React.createElement("input", {
    type: "text",
    placeholder: lang === "fr" ? "RÃ´le" : "Role",
    value: newStakeholder.role,
    onChange: function (e) {
      setNewStakeholder(Object.assign({}, newStakeholder, {
        role: e.target.value
      }));
    },
    className: "px-3 py-2 border rounded-lg focus:border-blue-500 focus:outline-none"
  }), /*#__PURE__*/React.createElement("select", {
    value: newStakeholder.influence,
    onChange: function (e) {
      setNewStakeholder(Object.assign({}, newStakeholder, {
        influence: e.target.value
      }));
    },
    className: "px-3 py-2 border rounded-lg focus:border-blue-500 focus:outline-none"
  }, /*#__PURE__*/React.createElement("option", {
    value: "high"
  }, lang === "fr" ? "ðŸ”º Influence forte" : "ðŸ”º High influence"), /*#__PURE__*/React.createElement("option", {
    value: "medium"
  }, lang === "fr" ? "ðŸ”¸ Influence moyenne" : "ðŸ”¸ Medium influence"), /*#__PURE__*/React.createElement("option", {
    value: "low"
  }, lang === "fr" ? "ðŸ”» Influence faible" : "ðŸ”» Low influence")), /*#__PURE__*/React.createElement("select", {
    value: newStakeholder.position,
    onChange: function (e) {
      setNewStakeholder(Object.assign({}, newStakeholder, {
        position: e.target.value
      }));
    },
    className: "px-3 py-2 border rounded-lg focus:border-blue-500 focus:outline-none"
  }, /*#__PURE__*/React.createElement("option", {
    value: "opposed"
  }, lang === "fr" ? "âŒ OpposÃ©" : "âŒ Opposed"), /*#__PURE__*/React.createElement("option", {
    value: "neutral"
  }, lang === "fr" ? "âž– Neutre" : "âž– Neutral"), /*#__PURE__*/React.createElement("option", {
    value: "favorable"
  }, lang === "fr" ? "âœ… Favorable" : "âœ… Favorable")), /*#__PURE__*/React.createElement("button", {
    onClick: addStakeholder,
    className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
  }, lang === "fr" ? "Ajouter" : "Add"))), stakeholders.length > 0 && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-medium text-gray-800 mb-3"
  }, "\uD83D\uDCCA ", lang === "fr" ? "Matrice Influence Ã— Position" : "Influence Ã— Position Matrix"), /*#__PURE__*/React.createElement("div", {
    className: "overflow-x-auto"
  }, /*#__PURE__*/React.createElement("table", {
    className: "w-full border-collapse"
  }, /*#__PURE__*/React.createElement("thead", null, /*#__PURE__*/React.createElement("tr", null, /*#__PURE__*/React.createElement("th", {
    className: "p-2 border bg-gray-100"
  }), /*#__PURE__*/React.createElement("th", {
    className: "p-2 border bg-red-100 text-red-800"
  }, "\u274C ", lang === "fr" ? "OpposÃ©" : "Opposed"), /*#__PURE__*/React.createElement("th", {
    className: "p-2 border bg-yellow-100 text-yellow-800"
  }, "\u2796 ", lang === "fr" ? "Neutre" : "Neutral"), /*#__PURE__*/React.createElement("th", {
    className: "p-2 border bg-green-100 text-green-800"
  }, "\u2705 ", lang === "fr" ? "Favorable" : "Favorable"))), /*#__PURE__*/React.createElement("tbody", null, /*#__PURE__*/React.createElement("tr", null, /*#__PURE__*/React.createElement("td", {
    className: "p-2 border bg-gray-100 font-medium text-sm"
  }, "\uD83D\uDD3A ", lang === "fr" ? "Forte" : "High"), /*#__PURE__*/React.createElement("td", {
    className: "p-2 border bg-red-50 align-top min-w-32"
  }, matrix[0][0].map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s.id,
      className: "block text-xs bg-red-200 text-red-800 rounded px-2 py-1 mb-1"
    }, s.name);
  })), /*#__PURE__*/React.createElement("td", {
    className: "p-2 border bg-orange-50 align-top min-w-32"
  }, matrix[0][1].map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s.id,
      className: "block text-xs bg-orange-200 text-orange-800 rounded px-2 py-1 mb-1"
    }, s.name);
  })), /*#__PURE__*/React.createElement("td", {
    className: "p-2 border bg-green-50 align-top min-w-32"
  }, matrix[0][2].map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s.id,
      className: "block text-xs bg-green-200 text-green-800 rounded px-2 py-1 mb-1"
    }, s.name);
  }))), /*#__PURE__*/React.createElement("tr", null, /*#__PURE__*/React.createElement("td", {
    className: "p-2 border bg-gray-100 font-medium text-sm"
  }, "\uD83D\uDD38 ", lang === "fr" ? "Moyenne" : "Medium"), /*#__PURE__*/React.createElement("td", {
    className: "p-2 border bg-red-50/50 align-top"
  }, matrix[1][0].map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s.id,
      className: "block text-xs bg-red-100 text-red-700 rounded px-2 py-1 mb-1"
    }, s.name);
  })), /*#__PURE__*/React.createElement("td", {
    className: "p-2 border bg-yellow-50/50 align-top"
  }, matrix[1][1].map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s.id,
      className: "block text-xs bg-yellow-100 text-yellow-700 rounded px-2 py-1 mb-1"
    }, s.name);
  })), /*#__PURE__*/React.createElement("td", {
    className: "p-2 border bg-green-50/50 align-top"
  }, matrix[1][2].map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s.id,
      className: "block text-xs bg-green-100 text-green-700 rounded px-2 py-1 mb-1"
    }, s.name);
  }))), /*#__PURE__*/React.createElement("tr", null, /*#__PURE__*/React.createElement("td", {
    className: "p-2 border bg-gray-100 font-medium text-sm"
  }, "\uD83D\uDD3B ", lang === "fr" ? "Faible" : "Low"), /*#__PURE__*/React.createElement("td", {
    className: "p-2 border align-top"
  }, matrix[2][0].map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s.id,
      className: "block text-xs bg-gray-200 text-gray-700 rounded px-2 py-1 mb-1"
    }, s.name);
  })), /*#__PURE__*/React.createElement("td", {
    className: "p-2 border align-top"
  }, matrix[2][1].map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s.id,
      className: "block text-xs bg-gray-200 text-gray-700 rounded px-2 py-1 mb-1"
    }, s.name);
  })), /*#__PURE__*/React.createElement("td", {
    className: "p-2 border align-top"
  }, matrix[2][2].map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s.id,
      className: "block text-xs bg-gray-200 text-gray-700 rounded px-2 py-1 mb-1"
    }, s.name);
  }))))))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-medium text-gray-800 mb-3"
  }, "\uD83D\uDCCB ", lang === "fr" ? "Plan d'Engagement Auto-gÃ©nÃ©rÃ©" : "Auto-generated Engagement Plan"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, engagementPlan.map(function (action, idx) {
    return /*#__PURE__*/React.createElement("div", {
      key: idx,
      className: "p-4 bg-white rounded-lg border shadow-sm"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-start justify-between"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex-1"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2 mb-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-gray-800"
    }, action.stakeholder), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-500"
    }, "(", action.role, ")"), /*#__PURE__*/React.createElement("span", {
      className: "text-xs font-medium"
    }, action.priority)), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-blue-700 font-medium mb-1"
    }, "\u27A1\uFE0F ", action.action), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-600"
    }, action.detail)), /*#__PURE__*/React.createElement("div", {
      className: "text-right"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded"
    }, action.strategy))));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mb-4"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-medium text-gray-800 mb-3"
  }, lang === "fr" ? "ðŸ“ Liste des parties prenantes" : "ðŸ“ Stakeholder list"), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-2"
  }, stakeholders.map(function (s) {
    var bgColor = s.position === "opposed" ? "bg-red-100" : s.position === "favorable" ? "bg-green-100" : "bg-yellow-100";
    return /*#__PURE__*/React.createElement("span", {
      key: s.id,
      className: "px-3 py-1 rounded-full text-sm flex items-center gap-2 " + bgColor
    }, s.name, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        removeStakeholder(s.id);
      },
      className: "text-gray-500 hover:text-red-600"
    }, "\xD7"));
  })))), stakeholders.length === 0 && /*#__PURE__*/React.createElement("div", {
    className: "text-center py-12 text-gray-500"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-3"
  }, "\uD83D\uDC65"), /*#__PURE__*/React.createElement("p", null, lang === "fr" ? "Ajoutez des parties prenantes pour gÃ©nÃ©rer la matrice et le plan d'engagement" : "Add stakeholders to generate the matrix and engagement plan"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm mt-2"
  }, lang === "fr" ? "Ex: Direction, MÃ©decins, Infirmiers, Patients, ONG, Ã‰lus..." : "Ex: Management, Doctors, Nurses, Patients, NGOs, Officials..."))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-between gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      if (onSave) onSave(stakeholders);
      onClose();
    },
    className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
  }, "\uD83D\uDCBE ", lang === "fr" ? "Sauvegarder" : "Save"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// TRAINING PLAN GENERATOR
// ============================================
function TrainingPlanView(props) {
  var project = props.project;
  var protocol = props.protocol;
  var lang = props.lang;
  var onClose = props.onClose;
  if (!protocol || !protocol.aiRawRecommendations) return null;
  var strategies = protocol.aiRawRecommendations.strategies.top || [];

  // Identifier les stratÃ©gies liÃ©es Ã  la formation/accompagnement
  var trainingStrategies = ["S01", "S03", "S10", "S14", "S15"];
  var relevantStrategies = strategies.filter(function (s) {
    return trainingStrategies.includes(s.id);
  });

  // GÃ©nÃ©rer le plan de formation
  function generateTrainingPlan() {
    var plan = {
      objectives: [],
      modules: [],
      audiences: [],
      totalHours: 0
    };

    // Objectifs basÃ©s sur les stratÃ©gies
    relevantStrategies.forEach(function (s) {
      if (s.id === "S01") {
        plan.objectives.push(lang === "fr" ? "Renforcer les compÃ©tences techniques des Ã©quipes" : "Strengthen team technical skills");
        plan.modules.push({
          name: lang === "fr" ? "Formation initiale" : "Initial Training",
          duration: lang === "fr" ? "5 jours" : "5 days",
          hours: 35,
          format: lang === "fr" ? "PrÃ©sentiel + cas pratiques" : "In-person + case studies",
          frequency: lang === "fr" ? "Une fois au dÃ©marrage" : "Once at start",
          content: [lang === "fr" ? "Concepts fondamentaux" : "Core concepts", lang === "fr" ? "Protocoles et procÃ©dures" : "Protocols and procedures", lang === "fr" ? "Exercices pratiques" : "Practical exercises", lang === "fr" ? "Ã‰valuation des acquis" : "Knowledge assessment"]
        });
        plan.modules.push({
          name: lang === "fr" ? "Formation continue" : "Continuous Training",
          duration: lang === "fr" ? "1 jour/trimestre" : "1 day/quarter",
          hours: 28,
          format: lang === "fr" ? "PrÃ©sentiel ou e-learning" : "In-person or e-learning",
          frequency: lang === "fr" ? "Trimestriel" : "Quarterly",
          content: [lang === "fr" ? "Mises Ã  jour protocoles" : "Protocol updates", lang === "fr" ? "Retour sur les difficultÃ©s" : "Review of challenges", lang === "fr" ? "Nouvelles pratiques" : "New practices"]
        });
      }
      if (s.id === "S10") {
        plan.objectives.push(lang === "fr" ? "Assurer un accompagnement clinique de qualitÃ©" : "Ensure quality clinical support");
        plan.modules.push({
          name: lang === "fr" ? "Supervision clinique" : "Clinical Supervision",
          duration: lang === "fr" ? "8h/mois/Ã©quipe" : "8h/month/team",
          hours: 96,
          format: lang === "fr" ? "Sessions individuelles + groupe" : "Individual + group sessions",
          frequency: lang === "fr" ? "Hebdomadaire" : "Weekly",
          content: [lang === "fr" ? "Revue de cas cliniques" : "Clinical case review", lang === "fr" ? "Discussion des difficultÃ©s" : "Discussion of challenges", lang === "fr" ? "Soutien Ã©motionnel" : "Emotional support", lang === "fr" ? "Feedback constructif" : "Constructive feedback"]
        });
      }
      if (s.id === "S03") {
        plan.objectives.push(lang === "fr" ? "Faciliter le changement de pratiques" : "Facilitate practice change");
        plan.modules.push({
          name: lang === "fr" ? "Sessions de facilitation" : "Facilitation Sessions",
          duration: lang === "fr" ? "2h/quinzaine" : "2h/fortnight",
          hours: 52,
          format: lang === "fr" ? "RÃ©unions d'Ã©quipe facilitÃ©es" : "Facilitated team meetings",
          frequency: lang === "fr" ? "Bimensuel" : "Biweekly",
          content: [lang === "fr" ? "RÃ©solution de problÃ¨mes" : "Problem solving", lang === "fr" ? "Planification des actions" : "Action planning", lang === "fr" ? "Suivi des engagements" : "Commitment tracking"]
        });
      }
      if (s.id === "S14") {
        plan.objectives.push(lang === "fr" ? "Favoriser l'apprentissage collectif inter-sites" : "Promote collective learning across sites");
        plan.modules.push({
          name: lang === "fr" ? "Collaborative d'apprentissage" : "Learning Collaborative",
          duration: lang === "fr" ? "1 jour/trimestre" : "1 day/quarter",
          hours: 32,
          format: lang === "fr" ? "Ateliers multi-sites" : "Multi-site workshops",
          frequency: lang === "fr" ? "Trimestriel" : "Quarterly",
          content: [lang === "fr" ? "Partage de bonnes pratiques" : "Best practice sharing", lang === "fr" ? "Benchmarking inter-sites" : "Cross-site benchmarking", lang === "fr" ? "Co-construction de solutions" : "Co-creating solutions"]
        });
      }
      if (s.id === "S15") {
        plan.objectives.push(lang === "fr" ? "CrÃ©er un rÃ©seau de soutien par les pairs" : "Create peer support network");
        plan.modules.push({
          name: lang === "fr" ? "Formation pairs aidants" : "Peer Supporter Training",
          duration: lang === "fr" ? "3 jours" : "3 days",
          hours: 21,
          format: lang === "fr" ? "PrÃ©sentiel intensif" : "Intensive in-person",
          frequency: lang === "fr" ? "Une fois" : "Once",
          content: [lang === "fr" ? "Techniques d'Ã©coute active" : "Active listening techniques", lang === "fr" ? "Gestion des situations difficiles" : "Managing difficult situations", lang === "fr" ? "Auto-soin et limites" : "Self-care and boundaries"]
        });
      }
    });

    // Calculer total heures
    plan.totalHours = plan.modules.reduce(function (sum, m) {
      return sum + m.hours;
    }, 0);

    // DÃ©finir les audiences
    plan.audiences = [{
      name: lang === "fr" ? "Personnel soignant de premiÃ¨re ligne" : "Frontline healthcare staff",
      count: project.population ? project.population.match(/\d+/) ? parseInt(project.population.match(/\d+/)[0]) : 50 : 50
    }, {
      name: lang === "fr" ? "Superviseurs/RÃ©fÃ©rents" : "Supervisors/Referents",
      count: 10
    }, {
      name: lang === "fr" ? "Champions locaux" : "Local champions",
      count: 5
    }];
    return plan;
  }
  var trainingPlan = generateTrainingPlan();

  // Export Word du plan
  function exportTrainingPlan() {
    var doc = new docx.Document({
      sections: [{
        properties: {},
        children: [new docx.Paragraph({
          text: lang === "fr" ? "PLAN DE FORMATION ET SUPERVISION" : "TRAINING AND SUPERVISION PLAN",
          heading: docx.HeadingLevel.TITLE,
          spacing: {
            after: 400
          }
        }), new docx.Paragraph({
          text: project.title || "Projet",
          heading: docx.HeadingLevel.HEADING_1,
          spacing: {
            after: 200
          }
        }), new docx.Paragraph({
          text: (lang === "fr" ? "GÃ©nÃ©rÃ© par Moudar le " : "Generated by Moudar on ") + new Date().toLocaleDateString(),
          spacing: {
            after: 400
          }
        }), new docx.Paragraph({
          text: lang === "fr" ? "1. OBJECTIFS DE FORMATION" : "1. TRAINING OBJECTIVES",
          heading: docx.HeadingLevel.HEADING_2,
          spacing: {
            before: 400,
            after: 200
          }
        })].concat(trainingPlan.objectives.map(function (obj) {
          return new docx.Paragraph({
            text: "â€¢ " + obj,
            spacing: {
              after: 100
            }
          });
        })).concat([new docx.Paragraph({
          text: lang === "fr" ? "2. MODULES DE FORMATION" : "2. TRAINING MODULES",
          heading: docx.HeadingLevel.HEADING_2,
          spacing: {
            before: 400,
            after: 200
          }
        })]).concat(trainingPlan.modules.flatMap(function (mod) {
          return [new docx.Paragraph({
            text: mod.name,
            heading: docx.HeadingLevel.HEADING_3,
            spacing: {
              before: 200
            }
          }), new docx.Paragraph({
            text: (lang === "fr" ? "DurÃ©e: " : "Duration: ") + mod.duration
          }), new docx.Paragraph({
            text: (lang === "fr" ? "Format: " : "Format: ") + mod.format
          }), new docx.Paragraph({
            text: (lang === "fr" ? "FrÃ©quence: " : "Frequency: ") + mod.frequency
          }), new docx.Paragraph({
            text: lang === "fr" ? "Contenu:" : "Content:",
            spacing: {
              before: 100
            }
          })].concat(mod.content.map(function (c) {
            return new docx.Paragraph({
              text: "  - " + c
            });
          }));
        })).concat([new docx.Paragraph({
          text: (lang === "fr" ? "TOTAL HEURES ANNUELLES ESTIMÃ‰ES: " : "ESTIMATED ANNUAL HOURS: ") + trainingPlan.totalHours + "h",
          spacing: {
            before: 400
          },
          bold: true
        })])
      }]
    });
    docx.Packer.toBlob(doc).then(function (blob) {
      saveAs(blob, "Plan_Formation_" + (project.title || "Moudar").replace(/\s+/g, "_") + ".docx");
    });
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83C\uDF93 ", lang === "fr" ? "Plan de Formation & Supervision" : "Training & Supervision Plan"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "GÃ©nÃ©rÃ© automatiquement Ã  partir des stratÃ©gies recommandÃ©es" : "Auto-generated from recommended strategies")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, relevantStrategies.length === 0 ? /*#__PURE__*/React.createElement("div", {
    className: "text-center py-12 text-gray-500"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-3"
  }, "\uD83D\uDCDA"), /*#__PURE__*/React.createElement("p", null, lang === "fr" ? "Aucune stratÃ©gie de formation/supervision dans les recommandations" : "No training/supervision strategies in recommendations")) : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-medium text-blue-800 mb-2"
  }, lang === "fr" ? "ðŸ“Œ StratÃ©gies formation/accompagnement dÃ©tectÃ©es" : "ðŸ“Œ Training/support strategies detected"), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-2"
  }, relevantStrategies.map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s.id,
      className: "px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm"
    }, s.id, " - ", s.label[lang]);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83C\uDFAF ", lang === "fr" ? "Objectifs de formation" : "Training Objectives"), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-2"
  }, trainingPlan.objectives.map(function (obj, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i,
      className: "flex items-start gap-2 text-gray-700"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-green-600"
    }, "\u2713"), " ", obj);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDCDA ", lang === "fr" ? "Modules de formation" : "Training Modules"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4"
  }, trainingPlan.modules.map(function (mod, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-4 bg-white rounded-xl border shadow-sm"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-indigo-700 mb-2"
    }, mod.name), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-2 gap-2 text-sm mb-3"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "text-gray-500"
    }, "\u23F1\uFE0F"), " ", mod.duration), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "text-gray-500"
    }, "\uD83D\uDCC5"), " ", mod.frequency), /*#__PURE__*/React.createElement("div", {
      className: "col-span-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-gray-500"
    }, "\uD83D\uDCCD"), " ", mod.format)), /*#__PURE__*/React.createElement("div", {
      className: "text-sm text-gray-600"
    }, /*#__PURE__*/React.createElement("p", {
      className: "font-medium mb-1"
    }, lang === "fr" ? "Contenu:" : "Content:"), /*#__PURE__*/React.createElement("ul", {
      className: "space-y-1"
    }, mod.content.map(function (c, j) {
      return /*#__PURE__*/React.createElement("li", {
        key: j,
        className: "text-gray-600"
      }, "\u2022 ", c);
    }))), /*#__PURE__*/React.createElement("div", {
      className: "mt-3 text-right"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs font-medium"
    }, mod.hours, "h/", lang === "fr" ? "an" : "year")));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4 text-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-green-600"
  }, trainingPlan.totalHours, "h"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Heures/an estimÃ©es" : "Estimated hours/year")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, trainingPlan.modules.length), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Modules" : "Modules")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-purple-600"
  }, trainingPlan.audiences[0].count), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Personnes Ã  former" : "People to train")))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDC65 ", lang === "fr" ? "Publics cibles" : "Target Audiences"), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-3"
  }, trainingPlan.audiences.map(function (a, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "px-4 py-2 bg-gray-100 rounded-lg"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium"
    }, a.name), /*#__PURE__*/React.createElement("span", {
      className: "ml-2 text-gray-500"
    }, "(", a.count, " pers.)"));
  }))))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-between gap-3"
  }, relevantStrategies.length > 0 && /*#__PURE__*/React.createElement("button", {
    onClick: exportTrainingPlan,
    className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2"
  }, "\uD83D\uDCDD ", lang === "fr" ? "Exporter Word" : "Export Word"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 ml-auto"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// SUCCESS PREDICTION VIEW (v8.0)
// ============================================
function SuccessPredictionView(props) {
  var project = props.project;
  var strategies = props.strategies || [];
  var lang = props.lang;
  var onClose = props.onClose;

  // PrÃ©diction locale (heuristique) + Ã©tat API backend
  var defaultPrediction = {
    probability: 50,
    confidence: "medium",
    details: {
      positive: [],
      negative: [],
      synergies: []
    },
    strategyContribution: 0,
    synergyBonus: 0,
    riskPenalty: 0,
    improvements: []
  };
  var _localState = useState(function () {
    try {
      var result = MoudarEngine.predictSuccess(project, strategies, lang);
      // Assurer que toutes les propriÃ©tÃ©s existent
      result.details = result.details || defaultPrediction.details;
      result.details.positive = result.details.positive || [];
      result.details.negative = result.details.negative || [];
      result.details.synergies = result.details.synergies || [];
      result.improvements = result.improvements || [];
      result.strategyContribution = result.strategyContribution || 0;
      result.synergyBonus = result.synergyBonus || 0;
      result.riskPenalty = result.riskPenalty || 0;
      return result;
    } catch (e) {
      console.error("Local prediction error", e);
      return defaultPrediction;
    }
  });
  var localPrediction = _localState[0];
  var _apiState = useState(null);
  var apiPrediction = _apiState[0];
  var setApiPrediction = _apiState[1];
  var _loadingState = useState(false);
  var loading = _loadingState[0];
  var setLoading = _loadingState[1];
  var _errorState = useState(null);
  var error = _errorState[0];
  var setError = _errorState[1];

  // On privilÃ©gie la prÃ©diction API si disponible
  var prediction = apiPrediction || localPrediction || defaultPrediction;
  var probColor = prediction.probability >= 70 ? "text-green-600" : prediction.probability >= 50 ? "text-yellow-600" : "text-red-600";
  var probBg = prediction.probability >= 70 ? "from-green-50 to-emerald-50 border-green-200" : prediction.probability >= 50 ? "from-amber-50 to-yellow-50 border-yellow-200" : "from-red-50 to-orange-50 border-red-200";
  function callApiPrediction() {
    if (!MOUDAR_API_BASE) {
      setError(lang === "fr" ? "API Moudar non configurÃ©e (MOUDAR_API_BASE)." : "Moudar API not configured (MOUDAR_API_BASE).");
      return;
    }
    setLoading(true);
    setError(null);
    var payload = {
      projectPlan: {
        projectId: project && project.id ? project.id : "frontend-project",
        title: project && project.title ? project.title : "",
        domain: project && project.domain ? project.domain : null,
        country: project && project.country ? project.country : null,
        resourceLevel: project && project.resourceLevel ? project.resourceLevel : null,
        setting: project && project.context ? project.context : null,
        phase: project && project.phase ? project.phase : null,
        population: project && project.population ? project.population : null,
        targets: project && project.targets ? project.targets : null,
        barriers: project && project.barriers ? project.barriers : null,
        strategies: (strategies || []).map(function (s) {
          return {
            id: s.id || s.code || s.name,
            code: s.code || s.id || null,
            label: s.label && s.label[lang] ? s.label[lang] : s.label || s.name || s.id || "",
            cost: s.cost || null,
            complexity: s.complexity || null
          };
        }),
        frameworks: project && project.frameworks ? project.frameworks : null,
        outcomesPlanned: project && project.outcomes ? project.outcomes : null
      },
      context: {
        modelVersionRequested: "latest",
        source: "moudar_frontend_v8_0",
        includeExplanations: true
      }
    };
    safeMoudarFetch("/predict_success", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": MOUDAR_API_KEY ? "Bearer " + MOUDAR_API_KEY : ""
      },
      body: JSON.stringify(payload)
    }).then(function (res) {
      if (!res.ok) {
        throw new Error("HTTP " + res.status);
      }
      return res.json();
    }).then(function (data) {
      if (data && data.prediction) {
        var p = data.prediction;
        var raw = p.probSuccess !== undefined && p.probSuccess !== null ? p.probSuccess : p.probability !== undefined && p.probability !== null ? p.probability : 0;
        var probValue = raw <= 1 ? raw * 100 : raw;
        var conf = "medium";
        if (p.calibrationBand === "robust") {
          conf = "high";
        } else if (p.calibrationBand === "preliminary") {
          conf = "low";
        }
        setApiPrediction({
          probability: Math.round(probValue),
          confidence: conf,
          band: p.calibrationBand || null,
          source: "api"
        });
      } else {
        setError(lang === "fr" ? "RÃ©ponse API inattendue." : "Unexpected API response.");
      }
    }).catch(function (err) {
      console.error("Moudar /predict_success error", err);
      setError((lang === "fr" ? "Erreur lors de l'appel API : " : "Error calling API: ") + err.message);
    }).finally(function () {
      setLoading(false);
    });
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDD2E ", lang === "fr" ? "Estimateur Heuristique de Succes" : "Heuristic Success Estimator"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Estimation basee sur des coefficients heuristiques derives de la litterature IS (non-ML). Les resultats sont indicatifs, non predictifs au sens statistique." : "Estimation based on heuristic coefficients from IS literature (non-ML). Results are indicative, not statistically predictive.")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center p-8 rounded-2xl border bg-gradient-to-br mb-6 " + probBg
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-6xl font-bold mb-2 flex items-center justify-center gap-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: probColor
  }, prediction.probability, "%")), /*#__PURE__*/React.createElement("p", {
    className: "text-lg font-medium text-gray-800"
  }, lang === "fr" ? "ProbabilitÃ© de succÃ¨s estimÃ©e" : "Estimated success probability"), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex flex-wrap justify-center gap-3 text-sm"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/50 rounded-full"
  }, lang === "fr" ? "Confiance" : "Confidence", ": ", prediction.confidence || "?"), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/50 rounded-full"
  }, apiPrediction ? lang === "fr" ? "Source : modÃ¨le ML (API)" : "Source: ML model (API)" : lang === "fr" ? "Source : simulation locale Moudar" : "Source: local Moudar simulation")), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex flex-wrap justify-center gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: callApiPrediction,
    className: "px-4 py-2 bg-white/80 border border-indigo-300 text-indigo-700 rounded-full text-sm flex items-center gap-2 hover:bg-indigo-50"
  }, /*#__PURE__*/React.createElement("span", null, "\uD83D\uDCC8"), /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "Appeler l'API probabilitÃ© de succÃ¨s" : "Call success probability API")), loading && /*#__PURE__*/React.createElement("span", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Calcul en cours..." : "Computing...")), error && /*#__PURE__*/React.createElement("p", {
    className: "mt-3 text-sm text-red-600 text-center"
  }, error), apiPrediction && /*#__PURE__*/React.createElement("p", {
    className: "mt-3 text-xs text-gray-500 text-center"
  }, lang === "fr" ? "Le score ci-dessus intÃ¨gre dÃ©sormais le modÃ¨le de prÃ©diction backend (API)." : "The score above now uses the backend prediction model (API).")), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-green-50 rounded-xl border border-green-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-green-800 mb-3 flex items-center gap-2"
  }, "\u2705 ", lang === "fr" ? "Facteurs positifs" : "Positive factors"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, (prediction.details && prediction.details.positive || []).map(function (f, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "flex justify-between items-center text-sm"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-green-700"
    }, f.label || "Facteur"), /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-green-600"
    }, "+", f.impact || 0, "%"));
  }), prediction.details && prediction.details.synergies && prediction.details.synergies.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "mt-3 pt-3 border-t border-green-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-green-600 mb-2"
  }, "\u26A1 ", lang === "fr" ? "Synergies dÃ©tectÃ©es" : "Detected synergies"), (prediction.details.synergies || []).map(function (s, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "flex justify-between items-center text-sm"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-green-700"
    }, (s.strategies || []).join(" + ")), /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-green-600"
    }, "+", s.impact || 0, "%"));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 pt-3 border-t border-green-200 text-right"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-green-800 font-bold"
  }, "+", (prediction.strategyContribution || 0) + (prediction.synergyBonus || 0), "%"))), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-red-50 rounded-xl border border-red-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-red-800 mb-3 flex items-center gap-2"
  }, "\u26A0\uFE0F ", lang === "fr" ? "Facteurs de risque" : "Risk factors"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, (prediction.details && prediction.details.negative || []).map(function (f, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "flex justify-between items-center text-sm"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-red-700"
    }, f.label || "Risque"), /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-red-600"
    }, f.impact || 0, "%"));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 pt-3 border-t border-red-200 text-right"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-red-800 font-bold"
  }, prediction.riskPenalty || 0, "%")))), prediction.improvements && prediction.improvements.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-blue-800 mb-3"
  }, "\uD83D\uDCA1 ", lang === "fr" ? "Pour amÃ©liorer vos chances" : "To improve your chances"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, (prediction.improvements || []).map(function (imp, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "flex justify-between items-center p-2 bg-white rounded-lg"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-blue-700"
    }, imp.reason || ""), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 bg-blue-100 text-blue-700 rounded font-medium text-sm"
    }, "+", imp.gain || 0, "%"));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-3 bg-gray-100 rounded-lg text-center text-sm text-gray-600"
  }, "\u2139\uFE0F ", prediction.disclaimer)), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// BUDGET ESTIMATOR VIEW (v8.0)
// ============================================
function BudgetEstimatorView(props) {
  var project = props.project;
  var protocol = props.protocol;
  var lang = props.lang;
  var onClose = props.onClose;
  var strategies = protocol && protocol.strategies ? protocol.strategies : [];

  // Ã‰tats pour les paramÃ¨tres modifiables
  var durationState = useState(project.duration || 24);
  var duration = durationState[0];
  var setDuration = durationState[1];
  var sitesState = useState(project.sites || 1);
  var sites = sitesState[0];
  var setSites = sitesState[1];
  var populationState = useState(project.population || 100);
  var population = populationState[0];
  var setPopulation = populationState[1];
  var enrichedProject = Object.assign({}, project, {
    duration: duration,
    sites: sites,
    population: population
  });
  var budget = MoudarEngine.estimateBudget(enrichedProject, strategies, lang);
  var benchmarkColor = budget.benchmark.status === 'low' ? 'text-green-600' : budget.benchmark.status === 'normal' ? 'text-blue-600' : 'text-orange-600';
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDCB0 ", lang === "fr" ? "Estimateur BudgÃ©taire" : "Budget Estimator"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Estimation automatique en USD" : "Automatic estimate in USD")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm font-medium text-gray-700 mb-1"
  }, lang === "fr" ? "DurÃ©e (mois)" : "Duration (months)"), /*#__PURE__*/React.createElement("input", {
    type: "number",
    value: duration,
    onChange: function (e) {
      setDuration(parseInt(e.target.value) || 12);
    },
    min: "6",
    max: "60",
    className: "w-full p-2 border rounded-lg"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm font-medium text-gray-700 mb-1"
  }, lang === "fr" ? "Nombre de sites" : "Number of sites"), /*#__PURE__*/React.createElement("input", {
    type: "number",
    value: sites,
    onChange: function (e) {
      setSites(parseInt(e.target.value) || 1);
    },
    min: "1",
    max: "50",
    className: "w-full p-2 border rounded-lg"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm font-medium text-gray-700 mb-1"
  }, lang === "fr" ? "Population cible" : "Target population"), /*#__PURE__*/React.createElement("input", {
    type: "number",
    value: population,
    onChange: function (e) {
      setPopulation(parseInt(e.target.value) || 50);
    },
    min: "10",
    max: "10000",
    className: "w-full p-2 border rounded-lg"
  }))), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-6 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl border border-indigo-200 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl font-bold text-indigo-700 mb-2"
  }, "$", budget.summary.total.toLocaleString(), " USD"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Budget total estimÃ©" : "Total estimated budget"), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex justify-center gap-6 text-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "font-bold text-gray-700"
  }, "$", budget.summary.setup.toLocaleString()), /*#__PURE__*/React.createElement("div", {
    className: "text-gray-500"
  }, lang === "fr" ? "DÃ©marrage" : "Setup")), /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "font-bold text-gray-700"
  }, "$", budget.summary.recurring.toLocaleString()), /*#__PURE__*/React.createElement("div", {
    className: "text-gray-500"
  }, lang === "fr" ? "RÃ©current" : "Recurring")))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 rounded-xl border " + (budget.benchmark.status === 'low' ? 'bg-green-50 border-green-200' : budget.benchmark.status === 'normal' ? 'bg-blue-50 border-blue-200' : 'bg-orange-50 border-orange-200')
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
    className: "font-medium"
  }, lang === "fr" ? "CoÃ»t par bÃ©nÃ©ficiaire" : "Cost per beneficiary", ": "), /*#__PURE__*/React.createElement("span", {
    className: "font-bold " + benchmarkColor
  }, "$", budget.perBeneficiary)), /*#__PURE__*/React.createElement("div", {
    className: "px-3 py-1 rounded-full text-sm font-medium " + (budget.benchmark.status === 'low' ? 'bg-green-100 text-green-700' : budget.benchmark.status === 'normal' ? 'bg-blue-100 text-blue-700' : 'bg-orange-100 text-orange-700')
  }, budget.benchmark.message)), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mt-2"
  }, lang === "fr" ? "Benchmark" : "Benchmark", " (", budget.parameters.resourceLevel, "): $", budget.benchmark.range.low, " - $", budget.benchmark.range.high, " USD")), /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, lang === "fr" ? "DÃ©tail par poste" : "Breakdown by item"), /*#__PURE__*/React.createElement("div", {
    className: "overflow-x-auto"
  }, /*#__PURE__*/React.createElement("table", {
    className: "w-full text-sm"
  }, /*#__PURE__*/React.createElement("thead", {
    className: "bg-gray-100"
  }, /*#__PURE__*/React.createElement("tr", null, /*#__PURE__*/React.createElement("th", {
    className: "p-3 text-left"
  }, lang === "fr" ? "Poste" : "Item"), /*#__PURE__*/React.createElement("th", {
    className: "p-3 text-right"
  }, lang === "fr" ? "DÃ©marrage" : "Setup"), /*#__PURE__*/React.createElement("th", {
    className: "p-3 text-right"
  }, lang === "fr" ? "RÃ©current" : "Recurring"), /*#__PURE__*/React.createElement("th", {
    className: "p-3 text-right"
  }, "Total"))), /*#__PURE__*/React.createElement("tbody", null, (budget.lineItems || []).map(function (item, i) {
    return /*#__PURE__*/React.createElement("tr", {
      key: i,
      className: "border-b hover:bg-gray-50"
    }, /*#__PURE__*/React.createElement("td", {
      className: "p-3"
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-medium"
    }, item.label || ""), item.details && item.details.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, item.details.join(', '))), /*#__PURE__*/React.createElement("td", {
      className: "p-3 text-right"
    }, "$", Math.round(item.setup || 0).toLocaleString()), /*#__PURE__*/React.createElement("td", {
      className: "p-3 text-right"
    }, "$", Math.round(item.recurring || 0).toLocaleString()), /*#__PURE__*/React.createElement("td", {
      className: "p-3 text-right font-medium"
    }, "$", Math.round((item.setup || 0) + (item.recurring || 0)).toLocaleString()));
  })), /*#__PURE__*/React.createElement("tfoot", {
    className: "bg-indigo-50 font-bold"
  }, /*#__PURE__*/React.createElement("tr", null, /*#__PURE__*/React.createElement("td", {
    className: "p-3"
  }, "TOTAL"), /*#__PURE__*/React.createElement("td", {
    className: "p-3 text-right"
  }, "$", (budget.summary && budget.summary.setup || 0).toLocaleString()), /*#__PURE__*/React.createElement("td", {
    className: "p-3 text-right"
  }, "$", (budget.summary && budget.summary.recurring || 0).toLocaleString()), /*#__PURE__*/React.createElement("td", {
    className: "p-3 text-right text-indigo-700"
  }, "$", (budget.summary && budget.summary.total || 0).toLocaleString())))))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// COUNTRY INTELLIGENCE VIEW (v8.0)
// ============================================
function CountryIntelligenceView(props) {
  var project = props.project;
  var lang = props.lang;
  var onClose = props.onClose;
  var onSelectCountry = props.onSelectCountry;
  var countries = MoudarEngine.listCountries(lang);
  var selectedCountryState = useState(project.country || null);
  var selectedCountry = selectedCountryState[0];
  var setSelectedCountry = selectedCountryState[1];
  var report = selectedCountry ? MoudarEngine.getCountryReport(selectedCountry, lang) : null;
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83C\uDF0D ", lang === "fr" ? "Intelligence Contextuelle Pays" : "Country Context Intelligence"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Adaptez vos stratÃ©gies au contexte local" : "Adapt your strategies to local context")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm font-medium text-gray-700 mb-2"
  }, lang === "fr" ? "SÃ©lectionner un pays" : "Select a country"), /*#__PURE__*/React.createElement("select", {
    value: selectedCountry || "",
    onChange: function (e) {
      setSelectedCountry(e.target.value);
    },
    className: "w-full p-3 border rounded-xl text-lg"
  }, /*#__PURE__*/React.createElement("option", {
    value: ""
  }, lang === "fr" ? "-- Choisir --" : "-- Select --"), countries.map(function (c) {
    return /*#__PURE__*/React.createElement("option", {
      key: c.code,
      value: c.code
    }, c.name, " (", c.income, ")");
  }))), report && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-blue-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-blue-700"
  }, "$", report.indicators.gdpPerCapita.toLocaleString()), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "PIB/habitant" : "GDP/capita")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-purple-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-purple-700"
  }, report.indicators.psychiatristsPer100k), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Psychiatres/100k" : "Psychiatrists/100k")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-green-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-green-700"
  }, report.indicators.amoCouverage, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Couverture santÃ©" : "Health coverage"))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 rounded-xl border " + (report.income === 'HIC' ? 'bg-green-50 border-green-200' : report.income === 'UMIC' ? 'bg-blue-50 border-blue-200' : report.income === 'LMIC' ? 'bg-yellow-50 border-yellow-200' : 'bg-red-50 border-red-200')
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-2xl"
  }, report.income === 'HIC' ? 'ðŸ’Ž' : report.income === 'UMIC' ? 'ðŸ”·' : report.income === 'LMIC' ? 'ðŸ”¶' : 'ðŸ”¸'), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "font-bold"
  }, report.incomeLevel), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Langues" : "Languages", ": ", report.languages.join(', '))))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDEA7 ", lang === "fr" ? "BarriÃ¨res prioritaires dans ce contexte" : "Priority barriers in this context"), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-2"
  }, (report.priorityBarriers || []).map(function (b) {
    var barrier = MoudarEngine.getKnowledgeGraph().nodes.barriers[b];
    return /*#__PURE__*/React.createElement("span", {
      key: b,
      className: "px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm"
    }, barrier ? barrier.label[lang] : b);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl border border-indigo-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-indigo-800 mb-3"
  }, "\uD83D\uDCA1 ", lang === "fr" ? "Recommandations contextuelles" : "Contextual recommendations"), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-2"
  }, (report.recommendations || []).map(function (rec, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i,
      className: "flex items-start gap-2 text-indigo-700"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-indigo-500"
    }, "\u2192"), " ", rec);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\u2699\uFE0F ", lang === "fr" ? "Adaptations des stratÃ©gies" : "Strategy adaptations"), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 md:grid-cols-4 gap-2"
  }, Object.entries(report.adaptations || {}).map(function (entry) {
    var sid = entry[0];
    var mult = entry[1];
    var strategy = MoudarEngine.getKnowledgeGraph().nodes.strategies[sid];
    var color = mult > 1 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
    return /*#__PURE__*/React.createElement("div", {
      key: sid,
      className: "p-2 rounded-lg text-center text-sm " + color
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-medium"
    }, strategy ? strategy.label[lang] : sid), /*#__PURE__*/React.createElement("div", null, mult > 1 ? 'â†‘' : 'â†“', " ", Math.round((mult - 1) * 100), "%"));
  }))))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-between"
  }, selectedCountry && onSelectCountry && /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      onSelectCountry(selectedCountry);
      onClose();
    },
    className: "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
  }, lang === "fr" ? "Appliquer ce contexte" : "Apply this context"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 ml-auto"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// CASE LIBRARY VIEW (v8.0)
// ============================================
function CaseLibraryView(props) {
  var project = props.project;
  var protocol = props.protocol;
  var lang = props.lang;
  var onClose = props.onClose;
  var enrichedProject = Object.assign({}, project, {
    strategies: protocol && protocol.strategies ? protocol.strategies : []
  });
  var similarCases = MoudarEngine.findSimilarCases(enrichedProject, 5);
  var stats = MoudarEngine.getCaseStats();
  var selectedCaseState = useState(null);
  var selectedCase = selectedCaseState[0];
  var setSelectedCase = selectedCaseState[1];
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDCDA ", lang === "fr" ? "BibliothÃ¨que de Cas RÃ©els" : "Real Case Library"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, stats.totalCases, " ", lang === "fr" ? "cas documentÃ©s" : "documented cases", " \u2022 ", stats.successRate, "% ", lang === "fr" ? "de succÃ¨s" : "success rate")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, selectedCase ?
  /*#__PURE__*/
  // DÃ©tail d'un cas
  React.createElement("div", null, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setSelectedCase(null);
    },
    className: "text-blue-600 hover:text-blue-800 mb-4"
  }, "\u2190 ", lang === "fr" ? "Retour Ã  la liste" : "Back to list"), /*#__PURE__*/React.createElement("div", {
    className: "p-4 rounded-xl border mb-6 " + (selectedCase.outcome === 'success' ? 'bg-green-50 border-green-200' : selectedCase.outcome === 'partial' ? 'bg-yellow-50 border-yellow-200' : 'bg-red-50 border-red-200')
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-start mb-3"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold text-gray-800"
  }, selectedCase.title[lang]), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 rounded-full text-sm font-medium " + (selectedCase.outcome === 'success' ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700')
  }, selectedCase.outcome === 'success' ? lang === 'fr' ? 'SuccÃ¨s' : 'Success' : lang === 'fr' ? 'Partiel' : 'Partial')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-4 gap-4 text-sm mb-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("strong", null, lang === 'fr' ? 'Pays' : 'Country', ":"), " ", selectedCase.country), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("strong", null, lang === 'fr' ? 'DurÃ©e' : 'Duration', ":"), " ", selectedCase.duration, " ", lang === 'fr' ? 'mois' : 'months'), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("strong", null, "Sites:"), " ", selectedCase.sites), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("strong", null, "Budget:"), " $", selectedCase.budget.toLocaleString())), /*#__PURE__*/React.createElement("div", {
    className: "mb-4"
  }, /*#__PURE__*/React.createElement("strong", null, lang === 'fr' ? 'Taux d\'adoption' : 'Adoption rate', ":"), /*#__PURE__*/React.createElement("div", {
    className: "w-full bg-gray-200 rounded-full h-4 mt-1"
  }, /*#__PURE__*/React.createElement("div", {
    className: "h-4 rounded-full " + (selectedCase.adoptionRate >= 70 ? 'bg-green-500' : selectedCase.adoptionRate >= 50 ? 'bg-yellow-500' : 'bg-red-500'),
    style: {
      width: selectedCase.adoptionRate + '%'
    }
  })), /*#__PURE__*/React.createElement("span", {
    className: "text-sm text-gray-600"
  }, selectedCase.adoptionRate, "%"))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDCCB ", lang === 'fr' ? 'StratÃ©gies utilisÃ©es' : 'Strategies used'), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-2"
  }, (selectedCase.strategies || []).map(function (sid) {
    var strat = MoudarEngine.getKnowledgeGraph().nodes.strategies[sid];
    return /*#__PURE__*/React.createElement("span", {
      key: sid,
      className: "px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm"
    }, strat ? strat.label[lang] : sid);
  }))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-3"
  }, "\u26A0\uFE0F ", lang === 'fr' ? 'DÃ©fis rencontrÃ©s' : 'Challenges encountered'), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-1 text-sm text-gray-700"
  }, (selectedCase.challenges && selectedCase.challenges[lang] || []).map(function (c, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i
    }, "\u2022 ", c);
  })))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-green-50 rounded-xl border border-green-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-green-800 mb-3"
  }, "\uD83D\uDCA1 ", lang === 'fr' ? 'LeÃ§ons apprises' : 'Lessons learned'), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-2"
  }, (selectedCase.lessons && selectedCase.lessons[lang] || []).map(function (l, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i,
      className: "flex items-start gap-2 text-green-700"
    }, /*#__PURE__*/React.createElement("span", null, "\u2713"), " ", l);
  })))) :
  /*#__PURE__*/
  // Liste des cas similaires
  React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4"
  }, "\uD83D\uDD0D ", lang === 'fr' ? 'Cas similaires Ã  votre projet' : 'Cases similar to your project'), /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, similarCases.map(function (item) {
    var c = item.case;
    return /*#__PURE__*/React.createElement("div", {
      key: c.id,
      onClick: function () {
        setSelectedCase(c);
      },
      className: "p-4 rounded-xl border cursor-pointer transition hover:shadow-md " + (c.outcome === 'success' ? 'bg-green-50 border-green-200 hover:border-green-400' : 'bg-yellow-50 border-yellow-200 hover:border-yellow-400')
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-gray-800"
    }, c.title[lang]), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-gray-600"
    }, c.country, " \u2022 ", c.duration, " ", lang === 'fr' ? 'mois' : 'months', " \u2022 ", c.year)), /*#__PURE__*/React.createElement("div", {
      className: "text-right"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-lg font-bold " + (c.outcome === 'success' ? 'text-green-600' : 'text-yellow-600')
    }, item.similarity, "% ", lang === 'fr' ? 'similaire' : 'similar'), /*#__PURE__*/React.createElement("div", {
      className: "text-sm text-gray-500"
    }, c.adoptionRate, "% ", lang === 'fr' ? 'adoption' : 'adoption'))), /*#__PURE__*/React.createElement("div", {
      className: "mt-3 flex flex-wrap gap-1"
    }, c.strategies.slice(0, 4).map(function (sid) {
      return /*#__PURE__*/React.createElement("span", {
        key: sid,
        className: "px-2 py-0.5 bg-white/50 rounded text-xs"
      }, sid);
    }), c.strategies.length > 4 && /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 bg-white/50 rounded text-xs"
    }, "+", c.strategies.length - 4)));
  })))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// RISK ANALYSIS VIEW (v8.0)
// ============================================
function RiskAnalysisView(props) {
  var project = props.project;
  var strategies = props.strategies || [];
  var lang = props.lang;
  var onClose = props.onClose;
  var analysis = MoudarEngine.analyzeRisks(project, strategies, lang);
  var overallColor = analysis.summary.overallLevel === 'critical' ? 'bg-red-500' : analysis.summary.overallLevel === 'high' ? 'bg-orange-500' : analysis.summary.overallLevel === 'medium' ? 'bg-yellow-500' : 'bg-green-500';
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\u26A0\uFE0F ", lang === "fr" ? "Analyse des Risques" : "Risk Analysis"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Identification et mitigation des risques projet" : "Project risk identification and mitigation")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-5 gap-4 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "col-span-2 p-4 bg-gray-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-500 mb-1"
  }, lang === 'fr' ? 'Niveau global' : 'Overall level'), /*#__PURE__*/React.createElement("div", {
    className: "inline-block px-4 py-2 rounded-full text-white font-bold " + overallColor
  }, analysis.summary.overallLevel.toUpperCase())), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-red-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-red-600"
  }, analysis.summary.critical), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-600"
  }, lang === 'fr' ? 'Critiques' : 'Critical')), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-orange-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-orange-600"
  }, analysis.summary.high), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-600"
  }, lang === 'fr' ? 'Ã‰levÃ©s' : 'High')), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-yellow-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-yellow-600"
  }, analysis.summary.medium), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-600"
  }, lang === 'fr' ? 'Moyens' : 'Medium'))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gray-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, lang === 'fr' ? 'Matrice des risques' : 'Risk matrix'), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-4 gap-1 text-xs"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-2"
  }), /*#__PURE__*/React.createElement("div", {
    className: "p-2 text-center font-medium"
  }, lang === 'fr' ? 'Faible' : 'Low'), /*#__PURE__*/React.createElement("div", {
    className: "p-2 text-center font-medium"
  }, lang === 'fr' ? 'Moyen' : 'Medium'), /*#__PURE__*/React.createElement("div", {
    className: "p-2 text-center font-medium"
  }, lang === 'fr' ? 'Ã‰levÃ©' : 'High'), /*#__PURE__*/React.createElement("div", {
    className: "p-2 font-medium"
  }, lang === 'fr' ? 'Probable' : 'Likely'), /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-yellow-200 rounded text-center"
  }, analysis.risks.filter(function (r) {
    return r.probability >= 60 && r.impact === 'low';
  }).length), /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-orange-300 rounded text-center"
  }, analysis.matrix.highProb_medImpact.length), /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-red-400 rounded text-center text-white"
  }, analysis.matrix.highProb_highImpact.length), /*#__PURE__*/React.createElement("div", {
    className: "p-2 font-medium"
  }, lang === 'fr' ? 'Possible' : 'Possible'), /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-green-200 rounded text-center"
  }, analysis.risks.filter(function (r) {
    return r.probability >= 40 && r.probability < 60 && r.impact === 'low';
  }).length), /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-yellow-200 rounded text-center"
  }, analysis.risks.filter(function (r) {
    return r.probability >= 40 && r.probability < 60 && r.impact === 'medium';
  }).length), /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-orange-300 rounded text-center"
  }, analysis.matrix.medProb_highImpact.length), /*#__PURE__*/React.createElement("div", {
    className: "p-2 font-medium"
  }, lang === 'fr' ? 'Rare' : 'Rare'), /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-green-100 rounded text-center"
  }, analysis.matrix.lowRisk.length), /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-green-200 rounded text-center"
  }, analysis.risks.filter(function (r) {
    return r.probability < 40 && r.impact === 'medium';
  }).length), /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-yellow-200 rounded text-center"
  }, analysis.risks.filter(function (r) {
    return r.probability < 40 && r.impact === 'high';
  }).length))), /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, lang === 'fr' ? 'DÃ©tail des risques' : 'Risk details'), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, analysis.risks.map(function (risk) {
    var levelColor = risk.level === 'critical' ? 'border-red-400 bg-red-50' : risk.level === 'high' ? 'border-orange-400 bg-orange-50' : risk.level === 'medium' ? 'border-yellow-400 bg-yellow-50' : 'border-green-400 bg-green-50';
    var levelBadge = risk.level === 'critical' ? 'bg-red-500 text-white' : risk.level === 'high' ? 'bg-orange-500 text-white' : risk.level === 'medium' ? 'bg-yellow-500 text-gray-800' : 'bg-green-500 text-white';
    return /*#__PURE__*/React.createElement("div", {
      key: risk.id,
      className: "p-4 rounded-xl border-l-4 " + levelColor
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start mb-2"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "font-bold text-gray-800"
    }, risk.name), /*#__PURE__*/React.createElement("span", {
      className: "text-sm text-gray-500 ml-2"
    }, "(", risk.category, ")")), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 rounded text-xs font-medium " + levelBadge
    }, risk.level)), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-4 text-sm mb-2"
    }, /*#__PURE__*/React.createElement("span", null, lang === 'fr' ? 'ProbabilitÃ©' : 'Probability', ": ", risk.probability, "%"), /*#__PURE__*/React.createElement("span", null, lang === 'fr' ? 'Impact' : 'Impact', ": ", risk.impact)), risk.mitigationsPresent.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "flex flex-wrap gap-1 mb-2"
    }, risk.mitigationsPresent.map(function (m) {
      return /*#__PURE__*/React.createElement("span", {
        key: m,
        className: "px-2 py-0.5 bg-green-100 text-green-700 rounded text-xs"
      }, "\u2713 ", m);
    })), risk.mitigationsMissing.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "text-sm text-blue-700"
    }, "\uD83D\uDCA1 ", risk.recommendation));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// v8.3 - TORNADO ANALYSIS VIEW (SensibilitÃ©)
// ============================================
function TornadoAnalysisView(props) {
  var project = props.project;
  var lang = props.lang;
  var onClose = props.onClose;
  var analysisState = useState(null);
  var analysis = analysisState[0];
  var setAnalysis = analysisState[1];
  useEffect(function () {
    if (project && window.SensitivityAnalyzer) {
      var result = SensitivityAnalyzer.runTornadoAnalysis(project, lang);
      setAnalysis(result);
    }
  }, [project]);
  if (!analysis) {
    return React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl p-6 max-w-md"
    }, React.createElement('p', null, lang === 'fr' ? "Analyse en cours..." : "Analyzing...")));
  }
  var getPriorityColor = function (priority) {
    return priority === 'critical' ? 'bg-red-500' : priority === 'high' ? 'bg-orange-500' : priority === 'medium' ? 'bg-yellow-500' : 'bg-green-500';
  };
  var getPriorityBg = function (priority) {
    return priority === 'critical' ? 'bg-red-50 border-red-200' : priority === 'high' ? 'bg-orange-50 border-orange-200' : priority === 'medium' ? 'bg-yellow-50 border-yellow-200' : 'bg-green-50 border-green-200';
  };
  return React.createElement('div', {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto"
  }, React.createElement('div', {
    className: "bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
  },
  // Header
  React.createElement('div', {
    className: "bg-gradient-to-r from-red-600 to-orange-600 p-6 text-white rounded-t-2xl"
  }, React.createElement('div', {
    className: "flex justify-between items-start"
  }, React.createElement('div', null, React.createElement('h2', {
    className: "text-2xl font-bold flex items-center gap-2"
  }, "ðŸŒªï¸ ", lang === 'fr' ? "Analyse de SensibilitÃ© Tornado" : "Tornado Sensitivity Analysis"), React.createElement('p', {
    className: "text-white/80 mt-1"
  }, lang === 'fr' ? "Identifiez quelle barriÃ¨re impacte le plus votre succÃ¨s" : "Identify which barrier most impacts your success")), React.createElement('button', {
    onClick: onClose,
    className: "text-white/80 hover:text-white text-2xl"
  }, "Ã—"))),
  // Score global
  React.createElement('div', {
    className: "p-6 border-b"
  }, React.createElement('div', {
    className: "flex items-center gap-6"
  }, React.createElement('div', {
    className: "text-center"
  }, React.createElement('div', {
    className: "text-5xl font-bold " + (analysis.baseSuccessPercent >= 60 ? "text-green-600" : analysis.baseSuccessPercent >= 40 ? "text-yellow-600" : "text-red-600")
  }, analysis.baseSuccessPercent + "%"), React.createElement('p', {
    className: "text-sm text-gray-500"
  }, lang === 'fr' ? "ProbabilitÃ© de succÃ¨s actuelle" : "Current success probability")), React.createElement('div', {
    className: "flex-1"
  }, React.createElement('div', {
    className: "h-4 bg-gray-200 rounded-full overflow-hidden"
  }, React.createElement('div', {
    className: "h-full rounded-full transition-all " + (analysis.baseSuccessPercent >= 60 ? "bg-green-500" : analysis.baseSuccessPercent >= 40 ? "bg-yellow-500" : "bg-red-500"),
    style: {
      width: analysis.baseSuccessPercent + "%"
    }
  })), React.createElement('div', {
    className: "flex justify-between text-xs text-gray-400 mt-1"
  }, React.createElement('span', null, "0%"), React.createElement('span', null, "50%"), React.createElement('span', null, "100%"))))),
  // Graphique Tornado
  React.createElement('div', {
    className: "p-6"
  }, React.createElement('h3', {
    className: "font-bold text-gray-800 mb-4"
  }, lang === 'fr' ? "Impact des barriÃ¨res sur le succÃ¨s" : "Barrier Impact on Success"), React.createElement('div', {
    className: "space-y-3"
  }, analysis.barriers.slice(0, 8).map(function (barrier, idx) {
    var maxGain = Math.max.apply(null, analysis.barriers.map(function (b) {
      return b.percentageGain;
    }));
    var barWidth = barrier.percentageGain / maxGain * 100;
    return React.createElement('div', {
      key: idx,
      className: "flex items-center gap-3"
    }, React.createElement('div', {
      className: "w-40 text-sm text-right text-gray-600 truncate"
    }, barrier.barrierName), React.createElement('div', {
      className: "flex-1 bg-gray-100 rounded-full h-8 relative overflow-hidden"
    }, React.createElement('div', {
      className: "h-full rounded-full transition-all flex items-center justify-end pr-2 " + getPriorityColor(barrier.priority),
      style: {
        width: Math.max(barWidth, 10) + "%"
      }
    }, React.createElement('span', {
      className: "text-white text-xs font-bold"
    }, "+" + Math.round(barrier.percentageGain) + "%"))), React.createElement('span', {
      className: "text-xs px-2 py-1 rounded " + getPriorityBg(barrier.priority)
    }, barrier.priority === 'critical' ? 'ðŸ”´' : barrier.priority === 'high' ? 'ðŸŸ ' : barrier.priority === 'medium' ? 'ðŸŸ¡' : 'ðŸŸ¢'));
  })), React.createElement('p', {
    className: "text-xs text-gray-500 mt-4 italic"
  }, lang === 'fr' ? "Les barres montrent le gain potentiel si la barriÃ¨re Ã©tait rÃ©solue Ã  100%" : "Bars show potential gain if the barrier was 100% resolved")),
  // Recommandations prioritaires
  React.createElement('div', {
    className: "p-6 bg-gray-50"
  }, React.createElement('h3', {
    className: "font-bold text-gray-800 mb-4"
  }, "ðŸ’¡ " + (lang === 'fr' ? "Recommandations prioritaires" : "Priority Recommendations")), React.createElement('div', {
    className: "space-y-3"
  }, analysis.barriers.slice(0, 3).map(function (barrier, idx) {
    return React.createElement('div', {
      key: idx,
      className: "p-4 rounded-xl border " + getPriorityBg(barrier.priority)
    }, React.createElement('div', {
      className: "flex items-start gap-3"
    }, React.createElement('span', {
      className: "text-2xl"
    }, idx === 0 ? "1ï¸âƒ£" : idx === 1 ? "2ï¸âƒ£" : "3ï¸âƒ£"), React.createElement('div', null, React.createElement('p', {
      className: "font-semibold text-gray-800"
    }, barrier.barrierName), React.createElement('p', {
      className: "text-sm text-gray-600 mt-1"
    }, barrier.recommendation))));
  }))),
  // Footer
  React.createElement('div', {
    className: "p-4 border-t flex justify-between items-center"
  }, React.createElement('span', {
    className: "text-xs text-gray-400"
  }, lang === 'fr' ? "Analyse gÃ©nÃ©rÃ©e le " : "Analysis generated on ", new Date(analysis.analysisDate).toLocaleDateString()), React.createElement('button', {
    onClick: onClose,
    className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
  }, lang === 'fr' ? "Fermer" : "Close"))));
}

// ============================================
// v8.3 - PORTFOLIO VIEW (Multi-projets)
// ============================================
function PortfolioView(props) {
  var projects = props.projects || [];
  var lang = props.lang;
  var onClose = props.onClose;
  var onSelectProject = props.onSelectProject;
  var portfolioState = useState(null);
  var portfolio = portfolioState[0];
  var setPortfolio = portfolioState[1];
  var viewModeState = useState('overview');
  var viewMode = viewModeState[0];
  var setViewMode = viewModeState[1];
  useEffect(function () {
    if (projects.length > 0 && window.PortfolioManager) {
      var result = PortfolioManager.aggregatePortfolio(projects, {
        lang: lang
      });
      setPortfolio(result);
    }
  }, [projects]);
  if (!portfolio) {
    return React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl p-8 text-center"
    }, projects.length === 0 ? React.createElement('div', null, React.createElement('span', {
      className: "text-6xl"
    }, "ðŸ“‚"), React.createElement('p', {
      className: "mt-4 text-gray-600"
    }, lang === 'fr' ? "Aucun projet Ã  analyser" : "No projects to analyze"), React.createElement('button', {
      onClick: onClose,
      className: "mt-4 px-4 py-2 bg-gray-200 rounded-lg"
    }, lang === 'fr' ? "Fermer" : "Close")) : React.createElement('p', null, lang === 'fr' ? "Chargement..." : "Loading...")));
  }
  var getHealthColor = function (level) {
    return level === 'healthy' ? 'text-green-600' : level === 'moderate' ? 'text-yellow-600' : level === 'at_risk' ? 'text-orange-600' : 'text-red-600';
  };
  var getRiskColor = function (level) {
    return level === 'critical' ? 'bg-red-100 text-red-700 border-red-200' : level === 'high' ? 'bg-orange-100 text-orange-700 border-orange-200' : level === 'medium' ? 'bg-yellow-100 text-yellow-700 border-yellow-200' : 'bg-green-100 text-green-700 border-green-200';
  };
  return React.createElement('div', {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 overflow-y-auto"
  }, React.createElement('div', {
    className: "bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[95vh] overflow-y-auto"
  },
  // Header
  React.createElement('div', {
    className: "bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white rounded-t-2xl sticky top-0 z-10"
  }, React.createElement('div', {
    className: "flex justify-between items-start"
  }, React.createElement('div', null, React.createElement('h2', {
    className: "text-2xl font-bold flex items-center gap-2"
  }, "ðŸ“Š ", lang === 'fr' ? "Tableau de Bord Portfolio" : "Portfolio Dashboard"), React.createElement('p', {
    className: "text-white/80 mt-1"
  }, portfolio.totalProjects + " " + (lang === 'fr' ? "projets analysÃ©s" : "projects analyzed"))), React.createElement('button', {
    onClick: onClose,
    className: "text-white/80 hover:text-white text-2xl"
  }, "Ã—")),
  // Tabs
  React.createElement('div', {
    className: "flex gap-2 mt-4"
  }, ['overview', 'risks', 'barriers'].map(function (mode) {
    var labels = {
      overview: {
        fr: "Vue d'ensemble",
        en: "Overview"
      },
      risks: {
        fr: "Carte des risques",
        en: "Risk Map"
      },
      barriers: {
        fr: "BarriÃ¨res systÃ©miques",
        en: "Systemic Barriers"
      }
    };
    return React.createElement('button', {
      key: mode,
      onClick: function () {
        setViewMode(mode);
      },
      className: "px-4 py-2 rounded-lg text-sm transition " + (viewMode === mode ? "bg-white text-indigo-700 font-semibold" : "bg-white/20 hover:bg-white/30")
    }, labels[mode][lang]);
  }))),
  // Content based on view mode
  viewMode === 'overview' && React.createElement('div', {
    className: "p-6"
  },
  // KPIs Row
  React.createElement('div', {
    className: "grid grid-cols-4 gap-4 mb-6"
  },
  // Health Score
  React.createElement('div', {
    className: "bg-gradient-to-br from-indigo-50 to-purple-50 rounded-xl p-4 border border-indigo-100"
  }, React.createElement('p', {
    className: "text-xs text-gray-500 uppercase tracking-wide"
  }, lang === 'fr' ? "SantÃ© Portfolio" : "Portfolio Health"), React.createElement('p', {
    className: "text-3xl font-bold mt-1 " + getHealthColor(portfolio.healthScore.level)
  }, portfolio.healthScore.score + "/100"), React.createElement('p', {
    className: "text-sm " + getHealthColor(portfolio.healthScore.level)
  }, portfolio.healthScore.label[lang])),
  // Average Success
  React.createElement('div', {
    className: "bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 border border-green-100"
  }, React.createElement('p', {
    className: "text-xs text-gray-500 uppercase tracking-wide"
  }, lang === 'fr' ? "SuccÃ¨s moyen" : "Average Success"), React.createElement('p', {
    className: "text-3xl font-bold mt-1 text-green-600"
  }, portfolio.averageSuccessRate + "%")),
  // Critical Projects
  React.createElement('div', {
    className: "bg-gradient-to-br from-red-50 to-orange-50 rounded-xl p-4 border border-red-100"
  }, React.createElement('p', {
    className: "text-xs text-gray-500 uppercase tracking-wide"
  }, lang === 'fr' ? "Projets critiques" : "Critical Projects"), React.createElement('p', {
    className: "text-3xl font-bold mt-1 text-red-600"
  }, portfolio.riskDistribution.critical), React.createElement('p', {
    className: "text-sm text-red-500"
  }, "/ " + portfolio.totalProjects + " " + (lang === 'fr' ? "total" : "total"))),
  // With Protocol
  React.createElement('div', {
    className: "bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-4 border border-blue-100"
  }, React.createElement('p', {
    className: "text-xs text-gray-500 uppercase tracking-wide"
  }, lang === 'fr' ? "Avec protocole" : "With Protocol"), React.createElement('p', {
    className: "text-3xl font-bold mt-1 text-blue-600"
  }, portfolio.projectsWithProtocol), React.createElement('p', {
    className: "text-sm text-blue-500"
  }, Math.round(portfolio.projectsWithProtocol / portfolio.totalProjects * 100) + "%"))),
  // Risk Distribution Chart
  React.createElement('div', {
    className: "bg-white rounded-xl border p-4 mb-6"
  }, React.createElement('h3', {
    className: "font-semibold text-gray-800 mb-3"
  }, lang === 'fr' ? "Distribution des risques" : "Risk Distribution"), React.createElement('div', {
    className: "flex gap-2 h-8"
  }, portfolio.riskDistribution.critical > 0 && React.createElement('div', {
    className: "bg-red-500 rounded flex items-center justify-center text-white text-xs font-bold",
    style: {
      width: portfolio.riskDistribution.critical / portfolio.totalProjects * 100 + "%"
    }
  }, portfolio.riskDistribution.critical), portfolio.riskDistribution.high > 0 && React.createElement('div', {
    className: "bg-orange-500 rounded flex items-center justify-center text-white text-xs font-bold",
    style: {
      width: portfolio.riskDistribution.high / portfolio.totalProjects * 100 + "%"
    }
  }, portfolio.riskDistribution.high), portfolio.riskDistribution.medium > 0 && React.createElement('div', {
    className: "bg-yellow-500 rounded flex items-center justify-center text-white text-xs font-bold",
    style: {
      width: portfolio.riskDistribution.medium / portfolio.totalProjects * 100 + "%"
    }
  }, portfolio.riskDistribution.medium), portfolio.riskDistribution.low > 0 && React.createElement('div', {
    className: "bg-green-500 rounded flex items-center justify-center text-white text-xs font-bold",
    style: {
      width: portfolio.riskDistribution.low / portfolio.totalProjects * 100 + "%"
    }
  }, portfolio.riskDistribution.low)), React.createElement('div', {
    className: "flex justify-between mt-2 text-xs text-gray-500"
  }, React.createElement('span', null, "ðŸ”´ " + (lang === 'fr' ? "Critique" : "Critical")), React.createElement('span', null, "ðŸŸ  " + (lang === 'fr' ? "Ã‰levÃ©" : "High")), React.createElement('span', null, "ðŸŸ¡ " + (lang === 'fr' ? "Moyen" : "Medium")), React.createElement('span', null, "ðŸŸ¢ " + (lang === 'fr' ? "Faible" : "Low")))),
  // Recommendations
  portfolio.recommendations.length > 0 && React.createElement('div', {
    className: "bg-amber-50 rounded-xl border border-amber-200 p-4"
  }, React.createElement('h3', {
    className: "font-semibold text-amber-800 mb-3 flex items-center gap-2"
  }, "âš¡ ", lang === 'fr' ? "Recommandations stratÃ©giques" : "Strategic Recommendations"), React.createElement('div', {
    className: "space-y-2"
  }, portfolio.recommendations.map(function (rec, idx) {
    return React.createElement('div', {
      key: idx,
      className: "p-3 bg-white rounded-lg border border-amber-100"
    }, React.createElement('p', {
      className: "font-medium text-gray-800"
    }, rec.title), React.createElement('p', {
      className: "text-sm text-gray-600 mt-1"
    }, rec.description), React.createElement('p', {
      className: "text-xs text-amber-600 mt-2"
    }, "â†’ " + rec.action));
  })))), viewMode === 'risks' && React.createElement('div', {
    className: "p-6"
  }, React.createElement('h3', {
    className: "font-semibold text-gray-800 mb-4"
  }, lang === 'fr' ? "Projets par niveau de risque" : "Projects by Risk Level"), React.createElement('div', {
    className: "space-y-3"
  }, portfolio.projectRisks.map(function (proj, idx) {
    return React.createElement('div', {
      key: idx,
      className: "p-4 rounded-xl border cursor-pointer hover:shadow-md transition " + getRiskColor(proj.riskLevel),
      onClick: function () {
        if (onSelectProject) onSelectProject(proj.projectId);
      }
    }, React.createElement('div', {
      className: "flex justify-between items-start"
    }, React.createElement('div', null, React.createElement('p', {
      className: "font-semibold"
    }, proj.projectTitle || "Projet " + (idx + 1)), React.createElement('p', {
      className: "text-sm opacity-75"
    }, (lang === 'fr' ? "BarriÃ¨re principale: " : "Top barrier: ") + (proj.topBarrier || "N/A"))), React.createElement('div', {
      className: "text-right"
    }, React.createElement('p', {
      className: "text-2xl font-bold"
    }, proj.successProbability + "%"), React.createElement('p', {
      className: "text-xs uppercase"
    }, proj.riskLevel))));
  }))), viewMode === 'barriers' && React.createElement('div', {
    className: "p-6"
  }, React.createElement('h3', {
    className: "font-semibold text-gray-800 mb-4"
  }, lang === 'fr' ? "BarriÃ¨res les plus frÃ©quentes dans le portfolio" : "Most Frequent Barriers in Portfolio"), React.createElement('div', {
    className: "space-y-3"
  }, portfolio.topBarriers.map(function (barrier, idx) {
    return React.createElement('div', {
      key: idx,
      className: "flex items-center gap-4"
    }, React.createElement('div', {
      className: "w-48 text-sm text-gray-600"
    }, barrier.barrierName), React.createElement('div', {
      className: "flex-1 bg-gray-100 rounded-full h-6 overflow-hidden"
    }, React.createElement('div', {
      className: "h-full bg-indigo-500 rounded-full flex items-center justify-end pr-2",
      style: {
        width: barrier.percentage + "%"
      }
    }, React.createElement('span', {
      className: "text-white text-xs font-bold"
    }, barrier.percentage + "%"))), React.createElement('span', {
      className: "text-sm text-gray-500 w-20"
    }, barrier.count + " " + (lang === 'fr' ? "projets" : "projects")));
  })), portfolio.topBarriers.length > 0 && portfolio.topBarriers[0].percentage > 50 && React.createElement('div', {
    className: "mt-6 p-4 bg-red-50 rounded-xl border border-red-200"
  }, React.createElement('p', {
    className: "font-semibold text-red-800"
  }, "âš ï¸ " + (lang === 'fr' ? "BarriÃ¨re systÃ©mique dÃ©tectÃ©e" : "Systemic barrier detected")), React.createElement('p', {
    className: "text-sm text-red-700 mt-1"
  }, lang === 'fr' ? "\"" + portfolio.topBarriers[0].barrierName + "\" affecte plus de 50% de vos projets. Une intervention au niveau organisationnel est recommandÃ©e." : "\"" + portfolio.topBarriers[0].barrierName + "\" affects over 50% of your projects. An organizational-level intervention is recommended."))),
  // Footer
  React.createElement('div', {
    className: "p-4 border-t flex justify-between items-center bg-gray-50 rounded-b-2xl"
  }, React.createElement('span', {
    className: "text-xs text-gray-400"
  }, lang === 'fr' ? "Analyse gÃ©nÃ©rÃ©e le " : "Analysis generated on ", new Date(portfolio.generatedAt).toLocaleDateString()), React.createElement('div', {
    className: "flex gap-2"
  }, React.createElement('button', {
    onClick: function () {
      var report = PortfolioManager.exportPortfolioReport(portfolio, 'json');
      var blob = new Blob([report], {
        type: 'application/json'
      });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'MOUDAR_Portfolio_Report_' + new Date().toISOString().split('T')[0] + '.json';
      a.click();
    },
    className: "px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition text-sm"
  }, "ðŸ“¥ " + (lang === 'fr' ? "Exporter" : "Export")), React.createElement('button', {
    onClick: onClose,
    className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
  }, lang === 'fr' ? "Fermer" : "Close")))));
}

// ============================================
// RESEARCH EXPORTS VIEW (v8.0)
// ============================================
function ResearchExportsView(props) {
  var project = props.project;
  var strategies = props.strategies || [];
  var lang = props.lang;
  var onClose = props.onClose;
  var selectedExportState = useState('SPIRIT');
  var selectedExport = selectedExportState[0];
  var setSelectedExport = selectedExportState[1];
  var evalPlanState = useState(null);
  var evaluationPlan = evalPlanState[0];
  var setEvaluationPlan = evalPlanState[1];
  var evalLoadingState = useState(false);
  var evalLoading = evalLoadingState[0];
  var setEvalLoading = evalLoadingState[1];
  var evalErrorState = useState(null);
  var evalError = evalErrorState[0];
  var setEvalError = evalErrorState[1];
  var exports = {
    SPIRIT: MoudarEngine.generateSPIRIT(project, strategies, lang),
    TIDieR: MoudarEngine.generateTIDieR(project, strategies, lang),
    StaRI: MoudarEngine.generateStaRI(project, strategies, lang)
  };
  var currentExport = exports[selectedExport];
  function handleGenerateEvaluationPlan() {
    if (!MOUDAR_API_BASE) {
      setEvalError(lang === 'fr' ? "API Moudar non configurÃ©e (MOUDAR_API_BASE)." : "Moudar API not configured (MOUDAR_API_BASE).");
      return;
    }
    setEvalLoading(true);
    setEvalError(null);
    var payload = {
      mode: "evaluation_plan",
      language: lang === 'fr' ? 'fr' : 'en',
      projectPlan: {
        title: project && project.title ? project.title : "",
        domain: project && project.domain ? project.domain : null,
        country: project && project.country ? project.country : null,
        resourceLevel: project && project.resourceLevel ? project.resourceLevel : null,
        setting: project && project.context ? project.context : null,
        phase: project && project.phase ? project.phase : null,
        population: project && project.population ? project.population : null,
        targets: project && project.targets ? project.targets : null,
        barriers: project && project.barriers ? project.barriers : null,
        frameworks: project && project.frameworks ? project.frameworks : null,
        outcomesPlanned: project && project.outcomes ? project.outcomes : null
      },
      recommendation: {
        strategies: (strategies || []).map(function (s) {
          return {
            id: s.id || s.code || s.name,
            code: s.code || s.id || null,
            label: s.label && s.label[lang] ? s.label[lang] : s.label || s.name || s.id || "",
            cost: s.cost || null,
            complexity: s.complexity || null
          };
        }),
        frameworks: project && project.frameworks ? project.frameworks : [],
        outcomes: project && project.outcomes ? project.outcomes : []
      },
      constraints: {
        maxWords: 600,
        tone: "academic",
        includeCitations: false
      }
    };
    safeMoudarFetch("/llm_generate", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": MOUDAR_API_KEY ? "Bearer " + MOUDAR_API_KEY : ""
      },
      body: JSON.stringify(payload)
    }).then(function (res) {
      if (!res.ok) {
        throw new Error("HTTP " + res.status);
      }
      return res.json();
    }).then(function (data) {
      if (data && data.text) {
        setEvaluationPlan(data.text);
      } else if (typeof data === "string") {
        setEvaluationPlan(data);
      } else {
        setEvalError(lang === 'fr' ? "RÃ©ponse inattendue du gÃ©nÃ©rateur." : "Unexpected generator response.");
      }
    }).catch(function (err) {
      console.error("Moudar /llm_generate error", err);
      setEvalError((lang === 'fr' ? "Erreur de gÃ©nÃ©ration : " : "Generation error: ") + err.message);
    }).finally(function () {
      setEvalLoading(false);
    });
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDCC4 ", lang === "fr" ? "Exports Standards Recherche" : "Research Standards Exports"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Templates SPIRIT, TIDieR, StaRI prÃ©-remplis" : "Pre-filled SPIRIT, TIDieR, StaRI templates")), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: handleGenerateEvaluationPlan,
    className: "px-3 py-1.5 rounded-lg text-sm bg-gradient-to-r from-indigo-600 to-purple-600 text-white hover:from-indigo-700 hover:to-purple-700 shadow-sm flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", null, "\u270D\uFE0F"), /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "GÃ©nÃ©rer le plan d'Ã©valuation" : "Generate evaluation plan")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715"))), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3 mb-6"
  }, ['SPIRIT', 'TIDieR', 'StaRI'].map(function (format) {
    var exp = exports[format];
    return /*#__PURE__*/React.createElement("button", {
      key: format,
      onClick: function () {
        setSelectedExport(format);
      },
      className: "flex-1 p-4 rounded-xl border-2 transition " + (selectedExport === format ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200 hover:border-gray-400')
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, format), /*#__PURE__*/React.createElement("div", {
      className: "text-sm text-gray-500"
    }, exp.version), /*#__PURE__*/React.createElement("div", {
      className: "mt-2"
    }, /*#__PURE__*/React.createElement("div", {
      className: "w-full bg-gray-200 rounded-full h-2"
    }, /*#__PURE__*/React.createElement("div", {
      className: "h-2 rounded-full " + (exp.completionRate >= 70 ? 'bg-green-500' : exp.completionRate >= 40 ? 'bg-yellow-500' : 'bg-red-500'),
      style: {
        width: exp.completionRate + '%'
      }
    })), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-500"
    }, exp.completionRate, "% ", lang === 'fr' ? 'complÃ©tÃ©' : 'complete')));
  })), /*#__PURE__*/React.createElement("div", {
    className: "border rounded-xl overflow-hidden"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gray-100 p-3 border-b"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold"
  }, currentExport.type, " ", currentExport.version, " Checklist")), currentExport.type === 'SPIRIT' ?
  // SPIRIT avec sections
  Object.values(currentExport.sections).map(function (section, si) {
    return /*#__PURE__*/React.createElement("div", {
      key: si,
      className: "border-b last:border-b-0"
    }, /*#__PURE__*/React.createElement("div", {
      className: "bg-gray-50 p-3 font-medium"
    }, section.title), section.items.map(function (item, ii) {
      var statusColor = item.status === 'complete' ? 'bg-green-100 text-green-700' : item.status === 'partial' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700';
      var statusIcon = item.status === 'complete' ? 'âœ“' : item.status === 'partial' ? 'â—' : 'â—‹';
      return /*#__PURE__*/React.createElement("div", {
        key: ii,
        className: "p-3 border-t flex gap-3 hover:bg-gray-50"
      }, /*#__PURE__*/React.createElement("span", {
        className: "w-6 h-6 rounded-full flex items-center justify-center text-xs " + statusColor
      }, statusIcon), /*#__PURE__*/React.createElement("div", {
        className: "flex-1"
      }, /*#__PURE__*/React.createElement("div", {
        className: "font-medium text-sm"
      }, item.id, ". ", item.item), /*#__PURE__*/React.createElement("div", {
        className: "text-sm text-gray-600 mt-1"
      }, item.content)));
    }));
  }) :
  /*#__PURE__*/
  // TIDieR et StaRI avec items simples
  React.createElement("div", null, currentExport.items.map(function (item, i) {
    var statusColor = item.status === 'complete' ? 'bg-green-100 text-green-700' : item.status === 'partial' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700';
    var statusIcon = item.status === 'complete' ? 'âœ“' : item.status === 'partial' ? 'â—' : 'â—‹';
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-3 border-t flex gap-3 hover:bg-gray-50"
    }, /*#__PURE__*/React.createElement("span", {
      className: "w-6 h-6 rounded-full flex items-center justify-center text-xs " + statusColor
    }, statusIcon), /*#__PURE__*/React.createElement("div", {
      className: "flex-1"
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-sm"
    }, item.id, ". ", item.item), /*#__PURE__*/React.createElement("div", {
      className: "text-sm text-gray-600 mt-1"
    }, item.content)));
  })))), evaluationPlan && /*#__PURE__*/React.createElement("div", {
    className: "mt-4 bg-indigo-50 border border-indigo-200 rounded-xl p-4 mx-4 mb-2"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 flex items-center gap-2 mb-2"
  }, "\u270D\uFE0F ", lang === 'fr' ? "Plan d'Ã©valuation gÃ©nÃ©rÃ© (LLM)" : "Generated evaluation plan (LLM)"), evalError && /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-red-600 mb-2"
  }, evalError), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-800 whitespace-pre-line leading-relaxed max-h-64 overflow-auto"
  }, evaluationPlan), /*#__PURE__*/React.createElement("p", {
    className: "mt-2 text-xs text-gray-500"
  }, lang === 'fr' ? "Astuce : copiez-collez ce plan dans votre section 'MÃ©thodes' / 'Plan d'Ã©valuation' du protocole." : "Tip: copy-paste this plan into your Methods / Evaluation section.")), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// v8.0 VIEWS - WORLD LEADER SMOA
// ============================================

// ============================================
// GANTT TIMELINE VIEW
// ============================================
function GanttTimelineView(props) {
  var project = props.project;
  var strategies = props.strategies || [];
  var lang = props.lang;
  var onClose = props.onClose;
  var gantt = MoudarEngine.generateGanttTimeline(project, strategies, lang);
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDCC5 ", lang === "fr" ? "Timeline Gantt EPIS" : "EPIS Gantt Timeline"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, gantt.totalMonths, " ", lang === "fr" ? "mois" : "months", " \u2022 ", gantt.strategies.length, " ", lang === "fr" ? "stratÃ©gies" : "strategies")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, lang === "fr" ? "Phases du projet" : "Project phases"), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-1 h-12 rounded-lg overflow-hidden"
  }, Object.values(gantt.phases).map(function (phase) {
    var width = phase.duration / gantt.totalWeeks * 100;
    return /*#__PURE__*/React.createElement("div", {
      key: phase.label,
      className: "flex items-center justify-center text-white text-sm font-medium",
      style: {
        width: width + '%',
        backgroundColor: phase.color
      }
    }, phase.label);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6 flex flex-wrap gap-3"
  }, gantt.milestones.map(function (m, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "px-3 py-1 bg-gray-100 rounded-full text-sm flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", null, m.icon), /*#__PURE__*/React.createElement("span", {
      className: "text-gray-600"
    }, lang === "fr" ? "S" : "W", m.week), /*#__PURE__*/React.createElement("span", {
      className: "font-medium"
    }, m.label));
  })), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, gantt.strategies.map(function (sid, idx) {
    var stratTasks = gantt.tasks.filter(function (t) {
      return t.strategy === sid;
    });
    var strat = window.MoudarEngine.getKnowledgeGraph().nodes.strategies[sid];
    return /*#__PURE__*/React.createElement("div", {
      key: sid,
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("div", {
      className: "w-40 text-sm font-medium text-gray-700 truncate"
    }, strat ? strat.label[lang] : sid), /*#__PURE__*/React.createElement("div", {
      className: "flex-1 h-8 bg-gray-100 rounded relative"
    }, stratTasks.map(function (task) {
      var left = task.start / gantt.totalWeeks * 100;
      var width = task.duration / gantt.totalWeeks * 100;
      return /*#__PURE__*/React.createElement("div", {
        key: task.id,
        className: "absolute h-6 top-1 rounded text-xs text-white flex items-center justify-center",
        style: {
          left: left + '%',
          width: width + '%',
          backgroundColor: task.color
        },
        title: task.name
      }, width > 10 ? task.phase.substring(0, 4) : '');
    })));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 flex gap-4 text-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-4 h-4 rounded",
    style: {
      backgroundColor: '#8b5cf6'
    }
  }), " ", lang === "fr" ? "PrÃ©paration" : "Preparation"), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-4 h-4 rounded",
    style: {
      backgroundColor: '#10b981'
    }
  }), " ", lang === "fr" ? "ImplÃ©mentation" : "Implementation"), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-4 h-4 rounded",
    style: {
      backgroundColor: '#f59e0b'
    }
  }), " ", lang === "fr" ? "PÃ©rennisation" : "Sustainment"))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// CFIR 2.0 EVALUATOR VIEW
// ============================================
function CFIR2View(props) {
  var project = props.project;
  var strategies = props.strategies || [];
  var lang = props.lang;
  var onClose = props.onClose;
  var showCitations = React.useState(false);
  var citationsVisible = showCitations[0];
  var setCitationsVisible = showCitations[1];

  // VÃ©rification dÃ©fensive - FIX pour Ã©viter page blanche
  var evaluation;
  var defaultEval = {
    globalScore: 0,
    coveredConstructs: 0,
    totalConstructs: 39,
    domainScores: {
      innovation: {
        score: 0,
        label: lang === "fr" ? "Innovation" : "Innovation",
        constructs: []
      },
      outerSetting: {
        score: 0,
        label: lang === "fr" ? "Contexte externe" : "Outer Setting",
        constructs: []
      },
      innerSetting: {
        score: 0,
        label: lang === "fr" ? "Contexte interne" : "Inner Setting",
        constructs: []
      },
      individuals: {
        score: 0,
        label: lang === "fr" ? "Individus" : "Individuals",
        constructs: []
      },
      process: {
        score: 0,
        label: lang === "fr" ? "Processus" : "Process",
        constructs: []
      }
    },
    criticalGaps: [],
    gaps: [],
    strengths: [],
    levelLabel: lang === "fr" ? "Non Ã©valuÃ©" : "Not evaluated",
    radarData: [],
    dimensions: {},
    citation: 'Damschroder LJ et al. (2022). Implementation Science, 17:75',
    version: '2.0'
  };
  try {
    if (!MoudarEngine.evaluateCFIR) {
      evaluation = defaultEval;
    } else {
      evaluation = MoudarEngine.evaluateCFIR(project, strategies, lang);
      // Assurer que toutes les propriÃ©tÃ©s existent
      evaluation.domainScores = evaluation.domainScores || defaultEval.domainScores;
      evaluation.criticalGaps = evaluation.criticalGaps || [];
      evaluation.radarData = evaluation.radarData || [];
      evaluation.dimensions = evaluation.dimensions || {};
      evaluation.levelLabel = evaluation.levelLabel || defaultEval.levelLabel;
    }
  } catch (e) {
    console.error("[MOUDAR] Erreur CFIR:", e);
    evaluation = defaultEval;
  }
  var domainColors = {
    innovation: '#3b82f6',
    outerSetting: '#10b981',
    innerSetting: '#8b5cf6',
    individuals: '#f59e0b',
    process: '#ef4444'
  };
  var domainIcons = {
    innovation: 'ðŸ’¡',
    outerSetting: 'ðŸŒ',
    innerSetting: 'ðŸ›ï¸',
    individuals: 'ðŸ‘¤',
    process: 'âš™ï¸'
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83C\uDFD7\uFE0F ", lang === "fr" ? "Ã‰valuation CFIR 2.0" : "CFIR 2.0 Evaluation", /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full font-normal"
  }, "Damschroder 2022")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, "5 ", lang === "fr" ? "domaines" : "domains", " \u2022 39 constructs \u2022 ", lang === "fr" ? "Alignement exact CFIR 2.0" : "Exact CFIR 2.0 alignment")), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setCitationsVisible(!citationsVisible);
    },
    className: "px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg text-sm hover:bg-blue-100",
    title: lang === "fr" ? "Voir les citations" : "View citations"
  }, "\uD83D\uDCDA Cite"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715"))), citationsVisible && /*#__PURE__*/React.createElement("div", {
    className: "mx-6 mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-blue-800 text-sm mb-2"
  }, "\uD83D\uDCDA ", lang === "fr" ? "Citations pour vos publications" : "Citations for your publications"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-1 text-xs text-gray-700 font-mono"
  }, /*#__PURE__*/React.createElement("p", null, "\u2022 Damschroder LJ, Reardon CM, Widerquist MAO, et al. (2022). Implementation Science, 17:75."), /*#__PURE__*/React.createElement("p", null, "\u2022 Waltz TJ, Powell BJ, Fernandez ME, et al. (2019). Implementation Science, 14:50."), /*#__PURE__*/React.createElement("p", null, "\u2022 Powell BJ, Waltz TJ, Chinman MJ, et al. (2015). Implementation Science, 10:21."), /*#__PURE__*/React.createElement("p", null, "\u2022 Generated by MOUDAR\xAE v11.0 \u2014 AI-Powered IS Platform. \xA9 2025 Younes MOUDAR."))), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center p-6 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl border border-indigo-200 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-5xl font-bold text-indigo-700 mb-2"
  }, evaluation.globalScore, "%"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Score CFIR 2.0 global" : "Global CFIR 2.0 Score"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mt-2"
  }, evaluation.coveredConstructs || 0, "/", evaluation.totalConstructs || 39, " constructs ", lang === "fr" ? "couverts" : "covered"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-400 mt-1"
  }, lang === "fr" ? "BasÃ© sur" : "Based on", " Damschroder et al. (2022) \u2022 CFIR-ERIC: Waltz et al. (2019)")), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-5 gap-4 mb-6"
  }, Object.keys(evaluation.domainScores || {}).map(function (domainId) {
    var domain = evaluation.domainScores[domainId] || {};
    return /*#__PURE__*/React.createElement("div", {
      key: domainId,
      className: "p-4 rounded-xl border",
      style: {
        borderColor: domainColors[domainId],
        backgroundColor: domainColors[domainId] + '10'
      }
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-lg mb-1"
    }, domainIcons[domainId] || 'ðŸ“‹'), /*#__PURE__*/React.createElement("div", {
      className: "text-2xl font-bold",
      style: {
        color: domainColors[domainId]
      }
    }, domain.score || 0, "%"), /*#__PURE__*/React.createElement("div", {
      className: "text-sm font-medium text-gray-700"
    }, domain.label || domainId), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, domain.covered || 0, "/", domain.total || 0, " constructs"));
  })), evaluation.criticalGaps && evaluation.criticalGaps.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-red-50 rounded-xl border border-red-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-red-800 mb-3"
  }, "\u26A0\uFE0F ", lang === "fr" ? "Gaps critiques â€” Recommandations ERIC (Waltz et al. 2019)" : "Critical Gaps â€” ERIC Recommendations (Waltz et al. 2019)"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, (evaluation.criticalGaps || []).map(function (gap, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-3 bg-white rounded-lg border border-red-100"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-red-700"
    }, gap.construct || ""), /*#__PURE__*/React.createElement("span", {
      className: "text-gray-400 ml-2 text-xs"
    }, "(", gap.domain || "", ")")), /*#__PURE__*/React.createElement("span", {
      className: "text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded"
    }, lang === "fr" ? "Poids" : "Weight", ": ", gap.weight)), /*#__PURE__*/React.createElement("div", {
      className: "text-blue-600 text-xs mt-1"
    }, "\uD83D\uDCA1 ", gap.recommendation || ""), gap.ericStrategies && gap.ericStrategies.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "mt-2 flex flex-wrap gap-1"
    }, gap.ericStrategies.map(function (es, j) {
      return /*#__PURE__*/React.createElement("span", {
        key: j,
        className: "px-2 py-0.5 rounded text-xs " + (es.level === 1 ? "bg-green-100 text-green-700" : "bg-yellow-100 text-yellow-700")
      }, es.strategy, " ", es.level === 1 ? "â˜…" : "â˜†");
    })));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, Object.keys(evaluation.domainScores || {}).map(function (domainId) {
    var domain = evaluation.domainScores[domainId] || {};
    return /*#__PURE__*/React.createElement("details", {
      key: domainId,
      className: "border rounded-xl overflow-hidden"
    }, /*#__PURE__*/React.createElement("summary", {
      className: "p-4 cursor-pointer font-medium flex justify-between items-center",
      style: {
        backgroundColor: domainColors[domainId] + '10'
      }
    }, /*#__PURE__*/React.createElement("span", null, domainIcons[domainId] || 'ðŸ“‹', " ", domain.label || domainId), /*#__PURE__*/React.createElement("span", {
      className: "font-bold",
      style: {
        color: domainColors[domainId]
      }
    }, domain.score || 0, "%")), /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-white"
    }, domain.description && /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mb-3 italic"
    }, domain.description), /*#__PURE__*/React.createElement("div", {
      className: "grid gap-2"
    }, (domain.constructs || []).map(function (c) {
      var statusColor = c.status === 'strong' ? 'bg-green-100 text-green-700' : c.status === 'partial' ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-500';
      return /*#__PURE__*/React.createElement("div", {
        key: c.id,
        className: "flex justify-between items-center text-sm p-2 rounded hover:bg-gray-50",
        title: c.cfir2Note || ''
      }, /*#__PURE__*/React.createElement("div", {
        className: "flex items-center gap-2"
      }, /*#__PURE__*/React.createElement("span", {
        className: "text-xs text-gray-400 font-mono w-8"
      }, c.id), /*#__PURE__*/React.createElement("span", {
        className: "text-gray-700"
      }, c.name || ""), c.cfir2Note && c.cfir2Note.indexOf('NEW') >= 0 && /*#__PURE__*/React.createElement("span", {
        className: "px-1 py-0 bg-blue-100 text-blue-600 text-xs rounded"
      }, "NEW")), /*#__PURE__*/React.createElement("span", {
        className: "px-2 py-0.5 rounded text-xs " + statusColor
      }, c.coveredBy && c.coveredBy.length > 0 ? c.coveredBy.join(', ') : lang === 'fr' ? 'Non couvert' : 'Not covered'));
    }))));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-xs text-gray-400"
  }, "CFIR 2.0 (Damschroder et al., 2022) \u2022 CFIR-ERIC (Waltz et al., 2019) \u2022 MOUDAR\xAE v11.0"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// RE-AIM EVALUATOR VIEW
// ============================================
function REAIMView(props) {
  var project = props.project;
  var strategies = props.strategies || [];
  var lang = props.lang;
  var onClose = props.onClose;
  var evaluation = MoudarEngine.evaluateREAIM(project, strategies, [], lang);
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83C\uDFAF ", lang === "fr" ? "Ã‰valuation RE-AIM" : "RE-AIM Evaluation"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, "Reach \u2022 Effectiveness \u2022 Adoption \u2022 Implementation \u2022 Maintenance")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center p-6 rounded-2xl border mb-6 " + (evaluation.globalScore >= 70 ? 'bg-green-50 border-green-200' : evaluation.globalScore >= 50 ? 'bg-yellow-50 border-yellow-200' : 'bg-red-50 border-red-200')
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-5xl font-bold mb-2 " + ((evaluation.globalScore || 0) >= 70 ? 'text-green-600' : (evaluation.globalScore || 0) >= 50 ? 'text-yellow-600' : 'text-red-600')
  }, evaluation.globalScore || 0, "%"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 font-medium"
  }, evaluation.levelLabel || "")), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-5 gap-4 mb-6"
  }, (evaluation.radarData || []).map(function (dim) {
    return /*#__PURE__*/React.createElement("div", {
      key: dim.dimension,
      className: "text-center p-4 rounded-xl border",
      style: {
        borderColor: dim.color || '#6b7280'
      }
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl font-bold",
      style: {
        color: dim.color || '#6b7280'
      }
    }, dim.score || 0, "%"), /*#__PURE__*/React.createElement("div", {
      className: "text-sm font-medium text-gray-700"
    }, dim.dimension || ""), /*#__PURE__*/React.createElement("div", {
      className: "mt-2 h-2 bg-gray-200 rounded-full"
    }, /*#__PURE__*/React.createElement("div", {
      className: "h-2 rounded-full",
      style: {
        width: (dim.score || 0) + '%',
        backgroundColor: dim.color || '#6b7280'
      }
    })));
  })), /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, Object.values(evaluation.dimensions || {}).map(function (dim) {
    return /*#__PURE__*/React.createElement("div", {
      key: dim.id,
      className: "p-4 rounded-xl border",
      style: {
        borderColor: dim.color || '#6b7280'
      }
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start mb-3"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-gray-800"
    }, dim.label || ""), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-gray-500"
    }, dim.description || "")), /*#__PURE__*/React.createElement("span", {
      className: "text-2xl font-bold",
      style: {
        color: dim.color || '#6b7280'
      }
    }, dim.score || 0, "%")), dim.strategiesMissing && dim.strategiesMissing.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "mt-3 p-3 bg-amber-50 rounded-lg"
    }, /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-amber-700"
    }, "\uD83D\uDCA1 ", lang === 'fr' ? 'StratÃ©gies recommandÃ©es:' : 'Recommended strategies:', " ", dim.strategiesMissing.join(', '))));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// ROI CALCULATOR VIEW
// ============================================
function ROICalculatorView(props) {
  var project = props.project;
  var budget = props.budget || {
    summary: {
      total: 100000,
      setup: 20000,
      recurring: 80000
    }
  };
  var lang = props.lang;
  var onClose = props.onClose;
  var roi = MoudarEngine.calculateROI(project, budget, [], lang);
  var perfColor = roi.performanceLevel === 'excellent' ? 'text-green-600' : roi.performanceLevel === 'good' ? 'text-blue-600' : roi.performanceLevel === 'acceptable' ? 'text-yellow-600' : 'text-red-600';
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDCC8 ", lang === "fr" ? "Calculateur ROI" : "ROI Calculator"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Retour sur investissement" : "Return on Investment")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-4 gap-4 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl border border-green-200 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold " + perfColor
  }, roi.metrics.roi, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, "ROI")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl border border-blue-200 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, roi.metrics.bcRatio, "x"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Ratio B/C" : "B/C Ratio")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl border border-purple-200 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-purple-600"
  }, roi.metrics.paybackMonths), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Mois rÃ©cupÃ©ration" : "Payback months")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gradient-to-br from-amber-50 to-yellow-50 rounded-xl border border-amber-200 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-amber-600"
  }, "$", Math.round(roi.metrics.npv / 1000), "K"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, "VAN/NPV"))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-red-50 rounded-xl border border-red-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-red-800 mb-3"
  }, "\uD83D\uDCB8 ", lang === "fr" ? "Investissement" : "Investment"), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-red-600"
  }, "$", roi.investment.total.toLocaleString()), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, "$", roi.investment.perBeneficiary, " / ", lang === "fr" ? "bÃ©nÃ©ficiaire" : "beneficiary")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-green-50 rounded-xl border border-green-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-green-800 mb-3"
  }, "\uD83D\uDCB0 ", lang === "fr" ? "BÃ©nÃ©fices totaux" : "Total Benefits"), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-green-600"
  }, "$", roi.benefits.total.toLocaleString()), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, "$", roi.benefits.perBeneficiary, " / ", lang === "fr" ? "bÃ©nÃ©ficiaire" : "beneficiary"))), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gray-50 rounded-xl mb-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, lang === "fr" ? "DÃ©composition des bÃ©nÃ©fices annuels" : "Annual benefits breakdown"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "BÃ©nÃ©fices directs" : "Direct benefits"), /*#__PURE__*/React.createElement("span", {
    className: "font-medium"
  }, "$", roi.benefits.annual.direct.toLocaleString())), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "BÃ©nÃ©fices indirects" : "Indirect benefits"), /*#__PURE__*/React.createElement("span", {
    className: "font-medium"
  }, "$", roi.benefits.annual.indirect.toLocaleString())), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "BÃ©nÃ©fices intangibles" : "Intangible benefits"), /*#__PURE__*/React.createElement("span", {
    className: "font-medium"
  }, "$", roi.benefits.annual.intangible.toLocaleString())), /*#__PURE__*/React.createElement("div", {
    className: "border-t pt-2 flex justify-between items-center font-bold"
  }, /*#__PURE__*/React.createElement("span", null, "Total"), /*#__PURE__*/React.createElement("span", null, "$", roi.benefits.annual.total.toLocaleString())))), /*#__PURE__*/React.createElement("div", {
    className: "p-4 border rounded-xl"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, lang === "fr" ? "Analyse de sensibilitÃ©" : "Sensitivity analysis"), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-3 gap-4 text-center text-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-red-50 rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "font-bold text-red-600"
  }, Math.round(roi.sensitivity.pessimistic.roi), "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-gray-500"
  }, lang === "fr" ? "Pessimiste" : "Pessimistic")), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-blue-50 rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "font-bold text-blue-600"
  }, Math.round(roi.sensitivity.base.roi), "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-gray-500"
  }, lang === "fr" ? "Base" : "Base")), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-green-50 rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "font-bold text-green-600"
  }, Math.round(roi.sensitivity.optimistic.roi), "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-gray-500"
  }, lang === "fr" ? "Optimiste" : "Optimistic"))))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// FUNDING PROPOSAL VIEW
// ============================================
function FundingProposalView(props) {
  var project = props.project;
  var strategies = props.strategies || [];
  var budget = props.budget || {
    summary: {
      total: 100000
    }
  };
  var lang = props.lang;
  var onClose = props.onClose;
  var funderState = useState('WHO');
  var funder = funderState[0];
  var setFunder = funderState[1];
  var proposal = MoudarEngine.generateFundingProposal(project, strategies, budget, funder, lang);
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDCDD ", lang === "fr" ? "GÃ©nÃ©rateur Demande de Financement" : "Funding Proposal Generator"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Templates OMS, UNICEF, Global Fund, USAID" : "WHO, UNICEF, Global Fund, USAID templates")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3 mb-6"
  }, ['WHO', 'UNICEF', 'GlobalFund', 'USAID'].map(function (f) {
    var templates = {
      WHO: 'ðŸ¥ WHO',
      UNICEF: 'ðŸ‘¶ UNICEF',
      GlobalFund: 'ðŸŒ Global Fund',
      USAID: 'ðŸ‡ºðŸ‡¸ USAID'
    };
    return /*#__PURE__*/React.createElement("button", {
      key: f,
      onClick: function () {
        setFunder(f);
      },
      className: "flex-1 p-3 rounded-xl border-2 transition " + (funder === f ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200 hover:border-gray-400')
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-bold"
    }, templates[f]));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border border-indigo-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "font-medium"
  }, lang === "fr" ? "Progression" : "Progress"), /*#__PURE__*/React.createElement("span", {
    className: "font-bold text-indigo-600"
  }, proposal.completionRate, "%")), /*#__PURE__*/React.createElement("div", {
    className: "h-3 bg-white rounded-full"
  }, /*#__PURE__*/React.createElement("div", {
    className: "h-3 bg-indigo-500 rounded-full transition-all",
    style: {
      width: proposal.completionRate + '%'
    }
  }))), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, proposal.sections.map(function (section) {
    var statusIcon = section.status === 'complete' ? 'âœ…' : 'ðŸ“';
    return /*#__PURE__*/React.createElement("details", {
      key: section.id,
      className: "border rounded-xl overflow-hidden"
    }, /*#__PURE__*/React.createElement("summary", {
      className: "p-4 cursor-pointer flex justify-between items-center bg-gray-50 hover:bg-gray-100"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", null, statusIcon), /*#__PURE__*/React.createElement("span", {
      className: "font-medium"
    }, section.title)), /*#__PURE__*/React.createElement("span", {
      className: "text-sm text-gray-500"
    }, section.wordCount, "/", section.maxWords, " ", lang === "fr" ? "mots" : "words")), /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-white"
    }, /*#__PURE__*/React.createElement("textarea", {
      className: "w-full p-3 border rounded-lg text-sm",
      rows: "6",
      defaultValue: section.content,
      placeholder: section.tips
    }), section.tips && /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mt-2"
    }, "\uD83D\uDCA1 ", section.tips)));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    className: "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
  }, lang === "fr" ? "Exporter Word" : "Export Word"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// MONITORING DASHBOARD VIEW
// ============================================
function MonitoringDashboardView(props) {
  var project = props.project;
  var strategies = props.strategies || [];
  var lang = props.lang;
  var onClose = props.onClose;
  var dashboard = MoudarEngine.generateMonitoringDashboard(project, strategies, lang);
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-gradient-to-r from-slate-800 to-slate-900 text-white p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold flex items-center gap-2"
  }, "\uD83D\uDCCA ", lang === "fr" ? "Dashboard Monitoring" : "Monitoring Dashboard"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-slate-300"
  }, lang === "fr" ? "DerniÃ¨re MAJ:" : "Last update:", " ", new Date(dashboard.lastUpdated).toLocaleDateString())), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-slate-700 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6 bg-slate-100"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-4 gap-4 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-white rounded-xl shadow-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-500 mb-1"
  }, lang === "fr" ? "Progression" : "Progress"), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, dashboard.overview.progress, "%"), /*#__PURE__*/React.createElement("div", {
    className: "h-2 bg-gray-200 rounded-full mt-2"
  }, /*#__PURE__*/React.createElement("div", {
    className: "h-2 bg-blue-500 rounded-full",
    style: {
      width: dashboard.overview.progress + '%'
    }
  }))), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-white rounded-xl shadow-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-500 mb-1"
  }, lang === "fr" ? "Budget consommÃ©" : "Budget spent"), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-amber-600"
  }, dashboard.overview.budgetSpent, "%")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-white rounded-xl shadow-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-500 mb-1"
  }, lang === "fr" ? "Jours restants" : "Days remaining"), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-purple-600"
  }, dashboard.overview.daysRemaining)), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-white rounded-xl shadow-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-500 mb-1"
  }, lang === "fr" ? "Phase" : "Phase"), /*#__PURE__*/React.createElement("div", {
    className: "text-xl font-bold text-green-600 capitalize"
  }, dashboard.overview.phase))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-4 gap-4 mb-6"
  }, Object.values(dashboard.indicators).map(function (ind) {
    var isOnTrack = ind.value >= ind.target;
    return /*#__PURE__*/React.createElement("div", {
      key: ind.label,
      className: "p-4 rounded-xl border-2 " + (isOnTrack ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200')
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-sm text-gray-600"
    }, ind.label), /*#__PURE__*/React.createElement("div", {
      className: "flex items-end gap-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-2xl font-bold " + (isOnTrack ? 'text-green-600' : 'text-amber-600')
    }, ind.value), /*#__PURE__*/React.createElement("span", {
      className: "text-gray-500"
    }, ind.unit)), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, lang === "fr" ? "Cible:" : "Target:", " ", ind.target, ind.unit));
  })), dashboard.predictiveAlerts.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-red-50 rounded-xl border border-red-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-red-800 mb-3"
  }, "\uD83D\uDD2E ", lang === "fr" ? "Alertes prÃ©dictives" : "Predictive alerts"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, dashboard.predictiveAlerts.map(function (alert, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "flex items-start gap-3 text-sm"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 rounded text-xs font-medium " + (alert.severity === 'high' ? 'bg-red-200 text-red-800' : 'bg-amber-200 text-amber-800')
    }, alert.severity), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("p", {
      className: "text-gray-700"
    }, alert.message), /*#__PURE__*/React.createElement("p", {
      className: "text-blue-600 text-xs"
    }, "\uD83D\uDCA1 ", alert.recommendation)));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white p-4 rounded-xl shadow-sm"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, lang === "fr" ? "Jalons" : "Milestones"), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2"
  }, dashboard.timeline.milestones.map(function (m, i) {
    var statusColor = m.status === 'completed' ? 'bg-green-500' : m.status === 'in-progress' ? 'bg-blue-500' : 'bg-gray-300';
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "flex-1 text-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "w-4 h-4 rounded-full mx-auto mb-1 " + statusColor
    }), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, m.date), /*#__PURE__*/React.createElement("div", {
      className: "text-xs font-medium"
    }, m.label));
  })))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// LOGIC MODEL VIEW
// ============================================
function LogicModelView(props) {
  var project = props.project;
  var strategies = props.strategies || [];
  var lang = props.lang;
  var onClose = props.onClose;
  var model = MoudarEngine.generateLogicModel(project, strategies, lang);
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDD04 ", lang === "fr" ? "ModÃ¨le Logique" : "Logic Model"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Inputs â†’ ActivitÃ©s â†’ Outputs â†’ Outcomes â†’ Impact" : "Inputs â†’ Activities â†’ Outputs â†’ Outcomes â†’ Impact")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 overflow-x-auto pb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "min-w-48 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-blue-800 mb-3 text-center"
  }, "INPUTS"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, model.inputs.map(function (input) {
    return /*#__PURE__*/React.createElement("div", {
      key: input.id,
      className: "p-2 bg-white rounded text-sm"
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-medium"
    }, input.label), /*#__PURE__*/React.createElement("div", {
      className: "text-blue-600"
    }, input.value));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center text-3xl text-gray-400"
  }, "\u2192"), /*#__PURE__*/React.createElement("div", {
    className: "min-w-48 p-4 bg-purple-50 rounded-xl border border-purple-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-purple-800 mb-3 text-center"
  }, lang === "fr" ? "ACTIVITÃ‰S" : "ACTIVITIES"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, model.activities.map(function (act) {
    return /*#__PURE__*/React.createElement("div", {
      key: act.id,
      className: "p-2 bg-white rounded text-sm"
    }, act.label);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center text-3xl text-gray-400"
  }, "\u2192"), /*#__PURE__*/React.createElement("div", {
    className: "min-w-48 p-4 bg-green-50 rounded-xl border border-green-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-green-800 mb-3 text-center"
  }, "OUTPUTS"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, model.outputs.map(function (output) {
    return /*#__PURE__*/React.createElement("div", {
      key: output.id,
      className: "p-2 bg-white rounded text-sm"
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-medium"
    }, output.label), /*#__PURE__*/React.createElement("div", {
      className: "text-green-600"
    }, output.target));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center text-3xl text-gray-400"
  }, "\u2192"), /*#__PURE__*/React.createElement("div", {
    className: "min-w-56 p-4 bg-amber-50 rounded-xl border border-amber-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-amber-800 mb-3 text-center"
  }, "OUTCOMES"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xs font-medium text-amber-600 mb-1"
  }, lang === "fr" ? "Court terme" : "Short term"), model.outcomes.shortTerm.map(function (o) {
    return /*#__PURE__*/React.createElement("div", {
      key: o.id,
      className: "p-1 bg-white rounded text-xs mb-1"
    }, o.label);
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xs font-medium text-amber-600 mb-1"
  }, lang === "fr" ? "Moyen terme" : "Medium term"), model.outcomes.mediumTerm.map(function (o) {
    return /*#__PURE__*/React.createElement("div", {
      key: o.id,
      className: "p-1 bg-white rounded text-xs mb-1"
    }, o.label);
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xs font-medium text-amber-600 mb-1"
  }, lang === "fr" ? "Long terme" : "Long term"), model.outcomes.longTerm.map(function (o) {
    return /*#__PURE__*/React.createElement("div", {
      key: o.id,
      className: "p-1 bg-white rounded text-xs mb-1"
    }, o.label);
  })))), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center text-3xl text-gray-400"
  }, "\u2192"), /*#__PURE__*/React.createElement("div", {
    className: "min-w-48 p-4 bg-red-50 rounded-xl border border-red-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-red-800 mb-3 text-center"
  }, "IMPACT"), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-white rounded text-sm text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl mb-2"
  }, "\uD83C\uDFAF"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-700"
  }, model.impact.statement)))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4 mt-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gray-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-700 mb-2"
  }, lang === "fr" ? "HypothÃ¨ses" : "Assumptions"), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-gray-600 space-y-1"
  }, model.assumptions.map(function (a, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i
    }, "\u2022 ", a);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gray-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-700 mb-2"
  }, lang === "fr" ? "Facteurs externes" : "External factors"), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-gray-600 space-y-1"
  }, model.externalFactors.map(function (f, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i
    }, "\u2022 ", f);
  }))))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// MONTE CARLO SIMULATION VIEW
// ============================================
function MonteCarloView(props) {
  var project = props.project;
  var strategies = props.strategies || [];
  var lang = props.lang;
  var onClose = props.onClose;
  var simulation = MoudarEngine.runMonteCarloSimulation(project, strategies, 10000, lang);
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold flex items-center gap-2"
  }, "\uD83C\uDFB2 ", lang === "fr" ? "Simulation Monte Carlo (heuristique)" : "Monte Carlo Simulation (heuristic)"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-indigo-200"
  }, simulation.iterations.toLocaleString(), lang === "fr" ? " iterations â€” Randomisation d'un modele heuristique, non calibre sur donnees empiriques" : " iterations â€” Randomized heuristic model, not calibrated on empirical data")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-indigo-500 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center p-6 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl border border-indigo-200 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-6xl font-bold text-indigo-700 mb-2"
  }, simulation.statistics.median, "%"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "ProbabilitÃ© de succÃ¨s mÃ©diane" : "Median success probability"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mt-2"
  }, simulation.interpretation)), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-5 gap-4 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-gray-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-gray-700"
  }, simulation.statistics.mean, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Moyenne" : "Mean")), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-gray-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-gray-700"
  }, simulation.statistics.stdDev, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Ã‰cart-type" : "Std Dev")), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-gray-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-gray-700"
  }, simulation.statistics.min, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, "Min")), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-gray-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-gray-700"
  }, simulation.statistics.max, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, "Max")), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-gray-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-gray-700"
  }, simulation.percentiles.p50, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, "P50"))), /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-blue-800 mb-3"
  }, lang === "fr" ? "Intervalles de confiance" : "Confidence intervals"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between text-sm mb-1"
  }, /*#__PURE__*/React.createElement("span", null, "IC 90%"), /*#__PURE__*/React.createElement("span", {
    className: "font-medium"
  }, simulation.confidenceIntervals.ci90.lower, "% - ", simulation.confidenceIntervals.ci90.upper, "%")), /*#__PURE__*/React.createElement("div", {
    className: "h-4 bg-gray-200 rounded-full relative"
  }, /*#__PURE__*/React.createElement("div", {
    className: "absolute h-4 bg-blue-400 rounded-full",
    style: {
      left: simulation.confidenceIntervals.ci90.lower + '%',
      width: simulation.confidenceIntervals.ci90.upper - simulation.confidenceIntervals.ci90.lower + '%'
    }
  }))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between text-sm mb-1"
  }, /*#__PURE__*/React.createElement("span", null, "IC 50%"), /*#__PURE__*/React.createElement("span", {
    className: "font-medium"
  }, simulation.confidenceIntervals.ci50.lower, "% - ", simulation.confidenceIntervals.ci50.upper, "%")), /*#__PURE__*/React.createElement("div", {
    className: "h-4 bg-gray-200 rounded-full relative"
  }, /*#__PURE__*/React.createElement("div", {
    className: "absolute h-4 bg-blue-600 rounded-full",
    style: {
      left: simulation.confidenceIntervals.ci50.lower + '%',
      width: simulation.confidenceIntervals.ci50.upper - simulation.confidenceIntervals.ci50.lower + '%'
    }
  }))))), /*#__PURE__*/React.createElement("div", {
    className: "p-4 border rounded-xl"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, lang === "fr" ? "Distribution des rÃ©sultats" : "Results distribution"), /*#__PURE__*/React.createElement("div", {
    className: "flex items-end gap-1 h-32"
  }, simulation.histogram.filter(function (h, i) {
    return i % 2 === 0;
  }).map(function (h, i) {
    var height = Math.min(100, parseFloat(h.percentage) * 3);
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "flex-1 bg-indigo-500 rounded-t",
      style: {
        height: height + '%'
      },
      title: h.range + ': ' + h.percentage + '%'
    });
  })), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between text-xs text-gray-500 mt-1"
  }, /*#__PURE__*/React.createElement("span", null, "0%"), /*#__PURE__*/React.createElement("span", null, "50%"), /*#__PURE__*/React.createElement("span", null, "100%"))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 grid md:grid-cols-2 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 rounded-xl " + (simulation.riskAssessment.probabilityBelow50 > 30 ? 'bg-red-50 border border-red-200' : 'bg-green-50 border border-green-200')
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, simulation.riskAssessment.probabilityBelow50, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "ProbabilitÃ© d'Ã©chec (<50%)" : "Failure probability (<50%)")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 rounded-xl " + (simulation.riskAssessment.probabilityAbove70 > 50 ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200')
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, simulation.riskAssessment.probabilityAbove70, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "ProbabilitÃ© de succÃ¨s (>70%)" : "Success probability (>70%)")))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// NLP BARRIER ANALYZER VIEW
// ============================================
function NLPBarrierAnalyzerView(props) {
  var project = props.project;
  var lang = props.lang;
  var onClose = props.onClose;
  var textState = useState(project.barriers || project.context || '');
  var text = textState[0];
  var setText = textState[1];
  var analysisState = useState(null);
  var analysis = analysisState[0];
  var setAnalysis = analysisState[1];
  function runAnalysis() {
    var result = MoudarEngine.analyzeBarriersNLP(text, lang);
    setAnalysis(result);
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-white border-b p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83E\uDDE0 ", lang === "fr" ? "Analyseur NLP des BarriÃ¨res" : "NLP Barrier Analyzer"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, lang === "fr" ? "Intelligence artificielle pour dÃ©tecter les barriÃ¨res" : "AI to detect barriers")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-gray-100 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-4"
  }, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm font-medium text-gray-700 mb-2"
  }, lang === "fr" ? "Texte Ã  analyser (contexte, barriÃ¨res, dÃ©fis...)" : "Text to analyze (context, barriers, challenges...)"), /*#__PURE__*/React.createElement("textarea", {
    className: "w-full p-4 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none",
    rows: "6",
    value: text,
    onChange: function (e) {
      setText(e.target.value);
    },
    placeholder: lang === "fr" ? "Collez ou tapez le texte dÃ©crivant votre contexte et les dÃ©fis anticipÃ©s..." : "Paste or type text describing your context and anticipated challenges..."
  }), /*#__PURE__*/React.createElement("button", {
    onClick: runAnalysis,
    className: "mt-3 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition"
  }, "\uD83D\uDD0D ", lang === "fr" ? "Analyser" : "Analyze")), analysis && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gradient-to-r from-red-50 to-orange-50 rounded-xl border border-red-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-red-800 mb-3"
  }, "\u26A0\uFE0F ", lang === "fr" ? "BarriÃ¨res dÃ©tectÃ©es" : "Detected barriers", " (", analysis.barriers.length, ")"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, analysis.topBarriers.map(function (barrier, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-3 bg-white rounded-lg"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-center mb-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-gray-800"
    }, barrier.label), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 rounded text-xs " + (barrier.confidence === 'high' ? 'bg-red-100 text-red-700' : 'bg-amber-100 text-amber-700')
    }, barrier.score, "% ", barrier.confidence)), /*#__PURE__*/React.createElement("div", {
      className: "flex flex-wrap gap-1"
    }, barrier.keywords.map(function (kw, j) {
      return /*#__PURE__*/React.createElement("span", {
        key: j,
        className: "px-2 py-0.5 bg-gray-100 rounded text-xs"
      }, kw);
    })));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-green-50 rounded-xl border border-green-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-green-800 mb-3"
  }, "\uD83D\uDCA1 ", lang === "fr" ? "StratÃ©gies recommandÃ©es" : "Recommended strategies"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, analysis.recommendations.map(function (rec, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "flex items-center gap-3 p-2 bg-white rounded"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 bg-green-100 text-green-700 rounded font-mono text-sm"
    }, rec.strategyId), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "font-medium"
    }, rec.strategyName), /*#__PURE__*/React.createElement("span", {
      className: "text-gray-500 text-sm ml-2"
    }, rec.reason)));
  }))))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// POWERPOINT GENERATOR VIEW
// ============================================
function PowerPointGeneratorView(props) {
  var project = props.project;
  var protocol = props.protocol;
  var lang = props.lang;
  var onClose = props.onClose;
  var pptData = MoudarEngine.generatePowerPointData(project, protocol, lang);
  var selectedSlideState = useState(0);
  var selectedSlide = selectedSlideState[0];
  var setSelectedSlide = selectedSlideState[1];
  var currentSlide = pptData.slides[selectedSlide];
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-gradient-to-r from-orange-500 to-red-500 text-white p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold flex items-center gap-2"
  }, "\uD83D\uDCCA ", lang === "fr" ? "GÃ©nÃ©rateur PowerPoint" : "PowerPoint Generator"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-orange-100"
  }, pptData.slideCount, " slides")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-orange-400 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "flex"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-48 bg-gray-100 p-3 border-r overflow-y-auto max-h-[70vh]"
  }, pptData.slides.map(function (slide, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      onClick: function () {
        setSelectedSlide(i);
      },
      className: "p-2 mb-2 rounded cursor-pointer text-xs " + (selectedSlide === i ? 'bg-orange-500 text-white' : 'bg-white hover:bg-gray-200')
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-bold"
    }, i + 1, ". ", slide.type), /*#__PURE__*/React.createElement("div", {
      className: "truncate"
    }, slide.title));
  })), /*#__PURE__*/React.createElement("div", {
    className: "flex-1 p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "aspect-video bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl p-8 text-white shadow-xl"
  }, currentSlide.type === 'title' && /*#__PURE__*/React.createElement("div", {
    className: "h-full flex flex-col items-center justify-center text-center"
  }, /*#__PURE__*/React.createElement("h1", {
    className: "text-3xl font-bold mb-4"
  }, currentSlide.title), /*#__PURE__*/React.createElement("p", {
    className: "text-xl text-slate-300"
  }, currentSlide.subtitle), /*#__PURE__*/React.createElement("p", {
    className: "absolute bottom-4 text-xs text-slate-600"
  }, currentSlide.footer)), currentSlide.type === 'agenda' && /*#__PURE__*/React.createElement("div", {
    className: "h-full"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold mb-6"
  }, currentSlide.title), /*#__PURE__*/React.createElement("ol", {
    className: "space-y-3"
  }, currentSlide.items.map(function (item, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i,
      className: "flex items-center gap-3"
    }, /*#__PURE__*/React.createElement("span", {
      className: "w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center font-bold"
    }, i + 1), /*#__PURE__*/React.createElement("span", null, item));
  }))), currentSlide.type === 'content' && /*#__PURE__*/React.createElement("div", {
    className: "h-full"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold mb-4"
  }, currentSlide.title), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-300 mb-4"
  }, currentSlide.content), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, currentSlide.keyPoints && currentSlide.keyPoints.map(function (kp, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", null, kp.icon), /*#__PURE__*/React.createElement("span", null, kp.text));
  }))), currentSlide.type === 'strategies' && /*#__PURE__*/React.createElement("div", {
    className: "h-full"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold mb-2"
  }, currentSlide.title), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-slate-400 mb-4"
  }, currentSlide.subtitle), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, currentSlide.strategies && currentSlide.strategies.map(function (s) {
    return /*#__PURE__*/React.createElement("div", {
      key: s.number,
      className: "flex items-center gap-3 p-2 bg-white/10 rounded"
    }, /*#__PURE__*/React.createElement("span", {
      className: "w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center font-bold"
    }, s.number), /*#__PURE__*/React.createElement("span", null, s.label));
  }))), currentSlide.type === 'prediction' && /*#__PURE__*/React.createElement("div", {
    className: "h-full text-center"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold mb-4"
  }, currentSlide.title), /*#__PURE__*/React.createElement("div", {
    className: "text-6xl font-bold text-green-400 mb-4"
  }, currentSlide.probability, "%"), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-3 gap-2"
  }, currentSlide.factors && currentSlide.factors.map(function (f, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-2 rounded " + (f.type === 'positive' ? 'bg-green-500/20' : 'bg-red-500/20')
    }, /*#__PURE__*/React.createElement("div", {
      className: f.type === 'positive' ? 'text-green-400' : 'text-red-400'
    }, f.impact), /*#__PURE__*/React.createElement("div", {
      className: "text-xs"
    }, f.label));
  }))), currentSlide.type === 'budget' && /*#__PURE__*/React.createElement("div", {
    className: "h-full"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold mb-4"
  }, currentSlide.title), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-3 gap-4 mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center p-3 bg-white/10 rounded"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-green-400"
  }, currentSlide.totalBudget), /*#__PURE__*/React.createElement("div", {
    className: "text-xs"
  }, "Total")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-3 bg-white/10 rounded"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-blue-400"
  }, currentSlide.roi), /*#__PURE__*/React.createElement("div", {
    className: "text-xs"
  }, "ROI")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-3 bg-white/10 rounded"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-purple-400"
  }, currentSlide.payback), /*#__PURE__*/React.createElement("div", {
    className: "text-xs"
  }, "Payback")))), currentSlide.type === 'closing' && /*#__PURE__*/React.createElement("div", {
    className: "h-full flex flex-col items-center justify-center text-center"
  }, /*#__PURE__*/React.createElement("h1", {
    className: "text-4xl font-bold mb-4"
  }, currentSlide.title), /*#__PURE__*/React.createElement("p", {
    className: "text-xl text-slate-300 mb-6"
  }, currentSlide.contact), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-slate-600"
  }, currentSlide.tagline))), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mt-4"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setSelectedSlide(Math.max(0, selectedSlide - 1));
    },
    disabled: selectedSlide === 0,
    className: "px-4 py-2 bg-gray-200 rounded disabled:opacity-50"
  }, "\u2190 ", lang === "fr" ? "PrÃ©cÃ©dent" : "Previous"), /*#__PURE__*/React.createElement("span", {
    className: "text-gray-500"
  }, selectedSlide + 1, " / ", pptData.slideCount), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setSelectedSlide(Math.min(pptData.slideCount - 1, selectedSlide + 1));
    },
    disabled: selectedSlide === pptData.slideCount - 1,
    className: "px-4 py-2 bg-gray-200 rounded disabled:opacity-50"
  }, lang === "fr" ? "Suivant" : "Next", " \u2192")))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    className: "px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700"
  }, "\uD83D\uDCE5 ", lang === "fr" ? "TÃ©lÃ©charger PPTX" : "Download PPTX"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// v8.0 VIEWS - API + COMMUNITY + INTEGRATIONS
// ============================================

// ============================================
// API DOCUMENTATION VIEW
// ============================================
function APIDocumentationView(props) {
  var lang = props.lang;
  var onClose = props.onClose;
  var docs = MoudarEngine.getAPIDocumentation(lang);
  var sdk = MoudarEngine.getSDK();
  var curl = MoudarEngine.getCurlExamples();
  var tabState = useState('endpoints');
  var tab = tabState[0];
  var setTab = tabState[1];
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-gradient-to-r from-slate-800 to-slate-900 text-white p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold flex items-center gap-2"
  }, "\uD83D\uDD0C API Moudar v", docs.version), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-slate-300"
  }, docs.baseUrl)), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-slate-700 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 mb-6 border-b"
  }, ['endpoints', 'sdk', 'curl'].map(function (t) {
    return /*#__PURE__*/React.createElement("button", {
      key: t,
      onClick: function () {
        setTab(t);
      },
      className: "px-4 py-2 font-medium " + (tab === t ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-500')
    }, t === 'endpoints' ? 'ðŸ“š Endpoints' : t === 'sdk' ? 'ðŸ’» SDK' : 'ðŸ–¥ï¸ cURL');
  })), tab === 'endpoints' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-blue-800 mb-2"
  }, "\uD83D\uDD10 Authentication"), /*#__PURE__*/React.createElement("code", {
    className: "text-sm bg-white p-2 rounded block"
  }, docs.authentication.header)), docs.categories.map(function (cat) {
    return /*#__PURE__*/React.createElement("div", {
      key: cat.name,
      className: "border rounded-xl overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "bg-gray-100 p-3 font-bold capitalize"
    }, cat.name), /*#__PURE__*/React.createElement("div", {
      className: "divide-y"
    }, cat.endpoints.map(function (ep) {
      var methodColor = ep.method === 'GET' ? 'bg-green-100 text-green-700' : ep.method === 'POST' ? 'bg-blue-100 text-blue-700' : ep.method === 'PUT' ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700';
      return /*#__PURE__*/React.createElement("div", {
        key: ep.name,
        className: "p-3 flex items-center gap-3"
      }, /*#__PURE__*/React.createElement("span", {
        className: "px-2 py-1 rounded text-xs font-bold " + methodColor
      }, ep.method), /*#__PURE__*/React.createElement("code", {
        className: "text-sm flex-1"
      }, ep.path), /*#__PURE__*/React.createElement("span", {
        className: "text-gray-500 text-sm"
      }, ep.description));
    })));
  })), tab === 'sdk' && /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-slate-900 rounded-xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-green-400 font-bold"
  }, "JavaScript SDK"), /*#__PURE__*/React.createElement("button", {
    className: "px-3 py-1 bg-blue-600 text-white rounded text-sm"
  }, "\uD83D\uDCCB Copy")), /*#__PURE__*/React.createElement("pre", {
    className: "text-green-300 text-sm overflow-x-auto whitespace-pre-wrap"
  }, sdk)), tab === 'curl' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, Object.keys(curl).map(function (key) {
    return /*#__PURE__*/React.createElement("div", {
      key: key,
      className: "p-4 bg-slate-900 rounded-xl"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-gray-400 text-sm mb-2 capitalize"
    }, key), /*#__PURE__*/React.createElement("pre", {
      className: "text-green-300 text-sm overflow-x-auto"
    }, curl[key]));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 rounded-lg"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// COMMUNITY HUB VIEW
// ============================================
function CommunityHubView(props) {
  var project = props.project;
  var lang = props.lang;
  var onClose = props.onClose;
  var tabState = useState('benchmarks');
  var tab = tabState[0];
  var setTab = tabState[1];
  var filterState = useState({
    domain: project.domain || null
  });
  var filter = filterState[0];
  var setFilter = filterState[1];
  var benchmarks = MoudarEngine.getBenchmarks(filter, lang);
  var leaderboard = MoudarEngine.getLeaderboard(lang);
  var similarProjects = MoudarEngine.getSimilarCommunityProjects(project);
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold flex items-center gap-2"
  }, "\uD83C\uDF0D ", lang === "fr" ? "CommunautÃ© Mondiale SMOA" : "Global SMOA Community"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-purple-200"
  }, benchmarks.global.totalProjects.toLocaleString(), " ", lang === "fr" ? "projets dans" : "projects in", " ", benchmarks.global.totalCountries, " ", lang === "fr" ? "pays" : "countries")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-purple-500 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 mb-6 border-b"
  }, ['benchmarks', 'projects', 'leaderboard'].map(function (t) {
    var labels = {
      benchmarks: 'ðŸ“Š Benchmarks',
      projects: 'ðŸ“‚ ' + (lang === 'fr' ? 'Projets' : 'Projects'),
      leaderboard: 'ðŸ† Leaderboard'
    };
    return /*#__PURE__*/React.createElement("button", {
      key: t,
      onClick: function () {
        setTab(t);
      },
      className: "px-4 py-2 font-medium " + (tab === t ? 'border-b-2 border-purple-500 text-purple-600' : 'text-gray-500')
    }, labels[t]);
  })), tab === 'benchmarks' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-4 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-600"
  }, benchmarks.global.avgSuccessRate, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Taux succÃ¨s moyen" : "Avg success rate")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-green-600"
  }, benchmarks.global.avgAdoptionRate, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Taux adoption moyen" : "Avg adoption rate")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gradient-to-br from-purple-50 to-violet-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-purple-600"
  }, benchmarks.global.totalProjects.toLocaleString()), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Projets" : "Projects")), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gradient-to-br from-amber-50 to-yellow-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-amber-600"
  }, benchmarks.global.totalBeneficiaries), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "BÃ©nÃ©ficiaires" : "Beneficiaries"))), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3"
  }, /*#__PURE__*/React.createElement("select", {
    onChange: function (e) {
      setFilter({
        domain: e.target.value || null
      });
    },
    className: "p-2 border rounded-lg"
  }, /*#__PURE__*/React.createElement("option", {
    value: ""
  }, lang === "fr" ? "Tous domaines" : "All domains"), /*#__PURE__*/React.createElement("option", {
    value: "mental_health"
  }, lang === "fr" ? "SantÃ© mentale" : "Mental health"), /*#__PURE__*/React.createElement("option", {
    value: "primary_care"
  }, lang === "fr" ? "Soins primaires" : "Primary care"), /*#__PURE__*/React.createElement("option", {
    value: "chronic_disease"
  }, lang === "fr" ? "Maladies chroniques" : "Chronic diseases"), /*#__PURE__*/React.createElement("option", {
    value: "maternal_child"
  }, lang === "fr" ? "SantÃ© maternelle" : "Maternal health"))), benchmarks.filtered && /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-indigo-50 rounded-xl border border-indigo-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-indigo-800 mb-3"
  }, lang === "fr" ? "Benchmarks filtrÃ©s" : "Filtered benchmarks"), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-3 gap-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-indigo-600"
  }, benchmarks.filtered.avgSuccessRate || benchmarks.filtered.avgSuccess, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "SuccÃ¨s moyen" : "Avg success")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-indigo-600"
  }, benchmarks.filtered.totalProjects || benchmarks.filtered.projects), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Projets" : "Projects")), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-indigo-600"
  }, benchmarks.filtered.countries || '-'), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Pays" : "Countries"))), benchmarks.filtered.topStrategies && /*#__PURE__*/React.createElement("div", {
    className: "mt-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-sm text-gray-600"
  }, lang === "fr" ? "Top stratÃ©gies:" : "Top strategies:"), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 mt-1"
  }, benchmarks.filtered.topStrategies.map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s,
      className: "px-2 py-1 bg-white rounded text-sm font-mono"
    }, s);
  }))))), tab === 'projects' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, lang === "fr" ? "Projets similaires partagÃ©s par la communautÃ©:" : "Similar projects shared by the community:"), similarProjects.map(function (p) {
    return /*#__PURE__*/React.createElement("div", {
      key: p.id,
      className: "p-4 border rounded-xl hover:shadow-md transition"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs"
    }, p.domain), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs ml-2"
    }, p.region)), /*#__PURE__*/React.createElement("div", {
      className: "text-right"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl font-bold text-green-600"
    }, p.successRate, "%"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, p.views, " views"))));
  }), /*#__PURE__*/React.createElement("button", {
    className: "w-full p-3 border-2 border-dashed border-purple-300 rounded-xl text-purple-600 hover:bg-purple-50 transition"
  }, "\u2795 ", lang === "fr" ? "Partager votre projet" : "Share your project")), tab === 'leaderboard' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, leaderboard.topContributors.map(function (c) {
    return /*#__PURE__*/React.createElement("div", {
      key: c.rank,
      className: "p-4 rounded-xl flex items-center gap-4 " + (c.rank === 1 ? 'bg-gradient-to-r from-yellow-100 to-amber-100 border-2 border-yellow-300' : 'bg-gray-50')
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl font-bold text-gray-400"
    }, "#", c.rank), /*#__PURE__*/React.createElement("div", {
      className: "text-2xl"
    }, c.country), /*#__PURE__*/React.createElement("div", {
      className: "flex-1"
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-bold"
    }, c.name), /*#__PURE__*/React.createElement("div", {
      className: "text-sm text-gray-500"
    }, c.projects, " ", lang === "fr" ? "projets" : "projects")), /*#__PURE__*/React.createElement("div", {
      className: "text-xl font-bold text-purple-600"
    }, c.points.toLocaleString(), " pts"));
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold mb-3"
  }, "\uD83C\uDFC5 Badges"), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3"
  }, leaderboard.badges.map(function (b) {
    return /*#__PURE__*/React.createElement("div", {
      key: b.id,
      className: "p-3 bg-gray-100 rounded-xl text-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl"
    }, b.icon), /*#__PURE__*/React.createElement("div", {
      className: "text-xs font-medium"
    }, b.name ? b.name[lang] : b.id));
  }))))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 rounded-lg"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// DATA INTEGRATIONS VIEW
// ============================================
function DataIntegrationsView(props) {
  var project = props.project;
  var protocol = props.protocol;
  var lang = props.lang;
  var onClose = props.onClose;
  var integrations = MoudarEngine.getIntegrations();
  var selectedState = useState(null);
  var selected = selectedState[0];
  var setSelected = selectedState[1];
  var configState = useState({});
  var config = configState[0];
  var setConfig = configState[1];
  var testResultState = useState(null);
  var testResult = testResultState[0];
  var setTestResult = testResultState[1];
  var generatedFormState = useState(null);
  var generatedForm = generatedFormState[0];
  var setGeneratedForm = generatedFormState[1];
  function handleTest() {
    var result = MoudarEngine.testIntegration(selected, config, lang);
    setTestResult(result);
  }
  function handleGenerateForm(type) {
    var form = type === 'redcap' ? MoudarEngine.generateRedcapForm(project, protocol, lang) : MoudarEngine.generateOdkForm(project, protocol, lang);
    setGeneratedForm({
      type: type,
      data: form
    });
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "sticky top-0 bg-gradient-to-r from-teal-600 to-cyan-600 text-white p-4 flex justify-between items-center z-10"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold flex items-center gap-2"
  }, "\uD83D\uDD17 ", lang === "fr" ? "IntÃ©grations DonnÃ©es" : "Data Integrations"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-teal-200"
  }, "REDCap \u2022 ODK \u2022 DHIS2 \u2022 KoboToolbox")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-teal-500 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-5 gap-4 mb-6"
  }, Object.values(integrations).map(function (i) {
    var isSelected = selected === i.id;
    var isAvailable = i.status === 'available';
    return /*#__PURE__*/React.createElement("button", {
      key: i.id,
      onClick: function () {
        if (isAvailable) {
          setSelected(i.id);
          setTestResult(null);
          setGeneratedForm(null);
        }
      },
      disabled: !isAvailable,
      className: "p-4 rounded-xl border-2 transition text-center " + (isSelected ? 'border-teal-500 bg-teal-50' : isAvailable ? 'border-gray-200 hover:border-gray-400' : 'border-gray-100 opacity-50')
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, i.logo), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-sm"
    }, i.name), !isAvailable && /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-400"
    }, lang === 'fr' ? 'BientÃ´t' : 'Coming'));
  })), selected && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gray-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold mb-3"
  }, lang === "fr" ? "Configuration" : "Configuration", " ", integrations[selected].name), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-4"
  }, integrations[selected].desc[lang]), MoudarEngine.getIntegrationConfig(selected, lang).fields.map(function (field) {
    return /*#__PURE__*/React.createElement("div", {
      key: field.id,
      className: "mb-3"
    }, /*#__PURE__*/React.createElement("label", {
      className: "block text-sm font-medium mb-1"
    }, field.label[lang] || field.label), /*#__PURE__*/React.createElement("input", {
      type: field.type,
      className: "w-full p-2 border rounded-lg",
      value: config[field.id] || '',
      onChange: function (e) {
        var newConfig = Object.assign({}, config);
        newConfig[field.id] = e.target.value;
        setConfig(newConfig);
      }
    }));
  }), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3 mt-4"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: handleTest,
    className: "px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700"
  }, "\uD83D\uDD0D ", lang === "fr" ? "Tester connexion" : "Test connection"), (selected === 'redcap' || selected === 'odk') && /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      handleGenerateForm(selected);
    },
    className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
  }, "\uD83D\uDCDD ", lang === "fr" ? "GÃ©nÃ©rer formulaire" : "Generate form"))), testResult && /*#__PURE__*/React.createElement("div", {
    className: "p-4 rounded-xl " + (testResult.success ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200')
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-xl"
  }, testResult.success ? 'âœ…' : 'âŒ'), /*#__PURE__*/React.createElement("span", {
    className: "font-medium"
  }, testResult.message)), testResult.details && /*#__PURE__*/React.createElement("div", {
    className: "mt-2 text-sm text-gray-600"
  }, "Version: ", testResult.details.version, " \u2022 ", testResult.details.projects, " ", lang === 'fr' ? 'projets trouvÃ©s' : 'projects found')), generatedForm && /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-blue-800 mb-2"
  }, "\uD83D\uDCCB ", generatedForm.type === 'redcap' ? 'REDCap Data Dictionary' : 'ODK XLSForm', " ", lang === 'fr' ? 'gÃ©nÃ©rÃ©' : 'generated'), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600 mb-3"
  }, generatedForm.data.instruments ? generatedForm.data.instruments.length + ' instruments' : '', generatedForm.data.events ? ' â€¢ ' + generatedForm.data.events.length + ' events' : '', generatedForm.data.form && generatedForm.data.form.survey ? ' â€¢ ' + generatedForm.data.form.survey.length + ' questions' : ''), /*#__PURE__*/React.createElement("button", {
    className: "px-4 py-2 bg-blue-600 text-white rounded-lg"
  }, "\uD83D\uDCE5 ", lang === "fr" ? "TÃ©lÃ©charger" : "Download", " ", generatedForm.type === 'redcap' ? 'XML' : 'XLSForm')))), /*#__PURE__*/React.createElement("div", {
    className: "sticky bottom-0 bg-white border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 rounded-lg"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VUES v8.0 - WORLD REFERENCE PLATFORM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// VUE XAI - Explainable AI
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function XAIExplainerView(props) {
  var onClose = props.onClose;
  var lang = props.lang;
  var protocol = props.protocol;
  var answers = props.answers;

  // Construction directe du rapport XAI Ã  partir des donnÃ©es du protocole
  var kg = {};
  try {
    kg = MoudarEngine.getKnowledgeGraph().nodes || {};
  } catch (e) {
    console.warn("[XAI] KnowledgeGraph non disponible:", e);
    kg = {
      strategies: {}
    };
  }
  var l = lang || 'fr';
  console.log("[XAI] Protocol reÃ§u:", protocol);
  console.log("[XAI] Protocol.strategies:", protocol ? protocol.strategies : "null");
  console.log("[XAI] Protocol.aiRawRecommendations:", protocol ? protocol.aiRawRecommendations : "null");

  // RÃ©cupÃ©rer les stratÃ©gies depuis le protocole
  var strategies = [];

  // Source 1: aiRawRecommendations.strategies.top (format enrichi avec id, label, confidence)
  if (protocol && protocol.aiRawRecommendations && protocol.aiRawRecommendations.strategies && protocol.aiRawRecommendations.strategies.top && protocol.aiRawRecommendations.strategies.top.length > 0) {
    console.log("[XAI] Utilisation de aiRawRecommendations.strategies.top");
    strategies = protocol.aiRawRecommendations.strategies.top.slice(0, 5).map(function (strat) {
      return {
        id: strat.id,
        label: strat.label || {
          fr: strat.name,
          en: strat.name
        },
        confidence: strat.confidence || strat.score / 3 || 0.7
      };
    });
  }
  // Source 2: protocol.strategies (tableau de strings - labels traduits)
  else if (protocol && protocol.strategies && protocol.strategies.length > 0) {
    console.log("[XAI] Utilisation de protocol.strategies (strings)");
    strategies = protocol.strategies.slice(0, 5).map(function (stratName, idx) {
      // Chercher la stratÃ©gie dans le KG par son label
      var foundStrat = null;
      var foundId = null;
      Object.keys(kg.strategies || {}).forEach(function (sid) {
        var strat = kg.strategies[sid];
        if (strat && strat.label) {
          if (strat.label.fr === stratName || strat.label.en === stratName) {
            foundStrat = strat;
            foundId = sid;
          } else if (stratName.length >= 10 && (strat.label.fr.indexOf(stratName.substring(0, 10)) !== -1 || stratName.indexOf(strat.label.fr.substring(0, 10)) !== -1)) {
            foundStrat = strat;
            foundId = sid;
          }
        }
      });
      return {
        id: foundId || 'S0' + (idx + 1),
        label: foundStrat ? foundStrat.label : {
          fr: stratName,
          en: stratName
        },
        confidence: 0.85 - idx * 0.05
      };
    });
  }

  // Si toujours pas de stratÃ©gies, utiliser des valeurs par dÃ©faut contextuelles
  if (strategies.length === 0) {
    console.log("[XAI] Utilisation des stratÃ©gies par dÃ©faut");
    var defaultIds = ['S01', 'S03', 'S04', 'S08', 'S02'];
    strategies = defaultIds.map(function (sid, idx) {
      var strat = kg.strategies && kg.strategies[sid];
      return {
        id: sid,
        label: strat ? strat.label : {
          fr: 'StratÃ©gie ' + sid,
          en: 'Strategy ' + sid
        },
        confidence: 0.85 - idx * 0.05
      };
    });
  }
  console.log("[XAI] StratÃ©gies finales:", strategies);

  // Contexte enrichi - s'assurer que barriers est un tableau
  var rawBarriers = protocol && protocol.aiDetectedBarriers || [];
  if (typeof rawBarriers === 'string') {
    rawBarriers = rawBarriers.split(/[,;\n]/).map(function (b) {
      return b.trim();
    }).filter(function (b) {
      return b.length > 0;
    });
  }
  if (!Array.isArray(rawBarriers)) {
    rawBarriers = [];
  }
  var context = {
    phase: answers && answers.phase || protocol && protocol.phase || 'preparation',
    barriers: rawBarriers,
    domain: answers && answers.domain || 'health'
  };

  // GÃ©nÃ©rer les explications pour chaque stratÃ©gie
  var explanations = strategies.map(function (strat, idx) {
    var stratId = strat.id || 'S0' + (idx + 1);
    var stratLabel = strat.label || {
      fr: 'StratÃ©gie',
      en: 'Strategy'
    };
    var stratLabelFr = stratLabel.fr || stratLabel || 'StratÃ©gie';
    var reasons = [];
    var frameworks = [];
    // Utiliser la confidence de la stratÃ©gie si disponible, sinon gÃ©nÃ©rer
    var confidence = strat.confidence || 0.7 + Math.random() * 0.2;

    // Raisons contextuelles basÃ©es sur la phase
    if (context.phase === 'implementation' && (stratId === 'S02' || stratLabelFr.indexOf('Audit') !== -1)) {
      reasons.push(l === 'fr' ? "Phase d'implÃ©mentation : le suivi des indicateurs est crucial" : "Implementation phase: indicator monitoring is crucial");
      frameworks.push({
        name: 'EPIS',
        construct: l === 'fr' ? 'Phase ImplÃ©mentation' : 'Implementation Phase'
      });
    }
    if (context.phase === 'preparation' && (stratId === 'S01' || stratLabelFr.indexOf('Formation') !== -1)) {
      reasons.push(l === 'fr' ? "Phase de prÃ©paration : renforcement des compÃ©tences essentiel" : "Preparation phase: skill building is essential");
      frameworks.push({
        name: 'CFIR 2.0',
        construct: l === 'fr' ? 'CaractÃ©ristiques des individus' : 'Individual Characteristics'
      });
    }

    // Raisons basÃ©es sur les barriÃ¨res dÃ©tectÃ©es
    if (context.barriers.indexOf('staff_resistance') !== -1 || context.barriers.indexOf('resistance') !== -1) {
      if (stratId === 'S04' || stratId === 'S08' || stratLabelFr.indexOf('Champion') !== -1 || stratLabelFr.indexOf('engagement') !== -1) {
        reasons.push(l === 'fr' ? "RÃ©sistance au changement dÃ©tectÃ©e â†’ engagement des acteurs recommandÃ©" : "Change resistance detected â†’ stakeholder engagement recommended");
        frameworks.push({
          name: 'CFIR 2.0',
          construct: l === 'fr' ? 'Climat d\'implÃ©mentation' : 'Implementation Climate'
        });
      }
    }
    if (context.barriers.indexOf('stigma') !== -1 || context.barriers.indexOf('stigmatization') !== -1) {
      if (stratId === 'S08' || stratId === 'S18' || stratLabelFr.indexOf('communautaire') !== -1) {
        reasons.push(l === 'fr' ? "Stigmatisation identifiÃ©e â†’ engagement communautaire prioritaire" : "Stigma identified â†’ community engagement prioritized");
        frameworks.push({
          name: 'RE-AIM',
          construct: 'Reach'
        });
      }
    }
    if (context.barriers.indexOf('lack_training') !== -1) {
      if (stratId === 'S01' || stratLabelFr.indexOf('Formation') !== -1) {
        reasons.push(l === 'fr' ? "Manque de formation identifiÃ© â†’ formation prioritaire" : "Training gap identified â†’ training prioritized");
        frameworks.push({
          name: 'ERIC',
          construct: l === 'fr' ? 'Formation' : 'Training'
        });
      }
    }
    if (context.barriers.indexOf('time_constraints') !== -1 || context.barriers.indexOf('funding') !== -1) {
      if (stratId === 'S19' || stratId === 'S15' || stratLabelFr.indexOf('task') !== -1) {
        reasons.push(l === 'fr' ? "Ressources limitÃ©es â†’ optimisation des tÃ¢ches recommandÃ©e" : "Limited resources â†’ task optimization recommended");
        frameworks.push({
          name: 'WHO mhGAP',
          construct: 'Task-shifting'
        });
      }
    }

    // Raison gÃ©nÃ©rique si aucune raison spÃ©cifique
    if (reasons.length === 0) {
      if (stratId === 'S01' || stratLabelFr.indexOf('Formation') !== -1) {
        reasons.push(l === 'fr' ? "Formation essentielle pour tout projet d'implÃ©mentation" : "Training essential for any implementation project");
        frameworks.push({
          name: 'ERIC',
          construct: l === 'fr' ? 'Formation des professionnels' : 'Train Stakeholders'
        });
      } else if (stratId === 'S03' || stratLabelFr.indexOf('Facilitation') !== -1) {
        reasons.push(l === 'fr' ? "Facilitation recommandÃ©e pour accompagner le changement" : "Facilitation recommended to support change");
        frameworks.push({
          name: 'ERIC',
          construct: 'Facilitation'
        });
      } else if (stratId === 'S04' || stratLabelFr.indexOf('Champion') !== -1) {
        reasons.push(l === 'fr' ? "Champions locaux pour mobiliser les Ã©quipes" : "Local champions to mobilize teams");
        frameworks.push({
          name: 'CFIR 2.0',
          construct: l === 'fr' ? 'CaractÃ©ristiques des individus' : 'Individual Characteristics'
        });
      } else if (stratId === 'S08' || stratLabelFr.indexOf('communautaire') !== -1) {
        reasons.push(l === 'fr' ? "Engagement communautaire pour amÃ©liorer l'acceptabilitÃ©" : "Community engagement to improve acceptability");
        frameworks.push({
          name: 'RE-AIM',
          construct: 'Reach'
        });
      } else {
        reasons.push(l === 'fr' ? "StratÃ©gie alignÃ©e avec votre contexte d'implÃ©mentation" : "Strategy aligned with your implementation context");
        frameworks.push({
          name: 'ERIC',
          construct: 'Powell et al. 2015'
        });
      }
    }

    // Normaliser la confiance
    confidence = Math.min(Math.max(confidence, 0.5), 0.95);
    var confLevel = confidence > 0.8 ? 'high' : confidence > 0.65 ? 'medium' : 'low';
    return {
      strategyId: stratId,
      strategyName: stratLabel,
      confidence: confidence,
      confidenceLevel: confLevel,
      reasons: reasons,
      frameworks: frameworks,
      references: [{
        authors: 'Powell BJ et al.',
        year: 2015,
        title: 'A refined compilation of implementation strategies',
        journal: 'Implementation Science'
      }, {
        authors: 'Damschroder LJ et al.',
        year: 2022,
        title: 'The updated CFIR',
        journal: 'Implementation Science'
      }]
    };
  });

  // Calculer la confiance globale
  var overallConfidence = explanations.length > 0 ? explanations.reduce(function (sum, e) {
    return sum + e.confidence;
  }, 0) / explanations.length : 0.7;

  // Ajuster avec la confiance IA du protocole si disponible
  if (protocol && protocol.aiConfidence) {
    overallConfidence = (overallConfidence + protocol.aiConfidence) / 2;
  }
  var xaiReport = {
    overallConfidence: overallConfidence,
    methodology: l === 'fr' ? "Analyse basÃ©e sur le graphe de connaissances MOUDAR intÃ©grant CFIR 2.0, RE-AIM, EPIS et 73 stratÃ©gies ERIC" : "Analysis based on MOUDAR knowledge graph integrating CFIR 2.0, RE-AIM, EPIS and 73 ERIC strategies",
    explanations: explanations
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold flex items-center gap-2"
  }, "\uD83D\uDD0D ", lang === "fr" ? "Pourquoi ces recommandations ?" : "Why these recommendations?"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/80"
  }, lang === "fr" ? "Transparence IA - Moudar explique son raisonnement" : "AI Transparency - Moudar explains its reasoning")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-white/20 rounded-lg"
  }, "\u2715"))), /*#__PURE__*/React.createElement("div", {
    className: "p-6 overflow-y-auto max-h-[60vh]"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center justify-between mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "font-bold text-indigo-800"
  }, lang === "fr" ? "Confiance globale" : "Overall Confidence"), /*#__PURE__*/React.createElement("span", {
    className: "text-2xl font-bold text-indigo-600"
  }, Math.round(xaiReport.overallConfidence * 100), "%")), /*#__PURE__*/React.createElement("div", {
    className: "h-3 bg-indigo-200 rounded-full"
  }, /*#__PURE__*/React.createElement("div", {
    className: "h-3 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full",
    style: {
      width: xaiReport.overallConfidence * 100 + '%'
    }
  })), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-indigo-600 mt-2"
  }, xaiReport.methodology)), /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4"
  }, lang === "fr" ? "Explication de chaque stratÃ©gie" : "Explanation of each strategy"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, (xaiReport.explanations || []).map(function (exp, i) {
    var confColor = exp.confidenceLevel === 'high' ? 'from-green-500 to-emerald-500' : exp.confidenceLevel === 'medium' ? 'from-yellow-500 to-amber-500' : 'from-orange-500 to-red-500';
    var stratLabel = exp.strategyName && exp.strategyName[l] ? exp.strategyName[l] : exp.strategyName && exp.strategyName.fr ? exp.strategyName.fr : exp.strategyId;
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "bg-white border border-gray-200 rounded-xl p-4 shadow-sm"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center justify-between mb-3"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-bold text-gray-800"
    }, stratLabel), /*#__PURE__*/React.createElement("span", {
      className: "text-xs bg-gray-100 px-2 py-0.5 rounded"
    }, exp.strategyId)), /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("div", {
      className: "w-16 h-2 bg-gradient-to-r " + confColor + " rounded-full"
    }), /*#__PURE__*/React.createElement("span", {
      className: "text-sm font-medium"
    }, Math.round((exp.confidence || 0.5) * 100), "%"))), /*#__PURE__*/React.createElement("div", {
      className: "mb-3"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xs font-medium text-gray-500 uppercase"
    }, lang === "fr" ? "Pourquoi ?" : "Why?"), /*#__PURE__*/React.createElement("ul", {
      className: "mt-1 space-y-1"
    }, (exp.reasons || []).map(function (r, j) {
      return /*#__PURE__*/React.createElement("li", {
        key: j,
        className: "text-sm text-gray-700 flex items-start gap-2"
      }, /*#__PURE__*/React.createElement("span", {
        className: "text-indigo-500"
      }, "\u2192"), r);
    }))), exp.frameworks && exp.frameworks.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "flex flex-wrap gap-2"
    }, exp.frameworks.map(function (f, k) {
      return /*#__PURE__*/React.createElement("span", {
        key: k,
        className: "text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full"
      }, f.name, ": ", f.construct);
    })));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-gray-50 rounded-xl"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-gray-700 mb-2"
  }, lang === "fr" ? "RÃ©fÃ©rences scientifiques" : "Scientific references"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-600 space-y-1"
  }, /*#__PURE__*/React.createElement("div", null, "\u2022 Powell BJ et al. (2015). A refined compilation of implementation strategies. Implementation Science."), /*#__PURE__*/React.createElement("div", null, "\u2022 Damschroder LJ et al. (2022). The updated CFIR. Implementation Science."), /*#__PURE__*/React.createElement("div", null, "\u2022 Glasgow RE et al. (2019). RE-AIM Planning and Evaluation Framework. Frontiers in Public Health.")))), /*#__PURE__*/React.createElement("div", {
    className: "border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
  }, lang === "fr" ? "Compris !" : "Got it!"))));
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// VUE GLOSSAIRE INTERACTIF
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function GlossaryView(props) {
  var onClose = props.onClose;
  var lang = props.lang;
  var selectedState = useState('CFIR');
  var selected = selectedState[0];
  var setSelected = selectedState[1];
  var glossary = MoudarEngine.getGlossary ? MoudarEngine.getGlossary(lang) : [];
  var entry = MoudarEngine.getGlossaryEntry ? MoudarEngine.getGlossaryEntry(selected, lang) : null;

  // Fallback si glossary vide
  if (!glossary || glossary.length === 0) {
    glossary = [{
      term: 'CFIR',
      fullName: 'Consolidated Framework for Implementation Research'
    }, {
      term: 'RE-AIM',
      fullName: 'Reach Effectiveness Adoption Implementation Maintenance'
    }, {
      term: 'ERIC',
      fullName: 'Expert Recommendations for Implementing Change'
    }];
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-emerald-600 to-teal-600 p-6 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold flex items-center gap-2"
  }, "\uD83D\uDCDA ", lang === "fr" ? "Glossaire Science de la mise en Å“uvre" : "Implementation Science Glossary"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/80"
  }, lang === "fr" ? "Cadres, modÃ¨les et concepts clÃ©s" : "Key frameworks, models and concepts")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-white/20 rounded-lg"
  }, "\u2715"))), /*#__PURE__*/React.createElement("div", {
    className: "flex h-[60vh]"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-1/3 border-r bg-gray-50 p-4 overflow-y-auto"
  }, glossary.map(function (g) {
    return /*#__PURE__*/React.createElement("button", {
      key: g.term,
      onClick: function () {
        setSelected(g.term);
      },
      className: "w-full text-left p-3 rounded-lg mb-2 transition " + (selected === g.term ? "bg-emerald-100 border-2 border-emerald-500" : "bg-white hover:bg-gray-100")
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, g.term), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500 truncate"
    }, g.fullName));
  })), /*#__PURE__*/React.createElement("div", {
    className: "w-2/3 p-6 overflow-y-auto"
  }, entry && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("h3", {
    className: "text-2xl font-bold text-gray-800 mb-1"
  }, entry.term), /*#__PURE__*/React.createElement("p", {
    className: "text-emerald-600 mb-4"
  }, entry.fullName), /*#__PURE__*/React.createElement("div", {
    className: "mb-4"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-gray-700 mb-2"
  }, lang === "fr" ? "DÃ©finition" : "Definition"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600"
  }, entry.definition)), /*#__PURE__*/React.createElement("div", {
    className: "mb-4"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-gray-700 mb-2"
  }, lang === "fr" ? "Composantes" : "Components"), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-2"
  }, entry.domains.map(function (d, i) {
    return /*#__PURE__*/React.createElement("span", {
      key: i,
      className: "px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm"
    }, d);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mb-4"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-gray-700 mb-2"
  }, lang === "fr" ? "Cas d'usage" : "Use cases"), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-1"
  }, entry.useCases.map(function (u, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i,
      className: "text-gray-600 flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-emerald-500"
    }, "\u2713"), u);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-400"
  }, lang === "fr" ? "RÃ©fÃ©rence" : "Reference", ": ", entry.reference)))), /*#__PURE__*/React.createElement("div", {
    className: "border-t p-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// VUE CERTIFICATION MOUDAR READY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function CertificationView(props) {
  var onClose = props.onClose;
  var lang = props.lang;
  var protocol = props.protocol;
  var answers = props.answers;
  console.log("[CERT VIEW] Protocol:", protocol);
  console.log("[CERT VIEW] Answers:", answers);

  // Fonction de certification inline pour Ã©viter les problÃ¨mes de scope
  function evaluateCertificationLocal(proto, ctx, l) {
    l = l || 'fr';
    var results = [];
    var totalScore = 0;
    var criteria = [{
      id: 'framework',
      weight: 15,
      label: {
        fr: "Cadre thÃ©orique IS explicite",
        en: "Explicit IS theoretical framework"
      }
    }, {
      id: 'strategies',
      weight: 15,
      label: {
        fr: "StratÃ©gies d'implÃ©mentation dÃ©finies",
        en: "Implementation strategies defined"
      }
    }, {
      id: 'outcomes',
      weight: 15,
      label: {
        fr: "Outcomes d'implÃ©mentation mesurables",
        en: "Measurable implementation outcomes"
      }
    }, {
      id: 'barriers',
      weight: 10,
      label: {
        fr: "Analyse barriÃ¨res/facilitateurs",
        en: "Barriers/facilitators analysis"
      }
    }, {
      id: 'stakeholders',
      weight: 10,
      label: {
        fr: "Parties prenantes identifiÃ©es",
        en: "Stakeholders identified"
      }
    }, {
      id: 'adaptation',
      weight: 10,
      label: {
        fr: "Plan d'adaptation contextuelle",
        en: "Contextual adaptation plan"
      }
    }, {
      id: 'evaluation',
      weight: 10,
      label: {
        fr: "Plan d'Ã©valuation",
        en: "Evaluation plan"
      }
    }, {
      id: 'timeline',
      weight: 5,
      label: {
        fr: "Timeline EPIS",
        en: "EPIS timeline"
      }
    }, {
      id: 'sustainment',
      weight: 5,
      label: {
        fr: "Plan de pÃ©rennisation",
        en: "Sustainability plan"
      }
    }, {
      id: 'equity',
      weight: 5,
      label: {
        fr: "ConsidÃ©rations d'Ã©quitÃ©",
        en: "Equity considerations"
      }
    }];
    criteria.forEach(function (criterion) {
      var passed = false;
      var score = 0;
      switch (criterion.id) {
        case 'framework':
          passed = proto.frameworks && proto.frameworks.length > 0 || proto.aiConfidence && proto.aiConfidence > 0.5;
          break;
        case 'strategies':
          passed = proto.strategies && proto.strategies.length >= 2;
          break;
        case 'outcomes':
          passed = proto.outcomes && proto.outcomes.length > 0;
          break;
        case 'barriers':
          passed = proto.aiDetectedBarriers && proto.aiDetectedBarriers.length > 0;
          break;
        case 'stakeholders':
          passed = ctx && ctx.organization || proto.title && proto.title.length > 0;
          break;
        case 'adaptation':
          passed = proto.aiRawRecommendations && proto.aiRawRecommendations.input && proto.aiRawRecommendations.input.resourceLevel;
          break;
        case 'evaluation':
          passed = proto.outcomes && proto.outcomes.length > 0;
          break;
        case 'timeline':
          passed = proto.keyActivities && proto.keyActivities.length > 0;
          break;
        case 'sustainment':
          passed = proto.recommendations && proto.recommendations.length > 0;
          break;
        case 'equity':
          passed = proto.aiRawRecommendations && proto.aiRawRecommendations.input && (proto.aiRawRecommendations.input.resourceLevel === 'LMIC' || proto.aiRawRecommendations.input.resourceLevel === 'LIC');
          break;
        default:
          passed = false;
      }
      score = passed ? criterion.weight : 0;
      totalScore += score;
      console.log("[CERT LOCAL] CritÃ¨re", criterion.id, ":", passed ? "âœ“" : "âœ—", "(+" + score + "pts)");
      results.push({
        criterion: criterion.id,
        label: criterion.label[l],
        weight: criterion.weight,
        passed: passed,
        score: score
      });
    });
    console.log("[CERT LOCAL] Score total:", totalScore + "/100");
    var level = 'none';
    var levelLabel = {
      fr: "Non certifiable",
      en: "Not certifiable"
    };
    var color = '#ef4444';
    if (totalScore >= 90) {
      level = 'gold';
      levelLabel = {
        fr: "Certification Or",
        en: "Gold Certification"
      };
      color = '#f59e0b';
    } else if (totalScore >= 75) {
      level = 'silver';
      levelLabel = {
        fr: "Certification Argent",
        en: "Silver Certification"
      };
      color = '#9ca3af';
    } else if (totalScore >= 60) {
      level = 'bronze';
      levelLabel = {
        fr: "Certification Bronze",
        en: "Bronze Certification"
      };
      color = '#b45309';
    }
    var certId = 'MR-' + new Date().getFullYear() + '-' + Math.random().toString(36).substr(2, 6).toUpperCase();
    return {
      projectTitle: proto.title || ctx && ctx.title,
      score: totalScore,
      maxScore: 100,
      level: level,
      levelLabel: levelLabel[l],
      color: color,
      certified: totalScore >= 60,
      certificationId: totalScore >= 60 ? certId : null,
      results: results,
      passedCriteria: results.filter(function (r) {
        return r.passed;
      }).length,
      totalCriteria: results.length,
      recommendations: results.filter(function (r) {
        return !r.passed;
      }).map(function (r) {
        return l === 'fr' ? "Ajouter : " + r.label : "Add: " + r.label;
      }),
      validUntil: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
      generatedAt: new Date().toISOString()
    };
  }

  // VÃ©rification dÃ©fensive
  var certification;
  var defaultCert = {
    certified: false,
    level: 'none',
    score: 0,
    levelLabel: lang === "fr" ? "Non certifiÃ©" : "Not certified",
    color: "#6b7280",
    certificationId: "N/A",
    validUntil: "-",
    passedCriteria: 0,
    totalCriteria: 10,
    results: [],
    criteria: [],
    recommendations: [lang === "fr" ? "ComplÃ©tez le protocole pour obtenir la certification" : "Complete the protocol to get certification"],
    badge: null
  };
  try {
    if (!protocol) {
      console.log("[CERT VIEW] Protocol manquant, utilisation defaultCert");
      certification = defaultCert;
    } else {
      console.log("[CERT VIEW] Appel de evaluateCertificationLocal...");
      certification = evaluateCertificationLocal(protocol, answers, lang);
      console.log("[CERT VIEW] RÃ©sultat certification:", certification);
      // Assurer que toutes les propriÃ©tÃ©s existent
      certification.results = certification.results || [];
      certification.recommendations = certification.recommendations || [];
      certification.levelLabel = certification.levelLabel || defaultCert.levelLabel;
      certification.color = certification.color || defaultCert.color;
      certification.passedCriteria = certification.passedCriteria || 0;
      certification.totalCriteria = certification.totalCriteria || 10;
    }
  } catch (e) {
    console.error("[MOUDAR] Erreur Certification:", e);
    certification = defaultCert;
  }
  var levelIcon = certification.level === 'gold' ? 'ðŸ¥‡' : certification.level === 'silver' ? 'ðŸ¥ˆ' : certification.level === 'bronze' ? 'ðŸ¥‰' : 'âŒ';
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden shadow-2xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-6 text-white " + (certification.certified ? "bg-gradient-to-r from-amber-500 to-yellow-500" : "bg-gradient-to-r from-gray-500 to-slate-600")
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold flex items-center gap-2"
  }, "\uD83C\uDFC6 ", lang === "fr" ? "Certification Moudar Ready" : "Moudar Ready Certification"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/80"
  }, lang === "fr" ? "Label qualitÃ© Science de la mise en Å“uvre" : "Implementation Science quality label")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-white/20 rounded-lg"
  }, "\u2715"))), /*#__PURE__*/React.createElement("div", {
    className: "p-6 overflow-y-auto max-h-[60vh]"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-6xl mb-4"
  }, levelIcon), /*#__PURE__*/React.createElement("h3", {
    className: "text-3xl font-bold",
    style: {
      color: certification.color
    }
  }, certification.score, "/100"), /*#__PURE__*/React.createElement("p", {
    className: "text-xl font-medium text-gray-700"
  }, certification.levelLabel), certification.certified && /*#__PURE__*/React.createElement("div", {
    className: "mt-4 inline-block px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm"
  }, "\u2713 ", lang === "fr" ? "CertifiÃ©" : "Certified", " \u2022 ID: ", certification.certificationId)), /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-4"
  }, lang === "fr" ? "CritÃ¨res Ã©valuÃ©s" : "Evaluated criteria", " (", certification.passedCriteria || 0, "/", certification.totalCriteria || 10, ")"), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 gap-3 mb-6"
  }, (certification.results || []).map(function (r, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-3 rounded-lg border " + (r.passed ? "bg-green-50 border-green-200" : "bg-red-50 border-red-200")
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center justify-between"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-sm"
    }, r.label || ""), /*#__PURE__*/React.createElement("span", {
      className: "text-lg"
    }, r.passed ? 'âœ…' : 'âŒ')), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500 mt-1"
    }, r.weight || 0, " pts"));
  })), certification.recommendations && certification.recommendations.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-amber-50 rounded-xl border border-amber-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-amber-800 mb-2"
  }, lang === "fr" ? "Pour amÃ©liorer votre score" : "To improve your score"), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-1"
  }, (certification.recommendations || []).slice(0, 5).map(function (r, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i,
      className: "text-sm text-amber-700"
    }, "\u2022 ", r);
  })))), /*#__PURE__*/React.createElement("div", {
    className: "border-t p-4 flex justify-between"
  }, certification.certified && /*#__PURE__*/React.createElement("button", {
    className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
  }, "\uD83D\uDCE5 ", lang === "fr" ? "TÃ©lÃ©charger le badge" : "Download badge"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-100 rounded-lg ml-auto"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// VUE ANALYSEUR DE DOCUMENT - KILLER FEATURE v8.0
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DocumentAnalyzerView(props) {
  var onClose = props.onClose;
  var lang = props.lang;
  var onImportProtocol = props.onImportProtocol;
  var textState = useState('');
  var text = textState[0];
  var setText = textState[1];
  var analysisState = useState(null);
  var analysis = analysisState[0];
  var setAnalysis = analysisState[1];
  var generatedSectionState = useState(null);
  var generatedSection = generatedSectionState[0];
  var setGeneratedSection = generatedSectionState[1];
  var isAnalyzingState = useState(false);
  var isAnalyzing = isAnalyzingState[0];
  var setIsAnalyzing = isAnalyzingState[1];
  function handleAnalyze() {
    if (!text.trim()) return;
    setIsAnalyzing(true);
    // Simuler un dÃ©lai pour l'effet "IA qui travaille"
    setTimeout(function () {
      var result = MoudarEngine.analyzeDocument(text, lang);
      setAnalysis(result);
      setIsAnalyzing(false);
    }, 1500);
  }
  function handleGenerateSection(sectionId) {
    var section = MoudarEngine.generateSection(sectionId, {}, lang);
    setGeneratedSection(section);
  }
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text);
  }
  var scoreColor = analysis ? analysis.score >= 80 ? 'from-green-500 to-emerald-500' : analysis.score >= 60 ? 'from-blue-500 to-cyan-500' : analysis.score >= 40 ? 'from-yellow-500 to-amber-500' : 'from-red-500 to-orange-500' : '';
  var scoreEmoji = analysis ? analysis.score >= 80 ? 'ðŸ†' : analysis.score >= 60 ? 'ðŸ‘' : analysis.score >= 40 ? 'âš ï¸' : 'ðŸ”´' : '';
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl w-full max-w-5xl max-h-[95vh] overflow-hidden shadow-2xl"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 p-6 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold flex items-center gap-2"
  }, "\uD83D\uDCC4 ", lang === "fr" ? "Analyseur de Protocole IA" : "AI Protocol Analyzer"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/80"
  }, lang === "fr" ? "Collez votre protocole â†’ Moudar identifie les gaps IS" : "Paste your protocol â†’ Moudar identifies IS gaps")), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-white/20 rounded-lg text-xl"
  }, "\u2715"))), /*#__PURE__*/React.createElement("div", {
    className: "flex h-[calc(95vh-180px)]"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-1/2 p-6 border-r bg-gray-50 flex flex-col"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3 flex items-center gap-2"
  }, "\uD83D\uDCDD ", lang === "fr" ? "Votre protocole existant" : "Your existing protocol"), /*#__PURE__*/React.createElement("textarea", {
    value: text,
    onChange: function (e) {
      setText(e.target.value);
      setAnalysis(null);
      setGeneratedSection(null);
    },
    placeholder: lang === "fr" ? "Collez ici votre protocole de recherche, demande de financement, ou description de projet...\n\nExemple:\n- Contexte et justification\n- Population cible\n- Objectifs\n- MÃ©thodologie\n- Calendrier\n- Budget\n\nMoudar analysera automatiquement la complÃ©tude IS de votre document." : "Paste your research protocol, funding application, or project description here...\n\nExample:\n- Background and rationale\n- Target population\n- Objectives\n- Methodology\n- Timeline\n- Budget\n\nMoudar will automatically analyze your document's IS completeness.",
    className: "flex-1 w-full p-4 border-2 border-gray-200 rounded-xl resize-none focus:border-purple-500 focus:outline-none text-sm"
  }), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex items-center justify-between"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-sm text-gray-500"
  }, text.split(/\s+/).filter(function (w) {
    return w;
  }).length, " ", lang === "fr" ? "mots" : "words"), /*#__PURE__*/React.createElement("button", {
    onClick: handleAnalyze,
    disabled: !text.trim() || isAnalyzing,
    className: "px-6 py-3 rounded-xl font-bold text-white transition flex items-center gap-2 " + (text.trim() && !isAnalyzing ? "bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700" : "bg-gray-300 cursor-not-allowed")
  }, isAnalyzing ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("span", {
    className: "animate-spin"
  }, "\u2699\uFE0F"), lang === "fr" ? "Analyse en cours..." : "Analyzing...") : /*#__PURE__*/React.createElement(React.Fragment, null, "\uD83D\uDD0D ", lang === "fr" ? "Analyser avec l'IA" : "Analyze with AI")))), /*#__PURE__*/React.createElement("div", {
    className: "w-1/2 p-6 overflow-y-auto"
  }, !analysis && !isAnalyzing && /*#__PURE__*/React.createElement("div", {
    className: "h-full flex flex-col items-center justify-center text-gray-400"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-6xl mb-4"
  }, "\uD83D\uDD2C"), /*#__PURE__*/React.createElement("p", {
    className: "text-center"
  }, lang === "fr" ? "Collez votre texte et cliquez sur Analyser" : "Paste your text and click Analyze"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-center mt-2"
  }, lang === "fr" ? "Moudar Ã©valuera la complÃ©tude IS de votre document" : "Moudar will evaluate your document's IS completeness")), isAnalyzing && /*#__PURE__*/React.createElement("div", {
    className: "h-full flex flex-col items-center justify-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-6xl mb-4 animate-pulse"
  }, "\uD83E\uDDE0"), /*#__PURE__*/React.createElement("p", {
    className: "text-purple-600 font-medium"
  }, lang === "fr" ? "L'IA analyse votre document..." : "AI is analyzing your document..."), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex gap-1"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-3 h-3 bg-purple-500 rounded-full animate-bounce",
    style: {
      animationDelay: '0ms'
    }
  }), /*#__PURE__*/React.createElement("div", {
    className: "w-3 h-3 bg-purple-500 rounded-full animate-bounce",
    style: {
      animationDelay: '150ms'
    }
  }), /*#__PURE__*/React.createElement("div", {
    className: "w-3 h-3 bg-purple-500 rounded-full animate-bounce",
    style: {
      animationDelay: '300ms'
    }
  }))), analysis && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-6 rounded-2xl bg-gradient-to-r " + scoreColor + " text-white text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-5xl mb-2"
  }, scoreEmoji), /*#__PURE__*/React.createElement("div", {
    className: "text-5xl font-bold mb-1"
  }, analysis.score, "/100"), /*#__PURE__*/React.createElement("div", {
    className: "text-xl font-medium opacity-90"
  }, analysis.scoreInterpretation), /*#__PURE__*/React.createElement("div", {
    className: "text-sm opacity-75 mt-2"
  }, analysis.wordCount, " ", lang === "fr" ? "mots analysÃ©s" : "words analyzed")), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-3 gap-3"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-green-50 border border-green-200 rounded-xl p-3 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-green-600"
  }, analysis.summary.strengths), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-green-700"
  }, lang === "fr" ? "Forces" : "Strengths")), /*#__PURE__*/React.createElement("div", {
    className: "bg-red-50 border border-red-200 rounded-xl p-3 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-red-600"
  }, analysis.summary.criticalGaps), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-red-700"
  }, lang === "fr" ? "Gaps critiques" : "Critical gaps")), /*#__PURE__*/React.createElement("div", {
    className: "bg-amber-50 border border-amber-200 rounded-xl p-3 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-amber-600"
  }, analysis.summary.importantGaps), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-amber-700"
  }, lang === "fr" ? "Gaps importants" : "Important gaps"))), analysis.strengths.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-green-50 rounded-xl p-4 border border-green-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-green-800 mb-2 flex items-center gap-2"
  }, "\u2705 ", lang === "fr" ? "Forces dÃ©tectÃ©es" : "Detected strengths"), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-1"
  }, analysis.strengths.map(function (s, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i,
      className: "text-green-700 text-sm flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-green-500"
    }, "\u2713"), " ", s);
  }))), analysis.gaps.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-red-50 rounded-xl p-4 border border-red-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-red-800 mb-3 flex items-center gap-2"
  }, "\u274C ", lang === "fr" ? "Ã‰lÃ©ments IS manquants" : "Missing IS elements"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, analysis.gaps.map(function (gap, i) {
    var canGenerate = ['framework', 'strategies', 'outcomes_impl', 'sustainment'].includes(gap.id);
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-3 rounded-lg " + (gap.severity === 'critical' ? 'bg-red-100' : 'bg-amber-100')
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-start justify-between"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex-1"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: gap.severity === 'critical' ? 'text-red-600' : 'text-amber-600'
    }, gap.severity === 'critical' ? 'ðŸ”´' : 'ðŸŸ¡'), /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-gray-800 text-sm"
    }, gap.description)), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mt-1 ml-6"
    }, gap.suggestion)), canGenerate && /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        handleGenerateSection(gap.id);
      },
      className: "px-3 py-1 bg-purple-600 text-white text-xs rounded-lg hover:bg-purple-700 whitespace-nowrap"
    }, "\u2728 ", lang === "fr" ? "GÃ©nÃ©rer" : "Generate")));
  }))), generatedSection && /*#__PURE__*/React.createElement("div", {
    className: "bg-purple-50 rounded-xl p-4 border-2 border-purple-300"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center justify-between mb-3"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-purple-800 flex items-center gap-2"
  }, "\u2728 ", lang === "fr" ? "Section gÃ©nÃ©rÃ©e par l'IA" : "AI-generated section"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      copyToClipboard(generatedSection.title + '\n\n' + generatedSection.content);
    },
    className: "px-3 py-1 bg-purple-600 text-white text-xs rounded-lg hover:bg-purple-700"
  }, "\uD83D\uDCCB ", lang === "fr" ? "Copier" : "Copy")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-lg p-4 border border-purple-200"
  }, /*#__PURE__*/React.createElement("h5", {
    className: "font-bold text-gray-800 mb-2"
  }, generatedSection.title), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-700 text-sm whitespace-pre-line"
  }, generatedSection.content)), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-purple-600 mt-2 italic"
  }, "\uD83D\uDCA1 ", lang === "fr" ? "Copiez ce texte et adaptez-le Ã  votre contexte spÃ©cifique" : "Copy this text and adapt it to your specific context")), analysis.extractedElements && /*#__PURE__*/React.createElement("div", {
    className: "bg-gray-50 rounded-xl p-4 border border-gray-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-700 mb-3 flex items-center gap-2"
  }, "\uD83D\uDD0E ", lang === "fr" ? "Ã‰lÃ©ments extraits automatiquement" : "Automatically extracted elements"), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 gap-3 text-sm"
  }, analysis.extractedElements.context && /*#__PURE__*/React.createElement("div", {
    className: "bg-white p-2 rounded-lg"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-gray-500"
  }, lang === "fr" ? "Contexte:" : "Context:"), /*#__PURE__*/React.createElement("span", {
    className: "ml-2 font-medium"
  }, analysis.extractedElements.context)), analysis.extractedElements.population && /*#__PURE__*/React.createElement("div", {
    className: "bg-white p-2 rounded-lg"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-gray-500"
  }, lang === "fr" ? "Population:" : "Population:"), /*#__PURE__*/React.createElement("span", {
    className: "ml-2 font-medium"
  }, analysis.extractedElements.population)), analysis.extractedElements.phase && /*#__PURE__*/React.createElement("div", {
    className: "bg-white p-2 rounded-lg"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-gray-500"
  }, lang === "fr" ? "Phase EPIS:" : "EPIS Phase:"), /*#__PURE__*/React.createElement("span", {
    className: "ml-2 font-medium"
  }, analysis.extractedElements.phase)), analysis.extractedElements.timeline && /*#__PURE__*/React.createElement("div", {
    className: "bg-white p-2 rounded-lg"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-gray-500"
  }, lang === "fr" ? "DurÃ©e:" : "Duration:"), /*#__PURE__*/React.createElement("span", {
    className: "ml-2 font-medium"
  }, analysis.extractedElements.timeline, " ", lang === "fr" ? "mois" : "months")), analysis.extractedElements.barriers && analysis.extractedElements.barriers.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-white p-2 rounded-lg col-span-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-gray-500"
  }, lang === "fr" ? "BarriÃ¨res dÃ©tectÃ©es:" : "Detected barriers:"), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-1 mt-1"
  }, analysis.extractedElements.barriers.map(function (b, i) {
    return /*#__PURE__*/React.createElement("span", {
      key: i,
      className: "px-2 py-0.5 bg-orange-100 text-orange-700 text-xs rounded"
    }, b);
  })))))))), /*#__PURE__*/React.createElement("div", {
    className: "border-t p-4 bg-gray-50 flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500"
  }, "\uD83D\uDCA1 ", lang === "fr" ? "L'analyse est basÃ©e sur 10 critÃ¨res IS essentiels (CFIR, RE-AIM, EPIS, ERIC, Proctor, TIDieR)" : "Analysis is based on 10 essential IS criteria (CFIR, RE-AIM, EPIS, ERIC, Proctor, TIDieR)"), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300"
  }, lang === "fr" ? "Fermer" : "Close"))));
}

// ============================================
// WIZARD VIEW
// ============================================
function WizardView(props) {
  var existingProject = props.existingProject;
  var lang = props.lang;
  var stepState = useState(existingProject && existingProject.protocol ? -1 : 0);
  var step = stepState[0];
  var setStep = stepState[1];
  var answersState = useState(existingProject || {});
  var answers = answersState[0];
  var setAnswers = answersState[1];
  var protocolState = useState(existingProject && existingProject.protocol ? existingProject.protocol : null);
  var protocol = protocolState[0];
  var setProtocol = protocolState[1];
  var savedState = useState(false);
  var saved = savedState[0];
  var setSaved = savedState[1];
  var currentProjectIdState = useState(existingProject ? existingProject.id : null);
  var currentProjectId = currentProjectIdState[0];
  var setCurrentProjectId = currentProjectIdState[1];

  // v9.0 - Ã‰tat de chargement pour la gÃ©nÃ©ration
  var isGeneratingState = useState(false);
  var isGenerating = isGeneratingState[0];
  var setIsGenerating = isGeneratingState[1];

  // v9.0 - Auto-gÃ©nÃ©ration pour les projets Gold Standard
  var autoGeneratedRef = useRef(false);
  useEffect(function () {
    if (existingProject && existingProject.tags && existingProject.tags.indexOf('gold_standard') !== -1 && !existingProject.protocol && !autoGeneratedRef.current) {
      autoGeneratedRef.current = true;
      console.log("[MOUDAR GOLD] Auto-gÃ©nÃ©ration du protocole pour projet Gold Standard");
      // Petit dÃ©lai pour laisser l'UI se charger
      setTimeout(function () {
        setIsGenerating(true);
        setTimeout(function () {
          try {
            var result = generateIntelligentProtocol(existingProject, lang);
            if (result) {
              setProtocol(result);
              setStep(-1);
              // Sauvegarder avec le protocole
              var projectToSave = Object.assign({}, existingProject, {
                protocol: result,
                status: "protocol"
              });
              StorageManager.saveProject(projectToSave);
              console.log("[MOUDAR GOLD] âœ… Protocole Gold gÃ©nÃ©rÃ© automatiquement!");
            }
          } catch (e) {
            console.error("[MOUDAR GOLD] Erreur auto-gÃ©nÃ©ration:", e);
          }
          setIsGenerating(false);
        }, 500);
      }, 800);
    }
  }, [existingProject]);

  // Ã‰tats pour les modales avancÃ©es
  var showTheoryState = useState(false);
  var showTheory = showTheoryState[0];
  var setShowTheory = showTheoryState[1];
  var showScenariosState = useState(false);
  var showScenarios = showScenariosState[0];
  var setShowScenarios = showScenariosState[1];
  var showKPIsState = useState(false);
  var showKPIs = showKPIsState[0];
  var setShowKPIs = showKPIsState[1];
  var showStakeholdersState = useState(false);
  var showStakeholders = showStakeholdersState[0];
  var setShowStakeholders = showStakeholdersState[1];
  var showTrainingPlanState = useState(false);
  var showTrainingPlan = showTrainingPlanState[0];
  var setShowTrainingPlan = showTrainingPlanState[1];

  // Ã‰tats v8.0 - Nouveaux outils
  var showSuccessPredictionState = useState(false);
  var showSuccessPrediction = showSuccessPredictionState[0];
  var setShowSuccessPrediction = showSuccessPredictionState[1];
  var showBudgetEstimatorState = useState(false);
  var showBudgetEstimator = showBudgetEstimatorState[0];
  var setShowBudgetEstimator = showBudgetEstimatorState[1];
  var showCountryIntelligenceState = useState(false);
  var showCountryIntelligence = showCountryIntelligenceState[0];
  var setShowCountryIntelligence = showCountryIntelligenceState[1];
  var showCaseLibraryState = useState(false);
  var showCaseLibrary = showCaseLibraryState[0];
  var setShowCaseLibrary = showCaseLibraryState[1];
  var showRiskAnalysisState = useState(false);
  var showRiskAnalysis = showRiskAnalysisState[0];
  var setShowRiskAnalysis = showRiskAnalysisState[1];

  // v8.3 - Nouveaux Ã©tats pour Intelligence Prescriptive
  var showTornadoAnalysisState = useState(false);
  var showTornadoAnalysis = showTornadoAnalysisState[0];
  var setShowTornadoAnalysis = showTornadoAnalysisState[1];

  // v8.4 - Ã‰tats pour Collaboration & Export Pro
  var showCollaborationState = useState(false);
  var showCollaboration = showCollaborationState[0];
  var setShowCollaboration = showCollaborationState[1];
  var showLLMAnalyzerState = useState(false);
  var showLLMAnalyzer = showLLMAnalyzerState[0];
  var setShowLLMAnalyzer = showLLMAnalyzerState[1];
  var showPPTXExportState = useState(false);
  var showPPTXExport = showPPTXExportState[0];
  var setShowPPTXExport = showPPTXExportState[1];
  var collaboratorsState = useState([]);
  var collaborators = collaboratorsState[0];
  var setCollaborators = collaboratorsState[1];

  // v8.5 - Ã‰tats pour Monitoring & EcosystÃ¨me
  var showSNAState = useState(false);
  var showSNA = showSNAState[0];
  var setShowSNA = showSNAState[1];
  var showMonitoringState = useState(false);
  var showMonitoring = showMonitoringState[0];
  var setShowMonitoring = showMonitoringState[1];
  var showGeoMapState = useState(false);
  var showGeoMap = showGeoMapState[0];
  var setShowGeoMap = showGeoMapState[1];
  var showScalingState = useState(false);
  var showScaling = showScalingState[0];
  var setShowScaling = showScalingState[1];
  var showDHIS2State = useState(false);
  var showDHIS2 = showDHIS2State[0];
  var setShowDHIS2 = showDHIS2State[1];
  var showVoiceAssistantState = useState(false);
  var showVoiceAssistant = showVoiceAssistantState[0];
  var setShowVoiceAssistant = showVoiceAssistantState[1];

  // v8.5+ - Ã‰tats pour DÃ©mo GuidÃ©e
  var demoModeState = useState(false);
  var demoMode = demoModeState[0];
  var setDemoMode = demoModeState[1];
  var demoStepState = useState(null);
  var demoStep = demoStepState[0];
  var setDemoStep = demoStepState[1];
  var showClosedLoopState = useState(false);
  var showClosedLoop = showClosedLoopState[0];
  var setShowClosedLoop = showClosedLoopState[1];
  var showPortfolioState = useState(false);
  var showPortfolio = showPortfolioState[0];
  var setShowPortfolio = showPortfolioState[1];
  var showResearchExportsState = useState(false);
  var showResearchExports = showResearchExportsState[0];
  var setShowResearchExports = showResearchExportsState[1];

  // Ã‰tats v8.0 - World Leader SMOA
  var showGanttTimelineState = useState(false);
  var showGanttTimeline = showGanttTimelineState[0];
  var setShowGanttTimeline = showGanttTimelineState[1];
  var showCFIR2State = useState(false);
  var showCFIR2 = showCFIR2State[0];
  var setShowCFIR2 = showCFIR2State[1];
  var showREAIMState = useState(false);
  var showREAIM = showREAIMState[0];
  var setShowREAIM = showREAIMState[1];
  var showROICalculatorState = useState(false);
  var showROICalculator = showROICalculatorState[0];
  var setShowROICalculator = showROICalculatorState[1];
  var showFundingProposalState = useState(false);
  var showFundingProposal = showFundingProposalState[0];
  var setShowFundingProposal = showFundingProposalState[1];
  var showMonitoringDashboardState = useState(false);
  var showMonitoringDashboard = showMonitoringDashboardState[0];
  var setShowMonitoringDashboard = showMonitoringDashboardState[1];
  var showLogicModelState = useState(false);
  var showLogicModel = showLogicModelState[0];
  var setShowLogicModel = showLogicModelState[1];
  var showMonteCarloState = useState(false);
  var showMonteCarlo = showMonteCarloState[0];
  var setShowMonteCarlo = showMonteCarloState[1];
  var showNLPAnalyzerState = useState(false);
  var showNLPAnalyzer = showNLPAnalyzerState[0];
  var setShowNLPAnalyzer = showNLPAnalyzerState[1];
  var showPowerPointGeneratorState = useState(false);
  var showPowerPointGenerator = showPowerPointGeneratorState[0];
  var setShowPowerPointGenerator = showPowerPointGeneratorState[1];

  // Ã‰tats v8.0 - World Leader Platform
  var showAPIDocsState = useState(false);
  var showAPIDocs = showAPIDocsState[0];
  var setShowAPIDocs = showAPIDocsState[1];
  var showCommunityHubState = useState(false);
  var showCommunityHub = showCommunityHubState[0];
  var setShowCommunityHub = showCommunityHubState[1];
  var showDataIntegrationsState = useState(false);
  var showDataIntegrations = showDataIntegrationsState[0];
  var setShowDataIntegrations = showDataIntegrationsState[1];

  // Ã‰tats v8.0 - World Reference Platform
  var showXAIExplainerState = useState(false);
  var showXAIExplainer = showXAIExplainerState[0];
  var setShowXAIExplainer = showXAIExplainerState[1];
  var showGlossaryState = useState(false);
  var showGlossary = showGlossaryState[0];
  var setShowGlossary = showGlossaryState[1];
  var showCertificationState = useState(false);
  var showCertification = showCertificationState[0];
  var setShowCertification = showCertificationState[1];

  // v8.0 - Document Analyzer
  var showDocumentAnalyzerState = useState(false);
  var showDocumentAnalyzer = showDocumentAnalyzerState[0];
  var setShowDocumentAnalyzer = showDocumentAnalyzerState[1];

  // v8.0 - Interface simplifiÃ©e : montrer tous les outils ou non
  var showAllToolsState = useState(false);
  var showAllTools = showAllToolsState[0];
  var setShowAllTools = showAllToolsState[1];

  // v8.2 - Ã‰tat pour la validation
  var validationErrorsState = useState(null);
  var validationErrors = validationErrorsState[0];
  var setValidationErrors = validationErrorsState[1];
  var qualityScoreState = useState(null);
  var qualityScore = qualityScoreState[0];
  var setQualityScore = qualityScoreState[1];
  var domainOptions = Object.entries(DOMAINS).map(function (entry) {
    return {
      value: entry[0],
      label: entry[1].icon + " " + tObj(entry[1], lang)
    };
  });
  var phaseOptions = Object.entries(PHASES).map(function (entry) {
    return {
      value: entry[0],
      label: entry[1].icon + " " + tObj(entry[1], lang),
      description: tObj(entry[1].description, lang)
    };
  });

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // v8.2 - QUESTIONS Ã‰TENDUES POUR ANALYSE PRÃ‰CISE
  // 20+ questions organisÃ©es en 6 phases
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  var countryOptions = [{
    value: "morocco",
    label: "ðŸ‡²ðŸ‡¦ " + (lang === "fr" ? "Maroc" : "Morocco")
  }, {
    value: "tunisia",
    label: "ðŸ‡¹ðŸ‡³ " + (lang === "fr" ? "Tunisie" : "Tunisia")
  }, {
    value: "algeria",
    label: "ðŸ‡©ðŸ‡¿ " + (lang === "fr" ? "AlgÃ©rie" : "Algeria")
  }, {
    value: "senegal",
    label: "ðŸ‡¸ðŸ‡³ " + (lang === "fr" ? "SÃ©nÃ©gal" : "Senegal")
  }, {
    value: "mali",
    label: "ðŸ‡²ðŸ‡± " + (lang === "fr" ? "Mali" : "Mali")
  }, {
    value: "cotedivoire",
    label: "ðŸ‡¨ðŸ‡® " + (lang === "fr" ? "CÃ´te d'Ivoire" : "Ivory Coast")
  }, {
    value: "france",
    label: "ðŸ‡«ðŸ‡· " + (lang === "fr" ? "France" : "France")
  }, {
    value: "switzerland",
    label: "ðŸ‡¨ðŸ‡­ " + (lang === "fr" ? "Suisse" : "Switzerland")
  }, {
    value: "belgium",
    label: "ðŸ‡§ðŸ‡ª " + (lang === "fr" ? "Belgique" : "Belgium")
  }, {
    value: "canada",
    label: "ðŸ‡¨ðŸ‡¦ " + (lang === "fr" ? "Canada" : "Canada")
  }, {
    value: "usa",
    label: "ðŸ‡ºðŸ‡¸ " + (lang === "fr" ? "Ã‰tats-Unis" : "United States")
  }, {
    value: "uk",
    label: "ðŸ‡¬ðŸ‡§ " + (lang === "fr" ? "Royaume-Uni" : "United Kingdom")
  }, {
    value: "other_hic",
    label: "ðŸŒ " + (lang === "fr" ? "Autre pays Ã  haut revenu" : "Other high-income country")
  }, {
    value: "other_umic",
    label: "ðŸŒ " + (lang === "fr" ? "Autre pays Ã  revenu intermÃ©diaire supÃ©rieur" : "Other upper-middle income")
  }, {
    value: "other_lmic",
    label: "ðŸŒ " + (lang === "fr" ? "Autre pays Ã  revenu intermÃ©diaire infÃ©rieur" : "Other lower-middle income")
  }, {
    value: "other_lic",
    label: "ðŸŒ " + (lang === "fr" ? "Autre pays Ã  faible revenu" : "Other low-income country")
  }];
  var settingOptions = [{
    value: "hospital",
    label: "ðŸ¥ " + (lang === "fr" ? "HÃ´pital / CHU" : "Hospital / University Hospital")
  }, {
    value: "clinic",
    label: "ðŸ¨ " + (lang === "fr" ? "Centre de santÃ© / Clinique" : "Health Center / Clinic")
  }, {
    value: "community",
    label: "ðŸ˜ï¸ " + (lang === "fr" ? "CommunautÃ© / Terrain" : "Community / Field")
  }, {
    value: "school",
    label: "ðŸ« " + (lang === "fr" ? "Ã‰cole / UniversitÃ©" : "School / University")
  }, {
    value: "workplace",
    label: "ðŸ¢ " + (lang === "fr" ? "Entreprise / Lieu de travail" : "Company / Workplace")
  }, {
    value: "nursingHome",
    label: "ðŸ  " + (lang === "fr" ? "EHPAD / Maison de retraite" : "Nursing Home")
  }, {
    value: "prison",
    label: "ðŸ”’ " + (lang === "fr" ? "Milieu carcÃ©ral" : "Prison / Correctional")
  }, {
    value: "telehealth",
    label: "ðŸ’» " + (lang === "fr" ? "TÃ©lÃ©santÃ© / Ã€ distance" : "Telehealth / Remote")
  }, {
    value: "rural",
    label: "ðŸŒ¾ " + (lang === "fr" ? "Zone rurale" : "Rural Area")
  }, {
    value: "urban",
    label: "ðŸ™ï¸ " + (lang === "fr" ? "Zone urbaine" : "Urban Area")
  }, {
    value: "mixed",
    label: "ðŸ”€ " + (lang === "fr" ? "Mixte (plusieurs types)" : "Mixed (multiple types)")
  }];
  var scopeOptions = [{
    value: "pilot",
    label: "ðŸ”¬ " + (lang === "fr" ? "Pilote (1-3 sites)" : "Pilot (1-3 sites)")
  }, {
    value: "local",
    label: "ðŸ“ " + (lang === "fr" ? "Local (1 ville/district)" : "Local (1 city/district)")
  }, {
    value: "regional",
    label: "ðŸ—ºï¸ " + (lang === "fr" ? "RÃ©gional (1 rÃ©gion/province)" : "Regional (1 region/province)")
  }, {
    value: "national",
    label: "ðŸ›ï¸ " + (lang === "fr" ? "National" : "National")
  }, {
    value: "multi_country",
    label: "ðŸŒ " + (lang === "fr" ? "Multi-pays" : "Multi-country")
  }];
  var teamSizeOptions = [{
    value: "1-2",
    label: "ðŸ‘¤ 1-2 " + (lang === "fr" ? "personnes" : "people")
  }, {
    value: "3-5",
    label: "ðŸ‘¥ 3-5 " + (lang === "fr" ? "personnes" : "people")
  }, {
    value: "6-10",
    label: "ðŸ‘¥ 6-10 " + (lang === "fr" ? "personnes" : "people")
  }, {
    value: "11-20",
    label: "ðŸ‘¥ 11-20 " + (lang === "fr" ? "personnes" : "people")
  }, {
    value: "21-50",
    label: "ðŸ‘¥ 21-50 " + (lang === "fr" ? "personnes" : "people")
  }, {
    value: "50+",
    label: "ðŸ‘¥ 50+ " + (lang === "fr" ? "personnes" : "people")
  }];
  var timelineOptions = [{
    value: "3",
    label: "â±ï¸ 3 " + (lang === "fr" ? "mois (pilote rapide)" : "months (quick pilot)")
  }, {
    value: "6",
    label: "â±ï¸ 6 " + (lang === "fr" ? "mois" : "months")
  }, {
    value: "12",
    label: "ðŸ“… 12 " + (lang === "fr" ? "mois (1 an)" : "months (1 year)")
  }, {
    value: "18",
    label: "ðŸ“… 18 " + (lang === "fr" ? "mois" : "months")
  }, {
    value: "24",
    label: "ðŸ“… 24 " + (lang === "fr" ? "mois (2 ans)" : "months (2 years)")
  }, {
    value: "36",
    label: "ðŸ“… 36 " + (lang === "fr" ? "mois (3 ans)" : "months (3 years)")
  }, {
    value: "48+",
    label: "ðŸ“… 48+ " + (lang === "fr" ? "mois (>3 ans)" : "months (>3 years)")
  }];
  var budgetOptions = [{
    value: "unknown",
    label: "â“ " + (lang === "fr" ? "Non dÃ©fini / Ã€ dÃ©terminer" : "Not defined / TBD")
  }, {
    value: "<10k",
    label: "ðŸ’° < 10,000 â‚¬/$"
  }, {
    value: "10-50k",
    label: "ðŸ’° 10,000 - 50,000 â‚¬/$"
  }, {
    value: "50-100k",
    label: "ðŸ’°ðŸ’° 50,000 - 100,000 â‚¬/$"
  }, {
    value: "100-500k",
    label: "ðŸ’°ðŸ’° 100,000 - 500,000 â‚¬/$"
  }, {
    value: "500k-1m",
    label: "ðŸ’°ðŸ’°ðŸ’° 500,000 - 1M â‚¬/$"
  }, {
    value: ">1m",
    label: "ðŸ’°ðŸ’°ðŸ’° > 1M â‚¬/$"
  }];
  var experienceOptions = [{
    value: "none",
    label: "ðŸ†• " + (lang === "fr" ? "PremiÃ¨re expÃ©rience en implÃ©mentation" : "First implementation experience")
  }, {
    value: "some",
    label: "ðŸ“š " + (lang === "fr" ? "Quelques projets similaires (1-3)" : "Some similar projects (1-3)")
  }, {
    value: "experienced",
    label: "â­ " + (lang === "fr" ? "ExpÃ©rience significative (4-10 projets)" : "Significant experience (4-10 projects)")
  }, {
    value: "expert",
    label: "ðŸ† " + (lang === "fr" ? "Expert en implÃ©mentation (10+ projets)" : "Implementation expert (10+ projects)")
  }];
  var barrierCategoryOptions = [{
    value: "knowledge",
    label: "ðŸ“š " + (lang === "fr" ? "Connaissances / Formation insuffisante" : "Knowledge / Insufficient training")
  }, {
    value: "attitudes",
    label: "ðŸ§  " + (lang === "fr" ? "Attitudes / RÃ©sistance au changement" : "Attitudes / Resistance to change")
  }, {
    value: "resources",
    label: "ðŸ’µ " + (lang === "fr" ? "Ressources (temps, argent, personnel)" : "Resources (time, money, staff)")
  }, {
    value: "infrastructure",
    label: "ðŸ—ï¸ " + (lang === "fr" ? "Infrastructure / Ã‰quipement / IT" : "Infrastructure / Equipment / IT")
  }, {
    value: "leadership",
    label: "ðŸ‘” " + (lang === "fr" ? "Leadership / Soutien institutionnel faible" : "Leadership / Weak institutional support")
  }, {
    value: "culture",
    label: "ðŸŒ " + (lang === "fr" ? "Culture / Stigma / Croyances" : "Culture / Stigma / Beliefs")
  }, {
    value: "policy",
    label: "ðŸ“œ " + (lang === "fr" ? "Politiques / RÃ©glementation" : "Policies / Regulations")
  }, {
    value: "coordination",
    label: "ðŸ”— " + (lang === "fr" ? "Coordination / Communication" : "Coordination / Communication")
  }, {
    value: "turnover",
    label: "ðŸ”„ " + (lang === "fr" ? "Rotation du personnel / InstabilitÃ©" : "Staff turnover / Instability")
  }, {
    value: "complexity",
    label: "ðŸ§© " + (lang === "fr" ? "ComplexitÃ© de l'intervention" : "Intervention complexity")
  }];
  var outcomeOptions = [{
    value: "acceptability",
    label: "âœ… " + (lang === "fr" ? "AcceptabilitÃ© par les acteurs" : "Acceptability by stakeholders")
  }, {
    value: "adoption",
    label: "ðŸ“ˆ " + (lang === "fr" ? "Adoption de la pratique" : "Practice adoption")
  }, {
    value: "fidelity",
    label: "ðŸŽ¯ " + (lang === "fr" ? "FidÃ©litÃ© Ã  l'intervention" : "Intervention fidelity")
  }, {
    value: "coverage",
    label: "ðŸ“Š " + (lang === "fr" ? "Couverture / PÃ©nÃ©tration" : "Coverage / Penetration")
  }, {
    value: "sustainability",
    label: "â™»ï¸ " + (lang === "fr" ? "PÃ©rennitÃ© / DurabilitÃ©" : "Sustainability")
  }, {
    value: "cost",
    label: "ðŸ’° " + (lang === "fr" ? "CoÃ»t-efficacitÃ©" : "Cost-effectiveness")
  }, {
    value: "patient_outcomes",
    label: "â¤ï¸ " + (lang === "fr" ? "AmÃ©lioration clinique des bÃ©nÃ©ficiaires" : "Clinical improvement of beneficiaries")
  }, {
    value: "equity",
    label: "âš–ï¸ " + (lang === "fr" ? "Ã‰quitÃ© d'accÃ¨s" : "Access equity")
  }];
  var questions = [
  // â•â•â•â•â•â•â• PHASE 1: IDENTIFICATION (4 questions) â•â•â•â•â•â•â•
  {
    id: "title",
    type: "text",
    phase: 1,
    phaseLabel: lang === "fr" ? "ðŸ“‹ Identification" : "ðŸ“‹ Identification",
    q: lang === "fr" ? "Titre du projet" : "Project title",
    placeholder: lang === "fr" ? "Ex: IntÃ©gration du programme mhGAP dans 45 centres de santÃ© primaire de la rÃ©gion Souss-Massa" : "Ex: Integration of mhGAP program in 45 primary health centers in the Souss-Massa region",
    help: lang === "fr" ? "Un titre clair et descriptif (minimum 10 caractÃ¨res, 3 mots)" : "A clear and descriptive title (minimum 10 characters, 3 words)",
    required: true
  }, {
    id: "organization",
    type: "text",
    phase: 1,
    q: lang === "fr" ? "Organisation porteuse" : "Lead organization",
    placeholder: lang === "fr" ? "Ex: Direction RÃ©gionale de la SantÃ© Souss-Massa, MinistÃ¨re de la SantÃ©" : "Ex: Regional Health Directorate, Ministry of Health",
    help: lang === "fr" ? "Nom complet de l'organisation responsable du projet" : "Full name of the organization responsible for the project",
    required: true
  }, {
    id: "country",
    type: "select",
    phase: 1,
    q: lang === "fr" ? "Pays d'implÃ©mentation" : "Implementation country",
    options: countryOptions,
    help: lang === "fr" ? "Le pays dÃ©termine le niveau de ressources et adapte les recommandations" : "Country determines resource level and adapts recommendations",
    required: true
  }, {
    id: "domain",
    type: "select",
    phase: 1,
    q: lang === "fr" ? "Domaine d'intervention" : "Intervention domain",
    options: domainOptions,
    help: lang === "fr" ? "Le domaine influence les stratÃ©gies et barriÃ¨res typiques" : "Domain influences typical strategies and barriers",
    required: true
  },
  // â•â•â•â•â•â•â• PHASE 2: CONTEXTE (4 questions) â•â•â•â•â•â•â•
  {
    id: "context",
    type: "textarea",
    phase: 2,
    phaseLabel: lang === "fr" ? "ðŸ¢ Contexte" : "ðŸ¢ Context",
    q: lang === "fr" ? "Contexte et problÃ©matique" : "Context and problem statement",
    placeholder: lang === "fr" ? "DÃ©crivez en dÃ©tail:\nâ€¢ La situation actuelle et ses lacunes\nâ€¢ Les donnÃ©es Ã©pidÃ©miologiques ou statistiques pertinentes\nâ€¢ Le problÃ¨me que vous cherchez Ã  rÃ©soudre\nâ€¢ Les tentatives prÃ©cÃ©dentes (succÃ¨s/Ã©checs)\nâ€¢ L'urgence ou la prioritÃ© du changement" : "Describe in detail:\nâ€¢ Current situation and gaps\nâ€¢ Relevant epidemiological or statistical data\nâ€¢ The problem you're trying to solve\nâ€¢ Previous attempts (successes/failures)\nâ€¢ Urgency or priority of change",
    help: lang === "fr" ? "Minimum 100 caractÃ¨res. Plus vous dÃ©taillez, plus les recommandations seront prÃ©cises." : "Minimum 100 characters. More detail means more precise recommendations.",
    rows: 6,
    required: true
  }, {
    id: "settingType",
    type: "select",
    phase: 2,
    q: lang === "fr" ? "Type de structure / contexte" : "Setting type / context",
    options: settingOptions,
    help: lang === "fr" ? "Le type de structure influence les stratÃ©gies adaptÃ©es" : "Setting type influences appropriate strategies",
    required: true
  }, {
    id: "settingCount",
    type: "number",
    phase: 2,
    q: lang === "fr" ? "Nombre de sites / structures concernÃ©s" : "Number of sites / facilities involved",
    placeholder: lang === "fr" ? "Ex: 45" : "Ex: 45",
    help: lang === "fr" ? "Combien de sites seront impliquÃ©s dans l'implÃ©mentation?" : "How many sites will be involved in implementation?",
    min: 1,
    max: 10000,
    required: true
  }, {
    id: "geographicScope",
    type: "select",
    phase: 2,
    q: lang === "fr" ? "Ã‰tendue gÃ©ographique" : "Geographic scope",
    options: scopeOptions,
    help: lang === "fr" ? "L'Ã©tendue gÃ©ographique influence la complexitÃ© logistique" : "Geographic scope influences logistical complexity",
    required: true
  },
  // â•â•â•â•â•â•â• PHASE 3: POPULATION & Ã‰QUIPE (4 questions) â•â•â•â•â•â•â•
  {
    id: "population",
    type: "textarea",
    phase: 3,
    phaseLabel: lang === "fr" ? "ðŸŽ¯ Population & Ã‰quipe" : "ðŸŽ¯ Population & Team",
    q: lang === "fr" ? "Population cible de l'intervention" : "Target population for the intervention",
    placeholder: lang === "fr" ? "Ex: 200 infirmiers gÃ©nÃ©ralistes dans 45 centres de santÃ© primaire, majoritairement fÃ©minins (75%), Ã¢ge moyen 35 ans, expÃ©rience moyenne 8 ans en soins primaires, formation initiale de 3 ans" : "Ex: 200 general nurses in 45 primary health centers, mostly female (75%), average age 35, average 8 years experience in primary care, 3-year initial training",
    help: lang === "fr" ? "DÃ©crivez qui sera directement affectÃ© par l'intervention (nombre, caractÃ©ristiques)" : "Describe who will be directly affected by the intervention (number, characteristics)",
    rows: 3,
    required: true
  }, {
    id: "populationSize",
    type: "number",
    phase: 3,
    q: lang === "fr" ? "Nombre total de personnes ciblÃ©es" : "Total number of people targeted",
    placeholder: lang === "fr" ? "Ex: 200" : "Ex: 200",
    help: lang === "fr" ? "Nombre approximatif de personnes directement concernÃ©es" : "Approximate number of people directly involved",
    min: 1,
    required: true
  }, {
    id: "beneficiaries",
    type: "textarea",
    phase: 3,
    q: lang === "fr" ? "BÃ©nÃ©ficiaires finaux (si diffÃ©rents de la population cible)" : "End beneficiaries (if different from target population)",
    placeholder: lang === "fr" ? "Ex: 50,000 patients adultes avec troubles mentaux courants (dÃ©pression, anxiÃ©tÃ©) dans la zone de couverture des 45 centres de santÃ©" : "Ex: 50,000 adult patients with common mental disorders (depression, anxiety) in the coverage area of the 45 health centers",
    help: lang === "fr" ? "Les personnes qui bÃ©nÃ©ficieront indirectement du projet (patients, usagers, etc.)" : "People who will indirectly benefit from the project (patients, users, etc.)",
    rows: 2,
    required: false
  }, {
    id: "teamSize",
    type: "select",
    phase: 3,
    q: lang === "fr" ? "Taille de l'Ã©quipe projet" : "Project team size",
    options: teamSizeOptions,
    help: lang === "fr" ? "Nombre de personnes dans l'Ã©quipe de coordination/implÃ©mentation" : "Number of people in the coordination/implementation team",
    required: true
  },
  // â•â•â•â•â•â•â• PHASE 4: OBJECTIFS (3 questions) â•â•â•â•â•â•â•
  {
    id: "objectives",
    type: "textarea",
    phase: 4,
    phaseLabel: lang === "fr" ? "ðŸŽ¯ Objectifs" : "ðŸŽ¯ Objectives",
    q: lang === "fr" ? "Objectifs du projet" : "Project objectives",
    placeholder: lang === "fr" ? "Objectif gÃ©nÃ©ral:\nâ€¢ AmÃ©liorer la dÃ©tection et prise en charge des troubles mentaux courants dans les centres de santÃ© primaire\n\nObjectifs spÃ©cifiques:\n1. Former 80% des infirmiers au protocole mhGAP d'ici 12 mois\n2. Augmenter le taux de dÃ©tection des troubles dÃ©pressifs de 15% Ã  45%\n3. RÃ©duire le dÃ©lai de prise en charge de 3 mois Ã  2 semaines" : "General objective:\nâ€¢ Improve detection and management of common mental disorders in primary health centers\n\nSpecific objectives:\n1. Train 80% of nurses in mhGAP protocol within 12 months\n2. Increase depression detection rate from 15% to 45%\n3. Reduce time to treatment from 3 months to 2 weeks",
    help: lang === "fr" ? "Formulez des objectifs SMART (SpÃ©cifiques, Mesurables, Atteignables, RÃ©alistes, Temporels)" : "Formulate SMART objectives (Specific, Measurable, Achievable, Realistic, Time-bound)",
    rows: 6,
    required: true
  }, {
    id: "expectedOutcomes",
    type: "multiselect",
    phase: 4,
    q: lang === "fr" ? "RÃ©sultats d'implÃ©mentation attendus (sÃ©lectionnez 2-5)" : "Expected implementation outcomes (select 2-5)",
    options: outcomeOptions,
    help: lang === "fr" ? "Quels indicateurs d'implÃ©mentation allez-vous mesurer?" : "Which implementation indicators will you measure?",
    minSelect: 2,
    maxSelect: 5,
    required: true
  }, {
    id: "phase",
    type: "select",
    phase: 4,
    q: lang === "fr" ? "Phase actuelle du projet (EPIS)" : "Current project phase (EPIS)",
    options: phaseOptions,
    showDescription: true,
    help: lang === "fr" ? "Ã€ quelle Ã©tape en Ãªtes-vous dans le cycle d'implÃ©mentation?" : "What stage are you at in the implementation cycle?",
    required: true
  },
  // â•â•â•â•â•â•â• PHASE 5: BARRIÃˆRES & FACILITATEURS (3 questions) â•â•â•â•â•â•â•
  {
    id: "barriers",
    type: "textarea",
    phase: 5,
    phaseLabel: lang === "fr" ? "âš ï¸ BarriÃ¨res & Facilitateurs" : "âš ï¸ Barriers & Facilitators",
    q: lang === "fr" ? "BarriÃ¨res et dÃ©fis anticipÃ©s" : "Anticipated barriers and challenges",
    placeholder: lang === "fr" ? "DÃ©crivez les obstacles attendus:\nâ€¢ Individuels: rÃ©sistance des soignants, manque de temps, peur du changement\nâ€¢ Organisationnels: surcharge de travail, absence de supervision, rotation du personnel\nâ€¢ SystÃ©miques: financement incertain, politiques non alignÃ©es, absence de donnÃ©es\nâ€¢ Culturels: stigma autour de la santÃ© mentale, croyances traditionnelles" : "Describe expected obstacles:\nâ€¢ Individual: staff resistance, lack of time, fear of change\nâ€¢ Organizational: workload, lack of supervision, staff turnover\nâ€¢ Systemic: uncertain funding, misaligned policies, lack of data\nâ€¢ Cultural: mental health stigma, traditional beliefs",
    help: lang === "fr" ? "Minimum 50 caractÃ¨res. Plus vous identifiez de barriÃ¨res, plus les stratÃ©gies seront ciblÃ©es." : "Minimum 50 characters. More barriers identified means more targeted strategies.",
    rows: 5,
    required: true
  }, {
    id: "barrierCategories",
    type: "multiselect",
    phase: 5,
    q: lang === "fr" ? "CatÃ©gories de barriÃ¨res principales (sÃ©lectionnez 1-5)" : "Main barrier categories (select 1-5)",
    options: barrierCategoryOptions,
    help: lang === "fr" ? "Cochez les catÃ©gories de barriÃ¨res les plus importantes" : "Check the most important barrier categories",
    minSelect: 1,
    maxSelect: 5,
    required: true
  }, {
    id: "facilitators",
    type: "textarea",
    phase: 5,
    q: lang === "fr" ? "Facilitateurs et atouts existants" : "Existing facilitators and assets",
    placeholder: lang === "fr" ? "Ex: Soutien du MinistÃ¨re de la SantÃ©, 5 champions locaux dÃ©jÃ  identifiÃ©s, budget de 150,000â‚¬ allouÃ©, expÃ©rience rÃ©ussie dans 2 rÃ©gions pilotes, partenariat avec l'OMS" : "Ex: Ministry of Health support, 5 local champions already identified, â‚¬150,000 budget allocated, successful experience in 2 pilot regions, WHO partnership",
    help: lang === "fr" ? "Quels atouts pouvez-vous mobiliser pour rÃ©ussir?" : "What assets can you leverage for success?",
    rows: 3,
    required: false
  },
  // â•â•â•â•â•â•â• PHASE 6: RESSOURCES & PLANNING (4 questions) â•â•â•â•â•â•â•
  {
    id: "timeline",
    type: "select",
    phase: 6,
    phaseLabel: lang === "fr" ? "ðŸ“… Ressources & Planning" : "ðŸ“… Resources & Planning",
    q: lang === "fr" ? "DurÃ©e estimÃ©e du projet" : "Estimated project duration",
    options: timelineOptions,
    help: lang === "fr" ? "La durÃ©e influence les stratÃ©gies et le sÃ©quenÃ§age des activitÃ©s" : "Duration influences strategies and activity sequencing",
    required: true
  }, {
    id: "budget",
    type: "select",
    phase: 6,
    q: lang === "fr" ? "Budget approximatif" : "Approximate budget",
    options: budgetOptions,
    help: lang === "fr" ? "Le budget influence les stratÃ©gies recommandÃ©es (certaines sont coÃ»teuses)" : "Budget influences recommended strategies (some are expensive)",
    required: false
  }, {
    id: "experience",
    type: "select",
    phase: 6,
    q: lang === "fr" ? "ExpÃ©rience prÃ©alable en science de l'implÃ©mentation" : "Prior implementation science experience",
    options: experienceOptions,
    help: lang === "fr" ? "Votre niveau d'expÃ©rience influence la complexitÃ© des recommandations" : "Your experience level influences recommendation complexity",
    required: false
  }, {
    id: "additionalInfo",
    type: "textarea",
    phase: 6,
    q: lang === "fr" ? "Informations complÃ©mentaires (optionnel)" : "Additional information (optional)",
    placeholder: lang === "fr" ? "Ajoutez toute information pertinente non couverte par les questions prÃ©cÃ©dentes:\nâ€¢ Contraintes spÃ©cifiques\nâ€¢ Partenaires clÃ©s\nâ€¢ Risques identifiÃ©s\nâ€¢ Questions particuliÃ¨res" : "Add any relevant information not covered by previous questions:\nâ€¢ Specific constraints\nâ€¢ Key partners\nâ€¢ Identified risks\nâ€¢ Specific questions",
    help: lang === "fr" ? "Informations supplÃ©mentaires pour affiner les recommandations" : "Additional information to refine recommendations",
    rows: 4,
    required: false
  }];

  // Calcul des phases pour la navigation
  var wizardPhases = [{
    id: 1,
    name: lang === "fr" ? "Identification" : "Identification",
    icon: "ðŸ“‹",
    questions: questions.filter(function (q) {
      return q.phase === 1;
    }).map(function (q) {
      return q.id;
    })
  }, {
    id: 2,
    name: lang === "fr" ? "Contexte" : "Context",
    icon: "ðŸ¢",
    questions: questions.filter(function (q) {
      return q.phase === 2;
    }).map(function (q) {
      return q.id;
    })
  }, {
    id: 3,
    name: lang === "fr" ? "Population" : "Population",
    icon: "ðŸŽ¯",
    questions: questions.filter(function (q) {
      return q.phase === 3;
    }).map(function (q) {
      return q.id;
    })
  }, {
    id: 4,
    name: lang === "fr" ? "Objectifs" : "Objectives",
    icon: "ðŸŽ¯",
    questions: questions.filter(function (q) {
      return q.phase === 4;
    }).map(function (q) {
      return q.id;
    })
  }, {
    id: 5,
    name: lang === "fr" ? "BarriÃ¨res" : "Barriers",
    icon: "âš ï¸",
    questions: questions.filter(function (q) {
      return q.phase === 5;
    }).map(function (q) {
      return q.id;
    })
  }, {
    id: 6,
    name: lang === "fr" ? "Ressources" : "Resources",
    icon: "ðŸ“…",
    questions: questions.filter(function (q) {
      return q.phase === 6;
    }).map(function (q) {
      return q.id;
    })
  }];
  function generateProtocol() {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // v9.0 - GÃ‰NÃ‰RATION AVEC INDICATEUR DE CHARGEMENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // Afficher l'indicateur de chargement
    setIsGenerating(true);
    setValidationErrors(null);

    // Utiliser setTimeout pour permettre au navigateur de mettre Ã  jour l'UI
    setTimeout(function () {
      try {
        // Validation optionnelle (assouplue pour dÃ©mo)
        if (window.MoudarValidator) {
          var validation = MoudarValidator.validateProject(answers, lang);
          setQualityScore(validation.qualityScore);

          // v9.0: On affiche les erreurs mais on continue quand mÃªme pour la dÃ©mo
          if (!validation.valid) {
            console.warn("[MOUDAR v9.0] Validation: certains champs incomplets, gÃ©nÃ©ration quand mÃªme...", validation.errors);
            // Ne plus bloquer - on continue pour la dÃ©mo
          }
        }

        // GÃ©nÃ©rer le protocole
        console.log("[MOUDAR v9.0] GÃ©nÃ©ration du protocole en cours...");
        var result = generateIntelligentProtocol(answers, lang);
        if (result) {
          setProtocol(result);
          setStep(-1); // Basculer vers la vue du protocole gÃ©nÃ©rÃ©

          // Sauvegarder automatiquement
          var projectToSave = Object.assign({}, answers, {
            id: currentProjectId,
            protocol: result,
            status: "protocol"
          });
          var savedProject = StorageManager.saveProject(projectToSave);
          setCurrentProjectId(savedProject.id);
          setSaved(true);
          setTimeout(function () {
            setSaved(false);
          }, 2000);
          console.log("[MOUDAR v9.0] âœ… Protocole gÃ©nÃ©rÃ© avec succÃ¨s!");
        } else {
          console.error("[MOUDAR v9.0] Erreur: protocole vide");
          alert(lang === "fr" ? "Erreur lors de la gÃ©nÃ©ration. Veuillez rÃ©essayer." : "Generation error. Please try again.");
        }
      } catch (e) {
        console.error("[MOUDAR v9.0] Erreur de gÃ©nÃ©ration:", e);
        alert(lang === "fr" ? "Erreur: " + e.message : "Error: " + e.message);
      } finally {
        setIsGenerating(false);
      }
    }, 100); // Petit dÃ©lai pour permettre l'affichage du loader
  }

  // v8.2 - Fonction pour valider en temps rÃ©el un champ
  function validateFieldOnChange(fieldId, value) {
    if (window.MoudarValidator) {
      var result = MoudarValidator.validateField(fieldId, value, lang);
      // Mettre Ã  jour le score de qualitÃ© en temps rÃ©el
      var tempAnswers = Object.assign({}, answers);
      tempAnswers[fieldId] = value;
      var validation = MoudarValidator.validateProject(tempAnswers, lang);
      setQualityScore(validation.qualityScore);
    }
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // SYSTÃˆME DE FEEDBACK IA ADAPTATIF
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  var [showFeedbackModal, setShowFeedbackModal] = useState(false);
  var [feedbackRating, setFeedbackRating] = useState(4);
  var [feedbackAccepted, setFeedbackAccepted] = useState(true);
  var [lastRecId, setLastRecId] = useState(null);
  function saveProject() {
    var projectToSave = Object.assign({}, answers, {
      id: currentProjectId,
      protocol: protocol,
      status: protocol ? "protocol" : "draft"
    });
    var savedProject = StorageManager.saveProject(projectToSave);
    setCurrentProjectId(savedProject.id);
    setSaved(true);

    // Si protocole gÃ©nÃ©rÃ© par IA, demander feedback
    if (protocol && protocol.aiConfidence && protocol.aiRawRecommendations) {
      setLastRecId((protocol.aiRawRecommendations.metadata || {}).recommendationId || 'REC_' + Date.now());
      setTimeout(function () {
        setSaved(false);
        setShowFeedbackModal(true);
      }, 1500);
    } else {
      setTimeout(function () {
        setSaved(false);
      }, 2000);
    }
  }
  function submitFeedback() {
    if (lastRecId && protocol && protocol.aiRawRecommendations) {
      // Extraire les IDs des stratÃ©gies recommandÃ©es
      var selectedStrategies = [];
      if (protocol.aiRawRecommendations.recommendations && protocol.aiRawRecommendations.recommendations.strategies ? protocol.aiRawRecommendations.recommendations.strategies.top : null) {
        selectedStrategies = protocol.aiRawRecommendations.recommendations.strategies.top.map(function (s) {
          return s.id;
        });
      }

      // Enregistrer le feedback
      MoudarEngine.recordFeedback(lastRecId, {
        accepted: feedbackAccepted,
        modified: !feedbackAccepted,
        rating: feedbackRating,
        outcome: null,
        // sera renseignÃ© plus tard
        context: {
          project: protocol.aiRawRecommendations.input,
          selectedStrategies: selectedStrategies,
          confidence: protocol.aiConfidence
        }
      });
      console.log("âœ… Feedback enregistrÃ© pour", lastRecId, "- Rating:", feedbackRating, "- Accepted:", feedbackAccepted);
    }
    setShowFeedbackModal(false);
    setFeedbackRating(4);
    setFeedbackAccepted(true);
  }
  function skipFeedback() {
    setShowFeedbackModal(false);
    setFeedbackRating(4);
    setFeedbackAccepted(true);
  }
  function calibrateAI() {
    var result = MoudarEngine.calibrateFromFeedback({
      learningRate: 0.1,
      minSamples: 3
    });
    if (result.adjusted) {
      alert(lang === "fr" ? "âœ… Moteur IA recalibrÃ©!\n" + result.strategiesUpdated + " stratÃ©gies ajustÃ©es.\n" + result.totalAdjustments + " poids modifiÃ©s." : "âœ… AI Engine recalibrated!\n" + result.strategiesUpdated + " strategies adjusted.\n" + result.totalAdjustments + " weights modified.");
    } else {
      alert(lang === "fr" ? "âš ï¸ Pas assez de donnÃ©es pour recalibrer.\nContinuez Ã  utiliser Moudar pour amÃ©liorer les recommandations." : "âš ï¸ Not enough data to recalibrate.\nKeep using Moudar to improve recommendations.");
    }
  }

  // Composant Modal de Feedback
  function FeedbackModal() {
    if (!showFeedbackModal) return null;
    return /*#__PURE__*/React.createElement("div", {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, /*#__PURE__*/React.createElement("div", {
      className: "bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 transform transition-all"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-center mb-6"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-4xl mb-2"
    }, "\uD83E\uDD16"), /*#__PURE__*/React.createElement("h3", {
      className: "text-xl font-bold text-gray-800"
    }, lang === "fr" ? "Aidez Moudar Ã  s'amÃ©liorer" : "Help Moudar improve"), /*#__PURE__*/React.createElement("p", {
      className: "text-gray-600 text-sm mt-2"
    }, lang === "fr" ? "Votre feedback permet d'ajuster l'algorithme" : "Your feedback helps calibrate the algorithm")), /*#__PURE__*/React.createElement("div", {
      className: "space-y-4"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
      className: "block text-sm font-medium text-gray-700 mb-2"
    }, lang === "fr" ? "Les recommandations sont pertinentes ?" : "Are recommendations relevant?"), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-3"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setFeedbackAccepted(true);
      },
      className: "flex-1 py-3 rounded-lg font-medium transition " + (feedbackAccepted ? "bg-green-500 text-white" : "bg-gray-100 text-gray-600 hover:bg-gray-200")
    }, "\u2713 ", lang === "fr" ? "Oui" : "Yes"), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setFeedbackAccepted(false);
      },
      className: "flex-1 py-3 rounded-lg font-medium transition " + (!feedbackAccepted ? "bg-red-500 text-white" : "bg-gray-100 text-gray-600 hover:bg-gray-200")
    }, "\u2717 ", lang === "fr" ? "Non" : "No"))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
      className: "block text-sm font-medium text-gray-700 mb-2"
    }, lang === "fr" ? "Note globale" : "Overall rating", ": ", /*#__PURE__*/React.createElement("span", {
      className: "text-indigo-600 font-bold"
    }, feedbackRating, "/5")), /*#__PURE__*/React.createElement("div", {
      className: "flex justify-center gap-2"
    }, [1, 2, 3, 4, 5].map(function (n) {
      return /*#__PURE__*/React.createElement("button", {
        key: n,
        onClick: function () {
          setFeedbackRating(n);
        },
        className: "w-10 h-10 rounded-full text-xl transition " + (n <= feedbackRating ? "bg-yellow-400" : "bg-gray-200")
      }, "\u2605");
    })))), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-3 mt-6"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: skipFeedback,
      className: "flex-1 py-3 rounded-lg font-medium bg-gray-100 text-gray-600 hover:bg-gray-200 transition"
    }, lang === "fr" ? "Plus tard" : "Later"), /*#__PURE__*/React.createElement("button", {
      onClick: submitFeedback,
      className: "flex-1 py-3 rounded-lg font-medium bg-gradient-to-r from-indigo-500 to-purple-500 text-white hover:from-indigo-600 hover:to-purple-600 transition"
    }, lang === "fr" ? "Envoyer" : "Submit")), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-400 text-center mt-4"
    }, lang === "fr" ? "Ce feedback amÃ©liore les recommandations futures" : "This feedback improves future recommendations")));
  }
  function exportWord() {
    if (!protocol) {
      alert(lang === "fr" ? "Aucun protocole Ã  exporter" : "No protocol to export");
      return;
    }
    try {
      // Infos de base
      var projectTitle = answers.title || (lang === "fr" ? "Protocole d'implementation" : "Implementation protocol");
      var orgLine = (answers.organization || "") + " - Moudar v8.0";
      var domainLabel = answers.domain && DOMAINS[answers.domain] ? tObj(DOMAINS[answers.domain], lang) : "-";

      // Labels de phase
      var phaseLabel = "-";
      if (answers.phase === "exploration") {
        phaseLabel = lang === "fr" ? "Exploration" : "Exploration";
      } else if (answers.phase === "preparation") {
        phaseLabel = lang === "fr" ? "Preparation" : "Preparation";
      } else if (answers.phase === "implementation") {
        phaseLabel = lang === "fr" ? "Implementation" : "Implementation";
      } else if (answers.phase === "sustainment") {
        phaseLabel = lang === "fr" ? "Perennisation" : "Sustainment";
      }
      var populationText = answers.population || "-";
      var contextText = answers.context || "-";
      var barriersText = answers.barriers || "-";

      // DÃ©finir sectorTerms et autoSummary
      var sectorTerms = SECTOR_TERMS[answers.domain] || SECTOR_TERMS["default"];
      var autoSummary = protocol.autoSummary || null;
      var frameworksList = protocol.frameworks || [];
      var strategiesList = protocol.strategies || [];
      var outcomesList = protocol.outcomes || [];
      var recommendationsList = protocol.recommendations || [];
      var children = [];

      // Titre
      children.push(new docx.Paragraph({
        text: projectTitle,
        heading: docx.HeadingLevel.TITLE,
        alignment: docx.AlignmentType.CENTER
      }));
      children.push(new docx.Paragraph({
        text: orgLine,
        alignment: docx.AlignmentType.CENTER
      }));
      children.push(new docx.Paragraph({
        text: new Date().toLocaleDateString(),
        alignment: docx.AlignmentType.CENTER
      }));
      children.push(new docx.Paragraph({
        text: ""
      }));

      // 1. Resume du projet
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "1. Resume du projet" : "1. Project summary",
        heading: docx.HeadingLevel.HEADING_1
      }));
      if (lang === "fr") {
        var programLabel = sectorTerms && sectorTerms.program && sectorTerms.program.fr ? sectorTerms.program.fr : "programme / intervention";
        var actorsLabel = sectorTerms && sectorTerms.actors && sectorTerms.actors.fr ? sectorTerms.actors.fr : "beneficiaires";
        var summaryLine = autoSummary || "Ce " + programLabel + " vise a ameliorer les resultats pour " + (populationText && populationText !== "-" ? populationText : "les " + actorsLabel) + " dans le domaine de " + domainLabel + ", en phase " + phaseLabel + ".";
        children.push(new docx.Paragraph({
          text: summaryLine
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "Ce document propose un squelette de protocole d'implementation pour ce projet."
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "Contexte (resume) : " + contextText
        }));
      } else {
        var programLabelEn = sectorTerms && sectorTerms.program && sectorTerms.program.en ? sectorTerms.program.en : "program / intervention";
        var actorsLabelEn = sectorTerms && sectorTerms.actors && sectorTerms.actors.en ? sectorTerms.actors.en : "beneficiaries";
        var summaryLineEn = autoSummary || "This " + programLabelEn + " aims to improve outcomes for " + (populationText && populationText !== "-" ? populationText : "the " + actorsLabelEn) + " in the domain of " + domainLabel + ", in the " + phaseLabel + " phase.";
        children.push(new docx.Paragraph({
          text: summaryLineEn
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "This document provides a draft implementation protocol for this project."
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "Context (summary): " + contextText
        }));
      }
      children.push(new docx.Paragraph({
        text: ""
      }));

      // 2. Cadre conceptuel
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "2. Cadre conceptuel d'implementation" : "2. Implementation framework",
        heading: docx.HeadingLevel.HEADING_1
      }));
      if (frameworksList.length) {
        children.push(new docx.Paragraph({
          text: lang === "fr" ? "Cadres proposes pour structurer l'analyse et le suivi :" : "Proposed frameworks to structure analysis and monitoring:"
        }));
        frameworksList.forEach(function (fw) {
          children.push(new docx.Paragraph({
            text: "- " + fw
          }));
        });
      } else {
        children.push(new docx.Paragraph({
          text: lang === "fr" ? "Aucun cadre specifique defini." : "No specific framework defined."
        }));
      }
      children.push(new docx.Paragraph({
        text: ""
      }));

      // 3. Strategies ERIC
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "3. Strategies d'implementation (ERIC)" : "3. Implementation strategies (ERIC)",
        heading: docx.HeadingLevel.HEADING_1
      }));
      if (strategiesList.length) {
        children.push(new docx.Paragraph({
          text: lang === "fr" ? "Liste preliminaire des strategies a mobiliser :" : "Preliminary list of strategies to be used:"
        }));
        strategiesList.forEach(function (st) {
          children.push(new docx.Paragraph({
            text: "- " + st
          }));
        });
      } else {
        children.push(new docx.Paragraph({
          text: lang === "fr" ? "Aucune strategie ERIC n'a encore ete selectionnee." : "No ERIC strategy has been selected yet."
        }));
      }
      children.push(new docx.Paragraph({
        text: ""
      }));

      // 4. Barrieres & leviers
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "4. Barrieres et leviers" : "4. Barriers and enablers",
        heading: docx.HeadingLevel.HEADING_1
      }));
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "Barrieres principales identifiees :" : "Main barriers identified:"
      }));
      children.push(new docx.Paragraph({
        text: barriersText
      }));
      children.push(new docx.Paragraph({
        text: ""
      }));
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "Note : completer en atelier les barrieres, leviers potentiels et hypotheses sur les mecanismes d'implementation." : "Note: complete in workshop with enablers and hypotheses about implementation mechanisms."
      }));
      children.push(new docx.Paragraph({
        text: ""
      }));

      // 5. Resultats d'implementation (Proctor)
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "5. Resultats d'implementation vises (Proctor)" : "5. Target implementation outcomes (Proctor)",
        heading: docx.HeadingLevel.HEADING_1
      }));
      if (outcomesList.length) {
        children.push(new docx.Paragraph({
          text: lang === "fr" ? "Resultats d'implementation a suivre :" : "Implementation outcomes to be monitored:"
        }));
        outcomesList.forEach(function (oc) {
          children.push(new docx.Paragraph({
            text: "- " + oc
          }));
        });
      } else {
        children.push(new docx.Paragraph({
          text: lang === "fr" ? "Aucun resultat d'implementation n'a encore ete defini." : "No implementation outcomes have been defined yet."
        }));
      }
      children.push(new docx.Paragraph({
        text: ""
      }));

      // 6. Recommandations contextuelles
      if (recommendationsList.length) {
        children.push(new docx.Paragraph({
          text: lang === "fr" ? "6. Recommandations contextuelles" : "6. Contextual recommendations",
          heading: docx.HeadingLevel.HEADING_1
        }));
        recommendationsList.forEach(function (rec) {
          children.push(new docx.Paragraph({
            text: "- " + rec
          }));
        });
        children.push(new docx.Paragraph({
          text: ""
        }));
      }

      // 7. Plan d'action initial
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "7. Plan d'action initial (a completer)" : "7. Initial action plan (to be completed)",
        heading: docx.HeadingLevel.HEADING_1
      }));
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "Proposez 3 a 5 actions concretes pour lancer l'implementation (activite, responsable, echeance, indicateurs de suivi)." : "Define 3-5 concrete actions to launch implementation (activity, responsible person, deadline, follow-up indicators)."
      }));
      children.push(new docx.Paragraph({
        text: ""
      }));

      // Tableau plan d'action
      var tableRows = [new docx.TableRow({
        children: [new docx.TableCell({
          children: [new docx.Paragraph({
            text: lang === "fr" ? "Activite" : "Activity"
          })]
        }), new docx.TableCell({
          children: [new docx.Paragraph({
            text: lang === "fr" ? "Responsable" : "Owner"
          })]
        }), new docx.TableCell({
          children: [new docx.Paragraph({
            text: lang === "fr" ? "Echeance" : "Deadline"
          })]
        }), new docx.TableCell({
          children: [new docx.Paragraph({
            text: lang === "fr" ? "Indicateur" : "Indicator"
          })]
        })]
      })];
      for (var i = 0; i < 5; i++) {
        tableRows.push(new docx.TableRow({
          children: [new docx.TableCell({
            children: [new docx.Paragraph({
              text: ""
            })]
          }), new docx.TableCell({
            children: [new docx.Paragraph({
              text: ""
            })]
          }), new docx.TableCell({
            children: [new docx.Paragraph({
              text: ""
            })]
          }), new docx.TableCell({
            children: [new docx.Paragraph({
              text: ""
            })]
          })]
        }));
      }
      children.push(new docx.Table({
        rows: tableRows
      }));
      children.push(new docx.Paragraph({
        text: ""
      }));

      // 8. Notes TIDieR
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "8. Notes pour decrire l'intervention (TIDieR)" : "8. Notes to describe the intervention (TIDieR-style)",
        heading: docx.HeadingLevel.HEADING_1
      }));
      if (lang === "fr") {
        children.push(new docx.Paragraph({
          text: "- Nom et raison d'etre de l'intervention :"
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "- Qui fait quoi (profils, roles) :"
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "- Comment l'intervention est-elle delivree (canaux, frequence, duree) :"
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "- Adaptations prevues selon les contextes :"
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "- Suivi de la fidelite (ce qui est bien applique / moins applique) :"
        }));
      } else {
        children.push(new docx.Paragraph({
          text: "- Name and rationale of the intervention:"
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "- Who does what (profiles, roles):"
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "- How the intervention is delivered (channels, frequency, duration):"
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "- Planned adaptations across contexts:"
        }));
        children.push(new docx.Paragraph({
          text: ""
        }));
        children.push(new docx.Paragraph({
          text: "- How fidelity will be monitored:"
        }));
      }
      children.push(new docx.Paragraph({
        text: ""
      }));
      children.push(new docx.Paragraph({
        text: "---"
      }));
      children.push(new docx.Paragraph({
        text: "Moudar v8.0 - Younes MOUDAR - contact@moudar.com",
        alignment: docx.AlignmentType.CENTER
      }));
      var doc = new docx.Document({
        sections: [{
          children: children
        }]
      });
      docx.Packer.toBlob(doc).then(function (blob) {
        var dateStr = new Date().toISOString().split("T")[0];
        saveAs(blob, "Protocol_" + (answers.title || "Moudar").replace(/\s+/g, "_") + "_" + dateStr + ".docx");
      }).catch(function (err) {
        console.error("[MOUDAR] Erreur export Word:", err);
        alert(lang === "fr" ? "Erreur lors de l'export Word" : "Error during Word export");
      });
    } catch (e) {
      console.error("[MOUDAR] Erreur export Word:", e);
      alert(lang === "fr" ? "Erreur lors de l'export Word: " + e.message : "Error during Word export: " + e.message);
    }
  }

  // Afficher directement le protocole si dÃ©jÃ  gÃ©nÃ©rÃ©
  if (protocol && step === -1) {
    setStep(questions.length);
  }
  if (protocol) {
    return /*#__PURE__*/React.createElement("div", {
      className: "max-w-3xl mx-auto fade-in"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-center mb-4"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setProtocol(null);
        setStep(0);
      },
      className: "text-blue-600 hover:text-blue-800"
    }, "\u2190 ", lang === "fr" ? "Modifier les rÃ©ponses" : "Edit answers"), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-2"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: saveProject,
      "aria-label": lang === "fr" ? "Sauvegarder ce projet" : "Save this project",
      className: "px-4 py-2 text-white rounded-lg text-sm transition " + (saved ? "bg-green-600" : "bg-gray-600 hover:bg-gray-700")
    }, saved ? "âœ“ " + (lang === "fr" ? "SauvegardÃ©" : "Saved") : "ðŸ’¾ " + (lang === "fr" ? "Sauvegarder" : "Save")), /*#__PURE__*/React.createElement("button", {
      onClick: exportWord,
      "aria-label": lang === "fr" ? "Exporter le protocole en Word" : "Export protocol to Word",
      className: "px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition"
    }, "\uD83D\uDCDD Word"))), /*#__PURE__*/React.createElement("div", {
      className: "bg-white rounded-xl shadow-xl overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "gradient-hero p-6 text-white"
    }, /*#__PURE__*/React.createElement("h2", {
      className: "text-2xl font-bold mb-1"
    }, answers.title), /*#__PURE__*/React.createElement("p", {
      className: "text-white/80"
    }, answers.organization), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-2 mt-3"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 bg-white/20 rounded text-sm"
    }, DOMAINS[answers.domain] ? DOMAINS[answers.domain].icon + " " + tObj(DOMAINS[answers.domain], lang) : ""), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 bg-white/20 rounded text-sm"
    }, PHASES[answers.phase] ? PHASES[answers.phase].icon + " " + tObj(PHASES[answers.phase], lang) : ""))), /*#__PURE__*/React.createElement("div", {
      className: "p-6 space-y-6"
    }, protocol.aiConfidence && /*#__PURE__*/React.createElement("div", {
      className: "bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl p-6 text-white shadow-2xl"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center justify-between mb-4"
    }, /*#__PURE__*/React.createElement("h3", {
      className: "text-lg font-bold flex items-center gap-2"
    }, "\uD83D\uDCCA ", lang === "fr" ? "Tableau de Bord ExÃ©cutif" : "Executive Dashboard"), /*#__PURE__*/React.createElement("span", {
      className: "px-3 py-1 bg-green-500/20 text-green-400 text-xs font-bold rounded-full"
    }, lang === "fr" ? "PrÃªt Ã  prÃ©senter" : "Ready to present")), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-5 gap-4 mb-6"
    }, /*#__PURE__*/React.createElement("div", {
      className: "col-span-1 flex flex-col items-center justify-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "relative w-24 h-24"
    }, /*#__PURE__*/React.createElement("svg", {
      className: "w-24 h-24 transform -rotate-90"
    }, /*#__PURE__*/React.createElement("circle", {
      cx: "48",
      cy: "48",
      r: "40",
      stroke: "rgba(255,255,255,0.1)",
      strokeWidth: "8",
      fill: "none"
    }), /*#__PURE__*/React.createElement("circle", {
      cx: "48",
      cy: "48",
      r: "40",
      stroke: "url(#scoreGradient)",
      strokeWidth: "8",
      fill: "none",
      strokeDasharray: 2 * Math.PI * 40,
      strokeDashoffset: 2 * Math.PI * 40 * (1 - protocol.aiConfidence),
      strokeLinecap: "round"
    }), /*#__PURE__*/React.createElement("defs", null, /*#__PURE__*/React.createElement("linearGradient", {
      id: "scoreGradient",
      x1: "0%",
      y1: "0%",
      x2: "100%",
      y2: "0%"
    }, /*#__PURE__*/React.createElement("stop", {
      offset: "0%",
      stopColor: "#22c55e"
    }), /*#__PURE__*/React.createElement("stop", {
      offset: "100%",
      stopColor: "#3b82f6"
    })))), /*#__PURE__*/React.createElement("div", {
      className: "absolute inset-0 flex items-center justify-center"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-2xl font-bold"
    }, (protocol.aiConfidence * 100).toFixed(0), "%"))), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-slate-400 mt-2"
    }, lang === "fr" ? "Score global" : "Overall score")), /*#__PURE__*/React.createElement("div", {
      className: "col-span-4 grid grid-cols-4 gap-3"
    }, /*#__PURE__*/React.createElement("div", {
      className: "bg-white/10 rounded-xl p-3 text-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl font-bold text-blue-400"
    }, protocol.aiRawRecommendations ? protocol.aiRawRecommendations.strategies.top.length : '?'), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-slate-400"
    }, lang === "fr" ? "StratÃ©gies" : "Strategies")), /*#__PURE__*/React.createElement("div", {
      className: "bg-white/10 rounded-xl p-3 text-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl font-bold text-green-400"
    }, answers.duration || '12'), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-slate-400"
    }, lang === "fr" ? "Mois" : "Months")), /*#__PURE__*/React.createElement("div", {
      className: "bg-white/10 rounded-xl p-3 text-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl font-bold text-amber-400"
    }, answers.sites || answers.population || '5'), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-slate-400"
    }, lang === "fr" ? "Sites" : "Sites")), /*#__PURE__*/React.createElement("div", {
      className: "bg-white/10 rounded-xl p-3 text-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl font-bold text-purple-400"
    }, protocol.aiDetectedBarriers ? protocol.aiDetectedBarriers.length : '3'), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-slate-400"
    }, lang === "fr" ? "BarriÃ¨res" : "Barriers")))), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-3 gap-3"
    }, /*#__PURE__*/React.createElement("div", {
      className: "bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-xl p-4 border border-green-500/30"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-green-400 text-sm font-bold mb-1"
    }, "\uD83D\uDCAA ", lang === "fr" ? "Point fort" : "Strength"), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-white/80"
    }, protocol.aiConfidence > 0.7 ? lang === "fr" ? "Protocole bien structurÃ© avec stratÃ©gies validÃ©es" : "Well-structured protocol with validated strategies" : lang === "fr" ? "Base solide pour l'implÃ©mentation" : "Solid foundation for implementation")), /*#__PURE__*/React.createElement("div", {
      className: "bg-gradient-to-br from-amber-500/20 to-orange-500/20 rounded-xl p-4 border border-amber-500/30"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-amber-400 text-sm font-bold mb-1"
    }, "\u26A0\uFE0F ", lang === "fr" ? "Point d'attention" : "Watch point"), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-white/80"
    }, protocol.aiDetectedBarriers && protocol.aiDetectedBarriers.length > 2 ? lang === "fr" ? "Plusieurs barriÃ¨res identifiÃ©es Ã  anticiper" : "Multiple barriers identified to anticipate" : lang === "fr" ? "Surveillance continue recommandÃ©e" : "Continuous monitoring recommended")), /*#__PURE__*/React.createElement("div", {
      className: "bg-gradient-to-br from-blue-500/20 to-indigo-500/20 rounded-xl p-4 border border-blue-500/30"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-blue-400 text-sm font-bold mb-1"
    }, "\uD83C\uDFAF ", lang === "fr" ? "Prochaine Ã©tape" : "Next step"), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-white/80"
    }, lang === "fr" ? "Valider avec les parties prenantes clÃ©s" : "Validate with key stakeholders")))), /*#__PURE__*/React.createElement("div", {
      className: "bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl p-4 border border-slate-200"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-gray-800 mb-4 flex items-center gap-2"
    }, "\u26A1 ", lang === "fr" ? "Actions essentielles" : "Essential Actions"), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-2 md:grid-cols-4 gap-3"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: exportWord,
      className: "p-4 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl text-white hover:from-blue-600 hover:to-blue-700 transition shadow-lg"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, "\uD83D\uDCDD"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold"
    }, lang === "fr" ? "Exporter Word" : "Export Word"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-blue-100"
    }, lang === "fr" ? "Protocole complet" : "Full protocol")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowXAIExplainer(true);
      },
      className: "p-4 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl text-white hover:from-purple-600 hover:to-indigo-700 transition shadow-lg"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, "\uD83D\uDD0D"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold"
    }, lang === "fr" ? "Pourquoi ?" : "Why?"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-purple-100"
    }, lang === "fr" ? "IA ExpliquÃ©e" : "Explainable AI")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowCertification(true);
      },
      className: "p-4 bg-gradient-to-br from-amber-500 to-yellow-500 rounded-xl text-white hover:from-amber-600 hover:to-yellow-600 transition shadow-lg"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, "\uD83C\uDFC6"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold"
    }, "Moudar Ready"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-amber-100"
    }, lang === "fr" ? "Certification" : "Certification")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowDocumentAnalyzer(true);
      },
      className: "p-4 bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl text-white hover:from-pink-600 hover:to-rose-700 transition shadow-lg relative overflow-hidden"
    }, /*#__PURE__*/React.createElement("span", {
      className: "absolute top-2 right-2 px-1.5 py-0.5 bg-white/30 text-xs font-bold rounded animate-pulse"
    }, "NEW"), /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, "\uD83D\uDCC4"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold"
    }, lang === "fr" ? "Analyser Doc" : "Analyze Doc"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-pink-100"
    }, lang === "fr" ? "Gaps IS auto" : "Auto IS gaps"))), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowAllTools(!showAllTools);
      },
      className: "mt-4 w-full py-2 text-sm text-gray-600 hover:text-gray-800 flex items-center justify-center gap-2 border-t border-gray-200 pt-4"
    }, showAllTools ? 'â–¼' : 'â–¶', " ", lang === "fr" ? "Voir tous les outils (16 modules)" : "See all tools (16 modules)")), protocol.aiConfidence && /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg border border-indigo-200"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center justify-between mb-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-indigo-800 font-semibold flex items-center gap-2"
    }, "\uD83E\uDD16 ", lang === "fr" ? "Recommandations IA Moudar" : "Moudar AI Recommendations"), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-indigo-600 bg-indigo-100 px-2 py-1 rounded"
    }, "v", protocol.aiEngineVersion || "2.0")), /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-3"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex-1 h-3 bg-indigo-200 rounded-full overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "h-full bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full transition-all duration-500",
      style: {
        width: protocol.aiConfidence * 100 + "%"
      }
    })), /*#__PURE__*/React.createElement("span", {
      className: "text-indigo-700 font-bold text-lg"
    }, (protocol.aiConfidence * 100).toFixed(0), "%")), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-indigo-600 mt-2"
    }, lang === "fr" ? "Confiance basÃ©e sur la complÃ©tude des donnÃ©es et le matching avec le graphe de connaissances" : "Confidence based on data completeness and knowledge graph matching"), protocol.aiDetectedBarriers && protocol.aiDetectedBarriers.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "mt-2 flex flex-wrap gap-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-indigo-700"
    }, lang === "fr" ? "BarriÃ¨res dÃ©tectÃ©es:" : "Detected barriers:"), protocol.aiDetectedBarriers.slice(0, 4).map(function (b) {
      return /*#__PURE__*/React.createElement("span", {
        key: b,
        className: "text-xs bg-indigo-100 text-indigo-600 px-2 py-0.5 rounded"
      }, b.replace(/_/g, ' '));
    }))), protocol.aiConfidence && /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-gradient-to-br from-slate-50 to-blue-50 rounded-xl border border-slate-200 shadow-sm"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-start gap-3"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl"
    }, "\uD83D\uDCCB"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-slate-800 mb-2"
    }, lang === "fr" ? "SynthÃ¨se IA de votre projet" : "AI Summary of your project"), /*#__PURE__*/React.createElement("p", {
      className: "text-slate-700 text-sm leading-relaxed"
    }, function () {
      var domain = answers.domain || "";
      var phase = answers.phase || "preparation";
      var phaseFr = phase === "exploration" ? "exploration" : phase === "preparation" ? "prÃ©paration" : phase === "implementation" ? "implÃ©mentation" : "pÃ©rennisation";
      var phaseEn = phase;
      var barrierCount = protocol.aiDetectedBarriers ? protocol.aiDetectedBarriers.length : 0;
      var stratCount = protocol.strategies ? protocol.strategies.length : 0;
      if (lang === "fr") {
        return "Ce projet en phase de " + phaseFr + " cible " + (domain === "mentalHealth" ? "la santÃ© mentale" : domain === "health" ? "le secteur santÃ©" : "l'implÃ©mentation d'interventions") + ". ";
      } else {
        return "This " + phaseEn + " phase project targets " + (domain === "mentalHealth" ? "mental health" : domain === "health" ? "healthcare" : "intervention implementation") + ". ";
      }
    }(), function () {
      var barrierCount = protocol.aiDetectedBarriers ? protocol.aiDetectedBarriers.length : 0;
      var stratCount = protocol.strategies ? protocol.strategies.length : 0;
      var confidence = protocol.aiConfidence || 0.5;
      if (lang === "fr") {
        return "L'IA a identifiÃ© " + barrierCount + " barriÃ¨re(s) principale(s) et recommande " + stratCount + " stratÃ©gies ERIC prioritaires avec un niveau de confiance de " + (confidence * 100).toFixed(0) + "%.";
      } else {
        return "The AI identified " + barrierCount + " main barrier(s) and recommends " + stratCount + " priority ERIC strategies with a " + (confidence * 100).toFixed(0) + "% confidence level.";
      }
    }())))), /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-purple-50 rounded-lg border border-purple-200"
    }, /*#__PURE__*/React.createElement("p", {
      className: "text-purple-800 text-sm"
    }, /*#__PURE__*/React.createElement("strong", null, lang === "fr" ? "Phase actuelle :" : "Current phase:"), " ", protocol.phaseDescription)), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-gray-800 mb-3"
    }, "\uD83D\uDCDA ", lang === "fr" ? "Cadres thÃ©oriques" : "Theoretical frameworks"), /*#__PURE__*/React.createElement("div", {
      className: "flex flex-wrap gap-2"
    }, (protocol.frameworks || []).map(function (f) {
      return /*#__PURE__*/React.createElement("span", {
        key: f,
        className: "px-3 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium"
      }, f);
    }))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-gray-800 mb-3"
    }, "\uD83C\uDFAF ", lang === "fr" ? "Outcomes d'implÃ©mentation (Proctor)" : "Implementation outcomes (Proctor)"), /*#__PURE__*/React.createElement("div", {
      className: "flex flex-wrap gap-2"
    }, (protocol.outcomes || []).map(function (o) {
      return /*#__PURE__*/React.createElement("span", {
        key: o,
        className: "px-3 py-2 bg-green-100 text-green-700 rounded-lg text-sm font-medium"
      }, o);
    }))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-gray-800 mb-3"
    }, "\u26A1 ", lang === "fr" ? "StratÃ©gies ERIC recommandÃ©es" : "Recommended ERIC strategies"), protocol.aiRawRecommendations && protocol.aiRawRecommendations.strategies ? /*#__PURE__*/React.createElement("div", {
      className: "space-y-3"
    }, protocol.aiRawRecommendations.strategies.top.slice(0, 5).map(function (s, i) {
      var explanation = "";
      var barriers = protocol.aiDetectedBarriers || [];
      var phase = answers.phase || "preparation";

      // GÃ©nÃ©ration d'explication contextuelle
      if (lang === "fr") {
        if (s.id === "S01" || s.name === "training") explanation = "Formation essentielle pour renforcer les compÃ©tences des Ã©quipes.";else if (s.id === "S08" || s.name === "community_engagement") explanation = "Engagement communautaire clÃ© pour surmonter les barriÃ¨res socioculturelles.";else if (s.id === "S03" || s.name === "facilitation") explanation = "Facilitation recommandÃ©e pour accompagner le changement de pratiques.";else if (s.id === "S04" || s.name === "stakeholder_engagement") explanation = "Mobilisation des parties prenantes pour lÃ©gitimer le projet.";else if (s.id === "S19" || s.name === "task_shifting") explanation = "DÃ©lÃ©gation de tÃ¢ches adaptÃ©e aux contextes Ã  ressources limitÃ©es.";else if (s.id === "S02" || s.name === "audit_feedback") explanation = "Audit et feedback pour un suivi basÃ© sur les donnÃ©es.";else explanation = "StratÃ©gie alignÃ©e avec votre contexte d'implÃ©mentation.";
        if (barriers.includes("stigma") && (s.id === "S08" || s.id === "S18")) {
          explanation = "Prioritaire car rÃ©duit la stigmatisation dÃ©tectÃ©e dans votre contexte.";
        }
        if (barriers.includes("workforce_shortage") && (s.id === "S19" || s.id === "S15")) {
          explanation = "Prioritaire pour pallier le manque de personnel identifiÃ©.";
        }
      } else {
        if (s.id === "S01" || s.name === "training") explanation = "Essential training to strengthen team skills.";else if (s.id === "S08" || s.name === "community_engagement") explanation = "Key community engagement to overcome sociocultural barriers.";else if (s.id === "S03" || s.name === "facilitation") explanation = "Facilitation recommended to support practice change.";else if (s.id === "S04" || s.name === "stakeholder_engagement") explanation = "Stakeholder engagement to legitimize the project.";else if (s.id === "S19" || s.name === "task_shifting") explanation = "Task shifting adapted to low-resource settings.";else if (s.id === "S02" || s.name === "audit_feedback") explanation = "Audit and feedback for data-driven monitoring.";else explanation = "Strategy aligned with your implementation context.";
        if (barriers.includes("stigma") && (s.id === "S08" || s.id === "S18")) {
          explanation = "Priority strategy as it addresses the stigma detected in your context.";
        }
        if (barriers.includes("workforce_shortage") && (s.id === "S19" || s.id === "S15")) {
          explanation = "Priority strategy to address the workforce shortage identified.";
        }
      }
      var confColor = s.score > 0.7 ? "bg-green-500" : s.score > 0.4 ? "bg-yellow-500" : "bg-orange-500";
      var labelFr = s.label ? s.label.fr || s.name : s.name;
      var labelEn = s.label ? s.label.en || s.name : s.name;
      return /*#__PURE__*/React.createElement("div", {
        key: i,
        className: "p-3 bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition"
      }, /*#__PURE__*/React.createElement("div", {
        className: "flex items-start gap-3"
      }, /*#__PURE__*/React.createElement("div", {
        className: "w-2 h-2 rounded-full mt-2 " + confColor,
        title: lang === "fr" ? "Score: " + (s.score * 100).toFixed(0) + "%" : "Score: " + (s.score * 100).toFixed(0) + "%"
      }), /*#__PURE__*/React.createElement("div", {
        className: "flex-1"
      }, /*#__PURE__*/React.createElement("div", {
        className: "flex items-center gap-2 mb-1"
      }, /*#__PURE__*/React.createElement("span", {
        className: "font-semibold text-gray-800"
      }, lang === "fr" ? labelFr : labelEn), /*#__PURE__*/React.createElement("span", {
        className: "text-xs text-gray-400"
      }, "(", s.id, ")")), /*#__PURE__*/React.createElement("p", {
        className: "text-sm text-gray-600 italic"
      }, explanation))));
    })) : /*#__PURE__*/React.createElement("ul", {
      className: "space-y-2"
    }, (protocol.strategies || []).map(function (s, i) {
      return /*#__PURE__*/React.createElement("li", {
        key: i,
        className: "flex items-start gap-2 text-gray-700"
      }, /*#__PURE__*/React.createElement("span", {
        className: "text-purple-600"
      }, "\u2192"), " ", s);
    }))), protocol.recommendations && protocol.recommendations.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-amber-50 rounded-lg border border-amber-200"
    }, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-amber-800 mb-2"
    }, "\uD83D\uDCA1 ", lang === "fr" ? "Recommandations contextuelles" : "Contextual recommendations"), /*#__PURE__*/React.createElement("ul", {
      className: "space-y-1"
    }, protocol.recommendations.map(function (r, i) {
      return /*#__PURE__*/React.createElement("li", {
        key: i,
        className: "text-amber-700 text-sm"
      }, "\u2022 ", r);
    }))), /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-gradient-to-r from-slate-50 to-indigo-50 rounded-lg border border-indigo-200"
    }, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-indigo-800 mb-3 flex items-center gap-2"
    }, "\uD83D\uDE80 ", lang === "fr" ? "Outils avancÃ©s" : "Advanced Tools"), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-2 md:grid-cols-5 gap-3 mb-4"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowTheory(true);
      },
      className: "p-3 bg-white rounded-lg border border-indigo-200 hover:border-indigo-400 hover:shadow-md transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDD17"), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 text-sm"
    }, lang === "fr" ? "ThÃ©orie du Changement" : "Theory of Change"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, lang === "fr" ? "Logique causale" : "Causal logic")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowScenarios(true);
      },
      className: "p-3 bg-white rounded-lg border border-indigo-200 hover:border-indigo-400 hover:shadow-md transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\u2696\uFE0F"), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 text-sm"
    }, lang === "fr" ? "Studio ScÃ©narios" : "Scenario Studio"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, lang === "fr" ? "3 trajectoires" : "3 trajectories")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowKPIs(true);
      },
      className: "p-3 bg-white rounded-lg border border-indigo-200 hover:border-indigo-400 hover:shadow-md transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 text-sm"
    }, lang === "fr" ? "Indicateurs KPIs" : "KPIs"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, lang === "fr" ? "Mesurer" : "Measure")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowStakeholders(true);
      },
      className: "p-3 bg-white rounded-lg border border-indigo-200 hover:border-indigo-400 hover:shadow-md transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDC65"), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 text-sm"
    }, lang === "fr" ? "Parties Prenantes" : "Stakeholders"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, lang === "fr" ? "Cartographie" : "Mapping")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowTrainingPlan(true);
      },
      className: "p-3 bg-white rounded-lg border border-indigo-200 hover:border-indigo-400 hover:shadow-md transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83C\uDF93"), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 text-sm"
    }, lang === "fr" ? "Plan Formation" : "Training Plan"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, lang === "fr" ? "& Supervision" : "& Supervision"))), showAllTools && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement("div", {
      className: "border-t border-indigo-200 pt-4 mt-2"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-semibold text-indigo-700 mb-3 flex items-center gap-2 text-sm"
    }, "\u2728 ", lang === "fr" ? "Intelligence v8.0" : "Intelligence v8.0", /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 bg-green-400 text-green-900 text-xs font-bold rounded animate-pulse"
    }, "NEW")), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-2 md:grid-cols-6 gap-3"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowSuccessPrediction(true);
      },
      className: "p-3 bg-gradient-to-br from-green-50 to-emerald-100 rounded-lg border border-green-200 hover:border-green-400 hover:shadow-md transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83C\uDFAF"), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 text-sm"
    }, lang === "fr" ? "Estimateur SuccÃ¨s" : "Success Estimator"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-green-600"
    }, lang === "fr" ? "ProbabilitÃ© %" : "Probability %")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowBudgetEstimator(true);
      },
      className: "p-3 bg-gradient-to-br from-amber-50 to-yellow-100 rounded-lg border border-amber-200 hover:border-amber-400 hover:shadow-md transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDCB0"), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 text-sm"
    }, lang === "fr" ? "Budget USD" : "Budget USD"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-amber-600"
    }, lang === "fr" ? "Estimation auto" : "Auto estimate")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowCountryIntelligence(true);
      },
      className: "p-3 bg-gradient-to-br from-blue-50 to-cyan-100 rounded-lg border border-blue-200 hover:border-blue-400 hover:shadow-md transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83C\uDF0D"), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 text-sm"
    }, lang === "fr" ? "Contexte Pays" : "Country Context"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-blue-600"
    }, lang === "fr" ? "20+ pays" : "20+ countries")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowCaseLibrary(true);
      },
      className: "p-3 bg-gradient-to-br from-purple-50 to-violet-100 rounded-lg border border-purple-200 hover:border-purple-400 hover:shadow-md transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDCDA"), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 text-sm"
    }, lang === "fr" ? "Cas Similaires" : "Similar Cases"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-purple-600"
    }, lang === "fr" ? "10 cas rÃ©els" : "10 real cases")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowRiskAnalysis(true);
      },
      className: "p-3 bg-gradient-to-br from-red-50 to-orange-100 rounded-lg border border-red-200 hover:border-red-400 hover:shadow-md transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\u26A0\uFE0F"), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 text-sm"
    }, lang === "fr" ? "Analyse Risques" : "Risk Analysis"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-red-600"
    }, lang === "fr" ? "Matrice auto" : "Auto matrix")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowResearchExports(true);
      },
      className: "p-3 bg-gradient-to-br from-slate-50 to-gray-100 rounded-lg border border-slate-200 hover:border-slate-400 hover:shadow-md transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDCC4"), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 text-sm"
    }, lang === "fr" ? "Exports Recherche" : "Research Exports"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-slate-600"
    }, "SPIRIT/TIDieR")))), /*#__PURE__*/React.createElement("div", {
      className: "border-t-2 border-indigo-300 pt-4 mt-4"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-indigo-800 mb-3 flex items-center gap-2"
    }, "\uD83D\uDE80 ", lang === "fr" ? "World Leader SMOA v8.0" : "World Leader SMOA v8.0", /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 bg-gradient-to-r from-yellow-400 to-orange-400 text-white text-xs font-bold rounded animate-pulse"
    }, "PREMIUM")), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-2 md:grid-cols-5 gap-3 mb-3"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowGanttTimeline(true);
      },
      className: "p-3 bg-gradient-to-br from-blue-100 to-indigo-200 rounded-lg border-2 border-blue-300 hover:border-blue-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDCC5"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800 text-sm"
    }, lang === "fr" ? "Timeline Gantt" : "Gantt Timeline"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-blue-600"
    }, "EPIS ", lang === "fr" ? "interactif" : "interactive")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowCFIR2(true);
      },
      className: "p-3 bg-gradient-to-br from-purple-100 to-violet-200 rounded-lg border-2 border-purple-300 hover:border-purple-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83C\uDFD7\uFE0F"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800 text-sm"
    }, "CFIR 2.0"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-purple-600"
    }, "39 constructs")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowREAIM(true);
      },
      className: "p-3 bg-gradient-to-br from-emerald-100 to-teal-200 rounded-lg border-2 border-emerald-300 hover:border-emerald-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83C\uDFAF"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800 text-sm"
    }, "RE-AIM"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-emerald-600"
    }, "5 dimensions")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowROICalculator(true);
      },
      className: "p-3 bg-gradient-to-br from-green-100 to-lime-200 rounded-lg border-2 border-green-300 hover:border-green-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDCC8"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800 text-sm"
    }, lang === "fr" ? "Calculateur ROI" : "ROI Calculator"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-green-600"
    }, "VAN, TRI, B/C")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowFundingProposal(true);
      },
      className: "p-3 bg-gradient-to-br from-amber-100 to-yellow-200 rounded-lg border-2 border-amber-300 hover:border-amber-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDCDD"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800 text-sm"
    }, lang === "fr" ? "Demande Financement" : "Funding Proposal"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-amber-600"
    }, "OMS/UNICEF/GF"))), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-2 md:grid-cols-5 gap-3"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowMonitoringDashboard(true);
      },
      className: "p-3 bg-gradient-to-br from-slate-100 to-zinc-200 rounded-lg border-2 border-slate-300 hover:border-slate-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800 text-sm"
    }, "Dashboard"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-slate-600"
    }, lang === "fr" ? "Monitoring temps rÃ©el" : "Real-time monitoring")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowLogicModel(true);
      },
      className: "p-3 bg-gradient-to-br from-cyan-100 to-sky-200 rounded-lg border-2 border-cyan-300 hover:border-cyan-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDD04"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800 text-sm"
    }, lang === "fr" ? "ModÃ¨le Logique" : "Logic Model"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-cyan-600"
    }, "I\u2192A\u2192O\u2192O\u2192I")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowMonteCarlo(true);
      },
      className: "p-3 bg-gradient-to-br from-indigo-100 to-blue-200 rounded-lg border-2 border-indigo-300 hover:border-indigo-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83C\uDFB2"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800 text-sm"
    }, "Monte Carlo"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-indigo-600"
    }, "10,000 ", lang === "fr" ? "simulations" : "simulations")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowNLPAnalyzer(true);
      },
      className: "p-3 bg-gradient-to-br from-rose-100 to-pink-200 rounded-lg border-2 border-rose-300 hover:border-rose-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83E\uDDE0"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800 text-sm"
    }, lang === "fr" ? "Analyseur NLP" : "NLP Analyzer"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-rose-600"
    }, lang === "fr" ? "BarriÃ¨res IA" : "AI Barriers")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowPowerPointGenerator(true);
      },
      className: "p-3 bg-gradient-to-br from-orange-100 to-red-200 rounded-lg border-2 border-orange-300 hover:border-orange-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800 text-sm"
    }, "PowerPoint"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-orange-600"
    }, lang === "fr" ? "Export auto" : "Auto export")))), /*#__PURE__*/React.createElement("div", {
      className: "border-t-2 border-red-300 pt-4 mt-4"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-red-800 mb-3 flex items-center gap-2"
    }, "\uD83E\uDDE0 ", lang === "fr" ? "Intelligence Prescriptive v8.3" : "Prescriptive Intelligence v8.3", /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 bg-gradient-to-r from-red-500 to-orange-500 text-white text-xs font-bold rounded animate-pulse"
    }, "NEW")), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-2 md:grid-cols-4 gap-3"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowTornadoAnalysis(true);
      },
      className: "p-4 bg-gradient-to-br from-red-100 to-orange-200 rounded-xl border-2 border-red-300 hover:border-red-500 hover:shadow-xl transition text-left group"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83C\uDF2A\uFE0F"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "Analyse Tornado" : "Tornado Analysis"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-red-600 mt-1"
    }, lang === "fr" ? "Impact des barriÃ¨res" : "Barrier impact"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "OÃ¹ investir votre dernier euro ?" : "Where to invest your last dollar?")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowPortfolio(true);
      },
      className: "p-4 bg-gradient-to-br from-indigo-100 to-purple-200 rounded-xl border-2 border-indigo-300 hover:border-indigo-500 hover:shadow-xl transition text-left group"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "Vue Portfolio" : "Portfolio View"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-indigo-600 mt-1"
    }, lang === "fr" ? "Multi-projets" : "Multi-projects"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "Dashboard agrÃ©gÃ© Manager" : "Aggregated Manager Dashboard")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowTheory(true);
      },
      className: "p-4 bg-gradient-to-br from-emerald-100 to-teal-200 rounded-xl border-2 border-emerald-300 hover:border-emerald-500 hover:shadow-xl transition text-left group"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83D\uDD04"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "Theory of Change" : "Theory of Change"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-emerald-600 mt-1"
    }, lang === "fr" ? "Dynamique" : "Dynamic"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "Liens visuels interactifs" : "Interactive visual links")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        // DÃ©monstration de l'analyse sÃ©mantique
        if (window.SemanticNLP && answers.barriers) {
          var result = SemanticNLP.analyzeText(answers.barriers + " " + (answers.context || ""), lang);
          alert((lang === "fr" ? "Analyse sÃ©mantique:\n\n" : "Semantic analysis:\n\n") + (lang === "fr" ? "BarriÃ¨res dÃ©tectÃ©es avec confiance IA:\n" : "Barriers detected with AI confidence:\n") + result.barriers.map(function (b) {
            return "â€¢ " + b.barrierId + " (score: " + Math.round(b.score * 100) + "%)";
          }).join("\n") + "\n\n" + (lang === "fr" ? "Confiance globale: " : "Overall confidence: ") + Math.round(result.overallConfidence * 100) + "%");
        } else {
          alert(lang === "fr" ? "Entrez d'abord des barriÃ¨res dans le wizard" : "First enter barriers in the wizard");
        }
      },
      className: "p-4 bg-gradient-to-br from-violet-100 to-fuchsia-200 rounded-xl border-2 border-violet-300 hover:border-violet-500 hover:shadow-xl transition text-left group"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83E\uDD16"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "NLP SÃ©mantique" : "Semantic NLP"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-violet-600 mt-1"
    }, lang === "fr" ? "ComprÃ©hension IA" : "AI Understanding"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "DÃ©tection contextuelle" : "Contextual detection")))), /*#__PURE__*/React.createElement("div", {
      className: "border-t-2 border-cyan-400 pt-4 mt-4"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-cyan-800 mb-3 flex items-center gap-2"
    }, "\uD83E\uDD1D ", lang === "fr" ? "Collaboration & Export Pro v8.4" : "Collaboration & Export Pro v8.4", /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 bg-gradient-to-r from-cyan-500 to-blue-500 text-white text-xs font-bold rounded animate-pulse"
    }, "NEW")), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-2 md:grid-cols-3 gap-3"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        // Activer mode dÃ©mo collaboration
        if (window.RealtimeCollaboration) {
          var result = RealtimeCollaboration.simulateCollaboration(selectedProjectId || 'demo');
          setCollaborators(result.collaborators || []);
          setShowCollaboration(true);
        }
      },
      className: "p-4 bg-gradient-to-br from-cyan-100 to-blue-200 rounded-xl border-2 border-cyan-300 hover:border-cyan-500 hover:shadow-xl transition text-left group relative"
    }, collaborators.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "absolute -top-2 -right-2 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center text-white text-xs font-bold animate-pulse"
    }, collaborators.length), /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83D\uDC65"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "Collaboration" : "Collaboration"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-cyan-600 mt-1"
    }, lang === "fr" ? "Temps rÃ©el" : "Real-time"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "Supabase Realtime" : "Supabase Realtime")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowLLMAnalyzer(true);
      },
      className: "p-4 bg-gradient-to-br from-purple-100 to-pink-200 rounded-xl border-2 border-purple-300 hover:border-purple-500 hover:shadow-xl transition text-left group"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83E\uDDE0"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "LLM Local" : "Local LLM"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-purple-600 mt-1"
    }, "WebGPU"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "TinyLlama / Phi-2" : "TinyLlama / Phi-2")), /*#__PURE__*/React.createElement("button", {
      onClick: async function () {
        if (protocol && window.PowerPointExporter) {
          setShowPPTXExport(true);
        } else {
          alert(lang === "fr" ? "GÃ©nÃ©rez d'abord un protocole" : "Generate a protocol first");
        }
      },
      className: "p-4 bg-gradient-to-br from-orange-100 to-red-200 rounded-xl border-2 border-orange-300 hover:border-orange-500 hover:shadow-xl transition text-left group"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, "PowerPoint"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-orange-600 mt-1"
    }, lang === "fr" ? "Export Pro" : "Pro Export"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "9 slides auto" : "9 auto slides")))), !demoMode && /*#__PURE__*/React.createElement("div", {
      className: "border-t-2 border-pink-400 pt-4 mt-4"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setDemoMode(true);
        DemoGuide.startDemo(lang, function (stepData) {
          setDemoStep(stepData);
          // Actions automatiques selon l'Ã©tape
          if (stepData.data.action === 'show_tornado') setShowTornadoAnalysis(true);
          if (stepData.data.action === 'show_monitoring') setShowMonitoring(true);
          if (stepData.data.action === 'show_geomap') setShowGeoMap(true);
          if (stepData.data.action === 'show_scaling') setShowScaling(true);
          if (stepData.data.action === 'show_adaptive_loop') setShowClosedLoop(true);
          if (stepData.data.action === 'complete') {
            setDemoMode(false);
            setDemoStep(null);
          }
        });
      },
      className: "w-full p-4 bg-gradient-to-r from-pink-500 via-red-500 to-orange-500 rounded-xl text-white font-bold text-lg hover:from-pink-600 hover:via-red-600 hover:to-orange-600 transition shadow-lg hover:shadow-xl flex items-center justify-center gap-3"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-2xl animate-pulse"
    }, "\uD83C\uDFAC"), lang === "fr" ? "Lancer la dÃ©mo en 3 minutes" : "Start 3-minute demo", /*#__PURE__*/React.createElement("span", {
      className: "text-2xl animate-pulse"
    }, "\u25B6\uFE0F")), /*#__PURE__*/React.createElement("p", {
      className: "text-center text-xs text-gray-500 mt-2"
    }, lang === "fr" ? "Visite guidÃ©e automatique des fonctionnalitÃ©s clÃ©s" : "Automatic guided tour of key features")), demoMode && demoStep && /*#__PURE__*/React.createElement("div", {
      className: "border-t-2 border-pink-400 pt-4 mt-4"
    }, /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-gradient-to-r from-pink-50 to-orange-50 rounded-xl border border-pink-200"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center justify-between mb-3"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xl animate-pulse"
    }, "\uD83C\uDFAC"), /*#__PURE__*/React.createElement("span", {
      className: "font-bold text-pink-800"
    }, demoStep.data.title)), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        DemoGuide.stopDemo();
        setDemoMode(false);
        setDemoStep(null);
      },
      className: "px-3 py-1 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300"
    }, "\u23F9\uFE0F ", lang === "fr" ? "ArrÃªter" : "Stop")), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-gray-600 mb-3"
    }, demoStep.data.description), /*#__PURE__*/React.createElement("div", {
      className: "h-2 bg-gray-200 rounded-full overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "h-full bg-gradient-to-r from-pink-500 to-orange-500 transition-all duration-500",
      style: {
        width: demoStep.progress + '%'
      }
    })), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mt-1 text-center"
    }, lang === "fr" ? "Ã‰tape" : "Step", " ", demoStep.step + 1, "/", demoStep.total))), /*#__PURE__*/React.createElement("div", {
      className: "border-t-2 border-emerald-400 pt-4 mt-4"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-emerald-800 mb-3 flex items-center gap-2"
    }, "\uD83C\uDF10 ", lang === "fr" ? "Monitoring & EcosystÃ¨me v8.5" : "Monitoring & Ecosystem v8.5", /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white text-xs font-bold rounded animate-pulse"
    }, "GOV/ONG")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowClosedLoop(true);
      },
      className: "w-full mb-3 p-3 bg-gradient-to-r from-indigo-100 to-purple-100 rounded-xl border-2 border-indigo-300 hover:border-indigo-500 hover:shadow-lg transition flex items-center justify-between"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-3"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-2xl"
    }, "\uD83D\uDD04"), /*#__PURE__*/React.createElement("div", {
      className: "text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-indigo-800"
    }, lang === "fr" ? "Boucle de Pilotage Adaptatif" : "Adaptive Management Loop"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-indigo-600"
    }, lang === "fr" ? "KPI â†’ Alerte â†’ Action â†’ Correction" : "KPI â†’ Alert â†’ Action â†’ Correction"))), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 bg-indigo-600 text-white text-xs rounded-full"
    }, lang === "fr" ? "NOUVEAU" : "NEW")), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-2 md:grid-cols-3 gap-3 mb-3"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowSNA(true);
      },
      className: "p-4 bg-gradient-to-br from-emerald-100 to-teal-200 rounded-xl border-2 border-emerald-300 hover:border-emerald-500 hover:shadow-xl transition text-left group relative"
    }, /*#__PURE__*/React.createElement("span", {
      className: "absolute top-2 right-2 px-1.5 py-0.5 bg-blue-100 text-blue-700 text-[10px] rounded border border-blue-200",
      title: "Centralit\xE9 betweenness approxim\xE9e"
    }, "\u26A1 Heuristique"), /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83D\uDD78\uFE0F"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "RÃ©seau Parties Prenantes" : "Stakeholder Network"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-emerald-600 mt-1"
    }, lang === "fr" ? "Analyse SNA" : "SNA Analysis"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "Champions & Influenceurs" : "Champions & Influencers")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowMonitoring(true);
      },
      className: "p-4 bg-gradient-to-br from-blue-100 to-indigo-200 rounded-xl border-2 border-blue-300 hover:border-blue-500 hover:shadow-xl transition text-left group relative"
    }, /*#__PURE__*/React.createElement("span", {
      className: "absolute top-2 right-2 px-1.5 py-0.5 bg-amber-100 text-amber-700 text-[10px] rounded border border-amber-200",
      title: "En production, connectez DHIS2"
    }, "\u26A1 Simul\xE9"), /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83D\uDCC8"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "Monitoring KPIs" : "KPI Monitoring"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-blue-600 mt-1"
    }, lang === "fr" ? "Temps rÃ©el" : "Real-time"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "PrÃ©dit vs RÃ©el" : "Predicted vs Actual")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowGeoMap(true);
      },
      className: "p-4 bg-gradient-to-br from-cyan-100 to-sky-200 rounded-xl border-2 border-cyan-300 hover:border-cyan-500 hover:shadow-xl transition text-left group relative"
    }, /*#__PURE__*/React.createElement("span", {
      className: "absolute top-2 right-2 px-1.5 py-0.5 bg-amber-100 text-amber-700 text-[10px] rounded border border-amber-200",
      title: "Sites g\xE9n\xE9r\xE9s pour d\xE9mo"
    }, "\u26A1 Simul\xE9"), /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83D\uDDFA\uFE0F"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "Carte GÃ©o" : "Geo Map"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-cyan-600 mt-1"
    }, "Leaflet"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "Sites & DisparitÃ©s" : "Sites & Disparities"))), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-2 md:grid-cols-3 gap-3"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowScaling(true);
      },
      className: "p-4 bg-gradient-to-br from-amber-100 to-orange-200 rounded-xl border-2 border-amber-300 hover:border-amber-500 hover:shadow-xl transition text-left group relative"
    }, /*#__PURE__*/React.createElement("span", {
      className: "absolute top-2 right-2 px-1.5 py-0.5 bg-purple-100 text-purple-700 text-[10px] rounded border border-purple-200",
      title: "Simulation bas\xE9e sur facteurs standards"
    }, "\u26A1 Param\xE9trique"), /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83D\uDCD0"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "Simulateur Scaling" : "Scaling Simulator"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-amber-600 mt-1"
    }, lang === "fr" ? "Pilote â†’ National" : "Pilot â†’ National"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "CoÃ»ts & Risques" : "Costs & Risks")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowDHIS2(true);
      },
      className: "p-4 bg-gradient-to-br from-green-100 to-emerald-200 rounded-xl border-2 border-green-300 hover:border-green-500 hover:shadow-xl transition text-left group relative"
    }, /*#__PURE__*/React.createElement("span", {
      className: "absolute top-2 right-2 px-1.5 py-0.5 bg-teal-100 text-teal-700 text-[10px] rounded border border-teal-200",
      title: "Connexion r\xE9elle via proxy backend"
    }, "\u26A1 D\xE9mo"), /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83D\uDD17"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, "DHIS2"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-green-600 mt-1"
    }, lang === "fr" ? "Connecteur" : "Connector"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "Import indicateurs" : "Import indicators")), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowVoiceAssistant(true);
      },
      className: "p-4 bg-gradient-to-br from-violet-100 to-purple-200 rounded-xl border-2 border-violet-300 hover:border-violet-500 hover:shadow-xl transition text-left group"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2 group-hover:animate-bounce"
    }, "\uD83C\uDF99\uFE0F"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "Assistant Vocal" : "Voice Assistant"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-violet-600 mt-1"
    }, lang === "fr" ? "Terrain + Offline" : "Field + Offline"), /*#__PURE__*/React.createElement("div", {
      className: "text-[10px] text-gray-500 mt-2 opacity-75"
    }, lang === "fr" ? "Saisie vocale" : "Voice input")))), /*#__PURE__*/React.createElement("div", {
      className: "border-t-2 border-teal-300 pt-4 mt-4"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-teal-800 mb-3 flex items-center gap-2"
    }, "\uD83C\uDF10 ", lang === "fr" ? "Plateforme Mondiale v8.0" : "Global Platform v8.0", /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 bg-gradient-to-r from-teal-400 to-cyan-400 text-white text-xs font-bold rounded animate-pulse"
    }, "ECOSYSTEM")), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-3 gap-4"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowAPIDocs(true);
      },
      className: "p-4 bg-gradient-to-br from-slate-100 to-zinc-200 rounded-xl border-2 border-slate-300 hover:border-slate-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, "\uD83D\uDD0C"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, "API Publique"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-slate-600"
    }, lang === "fr" ? "Documentation + SDK" : "Documentation + SDK"), /*#__PURE__*/React.createElement("div", {
      className: "mt-2 flex gap-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-1 py-0.5 bg-green-100 text-green-700 text-xs rounded"
    }, "REST"), /*#__PURE__*/React.createElement("span", {
      className: "px-1 py-0.5 bg-blue-100 text-blue-700 text-xs rounded"
    }, "JS SDK"))), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowCommunityHub(true);
      },
      className: "p-4 bg-gradient-to-br from-purple-100 to-indigo-200 rounded-xl border-2 border-purple-300 hover:border-purple-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, "\uD83C\uDF0D"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "CommunautÃ© Mondiale" : "Global Community"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-purple-600"
    }, lang === "fr" ? "2,497 projets â€¢ 89 pays" : "2,497 projects â€¢ 89 countries"), /*#__PURE__*/React.createElement("div", {
      className: "mt-2 flex gap-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-1 py-0.5 bg-purple-100 text-purple-700 text-xs rounded"
    }, "Benchmarks"), /*#__PURE__*/React.createElement("span", {
      className: "px-1 py-0.5 bg-amber-100 text-amber-700 text-xs rounded"
    }, "\uD83C\uDFC6"))), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowDataIntegrations(true);
      },
      className: "p-4 bg-gradient-to-br from-teal-100 to-cyan-200 rounded-xl border-2 border-teal-300 hover:border-teal-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, "\uD83D\uDD17"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "IntÃ©grations" : "Integrations"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-teal-600"
    }, "REDCap \u2022 ODK \u2022 DHIS2"), /*#__PURE__*/React.createElement("div", {
      className: "mt-2 flex gap-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-1 py-0.5 bg-red-100 text-red-700 text-xs rounded"
    }, "\uD83D\uDD34"), /*#__PURE__*/React.createElement("span", {
      className: "px-1 py-0.5 bg-blue-100 text-blue-700 text-xs rounded"
    }, "\uD83D\uDCF1"), /*#__PURE__*/React.createElement("span", {
      className: "px-1 py-0.5 bg-green-100 text-green-700 text-xs rounded"
    }, "\uD83D\uDCCA"))))), /*#__PURE__*/React.createElement("div", {
      className: "border-t-2 border-amber-300 pt-4 mt-4"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-amber-800 mb-3 flex items-center gap-2"
    }, "\uD83C\uDFC6 ", lang === "fr" ? "World Reference v8.0" : "World Reference v8.0", /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 bg-gradient-to-r from-amber-400 to-orange-400 text-white text-xs font-bold rounded animate-pulse"
    }, "NEW")), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-3 gap-4"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowXAIExplainer(true);
      },
      className: "p-4 bg-gradient-to-br from-indigo-100 to-purple-200 rounded-xl border-2 border-indigo-300 hover:border-indigo-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, "\uD83D\uDD0D"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "Pourquoi ces conseils ?" : "Why these recommendations?"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-indigo-600"
    }, lang === "fr" ? "IA ExpliquÃ©e (XAI)" : "Explainable AI (XAI)"), /*#__PURE__*/React.createElement("div", {
      className: "mt-2 flex gap-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-1 py-0.5 bg-indigo-100 text-indigo-700 text-xs rounded"
    }, lang === "fr" ? "Transparence" : "Transparency"))), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowGlossary(true);
      },
      className: "p-4 bg-gradient-to-br from-emerald-100 to-teal-200 rounded-xl border-2 border-emerald-300 hover:border-emerald-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, "\uD83D\uDCDA"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, lang === "fr" ? "Glossaire IS" : "IS Glossary"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-emerald-600"
    }, lang === "fr" ? "CFIR, RE-AIM, EPIS, ERIC..." : "CFIR, RE-AIM, EPIS, ERIC..."), /*#__PURE__*/React.createElement("div", {
      className: "mt-2 flex gap-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-1 py-0.5 bg-emerald-100 text-emerald-700 text-xs rounded"
    }, lang === "fr" ? "Formation" : "Learning"))), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setShowCertification(true);
      },
      className: "p-4 bg-gradient-to-br from-amber-100 to-yellow-200 rounded-xl border-2 border-amber-300 hover:border-amber-500 hover:shadow-lg transition text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, "\uD83C\uDFC6"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, "Moudar Ready"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-amber-600"
    }, lang === "fr" ? "Certification qualitÃ©" : "Quality certification"), /*#__PURE__*/React.createElement("div", {
      className: "mt-2 flex gap-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-1 py-0.5 bg-amber-100 text-amber-700 text-xs rounded"
    }, "\uD83E\uDD47\uD83E\uDD48\uD83E\uDD49"))))))), /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-green-50 rounded-lg border border-green-200 text-center"
    }, /*#__PURE__*/React.createElement("p", {
      className: "text-green-800 font-medium mb-2"
    }, "\u2705 ", lang === "fr" ? "Protocole prÃªt !" : "Protocol ready!"), /*#__PURE__*/React.createElement("p", {
      className: "text-green-700 text-sm"
    }, lang === "fr" ? "Exportez en Word pour complÃ©ter les sections dÃ©taillÃ©es" : "Export to Word to complete detailed sections")))), /*#__PURE__*/React.createElement(FeedbackModal, null), showTheory && /*#__PURE__*/React.createElement(TheoryOfChangeView, {
      project: answers,
      protocol: protocol,
      lang: lang,
      onClose: function () {
        setShowTheory(false);
      }
    }), showScenarios && /*#__PURE__*/React.createElement(ScenarioComparatorView, {
      project: answers,
      lang: lang,
      onClose: function () {
        setShowScenarios(false);
      },
      onSelectScenario: function (result) {
        // Appliquer le scÃ©nario sÃ©lectionnÃ©
        var newProtocol = Object.assign({}, protocol);
        newProtocol.strategies = result.strategies.map(function (s) {
          return s.label[lang];
        });
        newProtocol.aiRawRecommendations = Object.assign({}, protocol.aiRawRecommendations, {
          strategies: Object.assign({}, protocol.aiRawRecommendations.strategies, {
            top: result.strategies
          })
        });
        newProtocol.selectedScenario = result.scenario.id;
        setProtocol(newProtocol);
        setShowScenarios(false);
        setSaved(false);
      }
    }), showKPIs && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(KPIPanelView, {
      strategies: protocol.aiRawRecommendations.strategies.top,
      lang: lang,
      onClose: function () {
        setShowKPIs(false);
      }
    }), showStakeholders && /*#__PURE__*/React.createElement(StakeholderMapModal, {
      project: answers,
      protocol: protocol,
      lang: lang,
      onClose: function () {
        setShowStakeholders(false);
      },
      onSave: function (stakeholders) {
        var newAnswers = Object.assign({}, answers, {
          stakeholders: stakeholders
        });
        setAnswers(newAnswers);
        setSaved(false);
      }
    }), showTrainingPlan && /*#__PURE__*/React.createElement(TrainingPlanView, {
      project: answers,
      protocol: protocol,
      lang: lang,
      onClose: function () {
        setShowTrainingPlan(false);
      }
    }), showSuccessPrediction && protocol && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(SuccessPredictionView, {
      project: answers,
      strategies: protocol.aiRawRecommendations.strategies.top,
      lang: lang,
      onClose: function () {
        setShowSuccessPrediction(false);
      }
    }), showBudgetEstimator && protocol && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(BudgetEstimatorView, {
      project: answers,
      protocol: {
        strategies: protocol.aiRawRecommendations.strategies.top
      },
      lang: lang,
      onClose: function () {
        setShowBudgetEstimator(false);
      }
    }), showCountryIntelligence && /*#__PURE__*/React.createElement(CountryIntelligenceView, {
      project: answers,
      lang: lang,
      onClose: function () {
        setShowCountryIntelligence(false);
      },
      onSelectCountry: function (countryCode) {
        var newAnswers = Object.assign({}, answers, {
          country: countryCode
        });
        setAnswers(newAnswers);
        setSaved(false);
      }
    }), showCaseLibrary && /*#__PURE__*/React.createElement(CaseLibraryView, {
      project: answers,
      protocol: protocol,
      lang: lang,
      onClose: function () {
        setShowCaseLibrary(false);
      }
    }), showRiskAnalysis && protocol && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(RiskAnalysisView, {
      project: answers,
      strategies: protocol.aiRawRecommendations.strategies.top,
      lang: lang,
      onClose: function () {
        setShowRiskAnalysis(false);
      }
    }), showResearchExports && protocol && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(ResearchExportsView, {
      project: answers,
      strategies: protocol.aiRawRecommendations.strategies.top,
      lang: lang,
      onClose: function () {
        setShowResearchExports(false);
      }
    }), showTornadoAnalysis && protocol && /*#__PURE__*/React.createElement(TornadoAnalysisView, {
      project: Object.assign({}, answers, {
        barriers: protocol.aiRawRecommendations ? protocol.aiRawRecommendations.metadata.detectedBarriers || answers.barrierCategories || [] : answers.barrierCategories || [],
        phase: answers.phase,
        resourceLevel: answers.country ? answers.country.indexOf("morocco") !== -1 || answers.country.indexOf("tunisia") !== -1 ? "R03" : answers.country.indexOf("senegal") !== -1 || answers.country.indexOf("mali") !== -1 ? "R04" : "R02" : "R03"
      }),
      lang: lang,
      onClose: function () {
        setShowTornadoAnalysis(false);
      }
    }), showPortfolio && /*#__PURE__*/React.createElement(PortfolioView, {
      projects: StorageManager.getAllProjects(),
      lang: lang,
      onClose: function () {
        setShowPortfolio(false);
      },
      onSelectProject: function (projectId) {
        setShowPortfolio(false);
        // Logique pour charger le projet sÃ©lectionnÃ©
      }
    }), showCollaboration && React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"
    }, React.createElement('div', {
      className: "bg-gradient-to-r from-cyan-600 to-blue-600 p-6 text-white rounded-t-2xl"
    }, React.createElement('div', {
      className: "flex justify-between items-start"
    }, React.createElement('div', null, React.createElement('h2', {
      className: "text-2xl font-bold flex items-center gap-2"
    }, "ðŸ‘¥ ", lang === "fr" ? "Collaboration en Temps RÃ©el" : "Real-time Collaboration"), React.createElement('p', {
      className: "text-white/80 mt-1"
    }, lang === "fr" ? "Travaillez ensemble sur le mÃªme protocole" : "Work together on the same protocol")), React.createElement('button', {
      onClick: function () {
        setShowCollaboration(false);
      },
      className: "text-white/80 hover:text-white text-2xl"
    }, "Ã—"))), React.createElement('div', {
      className: "p-6"
    }, React.createElement('h3', {
      className: "font-semibold text-gray-800 mb-4"
    }, lang === "fr" ? "Collaborateurs connectÃ©s" : "Connected Collaborators"), React.createElement('div', {
      className: "space-y-3"
    }, collaborators.map(function (collab, idx) {
      return React.createElement('div', {
        key: idx,
        className: "flex items-center gap-3 p-3 bg-gray-50 rounded-xl"
      }, React.createElement('div', {
        className: "w-10 h-10 rounded-full flex items-center justify-center text-white text-lg",
        style: {
          backgroundColor: collab.color
        }
      }, collab.avatar || "ðŸ‘¤"), React.createElement('div', null, React.createElement('p', {
        className: "font-medium text-gray-800"
      }, collab.name), React.createElement('p', {
        className: "text-xs text-green-600"
      }, "â— " + (lang === "fr" ? "En ligne" : "Online"))));
    })), React.createElement('div', {
      className: "mt-6 p-4 bg-amber-50 rounded-xl border border-amber-200"
    }, React.createElement('h4', {
      className: "font-semibold text-amber-800 mb-2"
    }, "âš™ï¸ " + (lang === "fr" ? "Configuration Supabase" : "Supabase Configuration")), React.createElement('p', {
      className: "text-sm text-amber-700 mb-3"
    }, lang === "fr" ? "Pour activer la collaboration en temps rÃ©el, configurez votre projet Supabase :" : "To enable real-time collaboration, configure your Supabase project:"), React.createElement('div', {
      className: "space-y-2"
    }, React.createElement('input', {
      type: "text",
      placeholder: "Supabase URL (ex: https://xxx.supabase.co)",
      className: "w-full px-3 py-2 border rounded-lg text-sm"
    }), React.createElement('input', {
      type: "password",
      placeholder: "Supabase Anon Key",
      className: "w-full px-3 py-2 border rounded-lg text-sm"
    }), React.createElement('button', {
      className: "w-full py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition text-sm font-medium"
    }, lang === "fr" ? "Connecter" : "Connect")))), React.createElement('div', {
      className: "p-4 border-t flex justify-end"
    }, React.createElement('button', {
      onClick: function () {
        setShowCollaboration(false);
      },
      className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
    }, lang === "fr" ? "Fermer" : "Close")))), showLLMAnalyzer && React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto"
    }, React.createElement('div', {
      className: "bg-gradient-to-r from-purple-600 to-pink-600 p-6 text-white rounded-t-2xl"
    }, React.createElement('div', {
      className: "flex justify-between items-start"
    }, React.createElement('div', null, React.createElement('h2', {
      className: "text-2xl font-bold flex items-center gap-2"
    }, "ðŸ§  ", lang === "fr" ? "Analyse LLM Local" : "Local LLM Analysis"), React.createElement('p', {
      className: "text-white/80 mt-1"
    }, lang === "fr" ? "ModÃ¨le de langage exÃ©cutÃ© dans votre navigateur" : "Language model running in your browser")), React.createElement('button', {
      onClick: function () {
        setShowLLMAnalyzer(false);
      },
      className: "text-white/80 hover:text-white text-2xl"
    }, "Ã—"))), React.createElement('div', {
      className: "p-6"
    }, React.createElement('div', {
      className: "mb-6"
    }, React.createElement('h3', {
      className: "font-semibold text-gray-800 mb-3"
    }, lang === "fr" ? "ModÃ¨les disponibles" : "Available Models"), React.createElement('div', {
      className: "grid grid-cols-2 gap-3"
    }, Object.entries(LocalLLMEngine.getSupportedModels()).map(function (entry) {
      var key = entry[0];
      var model = entry[1];
      return React.createElement('div', {
        key: key,
        className: "p-3 border rounded-xl " + (model.recommended ? "border-purple-300 bg-purple-50" : "border-gray-200")
      }, React.createElement('div', {
        className: "flex items-center justify-between"
      }, React.createElement('span', {
        className: "font-medium"
      }, model.name), model.recommended && React.createElement('span', {
        className: "text-xs bg-purple-600 text-white px-2 py-0.5 rounded"
      }, "RecommandÃ©")), React.createElement('p', {
        className: "text-xs text-gray-500 mt-1"
      }, model.description), React.createElement('p', {
        className: "text-xs text-gray-400 mt-1"
      }, "ðŸ“¦ " + model.size));
    }))), React.createElement('div', {
      className: "p-4 bg-yellow-50 rounded-xl border border-yellow-200 mb-4"
    }, React.createElement('div', {
      className: "flex items-start gap-3"
    }, React.createElement('span', {
      className: "text-2xl"
    }, "âš ï¸"), React.createElement('div', null, React.createElement('p', {
      className: "font-semibold text-yellow-800"
    }, lang === "fr" ? "Configuration requise" : "Requirements"), React.createElement('p', {
      className: "text-sm text-yellow-700 mt-1"
    }, lang === "fr" ? "WebGPU requis (Chrome 113+ / Edge 113+). Le tÃ©lÃ©chargement du modÃ¨le peut prendre plusieurs minutes." : "WebGPU required (Chrome 113+ / Edge 113+). Model download may take several minutes."), React.createElement('p', {
      className: "text-sm text-yellow-700 mt-1"
    }, "WebGPU: " + (LocalLLMEngine.checkWebGPUSupport().supported ? "âœ… " + (lang === "fr" ? "SupportÃ©" : "Supported") : "âŒ " + (lang === "fr" ? "Non supportÃ©" : "Not supported")))))), React.createElement('div', {
      className: "flex gap-3"
    }, React.createElement('button', {
      onClick: async function () {
        var status = LocalLLMEngine.getStatus();
        if (status.isReady) {
          var result = await LocalLLMEngine.analyzeBarriers(answers.barriers || answers.context || "", lang);
          alert(JSON.stringify(result, null, 2));
        } else {
          alert(lang === "fr" ? "Chargez d'abord un modÃ¨le" : "Load a model first");
        }
      },
      className: "flex-1 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition font-medium"
    }, lang === "fr" ? "ðŸ” Analyser les barriÃ¨res" : "ðŸ” Analyze barriers"), React.createElement('button', {
      onClick: function () {
        // Fallback vers SemanticNLP
        if (window.SemanticNLP) {
          var result = SemanticNLP.analyzeText(answers.barriers || answers.context || "", lang);
          alert((lang === "fr" ? "Analyse SemanticNLP (fallback):\n\n" : "SemanticNLP Analysis (fallback):\n\n") + result.barriers.map(function (b) {
            return "â€¢ " + b.barrierId + " (" + Math.round(b.score * 100) + "%)";
          }).join("\n"));
        }
      },
      className: "px-4 py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition"
    }, lang === "fr" ? "Mode rapide (SemanticNLP)" : "Fast mode (SemanticNLP)"))), React.createElement('div', {
      className: "p-4 border-t flex justify-end"
    }, React.createElement('button', {
      onClick: function () {
        setShowLLMAnalyzer(false);
      },
      className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
    }, lang === "fr" ? "Fermer" : "Close")))), showPPTXExport && protocol && React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
    }, React.createElement('div', {
      className: "bg-gradient-to-r from-orange-500 to-red-500 p-6 text-white rounded-t-2xl"
    }, React.createElement('div', {
      className: "flex justify-between items-start"
    }, React.createElement('div', null, React.createElement('h2', {
      className: "text-2xl font-bold flex items-center gap-2"
    }, "ðŸ“Š ", lang === "fr" ? "Export PowerPoint Pro" : "Pro PowerPoint Export"), React.createElement('p', {
      className: "text-white/80 mt-1"
    }, lang === "fr" ? "GÃ©nÃ©rez une prÃ©sentation professionnelle en 1 clic" : "Generate a professional presentation in 1 click")), React.createElement('button', {
      onClick: function () {
        setShowPPTXExport(false);
      },
      className: "text-white/80 hover:text-white text-2xl"
    }, "Ã—"))), React.createElement('div', {
      className: "p-6"
    },
    // AperÃ§u des slides
    React.createElement('h3', {
      className: "font-semibold text-gray-800 mb-4"
    }, lang === "fr" ? "AperÃ§u de la prÃ©sentation (9 slides)" : "Presentation Preview (9 slides)"), React.createElement('div', {
      className: "grid grid-cols-3 gap-3 mb-6"
    }, [{
      title: lang === "fr" ? "Page de titre" : "Title Page",
      icon: "ðŸ“‹"
    }, {
      title: lang === "fr" ? "Contexte" : "Context",
      icon: "ðŸ¢"
    }, {
      title: lang === "fr" ? "BarriÃ¨res" : "Barriers",
      icon: "âš ï¸"
    }, {
      title: lang === "fr" ? "StratÃ©gies" : "Strategies",
      icon: "ðŸŽ¯"
    }, {
      title: "Frameworks",
      icon: "ðŸ“"
    }, {
      title: "Timeline EPIS",
      icon: "ðŸ“…"
    }, {
      title: lang === "fr" ? "Analyse Risques" : "Risk Analysis",
      icon: "ðŸŒªï¸"
    }, {
      title: lang === "fr" ? "Prochaines Ã©tapes" : "Next Steps",
      icon: "âž¡ï¸"
    }, {
      title: lang === "fr" ? "Merci" : "Thank You",
      icon: "ðŸ™"
    }].map(function (slide, idx) {
      return React.createElement('div', {
        key: idx,
        className: "aspect-video bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg border-2 border-gray-300 flex flex-col items-center justify-center p-2"
      }, React.createElement('span', {
        className: "text-2xl"
      }, slide.icon), React.createElement('span', {
        className: "text-xs text-gray-600 mt-1 text-center"
      }, slide.title));
    })),
    // SÃ©lection du thÃ¨me
    React.createElement('h3', {
      className: "font-semibold text-gray-800 mb-3"
    }, lang === "fr" ? "Choisir un thÃ¨me" : "Choose a theme"), React.createElement('div', {
      className: "grid grid-cols-4 gap-3 mb-6"
    }, Object.entries(PowerPointExporter.getThemes()).map(function (entry) {
      var key = entry[0];
      var theme = entry[1];
      return React.createElement('button', {
        key: key,
        className: "p-3 rounded-xl border-2 hover:shadow-md transition text-center",
        style: {
          borderColor: '#' + theme.colors.primary
        }
      }, React.createElement('div', {
        className: "w-full h-8 rounded mb-2",
        style: {
          backgroundColor: '#' + theme.colors.primary
        }
      }), React.createElement('span', {
        className: "text-xs font-medium"
      }, theme.name));
    })),
    // Bouton d'export
    React.createElement('button', {
      onClick: async function () {
        try {
          var result = await PowerPointExporter.exportPPTX(answers, protocol, {
            lang: lang,
            theme: 'professional'
          });
          if (result.success) {
            alert((lang === "fr" ? "âœ… PrÃ©sentation exportÃ©e: " : "âœ… Presentation exported: ") + result.filename);
            setShowPPTXExport(false);
          } else {
            alert((lang === "fr" ? "âŒ Erreur: " : "âŒ Error: ") + result.error);
          }
        } catch (e) {
          alert((lang === "fr" ? "âŒ Erreur: " : "âŒ Error: ") + e.message);
        }
      },
      className: "w-full py-4 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-xl hover:from-orange-600 hover:to-red-600 transition font-bold text-lg flex items-center justify-center gap-2"
    }, "ðŸ“¥ ", lang === "fr" ? "TÃ©lÃ©charger la prÃ©sentation PPTX" : "Download PPTX Presentation")), React.createElement('div', {
      className: "p-4 border-t flex justify-end"
    }, React.createElement('button', {
      onClick: function () {
        setShowPPTXExport(false);
      },
      className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
    }, lang === "fr" ? "Fermer" : "Close")))), showSNA && React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto"
    }, React.createElement('div', {
      className: "bg-gradient-to-r from-emerald-600 to-teal-600 p-6 text-white rounded-t-2xl"
    }, React.createElement('div', {
      className: "flex justify-between items-start"
    }, React.createElement('div', null, React.createElement('h2', {
      className: "text-2xl font-bold flex items-center gap-2"
    }, "ðŸ•¸ï¸ ", lang === "fr" ? "Analyse du RÃ©seau de Parties Prenantes" : "Stakeholder Network Analysis"), React.createElement('p', {
      className: "text-white/80 mt-1"
    }, lang === "fr" ? "Identifiez les champions et les opposants clÃ©s" : "Identify key champions and opponents")), React.createElement('button', {
      onClick: function () {
        setShowSNA(false);
      },
      className: "text-white/80 hover:text-white text-2xl"
    }, "Ã—"))), React.createElement('div', {
      className: "p-6"
    }, function () {
      var network = SocialNetworkAnalyzer.createDemoNetwork(answers.title, lang);
      var champions = SocialNetworkAnalyzer.identifyChampions(network, 3);
      var opponents = SocialNetworkAnalyzer.identifyOpponents(network, 3);
      var recommendations = SocialNetworkAnalyzer.generateNetworkRecommendations(network, lang);
      return React.createElement('div', null, React.createElement('div', {
        className: "grid grid-cols-2 gap-6 mb-6"
      }, React.createElement('div', {
        className: "p-4 bg-green-50 rounded-xl border border-green-200"
      }, React.createElement('h3', {
        className: "font-bold text-green-800 mb-3 flex items-center gap-2"
      }, "â­ ", lang === "fr" ? "Champions identifiÃ©s" : "Identified Champions"), React.createElement('div', {
        className: "space-y-2"
      }, champions.map(function (c, idx) {
        return React.createElement('div', {
          key: idx,
          className: "flex items-center justify-between p-2 bg-white rounded-lg"
        }, React.createElement('div', null, React.createElement('p', {
          className: "font-medium"
        }, c.name), React.createElement('p', {
          className: "text-xs text-gray-500"
        }, c.organization)), React.createElement('div', {
          className: "text-right"
        }, React.createElement('p', {
          className: "text-lg font-bold text-green-600"
        }, Math.round(c.influenceScore * 100) + "%"), React.createElement('p', {
          className: "text-xs text-gray-400"
        }, lang === "fr" ? "Influence" : "Influence")));
      }))), React.createElement('div', {
        className: "p-4 bg-red-50 rounded-xl border border-red-200"
      }, React.createElement('h3', {
        className: "font-bold text-red-800 mb-3 flex items-center gap-2"
      }, "ðŸš« ", lang === "fr" ? "Opposants Ã  surveiller" : "Opponents to Watch"), React.createElement('div', {
        className: "space-y-2"
      }, opponents.map(function (o, idx) {
        return React.createElement('div', {
          key: idx,
          className: "flex items-center justify-between p-2 bg-white rounded-lg"
        }, React.createElement('div', null, React.createElement('p', {
          className: "font-medium"
        }, o.name), React.createElement('p', {
          className: "text-xs text-gray-500"
        }, o.organization)), React.createElement('div', {
          className: "text-right"
        }, React.createElement('p', {
          className: "text-lg font-bold text-red-600"
        }, Math.round(o.influenceScore * 100) + "%"), React.createElement('p', {
          className: "text-xs text-gray-400"
        }, lang === "fr" ? "Influence" : "Influence")));
      })))), React.createElement('div', {
        className: "p-4 bg-amber-50 rounded-xl border border-amber-200"
      }, React.createElement('h3', {
        className: "font-bold text-amber-800 mb-3"
      }, "ðŸ’¡ " + (lang === "fr" ? "Recommandations stratÃ©giques" : "Strategic Recommendations")), React.createElement('div', {
        className: "space-y-2"
      }, recommendations.map(function (rec, idx) {
        return React.createElement('div', {
          key: idx,
          className: "p-3 bg-white rounded-lg border border-amber-100"
        }, React.createElement('p', {
          className: "font-medium text-gray-800"
        }, rec.title), React.createElement('p', {
          className: "text-sm text-gray-600 mt-1"
        }, rec.description));
      }))));
    }()), React.createElement('div', {
      className: "p-4 border-t flex justify-end"
    }, React.createElement('button', {
      onClick: function () {
        setShowSNA(false);
      },
      className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
    }, lang === "fr" ? "Fermer" : "Close")))), showMonitoring && React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto"
    }, React.createElement('div', {
      className: "bg-gradient-to-r from-blue-600 to-indigo-600 p-6 text-white rounded-t-2xl"
    }, React.createElement('div', {
      className: "flex justify-between items-start"
    }, React.createElement('div', null, React.createElement('h2', {
      className: "text-2xl font-bold flex items-center gap-2"
    }, "ðŸ“ˆ ", lang === "fr" ? "Tableau de Bord de Suivi" : "Monitoring Dashboard"), React.createElement('p', {
      className: "text-white/80 mt-1"
    }, lang === "fr" ? "Comparez les prÃ©dictions avec la rÃ©alitÃ©" : "Compare predictions with reality")), React.createElement('button', {
      onClick: function () {
        setShowMonitoring(false);
      },
      className: "text-white/80 hover:text-white text-2xl"
    }, "Ã—"))), React.createElement('div', {
      className: "p-6"
    }, function () {
      var monitoring = ImplementationMonitor.createDemoMonitoring(selectedProjectId || 'demo');
      var dashboard = ImplementationMonitor.generateDashboard(monitoring, lang);
      var recommendations = ImplementationMonitor.generateAdaptiveRecommendations(monitoring, lang);
      return React.createElement('div', null, React.createElement('div', {
        className: "grid grid-cols-4 gap-4 mb-6"
      }, React.createElement('div', {
        className: "p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200 text-center"
      }, React.createElement('p', {
        className: "text-4xl font-bold text-blue-600"
      }, dashboard.summary.implementationScore + "%"), React.createElement('p', {
        className: "text-xs text-gray-500"
      }, lang === "fr" ? "Score global" : "Global Score")), React.createElement('div', {
        className: "p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl border border-green-200 text-center"
      }, React.createElement('p', {
        className: "text-4xl font-bold text-green-600"
      }, dashboard.summary.kpisTracked), React.createElement('p', {
        className: "text-xs text-gray-500"
      }, lang === "fr" ? "KPIs suivis" : "KPIs tracked")), React.createElement('div', {
        className: "p-4 bg-gradient-to-br from-amber-50 to-orange-50 rounded-xl border border-amber-200 text-center"
      }, React.createElement('p', {
        className: "text-4xl font-bold text-amber-600"
      }, dashboard.summary.totalDataPoints), React.createElement('p', {
        className: "text-xs text-gray-500"
      }, lang === "fr" ? "Points de donnÃ©es" : "Data points")), React.createElement('div', {
        className: "p-4 bg-gradient-to-br from-red-50 to-pink-50 rounded-xl border border-red-200 text-center"
      }, React.createElement('p', {
        className: "text-4xl font-bold text-red-600"
      }, dashboard.summary.activeAlerts), React.createElement('p', {
        className: "text-xs text-gray-500"
      }, lang === "fr" ? "Alertes actives" : "Active alerts"))), React.createElement('div', {
        className: "grid grid-cols-2 gap-4 mb-6"
      }, dashboard.kpis.filter(function (k) {
        return k.current !== null;
      }).slice(0, 4).map(function (kpi, idx) {
        var statusColors = {
          achieved: 'bg-green-100 text-green-700',
          on_track: 'bg-blue-100 text-blue-700',
          warning: 'bg-amber-100 text-amber-700',
          critical: 'bg-red-100 text-red-700'
        };
        return React.createElement('div', {
          key: idx,
          className: "p-4 bg-white rounded-xl border"
        }, React.createElement('div', {
          className: "flex items-center justify-between mb-2"
        }, React.createElement('span', {
          className: "text-2xl"
        }, kpi.icon), React.createElement('span', {
          className: "px-2 py-1 rounded text-xs font-medium " + (statusColors[kpi.status] || 'bg-gray-100')
        }, kpi.status)), React.createElement('p', {
          className: "font-medium text-gray-800"
        }, kpi.label), React.createElement('p', {
          className: "text-2xl font-bold mt-1"
        }, kpi.current + (kpi.unit === '%' ? '%' : '')), kpi.target && React.createElement('p', {
          className: "text-xs text-gray-500"
        }, (lang === "fr" ? "Cible: " : "Target: ") + kpi.target + kpi.unit));
      })), recommendations.length > 0 && React.createElement('div', {
        className: "p-4 bg-red-50 rounded-xl border border-red-200"
      }, React.createElement('h3', {
        className: "font-bold text-red-800 mb-3"
      }, "âš ï¸ " + (lang === "fr" ? "Adaptations recommandÃ©es" : "Recommended Adaptations")), React.createElement('div', {
        className: "space-y-2"
      }, recommendations.slice(0, 3).map(function (rec, idx) {
        return React.createElement('div', {
          key: idx,
          className: "p-3 bg-white rounded-lg"
        }, React.createElement('p', {
          className: "font-medium text-gray-800"
        }, rec.title), React.createElement('p', {
          className: "text-sm text-gray-600 mt-1"
        }, rec.description), React.createElement('p', {
          className: "text-xs text-red-600 mt-2"
        }, "â†’ " + rec.action));
      }))));
    }()), React.createElement('div', {
      className: "p-4 border-t flex justify-end"
    }, React.createElement('button', {
      onClick: function () {
        setShowMonitoring(false);
      },
      className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
    }, lang === "fr" ? "Fermer" : "Close")))), showGeoMap && React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden"
    }, React.createElement('div', {
      className: "bg-gradient-to-r from-cyan-600 to-sky-600 p-6 text-white"
    }, React.createElement('div', {
      className: "flex justify-between items-start"
    }, React.createElement('div', null, React.createElement('h2', {
      className: "text-2xl font-bold flex items-center gap-2"
    }, "ðŸ—ºï¸ ", lang === "fr" ? "Carte des Sites d'ImplÃ©mentation" : "Implementation Sites Map"), React.createElement('p', {
      className: "text-white/80 mt-1"
    }, lang === "fr" ? "Visualisez les performances par rÃ©gion" : "Visualize performance by region")), React.createElement('button', {
      onClick: function () {
        setShowGeoMap(false);
      },
      className: "text-white/80 hover:text-white text-2xl"
    }, "Ã—"))), React.createElement('div', {
      className: "p-6"
    }, function () {
      var sites = GeoMapEngine.generateDemoSites('morocco');
      var stats = GeoMapEngine.calculateGeoStats(sites);
      return React.createElement('div', null, React.createElement('div', {
        className: "grid grid-cols-4 gap-4 mb-4"
      }, React.createElement('div', {
        className: "p-3 bg-blue-50 rounded-lg text-center"
      }, React.createElement('p', {
        className: "text-2xl font-bold text-blue-600"
      }, stats.totalSites), React.createElement('p', {
        className: "text-xs text-gray-500"
      }, lang === "fr" ? "Sites" : "Sites")), React.createElement('div', {
        className: "p-3 bg-green-50 rounded-lg text-center"
      }, React.createElement('p', {
        className: "text-2xl font-bold text-green-600"
      }, stats.totalBeneficiaries.toLocaleString()), React.createElement('p', {
        className: "text-xs text-gray-500"
      }, lang === "fr" ? "BÃ©nÃ©ficiaires" : "Beneficiaries")), React.createElement('div', {
        className: "p-3 bg-amber-50 rounded-lg text-center"
      }, React.createElement('p', {
        className: "text-2xl font-bold text-amber-600"
      }, stats.avgAdoptionRate + "%"), React.createElement('p', {
        className: "text-xs text-gray-500"
      }, lang === "fr" ? "Adoption moy." : "Avg. adoption")), React.createElement('div', {
        className: "p-3 bg-red-50 rounded-lg text-center"
      }, React.createElement('p', {
        className: "text-2xl font-bold text-red-600"
      }, stats.byStatus.critical || 0), React.createElement('p', {
        className: "text-xs text-gray-500"
      }, lang === "fr" ? "Critiques" : "Critical"))), React.createElement('div', {
        className: "bg-gray-100 rounded-xl p-4 mb-4",
        style: {
          minHeight: '300px'
        }
      }, React.createElement('div', {
        className: "text-center py-8"
      }, React.createElement('span', {
        className: "text-6xl"
      }, "ðŸ—ºï¸"), React.createElement('p', {
        className: "mt-4 text-gray-600"
      }, lang === "fr" ? "Carte interactive Leaflet" : "Leaflet interactive map"), React.createElement('p', {
        className: "text-sm text-gray-500 mt-2"
      }, lang === "fr" ? "La carte se chargera avec les donnÃ©es rÃ©elles de votre projet" : "Map will load with your project's real data"))), React.createElement('div', {
        className: "grid grid-cols-2 gap-4"
      }, React.createElement('div', null, React.createElement('h4', {
        className: "font-semibold text-gray-800 mb-2"
      }, lang === "fr" ? "Sites par statut" : "Sites by status"), React.createElement('div', {
        className: "flex gap-2"
      }, React.createElement('span', {
        className: "px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm"
      }, "âœ… " + (stats.byStatus.success || 0)), React.createElement('span', {
        className: "px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm"
      }, "ðŸ“ˆ " + (stats.byStatus.on_track || 0)), React.createElement('span', {
        className: "px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-sm"
      }, "âš ï¸ " + (stats.byStatus.warning || 0)), React.createElement('span', {
        className: "px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm"
      }, "ðŸ”´ " + (stats.byStatus.critical || 0)))), React.createElement('div', null, React.createElement('h4', {
        className: "font-semibold text-gray-800 mb-2"
      }, lang === "fr" ? "Urbain vs Rural" : "Urban vs Rural"), React.createElement('div', {
        className: "flex gap-2"
      }, React.createElement('span', {
        className: "px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm"
      }, "ðŸ™ï¸ " + stats.urbanVsRural.urban + " " + (lang === "fr" ? "urbains" : "urban")), React.createElement('span', {
        className: "px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm"
      }, "ðŸŒ¾ " + stats.urbanVsRural.rural + " " + (lang === "fr" ? "ruraux" : "rural"))))));
    }()), React.createElement('div', {
      className: "p-4 border-t flex justify-end bg-gray-50"
    }, React.createElement('button', {
      onClick: function () {
        setShowGeoMap(false);
      },
      className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
    }, lang === "fr" ? "Fermer" : "Close")))), showScaling && React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
    }, React.createElement('div', {
      className: "bg-gradient-to-r from-amber-500 to-orange-500 p-6 text-white rounded-t-2xl"
    }, React.createElement('div', {
      className: "flex justify-between items-start"
    }, React.createElement('div', null, React.createElement('h2', {
      className: "text-2xl font-bold flex items-center gap-2"
    }, "ðŸ“ ", lang === "fr" ? "Simulateur de Mise Ã  l'Ã‰chelle" : "Scaling-up Simulator"), React.createElement('p', {
      className: "text-white/80 mt-1"
    }, lang === "fr" ? "Passez du pilote Ã  l'Ã©chelle nationale" : "Scale from pilot to national")), React.createElement('button', {
      onClick: function () {
        setShowScaling(false);
      },
      className: "text-white/80 hover:text-white text-2xl"
    }, "Ã—"))), React.createElement('div', {
      className: "p-6"
    }, function () {
      var pilot = ScalingSimulator.createDemoPilot();
      var targetScale = {
        sites: 100,
        beneficiaries: 15000
      };
      var report = ScalingSimulator.generateScalingReport(pilot, targetScale, lang);
      return React.createElement('div', null, React.createElement('div', {
        className: "grid grid-cols-2 gap-6 mb-6"
      }, React.createElement('div', {
        className: "p-4 bg-blue-50 rounded-xl border border-blue-200"
      }, React.createElement('h3', {
        className: "font-bold text-blue-800 mb-3"
      }, "ðŸ“ " + (lang === "fr" ? "Phase Pilote" : "Pilot Phase")), React.createElement('div', {
        className: "space-y-2 text-sm"
      }, React.createElement('p', null, "â€¢ " + pilot.sites + " " + (lang === "fr" ? "sites" : "sites")), React.createElement('p', null, "â€¢ " + pilot.beneficiaries.toLocaleString() + " " + (lang === "fr" ? "bÃ©nÃ©ficiaires" : "beneficiaries")), React.createElement('p', null, "â€¢ " + pilot.totalCost.toLocaleString() + " USD"), React.createElement('p', null, "â€¢ " + pilot.durationMonths + " " + (lang === "fr" ? "mois" : "months")))), React.createElement('div', {
        className: "p-4 bg-orange-50 rounded-xl border border-orange-200"
      }, React.createElement('h3', {
        className: "font-bold text-orange-800 mb-3"
      }, "ðŸŽ¯ " + (lang === "fr" ? "Ã‰chelle Cible" : "Target Scale")), React.createElement('div', {
        className: "space-y-2 text-sm"
      }, React.createElement('p', null, "â€¢ " + targetScale.sites + " " + (lang === "fr" ? "sites" : "sites") + " (Ã—" + report.scalingRatio + ")"), React.createElement('p', null, "â€¢ " + targetScale.beneficiaries.toLocaleString() + " " + (lang === "fr" ? "bÃ©nÃ©ficiaires" : "beneficiaries")), React.createElement('p', null, "â€¢ " + report.costs.totalCost.toLocaleString() + " USD"), React.createElement('p', null, "â€¢ " + report.timeline.total + " " + (lang === "fr" ? "mois estimÃ©s" : "months estimated"))))), React.createElement('div', {
        className: "p-4 rounded-xl mb-6 " + (report.feasibility.level === 'high' ? 'bg-green-50 border-green-200' : report.feasibility.level === 'medium' ? 'bg-amber-50 border-amber-200' : 'bg-red-50 border-red-200') + " border"
      }, React.createElement('div', {
        className: "flex items-center justify-between"
      }, React.createElement('div', null, React.createElement('p', {
        className: "font-bold text-lg"
      }, lang === "fr" ? "Score de faisabilitÃ©" : "Feasibility Score"), React.createElement('p', {
        className: "text-sm text-gray-600"
      }, report.feasibility.label)), React.createElement('p', {
        className: "text-4xl font-bold " + (report.feasibility.level === 'high' ? 'text-green-600' : report.feasibility.level === 'medium' ? 'text-amber-600' : 'text-red-600')
      }, report.feasibility.score + "%"))), React.createElement('div', {
        className: "mb-6"
      }, React.createElement('h3', {
        className: "font-bold text-gray-800 mb-3"
      }, "âš ï¸ " + (lang === "fr" ? "Risques de mise Ã  l'Ã©chelle" : "Scaling Risks")), React.createElement('div', {
        className: "space-y-2"
      }, report.risks.slice(0, 4).map(function (risk, idx) {
        return React.createElement('div', {
          key: idx,
          className: "flex items-center gap-3 p-2 bg-gray-50 rounded-lg"
        }, React.createElement('div', {
          className: "flex-1"
        }, React.createElement('p', {
          className: "text-sm font-medium"
        }, risk.label), React.createElement('div', {
          className: "h-2 bg-gray-200 rounded-full mt-1"
        }, React.createElement('div', {
          className: "h-full rounded-full " + (risk.severity === 'high' ? 'bg-red-500' : risk.severity === 'medium' ? 'bg-amber-500' : 'bg-green-500'),
          style: {
            width: risk.probabilityPercent + '%'
          }
        }))), React.createElement('span', {
          className: "text-sm font-bold " + (risk.severity === 'high' ? 'text-red-600' : risk.severity === 'medium' ? 'text-amber-600' : 'text-green-600')
        }, risk.probabilityPercent + "%"));
      }))), React.createElement('div', {
        className: "p-4 bg-indigo-50 rounded-xl border border-indigo-200"
      }, React.createElement('h3', {
        className: "font-bold text-indigo-800 mb-3"
      }, "ðŸ‘¥ " + (lang === "fr" ? "Besoins en ressources humaines" : "Human Resources Needs")), React.createElement('div', {
        className: "grid grid-cols-3 gap-2 text-sm"
      }, React.createElement('p', null, "â€¢ " + report.humanResources.trainers + " " + (lang === "fr" ? "formateurs" : "trainers")), React.createElement('p', null, "â€¢ " + report.humanResources.supervisors + " " + (lang === "fr" ? "superviseurs" : "supervisors")), React.createElement('p', null, "â€¢ " + report.humanResources.coordinators + " " + (lang === "fr" ? "coordinateurs" : "coordinators")), React.createElement('p', null, "â€¢ " + report.humanResources.regionalManagers + " " + (lang === "fr" ? "managers rÃ©g." : "regional mgrs")), React.createElement('p', null, "â€¢ " + report.humanResources.qualityOfficers + " " + (lang === "fr" ? "qualitÃ©" : "quality")), React.createElement('p', {
        className: "font-bold"
      }, "= " + report.humanResources.total + " " + (lang === "fr" ? "total" : "total")))));
    }()), React.createElement('div', {
      className: "p-4 border-t flex justify-end"
    }, React.createElement('button', {
      onClick: function () {
        setShowScaling(false);
      },
      className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
    }, lang === "fr" ? "Fermer" : "Close")))), showDHIS2 && React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto"
    }, React.createElement('div', {
      className: "bg-gradient-to-r from-green-600 to-emerald-600 p-6 text-white rounded-t-2xl"
    }, React.createElement('div', {
      className: "flex justify-between items-start"
    }, React.createElement('div', null, React.createElement('h2', {
      className: "text-2xl font-bold flex items-center gap-2"
    }, "ðŸ”— ", lang === "fr" ? "Connecteur DHIS2" : "DHIS2 Connector"), React.createElement('p', {
      className: "text-white/80 mt-1"
    }, lang === "fr" ? "Importez les donnÃ©es de santÃ© existantes" : "Import existing health data")), React.createElement('button', {
      onClick: function () {
        setShowDHIS2(false);
      },
      className: "text-white/80 hover:text-white text-2xl"
    }, "Ã—"))), React.createElement('div', {
      className: "p-6"
    }, React.createElement('div', {
      className: "p-4 bg-amber-50 rounded-xl border border-amber-200 mb-6"
    }, React.createElement('h3', {
      className: "font-bold text-amber-800 mb-3"
    }, "âš™ï¸ " + (lang === "fr" ? "Configuration DHIS2" : "DHIS2 Configuration")), React.createElement('div', {
      className: "space-y-3"
    }, React.createElement('input', {
      type: "text",
      placeholder: lang === "fr" ? "URL DHIS2 (ex: https://play.dhis2.org/40)" : "DHIS2 URL (e.g.: https://play.dhis2.org/40)",
      className: "w-full px-4 py-2 border rounded-lg"
    }), React.createElement('input', {
      type: "text",
      placeholder: lang === "fr" ? "Nom d'utilisateur" : "Username",
      className: "w-full px-4 py-2 border rounded-lg"
    }), React.createElement('input', {
      type: "password",
      placeholder: lang === "fr" ? "Mot de passe" : "Password",
      className: "w-full px-4 py-2 border rounded-lg"
    }), React.createElement('button', {
      className: "w-full py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium"
    }, lang === "fr" ? "Tester la connexion" : "Test Connection"))), React.createElement('div', null, React.createElement('h3', {
      className: "font-bold text-gray-800 mb-3"
    }, "ðŸ“Š " + (lang === "fr" ? "Indicateurs disponibles" : "Available Indicators")), React.createElement('div', {
      className: "space-y-2"
    }, Object.entries(DHIS2Connector.getStandardIndicators()).map(function (entry) {
      var category = entry[0];
      var indicators = entry[1];
      var categoryLabels = {
        mental_health: 'ðŸ§  SantÃ© mentale',
        maternal_child: 'ðŸ‘¶ SantÃ© maternelle',
        general: 'ðŸ¥ GÃ©nÃ©ral'
      };
      return React.createElement('div', {
        key: category,
        className: "p-3 bg-gray-50 rounded-lg"
      }, React.createElement('p', {
        className: "font-medium text-gray-700 mb-2"
      }, categoryLabels[category] || category), React.createElement('div', {
        className: "flex flex-wrap gap-2"
      }, indicators.map(function (ind) {
        return React.createElement('span', {
          key: ind.id,
          className: "px-2 py-1 bg-white border rounded text-xs"
        }, ind.name);
      })));
    }))), React.createElement('div', {
      className: "mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200"
    }, React.createElement('p', {
      className: "text-sm text-blue-800"
    }, "ðŸ’¡ " + (lang === "fr" ? "En mode dÃ©mo, des donnÃ©es simulÃ©es seront gÃ©nÃ©rÃ©es. Connectez-vous Ã  votre instance DHIS2 pour importer des donnÃ©es rÃ©elles." : "In demo mode, simulated data will be generated. Connect to your DHIS2 instance to import real data.")))), React.createElement('div', {
      className: "p-4 border-t flex justify-end"
    }, React.createElement('button', {
      onClick: function () {
        setShowDHIS2(false);
      },
      className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
    }, lang === "fr" ? "Fermer" : "Close")))), showVoiceAssistant && React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl shadow-2xl max-w-md w-full"
    }, React.createElement('div', {
      className: "bg-gradient-to-r from-violet-600 to-purple-600 p-6 text-white rounded-t-2xl"
    }, React.createElement('div', {
      className: "flex justify-between items-start"
    }, React.createElement('div', null, React.createElement('h2', {
      className: "text-2xl font-bold flex items-center gap-2"
    }, "ðŸŽ™ï¸ ", lang === "fr" ? "Assistant Vocal" : "Voice Assistant"), React.createElement('p', {
      className: "text-white/80 mt-1"
    }, lang === "fr" ? "Saisie vocale pour le terrain" : "Voice input for field work")), React.createElement('button', {
      onClick: function () {
        setShowVoiceAssistant(false);
      },
      className: "text-white/80 hover:text-white text-2xl"
    }, "Ã—"))), React.createElement('div', {
      className: "p-6"
    }, function () {
      var status = VoiceAssistant.getStatus();
      return React.createElement('div', null, React.createElement('div', {
        className: "text-center mb-6"
      }, React.createElement('div', {
        className: "w-24 h-24 mx-auto rounded-full flex items-center justify-center text-5xl " + (status.isListening ? "bg-red-100 animate-pulse" : "bg-violet-100")
      }, status.isListening ? "ðŸ”´" : "ðŸŽ™ï¸"), React.createElement('p', {
        className: "mt-4 font-medium text-gray-800"
      }, status.isListening ? lang === "fr" ? "Ã‰coute en cours..." : "Listening..." : lang === "fr" ? "PrÃªt Ã  Ã©couter" : "Ready to listen")), React.createElement('div', {
        className: "grid grid-cols-2 gap-3 mb-6"
      }, React.createElement('button', {
        onClick: function () {
          var result = VoiceAssistant.init(lang);
          if (result.success) {
            VoiceAssistant.startListening();
          } else {
            alert(result.error);
          }
        },
        className: "py-3 bg-violet-600 text-white rounded-xl hover:bg-violet-700 transition font-medium"
      }, "ðŸŽ¤ " + (lang === "fr" ? "DÃ©marrer" : "Start")), React.createElement('button', {
        onClick: function () {
          VoiceAssistant.stopListening();
        },
        className: "py-3 bg-gray-200 text-gray-700 rounded-xl hover:bg-gray-300 transition font-medium"
      }, "â¹ï¸ " + (lang === "fr" ? "ArrÃªter" : "Stop"))), React.createElement('div', {
        className: "p-4 bg-gray-50 rounded-xl mb-4"
      }, React.createElement('h4', {
        className: "font-medium text-gray-800 mb-2"
      }, lang === "fr" ? "Commandes vocales:" : "Voice commands:"), React.createElement('ul', {
        className: "text-sm text-gray-600 space-y-1"
      }, React.createElement('li', null, "â€¢ \"" + (lang === "fr" ? "Nouvelle barriÃ¨re" : "New barrier") + "\""), React.createElement('li', null, "â€¢ \"" + (lang === "fr" ? "Ajouter observation" : "Add observation") + "\""), React.createElement('li', null, "â€¢ \"" + (lang === "fr" ? "Statut du projet" : "Project status") + "\""), React.createElement('li', null, "â€¢ \"" + (lang === "fr" ? "Aide" : "Help") + "\""))), React.createElement('div', {
        className: "flex items-center justify-between text-sm"
      }, React.createElement('span', {
        className: status.isOffline ? "text-amber-600" : "text-green-600"
      }, status.isOffline ? "ðŸ“´ " + (lang === "fr" ? "Mode offline" : "Offline mode") : "ðŸ“¶ " + (lang === "fr" ? "En ligne" : "Online")), React.createElement('span', {
        className: "text-gray-500"
      }, status.pendingSync + " " + (lang === "fr" ? "en attente de sync" : "pending sync"))));
    }()), React.createElement('div', {
      className: "p-4 border-t flex justify-end"
    }, React.createElement('button', {
      onClick: function () {
        setShowVoiceAssistant(false);
      },
      className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
    }, lang === "fr" ? "Fermer" : "Close")))), showClosedLoop && React.createElement('div', {
      className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
    }, React.createElement('div', {
      className: "bg-white rounded-2xl shadow-2xl max-w-3xl w-full"
    }, React.createElement('div', {
      className: "bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white rounded-t-2xl"
    }, React.createElement('div', {
      className: "flex justify-between items-start"
    }, React.createElement('div', null, React.createElement('h2', {
      className: "text-2xl font-bold flex items-center gap-2"
    }, "ðŸ”„ ", lang === "fr" ? "Boucle de Pilotage Adaptatif" : "Adaptive Management Loop"), React.createElement('p', {
      className: "text-white/80 mt-1"
    }, lang === "fr" ? "Le cÅ“ur de MOUDAR : du diagnostic Ã  l'action corrective" : "The heart of MOUDAR: from diagnosis to corrective action")), React.createElement('button', {
      onClick: function () {
        setShowClosedLoop(false);
      },
      className: "text-white/80 hover:text-white text-2xl"
    }, "Ã—"))), React.createElement('div', {
      className: "p-6"
    }, function () {
      var loopData = DemoGuide.getClosedLoopDemo(lang);
      var statusColors = {
        alert: 'from-amber-100 to-orange-100 border-amber-300',
        warning: 'from-red-100 to-pink-100 border-red-300',
        action: 'from-blue-100 to-indigo-100 border-blue-300',
        done: 'from-purple-100 to-violet-100 border-purple-300',
        success: 'from-green-100 to-emerald-100 border-green-300'
      };
      return React.createElement('div', null, React.createElement('div', {
        className: "flex items-center justify-center mb-6"
      }, loopData.steps.map(function (step, idx) {
        return React.createElement('div', {
          key: idx,
          className: "flex items-center"
        }, React.createElement('div', {
          className: "w-12 h-12 rounded-full flex items-center justify-center text-2xl bg-gradient-to-br " + statusColors[step.status] + " border-2"
        }, step.icon), idx < loopData.steps.length - 1 && React.createElement('div', {
          className: "w-8 h-1 bg-gradient-to-r from-indigo-300 to-purple-300 mx-1"
        }));
      })), React.createElement('div', {
        className: "space-y-3"
      }, loopData.steps.map(function (step, idx) {
        return React.createElement('div', {
          key: idx,
          className: "flex items-start gap-4 p-4 rounded-xl bg-gradient-to-r " + statusColors[step.status] + " border"
        }, React.createElement('div', {
          className: "text-3xl"
        }, step.icon), React.createElement('div', {
          className: "flex-1"
        }, React.createElement('p', {
          className: "font-bold text-gray-800"
        }, idx + 1 + ". " + step.label), React.createElement('p', {
          className: "text-sm text-gray-600"
        }, step.detail)), React.createElement('div', {
          className: "text-2xl"
        }, idx < loopData.steps.length - 1 ? "â†’" : "âœ“"));
      })), React.createElement('div', {
        className: "mt-6 p-4 bg-indigo-50 rounded-xl border border-indigo-200"
      }, React.createElement('p', {
        className: "text-sm text-indigo-800"
      }, "ðŸ’¡ " + (lang === "fr" ? "Cette boucle s'exÃ©cute automatiquement : MOUDAR dÃ©tecte les Ã©carts, gÃ©nÃ¨re des alertes et propose des actions correctives basÃ©es sur les stratÃ©gies ERIC." : "This loop runs automatically: MOUDAR detects deviations, generates alerts and proposes corrective actions based on ERIC strategies."))));
    }()), React.createElement('div', {
      className: "p-4 border-t flex justify-end"
    }, React.createElement('button', {
      onClick: function () {
        setShowClosedLoop(false);
      },
      className: "px-6 py-2 bg-gray-800 text-white rounded-xl hover:bg-gray-700 transition"
    }, lang === "fr" ? "Fermer" : "Close")))), showGanttTimeline && protocol && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(GanttTimelineView, {
      project: answers,
      strategies: protocol.aiRawRecommendations.strategies.top,
      lang: lang,
      onClose: function () {
        setShowGanttTimeline(false);
      }
    }), showCFIR2 && protocol && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(CFIR2View, {
      project: answers,
      strategies: protocol.aiRawRecommendations.strategies.top,
      lang: lang,
      onClose: function () {
        setShowCFIR2(false);
      }
    }), showREAIM && protocol && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(REAIMView, {
      project: answers,
      strategies: protocol.aiRawRecommendations.strategies.top,
      lang: lang,
      onClose: function () {
        setShowREAIM(false);
      }
    }), showROICalculator && protocol && /*#__PURE__*/React.createElement(ROICalculatorView, {
      project: answers,
      budget: MoudarEngine.estimateBudget(answers, protocol.aiRawRecommendations ? protocol.aiRawRecommendations.strategies.top : [], lang),
      lang: lang,
      onClose: function () {
        setShowROICalculator(false);
      }
    }), showFundingProposal && protocol && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(FundingProposalView, {
      project: answers,
      strategies: protocol.aiRawRecommendations.strategies.top,
      budget: MoudarEngine.estimateBudget(answers, protocol.aiRawRecommendations.strategies.top, lang),
      lang: lang,
      onClose: function () {
        setShowFundingProposal(false);
      }
    }), showMonitoringDashboard && protocol && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(MonitoringDashboardView, {
      project: answers,
      strategies: protocol.aiRawRecommendations.strategies.top,
      lang: lang,
      onClose: function () {
        setShowMonitoringDashboard(false);
      }
    }), showLogicModel && protocol && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(LogicModelView, {
      project: answers,
      strategies: protocol.aiRawRecommendations.strategies.top,
      lang: lang,
      onClose: function () {
        setShowLogicModel(false);
      }
    }), showMonteCarlo && protocol && protocol.aiRawRecommendations && /*#__PURE__*/React.createElement(MonteCarloView, {
      project: answers,
      strategies: protocol.aiRawRecommendations.strategies.top,
      lang: lang,
      onClose: function () {
        setShowMonteCarlo(false);
      }
    }), showNLPAnalyzer && /*#__PURE__*/React.createElement(NLPBarrierAnalyzerView, {
      project: answers,
      lang: lang,
      onClose: function () {
        setShowNLPAnalyzer(false);
      }
    }), showPowerPointGenerator && protocol && /*#__PURE__*/React.createElement(PowerPointGeneratorView, {
      project: answers,
      protocol: protocol,
      lang: lang,
      onClose: function () {
        setShowPowerPointGenerator(false);
      }
    }), showAPIDocs && /*#__PURE__*/React.createElement(APIDocumentationView, {
      lang: lang,
      onClose: function () {
        setShowAPIDocs(false);
      }
    }), showCommunityHub && /*#__PURE__*/React.createElement(CommunityHubView, {
      project: answers,
      lang: lang,
      onClose: function () {
        setShowCommunityHub(false);
      }
    }), showDataIntegrations && /*#__PURE__*/React.createElement(DataIntegrationsView, {
      project: answers,
      protocol: protocol,
      lang: lang,
      onClose: function () {
        setShowDataIntegrations(false);
      }
    }), showXAIExplainer && /*#__PURE__*/React.createElement(XAIExplainerView, {
      protocol: protocol,
      answers: answers,
      lang: lang,
      onClose: function () {
        setShowXAIExplainer(false);
      }
    }), showGlossary && /*#__PURE__*/React.createElement(GlossaryView, {
      lang: lang,
      onClose: function () {
        setShowGlossary(false);
      }
    }), showCertification && /*#__PURE__*/React.createElement(CertificationView, {
      protocol: protocol,
      answers: answers,
      lang: lang,
      onClose: function () {
        setShowCertification(false);
      }
    }), showDocumentAnalyzer && /*#__PURE__*/React.createElement(DocumentAnalyzerView, {
      lang: lang,
      onClose: function () {
        setShowDocumentAnalyzer(false);
      }
    }));
  }
  var currentQ = questions[step];
  var progress = (step + 1) / questions.length * 100;

  // v8.0 - Regroupement des questions en 4 phases
  var phases = [{
    name: {
      fr: "Projet",
      en: "Project"
    },
    icon: "ðŸ“‹",
    questions: [0, 1, 2]
  }, {
    name: {
      fr: "Contexte",
      en: "Context"
    },
    icon: "ðŸ¢",
    questions: [3, 4]
  }, {
    name: {
      fr: "Cibles",
      en: "Targets"
    },
    icon: "ðŸŽ¯",
    questions: [5]
  }, {
    name: {
      fr: "BarriÃ¨res",
      en: "Barriers"
    },
    icon: "âš ï¸",
    questions: [6]
  }];
  var currentPhase = phases.findIndex(function (p) {
    return p.questions.includes(step);
  });
  if (currentPhase < 0) currentPhase = 3;
  return /*#__PURE__*/React.createElement("div", {
    className: "max-w-lg mx-auto fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-4"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800"
  }, "\u2728 ", lang === "fr" ? "Assistant de conception" : "Design Assistant"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500 text-sm"
  }, lang === "fr" ? "En 10-15 minutes, obtenez un squelette de protocole" : "In 10-15 minutes, get a protocol skeleton")), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-6 px-4"
  }, phases.map(function (phase, i) {
    var isActive = i === currentPhase;
    var isCompleted = i < currentPhase;
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "flex flex-col items-center flex-1"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center w-full"
    }, /*#__PURE__*/React.createElement("div", {
      className: "w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold transition-all " + (isCompleted ? "bg-green-500 text-white" : isActive ? "bg-purple-600 text-white ring-4 ring-purple-200" : "bg-gray-200 text-gray-500")
    }, isCompleted ? "âœ“" : phase.icon), i < phases.length - 1 && /*#__PURE__*/React.createElement("div", {
      className: "flex-1 h-1 mx-2 rounded " + (i < currentPhase ? "bg-green-500" : "bg-gray-200")
    })), /*#__PURE__*/React.createElement("span", {
      className: "text-xs mt-1 font-medium " + (isActive ? "text-purple-700" : "text-gray-500")
    }, phase.name[lang]));
  })), /*#__PURE__*/React.createElement("div", {
    className: "h-2 bg-gray-200 rounded-full mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "h-2 bg-purple-500 rounded-full transition-all",
    style: {
      width: progress + "%"
    }
  })), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl shadow-xl p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 mb-4"
  }, /*#__PURE__*/React.createElement("span", {
    className: "w-8 h-8 bg-purple-100 text-purple-700 rounded-full flex items-center justify-center font-bold text-sm"
  }, step + 1), /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800"
  }, currentQ.q)), currentQ.type === "text" && /*#__PURE__*/React.createElement("input", {
    type: "text",
    value: answers[currentQ.id] || "",
    onChange: function (e) {
      var newAnswers = Object.assign({}, answers);
      newAnswers[currentQ.id] = e.target.value;
      setAnswers(newAnswers);
    },
    className: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition",
    placeholder: currentQ.placeholder || ""
  }), currentQ.type === "textarea" && /*#__PURE__*/React.createElement("textarea", {
    value: answers[currentQ.id] || "",
    onChange: function (e) {
      var newAnswers = Object.assign({}, answers);
      newAnswers[currentQ.id] = e.target.value;
      setAnswers(newAnswers);
    },
    rows: 4,
    className: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition",
    placeholder: currentQ.placeholder || ""
  }), currentQ.type === "select" && /*#__PURE__*/React.createElement("div", {
    className: "space-y-2 max-h-64 overflow-y-auto"
  }, currentQ.options.map(function (opt) {
    var isSelected = answers[currentQ.id] === opt.value;
    return /*#__PURE__*/React.createElement("button", {
      key: opt.value,
      onClick: function () {
        var newAnswers = Object.assign({}, answers);
        newAnswers[currentQ.id] = opt.value;
        setAnswers(newAnswers);
      },
      className: "w-full text-left p-3 rounded-xl border-2 transition " + (isSelected ? "border-purple-500 bg-purple-50" : "border-gray-200 hover:border-gray-300")
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium"
    }, opt.label), currentQ.showDescription && opt.description && /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mt-1"
    }, opt.description));
  })), currentQ.type === "number" && /*#__PURE__*/React.createElement("input", {
    type: "number",
    value: answers[currentQ.id] || "",
    onChange: function (e) {
      var newAnswers = Object.assign({}, answers);
      newAnswers[currentQ.id] = e.target.value ? parseInt(e.target.value) : "";
      setAnswers(newAnswers);
    },
    min: currentQ.min || 1,
    max: currentQ.max || 999999,
    className: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-purple-500 focus:outline-none transition",
    placeholder: currentQ.placeholder || ""
  }), currentQ.type === "multiselect" && /*#__PURE__*/React.createElement("div", {
    className: "space-y-2 max-h-72 overflow-y-auto"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500 mb-2"
  }, lang === "fr" ? "SÃ©lectionnez " + (currentQ.minSelect || 1) + " Ã  " + (currentQ.maxSelect || 5) + " options" : "Select " + (currentQ.minSelect || 1) + " to " + (currentQ.maxSelect || 5) + " options", " â€¢ ", /*#__PURE__*/React.createElement("span", {
    className: "font-medium"
  }, (answers[currentQ.id] || []).length, " ", lang === "fr" ? "sÃ©lectionnÃ©(s)" : "selected")), currentQ.options.map(function (opt) {
    var currentSelections = answers[currentQ.id] || [];
    var isSelected = currentSelections.indexOf(opt.value) !== -1;
    var canSelect = currentSelections.length < (currentQ.maxSelect || 5) || isSelected;
    return /*#__PURE__*/React.createElement("button", {
      key: opt.value,
      onClick: function () {
        if (!canSelect && !isSelected) return;
        var newAnswers = Object.assign({}, answers);
        var selections = newAnswers[currentQ.id] ? newAnswers[currentQ.id].slice() : [];
        if (isSelected) {
          selections = selections.filter(function (v) {
            return v !== opt.value;
          });
        } else {
          selections.push(opt.value);
        }
        newAnswers[currentQ.id] = selections;
        setAnswers(newAnswers);
      },
      disabled: !canSelect && !isSelected,
      className: "w-full text-left p-3 rounded-xl border-2 transition flex items-center gap-3 " + (isSelected ? "border-purple-500 bg-purple-50" : canSelect ? "border-gray-200 hover:border-gray-300" : "border-gray-100 bg-gray-50 opacity-50 cursor-not-allowed")
    }, /*#__PURE__*/React.createElement("span", {
      className: "w-5 h-5 rounded border-2 flex items-center justify-center " + (isSelected ? "border-purple-500 bg-purple-500 text-white" : "border-gray-300")
    }, isSelected && "âœ“"), /*#__PURE__*/React.createElement("span", {
      className: "font-medium"
    }, opt.label));
  })), currentQ.help && /*#__PURE__*/React.createElement("p", {
    className: "mt-3 text-sm text-gray-500 flex items-start gap-2"
  }, /*#__PURE__*/React.createElement("span", null, "\uD83D\uDCA1"), /*#__PURE__*/React.createElement("span", null, currentQ.help)), /*#__PURE__*/React.createElement("div", {
    className: "mt-2 flex items-center gap-2"
  }, currentQ.required !== false ? /*#__PURE__*/React.createElement("span", {
    className: "text-xs bg-red-100 text-red-700 px-2 py-0.5 rounded"
  }, lang === "fr" ? "Obligatoire" : "Required") : /*#__PURE__*/React.createElement("span", {
    className: "text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded"
  }, lang === "fr" ? "Optionnel" : "Optional")), qualityScore && /*#__PURE__*/React.createElement("div", {
    className: "mt-4 p-3 rounded-lg border " + (qualityScore.color === 'green' ? 'bg-green-50 border-green-200' : qualityScore.color === 'blue' ? 'bg-blue-50 border-blue-200' : qualityScore.color === 'yellow' ? 'bg-yellow-50 border-yellow-200' : 'bg-red-50 border-red-200')
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center justify-between"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-sm font-medium"
  }, lang === "fr" ? "QualitÃ© des donnÃ©es:" : "Data quality:"), /*#__PURE__*/React.createElement("span", {
    className: "font-bold " + (qualityScore.color === 'green' ? 'text-green-700' : qualityScore.color === 'blue' ? 'text-blue-700' : qualityScore.color === 'yellow' ? 'text-yellow-700' : 'text-red-700')
  }, qualityScore.score, "% - ", qualityScore.label[lang])), /*#__PURE__*/React.createElement("div", {
    className: "w-full bg-gray-200 rounded-full h-2 mt-2"
  }, /*#__PURE__*/React.createElement("div", {
    className: "h-2 rounded-full " + (qualityScore.color === 'green' ? 'bg-green-500' : qualityScore.color === 'blue' ? 'bg-blue-500' : qualityScore.color === 'yellow' ? 'bg-yellow-500' : 'bg-red-500'),
    style: {
      width: qualityScore.score + '%'
    }
  }))), validationErrors && validationErrors.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "mt-4 p-4 bg-red-50 border border-red-200 rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center text-red-800 font-semibold mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "mr-2"
  }, "\u26A0\uFE0F"), lang === "fr" ? "DonnÃ©es insuffisantes" : "Insufficient data"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-red-700 mb-2"
  }, lang === "fr" ? "Veuillez corriger les erreurs suivantes pour gÃ©nÃ©rer un protocole fiable:" : "Please correct the following errors to generate a reliable protocol:"), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-red-600 space-y-1"
  }, validationErrors.map(function (err, idx) {
    return React.createElement('li', {
      key: idx,
      className: "flex items-start"
    }, React.createElement('span', {
      className: "mr-2"
    }, "â€¢"), React.createElement('span', null, React.createElement('strong', null, err.field + ": "), err.message));
  })), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setValidationErrors(null);
    },
    className: "mt-3 text-xs text-red-600 hover:text-red-800 underline"
  }, lang === "fr" ? "Fermer" : "Close")), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between mt-6"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setStep(Math.max(0, step - 1));
    },
    disabled: step === 0,
    className: "px-4 py-2 text-gray-600 disabled:opacity-50 hover:text-gray-800 transition"
  }, "\u2190 ", lang === "fr" ? "PrÃ©cÃ©dent" : "Previous"), step < questions.length - 1 ? /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setStep(step + 1);
    },
    className: "px-6 py-2 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition"
  }, lang === "fr" ? "Suivant" : "Next", " \u2192") : /*#__PURE__*/React.createElement("button", {
    onClick: generateProtocol,
    disabled: isGenerating,
    className: "px-6 py-2 text-white rounded-xl transition " + (isGenerating ? "bg-gray-500 cursor-wait" : "bg-green-600 hover:bg-green-700")
  }, isGenerating ? /*#__PURE__*/React.createElement("span", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("svg", {
    className: "animate-spin h-4 w-4",
    viewBox: "0 0 24 24"
  }, /*#__PURE__*/React.createElement("circle", {
    className: "opacity-25",
    cx: "12",
    cy: "12",
    r: "10",
    stroke: "currentColor",
    strokeWidth: "4",
    fill: "none"
  }), /*#__PURE__*/React.createElement("path", {
    className: "opacity-75",
    fill: "currentColor",
    d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
  })), lang === "fr" ? "GÃ©nÃ©ration IA..." : "AI Generation...") : /*#__PURE__*/React.createElement("span", null, "\u2728 ", lang === "fr" ? "GÃ©nÃ©rer le protocole" : "Generate protocol")))));
}

// ============================================
// DIAGNOSTIC VIEW
// ============================================
function DiagnosticView(props) {
  var lang = props.lang;
  var demoMode = props.demoMode;
  var linkedProject = props.linkedProject;
  var startedState = useState(demoMode ? true : false);
  var started = startedState[0];
  var setStarted = startedState[1];
  var answersState = useState(demoMode ? DEMO_DIAGNOSTIC_ANSWERS : {});
  var answers = answersState[0];
  var setAnswers = answersState[1];
  var resultsState = useState(null);
  var results = resultsState[0];
  var setResults = resultsState[1];
  var orgNameState = useState(demoMode ? "MinistÃ¨re de la SantÃ© - RÃ©gion Souss-Massa" : linkedProject ? linkedProject.organization : "");
  var orgName = orgNameState[0];
  var setOrgName = orgNameState[1];
  var reportRef = useRef(null);
  var savedState = useState(false);
  var saved = savedState[0];
  var setSaved = savedState[1];
  var allQuestions = [];
  Object.keys(DIAGNOSTIC_QUESTIONS).forEach(function (cat) {
    DIAGNOSTIC_QUESTIONS[cat].questions.forEach(function (q) {
      allQuestions.push(Object.assign({}, q, {
        category: cat
      }));
    });
  });
  function calculateResults() {
    var scores = {};
    var total = 0;
    var count = 0;
    Object.keys(DIAGNOSTIC_QUESTIONS).forEach(function (cat) {
      var qs = DIAGNOSTIC_QUESTIONS[cat].questions;
      var catScore = 0;
      qs.forEach(function (q) {
        var val = answers[q.id] || 0;
        catScore += val;
        total += val;
        count++;
      });
      scores[cat] = Math.round(catScore / (qs.length * 5) * 100);
    });
    var globalScore = Math.round(total / (count * 5) * 100);
    var strengths = [];
    var concerns = [];
    var priorities = [];
    Object.keys(scores).forEach(function (cat) {
      var score = scores[cat];
      var label = tObj(DIAGNOSTIC_QUESTIONS[cat].label, lang);
      if (score >= 70) {
        strengths.push({
          cat: cat,
          label: label,
          score: score
        });
      } else if (score >= 50) {
        concerns.push({
          cat: cat,
          label: label,
          score: score
        });
      } else {
        priorities.push({
          cat: cat,
          label: label,
          score: score
        });
      }
    });
    var maturityLevel, interpretation;
    if (globalScore >= 80) {
      maturityLevel = lang === "fr" ? "Ã‰levÃ©e" : "High";
      interpretation = lang === "fr" ? "Votre organisation dispose de solides fondations pour l'implÃ©mentation. Concentrez-vous sur l'optimisation et le partage des bonnes pratiques." : "Your organization has solid implementation foundations. Focus on optimization and sharing best practices.";
    } else if (globalScore >= 60) {
      maturityLevel = lang === "fr" ? "IntermÃ©diaire" : "Intermediate";
      interpretation = lang === "fr" ? "Votre organisation a des atouts mais aussi des axes d'amÃ©lioration identifiÃ©s. Un travail ciblÃ© sur les prioritÃ©s accÃ©lÃ©rera votre capacitÃ© de changement." : "Your organization has strengths but also identified areas for improvement. Targeted work on priorities will accelerate your change capacity.";
    } else {
      maturityLevel = lang === "fr" ? "Ã€ dÃ©velopper" : "To develop";
      interpretation = lang === "fr" ? "Votre organisation nÃ©cessite un renforcement significatif avant d'entreprendre des changements majeurs. Commencez par les fondamentaux : leadership et ressources." : "Your organization requires significant strengthening before major changes. Start with fundamentals: leadership and resources.";
    }
    var resultData = {
      scores: scores,
      global: globalScore,
      globalScore: globalScore,
      maturityLevel: maturityLevel,
      interpretation: interpretation,
      strengths: strengths,
      concerns: concerns,
      watchpoints: concerns,
      priorities: priorities
    };
    setResults(resultData);

    // Attacher au projet si liÃ©
    if (linkedProject && linkedProject.id) {
      StorageManager.attachDiagnostic(linkedProject.id, resultData);
      setSaved(true);
      setTimeout(function () {
        setSaved(false);
      }, 3000);
    }
  }
  function interpretCategory(category, score) {
    if (lang === "fr") {
      if (category === "leadership") {
        if (score >= 70) return "Leadership visiblement engagÃ© dans la transformation.";else if (score >= 50) return "Leadership prÃ©sent mais Ã  structurer davantage.";else return "Besoin d'un sponsoring et d'un alignement plus clair du leadership.";
      }
      if (category === "culture") {
        if (score >= 70) return "Culture favorable Ã  l'innovation et au changement.";else if (score >= 50) return "Ouverture au changement variable selon les Ã©quipes.";else return "RÃ©sistance au changement significative, travail de fond nÃ©cessaire.";
      }
      if (category === "resources") {
        if (score >= 70) return "Ressources adÃ©quates pour soutenir l'implÃ©mentation.";else if (score >= 50) return "Ressources partiellement disponibles, arbitrages nÃ©cessaires.";else return "DÃ©ficit de ressources critique, priorisation indispensable.";
      }
      if (category === "data") {
        if (score >= 70) return "SystÃ¨me d'information et de suivi performant.";else if (score >= 50) return "DonnÃ©es disponibles mais sous-exploitÃ©es.";else return "Absence de donnÃ©es fiables pour piloter le changement.";
      }
      if (category === "capacity") {
        if (score >= 70) return "CompÃ©tences techniques et de gestion du changement prÃ©sentes.";else if (score >= 50) return "CompÃ©tences inÃ©gales, renforcement ciblÃ© recommandÃ©.";else return "Besoin urgent de formation et d'accompagnement.";
      }
      if (category === "partnerships") {
        if (score >= 70) return "RÃ©seau de partenaires actif et mobilisÃ©.";else if (score >= 50) return "Partenariats existants mais Ã  dynamiser.";else return "Isolement relatif, besoin de construire des alliances.";
      }
    } else {
      if (category === "leadership") {
        if (score >= 70) return "Leadership visibly engaged in transformation.";else if (score >= 50) return "Leadership present but needs more structure.";else return "Need for clearer sponsorship and leadership alignment.";
      }
      if (category === "culture") {
        if (score >= 70) return "Culture favorable to innovation and change.";else if (score >= 50) return "Openness to change varies across teams.";else return "Significant resistance to change, foundational work needed.";
      }
      if (category === "resources") {
        if (score >= 70) return "Adequate resources to support implementation.";else if (score >= 50) return "Resources partially available, trade-offs needed.";else return "Critical resource deficit, prioritization essential.";
      }
      if (category === "data") {
        if (score >= 70) return "Performant information and monitoring system.";else if (score >= 50) return "Data available but underutilized.";else return "Lack of reliable data to steer change.";
      }
      if (category === "capacity") {
        if (score >= 70) return "Technical and change management skills present.";else if (score >= 50) return "Uneven skills, targeted reinforcement recommended.";else return "Urgent need for training and support.";
      }
      if (category === "partnerships") {
        if (score >= 70) return "Active and mobilized partner network.";else if (score >= 50) return "Existing partnerships but need revitalization.";else return "Relative isolation, need to build alliances.";
      }
    }
    return "";
  }
  function exportReportWord() {
    if (!results) return;
    var scores = results.scores || {};
    var global = results.globalScore || 0;
    var strengths = [];
    var watchpoints = [];
    var priorities = [];

    // Classer les dimensions
    Object.keys(scores).forEach(function (cat) {
      var s = scores[cat] || 0;
      if (s >= 70) {
        strengths.push({
          cat: cat,
          score: s
        });
      } else if (s >= 50) {
        watchpoints.push({
          cat: cat,
          score: s
        });
      } else {
        priorities.push({
          cat: cat,
          score: s
        });
      }
    });

    // Fonction utilitaire pour lister les catÃ©gories en texte
    function listCategories(arr) {
      if (!arr || arr.length === 0) {
        return lang === "fr" ? "aucune dimension specifique" : "no specific dimension";
      }
      var labels = arr.map(function (item) {
        return tObj(DIAGNOSTIC_QUESTIONS[item.cat].label, lang);
      });
      if (labels.length === 1) return labels[0];
      if (labels.length === 2) {
        return labels[0] + (lang === "fr" ? " et " : " and ") + labels[1];
      }
      var lastSep = lang === "fr" ? " et " : " and ";
      return labels.slice(0, -1).join(", ") + lastSep + labels[labels.length - 1];
    }

    // Niveau de maturitÃ© global
    var maturityLabel;
    if (global >= 80) {
      maturityLabel = lang === "fr" ? "maturite elevee" : "high maturity";
    } else if (global >= 60) {
      maturityLabel = lang === "fr" ? "maturite intermediaire" : "intermediate maturity";
    } else {
      maturityLabel = lang === "fr" ? "maturite fragile" : "fragile maturity";
    }

    // RÃ©sumÃ© exÃ©cutif
    var resumeText;
    if (lang === "fr") {
      resumeText = "Le niveau global de maturite d'implementation est de " + global + "%, ce qui correspond a une " + maturityLabel + ". ";
      if (strengths.length) {
        resumeText += "Les forces principales se situent au niveau de : " + listCategories(strengths) + ". ";
      }
      if (priorities.length) {
        resumeText += "Les principaux axes a renforcer concernent : " + listCategories(priorities) + ".";
      }
    } else {
      resumeText = "The overall implementation maturity level is " + global + "%, which corresponds to " + maturityLabel + ". ";
      if (strengths.length) {
        resumeText += "Key strengths are in: " + listCategories(strengths) + ". ";
      }
      if (priorities.length) {
        resumeText += "Main areas for improvement are: " + listCategories(priorities) + ".";
      }
    }

    // InterprÃ©tation par catÃ©gorie (sans accents pour Word)
    function interpretCat(cat, score) {
      if (lang === "fr") {
        if (cat === "leadership") {
          if (score >= 70) return "Leadership visiblement engage dans la transformation.";
          if (score >= 50) return "Leadership present mais a structurer davantage.";
          return "Besoin d'un sponsoring plus clair du leadership.";
        }
        if (cat === "culture") {
          if (score >= 70) return "Culture favorable a l'amelioration continue.";
          if (score >= 50) return "Culture en transition vers l'amelioration.";
          return "Culture peu favorable au changement, a travailler.";
        }
        if (cat === "resources") {
          if (score >= 70) return "Ressources globalement adequates pour le projet.";
          if (score >= 50) return "Ressources limitees, mais mobilisables.";
          return "Ressources jugees insuffisantes pour une implementation sereine.";
        }
        if (cat === "data") {
          if (score >= 70) return "Donnees bien utilisees pour piloter l'implementation.";
          if (score >= 50) return "Donnees disponibles mais encore peu exploitees.";
          return "Systeme d'information fragile pour suivre l'implementation.";
        }
        if (cat === "capacity") {
          if (score >= 70) return "Bon niveau de competences et de capacite de changement.";
          if (score >= 50) return "Capacites presentes mais a renforcer.";
          return "Capacites techniques / changement a consolider avant d'aller plus loin.";
        }
        if (cat === "partnerships") {
          if (score >= 70) return "Reseau de partenaires solide et actif.";
          if (score >= 50) return "Partenariats presents mais sous-exploites.";
          return "Partenariats a structurer pour soutenir l'implementation.";
        }
      } else {
        if (cat === "leadership") {
          if (score >= 70) return "Leadership clearly engaged in the transformation.";
          if (score >= 50) return "Leadership present but needs clearer structure.";
          return "Need for clearer executive sponsorship.";
        }
        if (cat === "culture") {
          if (score >= 70) return "Culture supportive of continuous improvement.";
          if (score >= 50) return "Culture in transition towards improvement.";
          return "Culture is not yet supportive of change.";
        }
        if (cat === "resources") {
          if (score >= 70) return "Resources broadly adequate for the project.";
          if (score >= 50) return "Resources limited but mobilizable.";
          return "Resources perceived as insufficient for safe implementation.";
        }
        if (cat === "data") {
          if (score >= 70) return "Data are well used to steer implementation.";
          if (score >= 50) return "Data are available but underused.";
          return "Information system fragile to monitor implementation.";
        }
        if (cat === "capacity") {
          if (score >= 70) return "Good level of skills and change capacity.";
          if (score >= 50) return "Capacity present but needs reinforcement.";
          return "Technical / change capacity needs strengthening.";
        }
        if (cat === "partnerships") {
          if (score >= 70) return "Strong and active partnership network.";
          if (score >= 50) return "Partnerships exist but are underused.";
          return "Partnerships need to be developed to support implementation.";
        }
      }
      return "";
    }
    var children = [];

    // Titre
    children.push(new docx.Paragraph({
      text: lang === "fr" ? "RAPPORT DE DIAGNOSTIC D'IMPLEMENTATION" : "IMPLEMENTATION DIAGNOSTIC REPORT",
      heading: docx.HeadingLevel.TITLE,
      alignment: docx.AlignmentType.CENTER
    }));
    children.push(new docx.Paragraph({
      text: orgName || (lang === "fr" ? "Organisation" : "Organization"),
      alignment: docx.AlignmentType.CENTER
    }));
    children.push(new docx.Paragraph({
      text: new Date().toLocaleDateString(),
      alignment: docx.AlignmentType.CENTER
    }));
    children.push(new docx.Paragraph({
      text: ""
    }));

    // RÃ©sumÃ© exÃ©cutif
    children.push(new docx.Paragraph({
      text: lang === "fr" ? "Resume executif" : "Executive summary",
      heading: docx.HeadingLevel.HEADING_1
    }));
    children.push(new docx.Paragraph({
      text: resumeText
    }));
    children.push(new docx.Paragraph({
      text: ""
    }));

    // Score global
    children.push(new docx.Paragraph({
      text: (lang === "fr" ? "Score global : " : "Global score: ") + global + "% - " + maturityLabel.toUpperCase(),
      heading: docx.HeadingLevel.HEADING_2
    }));
    children.push(new docx.Paragraph({
      text: ""
    }));

    // Scores par dimension
    children.push(new docx.Paragraph({
      text: lang === "fr" ? "Scores par dimension" : "Scores by dimension",
      heading: docx.HeadingLevel.HEADING_1
    }));
    Object.keys(scores).forEach(function (cat) {
      var label = tObj(DIAGNOSTIC_QUESTIONS[cat].label, lang);
      var score = scores[cat];
      var indicator = score >= 70 ? "[+]" : score >= 50 ? "[~]" : "[-]";
      children.push(new docx.Paragraph({
        text: indicator + " " + label + " : " + score + "%"
      }));
    });
    children.push(new docx.Paragraph({
      text: ""
    }));

    // Forces
    if (strengths.length) {
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "Forces (>= 70%)" : "Strengths (>= 70%)",
        heading: docx.HeadingLevel.HEADING_1
      }));
      strengths.forEach(function (item) {
        var label = tObj(DIAGNOSTIC_QUESTIONS[item.cat].label, lang);
        var interp = interpretCat(item.cat, item.score);
        children.push(new docx.Paragraph({
          text: "* " + label + " (" + item.score + "%) - " + interp
        }));
      });
      children.push(new docx.Paragraph({
        text: ""
      }));
    }

    // Points de vigilance
    if (watchpoints.length) {
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "Points de vigilance (50-69%)" : "Watchpoints (50-69%)",
        heading: docx.HeadingLevel.HEADING_1
      }));
      watchpoints.forEach(function (item) {
        var label = tObj(DIAGNOSTIC_QUESTIONS[item.cat].label, lang);
        var interp = interpretCat(item.cat, item.score);
        children.push(new docx.Paragraph({
          text: "* " + label + " (" + item.score + "%) - " + interp
        }));
      });
      children.push(new docx.Paragraph({
        text: ""
      }));
    }

    // PrioritÃ©s d'action
    if (priorities.length) {
      children.push(new docx.Paragraph({
        text: lang === "fr" ? "Priorites d'action (< 50%)" : "Priority actions (< 50%)",
        heading: docx.HeadingLevel.HEADING_1
      }));
      priorities.forEach(function (item) {
        var label = tObj(DIAGNOSTIC_QUESTIONS[item.cat].label, lang);
        var interp = interpretCat(item.cat, item.score);
        children.push(new docx.Paragraph({
          text: "* " + label + " (" + item.score + "%) - " + interp
        }));
      });
      children.push(new docx.Paragraph({
        text: ""
      }));
    }

    // Plan d'action
    children.push(new docx.Paragraph({
      text: lang === "fr" ? "Plan d'action (a completer)" : "Action plan (to be completed)",
      heading: docx.HeadingLevel.HEADING_1
    }));
    children.push(new docx.Paragraph({
      text: lang === "fr" ? "Proposez 3 a 5 actions concretes, avec un responsable, une echeance et 1-2 indicateurs de suivi." : "Define 3-5 concrete actions, with a responsible person, deadline and 1-2 follow-up indicators."
    }));
    children.push(new docx.Paragraph({
      text: ""
    }));

    // Tableau plan d'action
    var tableRows = [new docx.TableRow({
      children: [new docx.TableCell({
        children: [new docx.Paragraph({
          text: "Action"
        })]
      }), new docx.TableCell({
        children: [new docx.Paragraph({
          text: lang === "fr" ? "Responsable" : "Owner"
        })]
      }), new docx.TableCell({
        children: [new docx.Paragraph({
          text: lang === "fr" ? "Echeance" : "Deadline"
        })]
      }), new docx.TableCell({
        children: [new docx.Paragraph({
          text: lang === "fr" ? "Indicateur" : "Indicator"
        })]
      })]
    })];
    for (var i = 0; i < 5; i++) {
      tableRows.push(new docx.TableRow({
        children: [new docx.TableCell({
          children: [new docx.Paragraph({
            text: ""
          })]
        }), new docx.TableCell({
          children: [new docx.Paragraph({
            text: ""
          })]
        }), new docx.TableCell({
          children: [new docx.Paragraph({
            text: ""
          })]
        }), new docx.TableCell({
          children: [new docx.Paragraph({
            text: ""
          })]
        })]
      }));
    }
    children.push(new docx.Table({
      rows: tableRows
    }));
    children.push(new docx.Paragraph({
      text: ""
    }));

    // MÃ©thodologie
    children.push(new docx.Paragraph({
      text: lang === "fr" ? "Methodologie" : "Methodology",
      heading: docx.HeadingLevel.HEADING_1
    }));
    children.push(new docx.Paragraph({
      text: lang === "fr" ? "Ce diagnostic a ete realise avec Moudar sur la base de 24 items repartis en 6 dimensions (leadership, culture, ressources, donnees, capacites, partenariats). Les scores refletent une auto-evaluation de l'equipe, a discuter et completer en atelier." : "This diagnostic was conducted using Moudar based on 24 items across 6 dimensions (leadership, culture, resources, data, capacity, partnerships). Scores reflect a team self-assessment to be discussed and refined in a workshop."
    }));
    children.push(new docx.Paragraph({
      text: ""
    }));

    // Footer
    children.push(new docx.Paragraph({
      text: "---"
    }));
    children.push(new docx.Paragraph({
      text: "Moudar v8.0 - Younes MOUDAR - contact@moudar.com",
      alignment: docx.AlignmentType.CENTER
    }));
    var doc = new docx.Document({
      sections: [{
        children: children
      }]
    });
    docx.Packer.toBlob(doc).then(function (blob) {
      var dateStr = new Date().toISOString().split("T")[0];
      saveAs(blob, "Diagnostic_" + (orgName || "Moudar").replace(/\s+/g, "_") + "_" + dateStr + ".docx");
    });
  }
  if (results) {
    var scoreColor = results.globalScore >= 70 ? "text-green-600" : results.globalScore >= 50 ? "text-yellow-600" : "text-red-600";
    var scoreBg = results.globalScore >= 70 ? "bg-green-50 border-green-200" : results.globalScore >= 50 ? "bg-yellow-50 border-yellow-200" : "bg-red-50 border-red-200";
    return /*#__PURE__*/React.createElement("div", {
      className: "max-w-4xl mx-auto fade-in"
    }, saved && linkedProject && /*#__PURE__*/React.createElement("div", {
      className: "bg-green-50 border border-green-200 rounded-xl p-4 mb-4 text-center"
    }, /*#__PURE__*/React.createElement("p", {
      className: "text-green-700"
    }, "\u2705 ", lang === "fr" ? "Diagnostic sauvegardÃ© dans le projet" : "Diagnostic saved to project", " ", /*#__PURE__*/React.createElement("strong", null, linkedProject.title))), /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-center mb-4"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setResults(null);
        setStarted(false);
        setAnswers({});
      },
      className: "text-blue-600 hover:text-blue-800"
    }, "\u2190 ", lang === "fr" ? "Nouveau diagnostic" : "New diagnostic"), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-2"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        html2pdf().set({
          margin: 10,
          filename: "Diagnostic_" + (orgName || "Moudar") + ".pdf"
        }).from(reportRef.current).save();
      },
      className: "px-4 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700 transition"
    }, "\uD83D\uDCC4 PDF"), /*#__PURE__*/React.createElement("button", {
      onClick: exportReportWord,
      className: "px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition"
    }, "\uD83D\uDCDD Word"))), /*#__PURE__*/React.createElement("div", {
      ref: reportRef,
      className: "bg-white rounded-xl shadow-xl p-6"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-center mb-6"
    }, /*#__PURE__*/React.createElement("h2", {
      className: "text-2xl font-bold text-gray-800 mb-1"
    }, lang === "fr" ? "RAPPORT DE DIAGNOSTIC" : "DIAGNOSTIC REPORT"), /*#__PURE__*/React.createElement("p", {
      className: "text-gray-500"
    }, orgName), linkedProject && /*#__PURE__*/React.createElement("p", {
      className: "text-purple-600 text-sm mt-1"
    }, "\uD83D\uDCC2 ", linkedProject.title)), /*#__PURE__*/React.createElement("div", {
      className: "text-center p-6 rounded-xl border mb-6 " + scoreBg
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-5xl font-bold " + scoreColor
    }, results.globalScore, "%"), /*#__PURE__*/React.createElement("p", {
      className: "text-lg font-medium mt-2"
    }, lang === "fr" ? "MaturitÃ©" : "Maturity", ": ", results.maturityLevel), /*#__PURE__*/React.createElement("p", {
      className: "text-gray-600 text-sm mt-3 max-w-xl mx-auto"
    }, results.interpretation)), /*#__PURE__*/React.createElement("div", {
      className: "grid md:grid-cols-2 gap-3 mb-6"
    }, Object.keys(results.scores).map(function (cat) {
      var score = results.scores[cat];
      var barColor = score >= 70 ? "bg-green-500" : score >= 50 ? "bg-yellow-500" : "bg-red-500";
      var textColor = score >= 70 ? "text-green-600" : score >= 50 ? "text-yellow-600" : "text-red-600";
      return /*#__PURE__*/React.createElement("div", {
        key: cat,
        className: "p-3 bg-gray-50 rounded-lg"
      }, /*#__PURE__*/React.createElement("div", {
        className: "flex justify-between mb-1"
      }, /*#__PURE__*/React.createElement("span", {
        className: "font-medium text-sm text-gray-700"
      }, tObj(DIAGNOSTIC_QUESTIONS[cat].label, lang)), /*#__PURE__*/React.createElement("span", {
        className: "font-bold " + textColor
      }, score, "%")), /*#__PURE__*/React.createElement("div", {
        className: "h-2 bg-gray-200 rounded-full"
      }, /*#__PURE__*/React.createElement("div", {
        className: "h-2 rounded-full transition-all " + barColor,
        style: {
          width: score + "%"
        }
      })), /*#__PURE__*/React.createElement("p", {
        className: "text-xs text-gray-500 mt-1"
      }, interpretCategory(cat, score)));
    })), /*#__PURE__*/React.createElement("div", {
      className: "grid md:grid-cols-3 gap-4 mb-6"
    }, results.strengths.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-green-50 rounded-xl border border-green-200"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-green-800 mb-2"
    }, "\uD83D\uDCAA ", lang === "fr" ? "Forces" : "Strengths"), /*#__PURE__*/React.createElement("ul", {
      className: "space-y-1"
    }, results.strengths.map(function (s) {
      return /*#__PURE__*/React.createElement("li", {
        key: s.cat,
        className: "text-green-700 text-sm"
      }, "\u2713 ", s.label);
    }))), results.concerns.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-yellow-50 rounded-xl border border-yellow-200"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-yellow-800 mb-2"
    }, "\u26A0\uFE0F ", lang === "fr" ? "Vigilances" : "Concerns"), /*#__PURE__*/React.createElement("ul", {
      className: "space-y-1"
    }, results.concerns.map(function (c) {
      return /*#__PURE__*/React.createElement("li", {
        key: c.cat,
        className: "text-yellow-700 text-sm"
      }, "\u2022 ", c.label);
    }))), results.priorities.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-red-50 rounded-xl border border-red-200"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-red-800 mb-2"
    }, "\u26A1 ", lang === "fr" ? "PrioritÃ©s" : "Priorities"), /*#__PURE__*/React.createElement("ul", {
      className: "space-y-1"
    }, results.priorities.map(function (p) {
      return /*#__PURE__*/React.createElement("li", {
        key: p.cat,
        className: "text-red-700 text-sm"
      }, "\u2022 ", p.label);
    }))))));
  }
  if (started) {
    var answeredCount = Object.keys(answers).length;
    var progress = answeredCount / allQuestions.length * 100;
    return /*#__PURE__*/React.createElement("div", {
      className: "max-w-2xl mx-auto fade-in"
    }, /*#__PURE__*/React.createElement("div", {
      className: "h-2 bg-gray-200 rounded-full mb-4"
    }, /*#__PURE__*/React.createElement("div", {
      className: "h-2 bg-orange-500 rounded-full transition-all",
      style: {
        width: progress + "%"
      }
    })), /*#__PURE__*/React.createElement("p", {
      className: "text-center text-sm text-gray-500 mb-4"
    }, answeredCount, "/", allQuestions.length, " questions"), Object.keys(DIAGNOSTIC_QUESTIONS).map(function (cat) {
      var data = DIAGNOSTIC_QUESTIONS[cat];
      return /*#__PURE__*/React.createElement("div", {
        key: cat,
        className: "bg-white rounded-xl shadow-md p-5 mb-4"
      }, /*#__PURE__*/React.createElement("h3", {
        className: "font-bold text-gray-800 mb-4"
      }, tObj(data.label, lang)), data.questions.map(function (q) {
        return /*#__PURE__*/React.createElement("div", {
          key: q.id,
          className: "mb-4"
        }, /*#__PURE__*/React.createElement("p", {
          className: "text-sm text-gray-700 mb-2"
        }, tObj(q.text, lang)), /*#__PURE__*/React.createElement("div", {
          className: "flex gap-1"
        }, [1, 2, 3, 4, 5].map(function (v) {
          return /*#__PURE__*/React.createElement("button", {
            key: v,
            onClick: function () {
              var newAnswers = Object.assign({}, answers);
              newAnswers[q.id] = v;
              setAnswers(newAnswers);
            },
            className: "flex-1 py-2 rounded text-sm font-medium transition " + (answers[q.id] === v ? "bg-orange-500 text-white" : "bg-gray-100 hover:bg-gray-200")
          }, v);
        })), /*#__PURE__*/React.createElement("div", {
          className: "flex justify-between text-xs text-gray-400 mt-1"
        }, /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "Pas du tout" : "Not at all"), /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "Tout Ã  fait" : "Completely")));
      }));
    }), /*#__PURE__*/React.createElement("button", {
      onClick: calculateResults,
      disabled: answeredCount < allQuestions.length,
      className: "w-full py-3 bg-orange-600 text-white rounded-xl disabled:opacity-50 font-medium hover:bg-orange-700 transition"
    }, "\uD83D\uDCCA ", lang === "fr" ? "Voir les rÃ©sultats" : "View results"));
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "max-w-md mx-auto fade-in text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-6xl mb-4"
  }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "Diagnostic de maturitÃ©" : "Maturity Diagnostic"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500 mb-2"
  }, "24 questions \u2022 6 dimensions \u2022 30 min"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 mb-6 text-sm"
  }, lang === "fr" ? "En 30 minutes, obtenez un rapport structurÃ© avec forces, vigilances et plan d'action" : "In 30 minutes, get a structured report with strengths, concerns and action plan"), linkedProject && /*#__PURE__*/React.createElement("div", {
    className: "bg-purple-50 border border-purple-200 rounded-xl p-4 mb-6"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-blue-700 text-sm"
  }, /*#__PURE__*/React.createElement("strong", null, "\uD83D\uDCC2 ", lang === "fr" ? "Projet liÃ©" : "Linked project", ":"), " ", linkedProject.title), /*#__PURE__*/React.createElement("p", {
    className: "text-purple-600 text-xs mt-1"
  }, lang === "fr" ? "Le diagnostic sera automatiquement attachÃ© Ã  ce projet" : "Diagnostic will be automatically attached to this project")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-5 shadow-md mb-6"
  }, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm font-medium text-gray-700 mb-2"
  }, lang === "fr" ? "Nom de l'organisation" : "Organization name"), /*#__PURE__*/React.createElement("input", {
    type: "text",
    value: orgName,
    onChange: function (e) {
      setOrgName(e.target.value);
    },
    placeholder: lang === "fr" ? "Ex: CHU Mohammed VI" : "Ex: Regional Hospital",
    className: "w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-orange-500 focus:outline-none transition"
  })), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setStarted(true);
    },
    className: "px-8 py-3 bg-orange-600 text-white rounded-xl font-medium hover:bg-orange-700 transition"
  }, lang === "fr" ? "Commencer le diagnostic" : "Start diagnostic"));
}

// ============================================
// USE CASES VIEW
// ============================================
function UseCasesView(props) {
  var lang = props.lang;
  var selectedState = useState(null);
  var selected = selectedState[0];
  var setSelected = selectedState[1];
  if (selected) {
    return /*#__PURE__*/React.createElement("div", {
      className: "max-w-3xl mx-auto fade-in"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setSelected(null);
      },
      className: "text-blue-600 hover:text-blue-800 mb-4"
    }, "\u2190 ", lang === "fr" ? "Retour aux cas" : "Back to cases"), /*#__PURE__*/React.createElement("div", {
      className: "bg-white rounded-2xl shadow-xl overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "gradient-hero p-6 text-white"
    }, /*#__PURE__*/React.createElement("h2", {
      className: "text-2xl font-bold mb-1"
    }, tObj(selected.title, lang)), /*#__PURE__*/React.createElement("p", {
      className: "text-white/80"
    }, selected.country, " \u2022 ", selected.duration, " \u2022 ", selected.budget)), /*#__PURE__*/React.createElement("div", {
      className: "p-6 space-y-4"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-gray-800 mb-2"
    }, "\uD83D\uDCCD ", lang === "fr" ? "Contexte" : "Context"), /*#__PURE__*/React.createElement("p", {
      className: "text-gray-600"
    }, tObj(selected.context, lang))), /*#__PURE__*/React.createElement("div", {
      className: "grid md:grid-cols-2 gap-4"
    }, /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-green-50 rounded-xl border border-green-200"
    }, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-green-800 mb-2"
    }, "\uD83D\uDCCA ", lang === "fr" ? "RÃ©sultats" : "Outcomes"), /*#__PURE__*/React.createElement("p", {
      className: "text-green-700"
    }, tObj(selected.outcomes, lang))), /*#__PURE__*/React.createElement("div", {
      className: "p-4 bg-orange-50 rounded-xl border border-orange-200"
    }, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold text-orange-800 mb-2"
    }, "\uD83D\uDCB0 ROI"), /*#__PURE__*/React.createElement("p", {
      className: "text-orange-700"
    }, tObj(selected.roi, lang)))))));
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-6"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800"
  }, "\uD83D\uDCC1 ", lang === "fr" ? "Cas d'usage documentÃ©s" : "Documented use cases"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-400 text-sm italic mt-2"
  }, "\u2139\uFE0F ", lang === "fr" ? "Cas inspirÃ©s de situations rÃ©elles, recomposÃ©s Ã  des fins pÃ©dagogiques" : "Cases inspired by real situations, recomposed for educational purposes")), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 lg:grid-cols-3 gap-4"
  }, USE_CASES.map(function (c) {
    var domainInfo = DOMAINS[c.domain] || {};
    return /*#__PURE__*/React.createElement("div", {
      key: c.id,
      onClick: function () {
        setSelected(c);
      },
      className: "bg-white rounded-xl shadow-md overflow-hidden card-hover cursor-pointer"
    }, /*#__PURE__*/React.createElement("div", {
      className: "p-4 gradient-hero text-white"
    }, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold"
    }, tObj(c.title, lang)), /*#__PURE__*/React.createElement("p", {
      className: "text-white/80 text-sm"
    }, c.country)), /*#__PURE__*/React.createElement("div", {
      className: "p-4"
    }, /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mb-2"
    }, domainInfo.icon, " ", tObj(domainInfo, lang), " \u2022 ", c.duration), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-gray-600"
    }, tObj(c.context, lang))));
  })));
}

// ============================================
// PRICING VIEW
// ============================================
function PricingView(props) {
  var lang = props.lang;
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in max-w-6xl mx-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-8"
  }, /*#__PURE__*/React.createElement("h1", {
    className: "text-3xl font-bold text-gray-800 mb-2"
  }, "\uD83D\uDCB0 ", lang === "fr" ? "Nos offres" : "Our plans"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500 text-sm italic"
  }, lang === "fr" ? "Prix indicatifs pour l'Europe â€” Tarification diffÃ©renciÃ©e PRFI sur demande" : "Indicative prices for Europe â€” LMIC differentiated pricing on request")), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-6 mb-8"
  }, PRICING.plans.map(function (plan) {
    return /*#__PURE__*/React.createElement("div", {
      key: plan.id,
      className: "bg-white rounded-2xl p-6 price-card " + (plan.popular ? "price-popular" : "shadow-lg")
    }, plan.popular && /*#__PURE__*/React.createElement("div", {
      className: "text-center mb-3"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-3 py-1 bg-blue-600 text-white text-xs rounded-full font-medium"
    }, "\u2B50 POPULAIRE")), /*#__PURE__*/React.createElement("h3", {
      className: "text-xl font-bold text-center mb-1 text-gray-800"
    }, tObj(plan.name, lang)), /*#__PURE__*/React.createElement("p", {
      className: "text-gray-500 text-center text-sm mb-4"
    }, tObj(plan.description, lang)), /*#__PURE__*/React.createElement("div", {
      className: "text-center mb-6"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-3xl font-bold text-gray-800"
    }, tObj(plan.price, lang)), /*#__PURE__*/React.createElement("span", {
      className: "text-gray-500"
    }, tObj(plan.period, lang))), /*#__PURE__*/React.createElement("ul", {
      className: "space-y-3 mb-6"
    }, plan.features.map(function (f, i) {
      return /*#__PURE__*/React.createElement("li", {
        key: i,
        className: "flex items-start gap-2 text-sm"
      }, /*#__PURE__*/React.createElement("span", {
        className: "text-green-500 mt-0.5"
      }, "\u2713"), /*#__PURE__*/React.createElement("span", {
        className: "text-gray-600"
      }, tObj(f, lang)));
    })), /*#__PURE__*/React.createElement("button", {
      className: "w-full py-3 rounded-xl font-medium transition " + (plan.popular ? "bg-blue-600 text-white hover:bg-blue-700" : "bg-gray-100 text-gray-700 hover:bg-gray-200")
    }, tObj(plan.cta, lang)));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mb-10"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-6"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block px-4 py-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-sm font-medium rounded-full mb-3"
  }, "\uD83D\uDE80 ", lang === "fr" ? "OFFRES PILOTES 2025" : "2025 PILOT OFFERS"), /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800"
  }, lang === "fr" ? "Programmes clÃ© en main" : "Turnkey Programs"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500 text-sm mt-1"
  }, lang === "fr" ? "Accompagnement complet pour dÃ©marrer avec Moudar" : "Complete support to get started with Moudar")), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-white to-blue-50 rounded-2xl p-6 shadow-lg border border-blue-100 hover:shadow-xl transition"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center text-2xl"
  }, "\uD83C\uDFE5"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-lg text-gray-800"
  }, lang === "fr" ? "Pack HÃ´pital Pilote" : "Pilot Hospital Pack"), /*#__PURE__*/React.createElement("span", {
    className: "text-blue-600 font-semibold"
  }, lang === "fr" ? "Ã€ partir de $2,700" : "From $2,700"))), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-2 mb-5"
  }, /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2 text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-blue-500 mt-0.5"
  }, "\u2713"), " ", lang === "fr" ? "5 projets d'implÃ©mentation inclus" : "5 implementation projects included"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2 text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-blue-500 mt-0.5"
  }, "\u2713"), " ", lang === "fr" ? "1 atelier de 3h en prÃ©sentiel/distanciel" : "1 workshop (3h) onsite or remote"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2 text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-blue-500 mt-0.5"
  }, "\u2713"), " ", lang === "fr" ? "Formation CFIR/ERIC pour l'Ã©quipe" : "CFIR/ERIC training for your team"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2 text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-blue-500 mt-0.5"
  }, "\u2713"), " ", lang === "fr" ? "Support email pendant 3 mois" : "Email support for 3 months"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2 text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-blue-500 mt-0.5"
  }, "\u2713"), " ", lang === "fr" ? "Export des rapports Word personnalisÃ©s" : "Custom Word report exports")), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 text-xs text-gray-400 mb-4"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-gray-100 rounded"
  }, lang === "fr" ? "DurÃ©e: 3 mois" : "Duration: 3 months"), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-gray-100 rounded"
  }, lang === "fr" ? "1-3 utilisateurs" : "1-3 users")), /*#__PURE__*/React.createElement("a", {
    href: "mailto:contact@moudar.com?subject=Pack%20H\xF4pital%20Pilote",
    className: "block w-full text-center py-2.5 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition"
  }, "\uD83D\uDCE9 ", lang === "fr" ? "Demander un devis" : "Request a quote")), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-white to-purple-50 rounded-2xl p-6 shadow-lg border border-purple-200 hover:shadow-xl transition relative overflow-hidden"
  }, /*#__PURE__*/React.createElement("div", {
    className: "absolute top-3 right-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-1 bg-purple-600 text-white text-xs rounded-full font-medium"
  }, "PREMIUM")), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center text-2xl"
  }, "\uD83C\uDFDB\uFE0F"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-lg text-gray-800"
  }, lang === "fr" ? "Pack Programme National" : "National Program Pack"), /*#__PURE__*/React.createElement("span", {
    className: "text-purple-600 font-semibold"
  }, lang === "fr" ? "Sur devis" : "Custom quote"))), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-2 mb-5"
  }, /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2 text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-purple-500 mt-0.5"
  }, "\u2713"), " ", lang === "fr" ? "Licence annuelle illimitÃ©e" : "Unlimited annual license"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2 text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-purple-500 mt-0.5"
  }, "\u2713"), " ", lang === "fr" ? "Accompagnement mÃ©thodologique complet (CFIR/RE-AIM)" : "Full methodological support (CFIR/RE-AIM)"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2 text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-purple-500 mt-0.5"
  }, "\u2713"), " ", lang === "fr" ? "Formation certifiante pour 10 coordinateurs" : "Certified training for 10 coordinators"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2 text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-purple-500 mt-0.5"
  }, "\u2713"), " ", lang === "fr" ? "Dashboard de suivi multi-projets" : "Multi-project monitoring dashboard"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2 text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-purple-500 mt-0.5"
  }, "\u2713"), " ", lang === "fr" ? "Rapport PDF/Word pour bailleurs" : "PDF/Word report for funders"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2 text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-purple-500 mt-0.5"
  }, "\u2713"), " ", lang === "fr" ? "Support technique prioritaire" : "Priority technical support")), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 text-xs text-gray-400 mb-4"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-gray-100 rounded"
  }, lang === "fr" ? "DurÃ©e: 12 mois" : "Duration: 12 months"), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-gray-100 rounded"
  }, lang === "fr" ? "Utilisateurs illimitÃ©s" : "Unlimited users")), /*#__PURE__*/React.createElement("a", {
    href: "mailto:contact@moudar.com?subject=Pack%20Programme%20National",
    className: "block w-full text-center py-2.5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl font-medium hover:from-purple-700 hover:to-indigo-700 transition"
  }, "\uD83D\uDCE9 ", lang === "fr" ? "Contacter notre Ã©quipe" : "Contact our team")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-100 rounded-xl p-6 mb-8"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4 text-center"
  }, "\uD83D\uDC65 ", lang === "fr" ? "Pour qui ?" : "For whom?"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-lg p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-gray-100 text-gray-700 text-xs rounded-full"
  }, lang === "fr" ? "DÃ©couverte" : "Discovery")), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-gray-600 space-y-1"
  }, /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Doctorants en Science de la mise en Å“uvre" : "Implementation Science PhD students"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Post-docs & chercheurs" : "Post-docs & researchers"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Petits projets exploratoires" : "Small exploratory projects"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-lg p-4 border-2 border-purple-300"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-purple-100 text-blue-700 text-xs rounded-full"
  }, lang === "fr" ? "Professionnel" : "Professional")), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-gray-600 space-y-1"
  }, /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Consultants santÃ© publique" : "Public health consultants"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Ã‰quipes hospitaliÃ¨res" : "Hospital teams"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "ONG de taille moyenne" : "Medium-sized NGOs"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-lg p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-blue-100 text-blue-700 text-xs rounded-full"
  }, lang === "fr" ? "Organisationnel" : "Organizational")), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-gray-600 space-y-1"
  }, /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "MinistÃ¨res de la SantÃ©" : "Ministries of Health"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Bailleurs (OMS, Gavi, GF)" : "Funders (WHO, Gavi, GF)"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "CHU & grandes ONG" : "Teaching hospitals & large NGOs"))))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-sm mb-8 border-l-4 border-green-500"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDD12 ", lang === "fr" ? "DonnÃ©es & SÃ©curitÃ©" : "Data & Security"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-gray-700 mb-2"
  }, lang === "fr" ? "Version actuelle (DÃ©mo)" : "Current version (Demo)"), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-gray-600 space-y-1"
  }, /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-green-500"
  }, "\u2713"), " ", lang === "fr" ? "DonnÃ©es stockÃ©es localement (localStorage)" : "Data stored locally (localStorage)"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-green-500"
  }, "\u2713"), " ", lang === "fr" ? "Aucune donnÃ©e envoyÃ©e Ã  un serveur" : "No data sent to any server"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-amber-500"
  }, "\u26A0\uFE0F"), " ", lang === "fr" ? "Ne pas saisir de donnÃ©es patients nominatives" : "Do not enter patient-identifying data"))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-gray-700 mb-2"
  }, lang === "fr" ? "Version SaaS (2025)" : "SaaS version (2025)"), /*#__PURE__*/React.createElement("ul", {
    className: "text-sm text-gray-600 space-y-1"
  }, /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-blue-500"
  }, "\u25B8"), " ", lang === "fr" ? "HÃ©bergement UE (RGPD)" : "EU hosting (GDPR)"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-blue-500"
  }, "\u25B8"), " ", lang === "fr" ? "Chiffrement des donnÃ©es au repos et en transit" : "Data encryption at rest and in transit"), /*#__PURE__*/React.createElement("li", {
    className: "flex items-start gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-blue-500"
  }, "\u25B8"), " ", lang === "fr" ? "Authentification sÃ©curisÃ©e (SSO compatible)" : "Secure authentication (SSO compatible)"))))), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-6 bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl text-white"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold mb-2"
  }, lang === "fr" ? "PrÃªt Ã  transformer vos projets ?" : "Ready to transform your projects?"), /*#__PURE__*/React.createElement("a", {
    href: "mailto:contact@moudar.com?subject=Demande%20de%20d\xE9monstration%20Moudar",
    className: "px-6 py-3 bg-white text-blue-700 rounded-xl font-bold hover:bg-purple-50 inline-block transition mt-3"
  }, "\uD83D\uDCE7 ", lang === "fr" ? "Demander une dÃ©mo" : "Request a demo")), /*#__PURE__*/React.createElement("div", {
    className: "mt-10 bg-gradient-to-br from-slate-800 to-indigo-900 rounded-2xl p-6 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-start gap-4 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "w-14 h-14 bg-white/10 rounded-xl flex items-center justify-center text-3xl flex-shrink-0"
  }, "\uD83C\uDF93"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-xl mb-1"
  }, lang === "fr" ? "Mode Recherche / PhD" : "Research / PhD Mode"), /*#__PURE__*/React.createElement("p", {
    className: "text-indigo-200 text-sm"
  }, lang === "fr" ? "Exportez vos donnÃ©es pour analyses R, Stata, Python â€” Compatible INNOV5-MH-MAROC" : "Export your data for R, Stata, Python â€” Compatible with INNOV5-MH-MAROC"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white/5 rounded-lg p-4 mb-6 border border-white/10"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-sm mb-2 text-indigo-300"
  }, "\uD83D\uDD2C ", lang === "fr" ? "Pourquoi utiliser Moudar pour la recherche ?" : "Why use Moudar for research?"), /*#__PURE__*/React.createElement("ul", {
    className: "text-xs text-indigo-200 space-y-1"
  }, /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Versioning automatique des recommandations (traÃ§abilitÃ©)" : "Automatic versioning of recommendations (traceability)"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Algorithme transparent et explainable (pas de boÃ®te noire)" : "Transparent and explainable algorithm (no black box)"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Export des poids du graphe aprÃ¨s calibration" : "Export of graph weights after calibration"), /*#__PURE__*/React.createElement("li", null, "\u2022 ", lang === "fr" ? "Compatible avec les designs multi-sites / stepped-wedge" : "Compatible with multi-site / stepped-wedge designs"))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-4 gap-4 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white/10 rounded-lg p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-lg mb-2"
  }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-sm mb-1"
  }, lang === "fr" ? "ParamÃ¨tres projet" : "Project parameters"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-indigo-200"
  }, lang === "fr" ? "Domaine, phase EPIS, contexte, barriÃ¨res, niveau ressources" : "Domain, EPIS phase, context, barriers, resource level")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white/10 rounded-lg p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-lg mb-2"
  }, "\uD83E\uDD16"), /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-sm mb-1"
  }, lang === "fr" ? "Recommandations IA" : "AI recommendations"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-indigo-200"
  }, lang === "fr" ? "StratÃ©gies, scores, frameworks, outcomes" : "Strategies, scores, frameworks, outcomes")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white/10 rounded-lg p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-lg mb-2"
  }, "\u2B50"), /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-sm mb-1"
  }, lang === "fr" ? "Feedbacks terrain" : "Field feedback"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-indigo-200"
  }, lang === "fr" ? "Acceptation, notes, outcomes rÃ©els" : "Acceptance, ratings, actual outcomes")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white/10 rounded-lg p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-lg mb-2"
  }, "\u2699\uFE0F"), /*#__PURE__*/React.createElement("h4", {
    className: "font-medium text-sm mb-1"
  }, lang === "fr" ? "Graphe calibrÃ©" : "Calibrated graph"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-indigo-200"
  }, lang === "fr" ? "Poids ajustÃ©s, mÃ©triques performance" : "Adjusted weights, performance metrics"))), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-3 mb-4"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var data = StorageManager.exportAllProjects('json');
      if (data) {
        var blob = new Blob([data], {
          type: 'application/json'
        });
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'moudar_research_export_' + new Date().toISOString().split('T')[0] + '.json';
        a.click();
        URL.revokeObjectURL(url);
      }
    },
    className: "px-4 py-2 bg-white text-indigo-700 rounded-lg font-medium text-sm hover:bg-indigo-50 transition flex items-center gap-2"
  }, "\uD83D\uDCE5 ", lang === "fr" ? "Export JSON (projets)" : "Export JSON (projects)"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var data = StorageManager.exportAllProjects('csv');
      if (data) {
        var blob = new Blob([data], {
          type: 'text/csv'
        });
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'moudar_research_export_' + new Date().toISOString().split('T')[0] + '.csv';
        a.click();
        URL.revokeObjectURL(url);
      }
    },
    className: "px-4 py-2 bg-white/20 text-white rounded-lg font-medium text-sm hover:bg-white/30 transition flex items-center gap-2"
  }, "\uD83D\uDCCA ", lang === "fr" ? "Export CSV (R/Stata)" : "Export CSV (R/Stata)"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var feedbackData = MoudarEngine.exportFeedbackData();
      var data = JSON.stringify(feedbackData, null, 2);
      var blob = new Blob([data], {
        type: 'application/json'
      });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'moudar_feedbacks_' + new Date().toISOString().split('T')[0] + '.json';
      a.click();
      URL.revokeObjectURL(url);
    },
    className: "px-4 py-2 bg-white/20 text-white rounded-lg font-medium text-sm hover:bg-white/30 transition flex items-center gap-2"
  }, "\u2B50 ", lang === "fr" ? "Export feedbacks" : "Export feedbacks"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var graphData = MoudarEngine.exportCalibratedGraph();
      var data = JSON.stringify(graphData, null, 2);
      var blob = new Blob([data], {
        type: 'application/json'
      });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'moudar_calibrated_graph_v' + MoudarEngine.VERSION + '_' + new Date().toISOString().split('T')[0] + '.json';
      a.click();
      URL.revokeObjectURL(url);
    },
    className: "px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-lg font-medium text-sm hover:from-purple-600 hover:to-indigo-600 transition flex items-center gap-2"
  }, "\u2699\uFE0F ", lang === "fr" ? "Export graphe calibrÃ©" : "Export calibrated graph")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white/5 rounded-lg p-3 border border-white/10"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-indigo-300"
  }, "\uD83D\uDCA1 ", /*#__PURE__*/React.createElement("strong", null, lang === "fr" ? "Pour votre publication / thÃ¨se :" : "For your publication / thesis:"), " ", lang === "fr" ? "Le graphe calibrÃ© contient les poids ajustÃ©s aprÃ¨s N feedbacks terrain, permettant de documenter l'apprentissage du moteur IA sur votre cohorte." : "The calibrated graph contains adjusted weights after N field feedbacks, allowing you to document the AI engine's learning on your cohort.")), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-indigo-400 mt-4 italic text-center"
  }, lang === "fr" ? "Moudar Engine v" + MoudarEngine.VERSION + " â€” Algorithme AdaptiveKG â€” DÃ©veloppÃ© dans le cadre de INNOV5-MH-MAROC" : "Moudar Engine v" + MoudarEngine.VERSION + " â€” AdaptiveKG Algorithm â€” Developed as part of INNOV5-MH-MAROC")));
}

// ============================================
// ROADMAP VIEW
// ============================================

// ============================================
// ROADMAP DATA â€“ Axes IA, pondÃ©ration, risques
// ============================================
var ROADMAP_IMPROVEMENT_AXES = [{
  id: "predictive-modeling",
  axis: {
    fr: "ModÃ©lisation prÃ©dictive des rÃ©sultats",
    en: "Predictive modelling of outcomes"
  },
  action: {
    fr: "EntraÃ®ner le moteur sur des jeux de donnÃ©es historiques de projets dâ€™implÃ©mentation (succÃ¨s / Ã©chec, durÃ©e, coÃ»t) pour prÃ©dire la probabilitÃ© de rÃ©ussite dâ€™une nouvelle initiative.",
    en: "Train the engine on historical implementation projects (success vs failure, duration, cost) to predict the probability of success for a new initiative."
  },
  objective: {
    fr: "Passer dâ€™une logique descriptive (Â« voici ce que vous devriez faire Â») Ã  une logique probabiliste (Â« si vous faites ceci, la probabilitÃ© de rÃ©ussite augmente de X % Â»).",
    en: "Move from a descriptive logic (â€œhere is what you should doâ€) to a probabilistic one (â€œif you do this, the probability of success increases by X%â€)."
  }
}, {
  id: "nlp-doc-analysis",
  axis: {
    fr: "NLP pour lâ€™analyse de documents",
    en: "NLP for document analysis"
  },
  action: {
    fr: "DÃ©velopper une fonctionnalitÃ© qui ingÃ¨re des documents (rapports dâ€™activitÃ©, politiques internes, guides cliniques) et utilise le graphe de connaissances pour mapper automatiquement les barriÃ¨res et stratÃ©gies aux cadres de la science de la mise en Å“uvre.",
    en: "Develop a feature that ingests documents (activity reports, internal policies, clinical guidelines) and uses the knowledge graph to automatically map barriers and strategies to implementation science frameworks."
  },
  objective: {
    fr: "Automatiser le diagnostic initial et rÃ©duire au maximum la saisie manuelle dâ€™information pour lâ€™utilisateur.",
    en: "Automate the initial diagnostic and minimise manual data entry for the user."
  }
}, {
  id: "impact-simulation",
  axis: {
    fr: "Analyse dâ€™impact par simulation",
    en: "Impact analysis via simulation"
  },
  action: {
    fr: "Permettre aux utilisateurs de crÃ©er des scÃ©narios â€œEt si ?â€ interactifs (ajout dâ€™un facilitateur, intensitÃ© de la formation, type de supervision, etc.).",
    en: "Allow users to create interactive â€œWhat if?â€ scenarios (adding a facilitator, changing training intensity, type of supervision, etc.)."
  },
  objective: {
    fr: "Aider Ã  la dÃ©cision budgÃ©taire et stratÃ©gique en simulant lâ€™impact potentiel des stratÃ©gies sur les indicateurs RE-AIM.",
    en: "Support budgetary and strategic decisions by simulating the potential impact of strategies on RE-AIM indicators."
  }
}, {
  id: "mobile-field-app",
  axis: {
    fr: "Application mobile pour le terrain",
    en: "Mobile app for field teams"
  },
  action: {
    fr: "CrÃ©er une application mobile dÃ©diÃ©e et optimisÃ©e hors ligne pour la collecte de donnÃ©es terrain : entretiens CFIR, notation de la fidÃ©litÃ©, photos, journaux de bord.",
    en: "Create a dedicated offlineâ€‘friendly mobile application for field data collection: CFIR interviews, fidelity scoring, photos, field logs."
  },
  objective: {
    fr: "Assurer la saisie en temps rÃ©el et simplifier la charge administrative des gestionnaires de projet et Ã©valuateurs.",
    en: "Ensure realâ€‘time data capture and simplify the administrative burden for project managers and evaluators."
  }
}, {
  id: "gamification-engagement",
  axis: {
    fr: "Gamification et suivi dâ€™engagement",
    en: "Gamification and engagement tracking"
  },
  action: {
    fr: "IntÃ©grer des tableaux de bord dâ€™engagement et des systÃ¨mes de rÃ©compenses ou de progression pour soutenir la motivation des Ã©quipes sur la durÃ©e.",
    en: "Integrate engagement dashboards and reward / progress systems to sustain team motivation over time."
  },
  objective: {
    fr: "RÃ©duire lâ€™abandon (churn) et maintenir un haut niveau dâ€™engagement avec la plateforme pendant des implÃ©mentations qui durent parfois plusieurs annÃ©es.",
    en: "Reduce churn and maintain a high engagement level with the platform over implementation projects that may last several years."
  }
}, {
  id: "dataviz-storytelling",
  axis: {
    fr: "Visualisation de donnÃ©es et storytelling",
    en: "Data visualisation and storytelling"
  },
  action: {
    fr: "Transformer les donnÃ©es complexes (graphe de connaissances, scores, feedbacks) en visualisations simples et puissantes (infographies, cartes de chaleur, rÃ©seaux).",
    en: "Transform complex data (knowledge graph, scores, feedbacks) into simple, powerful visualisations (infographics, heatmaps, networks)."
  },
  objective: {
    fr: "Faciliter la communication avec des parties prenantes non expertes et aider les Ã©quipes Ã  â€œvendreâ€ lâ€™approche en interne.",
    en: "Facilitate communication with nonâ€‘expert stakeholders and help teams â€œsellâ€ the approach internally."
  }
}, {
  id: "api-marketplace",
  axis: {
    fr: "Marketplace dâ€™API et dâ€™intÃ©grations",
    en: "API and integration marketplace"
  },
  action: {
    fr: "Ouvrir lâ€™API non seulement pour lâ€™intÃ©gration de donnÃ©es, mais aussi pour permettre Ã  des dÃ©veloppeurs tiers de crÃ©er des microâ€‘outils connectÃ©s Ã  Moudar.",
    en: "Open the API not only for data integration, but also to let thirdâ€‘party developers create microâ€‘tools connected to Moudar."
  },
  objective: {
    fr: "CrÃ©er un Ã©cosystÃ¨me dynamique et offrir une personnalisation avancÃ©e sans alourdir le dÃ©veloppement de lâ€™Ã©quipe centrale.",
    en: "Create a dynamic ecosystem and offer advanced customisation without overloading the core development team."
  }
}, {
  id: "community-case-library",
  axis: {
    fr: "BibliothÃ¨que communautaire dâ€™exemples",
    en: "Community case library"
  },
  action: {
    fr: "DÃ©velopper la â€œbibliothÃ¨que de cas vivantsâ€ en rÃ©seau social dâ€™apprentissage oÃ¹ les utilisateurs partagent anonymement leurs cas (scores initiaux, stratÃ©gies, rÃ©sultats).",
    en: "Develop the â€œliving case libraryâ€ into a learningâ€‘oriented social network where users anonymously share cases (initial scores, strategies, results)."
  },
  objective: {
    fr: "Renforcer la crÃ©dibilitÃ© empirique du moteur IA et crÃ©er une communautÃ© dâ€™apprentissage par les pairs.",
    en: "Reinforce the empirical credibility of the AI engine and build a peerâ€‘learning community."
  }
}, {
  id: "certification-partnerships",
  axis: {
    fr: "Partenariats de certification",
    en: "Certification partnerships"
  },
  action: {
    fr: "Collaborer avec des universitÃ©s ou instituts de recherche en science de la mise en Å“uvre pour lancer un programme de â€œProfessionnel certifiÃ© Moudarâ€.",
    en: "Collaborate with universities or implementation science institutes to launch a â€œCertified Moudar Professionalâ€ programme."
  },
  objective: {
    fr: "Ã‰tablir un standard de compÃ©tence, crÃ©er un canal de vente puissant et garantir une utilisation de qualitÃ© de lâ€™outil.",
    en: "Establish a competence standard, create a strong sales channel and ensure highâ€‘quality use of the tool."
  }
}, {
  id: "verticalisation",
  axis: {
    fr: "Verticalisation ciblÃ©e du produit",
    en: "Targeted product verticalisation"
  },
  action: {
    fr: "CrÃ©er des modÃ¨les de donnÃ©es et des packages de services spÃ©cifiques pour quelques marchÃ©s prioritaires (santÃ© mentale en soins primaires, Ã©ducation nationale, etc.).",
    en: "Create data models and service packages specific to a few priority markets (mental health in primary care, national education, etc.)."
  },
  objective: {
    fr: "Vendre des solutions sur mesure Ã  des institutions clÃ©s plutÃ´t quâ€™un outil gÃ©nÃ©rique, en augmentant la valeur perÃ§ue.",
    en: "Sell tailored solutions to key institutions instead of a generic tool, increasing perceived value."
  }
}, {
  id: "poc-roi",
  axis: {
    fr: "Preuve de concept et ROI calculÃ©",
    en: "Proof of concept and calculated ROI"
  },
  action: {
    fr: "Mettre lâ€™accent sur le calculateur de retour sur investissement (ROI) pour dÃ©montrer lâ€™impact Ã©conomique positif des bonnes stratÃ©gies dâ€™implÃ©mentation.",
    en: "Emphasise the ROI calculator to demonstrate the positive financial impact of sound implementation strategies."
  },
  objective: {
    fr: "Parler le langage des dÃ©cideurs et bailleurs de fonds, qui recherchent un impact mesurable et non uniquement acadÃ©mique.",
    en: "Speak the language of decisionâ€‘makers and funders, who seek measurable impact rather than purely academic value."
  }
}, {
  id: "internationalisation",
  axis: {
    fr: "Internationalisation (langues et cadres)",
    en: "Internationalisation (languages and frameworks)"
  },
  action: {
    fr: "Auâ€‘delÃ  du franÃ§ais et de lâ€™anglais, intÃ©grer dâ€™autres langues stratÃ©giques (espagnol, arabe, portugais, etc.) et des cadres dâ€™implÃ©mentation adaptÃ©s Ã  diffÃ©rentes rÃ©gions.",
    en: "Beyond French and English, integrate additional strategic languages (Spanish, Arabic, Portuguese, etc.) and implementation frameworks adapted to different regions."
  },
  objective: {
    fr: "Ouvrir de nouveaux marchÃ©s gÃ©ographiques et accroÃ®tre la prÃ©sence globale de Moudar.",
    en: "Open new geographical markets and strengthen Moudarâ€™s global footprint."
  }
}];
var ROADMAP_WEIGHTING_MODEL = [{
  id: "domain-inner-setting",
  label: {
    fr: "Domaine (CFIR)",
    en: "Domain (CFIR)"
  },
  description: {
    fr: "Le domaine Â« Inner Setting Â» (milieu interne : leadership, culture, climat organisationnel) est souvent plus prÃ©dictif de lâ€™Ã©chec que les caractÃ©ristiques de lâ€™intervention elleâ€‘mÃªme. Il peut reprÃ©senter jusquâ€™Ã  ~40 % du score global de risque.",
    en: "The â€œInner Settingâ€ domain (internal environment: leadership, culture, organisational climate) is often more predictive of failure than the interventionâ€™s characteristics themselves and may account for up to ~40% of the global risk score."
  }
}, {
  id: "critical-factor",
  label: {
    fr: "Facteur critique",
    en: "Critical factor"
  },
  description: {
    fr: "Au sein de lâ€™Inner Setting, des facteurs comme le leadership des agents dâ€™implantation et la compÃ©tence des Ã©quipes doivent peser davantage que, par exemple, un climat dâ€™implÃ©mentation simplement Â« favorable Â». Moudar doit reflÃ©ter ces coefficients multiplicateurs.",
    en: "Within the Inner Setting, factors such as implementation leadership and staff competence should weigh more than, for instance, a broadly â€œfavourableâ€ implementation climate. Moudar should reflect these multiplier effects."
  }
}, {
  id: "sector-context",
  label: {
    fr: "Contexte sectoriel",
    en: "Sector context"
  },
  description: {
    fr: "En santÃ© publique, le poids de la rÃ©troaction, du rÃ©seau et de lâ€™intÃ©gration des donnÃ©es est plus Ã©levÃ©. En Ã©ducation, la clartÃ© de lâ€™innovation et lâ€™accÃ¨s aux connaissances sont dÃ©terminants. Le graphe de connaissances de Moudar est conÃ§u pour porter cette diffÃ©renciation.",
    en: "In public health, feedback loops, networks and data integration tend to weigh more. In education, innovation clarity and access to knowledge are critical. Moudarâ€™s knowledge graph is designed to encode this differentiation."
  }
}];
var ROADMAP_CRITICAL_RISKS = [{
  id: "leadership-inertia",
  label: {
    fr: "Inertie du leadership",
    en: "Leadership inertia"
  },
  factors: {
    fr: "CFIR : 3.1 Climat et culture, 3.2 Structure, 4.1 Engagement des agents dâ€™implantation.",
    en: "CFIR: 3.1 Climate and culture, 3.2 Structure, 4.1 Implementation leadersâ€™ engagement."
  },
  justification: {
    fr: "Un leadership faible, instable ou changeant est lâ€™une des premiÃ¨res causes dâ€™abandon dâ€™une innovation. Moudar doit suivre la stabilitÃ© de cet engagement dans la durÃ©e.",
    en: "Weak, unstable or shifting leadership is one of the main causes of innovation abandonment. Moudar must track how stable this engagement remains over time."
  }
}, {
  id: "fidelity-gap",
  label: {
    fr: "Ã‰cart de fidÃ©litÃ© (Fidelity Gap)",
    en: "Fidelity gap"
  },
  factors: {
    fr: "RE-AIM : FidÃ©litÃ© ; Proctor : AcceptabilitÃ©, AdÃ©quation.",
    en: "RE-AIM: Fidelity; Proctor: Acceptability, Appropriateness."
  },
  justification: {
    fr: "Une innovation trop adaptÃ©e ou dÃ©formÃ©e peut perdre son efficacitÃ©. Moudar doit comparer la mise en Å“uvre rÃ©elle au protocole de base pour dÃ©tecter ces Ã©carts.",
    en: "An innovation that is overâ€‘adapted or distorted may lose effectiveness. Moudar should compare realâ€‘world implementation to the reference protocol to detect such gaps."
  }
}, {
  id: "resource-scarcity",
  label: {
    fr: "PÃ©nurie de ressources",
    en: "Resource scarcity"
  },
  factors: {
    fr: "CFIR : 3.3 Ressources disponibles (temps, personnel, budget).",
    en: "CFIR: 3.3 Available resources (time, staff, budget)."
  },
  justification: {
    fr: "Câ€™est souvent le risque de panne le plus fondamental. Les sorties de Moudar doivent Ãªtre reliÃ©es explicitement aux rÃ©sultats du BudgetEstimator et du ROICalculator.",
    en: "This is often the most fundamental failure risk. Moudarâ€™s outputs should be explicitly linked to the BudgetEstimator and ROICalculator results."
  }
}, {
  id: "team-burnout",
  label: {
    fr: "Ã‰puisement de lâ€™Ã©quipe (Burnout Potential)",
    en: "Team burnout potential"
  },
  factors: {
    fr: "CFIR : 4.2 Tensions interpersonnelles, 4.4 Niveau de stress / motivation.",
    en: "CFIR: 4.2 Interpersonal tension, 4.4 Stress / motivation level."
  },
  justification: {
    fr: "Une implÃ©mentation peut Ã©chouer si la charge de travail est intenable ou si la motivation sâ€™effondre. Ce risque est directement liÃ© Ã  la dimension Â« maintenance Â» de RE-AIM.",
    en: "Implementation may fail if workload is unsustainable or motivation collapses. This risk is directly tied to the RE-AIM â€œmaintenanceâ€ dimension."
  }
}, {
  id: "data-non-reactivity",
  label: {
    fr: "Nonâ€‘rÃ©activitÃ© aux donnÃ©es",
    en: "Nonâ€‘reactivity to data"
  },
  factors: {
    fr: "CFIR : 5.4 Mise Ã  lâ€™essai, 5.5 Ã‰valuation et rÃ©troaction.",
    en: "CFIR: 5.4 Trialability, 5.5 Evaluation and feedback."
  },
  justification: {
    fr: "Le risque de persister dans une mauvaise voie malgrÃ© des signaux prÃ©coces dâ€™Ã©chec. Moudar doit suivre la frÃ©quence et lâ€™utilisation rÃ©elle des tableaux de bord et feedbacks.",
    en: "The risk of persisting on the wrong path despite early failure signals. Moudar should track the frequency and effective use of dashboards and feedback loops."
  }
}];
function RoadmapView(props) {
  var lang = props.lang;
  var milestones = [{
    year: "2025",
    title: {
      fr: "MVP SaaS",
      en: "SaaS MVP"
    },
    items: [{
      fr: "Comptes utilisateurs et authentification",
      en: "User accounts and authentication"
    }, {
      fr: "Stockage cloud sÃ©curisÃ© (UE, RGPD)",
      en: "Secure cloud storage (EU, GDPR)"
    }, {
      fr: "Multi-projets et historique",
      en: "Multi-projects and history"
    }, {
      fr: "PremiÃ¨re cohorte clients pilotes (CHU, ONG)",
      en: "First pilot client cohort (hospitals, NGOs)"
    }],
    status: "current"
  }, {
    year: "2026",
    title: {
      fr: "Collaboration & API",
      en: "Collaboration & API"
    },
    items: [{
      fr: "Travail multi-Ã©quipes sur un projet",
      en: "Multi-team work on a project"
    }, {
      fr: "Journal de bord d'implÃ©mentation",
      en: "Implementation logbook"
    }, {
      fr: "API Moudar pour intÃ©gration santÃ© digitale",
      en: "Moudar API for digital health integration"
    }, {
      fr: "Templates bailleurs (OMS, UNICEF, Gavi)",
      en: "Funder templates (WHO, UNICEF, Gavi)"
    }],
    status: "planned"
  }, {
    year: "2027",
    title: {
      fr: "Extension globale",
      en: "Global Extension"
    },
    items: [{
      fr: "Interface multilingue (ES, AR, PT)",
      en: "Multilingual interface (ES, AR, PT)"
    }, {
      fr: "BibliothÃ¨que de cas vivants communautaire",
      en: "Community living case library"
    }, {
      fr: "IntÃ©gration IA avancÃ©e (analyse barriÃ¨res)",
      en: "Advanced AI integration (barrier analysis)"
    }, {
      fr: "Certification Science de la mise en Å“uvre",
      en: "Implementation Science certification"
    }],
    status: "future"
  }];
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in max-w-4xl mx-auto"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-8"
  }, /*#__PURE__*/React.createElement("h1", {
    className: "text-3xl font-bold text-gray-800 mb-2"
  }, "\uD83D\uDE80 Roadmap"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500"
  }, lang === "fr" ? "Notre vision pour les 3 prochaines annÃ©es" : "Our vision for the next 3 years"), /*#__PURE__*/React.createElement("div", {
    className: "mt-8 mb-10"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-900 text-slate-50 rounded-2xl p-5 shadow-lg text-left"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-lg font-semibold mb-2"
  }, lang === "fr" ? "Recommandations prioritaires (prototype actuel)" : "Priority recommendations (current prototype)"), /*#__PURE__*/React.createElement("ul", {
    className: "list-disc list-inside space-y-1 text-sm text-slate-100/90"
  }, /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Refactorer en architecture modulaire (front-end React sÃ©parÃ©, API backend, base de donnÃ©es)" : "Refactor into a modular architecture (separate React front-end, backend API, database)"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Ajouter une vraie couche IA pour le chatbot et les prÃ©dictions (copilote Implementation Science)" : "Add a real AI layer for the chatbot and predictions (Implementation Science copilot)"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "CrÃ©er un parcours guidÃ© pour les nouveaux utilisateurs (onboarding et aide contextuelle)" : "Create a guided journey for new users (onboarding and contextual help)"), /*#__PURE__*/React.createElement("li", null, lang === "fr" ? "Documenter le moteur algorithmique pour des publications scientifiques" : "Document the algorithmic engine for scientific publications")))), /*#__PURE__*/React.createElement("div", {
    className: "grid gap-6 md:grid-cols-2 mb-10"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-sm border border-slate-200 p-5 text-left"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-base font-semibold mb-2"
  }, lang === "fr" ? "Axe 1 â€“ Architecture modulaire" : "Axis 1 â€“ Modular architecture"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-slate-600 mb-3"
  }, lang === "fr" ? "Sortir du gros fichier HTML vers une vraie application (front React + API + base de donnÃ©es)." : "Move from a single HTML file to a real app (React front-end + API + database)."), lang === "fr" ? /*#__PURE__*/React.createElement("ul", {
    className: "list-disc list-inside space-y-1 text-xs text-slate-700"
  }, /*#__PURE__*/React.createElement("li", null, "Cr\xE9er deux projets : ", /*#__PURE__*/React.createElement("strong", null, "moudar-app"), " (front) et ", /*#__PURE__*/React.createElement("strong", null, "moudar-api"), " (back)."), /*#__PURE__*/React.createElement("li", null, "Extraire le moteur ", /*#__PURE__*/React.createElement("strong", null, "MoudarEngine"), " dans un module d\xE9di\xE9 (", /*#__PURE__*/React.createElement("code", null, "src/engine/"), ")."), /*#__PURE__*/React.createElement("li", null, "Recomposer l\u2019interface en composants : Wizard, Protocole, Tableau de bord, Budget, Roadmap."), /*#__PURE__*/React.createElement("li", null, "Ajouter une API minimale pour sauvegarder / recharger les projets."), /*#__PURE__*/React.createElement("li", null, "\xC9voluer ensuite vers PostgreSQL pour un stockage structur\xE9.")) : /*#__PURE__*/React.createElement("ul", {
    className: "list-disc list-inside space-y-1 text-xs text-slate-700"
  }, /*#__PURE__*/React.createElement("li", null, "Create two projects: ", /*#__PURE__*/React.createElement("strong", null, "moudar-app"), " (front) and ", /*#__PURE__*/React.createElement("strong", null, "moudar-api"), " (back)."), /*#__PURE__*/React.createElement("li", null, "Extract the ", /*#__PURE__*/React.createElement("strong", null, "MoudarEngine"), " into a dedicated module (", /*#__PURE__*/React.createElement("code", null, "src/engine/"), ")."), /*#__PURE__*/React.createElement("li", null, "Rebuild the UI into components: Wizard, Protocol, Dashboard, Budget, Roadmap."), /*#__PURE__*/React.createElement("li", null, "Add a minimal API to save / load projects."), /*#__PURE__*/React.createElement("li", null, "Later migrate to PostgreSQL for structured storage."))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-sm border border-slate-200 p-5 text-left"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-base font-semibold mb-2"
  }, lang === "fr" ? "Axe 2 â€“ Couche IA (chatbot & prÃ©dictions)" : "Axis 2 â€“ AI layer (chatbot & predictions)"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-slate-600 mb-3"
  }, lang === "fr" ? "Faire de Moudar un vÃ©ritable copilote de la science de la mise en Å“uvre." : "Turn Moudar into a true Implementation Science copilot."), lang === "fr" ? /*#__PURE__*/React.createElement("ul", {
    className: "list-disc list-inside space-y-1 text-xs text-slate-700"
  }, /*#__PURE__*/React.createElement("li", null, "D\xE9finir les cas d\u2019usage IA (explication du protocole, suggestions, pr\xE9paration dossiers bailleurs)."), /*#__PURE__*/React.createElement("li", null, "Cr\xE9er une route ", /*#__PURE__*/React.createElement("code", null, "/api/ai/chat"), " c\xF4t\xE9 backend (proxy vers le mod\xE8le IA choisi)."), /*#__PURE__*/React.createElement("li", null, "Ajouter un composant de chat contextuel dans la vue Protocole."), /*#__PURE__*/React.createElement("li", null, "Cr\xE9er des boutons type \u201CAm\xE9liorer ce protocole\u201D / \u201CAdapter pour bailleur\u201D.")) : /*#__PURE__*/React.createElement("ul", {
    className: "list-disc list-inside space-y-1 text-xs text-slate-700"
  }, /*#__PURE__*/React.createElement("li", null, "Define AI use cases (explain protocol, suggest improvements, prepare funder packages)."), /*#__PURE__*/React.createElement("li", null, "Create a backend route ", /*#__PURE__*/React.createElement("code", null, "/api/ai/chat"), " (proxy to the chosen LLM provider)."), /*#__PURE__*/React.createElement("li", null, "Add a contextual chat component in the Protocol view."), /*#__PURE__*/React.createElement("li", null, "Create buttons such as \u201CImprove this protocol\u201D / \u201CFormat for funder\u201D."))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-sm border border-slate-200 p-5 text-left"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-base font-semibold mb-2"
  }, lang === "fr" ? "Axe 3 â€“ Parcours guidÃ© utilisateurs" : "Axis 3 â€“ Guided user journey"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-slate-600 mb-3"
  }, lang === "fr" ? "Permettre Ã  un nouvel utilisateur de comprendre et utiliser Moudar en quelques minutes." : "Help new users understand and use Moudar in a few minutes."), lang === "fr" ? /*#__PURE__*/React.createElement("ul", {
    className: "list-disc list-inside space-y-1 text-xs text-slate-700"
  }, /*#__PURE__*/React.createElement("li", null, "Cr\xE9er un \xE9cran d\u2019onboarding simple (secteur, type de projet, phase de maturit\xE9)."), /*#__PURE__*/React.createElement("li", null, "Ajouter des aides contextuelles dans le Wizard (\u201CPourquoi cette question ?\u201D)."), /*#__PURE__*/React.createElement("li", null, "Proposer 2\u20133 parcours apr\xE8s g\xE9n\xE9ration : rigueur scientifique, bailleur, terrain."), /*#__PURE__*/React.createElement("li", null, "Pr\xE9voir quelques cas pr\xE9-remplis par secteur pour les d\xE9mos.")) : /*#__PURE__*/React.createElement("ul", {
    className: "list-disc list-inside space-y-1 text-xs text-slate-700"
  }, /*#__PURE__*/React.createElement("li", null, "Create a simple onboarding screen (sector, project type, maturity phase)."), /*#__PURE__*/React.createElement("li", null, "Add contextual help in the Wizard (\u201CWhy this question matters?\u201D)."), /*#__PURE__*/React.createElement("li", null, "Offer 2\u20133 post-protocol paths: scientific rigor, funder, field operations."), /*#__PURE__*/React.createElement("li", null, "Provide a few pre-filled demo cases per sector."))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-sm border border-slate-200 p-5 text-left"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-base font-semibold mb-2"
  }, lang === "fr" ? "Axe 4 â€“ Documentation & publications" : "Axis 4 â€“ Documentation & publications"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-slate-600 mb-3"
  }, lang === "fr" ? "Faire de Moudar un outil publiable dans le champ de la science de la mise en Å“uvre." : "Turn Moudar into a publishable tool in Implementation Science."), lang === "fr" ? /*#__PURE__*/React.createElement("ul", {
    className: "list-disc list-inside space-y-1 text-xs text-slate-700"
  }, /*#__PURE__*/React.createElement("li", null, "Geler une version de r\xE9f\xE9rence du moteur (", /*#__PURE__*/React.createElement("strong", null, "Moudar Engine v1.0"), ")."), /*#__PURE__*/React.createElement("li", null, "R\xE9diger une sp\xE9cification interne : entr\xE9es, transformations, sorties, hypoth\xE8ses."), /*#__PURE__*/React.createElement("li", null, "Formaliser le moteur (sch\xE9mas, pseudo-code, mapping vers les cadres CFIR/RE-AIM, etc.)."), /*#__PURE__*/React.createElement("li", null, "\xC9baucher un article de type \u201Cmethod paper\u201D pour une revue d\u2019Implementation Science.")) : /*#__PURE__*/React.createElement("ul", {
    className: "list-disc list-inside space-y-1 text-xs text-slate-700"
  }, /*#__PURE__*/React.createElement("li", null, "Freeze a reference engine version (", /*#__PURE__*/React.createElement("strong", null, "Moudar Engine v1.0"), ")."), /*#__PURE__*/React.createElement("li", null, "Write an internal specification: inputs, transformations, outputs, assumptions."), /*#__PURE__*/React.createElement("li", null, "Formalize the engine (diagrams, pseudo-code, mapping to CFIR/RE-AIM, etc.)."), /*#__PURE__*/React.createElement("li", null, "Draft a \u201Cmethod paper\u201D style article for an Implementation Science journal."))))), /*#__PURE__*/React.createElement("div", {
    className: "mb-10"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "ðŸ§  Axes IA & produit" : "ðŸ§  AI & product axes"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-4"
  }, lang === "fr" ? "SynthÃ¨se des grands axes dâ€™amÃ©lioration de Moudar (modÃ©lisation prÃ©dictive, NLP, mobile terrain, marketplace, etc.) pour devenir un copilote de rÃ©fÃ©rence mondial." : "Synthesis of the main improvement axes for Moudar (predictive modelling, NLP, field mobile app, marketplace, etc.) on the path to becoming a global reference copilot."), /*#__PURE__*/React.createElement("div", {
    className: "grid gap-4 md:grid-cols-2"
  }, ROADMAP_IMPROVEMENT_AXES.map(function (item) {
    return /*#__PURE__*/React.createElement("div", {
      key: item.id,
      className: "bg-white rounded-2xl shadow-sm border border-slate-200 p-4 text-left"
    }, /*#__PURE__*/React.createElement("h3", {
      className: "text-sm font-semibold mb-1"
    }, tObj(item.axis, lang)), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-slate-600 mb-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-semibold"
    }, lang === "fr" ? "ðŸŽ¯ Objectif : " : "ðŸŽ¯ Objective: "), tObj(item.objective, lang)), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-slate-600"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-semibold"
    }, lang === "fr" ? "âš™ï¸ Action : " : "âš™ï¸ Action: "), tObj(item.action, lang)));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mb-10"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "âš–ï¸ ModÃ¨le de pondÃ©ration" : "âš–ï¸ Weighting model"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-4"
  }, lang === "fr" ? "Comment le moteur Moudar peut pondÃ©rer diffÃ©remment les domaines CFIR et les contextes sectoriels pour reflÃ©ter le risque rÃ©el dâ€™Ã©chec." : "How Moudarâ€™s engine can weight CFIR domains and sector contexts differently to reflect real failure risk."), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4"
  }, ROADMAP_WEIGHTING_MODEL.map(function (item) {
    return /*#__PURE__*/React.createElement("div", {
      key: item.id,
      className: "bg-white rounded-2xl shadow-sm border border-slate-200 p-4 text-left"
    }, /*#__PURE__*/React.createElement("h3", {
      className: "text-sm font-semibold mb-1"
    }, tObj(item.label, lang)), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-slate-600"
    }, tObj(item.description, lang)));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mb-10"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-gray-800 mb-2"
  }, lang === "fr" ? "ðŸš¨ Variables critiques de risque" : "ðŸš¨ Critical risk variables"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-4"
  }, lang === "fr" ? "Les cinq facteurs de risque majeurs que Moudar doit suivre systÃ©matiquement dans ses analyses." : "The five major risk factors that Moudar should systematically track in its analyses."), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, ROADMAP_CRITICAL_RISKS.map(function (risk) {
    return /*#__PURE__*/React.createElement("div", {
      key: risk.id,
      className: "bg-white rounded-2xl shadow-sm border border-rose-100 p-4 text-left"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center justify-between mb-1"
    }, /*#__PURE__*/React.createElement("h3", {
      className: "text-sm font-semibold text-rose-700"
    }, tObj(risk.label, lang))), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-slate-600 mb-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-semibold"
    }, lang === "fr" ? "Facteurs impliquÃ©s : " : "Involved factors: "), tObj(risk.factors, lang)), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-slate-600"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-semibold"
    }, lang === "fr" ? "Pourquoi câ€™est critique : " : "Why it is critical: "), tObj(risk.justification, lang)));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, milestones.map(function (m, idx) {
    var statusColors = {
      current: "border-purple-500 bg-purple-50",
      planned: "border-blue-400 bg-blue-50",
      future: "border-gray-300 bg-gray-50"
    };
    var statusBadge = {
      current: {
        label: lang === "fr" ? "En cours" : "Current",
        bg: "bg-blue-600"
      },
      planned: {
        label: lang === "fr" ? "PlanifiÃ©" : "Planned",
        bg: "bg-blue-500"
      },
      future: {
        label: lang === "fr" ? "Vision" : "Vision",
        bg: "bg-gray-400"
      }
    };
    return /*#__PURE__*/React.createElement("div", {
      key: idx,
      className: "border-l-4 rounded-xl p-6 " + statusColors[m.status]
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-3 mb-4"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-2xl font-bold text-gray-800"
    }, m.year), /*#__PURE__*/React.createElement("span", {
      className: "px-3 py-1 text-white text-xs rounded-full " + statusBadge[m.status].bg
    }, statusBadge[m.status].label), /*#__PURE__*/React.createElement("span", {
      className: "font-semibold text-gray-700"
    }, tObj(m.title, lang))), /*#__PURE__*/React.createElement("ul", {
      className: "grid md:grid-cols-2 gap-2"
    }, m.items.map(function (item, i) {
      return /*#__PURE__*/React.createElement("li", {
        key: i,
        className: "flex items-start gap-2 text-sm text-gray-600"
      }, /*#__PURE__*/React.createElement("span", {
        className: "text-purple-500 mt-0.5"
      }, "\u25B8"), /*#__PURE__*/React.createElement("span", null, tObj(item, lang)));
    })));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-8 p-6 bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl text-white text-center"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold mb-2"
  }, lang === "fr" ? "Vous voulez faÃ§onner l'avenir de Moudar ?" : "Want to shape Moudar's future?"), /*#__PURE__*/React.createElement("p", {
    className: "text-white/80 mb-4"
  }, lang === "fr" ? "Rejoignez notre programme pilote et bÃ©nÃ©ficiez de tarifs prÃ©fÃ©rentiels" : "Join our pilot program and benefit from preferential rates"), /*#__PURE__*/React.createElement("a", {
    href: "mailto:contact@moudar.com?subject=Programme%20pilote%20Moudar",
    className: "px-6 py-3 bg-white text-blue-700 rounded-xl font-bold hover:bg-purple-50 inline-block transition"
  }, "\uD83D\uDCE7 ", lang === "fr" ? "Devenir pilote" : "Become a pilot")));
}

// ============================================
// AI METRICS PANEL - MÃ©triques d'apprentissage adaptatif
// ============================================
function AIMetricsPanel(props) {
  var lang = props.lang;
  var [expanded, setExpanded] = useState(false);
  var [metrics, setMetrics] = useState(null);
  var [learningState, setLearningState] = useState(null);
  var [strategyPerf, setStrategyPerf] = useState(null);
  useEffect(function () {
    // Charger les mÃ©triques au montage
    try {
      var m = MoudarEngine.getPerformanceMetrics();
      var ls = MoudarEngine.getLearningState();
      var sp = MoudarEngine.getStrategyPerformance(1); // Minimum 1 feedback
      setMetrics(m);
      setLearningState(ls);
      setStrategyPerf(sp);
    } catch (e) {
      console.warn("Could not load AI metrics:", e);
    }
  }, [expanded]);
  function handleCalibrate() {
    var result = MoudarEngine.adjustWeightsFromFeedback({
      learningRate: 0.1,
      minSamples: 3
    });
    if (result.adjusted) {
      alert(lang === "fr" ? "âœ… Moteur IA recalibrÃ©!\n" + result.strategiesUpdated + " stratÃ©gies ajustÃ©es.\n" + result.totalAdjustments + " poids modifiÃ©s." : "âœ… AI Engine recalibrated!\n" + result.strategiesUpdated + " strategies adjusted.\n" + result.totalAdjustments + " weights modified.");
      setLearningState(MoudarEngine.getLearningState());
      setMetrics(MoudarEngine.getPerformanceMetrics());
    } else {
      alert(lang === "fr" ? "âš ï¸ Pas assez de donnÃ©es.\nMinimum 3 feedbacks par stratÃ©gie requis." : "âš ï¸ Not enough data.\nMinimum 3 feedbacks per strategy required.");
    }
  }
  function handleExport() {
    var snapshot = MoudarEngine.exportCalibratedGraph();
    var dataStr = JSON.stringify(snapshot, null, 2);
    var blob = new Blob([dataStr], {
      type: "application/json"
    });
    var url = URL.createObjectURL(blob);
    var a = document.createElement("a");
    a.href = url;
    a.download = "moudar_engine_v" + MoudarEngine.VERSION + "_" + new Date().toISOString().split("T")[0] + ".json";
    a.click();
    URL.revokeObjectURL(url);
  }
  function handleReset() {
    if (confirm(lang === "fr" ? "âš ï¸ RÃ©initialiser tous les feedbacks et l'apprentissage ?" : "âš ï¸ Reset all feedbacks and learning?")) {
      MoudarEngine.resetLearning();
      setMetrics(null);
      setLearningState(null);
      setStrategyPerf(null);
      alert(lang === "fr" ? "âœ“ Apprentissage rÃ©initialisÃ©" : "âœ“ Learning reset");
    }
  }

  // Top stratÃ©gies performantes
  var topStrategies = [];
  if (strategyPerf && Object.keys(strategyPerf).length > 0) {
    topStrategies = Object.entries(strategyPerf).map(function ([id, data]) {
      return {
        id: id,
        perf: data.performance,
        uses: data.uses
      };
    }).sort(function (a, b) {
      return b.perf - a.perf;
    }).slice(0, 3);
  }
  if (!expanded) {
    return /*#__PURE__*/React.createElement("div", {
      className: "mb-4"
    }, /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        setExpanded(true);
      },
      className: "text-xs text-indigo-400 hover:text-indigo-300 transition flex items-center justify-center gap-1 mx-auto group"
    }, /*#__PURE__*/React.createElement("span", {
      className: "inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse mr-1"
    }), "\uD83E\uDD16 Moudar Engine v", MoudarEngine.VERSION, /*#__PURE__*/React.createElement("span", {
      className: "text-slate-600 group-hover:text-indigo-300"
    }, "\u25BC")));
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "mb-4 p-4 bg-gradient-to-br from-slate-800/80 to-indigo-900/30 rounded-xl border border-indigo-500/30 max-w-lg mx-auto shadow-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "inline-block w-2 h-2 bg-green-500 rounded-full animate-pulse"
  }), /*#__PURE__*/React.createElement("span", {
    className: "text-indigo-300 font-semibold text-sm"
  }, "\uD83E\uDD16 Moudar Engine v", MoudarEngine.VERSION), /*#__PURE__*/React.createElement("span", {
    className: "text-xs bg-indigo-600/50 text-indigo-200 px-2 py-0.5 rounded"
  }, "AdaptiveKG")), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setExpanded(false);
    },
    className: "text-slate-400 hover:text-white transition"
  }, "\u2715")), metrics ? /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-3 gap-3"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center p-2 bg-slate-800/50 rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-white"
  }, metrics.totalFeedbacks), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-slate-400"
  }, lang === "fr" ? "Feedbacks" : "Feedbacks")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-2 bg-slate-800/50 rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-green-400"
  }, (metrics.acceptanceRate * 100).toFixed(0), "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-slate-400"
  }, lang === "fr" ? "Acceptation" : "Acceptance")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-2 bg-slate-800/50 rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-yellow-400"
  }, metrics.averageRating.toFixed(1), /*#__PURE__*/React.createElement("span", {
    className: "text-sm"
  }, "\u2605")), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-slate-400"
  }, lang === "fr" ? "Note moy." : "Avg. rating"))), topStrategies.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "pt-3 border-t border-slate-700/50"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-indigo-300 mb-2 font-medium"
  }, "\uD83C\uDFC6 ", lang === "fr" ? "Top stratÃ©gies terrain" : "Top field strategies"), /*#__PURE__*/React.createElement("div", {
    className: "space-y-1"
  }, topStrategies.map(function (s, i) {
    var perfColor = s.perf >= 0.7 ? "text-green-400" : s.perf >= 0.5 ? "text-yellow-400" : "text-red-400";
    return /*#__PURE__*/React.createElement("div", {
      key: s.id,
      className: "flex items-center justify-between text-xs"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-slate-300"
    }, i === 0 ? "ðŸ¥‡" : i === 1 ? "ðŸ¥ˆ" : "ðŸ¥‰", " ", s.id), /*#__PURE__*/React.createElement("span", {
      className: perfColor + " font-mono"
    }, (s.perf * 100).toFixed(0), "% (", s.uses, " uses)"));
  }))), learningState && /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-slate-400 pt-2 border-t border-slate-700/50"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-indigo-400"
  }, "\u26A1"), " ", lang === "fr" ? "DerniÃ¨re calibration" : "Last calibration", ": ", new Date(learningState.lastCalibration).toLocaleDateString(), /*#__PURE__*/React.createElement("span", {
    className: "text-slate-600"
  }, " \u2022 "), learningState.strategiesUpdated, " ", lang === "fr" ? "stratÃ©gies" : "strategies", ", ", learningState.totalAdjustments, " ", lang === "fr" ? "poids" : "weights")) : /*#__PURE__*/React.createElement("div", {
    className: "text-center py-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl mb-2"
  }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-400 text-sm"
  }, lang === "fr" ? "Aucun feedback collectÃ©" : "No feedback collected"), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-600 text-xs mt-1"
  }, lang === "fr" ? "Le moteur apprendra des retours utilisateurs" : "The engine will learn from user feedback")), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 mt-4 pt-3 border-t border-slate-700/50"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: handleCalibrate,
    className: "flex-1 text-xs py-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white rounded-lg transition font-medium"
  }, "\u26A1 ", lang === "fr" ? "Recalibrer" : "Recalibrate"), /*#__PURE__*/React.createElement("button", {
    onClick: handleExport,
    "aria-label": lang === "fr" ? "Exporter le moteur Moudar en JSON" : "Export Moudar engine as JSON",
    className: "text-xs py-2 px-3 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-lg transition",
    title: lang === "fr" ? "Exporter le graphe calibrÃ©" : "Export calibrated graph"
  }, "\uD83D\uDCE5"), /*#__PURE__*/React.createElement("button", {
    onClick: handleReset,
    className: "text-xs py-2 px-3 bg-red-900/30 hover:bg-red-800/50 text-red-400 rounded-lg transition",
    title: lang === "fr" ? "RÃ©initialiser" : "Reset"
  }, "\uD83D\uDDD1\uFE0F")), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-slate-600 text-center mt-3 italic"
  }, lang === "fr" ? "Panneau admin â€” visible uniquement pour dÃ©mo" : "Admin panel â€” visible for demo only"));
}

// ============================================
// MAIN APP
// ============================================

// ============================================
// VUES SUPPLÃ‰MENTAIRES : TABLEUR & KANBAN (v7.1)
// ============================================

function exportImplementationTableCSV(rows, lang) {
  try {
    var headers = lang === "fr" ? ["Domaine", "Phase", "BarriÃ¨res", "StratÃ©gies", "Responsable", "Statut"] : ["Domain", "Phase", "Barriers", "Strategies", "Owner", "Status"];
    var csvRows = [];
    csvRows.push(headers.join(","));
    rows.forEach(function (r) {
      csvRows.push([r.domain || "", r.phase || "", (r.barriers || "").replace(/\n/g, " "), (r.strategies || "").replace(/\n/g, " "), r.responsable || r.owner || "", r.status || ""].join(","));
    });
    var blob = new Blob([csvRows.join("\n")], {
      type: "text/csv;charset=utf-8;"
    });
    if (typeof saveAs === "function") {
      saveAs(blob, "moudar_implementation_table.csv");
    }
  } catch (e) {
    console.error("CSV export failed", e);
    alert(lang === "fr" ? "Erreur lors de l'export CSV." : "Error while exporting CSV.");
  }
}
function ImplementationTableView(props) {
  var lang = props.lang;
  var rows = [{
    domain: lang === "fr" ? "SantÃ© mentale" : "Mental health",
    phase: lang === "fr" ? "PrÃ©paration" : "Preparation",
    barriers: lang === "fr" ? "Manque de formation des soignants Ã  l'usage des outils de dÃ©pistage (PHQ-9, GAD-7)." : "Lack of training of providers on screening tools (PHQ-9, GAD-7).",
    strategies: lang === "fr" ? "Formation participative, supervision clinique rÃ©guliÃ¨re, retours de performance simples." : "Participatory training, regular clinical supervision, simple performance feedback.",
    responsable: "Dr. Amine",
    status: lang === "fr" ? "En cours" : "In progress"
  }, {
    domain: lang === "fr" ? "Soins primaires" : "Primary care",
    phase: lang === "fr" ? "ImplÃ©mentation" : "Implementation",
    barriers: lang === "fr" ? "Manque de coordination entre les centres de santÃ© et les structures spÃ©cialisÃ©es." : "Poor coordination between primary care centers and specialized services.",
    strategies: lang === "fr" ? "ComitÃ© de pilotage local, protocoles de rÃ©fÃ©rence/contre-rÃ©fÃ©rence, rÃ©unions mensuelles." : "Local steering committee, referral / counter-referral protocols, monthly meetings.",
    responsable: "Mme Nadia",
    status: lang === "fr" ? "PrÃ©vu" : "Planned"
  }, {
    domain: lang === "fr" ? "Ã‰ducation" : "Education",
    phase: lang === "fr" ? "Consolidation" : "Sustainment",
    barriers: lang === "fr" ? "Turn-over Ã©levÃ© des Ã©quipes Ã©ducatives et absence de formalisation des routines." : "High staff turnover and lack of formalized routines.",
    strategies: lang === "fr" ? "Kits pÃ©dagogiques standardisÃ©s, binÃ´mes rÃ©fÃ©rents, intÃ©gration dans le rÃ¨glement interne." : "Standardized pedagogical kits, reference pairs, integration into internal regulations.",
    responsable: "Coordination de projet",
    status: lang === "fr" ? "Ã€ consolider" : "To consolidate"
  }];
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in space-y-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-2xl font-bold text-slate-800"
  }, lang === "fr" ? "Vue tableur â€“ Science de la mise en Å“uvre" : "Table view â€“ Implementation Science"), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-600 mt-2 max-w-3xl"
  }, lang === "fr" ? "Visualisez les principales barriÃ¨res et stratÃ©gies d'implÃ©mentation sous forme de tableau, pour faciliter le pilotage et le partage avec vos Ã©quipes." : "View key implementation barriers and strategies in a tabular format, to support project steering and sharing with teams.")), /*#__PURE__*/React.createElement("div", {
    className: "rounded-xl border border-blue-100 bg-blue-50 text-slate-800 px-4 py-3 text-sm"
  }, /*#__PURE__*/React.createElement("p", {
    className: "font-semibold"
  }, lang === "fr" ? "Ce que montre cette vue" : "What this view shows"), /*#__PURE__*/React.createElement("p", {
    className: "mt-1"
  }, lang === "fr" ? "Cette vue synthÃ©tise les barriÃ¨res et stratÃ©gies d'implÃ©mentation par domaine et phase. Elle joue le rÃ´le d'un Excel spÃ©cialisÃ© Implementation Science : prÃªte Ã  Ãªtre exportÃ©e, discutÃ©e en rÃ©union et jointe Ã  un protocole." : "This view summarizes implementation barriers and strategies by domain and phase. It acts as an Implementation Scienceâ€“aware spreadsheet: ready to export, discuss in meetings and attach to a protocol.")), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl shadow-sm p-4 border border-slate-200 overflow-x-auto"
  }, /*#__PURE__*/React.createElement("table", {
    className: "min-w-full text-sm"
  }, /*#__PURE__*/React.createElement("thead", null, /*#__PURE__*/React.createElement("tr", {
    className: "bg-slate-50 text-slate-700"
  }, /*#__PURE__*/React.createElement("th", {
    className: "border px-3 py-2 text-left"
  }, lang === "fr" ? "Domaine" : "Domain"), /*#__PURE__*/React.createElement("th", {
    className: "border px-3 py-2 text-left"
  }, lang === "fr" ? "Phase" : "Phase"), /*#__PURE__*/React.createElement("th", {
    className: "border px-3 py-2 text-left"
  }, lang === "fr" ? "BarriÃ¨res" : "Barriers"), /*#__PURE__*/React.createElement("th", {
    className: "border px-3 py-2 text-left"
  }, lang === "fr" ? "StratÃ©gies" : "Strategies"), /*#__PURE__*/React.createElement("th", {
    className: "border px-3 py-2 text-left"
  }, lang === "fr" ? "Responsable" : "Owner"), /*#__PURE__*/React.createElement("th", {
    className: "border px-3 py-2 text-left"
  }, lang === "fr" ? "Statut" : "Status"))), /*#__PURE__*/React.createElement("tbody", null, rows.map(function (row, idx) {
    return /*#__PURE__*/React.createElement("tr", {
      key: idx,
      className: "hover:bg-slate-50"
    }, /*#__PURE__*/React.createElement("td", {
      className: "border px-3 py-2 align-top"
    }, row.domain), /*#__PURE__*/React.createElement("td", {
      className: "border px-3 py-2 align-top"
    }, row.phase), /*#__PURE__*/React.createElement("td", {
      className: "border px-3 py-2 align-top whitespace-pre-line"
    }, row.barriers), /*#__PURE__*/React.createElement("td", {
      className: "border px-3 py-2 align-top whitespace-pre-line"
    }, row.strategies), /*#__PURE__*/React.createElement("td", {
      className: "border px-3 py-2 align-top"
    }, row.responsable), /*#__PURE__*/React.createElement("td", {
      className: "border px-3 py-2 align-top"
    }, row.status));
  })))), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      exportImplementationTableCSV(rows, lang);
    },
    className: "inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
  }, "\uD83D\uDCE5 ", lang === "fr" ? "Exporter le tableau (CSV)" : "Export table (CSV)")));
}
function ImplementationKanbanView(props) {
  var lang = props.lang;
  var phases = [{
    key: "PrÃ©paration",
    labelFr: "PrÃ©paration",
    labelEn: "Preparation",
    color: "bg-amber-50"
  }, {
    key: "Lancement",
    labelFr: "Lancement",
    labelEn: "Launch",
    color: "bg-emerald-50"
  }, {
    key: "ImplÃ©mentation",
    labelFr: "ImplÃ©mentation",
    labelEn: "Implementation",
    color: "bg-blue-50"
  }, {
    key: "Suivi & Ajustement",
    labelFr: "Suivi & ajustement",
    labelEn: "Monitoring & adjustment",
    color: "bg-purple-50"
  }, {
    key: "Consolidation",
    labelFr: "Consolidation",
    labelEn: "Sustainment",
    color: "bg-slate-50"
  }];
  var cards = [{
    phase: "PrÃ©paration",
    titleFr: "Cartographier les parties prenantes",
    titleEn: "Map key stakeholders",
    owner: "Ã‰quipe projet"
  }, {
    phase: "PrÃ©paration",
    titleFr: "Clarifier le problÃ¨me et les objectifs",
    titleEn: "Clarify problem and objectives",
    owner: "Coordination"
  }, {
    phase: "Lancement",
    titleFr: "Former les Ã©quipes locales",
    titleEn: "Train local teams",
    owner: "RÃ©fÃ©rents terrain"
  }, {
    phase: "ImplÃ©mentation",
    titleFr: "Mettre en place le protocole dans 3 sites pilotes",
    titleEn: "Implement the protocol in 3 pilot sites",
    owner: "Ã‰quipe opÃ©rationnelle"
  }, {
    phase: "Suivi & Ajustement",
    titleFr: "Analyser les premiÃ¨res donnÃ©es RE-AIM",
    titleEn: "Analyse first RE-AIM data",
    owner: "Cellule M&E"
  }, {
    phase: "Consolidation",
    titleFr: "Formaliser les routines et les intÃ©grer dans les procÃ©dures",
    titleEn: "Formalize routines and integrate into procedures",
    owner: "Direction / institution"
  }];
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in space-y-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-2xl font-bold text-slate-800"
  }, lang === "fr" ? "Vue Kanban â€“ Phases d'implÃ©mentation" : "Kanban view â€“ Implementation phases"), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-600 mt-2 max-w-3xl"
  }, lang === "fr" ? "Visualisez votre projet comme un flux d'actions, de la prÃ©paration Ã  la consolidation, en vous appuyant sur les phases classiques de la science de la mise en Å“uvre." : "See your project as a flow of actions, from preparation to sustainment, aligned with implementation science phases.")), /*#__PURE__*/React.createElement("div", {
    className: "rounded-xl border border-emerald-100 bg-emerald-50 text-slate-800 px-4 py-3 text-sm"
  }, /*#__PURE__*/React.createElement("p", {
    className: "font-semibold"
  }, lang === "fr" ? "Ce que montre cette vue" : "What this view shows"), /*#__PURE__*/React.createElement("p", {
    className: "mt-1"
  }, lang === "fr" ? "Cette vue transforme votre plan d'implÃ©mentation en colonnes (PrÃ©paration â†’ Lancement â†’ ImplÃ©mentation â†’ Suivi â†’ Consolidation), Ã  la maniÃ¨re d'un Trello spÃ©cialisÃ© Implementation Science. Chaque carte correspond Ã  une action concrÃ¨te issue du protocole." : "This view turns your implementation plan into columns (Preparation â†’ Launch â†’ Implementation â†’ Monitoring â†’ Sustainment), like a Trello board specialized for Implementation Science. Each card corresponds to a concrete action from the protocol.")), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-5 gap-4 overflow-x-auto pb-2"
  }, phases.map(function (phase) {
    return /*#__PURE__*/React.createElement("div", {
      key: phase.key,
      className: "rounded-xl border border-slate-200 shadow-sm p-3 flex flex-col " + phase.color
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center justify-between mb-2"
    }, /*#__PURE__*/React.createElement("h2", {
      className: "font-semibold text-slate-800 text-sm"
    }, lang === "fr" ? phase.labelFr : phase.labelEn)), /*#__PURE__*/React.createElement("div", {
      className: "space-y-2"
    }, cards.filter(function (c) {
      return c.phase === phase.key;
    }).map(function (card, idx) {
      return /*#__PURE__*/React.createElement("div", {
        key: idx,
        className: "bg-white border border-slate-200 rounded-lg p-2 text-xs shadow-sm dark:bg-slate-800 dark:border-slate-600"
      }, /*#__PURE__*/React.createElement("p", {
        className: "font-semibold text-slate-800 dark:text-slate-100"
      }, lang === "fr" ? card.titleFr : card.titleEn), /*#__PURE__*/React.createElement("p", {
        className: "text-slate-500 mt-1"
      }, "\uD83D\uDC64 ", card.owner));
    }), cards.filter(function (c) {
      return c.phase === phase.key;
    }).length === 0 && /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-slate-400 italic"
    }, lang === "fr" ? "Aucune action dÃ©finie pour le moment." : "No actions defined yet.")));
  })));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODÃˆLE CFIR PONDÃ‰RÃ‰, RISK ENGINE & API (CONFIGURATION CONCEPTUELLE v1)
// IntÃ©grÃ© Ã  partir des spÃ©cifications produit / IA (Y. Moudar, 2025)
// Ces objets sont exposÃ©s sur window.MOUDAR_CONFIG pour rÃ©utilisation par le moteur,
// l'API et les exports (Word/PDF).
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var MoudarCFIRDomainWeightingModel = {
  "domains": [{
    "id": "I",
    "code": "INTERVENTION",
    "label": "CaractÃ©ristiques de l'intervention",
    "factorsCount": 8,
    "keyExamples": ["Preuves", "ComplexitÃ©", "Conception"],
    "weight": 0.1,
    "weightPercent": 10,
    "justification": "L'innovation elle-mÃªme est gÃ©nÃ©ralement fixÃ©e."
  }, {
    "id": "II",
    "code": "OUTER_SETTING",
    "label": "Milieu externe",
    "factorsCount": 4,
    "keyExamples": ["Pression", "Politiques", "Liens inter-organisations"],
    "weight": 0.15,
    "weightPercent": 15,
    "justification": "Importance croissante des rÃ©seaux et du financement."
  }, {
    "id": "III",
    "code": "INNER_SETTING",
    "label": "Milieu interne",
    "factorsCount": 16,
    "keyExamples": ["Leadership", "Climat/Culture", "Ressources", "Structure"],
    "weight": 0.45,
    "weightPercent": 45,
    "justification": "C'est le domaine le plus critique. Si l'organisation n'est pas prÃªte, rien ne fonctionne."
  }, {
    "id": "IV",
    "code": "INDIVIDUAL_CHARACTERISTICS",
    "label": "CaractÃ©ristiques de l'individu",
    "factorsCount": 5,
    "keyExamples": ["Connaissances", "Auto-efficacitÃ©", "Motivation"],
    "weight": 0.15,
    "weightPercent": 15,
    "justification": "Important, mais un leadership fort peut compenser en partie."
  }, {
    "id": "V",
    "code": "PROCESS",
    "label": "Processus d'implÃ©mentation",
    "factorsCount": 6,
    "keyExamples": ["Planification", "Ã‰valuation", "RÃ©flexion"],
    "weight": 0.15,
    "weightPercent": 15,
    "justification": "ReflÃ¨te la qualitÃ© globale de la gestion de projet."
  }],
  "totalWeight": 1.0
};
var MoudarCriticalRiskRules = [{
  "id": "A",
  "name": "HostilitÃ© organisationnelle",
  "triggerCondition": "Score moyen du domaine III (Milieu interne) < 2.5/5.",
  "explanation": "Indique un leadership faible, une culture rÃ©fractaire ou un manque critique de ressources.",
  "predictiveJustification": "Le leadership et la culture sont les facteurs les plus longs et difficiles Ã  changer."
}, {
  "id": "B",
  "name": "Sous-dotation stratÃ©gique",
  "triggerCondition": "Plus de 5 barriÃ¨res CFIR jugÃ©es \"majeures\" (score < 2/5) ET moins de 3 stratÃ©gies ERIC de forte intensitÃ© planifiÃ©es.",
  "explanation": "Facilitation, remÃ©diation ou stratÃ©gies intensives insuffisantes face aux barriÃ¨res.",
  "predictiveJustification": "Le plan de mitigation est insuffisant ; le risque d'Ã©puisement de l'Ã©quipe est Ã©levÃ©."
}, {
  "id": "C",
  "name": "DÃ©viation budget/temps",
  "triggerCondition": "Le coÃ»t prÃ©vu dÃ©passe de 25 % le budget allouÃ© OU la durÃ©e prÃ©vue dÃ©passe de 50 % la durÃ©e de rÃ©fÃ©rence dans le KnowledgeGraph.",
  "explanation": "Signale un manque de rÃ©alisme ou des contraintes structurelles non adressÃ©es.",
  "predictiveJustification": "Les projets avec forte dÃ©rive initiale ont une probabilitÃ© Ã©levÃ©e d'Ã©chec ou d'abandon."
}];
var MoudarStrategicApproachForTechPartners = [{
  "id": "AXE1",
  "approach": "Prouver la prÃ©diction",
  "keyAction": "Publier un livre blanc ou une Ã©tude de cas dÃ©montrant la supÃ©rioritÃ© du module RiskAnalysis (ex. : \"MOUDAR prÃ©dit l'Ã©chec 6 mois avant l'Ã©valuation finale\").",
  "whyTechGiantsCare": "Les grands acteurs achÃ¨tent de la performance prÃ©dictive et des signaux prÃ©coces, pas seulement du code."
}, {
  "id": "AXE3",
  "approach": "Ouvrir l'architecture",
  "keyAction": "AccÃ©lÃ©rer le dÃ©veloppement de l'API MOUDAR pour intÃ©gration fluide avec leurs Ã©cosystÃ¨mes (Google Workspace, Google Forms, etc.).",
  "whyTechGiantsCare": "L'API est la porte d'entrÃ©e pour brancher leurs modÃ¨les d'IA (ex. Gemini) dans le flux de travail de MOUDAR."
}, {
  "id": "SECURE",
  "approach": "SÃ©curiser la donnÃ©e",
  "keyAction": "Mettre en avant la version v8.0.1_SECURE et l'hÃ©bergement sur des clouds conformes (ex. GCP) pour les donnÃ©es sensibles (santÃ©, Ã©ducation).",
  "whyTechGiantsCare": "La confiance dans la gouvernance des donnÃ©es est un prÃ©requis absolu pour tout partenariat structurant."
}, {
  "id": "SCALE",
  "approach": "DÃ©montrer l'Ã©chelle",
  "keyAction": "Montrer que MOUDAR fonctionne dÃ©jÃ  dans plusieurs secteurs (multi-sector v8.0) et plusieurs langues.",
  "whyTechGiantsCare": "Prouve le potentiel de marchÃ© international et la robustesse de l'architecture."
}];
var MoudarAIModelPortfolio = [{
  "id": "RF",
  "model": "Random Forest Classifier",
  "role": "PrÃ©diction du risque ROUGE.",
  "dataAnalysed": "Combinaison des scores CFIR initiaux, des stratÃ©gies ERIC planifiÃ©es et des caractÃ©ristiques contextuelles (secteur, ressources)."
}, {
  "id": "REG",
  "model": "Analyse de rÃ©gression",
  "role": "PondÃ©ration dynamique des facteurs.",
  "dataAnalysed": "Estime le poids statistique de chaque facteur CFIR (ex. leadership) sur le rÃ©sultat final (succÃ¨s/Ã©chec)."
}, {
  "id": "KMEANS",
  "model": "Clustering (K-Means)",
  "role": "Identification de modÃ¨les et de familles de projets.",
  "dataAnalysed": "Regroupe les projets similaires (secteur, taille d'Ã©quipe, profil de barriÃ¨res) pour amÃ©liorer la prÃ©cision des recommandations."
}];
var MoudarLearningSystemMeasures = [{
  "id": "PASSAGE_OBLIGATOIRE",
  "label": "Le \"Passage Obligatoire\"",
  "technicalAction": "Bloquer les fonctions de clÃ´ture (archivage, export final, facturation) tant que les 3 KPIs RE-AIM essentiels (Effectiveness, Implementation Fidelity, Maintenance) ne sont pas renseignÃ©s.",
  "rationale": "Force la collecte des donnÃ©es minimales nÃ©cessaires pour alimenter le moteur d'apprentissage."
}, {
  "id": "FORMULAIRE_MINIMAL",
  "label": "Formulaire de bilan minimal",
  "technicalAction": "DÃ©velopper une page dÃ©diÃ©e trÃ¨s simple Â« Bilan de Maintenance / LearningSystem Input Â» avec 5 questions clÃ©s structurÃ©es (Likert ou binaire).",
  "rationale": "RÃ©duit la charge de saisie en fin de projet tout en capturant l'information critique succÃ¨s/Ã©chec."
}, {
  "id": "COLLECTE_ASYNCHRONE",
  "label": "Collecte asynchrone",
  "technicalAction": "Automatiser l'envoi de liens de collecte RE-AIM/Proctor via l'API Ã  6 et 12 mois post-projet.",
  "rationale": "Capture les donnÃ©es de maintenance Ã  froid (pÃ©rennisation) sans dÃ©pendre d'une intervention manuelle."
}];
var MoudarNLPDiagnosticActions = [{
  "id": "NLP_DIAGNOSTIC_CFIR",
  "label": "NLP pour le diagnostic CFIR",
  "technicalAction": "DÃ©velopper un modÃ¨le capable d'analyser du texte libre (comptes rendus, notes de terrain, entretiens) pour dÃ©tecter les dÃ©terminants CFIR.",
  "justification": "Permet d'extraire automatiquement les barriÃ¨res/facilitateurs Ã  partir de documents existants."
}, {
  "id": "MAPPING_AUTOMATIQUE",
  "label": "Mapping automatique CFIR",
  "technicalAction": "Exemple : lorsqu'une phrase comme Â« Le directeur n'a pas pu se libÃ©rer Â» est dÃ©tectÃ©e, MOUDAR la mappe sur CFIR 4.1.1 (manque de leadership) et propose un score bas (1/5).",
  "justification": "RÃ©duit l'interprÃ©tation manuelle et standardise le diagnostic entre projets."
}, {
  "id": "SYNTHESIS_GENERATION",
  "label": "GÃ©nÃ©ration de synthÃ¨se",
  "technicalAction": "Permettre de charger de gros volumes (ex. 100 pages de rapports) et d'obtenir un diagnostic CFIR synthÃ©tique en quelques minutes.",
  "justification": "AccÃ©lÃ¨re drastiquement le temps de diagnostic initial pour les grands projets."
}];
var MoudarFollowupSchedule = [{
  "id": "T0_PLUS_6",
  "label": "T0 + 6 mois",
  "automatedAction": "Envoi automatique d'un courriel via l'API au gestionnaire de projet/leadeur avec un lien vers le formulaire de bilan simplifiÃ© (5 questions).",
  "learningObjective": "Mesurer l'adoption et la fidÃ©litÃ© d'implÃ©mentation Ã  froid, une fois la phase active terminÃ©e."
}, {
  "id": "T0_PLUS_12",
  "label": "T0 + 12 mois",
  "automatedAction": "Envoi automatique d'un rappel avec le mÃªme formulaire.",
  "learningObjective": "Mesurer la maintenance RE-AIM : l'innovation est-elle toujours utilisÃ©e et supportÃ©e ?"
}];
var MoudarMaintenanceMinimalForm = [{
  "id": 1,
  "question": "L'innovation (protocole, outil) est-elle toujours utilisÃ©e ou maintenue dans l'organisation ?",
  "framework": "RE-AIM : Maintenance",
  "scale": "binaire",
  "options": ["Oui", "Non"]
}, {
  "id": 2,
  "question": "Si non, la raison principale est-elle liÃ©e aux ressources (budget/temps) ou au personnel/culture (leadership/motivation) ?",
  "framework": "CFIR : Milieu interne",
  "scale": "choix_multiple",
  "options": ["Ressources", "Personnel/Culture", "Autre"]
}, {
  "id": 3,
  "question": "Le changement visÃ© (objectif de l'intervention) a-t-il Ã©tÃ© atteint et maintenu ?",
  "framework": "RE-AIM : Effectiveness",
  "scale": "likert_1_5"
}, {
  "id": 4,
  "question": "L'intensitÃ© des barriÃ¨res initialement identifiÃ©es vous semble-t-elle avoir Ã©tÃ© sous-estimÃ©e ?",
  "framework": "RiskAnalysis",
  "scale": "binaire",
  "options": ["Oui", "Non"]
}, {
  "id": 5,
  "question": "Recommanderiez-vous les stratÃ©gies d'implÃ©mentation utilisÃ©es pour un autre projet similaire ?",
  "framework": "ERIC / LearningSystem",
  "scale": "binaire",
  "options": ["Oui", "Non"]
}];
var MoudarAPISpecification = {
  endpoints: [{
    "path": "/v1/projects/{project_id}/diagnostic",
    "method": "GET",
    "role": "Lecture (diagnostic). Permet de rÃ©cupÃ©rer le score CFIR actuel, les barriÃ¨res identifiÃ©es et le statut de risque (ROUGE/JAUNE/VERT)."
  }, {
    "path": "/v1/projects/{project_id}/strategy_plan",
    "method": "POST",
    "role": "Ã‰criture (plan de stratÃ©gie). ReÃ§oit les stratÃ©gies ERIC sÃ©lectionnÃ©es et met Ã  jour le plan Kanban ainsi que les notifications."
  }, {
    "path": "/v1/projects/{project_id}/evaluation",
    "method": "POST",
    "role": "Ã‰criture (apprentissage/clÃ´ture). ReÃ§oit les donnÃ©es du bilan simplifiÃ© (Maintenance RE-AIM) Ã  T0+6 et T0+12."
  }],
  evaluationPayload: [{
    "field": "project_id",
    "type": "UUID",
    "source": "MOUDAR",
    "objective": "ClÃ© de liaison entre les Ã©valuations et le KnowledgeGraph."
  }, {
    "field": "evaluation_type",
    "type": "String",
    "source": "SystÃ¨me / Formulaire",
    "objective": "Indique le type de point de mesure (ex. 6_month_maintenance, final_closure)."
  }, {
    "field": "effectiveness_score",
    "type": "Integer (1 Ã  5)",
    "source": "Formulaire (Q3)",
    "objective": "Entre dans la variable cible SuccÃ¨s (1) vs Ã‰chec (0) pour l'apprentissage."
  }, {
    "field": "is_maintained",
    "type": "Boolean",
    "source": "Formulaire (Q1)",
    "objective": "Mesure de la pÃ©rennisation de l'innovation."
  }, {
    "field": "main_failure_reason",
    "type": "String",
    "source": "Formulaire (Q2)",
    "objective": "Permet d'ajuster les pondÃ©rations CFIR si les ressources sont systÃ©matiquement citÃ©es comme cause principale."
  }, {
    "field": "strategy_recommended",
    "type": "Boolean",
    "source": "Formulaire (Q5)",
    "objective": "Confirme l'efficacitÃ© perÃ§ue des stratÃ©gies ERIC dÃ©ployÃ©es."
  }],
  webhookTriggers: [{
    "id": "RISK_TO_RED",
    "event": "Passage en ROUGE",
    "condition": "Le score RiskAnalysis franchit le seuil ROUGE (hostilitÃ© interne, dÃ©rive budget/temps, etc.)."
  }, {
    "id": "RED_TO_YELLOW_OR_GREEN",
    "event": "Passage de ROUGE Ã  JAUNE/VERT",
    "condition": "Le statut de risque s'amÃ©liore aprÃ¨s mise en Å“uvre de stratÃ©gies correctrices."
  }, {
    "id": "PERSISTENT_RED",
    "event": "Stagnation en ROUGE",
    "condition": "Le statut reste ROUGE > 30 jours sans nouvelle stratÃ©gie ERIC de haute intensitÃ© planifiÃ©e ou appliquÃ©e."
  }],
  webhookPayload: [{
    "field": "event_id",
    "description": "Identifiant unique de l'Ã©vÃ©nement.",
    "example": "alert-43b567"
  }, {
    "field": "event_type",
    "description": "Type d'Ã©vÃ©nement.",
    "example": "RISK_STATUS_CHANGE"
  }, {
    "field": "timestamp",
    "description": "Date et heure de l'Ã©vÃ©nement (ISO 8601).",
    "example": "2025-12-10T16:30:00Z"
  }, {
    "field": "project_id",
    "description": "Identifiant du projet MOUDAR concernÃ©.",
    "example": "PRJ-9921-SANTE"
  }, {
    "field": "new_status",
    "description": "Nouveau statut de risque.",
    "example": "ROUGE"
  }, {
    "field": "old_status",
    "description": "Ancien statut de risque.",
    "example": "JAUNE"
  }, {
    "field": "reason_code",
    "description": "Code synthÃ©tique de la raison de l'alerte.",
    "example": "CFIR_INNER_SETTING_LOW"
  }, {
    "field": "critical_barriers",
    "description": "Top 3 barriÃ¨res CFIR les plus critiques.",
    "example": ["3.1 Culture rÃ©fractaire", "3.3 Manque de ressources", "4.1 Leader non engagÃ©"]
  }, {
    "field": "recommended_action",
    "description": "Suggestion immÃ©diate liÃ©e aux stratÃ©gies ERIC.",
    "example": "Activate_Facilitation_Team"
  }],
  webhookSecurity: [{
    "id": "SECURE_REGISTRATION",
    "measure": "Inscription sÃ©curisÃ©e",
    "technicalAction": "Interface d'inscription Ã  l'API oÃ¹ l'utilisateur fournit l'URL de son webhook et reÃ§oit une clÃ© secrÃ¨te.",
    "objective": "Limiter la diffusion d'alertes Ã  des systÃ¨mes autorisÃ©s."
  }, {
    "id": "REQUEST_SIGNATURE",
    "measure": "Signature des requÃªtes",
    "technicalAction": "Chaque requÃªte Webhook est signÃ©e (ex. SHA-256 de la charge utile + secret). Le partenaire vÃ©rifie la signature.",
    "objective": "Garantir l'intÃ©gritÃ© et l'authenticitÃ© de l'alerte."
  }, {
    "id": "RETRY_LOGIC",
    "measure": "Gestion des erreurs",
    "technicalAction": "Mise en place d'une file d'attente et d'une logique de retry (3 Ã  5 tentatives) en cas d'erreur 5xx cÃ´tÃ© partenaire.",
    "objective": "Assurer la fiabilitÃ© de la transmission des alertes critiques."
  }]
};
var MoudarNLPPipeline = {
  steps: [{
    "step": 1,
    "name": "Ingestion",
    "description": "L'utilisateur charge un fichier (PDF, DOCX, TXT) via l'interface ou envoie le texte via l'API.",
    "component": "API MOUDAR / Endpoint /v1/projects/{id}/nlp_ingest"
  }, {
    "step": 2,
    "name": "PrÃ©traitement",
    "description": "Nettoyage du texte (en-tÃªtes, pieds de page, mise en forme) et dÃ©tection de la langue.",
    "component": "Service de preprocessing (Python/NLP)"
  }, {
    "step": 3,
    "name": "Mappage sÃ©mantique",
    "description": "Le modÃ¨le IA lit le texte et identifie les phrases reliÃ©es aux 39 dÃ©terminants CFIR.",
    "component": "Moteur NLP / AdaptiveKG"
  }, {
    "step": 4,
    "name": "Notation",
    "description": "Chaque facteur CFIR reÃ§oit une note 1â€“5 en fonction de la tonalitÃ© et de l'intensitÃ© des expressions dÃ©tectÃ©es.",
    "component": "ScoringEngine"
  }, {
    "step": 5,
    "name": "RÃ©sultat",
    "description": "Le diagnostic CFIR (scores, barriÃ¨res, extraits sources) est prÃ©sentÃ© Ã  l'utilisateur pour validation, et le RiskAnalysis est mis Ã  jour.",
    "component": "Interface utilisateur MOUDAR"
  }],
  cfirExamples: [{
    "factor": "3.1 Culture et climat",
    "example": "Personne ne veut changer ici, Ã§a fait des annÃ©es qu'on travaille comme Ã§a.",
    "polarity": "nÃ©gatif",
    "suggestedScore": 1
  }, {
    "factor": "4.1.1 Engagement du leader",
    "example": "La direction n'a pas pu assister aux rÃ©unions cruciales.",
    "polarity": "nÃ©gatif",
    "suggestedScore": 2
  }, {
    "factor": "5.5 Ã‰valuation et feedback",
    "example": "On ne sait jamais si ce qu'on fait fonctionne ou non.",
    "polarity": "nÃ©gatif",
    "suggestedScore": 1
  }],
  techniques: [{
    "id": "TRANSFORMERS",
    "technique": "ModÃ¨les de transformation (BERT, RoBERTa, etc.)",
    "role": "Comprendre le contexte et les relations complexes (ex. relier Â« Ã©quipe de gestion Â» au domaine leadership)."
  }, {
    "id": "SENTIMENT",
    "technique": "Analyse de tonalitÃ©",
    "role": "Relier la valence Ã©motionnelle des phrases aux scores (1 Ã  5) des facteurs CFIR."
  }, {
    "id": "ZERO_FEWSHOT",
    "technique": "Zero-shot / Few-shot learning",
    "role": "Utiliser les descriptions textuelles officielles des 39 dÃ©terminants CFIR comme base pour classer des phrases avec peu d'exemples annotÃ©s."
  }]
};
var MoudarVerticalStrategy = {
  verticals: [{
    "id": "MFH",
    "name": "MOUDAR for Health",
    "vertical": "SantÃ© et santÃ© mentale",
    "why": "Forte pression rÃ©glementaire et des bailleurs sur les preuves et l'impact ; budgets orientÃ©s vers l'implÃ©mentation.",
    "valueProposition": "Garantir la conformitÃ© aux protocoles et maximiser le RE-AIM (portÃ©e, efficacitÃ©, maintenance) dans les systÃ¨mes de soins primaires."
  }, {
    "id": "MFP",
    "name": "MOUDAR for Policy",
    "vertical": "Administration publique / justice",
    "why": "Faible culture de l'implÃ©mentation ; de nombreuses politiques publiques Ã©chouent Ã  cause d'une mauvaise exÃ©cution.",
    "valueProposition": "Traduire les lois et dÃ©crets en stratÃ©gies ERIC concrÃ¨tes, avec un RiskAnalysis axÃ© sur la rÃ©sistance au changement (CFIR 3.1 & 3.2)."
  }],
  adaptations: [{
    "component": "KnowledgeGraph",
    "exampleFor": "SantÃ© mentale",
    "adaptation": "Augmenter le poids de CFIR 3.4 (ressources disponibles) et 4.2 (auto-efficacitÃ© du personnel) dans les scores de risque."
  }, {
    "component": "ERICStrategies",
    "exampleFor": "SantÃ© mentale",
    "adaptation": "Mettre en avant la supervision clinique et la facilitation externe pour compenser le manque de compÃ©tences spÃ©cialisÃ©es."
  }, {
    "component": "RiskModel",
    "exampleFor": "SantÃ© mentale",
    "adaptation": "Si l'acceptabilitÃ© populationnelle (Proctor) ou le RE-AIM Reach sont trop bas, forcer le statut minimum JAUNE ou ROUGE."
  }, {
    "component": "Dashboards",
    "exampleFor": "SantÃ© mentale",
    "adaptation": "Proposer des modÃ¨les de tableaux de bord prÃ©-remplis (taux de rÃ©tention, temps d'attente, adhÃ©sion au traitement, etc.)."
  }],
  commercialActions: [{
    "id": "POC_ANTIECHEC",
    "action": "POC \"Anti-Ã©chec\"",
    "objective": "Vendre un service court Â« Audit et Plan de mitigation du risque ROUGE MOUDAR Â».",
    "clientAppeal": "DÃ©montre en 48h la puissance du moteur IA sur les documents existants, sans engagement long."
  }, {
    "id": "ROI_SPECIFIQUE",
    "action": "Calculateur de ROI spÃ©cifique",
    "objective": "Adapter le ROICalculator Ã  chaque verticale (ex. jours de traitement Ã©conomisÃ©s, rÃ©duction des rÃ©hospitalisations).",
    "clientAppeal": "Parle le langage des financiers et non seulement des chercheurs."
  }, {
    "id": "PARTENARIAT_REFERENCE",
    "action": "Partenariat de rÃ©fÃ©rence",
    "objective": "Cibler un acteur leader (universitÃ©, agence gouvernementale) pour un POC gratuit contre tÃ©moignage et donnÃ©es anonymisÃ©es.",
    "clientAppeal": "CrÃ©e une preuve sociale forte et un avantage concurrentiel basÃ© sur des donnÃ©es rÃ©elles."
  }],
  bootstrappingStrategies: [{
    "id": "BOOTSTRAP_INTERNE",
    "technicalAction": "RÃ©utiliser les donnÃ©es dÃ©jÃ  saisies (commentaires qualitatifs CFIR) comme corpus de phrases labellisÃ©es.",
    "justification": "Permet de dÃ©marrer l'apprentissage sans attendre un gros volume de nouveaux projets."
  }, {
    "id": "CROWDSOURCING_UI",
    "technicalAction": "IntÃ©grer une interface oÃ¹ les experts corrigent ou valident les prÃ©dictions NLP ; chaque correction alimente l'AdaptiveKG.",
    "justification": "Permet le co-entraÃ®nement humain + machine en continu."
  }]
};
var MoudarAnnotationSystem = {
  ui: {
    "panels": [{
      "id": "LEFT",
      "name": "Panneau contexte",
      "content": "Affichage du document source complet (compte rendu, transcription).",
      "role": "Permettre Ã  l'expert de lire la phrase dans son contexte avant annotation."
    }, {
      "id": "RIGHT",
      "name": "Panneau annotation",
      "content": "Snippet de texte sÃ©lectionnÃ©, menu de choix CFIR, curseur de tonalitÃ©.",
      "role": "Zone d'action oÃ¹ l'expert attribue le label CFIR et le score."
    }]
  },
  qualityControls: [{
    "id": "IRR_WEIGHTING",
    "measure": "PondÃ©ration des experts",
    "technicalAction": "Calculer rÃ©guliÃ¨rement la fiabilitÃ© inter-juges (IRR) en envoyant 10 % des extraits Ã  plusieurs experts.",
    "objective": "Mesurer la cohÃ©rence des annotations et filtrer les experts peu alignÃ©s."
  }, {
    "id": "GOLD_SET",
    "measure": "Jeu de rÃ©fÃ©rence (Gold Set)",
    "technicalAction": "Constituer ~200 phrases annotÃ©es par consensus ; exiger un test de calibration sur ce jeu avant annotation rÃ©elle.",
    "objective": "Garantir un socle commun et certifier les annotateurs."
  }, {
    "id": "EXPERT_FEEDBACK",
    "measure": "RÃ©troaction personnalisÃ©e",
    "technicalAction": "Signaler aux experts quand leurs annotations s'Ã©cartent statistiquement de la majoritÃ©, avec lien vers la dÃ©finition CFIR officielle.",
    "objective": "Limiter la dÃ©rive d'annotation et amÃ©liorer la formation continue."
  }],
  fairnessControls: [{
    "id": "DEMOGRAPHIC_DISAGGREGATION",
    "measure": "DÃ©sagrÃ©gation par facteurs contextuels",
    "technicalAction": "Auditer les taux de succÃ¨s/Ã©chec en les ventilant par taille d'organisation, secteur, rural/urbain, etc.",
    "objective": "Identifier les biais contextuels (ex. une stratÃ©gie ne fonctionne qu'en grands Ã©tablissements trÃ¨s dotÃ©s)."
  }, {
    "id": "COUNTERFACTUAL_TEST",
    "measure": "Test contrefactuel",
    "technicalAction": "Simuler des changements de variables contextuelles (ex. petite â†’ grande organisation) et observer l'impact sur le statut de risque.",
    "objective": "DÃ©tecter les variables non dÃ©sirÃ©es qui influencent trop le modÃ¨le et ajuster les pondÃ©rations."
  }, {
    "id": "EXPLAINABLE_RECOMMENDATIONS",
    "measure": "TraÃ§abilitÃ© de la recommandation",
    "technicalAction": "Pour chaque recommandation ERIC critique, fournir une justification chiffrÃ©e (taux de succÃ¨s, nombre de cas, IRR).",
    "objective": "Renforcer la transparence, permettre le contrÃ´le humain et limiter les biais historiques."
  }]
};

// Exposition globale pour le reste de l'application (et pour l'API externe le cas Ã©chÃ©ant)
window.MOUDAR_CONFIG = window.MOUDAR_CONFIG || {};
window.MOUDAR_CONFIG.cfirDomainModel = MoudarCFIRDomainWeightingModel;
window.MOUDAR_CONFIG.criticalRiskRules = MoudarCriticalRiskRules;
window.MOUDAR_CONFIG.strategicApproach = MoudarStrategicApproachForTechPartners;
window.MOUDAR_CONFIG.aiModels = MoudarAIModelPortfolio;
window.MOUDAR_CONFIG.learningSystemMeasures = MoudarLearningSystemMeasures;
window.MOUDAR_CONFIG.nlpActions = MoudarNLPDiagnosticActions;
window.MOUDAR_CONFIG.followupSchedule = MoudarFollowupSchedule;
window.MOUDAR_CONFIG.maintenanceForm = MoudarMaintenanceMinimalForm;
window.MOUDAR_CONFIG.apiSpec = MoudarAPISpecification;
window.MOUDAR_CONFIG.nlpPipeline = MoudarNLPPipeline;
window.MOUDAR_CONFIG.verticalStrategy = MoudarVerticalStrategy;
window.MOUDAR_CONFIG.annotationSystem = MoudarAnnotationSystem;
function SpaceView(props) {
  var onNavigate = props.onNavigate;
  var onOpenProject = props.onOpenProject;
  var onStartDiagnostic = props.onStartDiagnostic;
  var lang = props.lang || "fr";
  var userState = useState(getSupabaseUser());
  var user = userState[0];
  var setUser = userState[1];
  var authModeState = useState("signin");
  var authMode = authModeState[0];
  var setAuthMode = authModeState[1];
  var emailState = useState("");
  var email = emailState[0];
  var setEmail = emailState[1];
  var passwordState = useState("");
  var password = passwordState[0];
  var setPassword = passwordState[1];
  var authErrorState = useState(null);
  var authError = authErrorState[0];
  var setAuthError = authErrorState[1];
  var projectsState = useState([]);
  var projects = projectsState[0];
  var setProjects = projectsState[1];
  var loadingState = useState(false);
  var loading = loadingState[0];
  var setLoading = loadingState[1];
  var loadErrorState = useState(null);
  var loadError = loadErrorState[0];
  var setLoadError = loadErrorState[1];
  function t(fr, en) {
    return lang === "fr" ? fr : en;
  }
  function fetchProjectsForUser(u) {
    if (!supabaseClient || !u) {
      return;
    }
    setLoading(true);
    setLoadError(null);
    supabaseClient.from("projects").select("*").eq("user_id", u.id).order("created_at", {
      ascending: false
    }).then(function (result) {
      if (result.error) {
        console.error("[MOUDAR] Supabase load projects error", result.error);
        setLoadError(result.error.message || "Error");
        setProjects([]);
      } else {
        setProjects(result.data || []);
      }
      setLoading(false);
    });
  }
  useEffect(function () {
    if (!supabaseClient) {
      return;
    }
    var u = getSupabaseUser();
    if (u) {
      setUser(u);
      fetchProjectsForUser(u);
    }
  }, []);
  function handleAuthSubmit(e) {
    e.preventDefault();
    setAuthError(null);
    if (!supabaseClient) {
      setAuthError(t("Supabase n'est pas configurÃ©. Merci de dÃ©finir MOUDAR_SUPABASE.url et anonKey.", "Supabase is not configured. Please set MOUDAR_SUPABASE.url and anonKey."));
      return;
    }
    var credentials = {
      email: email,
      password: password
    };
    var promise;
    if (authMode === "signup") {
      promise = supabaseClient.auth.signUp(credentials);
    } else {
      promise = supabaseClient.auth.signIn(credentials);
    }
    promise.then(function (result) {
      if (result.error) {
        console.error("[MOUDAR] Auth error", result.error);
        setAuthError(result.error.message || "Auth error");
        return;
      }
      var u = getSupabaseUser();
      setUser(u);
      setEmail("");
      setPassword("");
      if (u) {
        fetchProjectsForUser(u);
      }
    });
  }
  function handleSignOut() {
    if (!supabaseClient) return;
    supabaseClient.auth.signOut().then(function () {
      setUser(null);
      setProjects([]);
    });
  }
  function handleOpen(p) {
    if (!onOpenProject) return;
    var localProject = {
      id: p.id,
      title: p.title || "",
      description: p.description || "",
      domain: p.domain || "health",
      context: p.context || "",
      phase: p.phase || "preparation",
      resourceLevel: p.resource_level || "UMIC",
      barriers: p.barriers || [],
      objectives: p.objectives || []
    };
    onOpenProject(localProject);
    if (onNavigate) {
      onNavigate("wizard");
    }
  }
  function handleDelete(p) {
    if (!supabaseClient) return;
    var u = typeof user !== "undefined" && user ? user : getSupabaseUser();
    if (!u) {
      alert(t("Vous devez Ãªtre connectÃ© pour supprimer un projet.", "You must be signed in to delete a project."));
      return;
    }
    if (!window.confirm(t("Supprimer dÃ©finitivement ce projet cloud ?", "Permanently delete this cloud project?"))) {
      return;
    }
    supabaseClient.from("projects").delete().eq("id", p.id).eq("user_id", u.id).then(function (result) {
      if (result.error) {
        console.error("[MOUDAR] Delete project error", result.error);
        alert(t("Erreur lors de la suppression du projet.", "Error while deleting project."));
        return;
      }
      setProjects(projects.filter(function (pr) {
        return pr.id !== p.id;
      }));
    });
  }
  if (!supabaseClient) {
    return /*#__PURE__*/React.createElement("section", {
      className: "rounded-2xl bg-white border border-slate-200 p-6 max-w-xl mx-auto text-xs space-y-3"
    }, /*#__PURE__*/React.createElement("h1", {
      className: "text-sm font-semibold text-slate-900 mb-1"
    }, t("Mon espace MOUDAR (Cloud)", "My MOUDAR space (Cloud)")), /*#__PURE__*/React.createElement("p", {
      className: "text-[11px] text-slate-600"
    }, t("Pour activer le stockage cloud sÃ©curisÃ© des projets, configurez Supabase dans index_moudar_about.html (MOUDAR_SUPABASE.url et anonKey).", "To enable secure cloud project storage, configure Supabase in index_moudar_about.html (MOUDAR_SUPABASE.url and anonKey).")));
  }
  if (!user) {
    return /*#__PURE__*/React.createElement("section", {
      className: "rounded-2xl bg-white border border-slate-200 p-6 max-w-md mx-auto text-xs space-y-4"
    }, /*#__PURE__*/React.createElement("h1", {
      className: "text-sm font-semibold text-slate-900 mb-2"
    }, t("Mon espace MOUDAR (Cloud)", "My MOUDAR space (Cloud)")), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-2 text-[11px]"
    }, /*#__PURE__*/React.createElement("button", {
      type: "button",
      onClick: function () {
        setAuthMode("signin");
      },
      className: "px-3 py-1.5 rounded-full border " + (authMode === "signin" ? "bg-slate-900 text-white border-slate-900" : "bg-white text-slate-700 border-slate-300")
    }, t("Connexion", "Sign in")), /*#__PURE__*/React.createElement("button", {
      type: "button",
      onClick: function () {
        setAuthMode("signup");
      },
      className: "px-3 py-1.5 rounded-full border " + (authMode === "signup" ? "bg-slate-900 text-white border-slate-900" : "bg-white text-slate-700 border-slate-300")
    }, t("CrÃ©er un compte", "Sign up"))), /*#__PURE__*/React.createElement("form", {
      onSubmit: handleAuthSubmit,
      className: "space-y-3"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
      className: "block text-[11px] font-semibold text-slate-700 mb-1"
    }, "Email"), /*#__PURE__*/React.createElement("input", {
      type: "email",
      required: true,
      value: email,
      onChange: function (e) {
        setEmail(e.target.value);
      },
      className: "w-full border border-slate-300 rounded-lg px-3 py-2 text-xs",
      placeholder: "you@example.com"
    })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
      className: "block text-[11px] font-semibold text-slate-700 mb-1"
    }, t("Mot de passe", "Password")), /*#__PURE__*/React.createElement("input", {
      type: "password",
      required: true,
      value: password,
      onChange: function (e) {
        setPassword(e.target.value);
      },
      className: "w-full border border-slate-300 rounded-lg px-3 py-2 text-xs",
      placeholder: "\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"
    })), authError && /*#__PURE__*/React.createElement("p", {
      className: "text-[11px] text-red-500"
    }, authError), /*#__PURE__*/React.createElement("button", {
      type: "submit",
      className: "w-full px-4 py-2 rounded-full bg-emerald-500 text-white text-xs font-medium hover:bg-emerald-600"
    }, authMode === "signin" ? t("Se connecter", "Sign in") : t("CrÃ©er mon compte", "Create my account"))));
  }
  return /*#__PURE__*/React.createElement("section", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "rounded-2xl bg-white border border-slate-200 p-4 text-xs flex items-center justify-between"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-sm font-semibold text-slate-900"
  }, t("Mon espace MOUDAR (Cloud)", "My MOUDAR space (Cloud)")), /*#__PURE__*/React.createElement("p", {
    className: "text-[11px] text-slate-500 mt-1"
  }, t("ConnectÃ© en tant que", "Signed in as"), " ", /*#__PURE__*/React.createElement("span", {
    className: "font-medium"
  }, user.email))), /*#__PURE__*/React.createElement("button", {
    type: "button",
    onClick: handleSignOut,
    className: "px-3 py-1.5 rounded-full border border-slate-300 text-slate-600 text-[11px] hover:bg-slate-50"
  }, t("Se dÃ©connecter", "Sign out"))), /*#__PURE__*/React.createElement("div", {
    className: "rounded-2xl bg-white border border-slate-200 p-4 text-xs"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-sm font-semibold text-slate-900 mb-3"
  }, t("Mes projets en cloud", "My cloud projects")), loading && /*#__PURE__*/React.createElement("p", {
    className: "text-[11px] text-slate-500"
  }, t("Chargement des projetsâ€¦", "Loading projectsâ€¦")), loadError && !loading && /*#__PURE__*/React.createElement("p", {
    className: "text-[11px] text-red-500"
  }, t("Erreur lors du chargement des projets.", "Error while loading projects.")), !loading && !loadError && projects.length === 0 && /*#__PURE__*/React.createElement("p", {
    className: "text-[11px] text-slate-500"
  }, t("Aucun projet cloud pour lâ€™instant. Lance un diagnostic ou sauvegarde un projet pour lâ€™envoyer dans le cloud.", "No cloud project yet. Run a diagnostic or save a project to send it to the cloud.")), !loading && !loadError && projects.length > 0 && /*#__PURE__*/React.createElement("ul", {
    className: "space-y-2"
  }, projects.map(function (p) {
    return /*#__PURE__*/React.createElement("li", {
      key: p.id,
      className: "border border-slate-200 rounded-xl px-3 py-2 flex justify-between items-center"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-slate-800"
    }, p.title || t("Projet sans titre", "Untitled project")), /*#__PURE__*/React.createElement("div", {
      className: "text-[11px] text-slate-500"
    }, t("Domaine", "Domain"), ": ", p.domain || "â€”", " \xB7", " ", t("Contexte", "Setting"), ": ", p.context || "â€”")), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-2"
    }, /*#__PURE__*/React.createElement("button", {
      type: "button",
      onClick: function () {
        handleOpen(p);
      },
      className: "text-[11px] text-emerald-600 hover:underline"
    }, t("Ouvrir", "Open")), /*#__PURE__*/React.createElement("button", {
      type: "button",
      onClick: function () {
        handleDelete(p);
      },
      className: "text-[11px] text-red-500 hover:underline"
    }, t("Supprimer", "Delete"))));
  }))));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPOSANTS REACT v8.1 - Onboarding, Import/Export, Charts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function OnboardingWizardView(props) {
  var lang = props.lang || 'fr';
  var onComplete = props.onComplete;
  var onNavigate = props.onNavigate;
  var stepState = useState(0);
  var currentStep = stepState[0];
  var setCurrentStep = stepState[1];
  var preferencesState = useState({
    profile: null,
    objective: null
  });
  var preferences = preferencesState[0];
  var setPreferences = preferencesState[1];
  var steps = OnboardingWizard.getSteps(lang);
  var step = steps[currentStep];
  function handleChoice(choiceId) {
    var newPrefs = Object.assign({}, preferences);
    if (step.id === 'profile') newPrefs.profile = choiceId;else if (step.id === 'objective') newPrefs.objective = choiceId;
    setPreferences(newPrefs);
    setTimeout(function () {
      handleNext();
    }, 300);
  }
  function handleNext() {
    if (currentStep < steps.length - 1) setCurrentStep(currentStep + 1);
  }
  function handlePrev() {
    if (currentStep > 0) setCurrentStep(currentStep - 1);
  }
  function handleComplete(action) {
    OnboardingWizard.savePreferences(preferences);
    OnboardingWizard.markCompleted();
    if (onComplete) onComplete(preferences, action);
    if (onNavigate) {
      if (action === 'create') onNavigate('wizard');else if (action === 'cases') onNavigate('cases');else onNavigate('space');
    }
  }
  function handleSkip() {
    OnboardingWizard.markCompleted();
    if (onComplete) onComplete(null, 'skip');
    if (onNavigate) onNavigate('space');
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-3xl shadow-2xl max-w-2xl w-full overflow-hidden"
  }, /*#__PURE__*/React.createElement("div", {
    className: "h-1 bg-gray-100"
  }, /*#__PURE__*/React.createElement("div", {
    className: "h-full bg-gradient-to-r from-blue-500 to-indigo-500 transition-all duration-500",
    style: {
      width: (currentStep + 1) / steps.length * 100 + '%'
    }
  })), /*#__PURE__*/React.createElement("div", {
    className: "p-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-8"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-6xl mb-4"
  }, step.icon), /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800 mb-2"
  }, step.title), step.subtitle && /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500"
  }, step.subtitle)), step.content && /*#__PURE__*/React.createElement("p", {
    className: "text-center text-gray-600 mb-8 max-w-md mx-auto"
  }, step.content), step.type === 'choice' && /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 gap-4 mb-8"
  }, step.choices.map(function (choice) {
    var isSelected = step.id === 'profile' && preferences.profile === choice.id || step.id === 'objective' && preferences.objective === choice.id;
    return /*#__PURE__*/React.createElement("button", {
      key: choice.id,
      onClick: function () {
        handleChoice(choice.id);
      },
      className: "p-4 rounded-xl border-2 text-left transition-all " + (isSelected ? "border-blue-500 bg-blue-50 shadow-lg scale-105" : "border-gray-200 hover:border-gray-300 hover:shadow")
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, choice.icon), /*#__PURE__*/React.createElement("div", {
      className: "font-semibold text-gray-800"
    }, choice.label), /*#__PURE__*/React.createElement("div", {
      className: "text-sm text-gray-500"
    }, choice.description));
  })), step.type === 'tour' && /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 gap-4 mb-8"
  }, step.features.map(function (feature, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-2"
    }, feature.icon), /*#__PURE__*/React.createElement("div", {
      className: "font-semibold text-gray-800 text-sm"
    }, feature.title), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, feature.description));
  })), step.actions && /*#__PURE__*/React.createElement("div", {
    className: "flex gap-4 justify-center mb-4"
  }, step.actions.map(function (action) {
    return /*#__PURE__*/React.createElement("button", {
      key: action.id,
      onClick: function () {
        handleComplete(action.id);
      },
      className: action.primary ? "px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl font-semibold hover:from-blue-700 hover:to-indigo-700 transition shadow-lg" : "px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition"
    }, action.label);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "px-8 pb-8 flex justify-between items-center"
  }, currentStep > 0 ? /*#__PURE__*/React.createElement("button", {
    onClick: handlePrev,
    className: "px-4 py-2 text-gray-500 hover:text-gray-700"
  }, "\u2190 ", lang === 'fr' ? 'Retour' : 'Back') : /*#__PURE__*/React.createElement("div", null), /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2"
  }, steps.map(function (s, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "w-2 h-2 rounded-full transition-all " + (i === currentStep ? "bg-blue-500 w-6" : i < currentStep ? "bg-blue-300" : "bg-gray-300")
    });
  })), step.showSkip ? /*#__PURE__*/React.createElement("button", {
    onClick: handleSkip,
    className: "px-4 py-2 text-gray-400 hover:text-gray-600 text-sm"
  }, lang === 'fr' ? 'Passer' : 'Skip') : !step.actions && currentStep < steps.length - 1 ? /*#__PURE__*/React.createElement("button", {
    onClick: handleNext,
    className: "px-4 py-2 text-blue-600 hover:text-blue-700 font-medium"
  }, lang === 'fr' ? 'Suivant' : 'Next', " \u2192") : /*#__PURE__*/React.createElement("div", null))));
}
function ImportExportPanel(props) {
  var lang = props.lang || 'fr';
  var project = props.project;
  var onClose = props.onClose;
  var onImportComplete = props.onImportComplete;
  var tabState = useState('export');
  var activeTab = tabState[0];
  var setActiveTab = tabState[1];
  var importResultState = useState(null);
  var importResult = importResultState[0];
  var setImportResult = importResultState[1];
  var fileInputRef = React.useRef(null);
  function handleExportProject() {
    if (!project) return;
    var result = MoudarDataManager.exportProject(project);
    MoudarDataManager.downloadFile(result.data, result.filename);
  }
  function handleExportAll() {
    var result = MoudarDataManager.exportAllProjects();
    MoudarDataManager.downloadFile(result.data, result.filename);
  }
  function handleFileSelect(e) {
    var file = e.target.files[0];
    if (!file) return;
    MoudarDataManager.readFile(file, function (err, content) {
      if (err) {
        setImportResult({
          success: false,
          error: err.message
        });
        return;
      }
      var result = MoudarDataManager.importProject(content, {
        generateNewId: true,
        skipExisting: false
      });
      setImportResult(result);
      if (result.success && onImportComplete) setTimeout(function () {
        onImportComplete(result);
      }, 1500);
    });
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-2xl shadow-2xl max-w-lg w-full overflow-hidden"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-4 flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-lg font-bold"
  }, "\uD83D\uDCE6 ", lang === 'fr' ? 'Gestion des donnÃ©es' : 'Data Management'), /*#__PURE__*/React.createElement("button", {
    onClick: onClose,
    className: "p-2 hover:bg-white/20 rounded-lg"
  }, "\u2715")), /*#__PURE__*/React.createElement("div", {
    className: "flex border-b"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setActiveTab('export');
    },
    className: "flex-1 py-3 text-center font-medium transition " + (activeTab === 'export' ? "text-indigo-600 border-b-2 border-indigo-600" : "text-gray-500")
  }, "\uD83D\uDCE4 ", lang === 'fr' ? 'Exporter' : 'Export'), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setActiveTab('import');
    },
    className: "flex-1 py-3 text-center font-medium transition " + (activeTab === 'import' ? "text-indigo-600 border-b-2 border-indigo-600" : "text-gray-500")
  }, "\uD83D\uDCE5 ", lang === 'fr' ? 'Importer' : 'Import')), /*#__PURE__*/React.createElement("div", {
    className: "p-6"
  }, activeTab === 'export' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, project && /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-semibold text-blue-800 mb-2"
  }, lang === 'fr' ? 'Projet actuel' : 'Current project'), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-blue-600 mb-3"
  }, project.title || 'Sans titre'), /*#__PURE__*/React.createElement("button", {
    onClick: handleExportProject,
    className: "w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
  }, "\uD83D\uDCE5 ", lang === 'fr' ? 'TÃ©lÃ©charger .moudar' : 'Download .moudar')), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-purple-50 rounded-xl border border-purple-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-semibold text-purple-800 mb-2"
  }, lang === 'fr' ? 'Sauvegarde complÃ¨te' : 'Full backup'), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-purple-600 mb-3"
  }, lang === 'fr' ? 'Exporte tous vos projets + paramÃ¨tres + donnÃ©es IA' : 'Exports all projects + settings + AI data'), /*#__PURE__*/React.createElement("button", {
    onClick: handleExportAll,
    className: "w-full py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition"
  }, "\uD83D\uDCBE ", lang === 'fr' ? 'CrÃ©er une sauvegarde' : 'Create backup')), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-400 text-center"
  }, lang === 'fr' ? 'Les fichiers .moudar sont compatibles avec toutes les versions' : '.moudar files are compatible with all versions')), activeTab === 'import' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    onClick: function () {
      fileInputRef.current && fileInputRef.current.click();
    },
    className: "border-2 border-dashed border-gray-300 rounded-xl p-8 text-center cursor-pointer hover:border-indigo-400 hover:bg-indigo-50 transition"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-2"
  }, "\uD83D\uDCC1"), /*#__PURE__*/React.createElement("p", {
    className: "font-medium text-gray-700"
  }, lang === 'fr' ? 'Cliquez pour sÃ©lectionner un fichier' : 'Click to select a file'), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-400"
  }, lang === 'fr' ? 'Fichiers .moudar ou .json acceptÃ©s' : '.moudar or .json files accepted')), /*#__PURE__*/React.createElement("input", {
    ref: fileInputRef,
    type: "file",
    accept: ".moudar,.json",
    onChange: handleFileSelect,
    className: "hidden"
  }), importResult && /*#__PURE__*/React.createElement("div", {
    className: "p-4 rounded-xl " + (importResult.success ? "bg-green-50 border border-green-200" : "bg-red-50 border border-red-200")
  }, importResult.success ? /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 text-green-700 font-semibold mb-2"
  }, "\u2705 ", lang === 'fr' ? 'Import rÃ©ussi !' : 'Import successful!'), importResult.isBackup ? /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-green-600"
  }, importResult.importedCount, " ", lang === 'fr' ? 'projets importÃ©s' : 'projects imported') : /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-green-600"
  }, lang === 'fr' ? 'Projet' : 'Project', ": ", importResult.project && importResult.project.title), importResult.warnings && importResult.warnings.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "mt-2 text-xs text-amber-600"
  }, importResult.warnings.map(function (w, i) {
    return /*#__PURE__*/React.createElement("p", {
      key: i
    }, "\u26A0\uFE0F ", w);
  }))) : /*#__PURE__*/React.createElement("div", {
    className: "text-red-700"
  }, /*#__PURE__*/React.createElement("div", {
    className: "font-semibold mb-1"
  }, "\u274C ", lang === 'fr' ? 'Erreur' : 'Error'), /*#__PURE__*/React.createElement("p", {
    className: "text-sm"
  }, importResult.error)))))));
}
function BudgetChartView(props) {
  var budget = props.budget;
  var lang = props.lang || 'fr';
  if (!budget) return /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gray-50 rounded-xl text-center text-gray-500"
  }, lang === 'fr' ? 'Aucun budget disponible' : 'No budget available');
  var pieData = InteractiveCharts.generateBudgetPieData(budget, lang);
  if (!pieData || !pieData.data.length) return /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gray-50 rounded-xl text-center text-gray-500"
  }, lang === 'fr' ? 'DonnÃ©es insuffisantes' : 'Insufficient data');
  var hoveredState = useState(null);
  var hovered = hoveredState[0];
  var setHovered = hoveredState[1];
  function formatCurrency(value) {
    return new Intl.NumberFormat(lang === 'fr' ? 'fr-FR' : 'en-US', {
      style: 'currency',
      currency: pieData.currency,
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(value);
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4 flex items-center gap-2"
  }, "\uD83D\uDCB0 ", lang === 'fr' ? 'RÃ©partition du budget' : 'Budget breakdown'), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "relative"
  }, /*#__PURE__*/React.createElement("div", {
    dangerouslySetInnerHTML: {
      __html: typeof DOMPurify !== 'undefined' ? DOMPurify.sanitize(InteractiveCharts.generateDonutSVG(pieData.data, {
        size: 180,
        strokeWidth: 35
      }), { USE_PROFILES: { svg: true } }) : InteractiveCharts.generateDonutSVG(pieData.data, {
        size: 180,
        strokeWidth: 35
      })
    }
  }), /*#__PURE__*/React.createElement("div", {
    className: "absolute inset-0 flex flex-col items-center justify-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, "Total"), /*#__PURE__*/React.createElement("div", {
    className: "text-lg font-bold text-gray-800"
  }, formatCurrency(pieData.total)))), /*#__PURE__*/React.createElement("div", {
    className: "flex-1 space-y-2"
  }, pieData.data.map(function (item) {
    var isHovered = hovered === item.category;
    return /*#__PURE__*/React.createElement("div", {
      key: item.category,
      onMouseEnter: function () {
        setHovered(item.category);
      },
      onMouseLeave: function () {
        setHovered(null);
      },
      className: "flex items-center gap-3 p-2 rounded-lg transition cursor-pointer " + (isHovered ? "bg-gray-100" : "hover:bg-gray-50")
    }, /*#__PURE__*/React.createElement("div", {
      className: "w-4 h-4 rounded",
      style: {
        backgroundColor: item.color
      }
    }), /*#__PURE__*/React.createElement("div", {
      className: "flex-1"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-sm font-medium text-gray-800"
    }, item.label), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, formatCurrency(item.value))), /*#__PURE__*/React.createElement("div", {
      className: "text-sm font-semibold",
      style: {
        color: item.color
      }
    }, item.percentage, "%"));
  }))));
}
function GanttChartView(props) {
  var timeline = props.timeline;
  var lang = props.lang || 'fr';
  if (!timeline) return /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gray-50 rounded-xl text-center text-gray-500"
  }, lang === 'fr' ? 'Aucune timeline' : 'No timeline');
  var ganttData = InteractiveCharts.generateGanttData(timeline, lang);
  if (!ganttData || !ganttData.phases.length) return /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gray-50 rounded-xl text-center text-gray-500"
  }, lang === 'fr' ? 'DonnÃ©es insuffisantes' : 'Insufficient data');
  return /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-4"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDCC5 ", lang === 'fr' ? 'Timeline du projet' : 'Project timeline'), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-500"
  }, lang === 'fr' ? 'DurÃ©e totale: ' : 'Total duration: ', ganttData.totalDuration, " ", ganttData.unit)), /*#__PURE__*/React.createElement("div", {
    dangerouslySetInnerHTML: {
      __html: typeof DOMPurify !== 'undefined' ? DOMPurify.sanitize(InteractiveCharts.generateGanttHTML(ganttData, {
        barHeight: 40,
        monthWidth: 35
      })) : InteractiveCharts.generateGanttHTML(ganttData, {
        barHeight: 40,
        monthWidth: 35
      })
    }
  }), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-4 mt-4 pt-4 border-t flex-wrap"
  }, ganttData.phases.map(function (phase) {
    return /*#__PURE__*/React.createElement("div", {
      key: phase.id,
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("div", {
      className: "w-3 h-3 rounded",
      style: {
        backgroundColor: phase.color
      }
    }), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-600"
    }, phase.label));
  })));
}
function ProjectProgressView(props) {
  var project = props.project;
  var lang = props.lang || 'fr';
  if (!project) return null;
  var progressData = InteractiveCharts.generateProgressData(project, lang);
  var progressColor = progressData.overall >= 80 ? '#10b981' : progressData.overall >= 50 ? '#f59e0b' : '#ef4444';
  return /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4 flex items-center gap-2"
  }, "\uD83D\uDCCA ", lang === 'fr' ? 'Progression du projet' : 'Project progress'), /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-5xl font-bold",
    style: {
      color: progressColor
    }
  }, progressData.overall, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-gray-500 text-sm"
  }, lang === 'fr' ? 'ComplÃ©tude globale' : 'Overall completion')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, progressData.sections.map(function (section) {
    var barColor = section.progress >= 80 ? 'bg-green-500' : section.progress >= 50 ? 'bg-yellow-500' : 'bg-red-500';
    return /*#__PURE__*/React.createElement("div", {
      key: section.id
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between text-sm mb-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-gray-700"
    }, section.label), /*#__PURE__*/React.createElement("span", {
      className: "text-gray-500"
    }, section.progress, "%")), /*#__PURE__*/React.createElement("div", {
      className: "h-2 bg-gray-100 rounded-full overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "h-full transition-all duration-500 " + barColor,
      style: {
        width: section.progress + '%'
      }
    })));
  })));
}
console.log('âœ… MOUDAR v8.1 Composants React chargÃ©s');

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIN DES COMPOSANTS v8.1
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VUES v9.0 GOLD STANDARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Vue 1: Adaptive Cockpit
function AdaptiveCockpitView(props) {
  var lang = props.lang || 'fr';
  var demoKPIs = {
    adoption_rate: {
      value: 45,
      target: 70,
      label: {
        fr: 'Taux d\'adoption',
        en: 'Adoption rate'
      }
    },
    fidelity_score: {
      value: 72,
      target: 80,
      label: {
        fr: 'Score de fidÃ©litÃ©',
        en: 'Fidelity score'
      }
    },
    milestone_completion: {
      value: 60,
      target: 75,
      label: {
        fr: 'Jalons complÃ©tÃ©s',
        en: 'Milestones completed'
      }
    }
  };
  var demoProject = {
    id: 'DEMO_PROJECT',
    title: 'Projet dÃ©mo',
    budget: 500000,
    strategies: ['S19', 'S04'],
    baselineKPIs: {},
    kpiHistory: {}
  };
  var driftsState = useState([]);
  var drifts = driftsState[0];
  var setDrifts = driftsState[1];
  var planBState = useState(null);
  var planB = planBState[0];
  var setPlanB = planBState[1];
  var analyzedState = useState(false);
  var analyzed = analyzedState[0];
  var setAnalyzed = analyzedState[1];
  function runAnalysis() {
    var detected = AdaptiveImplementationEngine.analyzeRealTime(demoProject, demoKPIs);
    setDrifts(detected);
    setAnalyzed(true);
    setPlanB(null);
  }
  function generatePlanB(drift) {
    var plan = AdaptiveImplementationEngine.generatePlanB(drift, demoProject, demoProject.strategies);
    setPlanB(plan);
  }
  var severityColors = {
    critical: 'bg-red-500',
    moderate: 'bg-orange-500',
    minor: 'bg-yellow-500'
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gradient-to-r from-purple-900/50 to-purple-700/30 rounded-xl border border-purple-500/30"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-3xl"
  }, "\uD83C\uDF9B\uFE0F"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-2xl font-bold text-white"
  }, lang === 'fr' ? 'Cockpit Adaptatif v11.0' : 'Adaptive Cockpit v11.0'), /*#__PURE__*/React.createElement("p", {
    className: "text-purple-300 text-sm"
  }, lang === 'fr' ? 'DÃ©tection des dÃ©rives + Plans B automatiques + Design SMART' : 'Drift detection + Automatic Plan B + SMART Design')))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4 mb-6"
  }, Object.keys(demoKPIs).map(function (kpiId) {
    var kpi = demoKPIs[kpiId];
    var variance = ((kpi.target - kpi.value) / kpi.target * 100).toFixed(1);
    var isNegative = kpi.value < kpi.target;
    return /*#__PURE__*/React.createElement("div", {
      key: kpiId,
      className: "bg-slate-800 rounded-xl p-4 border border-slate-700"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start mb-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-slate-400 text-sm"
    }, kpi.label[lang]), /*#__PURE__*/React.createElement("span", {
      className: "text-xs px-2 py-1 rounded " + (isNegative ? "bg-red-500/20 text-red-400" : "bg-green-500/20 text-green-400")
    }, isNegative ? 'â†“' : 'â†‘', " ", variance, "%")), /*#__PURE__*/React.createElement("div", {
      className: "text-3xl font-bold text-white mb-2"
    }, kpi.value, "%"), /*#__PURE__*/React.createElement("div", {
      className: "h-2 bg-slate-700 rounded-full overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "h-full rounded-full " + (isNegative ? "bg-red-500" : "bg-green-500"),
      style: {
        width: kpi.value / kpi.target * 100 + '%'
      }
    })), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-slate-500 mt-1"
    }, lang === 'fr' ? 'Cible' : 'Target', ": ", kpi.target, "%"));
  })), /*#__PURE__*/React.createElement("div", {
    className: "text-center mb-6"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: runAnalysis,
    className: "px-6 py-3 bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-500 hover:to-purple-400 text-white font-semibold rounded-xl transition-all shadow-lg"
  }, "\uD83D\uDD0D ", lang === 'fr' ? 'Analyser les dÃ©rives' : 'Analyze drifts')), analyzed && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-white flex items-center gap-2"
  }, "\uD83D\uDEA8 ", lang === 'fr' ? 'DÃ©rives dÃ©tectÃ©es' : 'Detected drifts', /*#__PURE__*/React.createElement("span", {
    className: "text-sm font-normal text-slate-400"
  }, "(", drifts.length, ")")), drifts.map(function (drift, idx) {
    var driftInfo = AdaptiveImplementationEngine.driftTypes[drift.type];
    return /*#__PURE__*/React.createElement("div", {
      key: idx,
      className: "bg-slate-800 rounded-xl p-4 border border-slate-700"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-start justify-between"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-3"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-2xl"
    }, driftInfo ? driftInfo.icon : 'âš ï¸'), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
      className: "font-semibold text-white"
    }, driftInfo ? driftInfo.label[lang] : drift.type), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-slate-400"
    }, lang === 'fr' ? 'Ã‰cart' : 'Variance', ": ", /*#__PURE__*/React.createElement("span", {
      className: "text-red-400 font-mono"
    }, "-", drift.variance, "%")))), /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 rounded text-xs text-white " + severityColors[drift.severity]
    }, drift.severity.toUpperCase()), drift.severity === 'critical' && /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        generatePlanB(drift);
      },
      className: "px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-sm rounded-lg transition-all"
    }, lang === 'fr' ? 'GÃ©nÃ©rer Plan B' : 'Generate Plan B'))));
  })), planB && /*#__PURE__*/React.createElement("div", {
    className: "mt-6 bg-gradient-to-r from-blue-900/50 to-blue-700/30 rounded-xl p-6 border border-blue-500/30"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-white mb-4 flex items-center gap-2"
  }, "\uD83D\uDCCB ", lang === 'fr' ? 'Plan B gÃ©nÃ©rÃ©' : 'Generated Plan B'), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4 mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800/50 rounded-lg p-3"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-slate-400 text-sm mb-1"
  }, lang === 'fr' ? 'StratÃ©gies de soutien' : 'Support strategies'), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 flex-wrap"
  }, planB.supportStrategies.map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s,
      className: "px-2 py-1 bg-blue-500/20 text-blue-300 rounded text-sm"
    }, s);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800/50 rounded-lg p-3"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-slate-400 text-sm mb-1"
  }, lang === 'fr' ? 'ProbabilitÃ© de succÃ¨s' : 'Success probability'), /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold text-green-400"
  }, planB.successProbability, "%"))), /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800/50 rounded-lg p-3 mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-slate-400 text-sm mb-2"
  }, lang === 'fr' ? 'Actions recommandÃ©es' : 'Recommended actions'), /*#__PURE__*/React.createElement("ul", {
    className: "space-y-1"
  }, planB.actions[lang].map(function (action, i) {
    return /*#__PURE__*/React.createElement("li", {
      key: i,
      className: "text-white text-sm flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-green-400"
    }, "\u2713"), " ", action);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-slate-400 text-xs"
  }, lang === 'fr' ? 'CoÃ»t additionnel' : 'Additional cost'), /*#__PURE__*/React.createElement("div", {
    className: "text-lg font-bold text-yellow-400"
  }, "$", planB.estimatedCost.toLocaleString())), /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-slate-400 text-xs"
  }, lang === 'fr' ? 'DÃ©lai' : 'Timeline'), /*#__PURE__*/React.createElement("div", {
    className: "text-lg font-bold text-white"
  }, planB.timeline)))));
}

// Vue 2: Grants
function GrantsView(props) {
  var lang = props.lang || 'fr';
  var selectedFunderState = useState(null);
  var selectedFunder = selectedFunderState[0];
  var setSelectedFunder = selectedFunderState[1];
  var proposalState = useState(null);
  var proposal = proposalState[0];
  var setProposal = proposalState[1];
  var demoProject = {
    title: lang === 'fr' ? 'IntÃ©gration santÃ© mentale en soins primaires' : 'Mental health integration in primary care',
    domain: 'mental_health',
    budget: 2500000,
    context: lang === 'fr' ? 'Pays Ã  revenu intermÃ©diaire, systÃ¨me de santÃ© en dÃ©veloppement' : 'Middle-income country, developing health system',
    objectives: ['equity', 'sustainability', 'scale'],
    strategies: ['S19', 'S04', 'S08', 'S10'],
    framework: 'CFIR',
    cfirScores: {
      innovation: 3.5,
      outerSetting: 3.2
    }
  };
  var funders = Object.values(GrantAIWriter.funders);
  function selectFunder(funderId) {
    setSelectedFunder(funderId);
    var prop = GrantAIWriter.generateProposal(demoProject, funderId, lang);
    setProposal(prop);
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gradient-to-r from-emerald-900/50 to-emerald-700/30 rounded-xl border border-emerald-500/30"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-3xl"
  }, "\uD83D\uDCB0"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-2xl font-bold text-white"
  }, "Grant AI Writer v9.0"), /*#__PURE__*/React.createElement("p", {
    className: "text-emerald-300 text-sm"
  }, lang === 'fr' ? 'Propositions adaptÃ©es aux critÃ¨res de chaque bailleur' : 'Proposals adapted to each funder\'s criteria')))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-5 gap-3 mb-6"
  }, funders.map(function (funder) {
    var alignment = GrantAIWriter.calculateAlignment(demoProject, funder.id);
    var isSelected = selectedFunder === funder.id;
    return /*#__PURE__*/React.createElement("div", {
      key: funder.id,
      onClick: function () {
        selectFunder(funder.id);
      },
      className: "cursor-pointer rounded-xl p-4 border transition-all " + (isSelected ? "bg-emerald-900/50 border-emerald-500" : "bg-slate-800 border-slate-700 hover:border-emerald-500/50")
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-center"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-3xl"
    }, funder.logo), /*#__PURE__*/React.createElement("div", {
      className: "font-semibold text-white mt-2"
    }, funder.name), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-slate-400 mt-1"
    }, lang === 'fr' ? 'Max' : 'Max', ": $", (funder.maxBudget / 1000000).toFixed(0), "M"), /*#__PURE__*/React.createElement("div", {
      className: "mt-2 text-sm font-bold " + (alignment.score >= 70 ? "text-green-400" : alignment.score >= 50 ? "text-yellow-400" : "text-red-400")
    }, alignment.score, "/100")));
  })), proposal && /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800 rounded-xl p-6 border border-slate-700"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-start mb-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-xl font-bold text-white"
  }, lang === 'fr' ? 'Proposition pour' : 'Proposal for', " ", proposal.funderName), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-400 text-sm"
  }, proposal.projectTitle)), /*#__PURE__*/React.createElement("div", {
    className: "px-4 py-2 rounded-lg text-lg font-bold " + (proposal.alignment.score >= 70 ? "bg-green-500/20 text-green-400" : "bg-yellow-500/20 text-yellow-400")
  }, lang === 'fr' ? 'Score' : 'Score', ": ", proposal.alignment.score, "/100")), /*#__PURE__*/React.createElement("div", {
    className: "mb-4 p-3 bg-slate-900/50 rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-sm font-medium text-slate-300 mb-2"
  }, lang === 'fr' ? 'Facteurs d\'alignement' : 'Alignment factors'), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-2"
  }, proposal.alignment.factors.map(function (f, i) {
    return /*#__PURE__*/React.createElement("span", {
      key: i,
      className: "px-2 py-1 rounded text-xs " + (f.points > 15 ? "bg-green-500/20 text-green-400" : f.points > 5 ? "bg-yellow-500/20 text-yellow-400" : "bg-red-500/20 text-red-400")
    }, f.factor, ": +", f.points, "pts");
  }))), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-sm font-medium text-slate-300"
  }, lang === 'fr' ? 'Sections de la proposition' : 'Proposal sections'), proposal.sections.slice(0, 4).map(function (section) {
    return /*#__PURE__*/React.createElement("div", {
      key: section.id,
      className: "p-3 bg-slate-900/50 rounded-lg"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-center mb-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-white"
    }, section.label), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-slate-500"
    }, section.maxWords, " ", lang === 'fr' ? 'mots max' : 'words max')), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-slate-400 line-clamp-2"
    }, section.content));
  })), proposal.alignment.tips && proposal.alignment.tips.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "mt-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-sm font-medium text-yellow-400 mb-2"
  }, "\uD83D\uDCA1 ", lang === 'fr' ? 'Conseils pour amÃ©liorer' : 'Tips to improve'), proposal.alignment.tips.map(function (tip, i) {
    return /*#__PURE__*/React.createElement("p", {
      key: i,
      className: "text-sm text-yellow-700"
    }, tip[lang]);
  }))));
}

// Vue 3: Qualitative Analysis
// Vue 4: Benchmark
function BenchmarkView(props) {
  var lang = props.lang || 'fr';
  var demoProject = {
    domain: 'mental_health',
    adoptionRate: 68,
    fidelityScore: 75,
    strategies: ['S19', 'S04', 'S08']
  };
  var comparisonState = useState(null);
  var comparison = comparisonState[0];
  var setComparison = comparisonState[1];
  useEffect(function () {
    var result = BenchmarkingEngine.compareToPool(demoProject);
    setComparison(result);
  }, []);
  if (!comparison) return /*#__PURE__*/React.createElement("div", {
    className: "text-white"
  }, lang === 'fr' ? 'Chargement...' : 'Loading...');
  var categoryColors = {
    'Excellence': 'text-green-400',
    'Above Average': 'text-blue-400',
    'Average': 'text-yellow-400',
    'Below Average': 'text-orange-400',
    'Needs Improvement': 'text-red-400'
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gradient-to-r from-amber-900/50 to-amber-700/30 rounded-xl border border-amber-500/30"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-3xl"
  }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-2xl font-bold text-white"
  }, lang === 'fr' ? 'Benchmarking Global v9.0' : 'Global Benchmarking v9.0'), /*#__PURE__*/React.createElement("p", {
    className: "text-amber-700 text-sm"
  }, lang === 'fr' ? 'Comparez votre projet au pool anonymisÃ© mondial' : 'Compare your project to the global anonymized pool')))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800 rounded-xl p-6 border border-slate-700 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-slate-400 text-sm mb-2"
  }, lang === 'fr' ? 'Votre percentile' : 'Your percentile'), /*#__PURE__*/React.createElement("div", {
    className: "text-5xl font-bold text-amber-400"
  }, comparison.percentileRank), /*#__PURE__*/React.createElement("div", {
    className: "text-slate-500 text-sm"
  }, "/ 100")), /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800 rounded-xl p-6 border border-slate-700 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-slate-400 text-sm mb-2"
  }, lang === 'fr' ? 'CatÃ©gorie' : 'Category'), /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold " + categoryColors[comparison.category]
  }, comparison.category)), /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800 rounded-xl p-6 border border-slate-700 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-slate-400 text-sm mb-2"
  }, lang === 'fr' ? 'vs Moyenne' : 'vs Average'), /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold " + (comparison.vsAverage.adoption.startsWith('+') ? "text-green-400" : "text-red-400")
  }, comparison.vsAverage.adoption), /*#__PURE__*/React.createElement("div", {
    className: "text-slate-500 text-xs"
  }, lang === 'fr' ? 'Adoption' : 'Adoption'))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800 rounded-xl p-4 border border-slate-700"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-white mb-4"
  }, "\uD83D\uDCC8 ", lang === 'fr' ? 'Statistiques du pool' : 'Pool statistics'), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-slate-400"
  }, lang === 'fr' ? 'Projets dans le pool' : 'Projects in pool'), /*#__PURE__*/React.createElement("span", {
    className: "text-white font-medium"
  }, comparison.benchmarks.poolSize)), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-slate-400"
  }, lang === 'fr' ? 'Taux de succÃ¨s' : 'Success rate'), /*#__PURE__*/React.createElement("span", {
    className: "text-green-400 font-medium"
  }, comparison.benchmarks.successRate, "%")), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-slate-400"
  }, lang === 'fr' ? 'Adoption moyenne' : 'Avg adoption'), /*#__PURE__*/React.createElement("span", {
    className: "text-white font-medium"
  }, comparison.benchmarks.avgAdoptionRate, "%")), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-slate-400"
  }, lang === 'fr' ? 'FidÃ©litÃ© moyenne' : 'Avg fidelity'), /*#__PURE__*/React.createElement("span", {
    className: "text-white font-medium"
  }, comparison.benchmarks.avgFidelityScore, "%")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800 rounded-xl p-4 border border-slate-700"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-white mb-4"
  }, "\uD83C\uDFC6 ", lang === 'fr' ? 'Top stratÃ©gies du pool' : 'Top pool strategies'), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, comparison.benchmarks.topStrategies.map(function (ts, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: ts.strategy,
      className: "flex items-center gap-3"
    }, /*#__PURE__*/React.createElement("span", {
      className: "w-6 h-6 flex items-center justify-center rounded-full bg-amber-500/20 text-amber-400 text-xs font-bold"
    }, i + 1), /*#__PURE__*/React.createElement("span", {
      className: "text-white font-medium"
    }, ts.strategy), /*#__PURE__*/React.createElement("div", {
      className: "flex-1 h-2 bg-slate-700 rounded-full overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "h-full bg-amber-500",
      style: {
        width: ts.percentage + '%'
      }
    })), /*#__PURE__*/React.createElement("span", {
      className: "text-sm text-amber-400"
    }, ts.percentage, "%"));
  })))), comparison.insights.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800 rounded-xl p-4 border border-slate-700"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-white mb-4"
  }, "\uD83D\uDCA1 ", lang === 'fr' ? 'Insights' : 'Insights'), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, comparison.insights.map(function (insight, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-3 rounded-lg " + (insight.priority === 'high' ? "bg-red-500/10 border border-red-500/30" : "bg-yellow-500/10 border border-yellow-500/30")
    }, /*#__PURE__*/React.createElement("span", {
      className: insight.priority === 'high' ? "text-red-400" : "text-yellow-400"
    }, insight.priority === 'high' ? 'âš ï¸' : 'ðŸ’¡', " ", insight.message[lang]));
  }))));
}

// Vue 5: Digital Twin
function DigitalTwinView(props) {
  var lang = props.lang || 'fr';
  var orgDataState = useState({
    name: 'Demo Organization',
    totalStaff: 150,
    departments: 5,
    sites: 3,
    hierarchyLevels: 4,
    annualBudget: 2000000,
    implementationBudget: 200000,
    dedicatedFTE: 3,
    changeReadiness: 0.6,
    innovationHistory: 0.5,
    leadershipSupport: 0.7,
    maxTraineesPerMonth: 25,
    maxSimultaneousSites: 2,
    leadershipBandwidth: 0.4,
    techReadiness: 0.55,
    budgetFlexibility: 0.25,
    staffAvailability: 0.65,
    sustainmentRisk: 0.45
  });
  var orgData = orgDataState[0];
  var setOrgData = orgDataState[1];
  var twinState = useState(null);
  var twin = twinState[0];
  var setTwin = twinState[1];
  var simulationState = useState(null);
  var simulation = simulationState[0];
  var setSimulation = simulationState[1];
  function createTwin() {
    var newTwin = DigitalTwinModule.createDigitalTwin(orgData);
    setTwin(newTwin);
    setSimulation(null);
  }
  function runSimulation() {
    if (!twin) return;
    var result = DigitalTwinModule.runConstrainedMonteCarlo({
      predictedSuccess: 0.65
    }, ['S19', 'S04', 'S10'], twin, 5000);
    setSimulation(result);
  }
  function updateOrgData(key, value) {
    var newData = Object.assign({}, orgData);
    newData[key] = value;
    setOrgData(newData);
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "fade-in"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-gradient-to-r from-pink-900/50 to-pink-700/30 rounded-xl border border-pink-500/30"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-3xl"
  }, "\uD83C\uDFD7\uFE0F"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-2xl font-bold text-white"
  }, "Digital Twin v9.0"), /*#__PURE__*/React.createElement("p", {
    className: "text-pink-300 text-sm"
  }, lang === 'fr' ? 'ModÃ©lisation organisationnelle pour prÃ©diction chirurgicale' : 'Organizational modeling for surgical prediction')))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800 rounded-xl p-4 border border-slate-700"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-white mb-4"
  }, "\u2699\uFE0F ", lang === 'fr' ? 'Configuration de l\'organisation' : 'Organization configuration'), /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-sm text-slate-400"
  }, lang === 'fr' ? 'Personnel total' : 'Total staff'), /*#__PURE__*/React.createElement("input", {
    type: "number",
    value: orgData.totalStaff,
    onChange: function (e) {
      updateOrgData('totalStaff', parseInt(e.target.value) || 0);
    },
    className: "w-full mt-1 bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-white"
  })), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 gap-3"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-sm text-slate-400"
  }, lang === 'fr' ? 'Sites' : 'Sites'), /*#__PURE__*/React.createElement("input", {
    type: "number",
    value: orgData.sites,
    onChange: function (e) {
      updateOrgData('sites', parseInt(e.target.value) || 0);
    },
    className: "w-full mt-1 bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-white"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-sm text-slate-400"
  }, lang === 'fr' ? 'DÃ©partements' : 'Departments'), /*#__PURE__*/React.createElement("input", {
    type: "number",
    value: orgData.departments,
    onChange: function (e) {
      updateOrgData('departments', parseInt(e.target.value) || 0);
    },
    className: "w-full mt-1 bg-slate-900 border border-slate-600 rounded-lg px-3 py-2 text-white"
  }))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-sm text-slate-400"
  }, lang === 'fr' ? 'DisponibilitÃ© leadership' : 'Leadership bandwidth', ": ", Math.round(orgData.leadershipBandwidth * 100), "%"), /*#__PURE__*/React.createElement("input", {
    type: "range",
    min: "0",
    max: "1",
    step: "0.05",
    value: orgData.leadershipBandwidth,
    onChange: function (e) {
      updateOrgData('leadershipBandwidth', parseFloat(e.target.value));
    },
    className: "w-full mt-1"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-sm text-slate-400"
  }, lang === 'fr' ? 'MaturitÃ© technologique' : 'Tech readiness', ": ", Math.round(orgData.techReadiness * 100), "%"), /*#__PURE__*/React.createElement("input", {
    type: "range",
    min: "0",
    max: "1",
    step: "0.05",
    value: orgData.techReadiness,
    onChange: function (e) {
      updateOrgData('techReadiness', parseFloat(e.target.value));
    },
    className: "w-full mt-1"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-sm text-slate-400"
  }, lang === 'fr' ? 'Risque de pÃ©rennitÃ©' : 'Sustainment risk', ": ", Math.round(orgData.sustainmentRisk * 100), "%"), /*#__PURE__*/React.createElement("input", {
    type: "range",
    min: "0",
    max: "1",
    step: "0.05",
    value: orgData.sustainmentRisk,
    onChange: function (e) {
      updateOrgData('sustainmentRisk', parseFloat(e.target.value));
    },
    className: "w-full mt-1"
  }))), /*#__PURE__*/React.createElement("button", {
    onClick: createTwin,
    className: "w-full mt-4 py-3 bg-gradient-to-r from-pink-600 to-pink-500 hover:from-pink-500 hover:to-pink-400 text-white font-semibold rounded-xl transition-all"
  }, "\uD83C\uDFD7\uFE0F ", lang === 'fr' ? 'CrÃ©er le Digital Twin' : 'Create Digital Twin')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, twin && /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800 rounded-xl p-4 border border-slate-700"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-4"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-white"
  }, "\uD83C\uDFAF ", lang === 'fr' ? 'Score de maturitÃ©' : 'Maturity score'), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold " + (twin.maturityScore >= 70 ? "text-green-400" : twin.maturityScore >= 50 ? "text-yellow-400" : "text-red-400")
  }, twin.maturityScore, "/100")), /*#__PURE__*/React.createElement("button", {
    onClick: runSimulation,
    className: "w-full py-3 bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-500 hover:to-purple-400 text-white font-semibold rounded-xl transition-all"
  }, "\uD83C\uDFB2 ", lang === 'fr' ? 'Lancer Monte Carlo (5000 itÃ©rations)' : 'Run Monte Carlo (5000 iterations)')), simulation && /*#__PURE__*/React.createElement("div", {
    className: "bg-slate-800 rounded-xl p-4 border border-slate-700"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-white mb-4"
  }, "\uD83D\uDCCA ", lang === 'fr' ? 'RÃ©sultats de simulation' : 'Simulation results'), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 gap-4 mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center p-3 bg-slate-900/50 rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-slate-400 text-sm"
  }, lang === 'fr' ? 'ProbabilitÃ© de succÃ¨s' : 'Success probability'), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold " + (simulation.successProbability >= 70 ? "text-green-400" : simulation.successProbability >= 50 ? "text-yellow-400" : "text-red-400")
  }, simulation.successProbability, "%")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-3 bg-slate-900/50 rounded-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-slate-400 text-sm"
  }, lang === 'fr' ? 'Adoption moyenne' : 'Mean adoption'), /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-pink-400"
  }, simulation.adoption.mean, "%"))), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-slate-900/50 rounded-lg mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-slate-400 mb-2"
  }, lang === 'fr' ? 'Distribution (percentiles)' : 'Distribution (percentiles)'), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between text-xs"
  }, /*#__PURE__*/React.createElement("span", null, "P10: ", simulation.adoption.p10, "%"), /*#__PURE__*/React.createElement("span", null, "P25: ", simulation.adoption.p25, "%"), /*#__PURE__*/React.createElement("span", {
    className: "font-bold text-white"
  }, "P50: ", simulation.adoption.median, "%"), /*#__PURE__*/React.createElement("span", null, "P75: ", simulation.adoption.p75, "%"), /*#__PURE__*/React.createElement("span", null, "P90: ", simulation.adoption.p90, "%"))), simulation.riskFactors.length > 0 && /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-sm font-medium text-slate-300 mb-2"
  }, "\u26A0\uFE0F ", lang === 'fr' ? 'Facteurs de risque' : 'Risk factors'), simulation.riskFactors.map(function (risk, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-2 rounded mb-1 text-sm " + (risk.severity === 'high' ? "bg-red-500/20 text-red-400" : "bg-yellow-500/20 text-yellow-400")
    }, risk.message[lang]);
  }))))));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VUE: BUDGET IMPACT ANALYSIS (BIA) - v9.0
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function BudgetImpactView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var projectState = useState({
    title: t('Projet de santÃ© mentale', 'Mental Health Project'),
    domain: 'mental_health',
    resourceLevel: 'UMIC',
    population: 150,
    budget: 500000
  });
  var project = projectState[0];
  var setProject = projectState[1];
  var yearsState = useState(5);
  var years = yearsState[0];
  var setYears = yearsState[1];
  var resultsState = useState(null);
  var results = resultsState[0];
  var setResults = resultsState[1];
  var selectedScenarioState = useState('moderate');
  var selectedScenario = selectedScenarioState[0];
  var setSelectedScenario = selectedScenarioState[1];
  function runAnalysis() {
    var budget = {
      summary: {
        total: project.budget
      }
    };
    var analysis = BudgetImpactAnalyzer.analyze(project, budget, years, lang);
    setResults(analysis);
  }
  function updateProject(field, value) {
    var newProject = Object.assign({}, project);
    newProject[field] = value;
    setProject(newProject);
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-emerald-600 to-teal-600 rounded-2xl p-6 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-4xl"
  }, "\uD83D\uDCB0"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-2xl font-bold"
  }, t('Analyse d\'Impact BudgÃ©taire', 'Budget Impact Analysis')), /*#__PURE__*/React.createElement("p", {
    className: "text-emerald-100"
  }, t('Projections 3-5 ans pour le passage Ã  l\'Ã©chelle', '3-5 year projections for scaling-up')))), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/20 rounded-full text-sm"
  }, "\uD83D\uDCCA BIA v1.0"), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/20 rounded-full text-sm"
  }, "\uD83C\uDFAF ", t('ScÃ©narios multiples', 'Multiple scenarios')), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/20 rounded-full text-sm"
  }, "\uD83D\uDCC8 ROI ", years, " ", t('ans', 'years')))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-lg font-bold text-gray-800 mb-4 flex items-center gap-2"
  }, "\u2699\uFE0F ", t('ParamÃ¨tres du projet', 'Project Parameters')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm text-gray-600 mb-1"
  }, t('Budget initial ($)', 'Initial Budget ($)')), /*#__PURE__*/React.createElement("input", {
    type: "number",
    value: project.budget,
    onChange: function (e) {
      updateProject('budget', parseInt(e.target.value) || 0);
    },
    className: "w-full border rounded-lg px-3 py-2"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm text-gray-600 mb-1"
  }, t('Population cible', 'Target Population')), /*#__PURE__*/React.createElement("input", {
    type: "number",
    value: project.population,
    onChange: function (e) {
      updateProject('population', parseInt(e.target.value) || 0);
    },
    className: "w-full border rounded-lg px-3 py-2"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm text-gray-600 mb-1"
  }, t('Horizon (annÃ©es)', 'Horizon (years)')), /*#__PURE__*/React.createElement("select", {
    value: years,
    onChange: function (e) {
      setYears(parseInt(e.target.value));
    },
    className: "w-full border rounded-lg px-3 py-2"
  }, /*#__PURE__*/React.createElement("option", {
    value: "3"
  }, "3 ", t('ans', 'years')), /*#__PURE__*/React.createElement("option", {
    value: "5"
  }, "5 ", t('ans', 'years')), /*#__PURE__*/React.createElement("option", {
    value: "7"
  }, "7 ", t('ans', 'years')))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm text-gray-600 mb-1"
  }, t('Domaine', 'Domain')), /*#__PURE__*/React.createElement("select", {
    value: project.domain,
    onChange: function (e) {
      updateProject('domain', e.target.value);
    },
    className: "w-full border rounded-lg px-3 py-2"
  }, /*#__PURE__*/React.createElement("option", {
    value: "health"
  }, t('SantÃ©', 'Health')), /*#__PURE__*/React.createElement("option", {
    value: "mental_health"
  }, t('SantÃ© mentale', 'Mental Health')), /*#__PURE__*/React.createElement("option", {
    value: "education"
  }, t('Ã‰ducation', 'Education')), /*#__PURE__*/React.createElement("option", {
    value: "social"
  }, t('Social', 'Social')))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm text-gray-600 mb-1"
  }, t('Niveau de ressources', 'Resource Level')), /*#__PURE__*/React.createElement("select", {
    value: project.resourceLevel,
    onChange: function (e) {
      updateProject('resourceLevel', e.target.value);
    },
    className: "w-full border rounded-lg px-3 py-2"
  }, /*#__PURE__*/React.createElement("option", {
    value: "LIC"
  }, "LIC - ", t('Faible revenu', 'Low Income')), /*#__PURE__*/React.createElement("option", {
    value: "LMIC"
  }, "LMIC - ", t('Revenu intermÃ©diaire inf.', 'Lower Middle Income')), /*#__PURE__*/React.createElement("option", {
    value: "UMIC"
  }, "UMIC - ", t('Revenu intermÃ©diaire sup.', 'Upper Middle Income')), /*#__PURE__*/React.createElement("option", {
    value: "HIC"
  }, "HIC - ", t('Revenu Ã©levÃ©', 'High Income')))), /*#__PURE__*/React.createElement("div", {
    className: "flex items-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: runAnalysis,
    className: "w-full py-2 bg-gradient-to-r from-emerald-600 to-teal-600 text-white font-semibold rounded-lg hover:from-emerald-700 hover:to-teal-700 transition"
  }, "\uD83D\uDCCA ", t('Analyser', 'Analyze'))))), results && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-gray-800 mb-3 flex items-center gap-2"
  }, "\uD83D\uDCDD ", t('RÃ©sumÃ© exÃ©cutif', 'Executive Summary')), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-700"
  }, results.executiveSummary)), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3"
  }, Object.keys(results.scenarios).map(function (key) {
    var scenario = results.scenarios[key];
    return /*#__PURE__*/React.createElement("button", {
      key: key,
      onClick: function () {
        setSelectedScenario(key);
      },
      className: "flex-1 p-4 rounded-xl border-2 transition " + (selectedScenario === key ? 'border-emerald-500 bg-emerald-50' : 'border-gray-200 hover:border-gray-400')
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-gray-800"
    }, scenario.label), /*#__PURE__*/React.createElement("div", {
      className: "text-2xl font-bold text-emerald-600 mt-1"
    }, "ROI: ", scenario.summary.overallROI, "%"), /*#__PURE__*/React.createElement("div", {
      className: "text-sm text-gray-500"
    }, t('Ratio C/B', 'B/C Ratio'), ": ", scenario.summary.overallBCRatio, ":1"));
  })), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-gray-800 mb-4"
  }, t('Projections annuelles', 'Yearly Projections'), " - ", results.scenarios[selectedScenario].label), /*#__PURE__*/React.createElement("div", {
    className: "overflow-x-auto"
  }, /*#__PURE__*/React.createElement("table", {
    className: "w-full text-sm"
  }, /*#__PURE__*/React.createElement("thead", null, /*#__PURE__*/React.createElement("tr", {
    className: "bg-gray-50"
  }, /*#__PURE__*/React.createElement("th", {
    className: "p-3 text-left"
  }, t('AnnÃ©e', 'Year')), /*#__PURE__*/React.createElement("th", {
    className: "p-3 text-right"
  }, t('Population', 'Population')), /*#__PURE__*/React.createElement("th", {
    className: "p-3 text-right"
  }, t('CoÃ»t', 'Cost')), /*#__PURE__*/React.createElement("th", {
    className: "p-3 text-right"
  }, t('BÃ©nÃ©fices', 'Benefits')), /*#__PURE__*/React.createElement("th", {
    className: "p-3 text-right"
  }, t('ROI cumulÃ©', 'Cumulative ROI')), /*#__PURE__*/React.createElement("th", {
    className: "p-3 text-right"
  }, t('Ratio C/B', 'B/C Ratio')))), /*#__PURE__*/React.createElement("tbody", null, results.scenarios[selectedScenario].data.map(function (row) {
    return /*#__PURE__*/React.createElement("tr", {
      key: row.year,
      className: "border-t hover:bg-gray-50"
    }, /*#__PURE__*/React.createElement("td", {
      className: "p-3 font-medium"
    }, t('An', 'Year'), " ", row.year), /*#__PURE__*/React.createElement("td", {
      className: "p-3 text-right"
    }, row.population.toLocaleString()), /*#__PURE__*/React.createElement("td", {
      className: "p-3 text-right text-red-600"
    }, "$", row.cost.toLocaleString()), /*#__PURE__*/React.createElement("td", {
      className: "p-3 text-right text-green-600"
    }, "$", row.benefits.toLocaleString()), /*#__PURE__*/React.createElement("td", {
      className: "p-3 text-right font-bold"
    }, row.cumulativeROI, "%"), /*#__PURE__*/React.createElement("td", {
      className: "p-3 text-right"
    }, row.bcRatio, ":1"));
  })), /*#__PURE__*/React.createElement("tfoot", null, /*#__PURE__*/React.createElement("tr", {
    className: "bg-emerald-50 font-bold"
  }, /*#__PURE__*/React.createElement("td", {
    className: "p-3"
  }, t('TOTAL', 'TOTAL')), /*#__PURE__*/React.createElement("td", {
    className: "p-3 text-right"
  }, results.scenarios[selectedScenario].summary.totalPopulation.toLocaleString()), /*#__PURE__*/React.createElement("td", {
    className: "p-3 text-right text-red-600"
  }, "$", results.scenarios[selectedScenario].summary.totalCost.toLocaleString()), /*#__PURE__*/React.createElement("td", {
    className: "p-3 text-right text-green-600"
  }, "$", results.scenarios[selectedScenario].summary.totalBenefit.toLocaleString()), /*#__PURE__*/React.createElement("td", {
    className: "p-3 text-right text-emerald-700"
  }, results.scenarios[selectedScenario].summary.overallROI, "%"), /*#__PURE__*/React.createElement("td", {
    className: "p-3 text-right text-emerald-700"
  }, results.scenarios[selectedScenario].summary.overallBCRatio, ":1")))))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold text-gray-800 mb-4"
  }, t('Recommandations pour les dÃ©cideurs', 'Recommendations for Decision Makers')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, results.recommendations.map(function (rec, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-4 rounded-lg border-l-4 " + (rec.priority === 'high' ? 'border-emerald-500 bg-emerald-50' : 'border-gray-300 bg-gray-50')
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xl"
    }, rec.icon), /*#__PURE__*/React.createElement("span", {
      className: "text-gray-800"
    }, rec.text)));
  })))));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VUE: STAKEHOLDER MAPPING (SNA) - v9.0
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function StakeholderMapView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var stakeholdersState = useState([]);
  var stakeholders = stakeholdersState[0];
  var setStakeholders = stakeholdersState[1];
  var analysisState = useState(null);
  var analysis = analysisState[0];
  var setAnalysis = analysisState[1];
  var newStakeholderState = useState({
    name: '',
    category: 'implementers',
    position: 'neutral',
    influence: 5,
    interest: 5
  });
  var newStakeholder = newStakeholderState[0];
  var setNewStakeholder = newStakeholderState[1];
  var showFormState = useState(false);
  var showForm = showFormState[0];
  var setShowForm = showFormState[1];
  function runAnalysis() {
    var result = StakeholderMapper.analyze(stakeholders.length > 0 ? stakeholders : null, {}, lang);
    setAnalysis(result);
    if (stakeholders.length === 0) {
      setStakeholders(result.stakeholders.map(function (s) {
        return {
          id: s.id,
          name: s.name,
          category: s.category,
          position: s.position,
          influence: s.influence / 10,
          interest: s.interest / 10
        };
      }));
    }
  }
  function addStakeholder() {
    var sh = Object.assign({}, newStakeholder, {
      id: 'SH_' + Date.now()
    });
    setStakeholders(stakeholders.concat([sh]));
    setNewStakeholder({
      name: '',
      category: 'implementers',
      position: 'neutral',
      influence: 5,
      interest: 5
    });
    setShowForm(false);
  }
  function removeStakeholder(id) {
    setStakeholders(stakeholders.filter(function (s) {
      return s.id !== id;
    }));
  }
  var categories = StakeholderMapper.stakeholderCategories;
  var positions = StakeholderMapper.positionMatrix;
  return /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-purple-600 to-indigo-600 rounded-2xl p-6 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-4xl"
  }, "\uD83C\uDF10"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-2xl font-bold"
  }, t('Cartographie des Acteurs', 'Stakeholder Mapping')), /*#__PURE__*/React.createElement("p", {
    className: "text-purple-100"
  }, t('Analyse des rÃ©seaux sociaux (SNA) pour l\'implÃ©mentation', 'Social Network Analysis (SNA) for implementation')))), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex gap-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/20 rounded-full text-sm"
  }, "\uD83D\uDC65 ", stakeholders.length, " ", t('acteurs', 'stakeholders')), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/20 rounded-full text-sm"
  }, "\uD83C\uDFAF ", t('Quadrant Power/Interest', 'Power/Interest Quadrant')))), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setShowForm(!showForm);
    },
    className: "px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center gap-2"
  }, "\u2795 ", t('Ajouter un acteur', 'Add Stakeholder')), /*#__PURE__*/React.createElement("button", {
    onClick: runAnalysis,
    className: "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center gap-2"
  }, "\uD83D\uDCCA ", t('Analyser', 'Analyze'), " ", stakeholders.length === 0 ? t('(donnÃ©es dÃ©mo)', '(demo data)') : '')), showForm && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4"
  }, t('Nouvel acteur', 'New Stakeholder')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm text-gray-600 mb-1"
  }, t('Nom/RÃ´le', 'Name/Role')), /*#__PURE__*/React.createElement("input", {
    type: "text",
    value: newStakeholder.name,
    onChange: function (e) {
      setNewStakeholder(Object.assign({}, newStakeholder, {
        name: e.target.value
      }));
    },
    className: "w-full border rounded-lg px-3 py-2",
    placeholder: t('Ex: Dr. Martin', 'Ex: Dr. Martin')
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm text-gray-600 mb-1"
  }, t('CatÃ©gorie', 'Category')), /*#__PURE__*/React.createElement("select", {
    value: newStakeholder.category,
    onChange: function (e) {
      setNewStakeholder(Object.assign({}, newStakeholder, {
        category: e.target.value
      }));
    },
    className: "w-full border rounded-lg px-3 py-2"
  }, Object.keys(categories).map(function (key) {
    return /*#__PURE__*/React.createElement("option", {
      key: key,
      value: key
    }, categories[key].icon, " ", categories[key].label[lang]);
  }))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm text-gray-600 mb-1"
  }, t('Position', 'Position')), /*#__PURE__*/React.createElement("select", {
    value: newStakeholder.position,
    onChange: function (e) {
      setNewStakeholder(Object.assign({}, newStakeholder, {
        position: e.target.value
      }));
    },
    className: "w-full border rounded-lg px-3 py-2"
  }, Object.keys(positions).map(function (key) {
    return /*#__PURE__*/React.createElement("option", {
      key: key,
      value: key
    }, positions[key].icon, " ", positions[key].label[lang]);
  }))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm text-gray-600 mb-1"
  }, t('Influence', 'Influence'), ": ", newStakeholder.influence, "/10"), /*#__PURE__*/React.createElement("input", {
    type: "range",
    min: "1",
    max: "10",
    value: newStakeholder.influence,
    onChange: function (e) {
      setNewStakeholder(Object.assign({}, newStakeholder, {
        influence: parseInt(e.target.value)
      }));
    },
    className: "w-full"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm text-gray-600 mb-1"
  }, t('IntÃ©rÃªt', 'Interest'), ": ", newStakeholder.interest, "/10"), /*#__PURE__*/React.createElement("input", {
    type: "range",
    min: "1",
    max: "10",
    value: newStakeholder.interest,
    onChange: function (e) {
      setNewStakeholder(Object.assign({}, newStakeholder, {
        interest: parseInt(e.target.value)
      }));
    },
    className: "w-full"
  })), /*#__PURE__*/React.createElement("div", {
    className: "flex items-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: addStakeholder,
    disabled: !newStakeholder.name,
    className: "w-full py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 transition"
  }, "\u2713 ", t('Ajouter', 'Add'))))), stakeholders.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4"
  }, t('Acteurs identifiÃ©s', 'Identified Stakeholders')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 lg:grid-cols-3 gap-3"
  }, stakeholders.map(function (sh) {
    var cat = categories[sh.category] || categories.partners;
    var pos = positions[sh.position] || positions.neutral;
    return /*#__PURE__*/React.createElement("div", {
      key: sh.id,
      className: "p-3 rounded-lg border flex items-center gap-3 hover:bg-gray-50"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl",
      style: {
        color: cat.color
      }
    }, cat.icon), /*#__PURE__*/React.createElement("div", {
      className: "flex-1"
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800"
    }, sh.name), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, cat.label[lang])), /*#__PURE__*/React.createElement("div", {
      className: "px-2 py-1 rounded-full text-xs",
      style: {
        backgroundColor: pos.color + '20',
        color: pos.color
      }
    }, pos.icon, " ", pos.label[lang]), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        removeStakeholder(sh.id);
      },
      className: "text-red-500 hover:text-red-700"
    }, "\u2715"));
  }))), analysis && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-4 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-4 shadow-lg border text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-purple-600"
  }, analysis.metrics.championsCount), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-500"
  }, t('Champions', 'Champions'))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-4 shadow-lg border text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-red-500"
  }, analysis.metrics.blockersCount), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-500"
  }, t('Bloqueurs', 'Blockers'))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-4 shadow-lg border text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-green-600"
  }, analysis.readinessScore, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-500"
  }, t('Score de prÃ©paration', 'Readiness Score'))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-4 shadow-lg border text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-amber-500"
  }, analysis.riskScore, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-500"
  }, t('Score de risque', 'Risk Score')))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4"
  }, t('Matrice Power/Interest', 'Power/Interest Matrix')), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 gap-4"
  }, Object.keys(analysis.quadrantDistribution).map(function (key) {
    var q = analysis.quadrantDistribution[key];
    return /*#__PURE__*/React.createElement("div", {
      key: key,
      className: "p-4 rounded-lg border",
      style: {
        borderColor: q.color
      }
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center justify-between"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium"
    }, q.label), /*#__PURE__*/React.createElement("span", {
      className: "text-2xl font-bold",
      style: {
        color: q.color
      }
    }, q.count)));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4"
  }, t('Recommandations d\'engagement', 'Engagement Recommendations')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, analysis.recommendations.map(function (rec, i) {
    var bgColor = rec.priority === 'high' ? 'bg-red-50 border-red-300' : rec.priority === 'medium' ? 'bg-amber-50 border-amber-300' : 'bg-gray-50 border-gray-300';
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-4 rounded-lg border " + bgColor
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xl"
    }, rec.icon), /*#__PURE__*/React.createElement("span", {
      className: "text-gray-800"
    }, rec.text)));
  })))));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VUE: SUSTAINABILITY FRAMEWORK (SCHEIRER) - v9.0
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VUE: SECURITY SETTINGS (E2EE) - v10.0
// End-to-End Encryption management for sensitive project data
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function SecuritySettingsView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var passwordState = useState('');
  var password = passwordState[0];
  var setPassword = passwordState[1];
  var confirmPasswordState = useState('');
  var confirmPassword = confirmPasswordState[0];
  var setConfirmPassword = confirmPasswordState[1];
  var encryptionEnabledState = useState(localStorage.getItem('MOUDAR_E2EE_ENABLED') === 'true');
  var encryptionEnabled = encryptionEnabledState[0];
  var setEncryptionEnabled = encryptionEnabledState[1];
  var statusState = useState(null);
  var status = statusState[0];
  var setStatus = statusState[1];
  var testDataState = useState('');
  var testData = testDataState[0];
  var setTestData = testDataState[1];
  var encryptedResultState = useState('');
  var encryptedResult = encryptedResultState[0];
  var setEncryptedResult = encryptedResultState[1];
  var decryptedResultState = useState('');
  var decryptedResult = decryptedResultState[0];
  var setDecryptedResult = decryptedResultState[1];
  var isSupported = MOUDAR.Crypto.isSupported();

  // Enable/disable encryption
  function toggleEncryption() {
    if (!encryptionEnabled && password.length < 8) {
      setStatus({
        type: 'error',
        message: t('Le mot de passe doit contenir au moins 8 caractÃ¨res', 'Password must be at least 8 characters')
      });
      return;
    }
    if (!encryptionEnabled && password !== confirmPassword) {
      setStatus({
        type: 'error',
        message: t('Les mots de passe ne correspondent pas', 'Passwords do not match')
      });
      return;
    }
    var newState = !encryptionEnabled;
    setEncryptionEnabled(newState);
    localStorage.setItem('MOUDAR_E2EE_ENABLED', newState.toString());
    if (newState) {
      // Store password hash (not the password itself)
      MOUDAR.Crypto.hash(password).then(function (hash) {
        localStorage.setItem('MOUDAR_E2EE_HASH', hash);
        setStatus({
          type: 'success',
          message: t('Chiffrement E2E activÃ©', 'E2E Encryption enabled')
        });
        MOUDAR.Feedback.success(t('Chiffrement E2E activÃ©', 'E2E Encryption enabled'));
      });
    } else {
      localStorage.removeItem('MOUDAR_E2EE_HASH');
      setStatus({
        type: 'info',
        message: t('Chiffrement E2E dÃ©sactivÃ©', 'E2E Encryption disabled')
      });
      MOUDAR.Feedback.info(t('Chiffrement E2E dÃ©sactivÃ©', 'E2E Encryption disabled'));
    }
    setPassword('');
    setConfirmPassword('');
  }

  // Test encryption
  async function testEncrypt() {
    if (!testData || !password) {
      setStatus({
        type: 'error',
        message: t('Entrez des donnÃ©es et un mot de passe', 'Enter data and password')
      });
      return;
    }
    try {
      var encrypted = await MOUDAR.Crypto.encrypt({
        data: testData,
        timestamp: Date.now()
      }, password);
      setEncryptedResult(encrypted);
      setStatus({
        type: 'success',
        message: t('DonnÃ©es chiffrÃ©es avec succÃ¨s', 'Data encrypted successfully')
      });
    } catch (e) {
      setStatus({
        type: 'error',
        message: t('Erreur de chiffrement: ', 'Encryption error: ') + e.message
      });
    }
  }

  // Test decryption
  async function testDecrypt() {
    if (!encryptedResult || !password) {
      setStatus({
        type: 'error',
        message: t('Aucune donnÃ©e Ã  dÃ©chiffrer', 'No data to decrypt')
      });
      return;
    }
    try {
      var decrypted = await MOUDAR.Crypto.decrypt(encryptedResult, password);
      setDecryptedResult(JSON.stringify(decrypted, null, 2));
      setStatus({
        type: 'success',
        message: t('DonnÃ©es dÃ©chiffrÃ©es avec succÃ¨s', 'Data decrypted successfully')
      });
    } catch (e) {
      setStatus({
        type: 'error',
        message: t('Erreur de dÃ©chiffrement (mauvais mot de passe?)', 'Decryption error (wrong password?)')
      });
    }
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-slate-800 to-slate-900 rounded-2xl p-6 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-4xl"
  }, "\uD83D\uDD10"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-2xl font-bold"
  }, t('SÃ©curitÃ© & Chiffrement', 'Security & Encryption')), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-300"
  }, t('Chiffrement de bout en bout AES-256-GCM pour donnÃ©es sensibles', 'End-to-End AES-256-GCM encryption for sensitive data')))), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex gap-2 flex-wrap"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 rounded-full text-sm " + (isSupported ? 'bg-green-500/20 text-green-300' : 'bg-red-500/20 text-red-300')
  }, isSupported ? 'âœ“ Web Crypto API' : 'âœ— Web Crypto API'), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 rounded-full text-sm " + (encryptionEnabled ? 'bg-green-500/20 text-green-300' : 'bg-slate-500/20 text-slate-300')
  }, encryptionEnabled ? 'ðŸ”’ E2EE Actif' : 'ðŸ”“ E2EE Inactif'), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-purple-500/20 text-purple-300 rounded-full text-sm"
  }, "v11.0 Scientific Excellence"))), status && /*#__PURE__*/React.createElement("div", {
    className: "p-4 rounded-xl flex items-center gap-3 " + (status.type === 'success' ? 'bg-green-100 text-green-800' : status.type === 'error' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800')
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-xl"
  }, status.type === 'success' ? 'âœ“' : status.type === 'error' ? 'âœ—' : 'â„¹'), /*#__PURE__*/React.createElement("span", null, status.message)), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-lg font-bold text-gray-800 mb-4 flex items-center gap-2"
  }, "\uD83D\uDD12 ", t('Activer le chiffrement E2E', 'Enable E2E Encryption')), !encryptionEnabled ? /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm font-medium text-gray-700 mb-1"
  }, t('Mot de passe maÃ®tre (min. 8 caractÃ¨res)', 'Master password (min. 8 characters)')), /*#__PURE__*/React.createElement("input", {
    type: "password",
    value: password,
    onChange: function (e) {
      setPassword(e.target.value);
    },
    className: "w-full p-3 border rounded-lg focus:ring-2 focus:ring-slate-500",
    placeholder: "\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "block text-sm font-medium text-gray-700 mb-1"
  }, t('Confirmer le mot de passe', 'Confirm password')), /*#__PURE__*/React.createElement("input", {
    type: "password",
    value: confirmPassword,
    onChange: function (e) {
      setConfirmPassword(e.target.value);
    },
    className: "w-full p-3 border rounded-lg focus:ring-2 focus:ring-slate-500",
    placeholder: "\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"
  })), /*#__PURE__*/React.createElement("button", {
    onClick: toggleEncryption,
    disabled: !isSupported,
    className: "w-full py-3 bg-gradient-to-r from-slate-800 to-slate-900 text-white font-semibold rounded-xl hover:from-slate-700 hover:to-slate-800 transition disabled:opacity-50"
  }, "\uD83D\uDD10 ", t('Activer le chiffrement E2E', 'Enable E2E Encryption'))) : /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-green-50 rounded-lg border border-green-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-2 text-green-800"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-2xl"
  }, "\u2713"), /*#__PURE__*/React.createElement("span", {
    className: "font-medium"
  }, t('Chiffrement E2E actif', 'E2E Encryption active'))), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-green-700 mt-1"
  }, t('Vos projets sensibles sont protÃ©gÃ©s par AES-256-GCM', 'Your sensitive projects are protected by AES-256-GCM'))), /*#__PURE__*/React.createElement("button", {
    onClick: toggleEncryption,
    className: "w-full py-3 bg-red-100 text-red-700 font-semibold rounded-xl hover:bg-red-200 transition"
  }, "\uD83D\uDD13 ", t('DÃ©sactiver le chiffrement', 'Disable encryption')))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-lg font-bold text-gray-800 mb-4 flex items-center gap-2"
  }, "\uD83E\uDDEA ", t('Tester le chiffrement', 'Test Encryption')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-medium text-gray-700"
  }, t('1. Chiffrer', '1. Encrypt')), /*#__PURE__*/React.createElement("input", {
    type: "password",
    value: password,
    onChange: function (e) {
      setPassword(e.target.value);
    },
    className: "w-full p-2 border rounded-lg text-sm",
    placeholder: t('Mot de passe', 'Password')
  }), /*#__PURE__*/React.createElement("textarea", {
    value: testData,
    onChange: function (e) {
      setTestData(e.target.value);
    },
    className: "w-full p-2 border rounded-lg text-sm",
    rows: "3",
    placeholder: t('DonnÃ©es Ã  chiffrer...', 'Data to encrypt...')
  }), /*#__PURE__*/React.createElement("button", {
    onClick: testEncrypt,
    className: "w-full py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 text-sm"
  }, "\uD83D\uDD12 ", t('Chiffrer', 'Encrypt')), encryptedResult && /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-gray-100 rounded-lg"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500 mb-1"
  }, t('RÃ©sultat chiffrÃ©:', 'Encrypted result:')), /*#__PURE__*/React.createElement("code", {
    className: "text-xs break-all"
  }, encryptedResult.substring(0, 100), "..."))), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-medium text-gray-700"
  }, t('2. DÃ©chiffrer', '2. Decrypt')), /*#__PURE__*/React.createElement("button", {
    onClick: testDecrypt,
    disabled: !encryptedResult,
    className: "w-full py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm disabled:opacity-50"
  }, "\uD83D\uDD13 ", t('DÃ©chiffrer', 'Decrypt')), decryptedResult && /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-green-50 rounded-lg border border-green-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-green-700 mb-1"
  }, t('RÃ©sultat dÃ©chiffrÃ©:', 'Decrypted result:')), /*#__PURE__*/React.createElement("pre", {
    className: "text-xs text-green-800 whitespace-pre-wrap"
  }, decryptedResult))))), /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-6 border"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-lg font-bold text-gray-800 mb-4 flex items-center gap-2"
  }, "\uD83D\uDCCB ", t('SpÃ©cifications de sÃ©curitÃ©', 'Security Specifications')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-white rounded-lg border"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl mb-2"
  }, "\uD83D\uDD10"), /*#__PURE__*/React.createElement("h3", {
    className: "font-medium text-gray-800"
  }, "AES-256-GCM"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, t('Algorithme de chiffrement authentifiÃ©', 'Authenticated encryption algorithm'))), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-white rounded-lg border"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl mb-2"
  }, "\uD83D\uDD11"), /*#__PURE__*/React.createElement("h3", {
    className: "font-medium text-gray-800"
  }, "PBKDF2"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, t('DÃ©rivation de clÃ© (100k itÃ©rations)', 'Key derivation (100k iterations)'))), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-white rounded-lg border"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl mb-2"
  }, "\uD83D\uDEE1\uFE0F"), /*#__PURE__*/React.createElement("h3", {
    className: "font-medium text-gray-800"
  }, "SHA-256"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, t('Hachage pour intÃ©gritÃ©', 'Hashing for integrity')))), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 p-4 bg-amber-50 rounded-lg border border-amber-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-amber-800"
  }, "\u26A0\uFE0F ", t('Important: Le mot de passe n\'est JAMAIS stockÃ© ni transmis. Si vous l\'oubliez, les donnÃ©es chiffrÃ©es seront irrÃ©cupÃ©rables.', 'Important: The password is NEVER stored or transmitted. If you forget it, encrypted data will be unrecoverable.')))));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VUE: CONSENSUS VALIDATION (CVE) - v10.0
// Multi-expert collaborative assessment with divergence detection
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function ConsensusValidationView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };

  // Ã‰tats
  var sessionState = useState(null);
  var session = sessionState[0];
  var setSession = sessionState[1];
  var expertsState = useState([{
    id: 'EXP1',
    name: t('Dr. Expert 1', 'Dr. Expert 1'),
    role: 'lead_expert'
  }, {
    id: 'EXP2',
    name: t('Dr. Expert 2', 'Dr. Expert 2'),
    role: 'senior_expert'
  }, {
    id: 'EXP3',
    name: t('Expert 3', 'Expert 3'),
    role: 'expert'
  }, {
    id: 'EXP4',
    name: t('Reviewer 1', 'Reviewer 1'),
    role: 'reviewer'
  }]);
  var experts = expertsState[0];
  var setExperts = expertsState[1];
  var currentExpertState = useState(null);
  var currentExpert = currentExpertState[0];
  var setCurrentExpert = currentExpertState[1];
  var scoresState = useState({});
  var scores = scoresState[0];
  var setScores = scoresState[1];
  var commentsState = useState({});
  var comments = commentsState[0];
  var setComments = commentsState[1];
  var reportState = useState(null);
  var report = reportState[0];
  var setReport = reportState[1];
  var dimensions = [{
    id: 'feasibility',
    label: t('FaisabilitÃ©', 'Feasibility'),
    icon: 'âš™ï¸'
  }, {
    id: 'impact',
    label: t('Impact', 'Impact'),
    icon: 'ðŸ“ˆ'
  }, {
    id: 'sustainability',
    label: t('PÃ©rennitÃ©', 'Sustainability'),
    icon: 'ðŸŒ±'
  }, {
    id: 'scalability',
    label: t('ScalabilitÃ©', 'Scalability'),
    icon: 'ðŸ“Š'
  }, {
    id: 'equity',
    label: t('Ã‰quitÃ©', 'Equity'),
    icon: 'âš–ï¸'
  }];
  var roleLabels = {
    lead_expert: {
      label: t('Expert principal', 'Lead Expert'),
      weight: 1.5,
      color: 'bg-purple-100 text-purple-800'
    },
    senior_expert: {
      label: t('Expert senior', 'Senior Expert'),
      weight: 1.2,
      color: 'bg-blue-100 text-blue-800'
    },
    expert: {
      label: t('Expert', 'Expert'),
      weight: 1.0,
      color: 'bg-green-100 text-green-800'
    },
    reviewer: {
      label: t('Reviewer', 'Reviewer'),
      weight: 0.8,
      color: 'bg-yellow-100 text-yellow-800'
    },
    observer: {
      label: t('Observateur', 'Observer'),
      weight: 0.5,
      color: 'bg-gray-100 text-gray-800'
    }
  };

  // CrÃ©er une nouvelle session
  function createSession() {
    var newSession = MOUDAR.Consensus.createSession('PROJ_' + Date.now(), dimensions.map(function (d) {
      return d.id;
    }), experts);
    setSession(newSession);
    setReport(null);
    MOUDAR.Feedback.success(t('Session de validation crÃ©Ã©e', 'Validation session created'));
  }

  // Soumettre un vote
  function submitVote() {
    if (!session || !currentExpert) return;
    var expert = experts.find(function (e) {
      return e.id === currentExpert;
    });
    if (!expert) return;
    MOUDAR.Consensus.addVote(session, expert.id, expert.role, scores, comments);
    setSession(Object.assign({}, session));
    setScores({});
    setComments({});
    setCurrentExpert(null);
    MOUDAR.Feedback.success(t('Vote enregistrÃ© pour ' + expert.name, 'Vote recorded for ' + expert.name));
  }

  // Calculer le consensus
  function calculateConsensus() {
    if (!session) return;
    MOUDAR.Consensus.calculateConsensus(session);
    MOUDAR.Consensus.identifyDivergences(session);
    var newReport = MOUDAR.Consensus.generateReport(session, lang);
    setReport(newReport);
    setSession(Object.assign({}, session));
    MOUDAR.Feedback.info(t('Consensus calculÃ©', 'Consensus calculated'));
  }

  // Mettre Ã  jour un score
  function updateScore(dimId, value) {
    var newScores = Object.assign({}, scores);
    newScores[dimId] = parseInt(value);
    setScores(newScores);
  }

  // Ajouter un expert
  function addExpert(name, role) {
    if (!name.trim()) return;
    var newExpert = {
      id: 'EXP_' + Date.now(),
      name: name,
      role: role || 'expert'
    };
    setExperts(experts.concat([newExpert]));
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-gradient-to-r from-indigo-600 to-purple-600 rounded-2xl p-6 text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-2"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-4xl"
  }, "\uD83E\uDD1D"), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h1", {
    className: "text-2xl font-bold"
  }, t('Validation par Consensus', 'Consensus Validation')), /*#__PURE__*/React.createElement("p", {
    className: "text-indigo-100"
  }, t('Ã‰valuation multi-experts avec dÃ©tection des divergences', 'Multi-expert assessment with divergence detection')))), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex gap-2 flex-wrap"
  }, /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/20 rounded-full text-sm"
  }, "\uD83D\uDD12 v11.0"), /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/20 rounded-full text-sm"
  }, "\uD83D\uDC65 ", experts.length, " ", t('experts', 'experts')), session && /*#__PURE__*/React.createElement("span", {
    className: "px-3 py-1 bg-white/20 rounded-full text-sm"
  }, "\uD83D\uDCCA ", session.votes.length, " ", t('votes', 'votes')))), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3 flex-wrap"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: createSession,
    className: "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition flex items-center gap-2"
  }, "\u2795 ", t('Nouvelle session', 'New Session')), session && session.votes.length >= 2 && /*#__PURE__*/React.createElement("button", {
    onClick: calculateConsensus,
    className: "px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition flex items-center gap-2"
  }, "\uD83D\uDCCA ", t('Calculer le consensus', 'Calculate Consensus')), session && /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      MOUDAR.Consensus.exportSessionFile(session);
      MOUDAR.Feedback.success(t('Fichier .moudar exportÃ© â€” envoyez-le aux experts par email', '.moudar file exported â€” send to experts by email'));
    },
    className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition flex items-center gap-2"
  }, "\uD83D\uDCE4 ", t('Exporter .moudar', 'Export .moudar')), session && currentExpert && /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      MOUDAR.Consensus.exportVoteFile(session, currentExpert, scores, comments);
      MOUDAR.Feedback.success(t('Fichier .vote exportÃ©', '.vote file exported'));
    },
    className: "px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center gap-2"
  }, "\uD83D\uDDF3\uFE0F ", t('Exporter mon .vote', 'Export my .vote')), session && /*#__PURE__*/React.createElement("label", {
    className: "px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition flex items-center gap-2 cursor-pointer"
  }, "\uD83D\uDCE5 ", t('Importer .vote', 'Import .vote'), /*#__PURE__*/React.createElement("input", {
    type: "file",
    accept: ".vote",
    multiple: true,
    className: "hidden",
    onChange: function (e) {
      var files = Array.from(e.target.files || []);
      if (files.length === 0) return;
      var promises = files.map(function (f) {
        return new Promise(function (resolve) {
          var reader = new FileReader();
          reader.onload = function (ev) {
            try {
              resolve(JSON.parse(ev.target.result));
            } catch (err) {
              resolve(null);
            }
          };
          reader.readAsText(f);
        });
      });
      Promise.all(promises).then(function (payloads) {
        var valid = payloads.filter(function (p) {
          return p !== null;
        });
        var result = MOUDAR.Consensus.importVoteFiles(session, valid);
        setSession(Object.assign({}, session));
        MOUDAR.Feedback.success(t(result.imported + ' votes importÃ©s sur ' + result.total, result.imported + ' votes imported of ' + result.total));
        if (result.errors.length > 0) {
          MOUDAR.Feedback.error(result.errors.join(', '));
        }
      });
      e.target.value = '';
    }
  })), session && session.consensus && /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var alpha = MOUDAR.Consensus.computeKrippendorffsAlpha(session);
      var msg = "Krippendorff's Alpha: " + (alpha.alpha !== null ? alpha.alpha : 'N/A') + ' (' + alpha.interpretation + ')';
      MOUDAR.Feedback.info(msg);
      MOUDAR.Consensus.exportConsensusReport(session, lang);
    },
    className: "px-4 py-2 bg-rose-600 text-white rounded-lg hover:bg-rose-700 transition flex items-center gap-2"
  }, "\uD83D\uDCCB ", t('Rapport + Alpha K', 'Report + Alpha K'))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-lg font-bold text-gray-800 mb-4 flex items-center gap-2"
  }, "\uD83D\uDC65 ", t('Panel d\'experts', 'Expert Panel')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 lg:grid-cols-4 gap-3"
  }, experts.map(function (expert) {
    var roleInfo = roleLabels[expert.role] || roleLabels.expert;
    var hasVoted = session && session.votes.some(function (v) {
      return v.expertId === expert.id;
    });
    return /*#__PURE__*/React.createElement("div", {
      key: expert.id,
      className: "p-4 rounded-lg border-2 transition cursor-pointer " + (hasVoted ? 'border-green-500 bg-green-50' : currentExpert === expert.id ? 'border-indigo-500 bg-indigo-50' : 'border-gray-200 hover:border-gray-400'),
      onClick: function () {
        if (!hasVoted && session) setCurrentExpert(expert.id);
      }
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center justify-between mb-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-gray-800"
    }, expert.name), hasVoted && /*#__PURE__*/React.createElement("span", {
      className: "text-green-600"
    }, "\u2713")), /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xs px-2 py-1 rounded-full " + roleInfo.color
    }, roleInfo.label), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-500"
    }, "\xD7", roleInfo.weight)));
  }))), session && currentExpert && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-lg font-bold text-gray-800 mb-4 flex items-center gap-2"
  }, "\uD83D\uDCDD ", t('Vote de', 'Vote by'), " ", experts.find(function (e) {
    return e.id === currentExpert;
  }).name), /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, dimensions.map(function (dim) {
    return /*#__PURE__*/React.createElement("div", {
      key: dim.id,
      className: "p-4 rounded-lg bg-gray-50 border"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center justify-between mb-2"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xl"
    }, dim.icon), /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-gray-800"
    }, dim.label)), /*#__PURE__*/React.createElement("span", {
      className: "text-2xl font-bold text-indigo-600"
    }, scores[dim.id] || 0, "/100")), /*#__PURE__*/React.createElement("input", {
      type: "range",
      min: "0",
      max: "100",
      value: scores[dim.id] || 50,
      onChange: function (e) {
        updateScore(dim.id, e.target.value);
      },
      className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
    }), /*#__PURE__*/React.createElement("textarea", {
      placeholder: t('Commentaire optionnel...', 'Optional comment...'),
      value: comments[dim.id] || '',
      onChange: function (e) {
        var newComments = Object.assign({}, comments);
        newComments[dim.id] = e.target.value;
        setComments(newComments);
      },
      className: "w-full mt-2 p-2 border rounded-lg text-sm",
      rows: "2"
    }));
  })), /*#__PURE__*/React.createElement("button", {
    onClick: submitVote,
    disabled: Object.keys(scores).length < dimensions.length,
    className: "w-full mt-4 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-xl hover:from-indigo-700 hover:to-purple-700 transition disabled:opacity-50"
  }, "\u2713 ", t('Soumettre le vote', 'Submit Vote'))), report && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "rounded-xl p-6 " + (report.summary.readyForDecision ? 'bg-gradient-to-r from-green-500 to-emerald-500' : 'bg-gradient-to-r from-amber-500 to-orange-500') + " text-white"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center justify-between"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "text-lg font-bold mb-1"
  }, report.summary.consensusStatus), /*#__PURE__*/React.createElement("p", {
    className: "opacity-90"
  }, t('Participation', 'Participation'), ": ", report.summary.participationRate, " (", report.summary.votesReceived, "/", report.summary.totalExperts, ")")), /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl font-bold"
  }, report.summary.overallScore), /*#__PURE__*/React.createElement("div", {
    className: "text-sm opacity-90"
  }, "/100")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4"
  }, t('Scores par dimension', 'Scores by Dimension')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 lg:grid-cols-5 gap-4"
  }, dimensions.map(function (dim) {
    var score = report.dimensionScores[dim.id] || 0;
    var level = session.consensus.divergenceLevel[dim.id];
    var levelColor = level === 'consensus' ? 'bg-green-100 text-green-800' : level === 'moderate' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800';
    return /*#__PURE__*/React.createElement("div", {
      key: dim.id,
      className: "p-4 rounded-lg border text-center"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-2xl"
    }, dim.icon), /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-gray-800 mt-1"
    }, dim.label), /*#__PURE__*/React.createElement("div", {
      className: "text-2xl font-bold text-indigo-600 mt-2"
    }, score), /*#__PURE__*/React.createElement("span", {
      className: "text-xs px-2 py-1 rounded-full " + levelColor
    }, level === 'consensus' ? 'âœ“' : level === 'moderate' ? '~' : '!', " ", level));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4"
  }, t('Points de discussion', 'Discussion Points')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, report.discussionPoints.map(function (point, i) {
    var bgColor = point.priority === 'high' ? 'bg-red-50 border-red-300' : point.priority === 'moderate' ? 'bg-yellow-50 border-yellow-300' : 'bg-green-50 border-green-300';
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-4 rounded-lg border " + bgColor
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2 mb-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xl"
    }, point.icon), /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-gray-800"
    }, point.title)), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-gray-600"
    }, point.description), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mt-1"
    }, "\u27A1\uFE0F ", point.action));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl p-6 shadow-lg border"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4"
  }, t('Recommandations', 'Recommendations')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, report.recommendations.map(function (rec, i) {
    var bgColor = rec.priority === 'high' ? 'bg-red-50' : rec.priority === 'success' ? 'bg-green-50' : 'bg-gray-50';
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-4 rounded-lg " + bgColor
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xl"
    }, rec.icon), /*#__PURE__*/React.createElement("span", {
      className: "text-gray-800"
    }, rec.text)));
  })))), !session && /*#__PURE__*/React.createElement("div", {
    className: "text-center py-12 text-gray-500"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-6xl mb-4"
  }, "\uD83E\uDD1D"), /*#__PURE__*/React.createElement("p", {
    className: "text-lg"
  }, t('CrÃ©ez une session pour dÃ©marrer la validation par consensus', 'Create a session to start consensus validation')), /*#__PURE__*/React.createElement("p", {
    className: "text-sm mt-2"
  }, t('Les experts noteront indÃ©pendamment le projet sur 5 dimensions', 'Experts will independently rate the project on 5 dimensions'))));
}

// ============================================
// v11.0: NPT VIEW â€” Normalization Process Theory (May & Finch 2009)
// ============================================
function NPTView(props) {
  var lang = props.lang || 'fr';
  var project = props.project;
  var scoresState = React.useState({});
  var scores = scoresState[0];
  var setScores = scoresState[1];
  var evaluation = NPTEvaluator.evaluate(project, scores, lang);
  var handleScore = function (subId, value) {
    var newScores = Object.assign({}, scores);
    newScores[subId] = parseInt(value) || 0;
    setScores(newScores);
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "max-w-6xl mx-auto p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center justify-between"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83E\uDDE9 ", lang === "fr" ? "ThÃ©orie du Processus de Normalisation (NPT)" : "Normalization Process Theory (NPT)", /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-emerald-100 text-emerald-700 text-xs rounded-full"
  }, "v11.0")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mt-1"
  }, "May C & Finch T (2009) \u2022 ", lang === "fr" ? "NoMAD: Finch et al. (2018)" : "NoMAD: Finch et al. (2018)")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-4 bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl border border-emerald-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-emerald-700"
  }, evaluation.globalScore, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Score de normalisation" : "Normalization score")))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, Object.keys(evaluation.constructs || {}).map(function (constructId) {
    var construct = evaluation.constructs[constructId];
    return /*#__PURE__*/React.createElement("div", {
      key: constructId,
      className: "bg-white rounded-xl border shadow-sm overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "p-4 border-b",
      style: {
        backgroundColor: construct.color + '15'
      }
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-center"
    }, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold",
      style: {
        color: construct.color
      }
    }, construct.label), /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xl font-bold",
      style: {
        color: construct.color
      }
    }, construct.score, "%"), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 rounded-full text-xs " + (construct.normalizationLevel === 'normalized' ? 'bg-green-100 text-green-700' : construct.normalizationLevel === 'emerging' ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-500')
    }, construct.normalizationLabel))), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mt-1"
    }, construct.description)), /*#__PURE__*/React.createElement("div", {
      className: "p-4 space-y-3"
    }, (construct.subConstructs || []).map(function (sub) {
      return /*#__PURE__*/React.createElement("div", {
        key: sub.id,
        className: "space-y-1"
      }, /*#__PURE__*/React.createElement("div", {
        className: "flex justify-between items-center"
      }, /*#__PURE__*/React.createElement("label", {
        className: "text-sm font-medium text-gray-700"
      }, sub.name), /*#__PURE__*/React.createElement("span", {
        className: "text-xs text-gray-400"
      }, sub.score, "%")), /*#__PURE__*/React.createElement("input", {
        type: "range",
        min: "0",
        max: "100",
        value: scores[sub.id] || 0,
        onChange: function (e) {
          handleScore(sub.id, e.target.value);
        },
        className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
      }), /*#__PURE__*/React.createElement("p", {
        className: "text-xs text-gray-400"
      }, sub.description));
    })));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500"
  }, "\uD83D\uDCDA ", /*#__PURE__*/React.createElement("strong", null, "Citations:"), " May C & Finch T (2009). ", /*#__PURE__*/React.createElement("em", null, "Implementation Science"), ", 4:29 \u2022 Finch TL et al. (2018). ", /*#__PURE__*/React.createElement("em", null, "BMC Medical Research Methodology"), ", 18:133 \u2022 Generated by MOUDAR\xAE v11.0")));
}

// ============================================
// v11.0: FRAME TRACKER VIEW â€” Adaptation Documentation (Stirman 2019)
// ============================================
function FRAMETrackerView(props) {
  var lang = props.lang || 'fr';
  var project = props.project;
  var adaptationsState = React.useState([]);
  var adaptations = adaptationsState[0];
  var setAdaptations = adaptationsState[1];
  var showFormState = React.useState(false);
  var showForm = showFormState[0];
  var setShowForm = showFormState[1];
  var formState = React.useState({
    what: '',
    whom: '',
    level: '',
    type: '',
    reason: '',
    fidelityImpact: 'uncertain',
    description: '',
    justification: ''
  });
  var form = formState[0];
  var setForm = formState[1];
  var fidelityAnalysis = FRAMETracker.analyzeFidelity(adaptations, lang);
  var handleSubmit = function () {
    var newAdaptation = FRAMETracker.createAdaptation(form);
    setAdaptations(adaptations.concat([newAdaptation]));
    setForm({
      what: '',
      whom: '',
      level: '',
      type: '',
      reason: '',
      fidelityImpact: 'uncertain',
      description: '',
      justification: ''
    });
    setShowForm(false);
  };
  var handleFormChange = function (field, value) {
    var newForm = Object.assign({}, form);
    newForm[field] = value;
    setForm(newForm);
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "max-w-6xl mx-auto p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6 flex items-center justify-between"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDD04 ", lang === "fr" ? "Suivi des Adaptations (FRAME)" : "Adaptation Tracker (FRAME)", /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-orange-100 text-orange-700 text-xs rounded-full"
  }, "v11.0")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mt-1"
  }, "Stirman SW et al. (2019) \u2022 Implementation Science, 14:58")), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setShowForm(!showForm);
    },
    className: "px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm"
  }, "\u2795 ", lang === "fr" ? "Documenter une adaptation" : "Document an adaptation")), /*#__PURE__*/React.createElement("div", {
    className: "p-6 rounded-2xl border mb-6 " + (fidelityAnalysis.risk === 'high' ? 'bg-red-50 border-red-200' : fidelityAnalysis.risk === 'moderate' ? 'bg-yellow-50 border-yellow-200' : 'bg-green-50 border-green-200')
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center justify-between"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold"
  }, fidelityAnalysis.score, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-sm font-medium"
  }, lang === "fr" ? "Score de fidÃ©litÃ©" : "Fidelity score"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, fidelityAnalysis.label)), /*#__PURE__*/React.createElement("div", {
    className: "text-right text-sm text-gray-600"
  }, /*#__PURE__*/React.createElement("div", null, adaptations.length, " ", lang === "fr" ? "adaptations documentÃ©es" : "adaptations documented"), fidelityAnalysis.coreModified > 0 && /*#__PURE__*/React.createElement("div", {
    className: "text-red-600"
  }, "\u26A0\uFE0F ", fidelityAnalysis.coreModified, " ", lang === "fr" ? "composantes essentielles modifiÃ©es" : "core components modified")))), showForm && /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-6 bg-white rounded-xl border shadow-sm"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold mb-4"
  }, lang === "fr" ? "Nouvelle adaptation" : "New adaptation"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4"
  }, Object.keys(FRAMETracker.dimensions).map(function (dimId) {
    var dim = FRAMETracker.dimensions[dimId];
    return /*#__PURE__*/React.createElement("div", {
      key: dimId
    }, /*#__PURE__*/React.createElement("label", {
      className: "text-sm font-medium text-gray-700 block mb-1"
    }, dim.label[lang]), /*#__PURE__*/React.createElement("select", {
      value: form[dimId] || '',
      onChange: function (e) {
        handleFormChange(dimId, e.target.value);
      },
      className: "w-full p-2 border rounded-lg text-sm"
    }, /*#__PURE__*/React.createElement("option", {
      value: ""
    }, "--"), dim.options.map(function (opt) {
      return /*#__PURE__*/React.createElement("option", {
        key: opt.id,
        value: opt.id
      }, opt.label[lang]);
    })));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 grid md:grid-cols-2 gap-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-sm font-medium text-gray-700 block mb-1"
  }, lang === "fr" ? "Description" : "Description"), /*#__PURE__*/React.createElement("textarea", {
    value: form.description,
    onChange: function (e) {
      handleFormChange('description', e.target.value);
    },
    className: "w-full p-2 border rounded-lg text-sm",
    rows: "3"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-sm font-medium text-gray-700 block mb-1"
  }, lang === "fr" ? "Justification" : "Justification"), /*#__PURE__*/React.createElement("textarea", {
    value: form.justification,
    onChange: function (e) {
      handleFormChange('justification', e.target.value);
    },
    className: "w-full p-2 border rounded-lg text-sm",
    rows: "3"
  }))), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex justify-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: handleSubmit,
    className: "px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm"
  }, "\u2705 ", lang === "fr" ? "Enregistrer" : "Save"))), adaptations.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, adaptations.map(function (a, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: a.id,
      className: "p-4 bg-white rounded-xl border hover:shadow-sm"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex gap-2 flex-wrap"
    }, a.what && /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 bg-blue-100 text-blue-700 text-xs rounded"
    }, a.what), a.type && /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 bg-purple-100 text-purple-700 text-xs rounded"
    }, a.type), a.reason && /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 bg-orange-100 text-orange-700 text-xs rounded"
    }, a.reason)), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 text-xs rounded " + (a.fidelityImpact === 'core_modified' ? 'bg-red-100 text-red-700' : a.fidelityImpact === 'core_preserved' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-500')
    }, a.fidelityImpact)), a.description && /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-gray-600 mt-2"
    }, a.description), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-400 mt-2"
    }, new Date(a.timestamp).toLocaleDateString()));
  })), adaptations.length === 0 && !showForm && /*#__PURE__*/React.createElement("div", {
    className: "text-center p-12 bg-white rounded-xl border"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-4"
  }, "\uD83D\uDD04"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500"
  }, lang === "fr" ? "Aucune adaptation documentÃ©e. Utilisez le bouton ci-dessus pour commencer." : "No adaptations documented. Use the button above to start.")), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500"
  }, "\uD83D\uDCDA ", /*#__PURE__*/React.createElement("strong", null, "Citation:"), " Stirman SW, Baumann AA, Miller CJ (2019). ", /*#__PURE__*/React.createElement("em", null, "Implementation Science"), ", 14:58 \u2022 Generated by MOUDAR\xAE v11.0")));
}

// ============================================
// v11.0: PROCTOR OUTCOMES VIEW â€” 8 Implementation Outcomes (Proctor 2011)
// ============================================
function ProctorOutcomesView(props) {
  var lang = props.lang || 'fr';
  var project = props.project;
  var scoresState = React.useState({});
  var scores = scoresState[0];
  var setScores = scoresState[1];
  var evaluation = ImplementationOutcomes.evaluate(scores, lang);
  var handleScore = function (outcomeId, value) {
    var newScores = Object.assign({}, scores);
    newScores[outcomeId] = parseInt(value) || 0;
    setScores(newScores);
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "max-w-6xl mx-auto p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6 flex items-center justify-between"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83C\uDFAF ", lang === "fr" ? "Outcomes d'ImplÃ©mentation (Proctor)" : "Implementation Outcomes (Proctor)", /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-indigo-100 text-indigo-700 text-xs rounded-full"
  }, "v11.0")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mt-1"
  }, "Proctor E et al. (2011) \u2022 Admin & Policy in Mental Health, 38:65-76")), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-4 bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl border border-indigo-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-indigo-700"
  }, evaluation.globalScore, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, lang === "fr" ? "Score global outcomes" : "Global outcomes score"))), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-6 p-4 bg-amber-50 rounded-xl border border-amber-200"
  }, "\uD83D\uDCA1 ", lang === "fr" ? "La taxonomie de Proctor distingue 3 niveaux d'outcomes: ImplÃ©mentation (ci-dessous), Cliniques (santÃ© des patients), et Service (qualitÃ©, efficience). Ã‰valuez chaque outcome d'implÃ©mentation sur 100." : "Proctor's taxonomy distinguishes 3 outcome levels: Implementation (below), Clinical (patient health), and Service (quality, efficiency). Rate each implementation outcome out of 100."), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4"
  }, Object.keys(evaluation.outcomes || {}).map(function (outcomeId) {
    var outcome = evaluation.outcomes[outcomeId];
    return /*#__PURE__*/React.createElement("div", {
      key: outcomeId,
      className: "bg-white rounded-xl border shadow-sm overflow-hidden"
    }, /*#__PURE__*/React.createElement("div", {
      className: "p-4 border-b flex justify-between items-center",
      style: {
        backgroundColor: outcome.color + '10',
        borderColor: outcome.color + '30'
      }
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
      className: "font-bold",
      style: {
        color: outcome.color
      }
    }, outcome.label), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mt-1"
    }, outcome.definition)), /*#__PURE__*/React.createElement("div", {
      className: "text-right"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl font-bold",
      style: {
        color: outcome.color
      }
    }, outcome.score, "%"), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 rounded-full text-xs " + (outcome.status === 'strong' ? 'bg-green-100 text-green-700' : outcome.status === 'moderate' ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-500')
    }, outcome.status === 'strong' ? 'âœ“' : outcome.status === 'moderate' ? '~' : 'âœ—'))), /*#__PURE__*/React.createElement("div", {
      className: "p-4"
    }, /*#__PURE__*/React.createElement("input", {
      type: "range",
      min: "0",
      max: "100",
      value: scores[outcomeId] || 0,
      onChange: function (e) {
        handleScore(outcomeId, e.target.value);
      },
      className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mb-2"
    }), /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between text-xs text-gray-400"
    }, /*#__PURE__*/React.createElement("span", null, lang === "fr" ? "Instruments:" : "Instruments:"), /*#__PURE__*/React.createElement("span", null, (outcome.instruments || []).join(', '))), outcome.cfirLink && outcome.cfirLink.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-blue-500 mt-1"
    }, "CFIR: ", outcome.cfirLink.join(', '))));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500"
  }, "\uD83D\uDCDA ", /*#__PURE__*/React.createElement("strong", null, "Citations:"), " Proctor E et al. (2011). ", /*#__PURE__*/React.createElement("em", null, "Admin & Policy in Mental Health"), ", 38:65-76 \u2022 Weiner BJ et al. (2017). ", /*#__PURE__*/React.createElement("em", null, "Implementation Science"), ", 12:108 (AIM/IAM/FIM) \u2022 Generated by MOUDAR\xAE v11.0")));
}

// ============================================
// v11.0: SMART DESIGN VIEW â€” Sequential Multiple Assignment Randomized Trial
// Almirall D et al. (2014) â€¢ Kilbourne AM et al. (2018)
// ============================================
function SMARTDesignView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };

  // State
  var templateState = React.useState('twoStage');
  var template = templateState[0];
  var setTemplate = templateState[1];
  var metricState = React.useState('adoption');
  var metric = metricState[0];
  var setMetric = metricState[1];
  var thresholdState = React.useState(60);
  var threshold = thresholdState[0];
  var setThreshold = thresholdState[1];
  var arm1LabelState = React.useState(t('Formation standard', 'Standard training'));
  var arm1Label = arm1LabelState[0];
  var setArm1Label = arm1LabelState[1];
  var arm1StratState = React.useState('S01');
  var arm1Strat = arm1StratState[0];
  var setArm1Strat = arm1StratState[1];
  var arm2LabelState = React.useState(t('Formation + Champions', 'Training + Champions'));
  var arm2Label = arm2LabelState[0];
  var setArm2Label = arm2LabelState[1];
  var arm2StratState = React.useState('S01+S04');
  var arm2Strat = arm2StratState[0];
  var setArm2Strat = arm2StratState[1];
  var simResultState = React.useState(null);
  var simResult = simResultState[0];
  var setSimResult = simResultState[1];
  var designState = React.useState(null);
  var design = designState[0];
  var setDesign = designState[1];
  var sampleSizeState = React.useState(null);
  var sampleSize = sampleSizeState[0];
  var setSampleSize = sampleSizeState[1];
  var effectSizeState = React.useState(0.30);
  var effectSize = effectSizeState[0];
  var setEffectSize = effectSizeState[1];
  var respRateState = React.useState(0.50);
  var respRate = respRateState[0];
  var setRespRate = respRateState[1];
  var activeTabState = React.useState('design');
  var activeTab = activeTabState[0];
  var setActiveTab = activeTabState[1];

  // Build and run design
  function handleBuildDesign() {
    var d = SMARTDesigner.createDesign({
      template: template,
      responseMetric: metric,
      threshold: parseInt(threshold),
      projectName: t('Mon projet SMART', 'My SMART project'),
      stage1Arms: [{
        id: 'A',
        strategy: arm1Strat,
        label: {
          fr: arm1Label,
          en: arm1Label
        },
        intensity: 'standard'
      }, {
        id: 'B',
        strategy: arm2Strat,
        label: {
          fr: arm2Label,
          en: arm2Label
        },
        intensity: 'enhanced'
      }]
    });
    d.decisionRules = SMARTDesigner.generateDecisionRules(d);
    setDesign(d);
    setSimResult(null);
    setSampleSize(null);
  }
  function handleSimulate() {
    if (!design) return;
    var res = SMARTDesigner.simulateOutcomes(design, 1000);
    setSimResult(res);
  }
  function handleSampleSize() {
    var ss = SMARTDesigner.estimateSampleSize(effectSize, respRate, 0.80);
    setSampleSize(ss);
  }
  var respClassifier = SMARTDesigner.responseClassifiers[metric] || SMARTDesigner.responseClassifiers.adoption;
  var tabs = [{
    key: 'design',
    label: t('ðŸ“ Design', 'ðŸ“ Design')
  }, {
    key: 'flowchart',
    label: t('ðŸ”€ Flowchart', 'ðŸ”€ Flowchart')
  }, {
    key: 'rules',
    label: t('ðŸ“‹ RÃ¨gles', 'ðŸ“‹ Rules')
  }, {
    key: 'simulate',
    label: t('ðŸŽ² Simulation', 'ðŸŽ² Simulation')
  }, {
    key: 'sample',
    label: t('ðŸ“Š Taille Ã©chantillon', 'ðŸ“Š Sample Size')
  }];
  return /*#__PURE__*/React.createElement("div", {
    className: "max-w-6xl mx-auto p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDD00 ", t('Design Adaptatif SMART', 'SMART Adaptive Design'), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-purple-100 text-purple-700 text-xs rounded-full"
  }, "v11.0")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mt-1"
  }, "Almirall D et al. (2014) \u2022 Kilbourne AM et al. (2018) \u2022 ", t('Premier outil mondial de design SMART pour la Science de l\'ImplÃ©mentation', 'World\'s first SMART design tool for Implementation Science'))), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-1 mb-6 bg-gray-100 p-1 rounded-xl overflow-x-auto"
  }, tabs.map(function (tab) {
    return /*#__PURE__*/React.createElement("button", {
      key: tab.key,
      onClick: function () {
        setActiveTab(tab.key);
      },
      className: "px-4 py-2 rounded-lg text-sm font-medium transition-all whitespace-nowrap " + (activeTab === tab.key ? "bg-white shadow text-purple-700" : "text-gray-600 hover:bg-gray-200")
    }, tab.label);
  })), activeTab === 'design' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-5 bg-purple-50 rounded-xl border border-purple-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-purple-800 mb-1"
  }, t('Qu\'est-ce qu\'un SMART ?', 'What is a SMART design?')), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, t('Un SMART (Sequential Multiple Assignment Randomized Trial) est un design expÃ©rimental qui permet d\'identifier la meilleure sÃ©quence de stratÃ©gies d\'implÃ©mentation en adaptant dynamiquement selon la rÃ©ponse des participants. Il produit des DTR (Dynamic Treatment Regimens) â€” des Â« recettes Â» sÃ©quentielles optimales.', 'A SMART (Sequential Multiple Assignment Randomized Trial) is an experimental design that identifies the best sequence of implementation strategies by dynamically adapting based on participant response. It produces DTRs (Dynamic Treatment Regimens) â€” optimal sequential "recipes".'))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-4"
  }, Object.keys(SMARTDesigner.templates).map(function (tplId) {
    var tpl = SMARTDesigner.templates[tplId];
    return /*#__PURE__*/React.createElement("div", {
      key: tplId,
      onClick: function () {
        setTemplate(tplId);
      },
      className: "p-4 rounded-xl border-2 cursor-pointer transition-all " + (template === tplId ? "border-purple-500 bg-purple-50 shadow-lg" : "border-gray-200 hover:border-purple-300")
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-2"
    }, tpl.icon), /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-gray-800"
    }, tpl.label[lang]), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mt-1"
    }, tpl.description[lang]), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-purple-600 mt-2 inline-block"
    }, tpl.stages, " ", t('Ã©tapes', 'stages')));
  })), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border shadow-sm p-5"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4"
  }, "\uD83D\uDD2C ", t('Configuration des bras', 'Arms configuration')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-blue-50 rounded-lg border border-blue-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-blue-800 text-sm mb-3"
  }, t('Bras A (Standard)', 'Arm A (Standard)')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-xs text-gray-600"
  }, t('LibellÃ©', 'Label')), /*#__PURE__*/React.createElement("input", {
    type: "text",
    value: arm1Label,
    onChange: function (e) {
      setArm1Label(e.target.value);
    },
    className: "w-full p-2 border rounded-lg text-sm mt-1"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-xs text-gray-600"
  }, t('StratÃ©gie(s)', 'Strategy(ies)')), /*#__PURE__*/React.createElement("input", {
    type: "text",
    value: arm1Strat,
    onChange: function (e) {
      setArm1Strat(e.target.value);
    },
    className: "w-full p-2 border rounded-lg text-sm mt-1",
    placeholder: "S01"
  })))), /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-green-50 rounded-lg border border-green-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-green-800 text-sm mb-3"
  }, t('Bras B (RenforcÃ©)', 'Arm B (Enhanced)')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-xs text-gray-600"
  }, t('LibellÃ©', 'Label')), /*#__PURE__*/React.createElement("input", {
    type: "text",
    value: arm2Label,
    onChange: function (e) {
      setArm2Label(e.target.value);
    },
    className: "w-full p-2 border rounded-lg text-sm mt-1"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-xs text-gray-600"
  }, t('StratÃ©gie(s)', 'Strategy(ies)')), /*#__PURE__*/React.createElement("input", {
    type: "text",
    value: arm2Strat,
    onChange: function (e) {
      setArm2Strat(e.target.value);
    },
    className: "w-full p-2 border rounded-lg text-sm mt-1",
    placeholder: "S01+S04"
  }))))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-amber-50 rounded-lg border border-amber-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-amber-800 text-sm mb-3"
  }, "\u2696\uFE0F ", t('Point de dÃ©cision', 'Decision point')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-xs text-gray-600"
  }, t('MÃ©trique de rÃ©ponse', 'Response metric')), /*#__PURE__*/React.createElement("select", {
    value: metric,
    onChange: function (e) {
      setMetric(e.target.value);
      setThreshold(SMARTDesigner.responseClassifiers[e.target.value].responderThreshold);
    },
    className: "w-full p-2 border rounded-lg text-sm mt-1"
  }, Object.keys(SMARTDesigner.responseClassifiers).map(function (rc) {
    var cl = SMARTDesigner.responseClassifiers[rc];
    return /*#__PURE__*/React.createElement("option", {
      key: rc,
      value: rc
    }, cl.label[lang], " (", cl.unit, ")");
  }))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-xs text-gray-600"
  }, t('Seuil de rÃ©ponse', 'Responder threshold'), ": ", /*#__PURE__*/React.createElement("strong", null, threshold, respClassifier.unit)), /*#__PURE__*/React.createElement("input", {
    type: "range",
    min: metric === 'satisfaction' ? 1 : 20,
    max: metric === 'satisfaction' ? 5 : 90,
    step: metric === 'satisfaction' ? 0.5 : 5,
    value: threshold,
    onChange: function (e) {
      setThreshold(parseFloat(e.target.value));
    },
    className: "w-full mt-2"
  }), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between text-xs text-gray-400 mt-1"
  }, /*#__PURE__*/React.createElement("span", null, t('Ã‰valuation:', 'Assessment:'), " ", respClassifier.timing[lang]), /*#__PURE__*/React.createElement("span", null, "CFIR: ", respClassifier.cfirLink.join(', ')))))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 flex justify-center"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: handleBuildDesign,
    className: "px-8 py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 shadow-lg transition-all hover:scale-105"
  }, "\uD83D\uDD28 ", t('Construire le design SMART', 'Build SMART design'))))), activeTab === 'flowchart' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, !design && /*#__PURE__*/React.createElement("div", {
    className: "text-center p-12 bg-white rounded-xl border"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-4"
  }, "\uD83D\uDCD0"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500"
  }, t('Construisez d\'abord le design dans l\'onglet Design', 'Build the design first in the Design tab'))), design && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border shadow-sm p-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-6 text-center"
  }, t('Diagramme SMART', 'SMART Flowchart'), " \u2014 ", design.template.label[lang]), /*#__PURE__*/React.createElement("div", {
    className: "relative"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-center mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "px-6 py-3 bg-gray-800 text-white rounded-xl font-bold text-center"
  }, "R ", t('Randomisation', 'Randomization'), /*#__PURE__*/React.createElement("div", {
    className: "text-xs font-normal mt-1"
  }, "N = ?"))), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-center gap-4 mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center text-gray-400 text-2xl"
  }, "\u2199"), /*#__PURE__*/React.createElement("div", {
    className: "w-16"
  }), /*#__PURE__*/React.createElement("div", {
    className: "text-center text-gray-400 text-2xl"
  }, "\u2198")), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 gap-8 mb-4"
  }, design.stage1.arms.map(function (arm) {
    var armColor = arm.id === 'A' ? 'blue' : 'green';
    return /*#__PURE__*/React.createElement("div", {
      key: arm.id,
      className: "p-4 rounded-xl border-2 text-center border-" + armColor + "-300 bg-" + armColor + "-50"
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-" + armColor + "-800 text-lg"
    }, t('Bras', 'Arm'), " ", arm.id), /*#__PURE__*/React.createElement("div", {
      className: "text-sm text-gray-600 mt-1"
    }, arm.label[lang]), /*#__PURE__*/React.createElement("div", {
      className: "text-xs mt-2 text-" + armColor + "-600"
    }, "\uD83D\uDCCB ", arm.strategy, " \u2022 ", design.stage1.duration, " ", t('semaines', 'weeks')));
  })), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-center my-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "px-8 py-4 bg-amber-100 border-2 border-amber-400 rounded-2xl text-center",
    style: {
      transform: 'rotate(0deg)'
    }
  }, /*#__PURE__*/React.createElement("div", {
    className: "font-bold text-amber-800"
  }, "\u2696\uFE0F ", t('Point de dÃ©cision', 'Decision Point')), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600 mt-1"
  }, design.decisionPoint.metric.label[lang], " ", design.decisionPoint.threshold, design.decisionPoint.metric.unit), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500 mt-1"
  }, t('Ã‰valuation Ã ', 'Assessment at'), " ", design.decisionPoint.timing[lang]))), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-2 gap-8 mb-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "inline-block px-4 py-2 bg-green-100 text-green-800 rounded-full text-sm font-bold mb-3"
  }, "\u2705 ", t('RÃ©pondeur', 'Responder'), " (\u2265", threshold, respClassifier.unit, ")"), /*#__PURE__*/React.createElement("div", {
    className: "grid gap-2"
  }, design.stage2.responderPaths.map(function (path) {
    return /*#__PURE__*/React.createElement("div", {
      key: path.id,
      className: "p-3 bg-green-50 rounded-lg border border-green-200 text-sm"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-green-700"
    }, path.id, ": ", path.label[lang]));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "inline-block px-4 py-2 bg-red-100 text-red-800 rounded-full text-sm font-bold mb-3"
  }, "\u274C ", t('Non-rÃ©pondeur', 'Non-responder'), " (<", threshold, respClassifier.unit, ")"), /*#__PURE__*/React.createElement("div", {
    className: "grid gap-2"
  }, design.stage2.nonResponderPaths.map(function (path) {
    return /*#__PURE__*/React.createElement("div", {
      key: path.id,
      className: "p-3 bg-red-50 rounded-lg border border-red-200 text-sm"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-red-700"
    }, path.id, ": ", path.label[lang]), path.additionalStrategies && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500 mt-1"
    }, "+ ", path.additionalStrategies.join(', ')), path.newStrategy && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500 mt-1"
    }, "\u2192 ", path.newStrategy));
  })))), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-center mt-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "px-4 py-2 bg-gray-100 rounded-lg text-sm text-gray-600"
  }, t('Ã‰tape 2:', 'Stage 2:'), " ", design.stage2.duration, " ", t('semaines supplÃ©mentaires', 'additional weeks'), " \u2192 ", t('Ã‰valuation finale', 'Final assessment'))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-purple-50 rounded-xl border border-purple-200 text-center"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-3xl font-bold text-purple-700"
  }, design.stage1.arms.length * design.stage2.responderPaths.length * design.stage2.nonResponderPaths.length), /*#__PURE__*/React.createElement("span", {
    className: "text-gray-600 ml-2"
  }, t('DTR (Dynamic Treatment Regimens) intÃ©grÃ©s dans ce design', 'embedded DTRs (Dynamic Treatment Regimens) in this design')))))), activeTab === 'rules' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, !design && /*#__PURE__*/React.createElement("div", {
    className: "text-center p-12 bg-white rounded-xl border"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-4"
  }, "\uD83D\uDCCB"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500"
  }, t('Construisez d\'abord le design', 'Build the design first'))), design && design.decisionRules.map(function (rule, i) {
    var isResponder = rule.condition.response === 'responder';
    return /*#__PURE__*/React.createElement("div", {
      key: rule.id,
      className: "p-4 rounded-xl border-l-4 bg-white shadow-sm " + (isResponder ? "border-green-500" : "border-red-500")
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-start justify-between"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
      className: "font-mono text-sm font-bold text-gray-800"
    }, rule.label), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500 mt-2 flex gap-3"
    }, /*#__PURE__*/React.createElement("span", null, t('Bras:', 'Arm:'), " ", /*#__PURE__*/React.createElement("strong", null, rule.condition.arm)), /*#__PURE__*/React.createElement("span", null, t('RÃ©ponse:', 'Response:'), " ", /*#__PURE__*/React.createElement("strong", {
      className: isResponder ? "text-green-600" : "text-red-600"
    }, rule.condition.response)), /*#__PURE__*/React.createElement("span", null, t('Action:', 'Action:'), " ", /*#__PURE__*/React.createElement("strong", {
      className: "text-purple-600"
    }, rule.action.action)), /*#__PURE__*/React.createElement("span", null, t('IntensitÃ©:', 'Intensity:'), " ", rule.action.intensity))), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-1 rounded text-xs font-bold " + (isResponder ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700")
    }, rule.condition.operator, rule.condition.threshold, rule.condition.unit)));
  }), design && /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-amber-50 rounded-xl border border-amber-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, "\uD83D\uDCA1 ", t('Ces rÃ¨gles de dÃ©cision formalisÃ©es constituent le protocole adaptatif. Elles doivent Ãªtre prÃ©-enregistrÃ©es avant le dÃ©but de l\'essai (ex: clinicaltrials.gov) et respectÃ©es strictement pendant l\'implÃ©mentation.', 'These formalized decision rules constitute the adaptive protocol. They must be pre-registered before the trial begins (e.g., clinicaltrials.gov) and strictly followed during implementation.')))), activeTab === 'simulate' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, !design && /*#__PURE__*/React.createElement("div", {
    className: "text-center p-12 bg-white rounded-xl border"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-4"
  }, "\uD83C\uDFB2"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500"
  }, t('Construisez d\'abord le design', 'Build the design first'))), design && !simResult && /*#__PURE__*/React.createElement("div", {
    className: "text-center p-8 bg-white rounded-xl border"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-4"
  }, "\uD83C\uDFB2"), /*#__PURE__*/React.createElement("p", {
    className: "text-gray-600 mb-4"
  }, t('Simuler 1000 itÃ©rations Monte Carlo pour comparer les DTR', 'Run 1000 Monte Carlo iterations to compare DTRs')), /*#__PURE__*/React.createElement("button", {
    onClick: handleSimulate,
    className: "px-8 py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700 shadow-lg transition-all hover:scale-105"
  }, "\uD83C\uDFB2 ", t('Lancer la simulation', 'Run simulation'))), simResult && /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "p-6 bg-gradient-to-br from-purple-600 to-indigo-700 text-white rounded-2xl shadow-lg mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center justify-between"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xs uppercase tracking-wider opacity-80 mb-1"
  }, "\uD83C\uDFC6 ", t('Meilleur DTR identifiÃ©', 'Best DTR identified')), /*#__PURE__*/React.createElement("div", {
    className: "text-xl font-bold"
  }, lang === 'fr' ? simResult.bestDTR.labelFr : simResult.bestDTR.label)), /*#__PURE__*/React.createElement("div", {
    className: "text-right"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl font-bold"
  }, simResult.bestDTR.mean, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs opacity-80"
  }, t('outcome moyen', 'mean outcome'), " (n=", simResult.simulationCount, ")")))), /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, simResult.embeddedDTRs.map(function (dtr, i) {
    var isFirst = i === 0;
    return /*#__PURE__*/React.createElement("div", {
      key: dtr.id,
      className: "p-4 rounded-xl border shadow-sm " + (isFirst ? "bg-purple-50 border-purple-300" : "bg-white")
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center justify-between mb-3"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, isFirst && /*#__PURE__*/React.createElement("span", {
      className: "text-lg"
    }, "\uD83C\uDFC6"), /*#__PURE__*/React.createElement("span", {
      className: "font-bold text-gray-800"
    }, lang === 'fr' ? dtr.labelFr : dtr.label)), /*#__PURE__*/React.createElement("span", {
      className: "text-xl font-bold " + (isFirst ? "text-purple-700" : "text-gray-600")
    }, dtr.mean, "%")), /*#__PURE__*/React.createElement("div", {
      className: "relative h-8 bg-gray-100 rounded-lg overflow-hidden mb-2"
    }, /*#__PURE__*/React.createElement("div", {
      className: "absolute left-0 top-0 h-full rounded-lg opacity-20",
      style: {
        width: dtr.p75 + '%',
        backgroundColor: isFirst ? '#7c3aed' : '#9ca3af'
      }
    }), /*#__PURE__*/React.createElement("div", {
      className: "absolute left-0 top-0 h-full rounded-lg opacity-40",
      style: {
        width: dtr.median + '%',
        backgroundColor: isFirst ? '#7c3aed' : '#9ca3af'
      }
    }), /*#__PURE__*/React.createElement("div", {
      className: "absolute left-0 top-0 h-full rounded-lg",
      style: {
        width: dtr.mean + '%',
        backgroundColor: isFirst ? '#7c3aed' : '#6b7280',
        opacity: 0.6
      }
    }), /*#__PURE__*/React.createElement("div", {
      className: "absolute top-1 right-2 text-xs text-gray-600"
    }, "P25=", dtr.p25, " | P50=", dtr.median, " | P75=", dtr.p75, " | SD=", dtr.sd)), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-4 text-xs text-gray-500"
    }, /*#__PURE__*/React.createElement("span", null, t('Taux rÃ©pondeurs:', 'Responder rate:'), " ", dtr.responderRate, "%"), /*#__PURE__*/React.createElement("span", null, t('CoÃ»t x', 'Cost x'), dtr.costMultiplier), /*#__PURE__*/React.createElement("span", null, t('Efficience:', 'Efficiency:'), " ", Math.round(dtr.mean / dtr.costMultiplier))));
  })), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex justify-center"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: handleSimulate,
    className: "px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm"
  }, "\uD83D\uDD04 ", t('Relancer (nouvelles donnÃ©es alÃ©atoires)', 'Re-run (new random data)'))))), activeTab === 'sample' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border shadow-sm p-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-4"
  }, "\uD83D\uDCCA ", t('Estimation de la taille d\'Ã©chantillon pour SMART', 'SMART Sample Size Estimation')), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mb-6"
  }, t('Formule simplifiÃ©e d\'Almirall et al. (2014) pour la comparaison de 2 DTR', 'Simplified formula from Almirall et al. (2014) for comparing 2 DTRs')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-6 mb-6"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-sm font-medium text-gray-700 block mb-2"
  }, t('Taille d\'effet attendue (d de Cohen)', 'Expected effect size (Cohen\'s d)')), /*#__PURE__*/React.createElement("input", {
    type: "range",
    min: "0.10",
    max: "0.80",
    step: "0.05",
    value: effectSize,
    onChange: function (e) {
      setEffectSize(parseFloat(e.target.value));
    },
    className: "w-full"
  }), /*#__PURE__*/React.createElement("div", {
    className: "text-center font-bold text-purple-700 mt-1"
  }, effectSize.toFixed(2)), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-400 text-center"
  }, effectSize <= 0.2 ? t('Petit', 'Small') : effectSize <= 0.5 ? t('Moyen', 'Medium') : t('Grand', 'Large'))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-sm font-medium text-gray-700 block mb-2"
  }, t('Taux de rÃ©pondeurs attendu', 'Expected responder rate')), /*#__PURE__*/React.createElement("input", {
    type: "range",
    min: "0.20",
    max: "0.80",
    step: "0.05",
    value: respRate,
    onChange: function (e) {
      setRespRate(parseFloat(e.target.value));
    },
    className: "w-full"
  }), /*#__PURE__*/React.createElement("div", {
    className: "text-center font-bold text-purple-700 mt-1"
  }, Math.round(respRate * 100), "%")), /*#__PURE__*/React.createElement("div", {
    className: "flex items-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: handleSampleSize,
    className: "w-full px-6 py-3 bg-purple-600 text-white rounded-xl font-bold hover:bg-purple-700"
  }, "\uD83D\uDCCA ", t('Calculer', 'Calculate')))), sampleSize && /*#__PURE__*/React.createElement("div", {
    className: "p-6 bg-purple-50 rounded-xl border border-purple-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-center p-4 bg-white rounded-xl shadow"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl font-bold text-purple-700"
  }, sampleSize.totalN), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, t('Taille totale (N)', 'Total sample (N)'))), /*#__PURE__*/React.createElement("div", {
    className: "text-center p-4 bg-white rounded-xl shadow"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl font-bold text-blue-700"
  }, sampleSize.perArm), /*#__PURE__*/React.createElement("div", {
    className: "text-sm text-gray-600"
  }, t('Par bras', 'Per arm')))), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 grid grid-cols-3 gap-3 text-center text-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-white rounded-lg"
  }, /*#__PURE__*/React.createElement("strong", null, "\u03B1"), " = 0.05"), /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-white rounded-lg"
  }, /*#__PURE__*/React.createElement("strong", null, t('Puissance', 'Power')), " = ", Math.round(sampleSize.power * 100), "%"), /*#__PURE__*/React.createElement("div", {
    className: "p-2 bg-white rounded-lg"
  }, /*#__PURE__*/React.createElement("strong", null, "d"), " = ", sampleSize.effectSize)), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-amber-700 mt-4 p-2 bg-amber-50 rounded-lg"
  }, "\u26A0\uFE0F ", sampleSize.note)))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500"
  }, "\uD83D\uDCDA ", /*#__PURE__*/React.createElement("strong", null, "Citations:"), " Almirall D et al. (2014). ", /*#__PURE__*/React.createElement("em", null, "Drug & Alcohol Dependence"), ", 138:36-46 \u2022 Kilbourne AM et al. (2018). ", /*#__PURE__*/React.createElement("em", null, "Implementation Science"), ", 13:31 \u2022 Collins LM et al. (2014). ", /*#__PURE__*/React.createElement("em", null, "Health Psychology"), ", 33(5):465-474 \u2022 Generated by MOUDAR\xAE v11.0")));
}

// ============================================

// ============================================
// v11.0 C1: ONTOLOGY ENGINE VIEW
// Interactive IS knowledge graph explorer
// ============================================

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW D1: CFIR USER GUIDE VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function CFIRUserGuideView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var tabState = React.useState('steps');
  var activeTab = tabState[0];
  var setActiveTab = tabState[1];
  var expandedStep = React.useState(null);
  var expanded = expandedStep[0];
  var setExpanded = expandedStep[1];
  var checkState = React.useState({});
  var checks = checkState[0];
  var setChecks = checkState[1];
  var progress = CFIRUserGuide.assessProgress(checks);
  var tabs = [{
    key: 'steps',
    label: t('5 Ã‰tapes', '5 Steps'),
    icon: 'ðŸ“‹'
  }, {
    key: 'templates',
    label: t('6 Templates', '6 Templates'),
    icon: 'ðŸ“„'
  }, {
    key: 'outcomes',
    label: t('Outcomes Addendum', 'Outcomes Addendum'),
    icon: 'ðŸŽ¯'
  }, {
    key: 'faq',
    label: 'FAQ',
    icon: 'â“'
  }];
  return React.createElement('div', {
    className: 'max-w-6xl mx-auto p-6'
  }, React.createElement('div', {
    className: 'mb-6 flex items-center justify-between'
  }, React.createElement('div', null, React.createElement('h2', {
    className: 'text-2xl font-bold text-gray-800 flex items-center gap-2'
  }, 'ðŸ“– ', t('Guide Utilisateur CFIR 2.0', 'CFIR 2.0 User Guide'), React.createElement('span', {
    className: 'px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded-full'
  }, 'D1 â€” 2025')), React.createElement('p', {
    className: 'text-sm text-gray-500 mt-1'
  }, CFIRUserGuide.citation)), React.createElement('div', {
    className: 'text-center p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl border border-blue-200'
  }, React.createElement('div', {
    className: 'text-3xl font-bold text-blue-700'
  }, progress.overall.percent + '%'), React.createElement('div', {
    className: 'text-xs text-gray-500'
  }, progress.overall.completed + '/' + progress.overall.total + ' ' + t('tÃ¢ches', 'tasks')))), React.createElement('div', {
    className: 'flex gap-2 mb-6 flex-wrap'
  }, tabs.map(function (tab) {
    return React.createElement('button', {
      key: tab.key,
      onClick: function () {
        setActiveTab(tab.key);
      },
      className: 'px-4 py-2 rounded-xl font-medium transition-all ' + (activeTab === tab.key ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg' : 'bg-gray-100 text-gray-600 hover:bg-gray-200')
    }, tab.icon + ' ' + tab.label);
  })), activeTab === 'steps' && React.createElement('div', {
    className: 'space-y-4'
  }, Object.keys(CFIRUserGuide.steps).map(function (stepKey) {
    var step = CFIRUserGuide.steps[stepKey];
    var stepProgress = progress[stepKey] || {
      percent: 0,
      completed: 0,
      total: 0
    };
    return React.createElement('div', {
      key: stepKey,
      className: 'bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm'
    }, React.createElement('div', {
      className: 'p-4 cursor-pointer flex items-center justify-between hover:bg-gray-50',
      onClick: function () {
        setExpanded(expanded === stepKey ? null : stepKey);
      }
    }, React.createElement('div', {
      className: 'flex items-center gap-3'
    }, React.createElement('div', {
      className: 'w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold'
    }, step.number), React.createElement('div', null, React.createElement('h3', {
      className: 'font-semibold text-gray-800'
    }, step.label[lang] || step.label.en), React.createElement('p', {
      className: 'text-sm text-gray-500'
    }, step.description[lang] || step.description.en))), React.createElement('div', {
      className: 'flex items-center gap-3'
    }, React.createElement('div', {
      className: 'w-24 h-2 bg-gray-200 rounded-full'
    }, React.createElement('div', {
      className: 'h-full bg-blue-500 rounded-full',
      style: {
        width: stepProgress.percent + '%'
      }
    })), React.createElement('span', {
      className: 'text-sm font-medium'
    }, stepProgress.percent + '%'), React.createElement('span', {
      className: 'text-lg'
    }, expanded === stepKey ? 'â–¼' : 'â–¶'))), expanded === stepKey && React.createElement('div', {
      className: 'p-4 pt-0 space-y-3 border-t border-gray-100'
    }, step.tasks.map(function (task) {
      return React.createElement('div', {
        key: task.id,
        className: 'flex items-start gap-3 p-3 rounded-xl ' + (checks[task.id] ? 'bg-green-50 border border-green-200' : 'bg-gray-50')
      }, React.createElement('input', {
        type: 'checkbox',
        checked: !!checks[task.id],
        onChange: function () {
          var nc = Object.assign({}, checks);
          nc[task.id] = !nc[task.id];
          setChecks(nc);
        },
        className: 'mt-1 h-5 w-5 text-blue-600'
      }), React.createElement('div', null, React.createElement('p', {
        className: 'font-medium text-gray-800'
      }, task.task[lang] || task.task.en), React.createElement('p', {
        className: 'text-sm text-gray-500 mt-1'
      }, 'ðŸ’¡ ' + (task.guidance[lang] || task.guidance.en))));
    })));
  })), activeTab === 'templates' && React.createElement('div', {
    className: 'grid grid-cols-1 md:grid-cols-2 gap-4'
  }, Object.keys(CFIRUserGuide.templates).map(function (tKey) {
    var tmpl = CFIRUserGuide.templates[tKey];
    var typeColors = {
      interview: 'bg-blue-100 text-blue-700',
      analysis: 'bg-purple-100 text-purple-700',
      interpretation: 'bg-amber-100 text-amber-700',
      reporting: 'bg-green-100 text-green-700'
    };
    return React.createElement('div', {
      key: tKey,
      className: 'p-4 bg-white rounded-2xl border border-gray-200 shadow-sm'
    }, React.createElement('div', {
      className: 'flex items-center justify-between mb-2'
    }, React.createElement('span', {
      className: 'font-bold text-lg text-gray-800'
    }, tmpl.id), React.createElement('span', {
      className: 'px-2 py-1 rounded-lg text-xs font-medium ' + (typeColors[tmpl.type] || 'bg-gray-100')
    }, tmpl.type)), React.createElement('p', {
      className: 'text-sm text-gray-600'
    }, tmpl.label[lang] || tmpl.label.en), React.createElement('p', {
      className: 'text-xs text-gray-400 mt-2'
    }, 'StaRI ref: ' + tmpl.stariRef));
  })), activeTab === 'outcomes' && React.createElement('div', {
    className: 'bg-white rounded-2xl border border-gray-200 p-6'
  }, React.createElement('h3', {
    className: 'text-lg font-bold mb-4'
  }, 'ðŸŽ¯ CFIR Outcomes Addendum'), React.createElement('p', {
    className: 'text-sm text-gray-600 mb-4 p-3 bg-amber-50 rounded-xl border border-amber-200'
  }, CFIRUserGuide.outcomesAddendum.distinction[lang] || CFIRUserGuide.outcomesAddendum.distinction.en), React.createElement('div', {
    className: 'grid grid-cols-1 md:grid-cols-2 gap-4'
  }, React.createElement('div', {
    className: 'p-4 bg-indigo-50 rounded-xl'
  }, React.createElement('h4', {
    className: 'font-bold text-indigo-700 mb-2'
  }, t('Outcomes d\'implÃ©mentation (Proctor)', 'Implementation Outcomes (Proctor)')), CFIRUserGuide.outcomesAddendum.implementationOutcomes.map(function (o) {
    return React.createElement('div', {
      key: o,
      className: 'text-sm py-1'
    }, 'â€¢ ' + o);
  })), React.createElement('div', {
    className: 'p-4 bg-green-50 rounded-xl'
  }, React.createElement('h4', {
    className: 'font-bold text-green-700 mb-2'
  }, t('Outcomes d\'innovation (cliniques)', 'Innovation Outcomes (clinical)')), CFIRUserGuide.outcomesAddendum.innovationOutcomes.map(function (o) {
    return React.createElement('div', {
      key: o,
      className: 'text-sm py-1'
    }, 'â€¢ ' + o);
  })))), activeTab === 'faq' && React.createElement('div', {
    className: 'space-y-3'
  }, CFIRUserGuide.faqs.map(function (faq, i) {
    return React.createElement('div', {
      key: i,
      className: 'p-4 bg-white rounded-2xl border border-gray-200'
    }, React.createElement('h4', {
      className: 'font-bold text-gray-800 mb-2'
    }, 'â“ ' + (faq.q[lang] || faq.q.en)), React.createElement('p', {
      className: 'text-sm text-gray-600'
    }, faq.a[lang] || faq.a.en));
  })));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW D2: PRISM-RE-AIM VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function PRISMView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var tabState = React.useState('context');
  var activeTab = tabState[0];
  var setActiveTab = tabState[1];
  var contextScores = React.useState({});
  var scores = contextScores[0];
  var setScores = contextScores[1];
  var reaimState = React.useState({
    reach: 0,
    effectiveness: 0,
    adoption: 0,
    implementation: 0,
    maintenance: 0
  });
  var reaim = reaimState[0];
  var setReaim = reaimState[1];
  var evaluation = PRISMEvaluator.evaluate(scores, reaim, lang);
  return React.createElement('div', {
    className: 'max-w-6xl mx-auto p-6'
  }, React.createElement('div', {
    className: 'mb-6 flex items-center justify-between'
  }, React.createElement('div', null, React.createElement('h2', {
    className: 'text-2xl font-bold text-gray-800 flex items-center gap-2'
  }, 'ðŸ¥ PRISM + RE-AIM', React.createElement('span', {
    className: 'px-2 py-0.5 bg-emerald-100 text-emerald-700 text-xs rounded-full'
  }, 'D2')), React.createElement('p', {
    className: 'text-sm text-gray-500 mt-1'
  }, PRISMEvaluator.citation + ' | ' + PRISMEvaluator.iPRISMcitation)), React.createElement('div', {
    className: 'text-center p-4 bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl border border-emerald-200'
  }, React.createElement('div', {
    className: 'text-3xl font-bold text-emerald-700'
  }, evaluation.context.globalScore + '%'), React.createElement('div', {
    className: 'text-xs text-gray-500'
  }, evaluation.phase.icon + ' ' + (evaluation.phase.label[lang] || evaluation.phase.label.en)))), React.createElement('div', {
    className: 'flex gap-2 mb-6'
  }, [{
    key: 'context',
    label: t('Contexte PRISM', 'PRISM Context'),
    icon: 'ðŸ—ï¸'
  }, {
    key: 'reaim',
    label: 'RE-AIM',
    icon: 'ðŸ“Š'
  }].map(function (tab) {
    return React.createElement('button', {
      key: tab.key,
      onClick: function () {
        setActiveTab(tab.key);
      },
      className: 'px-5 py-2.5 rounded-xl font-medium transition-all ' + (activeTab === tab.key ? 'bg-gradient-to-r from-emerald-600 to-teal-600 text-white shadow-lg' : 'bg-gray-100 text-gray-600')
    }, tab.icon + ' ' + tab.label);
  })), activeTab === 'context' && React.createElement('div', {
    className: 'space-y-4'
  }, Object.keys(PRISMEvaluator.domains).map(function (domKey) {
    var dom = PRISMEvaluator.domains[domKey];
    return React.createElement('div', {
      key: domKey,
      className: 'bg-white rounded-2xl border border-gray-200 p-4'
    }, React.createElement('h3', {
      className: 'font-bold mb-3 flex items-center gap-2'
    }, React.createElement('span', {
      className: 'w-3 h-3 rounded-full',
      style: {
        backgroundColor: dom.color
      }
    }), dom.label[lang] || dom.label.en), React.createElement('div', {
      className: 'grid grid-cols-1 md:grid-cols-2 gap-3'
    }, dom.items.map(function (item) {
      return React.createElement('div', {
        key: item.id,
        className: 'flex items-center gap-3'
      }, React.createElement('label', {
        className: 'text-sm text-gray-600 flex-1'
      }, item.name[lang] || item.name.en), React.createElement('input', {
        type: 'range',
        min: '0',
        max: '100',
        value: scores[item.id] || 0,
        onChange: function (e) {
          var ns = Object.assign({}, scores);
          ns[item.id] = parseInt(e.target.value);
          setScores(ns);
        },
        className: 'w-32'
      }), React.createElement('span', {
        className: 'text-sm font-bold w-12 text-right'
      }, (scores[item.id] || 0) + '%'));
    })));
  })), activeTab === 'reaim' && React.createElement('div', {
    className: 'space-y-4'
  }, Object.keys(PRISMEvaluator.reaimOutcomes).map(function (dimKey) {
    var dim = PRISMEvaluator.reaimOutcomes[dimKey];
    return React.createElement('div', {
      key: dimKey,
      className: 'bg-white rounded-2xl border border-gray-200 p-4'
    }, React.createElement('div', {
      className: 'flex items-center justify-between mb-2'
    }, React.createElement('h3', {
      className: 'font-bold',
      style: {
        color: dim.color
      }
    }, dim.label[lang] || dim.label.en), React.createElement('span', {
      className: 'text-2xl font-bold'
    }, (reaim[dimKey] || 0) + '%')), React.createElement('input', {
      type: 'range',
      min: '0',
      max: '100',
      value: reaim[dimKey] || 0,
      onChange: function (e) {
        var nr = Object.assign({}, reaim);
        nr[dimKey] = parseInt(e.target.value);
        setReaim(nr);
      },
      className: 'w-full',
      style: {
        accentColor: dim.color
      }
    }), React.createElement('div', {
      className: 'mt-2 space-y-1'
    }, dim.questions.map(function (q, i) {
      return React.createElement('p', {
        key: i,
        className: 'text-xs text-gray-500'
      }, 'â†’ ' + (q[lang] || q.en));
    })));
  }), React.createElement('div', {
    className: 'p-4 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl border border-emerald-200 text-center'
  }, React.createElement('div', {
    className: 'text-2xl font-bold text-emerald-700'
  }, t('Score RE-AIM moyen: ', 'RE-AIM average: ') + evaluation.reaim.average + '%'))));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW D3: IRLM GENERATOR VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function IRLMView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var barriersState = React.useState('');
  var barriers = barriersState[0];
  var setBarriers = barriersState[1];
  var facilitatorsState = React.useState('');
  var facilitators = facilitatorsState[0];
  var setFacilitators = facilitatorsState[1];
  var strategiesState = React.useState('');
  var strategies = strategiesState[0];
  var setStrategies = strategiesState[1];
  var outcomesState = React.useState('');
  var outcomes = outcomesState[0];
  var setOutcomes = outcomesState[1];
  var irlmState = React.useState(null);
  var irlm = irlmState[0];
  var setIrlm = irlmState[1];
  var mermaidCodeState = React.useState('');
  var mermaidCode = mermaidCodeState[0];
  var setMermaidCode = mermaidCodeState[1];
  var renderKeyState = React.useState(0);
  var renderKey = renderKeyState[0];
  var setRenderKey = renderKeyState[1];
  var handleGenerate = function () {
    var pd = {
      title: t('Modele Logique IS', 'IS Logic Model'),
      barriers: barriers.split('\n').filter(function (b) {
        return b.trim();
      }).map(function (b) {
        return {
          text: b.trim()
        };
      }),
      facilitators: facilitators.split('\n').filter(function (f) {
        return f.trim();
      }).map(function (f) {
        return {
          text: f.trim()
        };
      }),
      strategies: strategies.split('\n').filter(function (s) {
        return s.trim();
      }).map(function (s) {
        return {
          name: s.trim()
        };
      }),
      implOutcomes: ['Adoption', 'Fidelity', 'Acceptability', 'Feasibility', 'Sustainability'],
      clinOutcomes: outcomes.split('\n').filter(function (o) {
        return o.trim();
      })
    };
    var generated = IRLMGenerator.generate(pd, lang);
    setIrlm(generated);
    var mCode = IRLMGenerator.generateMermaid(generated, lang);
    setMermaidCode(mCode);
    setRenderKey(renderKey + 1);
  };

  // Render Mermaid after irlm changes
  React.useEffect(function () {
    if (!mermaidCode) return;
    var container = document.getElementById('irlm-mermaid-container');
    if (!container) return;
    container.innerHTML = '';
    var purifyConfig = { USE_PROFILES: { svg: true, svgFilters: true }, ADD_TAGS: ['foreignObject'] };
    if (typeof mermaid !== 'undefined' && mermaid.render) {
      try {
        mermaid.render('irlm-diagram-' + renderKey, mermaidCode).then(function (result) {
          container.innerHTML = DOMPurify.sanitize(result.svg, purifyConfig);
        }).catch(function (err) {
          container.innerHTML = DOMPurify.sanitize('<pre style="background:#fef2f2;padding:12px;border-radius:8px;font-size:12px;color:#991b1b">' + t('Erreur Mermaid: ', 'Mermaid error: ') + err.message + '</pre>');
        });
      } catch (e) {
        container.innerHTML = DOMPurify.sanitize('<pre style="background:#fef2f2;padding:12px;border-radius:8px;font-size:12px;color:#991b1b">' + t('Erreur: ', 'Error: ') + e.message + '</pre>');
      }
    } else {
      container.innerHTML = DOMPurify.sanitize('<pre style="background:#f0fdf4;padding:16px;border-radius:12px;font-size:11px;color:#166534;white-space:pre-wrap;border:1px solid #bbf7d0">' + mermaidCode + '</pre>');
    }
  }, [mermaidCode, renderKey]);
  var handleExportSVG = function () {
    var container = document.getElementById('irlm-mermaid-container');
    if (!container) return;
    var svg = container.querySelector('svg');
    if (!svg) return;
    var svgData = new XMLSerializer().serializeToString(svg);
    var blob = new Blob([svgData], {
      type: 'image/svg+xml;charset=utf-8'
    });
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'IRLM_LogicModel_MOUDAR.svg';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  };
  var handleExportPNG = function () {
    var container = document.getElementById('irlm-mermaid-container');
    if (!container) return;
    var svg = container.querySelector('svg');
    if (!svg) return;
    var svgData = new XMLSerializer().serializeToString(svg);
    var canvas = document.createElement('canvas');
    var ctx = canvas.getContext('2d');
    var img = new Image();
    img.onload = function () {
      canvas.width = img.width * 2;
      canvas.height = img.height * 2;
      ctx.scale(2, 2);
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(img, 0, 0);
      var a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      a.download = 'IRLM_LogicModel_MOUDAR.png';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    };
    img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
  };
  return React.createElement('div', {
    className: 'max-w-6xl mx-auto p-6'
  }, React.createElement('div', {
    className: 'mb-6'
  }, React.createElement('h2', {
    className: 'text-2xl font-bold text-gray-800 flex items-center gap-2'
  }, React.createElement('span', null, 'ðŸ”— '), t('Generateur IRLM', 'IRLM Generator'), React.createElement('span', {
    className: 'px-2 py-0.5 bg-violet-100 text-violet-700 text-xs rounded-full'
  }, 'D3 â€” WORLD FIRST')), React.createElement('p', {
    className: 'text-sm text-gray-500 mt-1'
  }, IRLMGenerator.citation)), React.createElement('div', {
    className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6'
  }, React.createElement('div', null, React.createElement('label', {
    className: 'font-medium text-sm text-gray-700 mb-1 block'
  }, t('Barrieres (une par ligne)', 'Barriers (one per line)')), React.createElement('textarea', {
    value: barriers,
    onChange: function (e) {
      setBarriers(e.target.value);
    },
    rows: 4,
    className: 'w-full p-3 border border-gray-300 rounded-xl text-sm focus:border-violet-400 focus:ring-1 focus:ring-violet-200 focus:outline-none',
    placeholder: t('Manque de formation\nResistance au changement', 'Lack of training\nResistance to change')
  })), React.createElement('div', null, React.createElement('label', {
    className: 'font-medium text-sm text-gray-700 mb-1 block'
  }, t('Facilitateurs', 'Facilitators')), React.createElement('textarea', {
    value: facilitators,
    onChange: function (e) {
      setFacilitators(e.target.value);
    },
    rows: 4,
    className: 'w-full p-3 border border-gray-300 rounded-xl text-sm focus:border-green-400 focus:ring-1 focus:ring-green-200 focus:outline-none',
    placeholder: t('Leadership engage\nCulture apprenante', 'Engaged leadership\nLearning culture')
  })), React.createElement('div', null, React.createElement('label', {
    className: 'font-medium text-sm text-gray-700 mb-1 block'
  }, t('Strategies ERIC', 'ERIC Strategies')), React.createElement('textarea', {
    value: strategies,
    onChange: function (e) {
      setStrategies(e.target.value);
    },
    rows: 4,
    className: 'w-full p-3 border border-gray-300 rounded-xl text-sm focus:border-blue-400 focus:ring-1 focus:ring-blue-200 focus:outline-none',
    placeholder: t('Formation\nChampions\nAudit et Feedback', 'Training\nChampions\nAudit and Feedback')
  })), React.createElement('div', null, React.createElement('label', {
    className: 'font-medium text-sm text-gray-700 mb-1 block'
  }, t('Outcomes cliniques', 'Clinical Outcomes')), React.createElement('textarea', {
    value: outcomes,
    onChange: function (e) {
      setOutcomes(e.target.value);
    },
    rows: 4,
    className: 'w-full p-3 border border-gray-300 rounded-xl text-sm focus:border-red-400 focus:ring-1 focus:ring-red-200 focus:outline-none',
    placeholder: t('Reduction hospitalisations\nQualite de vie', 'Reduced hospitalizations\nQuality of life')
  }))), React.createElement('div', {
    className: 'flex gap-3 mb-6 flex-wrap'
  }, React.createElement('button', {
    onClick: handleGenerate,
    className: 'px-6 py-3 bg-gradient-to-r from-violet-600 to-purple-600 text-white rounded-xl font-medium shadow-lg hover:shadow-xl transition-all'
  }, 'ðŸ”— ' + t('Generer le Modele Logique', 'Generate Logic Model')), irlm && React.createElement('button', {
    onClick: handleExportSVG,
    className: 'px-5 py-3 bg-white border-2 border-violet-300 text-violet-700 rounded-xl font-medium hover:bg-violet-50 transition-all'
  }, 'ðŸ“ ' + t('Export SVG', 'Export SVG')), irlm && React.createElement('button', {
    onClick: handleExportPNG,
    className: 'px-5 py-3 bg-white border-2 border-violet-300 text-violet-700 rounded-xl font-medium hover:bg-violet-50 transition-all'
  }, 'ðŸ–¼ï¸ ' + t('Export PNG (HD)', 'Export PNG (HD)'))), irlm && React.createElement('div', {
    className: 'bg-white rounded-2xl border border-gray-200 overflow-hidden'
  }, React.createElement('div', {
    className: 'p-4 bg-gradient-to-r from-violet-50 to-purple-50 border-b border-gray-200 flex items-center justify-between'
  }, React.createElement('h3', {
    className: 'font-bold text-lg text-violet-800'
  }, 'ðŸ”— ' + irlm.title), React.createElement('span', {
    className: 'text-xs text-gray-500'
  }, t('Diagramme vectoriel Mermaid.js â€” pret pour rapport ministeriel', 'Mermaid.js vector diagram â€” ready for grant reports'))), React.createElement('div', {
    className: 'p-2 text-sm text-gray-500 bg-violet-50 text-center border-b border-gray-100'
  }, irlm.causalChain), React.createElement('div', {
    id: 'irlm-mermaid-container',
    className: 'p-6 overflow-x-auto',
    style: {
      minHeight: '300px'
    }
  }), mermaidCode && React.createElement('details', {
    className: 'border-t border-gray-200'
  }, React.createElement('summary', {
    className: 'p-3 text-xs text-gray-500 cursor-pointer hover:bg-gray-50'
  }, t('Voir le code Mermaid (pour integration externe)', 'View Mermaid code (for external integration)')), React.createElement('pre', {
    className: 'p-4 bg-gray-900 text-green-400 text-xs overflow-x-auto'
  }, mermaidCode))));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW D4: COM-B / TDF DIAGNOSTIC VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function COMBView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var tabState = React.useState('diagnosis');
  var activeTab = tabState[0];
  var setActiveTab = tabState[1];
  var scoresState = React.useState({});
  var scores = scoresState[0];
  var setScores = scoresState[1];
  var result = COMBDiagnostic.diagnose(scores, lang);
  return React.createElement('div', {
    className: 'max-w-6xl mx-auto p-6'
  }, React.createElement('div', {
    className: 'mb-6 flex items-center justify-between'
  }, React.createElement('div', null, React.createElement('h2', {
    className: 'text-2xl font-bold text-gray-800 flex items-center gap-2'
  }, 'ðŸ§  COM-B / TDF', React.createElement('span', {
    className: 'px-2 py-0.5 bg-orange-100 text-orange-700 text-xs rounded-full'
  }, 'D4')), React.createElement('p', {
    className: 'text-sm text-gray-500 mt-1'
  }, COMBDiagnostic.citation + ' | ' + COMBDiagnostic.tdfCitation)), React.createElement('div', {
    className: 'text-center p-4 bg-gradient-to-br from-orange-50 to-amber-50 rounded-2xl border border-orange-200'
  }, React.createElement('div', {
    className: 'text-3xl font-bold text-orange-700'
  }, result.globalScore + '%'), React.createElement('div', {
    className: 'text-xs text-gray-500'
  }, t('Score COM-B global', 'Global COM-B score')))), React.createElement('div', {
    className: 'flex gap-2 mb-6'
  }, [{
    key: 'diagnosis',
    label: 'COM-B',
    icon: 'ðŸ§ '
  }, {
    key: 'tdf',
    label: 'TDF',
    icon: 'ðŸ”'
  }, {
    key: 'bcw',
    label: t('Roue du Changement', 'BCW'),
    icon: 'ðŸŽ¯'
  }].map(function (tab) {
    return React.createElement('button', {
      key: tab.key,
      onClick: function () {
        setActiveTab(tab.key);
      },
      className: 'px-5 py-2.5 rounded-xl font-medium transition-all ' + (activeTab === tab.key ? 'bg-gradient-to-r from-orange-600 to-amber-600 text-white shadow-lg' : 'bg-gray-100 text-gray-600')
    }, tab.icon + ' ' + tab.label);
  })), activeTab === 'diagnosis' && React.createElement('div', {
    className: 'space-y-4'
  }, Object.keys(COMBDiagnostic.comB).map(function (compKey) {
    var comp = COMBDiagnostic.comB[compKey];
    return React.createElement('div', {
      key: compKey,
      className: 'bg-white rounded-2xl border-2 p-4',
      style: {
        borderColor: comp.color
      }
    }, React.createElement('h3', {
      className: 'font-bold text-lg mb-3',
      style: {
        color: comp.color
      }
    }, comp.label[lang] || comp.label.en), React.createElement('div', {
      className: 'grid grid-cols-1 md:grid-cols-2 gap-4'
    }, Object.keys(comp.subComponents).map(function (subKey) {
      var sub = comp.subComponents[subKey];
      return React.createElement('div', {
        key: subKey,
        className: 'p-3 rounded-xl bg-gray-50'
      }, React.createElement('div', {
        className: 'flex items-center justify-between mb-2'
      }, React.createElement('span', {
        className: 'font-medium text-sm'
      }, sub.label[lang] || sub.label.en), React.createElement('span', {
        className: 'font-bold'
      }, (scores[sub.id] || 0) + '%')), React.createElement('p', {
        className: 'text-xs text-gray-500 mb-2'
      }, sub.description[lang] || sub.description.en), React.createElement('input', {
        type: 'range',
        min: '0',
        max: '100',
        value: scores[sub.id] || 0,
        onChange: function (e) {
          var ns = Object.assign({}, scores);
          ns[sub.id] = parseInt(e.target.value);
          setScores(ns);
        },
        className: 'w-full',
        style: {
          accentColor: comp.color
        }
      }));
    })));
  })), activeTab === 'tdf' && React.createElement('div', {
    className: 'space-y-2'
  }, React.createElement('p', {
    className: 'text-sm text-gray-600 mb-4 p-3 bg-amber-50 rounded-xl border border-amber-200'
  }, t('Les 14 domaines TDF opÃ©rationnalisent le COM-B en Ã©valuant en dÃ©tail les dÃ©terminants comportementaux.', 'The 14 TDF domains operationalize COM-B by assessing behavioral determinants in detail.')), COMBDiagnostic.tdfDomains.map(function (tdf) {
    var compLabel = '';
    Object.keys(COMBDiagnostic.comB).forEach(function (ck) {
      Object.keys(COMBDiagnostic.comB[ck].subComponents).forEach(function (sk) {
        if (COMBDiagnostic.comB[ck].subComponents[sk].id === tdf.comB) compLabel = COMBDiagnostic.comB[ck].label[lang] || COMBDiagnostic.comB[ck].label.en;
      });
    });
    return React.createElement('div', {
      key: tdf.id,
      className: 'p-3 bg-white rounded-xl border border-gray-200 flex items-center gap-3'
    }, React.createElement('span', {
      className: 'px-2 py-1 bg-amber-100 text-amber-700 rounded-lg text-xs font-mono font-bold'
    }, tdf.id), React.createElement('div', {
      className: 'flex-1'
    }, React.createElement('span', {
      className: 'font-medium text-sm'
    }, tdf.name[lang] || tdf.name.en), React.createElement('p', {
      className: 'text-xs text-gray-500'
    }, tdf.description[lang] || tdf.description.en)), React.createElement('span', {
      className: 'px-2 py-1 bg-gray-100 text-gray-600 rounded-lg text-xs'
    }, 'â†’ ' + compLabel));
  })), activeTab === 'bcw' && React.createElement('div', {
    className: 'space-y-3'
  }, React.createElement('p', {
    className: 'text-sm text-gray-600 mb-4 p-3 bg-amber-50 rounded-xl border border-amber-200'
  }, t('Les 9 Fonctions d\'Intervention du Behaviour Change Wheel, recommandÃ©es selon les dÃ©ficits COM-B.', 'The 9 Intervention Functions from the Behaviour Change Wheel, recommended based on COM-B deficits.')), Object.keys(COMBDiagnostic.interventionFunctions).map(function (funcKey) {
    var func = COMBDiagnostic.interventionFunctions[funcKey];
    var isRecommended = result.recommendations.some(function (r) {
      return r.function.fr === func.label.fr || r.function.en === func.label.en;
    });
    return React.createElement('div', {
      key: funcKey,
      className: 'p-3 rounded-xl border ' + (isRecommended ? 'bg-green-50 border-green-300' : 'bg-white border-gray-200')
    }, React.createElement('div', {
      className: 'flex items-center justify-between'
    }, React.createElement('span', {
      className: 'font-medium'
    }, func.label[lang] || func.label.en), isRecommended && React.createElement('span', {
      className: 'px-2 py-1 bg-green-200 text-green-800 rounded-lg text-xs font-bold'
    }, 'âœ“ ' + t('RecommandÃ©', 'Recommended'))), React.createElement('p', {
      className: 'text-xs text-gray-500 mt-1'
    }, func.description[lang] || func.description.en), React.createElement('div', {
      className: 'flex gap-1 mt-2'
    }, func.comB.map(function (cId) {
      return React.createElement('span', {
        key: cId,
        className: 'px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-xs'
      }, cId);
    })));
  })));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW D5: HYBRID DESIGN WIZARD VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function HybridDesignView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var answersState = React.useState({
    evidenceLevel: '',
    primaryQuestion: '',
    adoptionConcern: '',
    resources: '',
    ethicalWithhold: ''
  });
  var answers = answersState[0];
  var setAnswers = answersState[1];
  var resultState = React.useState(null);
  var result = resultState[0];
  var setResult = resultState[1];
  var handleRecommend = function () {
    setResult(HybridDesignWizard.recommend(answers, lang));
  };
  var questions = [{
    id: 'evidenceLevel',
    label: t('Niveau de preuve de l\'intervention', 'Intervention evidence level'),
    options: [{
      value: 'preliminary',
      label: t('PrÃ©liminaire (pilote/observationnel)', 'Preliminary (pilot/observational)')
    }, {
      value: 'moderate',
      label: t('ModÃ©rÃ© (1-2 essais)', 'Moderate (1-2 trials)')
    }, {
      value: 'strong',
      label: t('Fort (multiples RCTs, mÃ©ta-analyses)', 'Strong (multiple RCTs, meta-analyses)')
    }]
  }, {
    id: 'primaryQuestion',
    label: t('Question primaire de recherche', 'Primary research question'),
    options: [{
      value: 'effectiveness',
      label: t('L\'intervention est-elle efficace ?', 'Is the intervention effective?')
    }, {
      value: 'both',
      label: t('Les deux (efficacitÃ© + implÃ©mentation)', 'Both (effectiveness + implementation)')
    }, {
      value: 'implementation',
      label: t('Quelle stratÃ©gie d\'implÃ©mentation est la meilleure ?', 'Which implementation strategy is best?')
    }]
  }, {
    id: 'adoptionConcern',
    label: t('PrÃ©occupation concernant l\'adoption', 'Concern about adoption'),
    options: [{
      value: 'low',
      label: t('Faible â€” le contexte est favorable', 'Low â€” context is favorable')
    }, {
      value: 'high',
      label: t('Ã‰levÃ©e â€” rÃ©sistance attendue', 'High â€” resistance expected')
    }]
  }, {
    id: 'resources',
    label: t('Ressources disponibles', 'Available resources'),
    options: [{
      value: 'low',
      label: t('LimitÃ©es', 'Limited')
    }, {
      value: 'high',
      label: t('Substantielles', 'Substantial')
    }]
  }, {
    id: 'ethicalWithhold',
    label: t('Ã‰thiquement difficile de retenir l\'intervention ?', 'Ethically difficult to withhold intervention?'),
    options: [{
      value: 'no',
      label: t('Non â€” l\'intervention peut Ãªtre retenue (Ã©quipoise)', 'No â€” intervention can be withheld (equipoise)')
    }, {
      value: 'yes',
      label: t('Oui â€” Ã©thiquement problÃ©matique de ne pas traiter', 'Yes â€” ethically problematic not to treat')
    }]
  }];
  return React.createElement('div', {
    className: 'max-w-6xl mx-auto p-6'
  }, React.createElement('div', {
    className: 'mb-6'
  }, React.createElement('h2', {
    className: 'text-2xl font-bold text-gray-800 flex items-center gap-2'
  }, 'ðŸ§ª ', t('Design Hybride (Curran)', 'Hybrid Design Wizard (Curran)'), React.createElement('span', {
    className: 'px-2 py-0.5 bg-purple-100 text-purple-700 text-xs rounded-full'
  }, 'D5')), React.createElement('p', {
    className: 'text-sm text-gray-500 mt-1'
  }, HybridDesignWizard.citation)), React.createElement('div', {
    className: 'space-y-4 mb-6'
  }, questions.map(function (q) {
    return React.createElement('div', {
      key: q.id,
      className: 'bg-white rounded-2xl border border-gray-200 p-4'
    }, React.createElement('label', {
      className: 'font-medium text-gray-800 block mb-3'
    }, q.label), React.createElement('div', {
      className: 'flex flex-wrap gap-2'
    }, q.options.map(function (opt) {
      return React.createElement('button', {
        key: opt.value,
        onClick: function () {
          var na = Object.assign({}, answers);
          na[q.id] = opt.value;
          setAnswers(na);
        },
        className: 'px-4 py-2 rounded-xl text-sm transition-all ' + (answers[q.id] === opt.value ? 'bg-purple-600 text-white shadow-lg' : 'bg-gray-100 text-gray-600 hover:bg-gray-200')
      }, opt.label);
    })));
  })), React.createElement('button', {
    onClick: handleRecommend,
    disabled: !answers.evidenceLevel || !answers.primaryQuestion,
    className: 'px-6 py-3 bg-gradient-to-r from-purple-600 to-violet-600 text-white rounded-xl font-medium shadow-lg mb-6 disabled:opacity-50'
  }, 'ðŸ§ª ' + t('Obtenir la recommandation', 'Get Recommendation')), result && React.createElement('div', {
    className: 'bg-white rounded-2xl border-2 p-6',
    style: {
      borderColor: result.type.color
    }
  }, React.createElement('div', {
    className: 'flex items-center gap-3 mb-4'
  }, React.createElement('div', {
    className: 'px-4 py-2 rounded-xl text-white font-bold text-lg',
    style: {
      backgroundColor: result.type.color
    }
  }, result.type.label[lang] || result.type.label.en), React.createElement('span', {
    className: 'px-3 py-1 rounded-lg text-sm font-medium ' + (result.confidence === 'high' ? 'bg-green-100 text-green-700' : result.confidence === 'moderate' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700')
  }, t('Confiance: ', 'Confidence: ') + result.confidence)), React.createElement('p', {
    className: 'text-sm text-gray-700 mb-4'
  }, result.type.focus[lang] || result.type.focus.en), React.createElement('p', {
    className: 'text-sm text-gray-600 mb-4'
  }, result.type.description[lang] || result.type.description.en), React.createElement('div', {
    className: 'grid grid-cols-2 gap-4 mb-4'
  }, React.createElement('div', {
    className: 'p-3 bg-blue-50 rounded-xl'
  }, React.createElement('h4', {
    className: 'font-bold text-sm text-blue-700 mb-2'
  }, t('Mesures cliniques', 'Clinical Measures')), result.type.clinicalMeasures.map(function (m, i) {
    return React.createElement('div', {
      key: i,
      className: 'text-xs py-0.5'
    }, 'â€¢ ' + m);
  })), React.createElement('div', {
    className: 'p-3 bg-purple-50 rounded-xl'
  }, React.createElement('h4', {
    className: 'font-bold text-sm text-purple-700 mb-2'
  }, t('Mesures d\'implÃ©mentation', 'Implementation Measures')), result.type.implementationMeasures.map(function (m, i) {
    return React.createElement('div', {
      key: i,
      className: 'text-xs py-0.5'
    }, 'â€¢ ' + m);
  }))), React.createElement('div', {
    className: 'flex gap-4'
  }, React.createElement('div', {
    className: 'flex-1 text-center p-3 bg-blue-50 rounded-xl'
  }, React.createElement('div', {
    className: 'text-2xl font-bold text-blue-700'
  }, Math.round(result.type.clinicalWeight * 100) + '%'), React.createElement('div', {
    className: 'text-xs text-gray-500'
  }, t('Poids clinique', 'Clinical weight'))), React.createElement('div', {
    className: 'flex-1 text-center p-3 bg-purple-50 rounded-xl'
  }, React.createElement('div', {
    className: 'text-2xl font-bold text-purple-700'
  }, Math.round(result.type.implementationWeight * 100) + '%'), React.createElement('div', {
    className: 'text-xs text-gray-500'
  }, t('Poids implÃ©mentation', 'Implementation weight'))))));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW D6: SUSTAINABILITY VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function SustainabilityView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var tabState = React.useState('psat');
  var activeTab = tabState[0];
  var setActiveTab = tabState[1];
  var psatScoresState = React.useState({});
  var psatScores = psatScoresState[0];
  var setPsatScores = psatScoresState[1];
  var dsfScoresState = React.useState({});
  var dsfScores = dsfScoresState[0];
  var setDsfScores = dsfScoresState[1];
  var evaluation = SustainabilityEngine.evaluate(psatScores, dsfScores, lang);
  return React.createElement('div', {
    className: 'max-w-6xl mx-auto p-6'
  }, React.createElement('div', {
    className: 'mb-6 flex items-center justify-between'
  }, React.createElement('div', null, React.createElement('h2', {
    className: 'text-2xl font-bold text-gray-800 flex items-center gap-2'
  }, 'ðŸŒ± ', t('PÃ©rennisation', 'Sustainability'), React.createElement('span', {
    className: 'px-2 py-0.5 bg-teal-100 text-teal-700 text-xs rounded-full'
  }, 'D6')), React.createElement('p', {
    className: 'text-sm text-gray-500 mt-1'
  }, SustainabilityEngine.psatCitation)), React.createElement('div', {
    className: 'text-center p-4 bg-gradient-to-br from-teal-50 to-green-50 rounded-2xl border border-teal-200'
  }, React.createElement('div', {
    className: 'text-3xl font-bold text-teal-700'
  }, evaluation.sustainabilityIndex + '%'), React.createElement('div', {
    className: 'text-xs text-gray-500'
  }, t('Index de pÃ©rennisation', 'Sustainability Index')))), React.createElement('div', {
    className: 'flex gap-2 mb-6'
  }, [{
    key: 'psat',
    label: 'PSAT',
    icon: 'ðŸ“Š'
  }, {
    key: 'dsf',
    label: 'DSF',
    icon: 'ðŸ”„'
  }, {
    key: 'risks',
    label: t('Risques', 'Risks'),
    icon: 'âš ï¸'
  }].map(function (tab) {
    return React.createElement('button', {
      key: tab.key,
      onClick: function () {
        setActiveTab(tab.key);
      },
      className: 'px-5 py-2.5 rounded-xl font-medium transition-all ' + (activeTab === tab.key ? 'bg-gradient-to-r from-teal-600 to-green-600 text-white shadow-lg' : 'bg-gray-100 text-gray-600')
    }, tab.icon + ' ' + tab.label);
  })), activeTab === 'psat' && React.createElement('div', {
    className: 'grid grid-cols-1 md:grid-cols-2 gap-4'
  }, Object.keys(SustainabilityEngine.psatDomains).map(function (domKey) {
    var dom = SustainabilityEngine.psatDomains[domKey];
    return React.createElement('div', {
      key: domKey,
      className: 'bg-white rounded-2xl border border-gray-200 p-4'
    }, React.createElement('div', {
      className: 'flex items-center justify-between mb-2'
    }, React.createElement('h3', {
      className: 'font-bold text-sm',
      style: {
        color: dom.color
      }
    }, dom.label[lang] || dom.label.en), React.createElement('span', {
      className: 'font-bold text-lg'
    }, (psatScores[domKey] || 0) + '%')), React.createElement('input', {
      type: 'range',
      min: '0',
      max: '100',
      value: psatScores[domKey] || 0,
      onChange: function (e) {
        var ns = Object.assign({}, psatScores);
        ns[domKey] = parseInt(e.target.value);
        setPsatScores(ns);
      },
      className: 'w-full mb-2',
      style: {
        accentColor: dom.color
      }
    }), dom.items.map(function (item, i) {
      return React.createElement('p', {
        key: i,
        className: 'text-xs text-gray-500'
      }, 'â€¢ ' + (item[lang] || item.en));
    }));
  })), activeTab === 'dsf' && React.createElement('div', {
    className: 'space-y-4'
  }, React.createElement('p', {
    className: 'text-sm text-gray-600 p-3 bg-teal-50 rounded-xl border border-teal-200'
  }, t('Dynamic Sustainability Framework (Chambers 2013): la pÃ©rennisation est un processus dynamique, pas un point final.', 'Dynamic Sustainability Framework (Chambers 2013): sustainability is a dynamic process, not an endpoint.')), Object.keys(SustainabilityEngine.dsfDimensions).map(function (dimKey) {
    var dim = SustainabilityEngine.dsfDimensions[dimKey];
    return React.createElement('div', {
      key: dimKey,
      className: 'bg-white rounded-2xl border border-gray-200 p-4'
    }, React.createElement('div', {
      className: 'flex items-center justify-between mb-2'
    }, React.createElement('h3', {
      className: 'font-bold'
    }, dim.label[lang] || dim.label.en), React.createElement('span', {
      className: 'font-bold text-lg'
    }, (dsfScores[dimKey] || 0) + '%')), React.createElement('p', {
      className: 'text-sm text-gray-500 mb-2'
    }, dim.description[lang] || dim.description.en), React.createElement('input', {
      type: 'range',
      min: '0',
      max: '100',
      value: dsfScores[dimKey] || 0,
      onChange: function (e) {
        var ns = Object.assign({}, dsfScores);
        ns[dimKey] = parseInt(e.target.value);
        setDsfScores(ns);
      },
      className: 'w-full'
    }));
  })), activeTab === 'risks' && React.createElement('div', {
    className: 'space-y-3'
  }, evaluation.risks.length === 0 ? React.createElement('div', {
    className: 'p-6 text-center bg-green-50 rounded-2xl border border-green-200'
  }, React.createElement('div', {
    className: 'text-4xl mb-2'
  }, 'âœ…'), React.createElement('p', {
    className: 'font-medium text-green-700'
  }, t('Aucun risque critique dÃ©tectÃ©', 'No critical risks detected'))) : evaluation.risks.map(function (risk, i) {
    return React.createElement('div', {
      key: i,
      className: 'p-4 rounded-2xl border ' + (risk.severity === 'critical' ? 'bg-red-50 border-red-300' : 'bg-amber-50 border-amber-300')
    }, React.createElement('div', {
      className: 'flex items-center gap-2'
    }, React.createElement('span', {
      className: 'text-lg'
    }, risk.severity === 'critical' ? 'ðŸ”´' : 'ðŸŸ '), React.createElement('span', {
      className: 'font-bold'
    }, risk.domain[lang] || risk.domain.en), React.createElement('span', {
      className: 'text-sm'
    }, risk.score + '%')));
  }), evaluation.recommendations.length > 0 && React.createElement('div', {
    className: 'p-4 bg-blue-50 rounded-2xl border border-blue-200 mt-4'
  }, React.createElement('h4', {
    className: 'font-bold text-blue-700 mb-2'
  }, 'ðŸ’¡ ' + t('Recommandations', 'Recommendations')), evaluation.recommendations.map(function (rec, i) {
    return React.createElement('p', {
      key: i,
      className: 'text-sm text-gray-700 py-1'
    }, 'â€¢ ' + rec);
  }))));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIEW D7: QUALITATIVE ASSISTANT VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function QualitativeView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var tabState = React.useState('coding');
  var activeTab = tabState[0];
  var setActiveTab = tabState[1];
  var textState = React.useState('');
  var text = textState[0];
  var setText = textState[1];
  var codesState = React.useState([]);
  var codes = codesState[0];
  var setCodes = codesState[1];
  var handleAutoCode = function () {
    setCodes(QualitativeAssistant.autoCode(text));
  };
  return React.createElement('div', {
    className: 'max-w-6xl mx-auto p-6'
  }, React.createElement('div', {
    className: 'mb-6'
  }, React.createElement('h2', {
    className: 'text-2xl font-bold text-gray-800 flex items-center gap-2'
  }, 'ðŸ“ ', t('Assistant Qualitatif CFIR', 'CFIR Qualitative Assistant'), React.createElement('span', {
    className: 'px-2 py-0.5 bg-rose-100 text-rose-700 text-xs rounded-full'
  }, 'D7')), React.createElement('p', {
    className: 'text-sm text-gray-500 mt-1'
  }, QualitativeAssistant.citation)), React.createElement('div', {
    className: 'flex gap-2 mb-6'
  }, [{
    key: 'coding',
    label: t('Auto-codage', 'Auto-coding'),
    icon: 'ðŸ¤–'
  }, {
    key: 'scheme',
    label: t('SchÃ©ma de codage', 'Coding Scheme'),
    icon: 'ðŸ“‹'
  }, {
    key: 'rating',
    label: t('Ã‰chelle de notation', 'Rating Scale'),
    icon: 'â­'
  }].map(function (tab) {
    return React.createElement('button', {
      key: tab.key,
      onClick: function () {
        setActiveTab(tab.key);
      },
      className: 'px-5 py-2.5 rounded-xl font-medium transition-all ' + (activeTab === tab.key ? 'bg-gradient-to-r from-rose-600 to-pink-600 text-white shadow-lg' : 'bg-gray-100 text-gray-600')
    }, tab.icon + ' ' + tab.label);
  })), activeTab === 'coding' && React.createElement('div', {
    className: 'space-y-4'
  }, React.createElement('div', null, React.createElement('label', {
    className: 'font-medium text-sm text-gray-700 block mb-2'
  }, t('Collez un extrait d\'entretien ou de donnÃ©es qualitatives:', 'Paste an interview excerpt or qualitative data:')), React.createElement('textarea', {
    value: text,
    onChange: function (e) {
      setText(e.target.value);
    },
    rows: 8,
    className: 'w-full p-4 border-2 border-gray-200 rounded-xl text-sm focus:border-rose-400 focus:outline-none',
    placeholder: t('Ex: "Le leadership n\'a pas vraiment soutenu le programme. Les ressources Ã©taient insuffisantes et le personnel manquait de formation. Cependant, les champions locaux ont jouÃ© un rÃ´le crucial dans l\'engagement des Ã©quipes."', 'Ex: "Leadership didn\'t really support the program. Resources were insufficient and staff lacked training. However, local champions played a crucial role in engaging teams."')
  })), React.createElement('button', {
    onClick: handleAutoCode,
    disabled: !text.trim(),
    className: 'px-6 py-3 bg-gradient-to-r from-rose-600 to-pink-600 text-white rounded-xl font-medium shadow-lg disabled:opacity-50'
  }, 'ðŸ¤– ' + t('Auto-coder (NLP)', 'Auto-code (NLP)')), codes.length > 0 && React.createElement('div', {
    className: 'bg-white rounded-2xl border border-gray-200 p-4'
  }, React.createElement('h3', {
    className: 'font-bold mb-3'
  }, 'ðŸ·ï¸ ' + t('Codes CFIR dÃ©tectÃ©s:', 'CFIR codes detected:')), React.createElement('div', {
    className: 'space-y-2'
  }, codes.map(function (code, i) {
    var domColor = '#6b7280';
    Object.keys(QualitativeAssistant.codingScheme).forEach(function (dk) {
      if (QualitativeAssistant.codingScheme[dk].codes.indexOf(code.code) >= 0) domColor = QualitativeAssistant.codingScheme[dk].color;
    });
    return React.createElement('div', {
      key: i,
      className: 'flex items-center gap-3 p-3 rounded-xl bg-gray-50'
    }, React.createElement('span', {
      className: 'px-3 py-1 rounded-lg text-white font-bold text-sm',
      style: {
        backgroundColor: domColor
      }
    }, code.code), React.createElement('span', {
      className: 'px-2 py-1 rounded-lg text-xs font-medium ' + (code.confidence === 'high' ? 'bg-green-100 text-green-700' : code.confidence === 'moderate' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700')
    }, code.confidence), React.createElement('span', {
      className: 'text-sm text-gray-500'
    }, code.matchCount + ' ' + t('mots-clÃ©s trouvÃ©s', 'keywords matched')));
  })))), activeTab === 'scheme' && React.createElement('div', {
    className: 'space-y-4'
  }, Object.keys(QualitativeAssistant.codingScheme).map(function (domKey) {
    var dom = QualitativeAssistant.codingScheme[domKey];
    return React.createElement('div', {
      key: domKey,
      className: 'bg-white rounded-2xl border-l-4 p-4',
      style: {
        borderLeftColor: dom.color
      }
    }, React.createElement('h3', {
      className: 'font-bold mb-2',
      style: {
        color: dom.color
      }
    }, dom.domain[lang] || dom.domain.en), React.createElement('div', {
      className: 'flex flex-wrap gap-2'
    }, dom.codes.map(function (c) {
      return React.createElement('span', {
        key: c,
        className: 'px-3 py-1 rounded-lg text-white text-sm font-mono',
        style: {
          backgroundColor: dom.color
        }
      }, c);
    })));
  })), activeTab === 'rating' && React.createElement('div', {
    className: 'bg-white rounded-2xl border border-gray-200 p-6'
  }, React.createElement('h3', {
    className: 'font-bold mb-4'
  }, t('Ã‰chelle de notation CFIR (User Guide 2025)', 'CFIR Rating Scale (User Guide 2025)')), Object.keys(QualitativeAssistant.ratingScale).map(function (rKey) {
    var r = QualitativeAssistant.ratingScale[rKey];
    return React.createElement('div', {
      key: rKey,
      className: 'flex items-center gap-4 p-3 rounded-xl mb-2',
      style: {
        backgroundColor: r.color + '15'
      }
    }, React.createElement('span', {
      className: 'w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg',
      style: {
        backgroundColor: r.color
      }
    }, rKey), React.createElement('span', {
      className: 'font-medium'
    }, r.label[lang] || r.label.en));
  })));
}
function OntologyView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var activeTabState = React.useState('frameworks');
  var activeTab = activeTabState[0];
  var setActiveTab = activeTabState[1];
  var queryConstructState = React.useState('');
  var queryConstruct = queryConstructState[0];
  var setQueryConstruct = queryConstructState[1];
  var queryResultState = React.useState(null);
  var queryResult = queryResultState[0];
  var setQueryResult = queryResultState[1];
  var selectedFwState = React.useState(null);
  var selectedFw = selectedFwState[0];
  var setSelectedFw = selectedFwState[1];
  var traceFromState = React.useState('IS11');
  var traceFrom = traceFromState[0];
  var setTraceFrom = traceFromState[1];
  var traceToState = React.useState('Adoption');
  var traceTo = traceToState[0];
  var setTraceTo = traceToState[1];
  var traceResultState = React.useState(null);
  var traceResult = traceResultState[0];
  var setTraceResult = traceResultState[1];
  var frameworks = ISOntologyEngine.frameworks;
  var fwArray = Object.values(frameworks);
  var tabs = [{
    key: 'frameworks',
    label: t('ðŸ“š Cadres IS', 'ðŸ“š IS Frameworks')
  }, {
    key: 'relationships',
    label: t('ðŸ”— Relations', 'ðŸ”— Relationships')
  }, {
    key: 'mechanisms',
    label: t('âš™ï¸ MÃ©canismes causaux', 'âš™ï¸ Causal Mechanisms')
  }, {
    key: 'query',
    label: t('ðŸ” RequÃªte', 'ðŸ” Query')
  }, {
    key: 'trace',
    label: t('ðŸ›¤ï¸ TraÃ§abilitÃ©', 'ðŸ›¤ï¸ Traceability')
  }, {
    key: 'export',
    label: t('ðŸ“¤ Export JSON-LD', 'ðŸ“¤ Export JSON-LD')
  }];
  var typeColors = {
    determinant: '#7c3aed',
    evaluation: '#2563eb',
    strategies: '#059669',
    behavioral: '#d97706',
    process: '#dc2626',
    outcomes: '#0891b2',
    adaptation: '#9333ea',
    reporting: '#64748b'
  };
  function handleQuery() {
    if (!queryConstruct.trim()) return;
    setQueryResult(ISOntologyEngine.query({
      construct: queryConstruct.trim()
    }));
  }
  function handleTrace() {
    setTraceResult(ISOntologyEngine.tracePath(traceFrom, traceTo));
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "max-w-6xl mx-auto p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83E\uDDEC ", t('Ontologie de la Science de l\'ImplÃ©mentation', 'Implementation Science Ontology'), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-gradient-to-r from-indigo-100 to-purple-100 text-indigo-700 text-xs rounded-full font-bold"
  }, "v11.0")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mt-1"
  }, t(fwArray.length + ' cadres thÃ©oriques â€¢ ' + ISOntologyEngine.relationships.length + ' relations inter-cadres â€¢ ' + ISOntologyEngine.causalMechanisms.length + ' mÃ©canismes causaux formalisÃ©s', fwArray.length + ' theoretical frameworks â€¢ ' + ISOntologyEngine.relationships.length + ' cross-framework relations â€¢ ' + ISOntologyEngine.causalMechanisms.length + ' formalized causal mechanisms'))), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-1 mb-6 bg-gray-100 p-1 rounded-xl overflow-x-auto"
  }, tabs.map(function (tab) {
    return /*#__PURE__*/React.createElement("button", {
      key: tab.key,
      onClick: function () {
        setActiveTab(tab.key);
      },
      className: "px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap transition-all " + (activeTab === tab.key ? "bg-white shadow text-indigo-700" : "text-gray-600 hover:bg-gray-200")
    }, tab.label);
  })), activeTab === 'frameworks' && /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4"
  }, fwArray.map(function (fw) {
    var color = typeColors[fw.type] || '#6b7280';
    return /*#__PURE__*/React.createElement("div", {
      key: fw.id,
      onClick: function () {
        setSelectedFw(selectedFw === fw.id ? null : fw.id);
      },
      className: "p-5 rounded-xl border-2 cursor-pointer transition-all " + (selectedFw === fw.id ? "shadow-lg" : "hover:shadow-md"),
      style: {
        borderColor: selectedFw === fw.id ? color : '#e5e7eb',
        backgroundColor: selectedFw === fw.id ? color + '08' : 'white'
      }
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start mb-2"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "font-bold text-lg",
      style: {
        color: color
      }
    }, fw.id), /*#__PURE__*/React.createElement("span", {
      className: "text-xs ml-2 px-2 py-0.5 rounded-full",
      style: {
        backgroundColor: color + '20',
        color: color
      }
    }, fw.type)), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-400"
    }, "v", fw.version, " (", fw.year, ")")), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-gray-700 font-medium"
    }, fw.fullName), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500 mt-1"
    }, fw.authors), selectedFw === fw.id && /*#__PURE__*/React.createElement("div", {
      className: "mt-3 pt-3 border-t space-y-1"
    }, /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-600"
    }, "\uD83D\uDCCA ", fw.domains, " ", t('domaines', 'domains'), " \u2022 ", fw.constructs, " ", t('construits', 'constructs')), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-600"
    }, "\uD83D\uDD2C ", t('PortÃ©e:', 'Scope:'), " ", fw.scope), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-blue-600"
    }, "\uD83D\uDD17 DOI: ", fw.doi)));
  })), activeTab === 'relationships' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-indigo-50 rounded-xl border border-indigo-200 mb-4"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-indigo-700 font-medium"
  }, ISOntologyEngine.relationships.length, " ", t('relations ontologiques inter-cadres formalisÃ©es', 'formalized cross-framework ontological relationships'))), ISOntologyEngine.relationships.map(function (rel, i) {
    var typeIcon = {
      maps_to: 'ðŸ”„',
      addressed_by: 'ðŸŽ¯',
      complements: 'ðŸ¤',
      monitored_by: 'ðŸ‘ï¸',
      measures: 'ðŸ“',
      tracked_by: 'ðŸ“‹',
      targets: 'ðŸŽ¯',
      phase_includes: 'ðŸ“¦',
      phase_targets: 'ðŸ',
      operationalizes: 'âš™ï¸',
      reports_on: 'ðŸ“'
    };
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-4 bg-white rounded-xl border flex items-center gap-4"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex-shrink-0 text-center"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-mono text-sm font-bold text-indigo-700 bg-indigo-50 px-2 py-1 rounded"
    }, rel.from)), /*#__PURE__*/React.createElement("div", {
      className: "flex-shrink-0 text-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-lg"
    }, typeIcon[rel.type] || 'â†’'), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-400"
    }, rel.type)), /*#__PURE__*/React.createElement("div", {
      className: "flex-shrink-0 text-center"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-mono text-sm font-bold text-purple-700 bg-purple-50 px-2 py-1 rounded"
    }, rel.to)), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-600 flex-1"
    }, rel.label));
  })), activeTab === 'mechanisms' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-green-50 rounded-xl border border-green-200 mb-2"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-green-700 font-medium"
  }, t('Comment les stratÃ©gies ERIC produisent des rÃ©sultats â€” chaÃ®nes causales formalisÃ©es', 'How ERIC strategies produce outcomes â€” formalized causal chains'))), ISOntologyEngine.causalMechanisms.map(function (m, i) {
    var evColor = m.evidenceLevel === 'strong' ? 'bg-green-100 text-green-700' : m.evidenceLevel === 'moderate' ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700';
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-5 bg-white rounded-xl border shadow-sm"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start mb-3"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "font-bold text-gray-800"
    }, m.strategy), /*#__PURE__*/React.createElement("span", {
      className: "text-xs font-mono ml-2 text-blue-600"
    }, m.ericCode)), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 rounded-full text-xs font-medium " + evColor
    }, m.evidenceLevel)), /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-3 mb-3 p-3 bg-gray-50 rounded-lg"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xs font-mono bg-blue-100 text-blue-700 px-2 py-1 rounded"
    }, m.ericCode), /*#__PURE__*/React.createElement("span", {
      className: "text-gray-400"
    }, "\u2192"), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-700 flex-1 italic"
    }, m.mechanism), /*#__PURE__*/React.createElement("span", {
      className: "text-gray-400"
    }, "\u2192"), /*#__PURE__*/React.createElement("span", {
      className: "text-xs font-bold bg-purple-100 text-purple-700 px-2 py-1 rounded"
    }, m.proctorOutcome)), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-500"
    }, "CFIR:"), m.cfirTargets.map(function (c) {
      return /*#__PURE__*/React.createElement("span", {
        key: c,
        className: "text-xs font-mono bg-indigo-50 text-indigo-600 px-1.5 py-0.5 rounded"
      }, c);
    })));
  })), activeTab === 'query' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDD0D ", t('RequÃªte ontologique', 'Ontology Query')), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-3 mb-4"
  }, /*#__PURE__*/React.createElement("input", {
    value: queryConstruct,
    onChange: function (e) {
      setQueryConstruct(e.target.value);
    },
    placeholder: t('Construit CFIR (ex: IS11, IN4, PR5)', 'CFIR construct (e.g., IS11, IN4, PR5)'),
    className: "flex-1 p-3 border rounded-xl text-sm"
  }), /*#__PURE__*/React.createElement("button", {
    onClick: handleQuery,
    className: "px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700"
  }, "\uD83D\uDD0D")), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 flex-wrap"
  }, ['IS11', 'IN4', 'IC4', 'PR5', 'OS4', 'IN2'].map(function (c) {
    return /*#__PURE__*/React.createElement("button", {
      key: c,
      onClick: function () {
        setQueryConstruct(c);
        var r = ISOntologyEngine.query({
          construct: c
        });
        setQueryResult(r);
      },
      className: "px-3 py-1 bg-indigo-50 text-indigo-700 rounded-lg text-xs hover:bg-indigo-100"
    }, c);
  }))), queryResult && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, queryResult.relationships.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-blue-50 rounded-xl border border-blue-200 p-5"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-blue-800 mb-3"
  }, "\uD83D\uDD17 ", queryResult.relationships.length, " ", t('relations trouvÃ©es', 'relationships found')), queryResult.relationships.map(function (r, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "text-sm text-gray-700 p-2 bg-white rounded-lg mb-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-mono text-indigo-600"
    }, r.from), " \u2192 ", /*#__PURE__*/React.createElement("span", {
      className: "font-mono text-purple-600"
    }, r.to), " ", /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-400"
    }, "(", r.type, ")"));
  })), queryResult.mechanisms.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-green-50 rounded-xl border border-green-200 p-5"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-green-800 mb-3"
  }, "\u2699\uFE0F ", queryResult.mechanisms.length, " ", t('mÃ©canismes causaux', 'causal mechanisms')), queryResult.mechanisms.map(function (m, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "text-sm p-2 bg-white rounded-lg mb-1"
    }, /*#__PURE__*/React.createElement("strong", null, m.strategy), " (", m.ericCode, ") \u2192 ", m.proctorOutcome, " ", /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-400"
    }, "[", m.evidenceLevel, "]"));
  })), queryResult.relationships.length === 0 && queryResult.mechanisms.length === 0 && /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-gray-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, t('Aucun rÃ©sultat pour ce construit', 'No results for this construct'))))), activeTab === 'trace' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDEE4\uFE0F ", t('TraÃ§abilitÃ© Construit â†’ Outcome', 'Construct â†’ Outcome Traceability')), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500 mb-4"
  }, t('Trouvez toutes les chaÃ®nes causales reliant un construit CFIR Ã  un outcome Proctor', 'Find all causal chains linking a CFIR construct to a Proctor outcome')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-3"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-xs font-bold text-gray-600 block mb-1"
  }, "CFIR Construct"), /*#__PURE__*/React.createElement("select", {
    value: traceFrom,
    onChange: function (e) {
      setTraceFrom(e.target.value);
    },
    className: "w-full p-2 border rounded-lg text-sm"
  }, ['IS11', 'IS12', 'IS13', 'IN2', 'IN3', 'IN4', 'IC4', 'IC7', 'OS4', 'PR3', 'PR4', 'PR5', 'IS3', 'IS8'].map(function (c) {
    return /*#__PURE__*/React.createElement("option", {
      key: c,
      value: c
    }, c);
  }))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "text-xs font-bold text-gray-600 block mb-1"
  }, "Proctor Outcome"), /*#__PURE__*/React.createElement("select", {
    value: traceTo,
    onChange: function (e) {
      setTraceTo(e.target.value);
    },
    className: "w-full p-2 border rounded-lg text-sm"
  }, ['Adoption', 'Fidelity', 'Penetration', 'Sustainability', 'Appropriateness', 'Acceptability'].map(function (o) {
    return /*#__PURE__*/React.createElement("option", {
      key: o,
      value: o
    }, o);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "flex items-end"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: handleTrace,
    className: "w-full px-4 py-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700"
  }, "\uD83D\uDEE4\uFE0F ", t('Tracer', 'Trace'))))), traceResult && /*#__PURE__*/React.createElement("div", null, traceResult.length > 0 ? /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, traceResult.map(function (p, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-5 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border border-indigo-200"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-3 mb-3"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-mono bg-indigo-100 text-indigo-700 px-3 py-1 rounded-lg font-bold"
    }, p.construct), /*#__PURE__*/React.createElement("span", {
      className: "text-indigo-400"
    }, "\u2192"), /*#__PURE__*/React.createElement("span", {
      className: "font-bold text-green-700 bg-green-100 px-3 py-1 rounded-lg"
    }, p.strategy, " (", p.ericCode, ")"), /*#__PURE__*/React.createElement("span", {
      className: "text-indigo-400"
    }, "\u2192"), /*#__PURE__*/React.createElement("span", {
      className: "font-bold text-purple-700 bg-purple-100 px-3 py-1 rounded-lg"
    }, p.outcome)), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-gray-600 italic p-2 bg-white rounded-lg"
    }, "\u2699\uFE0F ", p.mechanism), /*#__PURE__*/React.createElement("span", {
      className: "mt-2 inline-block text-xs px-2 py-0.5 rounded " + (p.evidence === 'strong' ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700')
    }, t('Niveau de preuve:', 'Evidence level:'), " ", p.evidence));
  })) : /*#__PURE__*/React.createElement("div", {
    className: "p-6 bg-gray-50 rounded-xl text-center"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-gray-500"
  }, t('Aucune chaÃ®ne causale trouvÃ©e pour cette combinaison', 'No causal chain found for this combination'))))), activeTab === 'export' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDCE4 ", t('Export JSON-LD (Web sÃ©mantique)', 'JSON-LD Export (Semantic Web)')), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500 mb-4"
  }, t('Exportez l\'ontologie IS complÃ¨te au format JSON-LD pour intÃ©gration dans des systÃ¨mes de connaissances.', 'Export complete IS ontology in JSON-LD format for knowledge system integration.')), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      var data = JSON.stringify(ISOntologyEngine.exportJSONLD(), null, 2);
      navigator.clipboard.writeText(data);
    },
    className: "px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700"
  }, "\uD83D\uDCCB ", t('Copier JSON-LD', 'Copy JSON-LD'))), /*#__PURE__*/React.createElement("div", {
    className: "bg-gray-50 rounded-xl border p-4"
  }, /*#__PURE__*/React.createElement("pre", {
    className: "text-xs font-mono text-gray-600 max-h-64 overflow-auto whitespace-pre-wrap"
  }, JSON.stringify(ISOntologyEngine.exportJSONLD(), null, 2).substring(0, 2000), "..."))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500"
  }, "\uD83D\uDCDA ", t('Ontologie construite Ã  partir de:', 'Ontology built from:'), " Damschroder (2022), Glasgow (2019), Powell (2015), Michie (2011), May (2009), Proctor (2011), Stirman (2019), Aarons (2011), Cane (2012), Pinnock (2017) \u2022 MOUDAR\xAE v11.0")));
}

// ============================================
// v11.0 C2: EVIDENCE REPOSITORY VIEW
// Collaborative case database with pattern recommendations
// ============================================
function EvidenceRepositoryView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var activeTabState = React.useState('browse');
  var activeTab = activeTabState[0];
  var setActiveTab = activeTabState[1];
  var searchCountryState = React.useState('');
  var searchCountry = searchCountryState[0];
  var setSearchCountry = searchCountryState[1];
  var searchTagState = React.useState('');
  var searchTag = searchTagState[0];
  var setSearchTag = searchTagState[1];
  var searchResultState = React.useState(null);
  var searchResult = searchResultState[0];
  var setSearchResult = searchResultState[1];
  var selectedCaseState = React.useState(null);
  var selectedCase = selectedCaseState[0];
  var setSelectedCase = selectedCaseState[1];
  var recsContextState = React.useState({
    country: '',
    setting: '',
    frameworks: [],
    tags: []
  });
  var recsContext = recsContextState[0];
  var setRecsContext = recsContextState[1];
  var recsResultState = React.useState(null);
  var recsResult = recsResultState[0];
  var setRecsResult = recsResultState[1];
  var stats = EvidenceRepository.getStats();
  var allCases = EvidenceRepository.cases;
  function handleSearch() {
    var criteria = {};
    if (searchCountry) criteria.country = searchCountry;
    if (searchTag) criteria.tag = searchTag;
    setSearchResult(EvidenceRepository.search(criteria));
  }
  function handleRecommendations() {
    setRecsResult(EvidenceRepository.getRecommendations(recsContext));
  }
  var tabs = [{
    key: 'browse',
    label: t('ðŸ“‚ Explorer', 'ðŸ“‚ Browse')
  }, {
    key: 'search',
    label: t('ðŸ” Rechercher', 'ðŸ” Search')
  }, {
    key: 'recommend',
    label: t('ðŸ¤– Recommandations', 'ðŸ¤– Recommendations')
  }, {
    key: 'stats',
    label: t('ðŸ“Š Statistiques', 'ðŸ“Š Statistics')
  }, {
    key: 'contribute',
    label: t('âž• Contribuer', 'âž• Contribute')
  }];
  return /*#__PURE__*/React.createElement("div", {
    className: "max-w-6xl mx-auto p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDDC4\uFE0F ", t('RÃ©pertoire Collaboratif de Preuves', 'Collaborative Evidence Repository'), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-gradient-to-r from-cyan-100 to-teal-100 text-cyan-700 text-xs rounded-full font-bold"
  }, "v11.0")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mt-1"
  }, stats.totalCases, " ", t('cas', 'cases'), " \u2022 ", stats.countryCount, " ", t('pays', 'countries'), " \u2022 ", t('Plus d\'utilisateurs = meilleures recommandations', 'More users = better recommendations'))), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-1 mb-6 bg-gray-100 p-1 rounded-xl overflow-x-auto"
  }, tabs.map(function (tab) {
    return /*#__PURE__*/React.createElement("button", {
      key: tab.key,
      onClick: function () {
        setActiveTab(tab.key);
      },
      className: "px-3 py-2 rounded-lg text-xs font-medium whitespace-nowrap " + (activeTab === tab.key ? "bg-white shadow text-cyan-700" : "text-gray-600 hover:bg-gray-200")
    }, tab.label);
  })), activeTab === 'browse' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, allCases.map(function (c) {
    var isSelected = selectedCase === c.id;
    return /*#__PURE__*/React.createElement("div", {
      key: c.id,
      onClick: function () {
        setSelectedCase(isSelected ? null : c.id);
      },
      className: "p-5 bg-white rounded-xl border cursor-pointer transition-all " + (isSelected ? "border-cyan-500 shadow-lg" : "hover:shadow-md")
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start mb-2"
    }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-gray-800"
    }, c.title), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500"
    }, c.country, " \u2022 ", c.setting, " \u2022 ", c.designType)), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-1"
    }, c.frameworks.map(function (f) {
      return /*#__PURE__*/React.createElement("span", {
        key: f,
        className: "px-2 py-0.5 bg-indigo-50 text-indigo-700 text-xs rounded-full"
      }, f);
    }))), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-gray-600"
    }, c.keyFindings), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-1 mt-2"
    }, c.tags.slice(0, 5).map(function (tg) {
      return /*#__PURE__*/React.createElement("span", {
        key: tg,
        className: "px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded"
      }, tg);
    })), isSelected && /*#__PURE__*/React.createElement("div", {
      className: "mt-4 pt-4 border-t space-y-4"
    }, /*#__PURE__*/React.createElement("div", {
      className: "grid md:grid-cols-4 gap-3"
    }, /*#__PURE__*/React.createElement("div", {
      className: "p-3 bg-blue-50 rounded-lg text-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, "N"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-blue-700"
    }, c.sampleSize)), /*#__PURE__*/React.createElement("div", {
      className: "p-3 bg-green-50 rounded-lg text-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, t('DurÃ©e', 'Duration')), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-green-700"
    }, c.duration)), /*#__PURE__*/React.createElement("div", {
      className: "p-3 bg-purple-50 rounded-lg text-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, t('StratÃ©gies', 'Strategies')), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-purple-700"
    }, c.strategies.length, " ERIC")), /*#__PURE__*/React.createElement("div", {
      className: "p-3 bg-amber-50 rounded-lg text-center"
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500"
    }, "Status"), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-amber-700"
    }, c.status))), c.proctorOutcomes && /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h5", {
      className: "text-xs font-bold text-gray-600 mb-2"
    }, "Proctor Outcomes (%)"), /*#__PURE__*/React.createElement("div", {
      className: "grid grid-cols-4 gap-2"
    }, Object.keys(c.proctorOutcomes).map(function (o) {
      var v = c.proctorOutcomes[o];
      return /*#__PURE__*/React.createElement("div", {
        key: o,
        className: "text-center"
      }, /*#__PURE__*/React.createElement("div", {
        className: "text-xs text-gray-500 capitalize"
      }, o), /*#__PURE__*/React.createElement("div", {
        className: "font-bold text-sm " + (v >= 70 ? "text-green-700" : v >= 50 ? "text-amber-700" : "text-red-700")
      }, v, "%"));
    }))), /*#__PURE__*/React.createElement("div", {
      className: "p-3 bg-amber-50 rounded-lg"
    }, /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-amber-800"
    }, /*#__PURE__*/React.createElement("strong", null, t('LeÃ§on:', 'Lesson:')), " ", c.lessonsLearned))));
  })), activeTab === 'search' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-3 mb-4"
  }, /*#__PURE__*/React.createElement("input", {
    value: searchCountry,
    onChange: function (e) {
      setSearchCountry(e.target.value);
    },
    placeholder: t('Pays...', 'Country...'),
    className: "p-2 border rounded-lg text-sm"
  }), /*#__PURE__*/React.createElement("input", {
    value: searchTag,
    onChange: function (e) {
      setSearchTag(e.target.value);
    },
    placeholder: t('Tag (mental-health, LMIC...)', 'Tag (mental-health, LMIC...)'),
    className: "p-2 border rounded-lg text-sm"
  }), /*#__PURE__*/React.createElement("button", {
    onClick: handleSearch,
    className: "px-4 py-2 bg-cyan-600 text-white rounded-lg font-bold"
  }, "\uD83D\uDD0D ", t('Rechercher', 'Search')))), searchResult && /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mb-3"
  }, searchResult.length, " ", t('rÃ©sultat(s)', 'result(s)')), searchResult.map(function (c) {
    return /*#__PURE__*/React.createElement("div", {
      key: c.id,
      className: "p-4 bg-white rounded-xl border mb-2"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-gray-800 text-sm"
    }, c.title), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-500"
    }, c.country, " \u2022 ", c.setting), /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-600 mt-1"
    }, c.keyFindings));
  }))), activeTab === 'recommend' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83E\uDD16 ", t('Recommandations basÃ©es sur les patterns', 'Pattern-based Recommendations')), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500 mb-4"
  }, t('DÃ©crivez votre contexte et MOUDAR identifie les cas similaires et les stratÃ©gies les plus efficaces.', 'Describe your context and MOUDAR identifies similar cases and most effective strategies.')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-3 mb-4"
  }, /*#__PURE__*/React.createElement("input", {
    value: recsContext.country,
    onChange: function (e) {
      setRecsContext(Object.assign({}, recsContext, {
        country: e.target.value
      }));
    },
    placeholder: t('Pays', 'Country'),
    className: "p-2 border rounded-lg text-sm"
  }), /*#__PURE__*/React.createElement("input", {
    value: recsContext.setting,
    onChange: function (e) {
      setRecsContext(Object.assign({}, recsContext, {
        setting: e.target.value
      }));
    },
    placeholder: t('Contexte (Primary care, Hospital...)', 'Setting (Primary care, Hospital...)'),
    className: "p-2 border rounded-lg text-sm"
  })), /*#__PURE__*/React.createElement("button", {
    onClick: handleRecommendations,
    className: "px-6 py-3 bg-gradient-to-r from-cyan-600 to-teal-600 text-white rounded-xl font-bold shadow-lg hover:from-cyan-700 hover:to-teal-700"
  }, "\uD83E\uDD16 ", t('Obtenir recommandations', 'Get Recommendations'))), recsResult && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-5 bg-gradient-to-r from-cyan-600 to-teal-700 text-white rounded-2xl shadow-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xs uppercase tracking-wider opacity-80 mb-1"
  }, t('BasÃ© sur', 'Based on')), /*#__PURE__*/React.createElement("div", {
    className: "text-xl font-bold"
  }, recsResult.basedOn)), /*#__PURE__*/React.createElement("div", {
    className: "text-right"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-xs opacity-80"
  }, t('Confiance', 'Confidence')), /*#__PURE__*/React.createElement("div", {
    className: "text-xl font-bold capitalize"
  }, recsResult.confidence)))), recsResult.recommendedStrategies.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-green-50 rounded-xl border border-green-200 p-5"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-green-800 mb-3"
  }, "\uD83D\uDCCB ", t('StratÃ©gies ERIC recommandÃ©es', 'Recommended ERIC Strategies')), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 flex-wrap"
  }, recsResult.recommendedStrategies.map(function (s) {
    return /*#__PURE__*/React.createElement("span", {
      key: s,
      className: "px-3 py-1.5 bg-green-100 text-green-700 rounded-lg font-mono font-bold text-sm"
    }, s, " (", recsResult.strategyFrequency[s], "x)");
  }))), recsResult.similarCases.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDCC2 ", t('Cas similaires', 'Similar Cases')), recsResult.similarCases.map(function (c) {
    return /*#__PURE__*/React.createElement("div", {
      key: c.id,
      className: "p-3 bg-gray-50 rounded-lg mb-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-sm"
    }, c.title), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-400 ml-2"
    }, "(", c.country, ")"));
  })))), activeTab === 'stats' && /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83C\uDF0D ", t('Par pays', 'By Country')), Object.keys(stats.countries).map(function (c) {
    return /*#__PURE__*/React.createElement("div", {
      key: c,
      className: "flex justify-between items-center p-2 border-b"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-sm"
    }, c), /*#__PURE__*/React.createElement("span", {
      className: "font-bold text-cyan-700"
    }, stats.countries[c]));
  })), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDCDA ", t('Cadres utilisÃ©s', 'Frameworks Used')), Object.keys(stats.frameworkUsage).sort(function (a, b) {
    return stats.frameworkUsage[b] - stats.frameworkUsage[a];
  }).map(function (f) {
    return /*#__PURE__*/React.createElement("div", {
      key: f,
      className: "flex justify-between items-center p-2 border-b"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-sm font-mono"
    }, f), /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, /*#__PURE__*/React.createElement("div", {
      className: "h-2 rounded-full bg-indigo-200",
      style: {
        width: stats.frameworkUsage[f] / stats.totalCases * 100 + 'px'
      }
    }), /*#__PURE__*/React.createElement("span", {
      className: "font-bold text-indigo-700"
    }, stats.frameworkUsage[f])));
  }))), activeTab === 'contribute' && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-6 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-4"
  }, "\uD83E\uDD1D"), /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 text-lg mb-2"
  }, t('Contribuez au rÃ©pertoire', 'Contribute to the Repository')), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 max-w-lg mx-auto mb-4"
  }, t('Partagez vos rÃ©sultats d\'implÃ©mentation (anonymisÃ©s) pour amÃ©liorer les recommandations pour tous. Plus le rÃ©pertoire grandit, plus les recommandations sont prÃ©cises.', 'Share your implementation results (anonymized) to improve recommendations for everyone. The more the repository grows, the more precise recommendations become.')), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-400"
  }, t('FonctionnalitÃ© disponible dans MOUDARÂ® Cloud (prochainement)', 'Feature available in MOUDARÂ® Cloud (coming soon)'))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500"
  }, "\uD83D\uDCDA ", t('RÃ©pertoire alimentÃ© par des cas publiÃ©s et des contributions anonymisÃ©es. Toutes les donnÃ©es respectent les principes FAIR.', 'Repository fed by published cases and anonymized contributions. All data follows FAIR principles.'), " \u2022 MOUDAR\xAE v11.0")));
}

// ============================================
// v11.0 C3: API & SDK VIEW
// Developer documentation and code samples
// ============================================
function APISDKView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var activeTabState = React.useState('overview');
  var activeTab = activeTabState[0];
  var setActiveTab = activeTabState[1];
  var selectedLangState = React.useState('python');
  var selectedLang = selectedLangState[0];
  var setSelectedLang = selectedLangState[1];
  var docs = MoudarSDK.generateDocs(lang);
  var endpoints = Object.keys(MoudarSDK.endpoints);
  var samples = MoudarSDK.codeSamples;
  var tabs = [{
    key: 'overview',
    label: t('ðŸ“‹ Vue d\'ensemble', 'ðŸ“‹ Overview')
  }, {
    key: 'endpoints',
    label: t('ðŸ”Œ Endpoints', 'ðŸ”Œ Endpoints')
  }, {
    key: 'sdk',
    label: t('ðŸ’» SDK', 'ðŸ’» SDK')
  }, {
    key: 'integrations',
    label: t('ðŸ”— IntÃ©grations', 'ðŸ”— Integrations')
  }];
  var methodColor = function (m) {
    return m.indexOf('POST') !== -1 ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700';
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "max-w-6xl mx-auto p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83D\uDD0C ", t('API & SDK â€” Ã‰cosystÃ¨me AcadÃ©mique', 'API & SDK â€” Academic Ecosystem'), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-gradient-to-r from-orange-100 to-amber-100 text-orange-700 text-xs rounded-full font-bold"
  }, "v11.0")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mt-1"
  }, docs.totalEndpoints, " endpoints \u2022 R, Python, Stata \u2022 REDCap & DHIS2 \u2022 ", docs.baseUrl)), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-1 mb-6 bg-gray-100 p-1 rounded-xl"
  }, tabs.map(function (tab) {
    return /*#__PURE__*/React.createElement("button", {
      key: tab.key,
      onClick: function () {
        setActiveTab(tab.key);
      },
      className: "px-4 py-2 rounded-lg text-xs font-medium " + (activeTab === tab.key ? "bg-white shadow text-orange-700" : "text-gray-600 hover:bg-gray-200")
    }, tab.label);
  })), activeTab === 'overview' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-6 bg-gradient-to-br from-orange-600 to-amber-600 text-white rounded-2xl shadow-lg"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "text-xl font-bold mb-2"
  }, "MOUDAR\xAE REST API v1"), /*#__PURE__*/React.createElement("p", {
    className: "text-sm opacity-90 mb-4"
  }, t('IntÃ©grez MOUDAR dans vos workflows de recherche existants. AccÃ©dez Ã  tous les cadres IS, les analyses et le rÃ©pertoire de preuves via une API REST standard.', 'Integrate MOUDAR into your existing research workflows. Access all IS frameworks, analyses, and evidence repository through a standard REST API.')), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-4 gap-3 mt-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-white bg-opacity-20 rounded-lg text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, docs.totalEndpoints), /*#__PURE__*/React.createElement("div", {
    className: "text-xs opacity-80"
  }, "Endpoints")), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-white bg-opacity-20 rounded-lg text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, "5"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs opacity-80"
  }, "SDKs")), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-white bg-opacity-20 rounded-lg text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, "1000"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs opacity-80"
  }, "req/h")), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-white bg-opacity-20 rounded-lg text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, "REST"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs opacity-80"
  }, "JSON")))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDD10 ", t('Authentification', 'Authentication')), /*#__PURE__*/React.createElement("div", {
    className: "bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm"
  }, "curl -H \"Authorization: Bearer YOUR_API_KEY\" \\", /*#__PURE__*/React.createElement("br", null), "\xA0\xA0", docs.baseUrl, "/cfir/constructs"))), activeTab === 'endpoints' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, endpoints.map(function (ep) {
    var info = MoudarSDK.endpoints[ep];
    var parts = ep.split(' ');
    return /*#__PURE__*/React.createElement("div", {
      key: ep,
      className: "p-4 bg-white rounded-xl border hover:shadow-md transition-all"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-3 mb-2"
    }, /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 rounded text-xs font-bold font-mono " + methodColor(parts[0])
    }, parts[0]), /*#__PURE__*/React.createElement("span", {
      className: "font-mono text-sm text-gray-800"
    }, parts[1]), /*#__PURE__*/React.createElement("span", {
      className: "ml-auto px-2 py-0.5 rounded text-xs " + (info.auth === 'none' ? 'bg-green-100 text-green-600' : 'bg-amber-100 text-amber-600')
    }, info.auth === 'none' ? 'ðŸ”“ Public' : 'ðŸ”‘ Auth')), /*#__PURE__*/React.createElement("p", {
      className: "text-sm text-gray-600"
    }, info.description), /*#__PURE__*/React.createElement("div", {
      className: "flex gap-4 mt-2 text-xs text-gray-400"
    }, /*#__PURE__*/React.createElement("span", null, "Params: ", info.params.join(', '))));
  })), activeTab === 'sdk' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 mb-4"
  }, [{
    key: 'python',
    label: 'ðŸ Python',
    color: 'bg-blue-600'
  }, {
    key: 'r',
    label: 'ðŸ“Š R',
    color: 'bg-blue-800'
  }, {
    key: 'stata',
    label: 'ðŸ“ˆ Stata',
    color: 'bg-green-700'
  }].map(function (l) {
    return /*#__PURE__*/React.createElement("button", {
      key: l.key,
      onClick: function () {
        setSelectedLang(l.key);
      },
      className: "px-4 py-2 rounded-lg font-medium text-sm transition-all " + (selectedLang === l.key ? l.color + " text-white" : "bg-gray-100 text-gray-600")
    }, l.label);
  })), samples[selectedLang] && Object.keys(samples[selectedLang]).filter(function (k) {
    return typeof samples[selectedLang][k] === 'string';
  }).map(function (key) {
    return /*#__PURE__*/React.createElement("div", {
      key: key,
      className: "bg-white rounded-xl border p-5"
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-center mb-3"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-gray-800 capitalize"
    }, key), /*#__PURE__*/React.createElement("button", {
      onClick: function () {
        navigator.clipboard.writeText(samples[selectedLang][key]);
      },
      className: "px-3 py-1 bg-gray-100 text-gray-600 rounded-lg text-xs hover:bg-gray-200"
    }, "\uD83D\uDCCB Copy")), /*#__PURE__*/React.createElement("pre", {
      className: "bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-xs overflow-x-auto whitespace-pre-wrap"
    }, samples[selectedLang][key]));
  })), activeTab === 'integrations' && /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-2xl"
  }, "\uD83D\uDD34"), /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800"
  }, "REDCap")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-3"
  }, samples.redcap.description), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-1"
  }, samples.redcap.fields.slice(0, 6).map(function (f) {
    return /*#__PURE__*/React.createElement("span", {
      key: f,
      className: "px-2 py-0.5 bg-red-50 text-red-700 text-xs rounded font-mono"
    }, f);
  }), /*#__PURE__*/React.createElement("span", {
    className: "text-xs text-gray-400"
  }, "..."))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-2xl"
  }, "\uD83D\uDD35"), /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800"
  }, "DHIS2 (WHO)")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600 mb-3"
  }, samples.dhis2.description), /*#__PURE__*/React.createElement("div", {
    className: "flex flex-wrap gap-1"
  }, samples.dhis2.dataElements.map(function (d) {
    return /*#__PURE__*/React.createElement("span", {
      key: d,
      className: "px-2 py-0.5 bg-blue-50 text-blue-700 text-xs rounded font-mono"
    }, d);
  }))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-2xl"
  }, "\uD83D\uDCD3"), /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800"
  }, "Jupyter Notebooks")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, t('Importez directement vos Ã©valuations MOUDAR dans des notebooks Jupyter pour analyses avancÃ©es (pandas, plotly, scikit-learn).', 'Import MOUDAR evaluations directly into Jupyter notebooks for advanced analyses (pandas, plotly, scikit-learn).'))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center gap-3 mb-3"
  }, /*#__PURE__*/React.createElement("span", {
    className: "text-2xl"
  }, "\uD83D\uDCCA"), /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800"
  }, "R / RStudio")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, t('Package R natif avec fonctions de visualisation ggplot2 intÃ©grÃ©es pour rapports de recherche IS.', 'Native R package with built-in ggplot2 visualization functions for IS research reports.')))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500"
  }, "\uD83D\uDCDA MOUDAR\xAE API v1 \u2022 REST/JSON \u2022 ", t('Documentation complÃ¨te:', 'Full documentation:'), " api.moudar.org/docs \u2022 ", t('IntÃ©grations:', 'Integrations:'), " R, Python, Stata, REDCap, DHIS2 \u2022 MOUDAR\xAE v11.0")));
}
// v11.0: LLM PROTOCOL ANALYZER VIEW â€” AI Research Copilot (GAME-CHANGER)
// Trinkley et al. (2024) â€¢ Pinnock et al. (2017, StaRI)
// ============================================
function ProtocolAnalyzerView(props) {
  var lang = props.lang || 'fr';
  var t = function (fr, en) {
    return lang === 'fr' ? fr : en;
  };
  var textState = React.useState('');
  var text = textState[0];
  var setText = textState[1];
  var modeState = React.useState('protocol');
  var mode = modeState[0];
  var setMode = modeState[1];
  var resultState = React.useState(null);
  var result = resultState[0];
  var setResult = resultState[1];
  var analyzingState = React.useState(false);
  var analyzing = analyzingState[0];
  var setAnalyzing = analyzingState[1];
  var activeTabState = React.useState('overview');
  var activeTab = activeTabState[0];
  var setActiveTab = activeTabState[1];

  // v11.0 Deep AI states
  var engineState = React.useState('quick');
  var engine = engineState[0];
  var setEngine = engineState[1];
  var deepResultState = React.useState(null);
  var deepResult = deepResultState[0];
  var setDeepResult = deepResultState[1];
  var deepLoadingState = React.useState(false);
  var deepLoading = deepLoadingState[0];
  var setDeepLoading = deepLoadingState[1];
  var deepErrorState = React.useState(null);
  var deepError = deepErrorState[0];
  var setDeepError = deepErrorState[1];
  var sectionTypeState = React.useState('theoreticalFramework');
  var sectionType = sectionTypeState[0];
  var setSectionType = sectionTypeState[1];
  var generatedSectionState = React.useState('');
  var generatedSection = generatedSectionState[0];
  var setGeneratedSection = generatedSectionState[1];
  var generatingState = React.useState(false);
  var generating = generatingState[0];
  var setGenerating = generatingState[1];
  var text2State = React.useState('');
  var text2 = text2State[0];
  var setText2 = text2State[1];
  var compareResultState = React.useState(null);
  var compareResult = compareResultState[0];
  var setCompareResult = compareResultState[1];
  var comparingState = React.useState(false);
  var comparing = comparingState[0];
  var setComparing = comparingState[1];
  var mainTabState = React.useState('analyze');
  var mainTab = mainTabState[0];
  var setMainTab = mainTabState[1];
  function handleAnalyze() {
    if (!text.trim() || text.trim().length < 50) return;
    setAnalyzing(true);
    setTimeout(function () {
      var res = LLMProtocolAnalyzer.analyze(text, mode, lang);
      setResult(res);
      setAnalyzing(false);
      setActiveTab('overview');
    }, 800);
  }
  function handleClear() {
    setText('');
    setResult(null);
    setDeepResult(null);
    setDeepError(null);
    setActiveTab('overview');
    setGeneratedSection('');
    setCompareResult(null);
    setText2('');
  }
  function handleDeepAnalyze() {
    if (!text.trim() || text.trim().length < 50) return;
    setDeepLoading(true);
    setDeepError(null);
    setDeepResult(null);
    DeepAIAnalyzer.analyzeDeep(text, mode, lang, function (parsed) {
      setDeepResult(parsed);
      setDeepLoading(false);
      setActiveTab('deep_overview');
    }, function (err) {
      setDeepError(err.message || t('Erreur API', 'API error'));
      setDeepLoading(false);
    });
  }
  function handleGenerateSection() {
    setGenerating(true);
    setGeneratedSection('');
    DeepAIAnalyzer.generateSection(sectionType, text || 'IS research project', lang, function (s) {
      setGeneratedSection(s);
      setGenerating(false);
    }, function (err) {
      setGeneratedSection('Error: ' + (err.message || ''));
      setGenerating(false);
    });
  }
  function handleCompare() {
    if (!text.trim() || !text2.trim()) return;
    setComparing(true);
    setCompareResult(null);
    DeepAIAnalyzer.compareProtocols(text, text2, lang, function (p) {
      setCompareResult(p);
      setComparing(false);
    }, function (err) {
      setCompareResult({
        _error: err.message
      });
      setComparing(false);
    });
  }
  var resultTabs = [{
    key: 'overview',
    label: t('ðŸ“Š Vue d\'ensemble', 'ðŸ“Š Overview')
  }, {
    key: 'extraction',
    label: t('ðŸ”Ž Extraction', 'ðŸ”Ž Extraction')
  }, {
    key: 'cfir',
    label: t('ðŸ—ï¸ CFIR 2.0', 'ðŸ—ï¸ CFIR 2.0')
  }, {
    key: 'reaim',
    label: t('ðŸŽ¯ RE-AIM', 'ðŸŽ¯ RE-AIM')
  }, {
    key: 'stari',
    label: t('ðŸ“‹ StaRI', 'ðŸ“‹ StaRI')
  }, {
    key: 'gaps',
    label: t('âš ï¸ Gaps', 'âš ï¸ Gaps')
  }, {
    key: 'recommendations',
    label: t('ðŸ’¡ Actions', 'ðŸ’¡ Actions')
  }];
  var scoreColor = function (score) {
    return score >= 70 ? 'text-green-700 bg-green-50 border-green-200' : score >= 40 ? 'text-amber-700 bg-amber-50 border-amber-200' : 'text-red-700 bg-red-50 border-red-200';
  };
  return /*#__PURE__*/React.createElement("div", {
    className: "max-w-6xl mx-auto p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "mb-6"
  }, /*#__PURE__*/React.createElement("h2", {
    className: "text-2xl font-bold text-gray-800 flex items-center gap-2"
  }, "\uD83E\uDD16 ", t('AI Research Copilot â€” Analyseur de Protocole', 'AI Research Copilot â€” Protocol Analyzer'), /*#__PURE__*/React.createElement("span", {
    className: "px-2 py-0.5 bg-gradient-to-r from-purple-100 to-blue-100 text-purple-700 text-xs rounded-full font-bold"
  }, "v11.0 GAME-CHANGER")), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mt-1"
  }, t('Collez votre protocole, proposition de subvention ou manuscrit. MOUDAR analyse automatiquement contre CFIR 2.0, RE-AIM, StaRI, Proctor, et identifie les gaps.', 'Paste your protocol, grant proposal, or manuscript. MOUDAR automatically analyzes against CFIR 2.0, RE-AIM, StaRI, Proctor, and identifies gaps.'), " \u2022 Trinkley et al. (2024)")), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2 mb-6"
  }, [{
    key: 'analyze',
    label: t('ðŸ”¬ Analyser', 'ðŸ”¬ Analyze')
  }, {
    key: 'generate',
    label: t('âœï¸ GÃ©nÃ©rer Section', 'âœï¸ Generate Section')
  }, {
    key: 'compare',
    label: t('âš–ï¸ Comparer', 'âš–ï¸ Compare')
  }].map(function (tab) {
    return /*#__PURE__*/React.createElement("button", {
      key: tab.key,
      onClick: function () {
        setMainTab(tab.key);
      },
      className: "px-5 py-2.5 rounded-xl font-medium transition-all " + (mainTab === tab.key ? "bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg" : "bg-gray-100 text-gray-600 hover:bg-gray-200")
    }, tab.label);
  })), mainTab === 'analyze' && /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-4 gap-3 mb-6"
  }, Object.keys(LLMProtocolAnalyzer.modes).map(function (modeId) {
    var m = LLMProtocolAnalyzer.modes[modeId];
    return /*#__PURE__*/React.createElement("button", {
      key: modeId,
      onClick: function () {
        setMode(modeId);
        setResult(null);
      },
      className: "p-4 rounded-xl border-2 transition-all text-left " + (mode === modeId ? "border-purple-500 bg-purple-50 shadow-lg" : "border-gray-200 hover:border-purple-300 bg-white")
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-2xl mb-1"
    }, m.icon), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-sm text-gray-800"
    }, m.label[lang]), /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500 mt-1"
    }, m.description[lang]));
  })), !result && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border shadow-sm p-6 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-3"
  }, /*#__PURE__*/React.createElement("label", {
    className: "font-bold text-gray-700"
  }, t('Collez votre texte ci-dessous', 'Paste your text below')), /*#__PURE__*/React.createElement("span", {
    className: "text-xs text-gray-400"
  }, text.split(/\s+/).filter(Boolean).length, " ", t('mots', 'words'))), /*#__PURE__*/React.createElement("textarea", {
    value: text,
    onChange: function (e) {
      setText(e.target.value);
    },
    className: "w-full h-64 p-4 border rounded-xl text-sm font-mono resize-y focus:ring-2 focus:ring-purple-500 focus:border-purple-500",
    placeholder: t('Collez ici votre protocole de recherche, proposition de subvention, ou manuscrit...\n\nExemple: "Cette Ã©tude d\'implÃ©mentation utilise un design hybride de type 2 pour Ã©valuer l\'intÃ©gration de soins de santÃ© mentale dans les centres de soins primaires au Maroc..."', 'Paste your research protocol, grant proposal, or manuscript here...\n\nExample: "This implementation study uses a hybrid type 2 design to evaluate the integration of mental health care in primary care centers in Morocco..."')
  }), /*#__PURE__*/React.createElement("div", {
    className: "mt-4 flex justify-between items-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex gap-2"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setEngine('quick');
    },
    className: "px-3 py-1.5 rounded-lg text-xs font-medium " + (engine === 'quick' ? "bg-blue-600 text-white" : "bg-white border text-gray-500")
  }, "\u26A1 NLP"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setEngine('deep');
    },
    className: "px-3 py-1.5 rounded-lg text-xs font-medium " + (engine === 'deep' ? "bg-purple-600 text-white" : "bg-white border text-gray-500")
  }, "\uD83E\uDD16 Deep AI"), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      setEngine('both');
    },
    className: "px-3 py-1.5 rounded-lg text-xs font-medium " + (engine === 'both' ? "bg-gradient-to-r from-blue-600 to-purple-600 text-white" : "bg-white border text-gray-500")
  }, "\uD83D\uDD2C ", t('Double', 'Dual'))), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      if (engine === 'quick' || engine === 'both') handleAnalyze();
      if (engine === 'deep' || engine === 'both') handleDeepAnalyze();
    },
    disabled: text.trim().split(/\s+/).length < 10 || analyzing || deepLoading,
    className: "px-8 py-3 rounded-xl font-bold shadow-lg transition-all hover:scale-105 " + (text.trim().split(/\s+/).length >= 10 ? "bg-gradient-to-r from-purple-600 to-blue-600 text-white hover:from-purple-700 hover:to-blue-700" : "bg-gray-200 text-gray-400 cursor-not-allowed")
  }, analyzing ? 'â³ ...' : 'ðŸ¤– ' + t('Analyser', 'Analyze')))), result && /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-4"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: handleClear,
    className: "px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 text-sm"
  }, "\u2190 ", t('Nouvelle analyse', 'New analysis')), /*#__PURE__*/React.createElement("span", {
    className: "text-xs text-gray-400"
  }, result.wordCount, " ", t('mots analysÃ©s', 'words analyzed'), " \u2022 ", result.mode)), /*#__PURE__*/React.createElement("div", {
    className: "grid grid-cols-5 gap-3 mb-6"
  }, [{
    label: 'Global',
    score: result.scores.global,
    icon: 'ðŸŒ'
  }, {
    label: 'CFIR 2.0',
    score: result.scores.cfir,
    icon: 'ðŸ—ï¸'
  }, {
    label: 'RE-AIM',
    score: result.scores.reaim,
    icon: 'ðŸŽ¯'
  }, {
    label: 'StaRI',
    score: result.scores.stari || 0,
    icon: 'ðŸ“‹'
  }, {
    label: t('Ã‰quitÃ©', 'Equity'),
    score: result.extractedElements.equity.detected ? 100 : 0,
    icon: 'âš–ï¸'
  }].map(function (card) {
    return /*#__PURE__*/React.createElement("div", {
      key: card.label,
      className: "p-4 rounded-xl border text-center " + scoreColor(card.score)
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-lg mb-1"
    }, card.icon), /*#__PURE__*/React.createElement("div", {
      className: "text-2xl font-bold"
    }, card.score, "%"), /*#__PURE__*/React.createElement("div", {
      className: "text-xs font-medium"
    }, card.label));
  })), /*#__PURE__*/React.createElement("div", {
    className: "flex gap-1 mb-4 bg-gray-100 p-1 rounded-xl overflow-x-auto"
  }, resultTabs.map(function (tab) {
    return /*#__PURE__*/React.createElement("button", {
      key: tab.key,
      onClick: function () {
        setActiveTab(tab.key);
      },
      className: "px-3 py-2 rounded-lg text-xs font-medium transition-all whitespace-nowrap " + (activeTab === tab.key ? "bg-white shadow text-purple-700" : "text-gray-600 hover:bg-gray-200")
    }, tab.label);
  })), activeTab === 'overview' && /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "bg-green-50 rounded-xl border border-green-200 p-5"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-green-800 mb-3"
  }, "\u2705 ", t('Points forts', 'Strengths')), result.strengths.length === 0 && /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500"
  }, t('Aucun point fort majeur dÃ©tectÃ©', 'No major strengths detected')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, result.strengths.map(function (s, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "text-sm text-green-700 p-2 bg-white rounded-lg"
    }, s.message, s.items && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500 mt-1"
    }, s.items.slice(0, 3).join(', ')));
  }))), /*#__PURE__*/React.createElement("div", {
    className: "bg-red-50 rounded-xl border border-red-200 p-5"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-red-800 mb-3"
  }, "\u26A0\uFE0F ", t('Gaps critiques', 'Critical Gaps')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, result.gaps.filter(function (g) {
    return g.severity === 'critical';
  }).map(function (g, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "text-sm p-3 bg-white rounded-lg border border-red-100"
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-red-700"
    }, g.message), g.reference && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-400 mt-1"
    }, "\uD83D\uDCDA ", g.reference), g.action && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-blue-600 mt-1"
    }, "\uD83D\uDCA1 ", g.action));
  }), result.gaps.filter(function (g) {
    return g.severity === 'critical';
  }).length === 0 && /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-green-600"
  }, "\uD83C\uDF89 ", t('Aucun gap critique !', 'No critical gaps!'))))), activeTab === 'extraction' && /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4"
  }, Object.keys(result.extractedElements).map(function (cat) {
    var elem = result.extractedElements[cat];
    return /*#__PURE__*/React.createElement("div", {
      key: cat,
      className: "p-4 rounded-xl border " + (elem.detected ? "bg-green-50 border-green-200" : "bg-gray-50 border-gray-200")
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-center mb-2"
    }, /*#__PURE__*/React.createElement("h4", {
      className: "font-bold text-sm text-gray-800"
    }, elem.label), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 rounded-full text-xs " + (elem.detected ? "bg-green-100 text-green-700" : "bg-red-100 text-red-600")
    }, elem.detected ? elem.count + ' ' + t('trouvÃ©(s)', 'found') : t('Non dÃ©tectÃ©', 'Not detected'))), elem.items.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "space-y-1"
    }, elem.items.slice(0, 5).map(function (item, i) {
      return /*#__PURE__*/React.createElement("div", {
        key: i,
        className: "text-xs text-gray-600 p-1.5 bg-white rounded border truncate",
        title: item
      }, "\u2022 ", item.substring(0, 100));
    }), elem.items.length > 5 && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-400"
    }, "+", elem.items.length - 5, " ", t('de plus', 'more'))));
  })), activeTab === 'cfir' && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-1"
  }, "\uD83C\uDFD7\uFE0F ", t('Mapping CFIR 2.0 automatique', 'Automatic CFIR 2.0 Mapping')), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500 mb-4"
  }, "Damschroder et al. (2022) \u2022 ", t('Couverture:', 'Coverage:'), " ", result.scores.cfir, "%"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-3"
  }, Object.keys(result.cfirMapping).map(function (cid) {
    var mapping = result.cfirMapping[cid];
    return /*#__PURE__*/React.createElement("div", {
      key: cid,
      className: "p-3 rounded-lg border " + (mapping.detected ? "bg-green-50 border-green-200" : "bg-gray-50 border-gray-200")
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-center"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-mono text-sm font-bold text-gray-700"
    }, cid), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 rounded text-xs " + (mapping.strength === 'strong' ? 'bg-green-100 text-green-700' : mapping.strength === 'partial' ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-400')
    }, mapping.strength === 'strong' ? 'â˜…â˜…â˜…' : mapping.strength === 'partial' ? 'â˜…â˜†â˜†' : 'â€”')), mapping.matches.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500 mt-1"
    }, mapping.matches.slice(0, 3).join(', ')));
  }))), activeTab === 'reaim' && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-1"
  }, "\uD83C\uDFAF ", t('Mapping RE-AIM', 'RE-AIM Mapping')), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500 mb-4"
  }, "Glasgow et al. (2019) \u2022 ", t('Couverture:', 'Coverage:'), " ", result.scores.reaim, "%"), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-5 gap-4"
  }, ['reach', 'effectiveness', 'adoption', 'implementation', 'maintenance'].map(function (dim) {
    var mapping = result.reaimMapping[dim] || {
      detected: false,
      matches: [],
      strength: 'absent'
    };
    var colors = {
      reach: '#3b82f6',
      effectiveness: '#10b981',
      adoption: '#f59e0b',
      implementation: '#8b5cf6',
      maintenance: '#ef4444'
    };
    return /*#__PURE__*/React.createElement("div", {
      key: dim,
      className: "p-4 rounded-xl border-2 text-center " + (mapping.detected ? "border-opacity-100" : "border-gray-200 opacity-50"),
      style: {
        borderColor: mapping.detected ? colors[dim] : undefined,
        backgroundColor: mapping.detected ? colors[dim] + '10' : undefined
      }
    }, /*#__PURE__*/React.createElement("div", {
      className: "text-3xl mb-2"
    }, mapping.detected ? 'âœ…' : 'âŒ'), /*#__PURE__*/React.createElement("div", {
      className: "font-bold text-sm capitalize",
      style: {
        color: colors[dim]
      }
    }, dim.charAt(0).toUpperCase() + dim.slice(1)), /*#__PURE__*/React.createElement("div", {
      className: "text-xs mt-1 " + (mapping.detected ? "text-green-600" : "text-red-500")
    }, mapping.detected ? mapping.matches.length + ' ' + t('indices', 'cues') : t('Non dÃ©tectÃ©', 'Not detected')), mapping.matches.length > 0 && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500 mt-2"
    }, mapping.matches.slice(0, 2).join(', ')));
  }))), activeTab === 'stari' && result.stariCompliance && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800"
  }, "\uD83D\uDCCB ", t('ConformitÃ© StaRI (Standards for Reporting Implementation Studies)', 'StaRI Compliance (Standards for Reporting Implementation Studies)')), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500"
  }, "Pinnock H et al. (2017). BMJ, 356:i6795")), /*#__PURE__*/React.createElement("div", {
    className: "p-3 rounded-xl border text-center " + scoreColor(result.stariCompliance.score)
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-2xl font-bold"
  }, result.stariCompliance.score, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs"
  }, result.stariCompliance.detectedItems, "/", result.stariCompliance.totalItems))), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, result.stariCompliance.items.map(function (item) {
    return /*#__PURE__*/React.createElement("div", {
      key: item.id,
      className: "flex items-center justify-between p-3 rounded-lg border " + (item.detected ? "bg-green-50 border-green-200" : "bg-red-50 border-red-100")
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-3"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-lg"
    }, item.detected ? 'âœ…' : 'âŒ'), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "text-sm font-medium text-gray-700"
    }, item.item), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-400 ml-2"
    }, "[", item.section, "]"))), /*#__PURE__*/React.createElement("div", {
      className: "flex items-center gap-2"
    }, item.matches.length > 0 && /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-green-600"
    }, item.matches[0]), /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-400"
    }, item.id)));
  }))), activeTab === 'gaps' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, result.gaps.length === 0 && /*#__PURE__*/React.createElement("div", {
    className: "text-center p-8 bg-green-50 rounded-xl border border-green-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-3"
  }, "\uD83C\uDF89"), /*#__PURE__*/React.createElement("p", {
    className: "text-green-700 font-bold"
  }, t('Aucun gap identifiÃ© ! Excellent protocole.', 'No gaps identified! Excellent protocol.'))), result.gaps.map(function (gap, i) {
    var borderColor = gap.severity === 'critical' ? 'border-l-red-500 bg-red-50' : 'border-l-amber-500 bg-amber-50';
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-4 rounded-xl border-l-4 " + borderColor
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex justify-between items-start mb-1"
    }, /*#__PURE__*/React.createElement("span", {
      className: "font-medium text-gray-800 text-sm"
    }, gap.message), /*#__PURE__*/React.createElement("span", {
      className: "px-2 py-0.5 rounded text-xs font-bold " + (gap.severity === 'critical' ? 'bg-red-200 text-red-800' : 'bg-amber-200 text-amber-800')
    }, gap.severity === 'critical' ? 'ðŸ”´ CRITICAL' : 'ðŸŸ  IMPORTANT')), gap.reference && /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-gray-400"
    }, "\uD83D\uDCDA ", gap.reference), gap.action && /*#__PURE__*/React.createElement("p", {
      className: "text-xs text-blue-600 mt-1"
    }, "\uD83D\uDCA1 ", gap.action));
  })), activeTab === 'recommendations' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-3"
  }, result.recommendations.map(function (rec, i) {
    var bgColor = rec.priority === 'critical' ? 'bg-red-50 border-red-200' : rec.priority === 'high' ? 'bg-amber-50 border-amber-200' : 'bg-blue-50 border-blue-200';
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-4 rounded-xl border " + bgColor
    }, /*#__PURE__*/React.createElement("div", {
      className: "flex gap-3"
    }, /*#__PURE__*/React.createElement("span", {
      className: "text-lg flex-shrink-0"
    }, rec.icon), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "text-sm text-gray-700"
    }, rec.message))));
  }), /*#__PURE__*/React.createElement("div", {
    className: "p-5 bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl border border-purple-200 mt-6"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-purple-800 mb-2"
  }, "\uD83D\uDD17 ", t('Modules MOUDAR recommandÃ©s', 'Recommended MOUDAR modules')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-3 gap-3"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-white rounded-lg text-center text-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-lg"
  }, "\uD83C\uDFD7\uFE0F"), /*#__PURE__*/React.createElement("div", {
    className: "font-medium"
  }, "CFIR 2.0"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, t('Ã‰valuateur exact', 'Exact evaluator'))), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-white rounded-lg text-center text-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-lg"
  }, "\uD83C\uDFAF"), /*#__PURE__*/React.createElement("div", {
    className: "font-medium"
  }, "Proctor Outcomes"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, t('8 outcomes', '8 outcomes'))), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-white rounded-lg text-center text-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-lg"
  }, "\uD83D\uDD04"), /*#__PURE__*/React.createElement("div", {
    className: "font-medium"
  }, "FRAME"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, t('Suivi adaptations', 'Adaptation tracking'))), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-white rounded-lg text-center text-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-lg"
  }, "\uD83E\uDDE9"), /*#__PURE__*/React.createElement("div", {
    className: "font-medium"
  }, "NPT"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, t('Normalisation', 'Normalization'))), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-white rounded-lg text-center text-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-lg"
  }, "\uD83D\uDD00"), /*#__PURE__*/React.createElement("div", {
    className: "font-medium"
  }, "SMART"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, t('Design adaptatif', 'Adaptive design'))), /*#__PURE__*/React.createElement("div", {
    className: "p-3 bg-white rounded-lg text-center text-sm"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-lg"
  }, "\uD83C\uDF31"), /*#__PURE__*/React.createElement("div", {
    className: "font-medium"
  }, t('PÃ©rennitÃ©', 'Sustainability')), /*#__PURE__*/React.createElement("div", {
    className: "text-xs text-gray-500"
  }, "Scheirer"))))))), deepLoading && /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-8 bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl border border-purple-200 text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl mb-4 animate-pulse"
  }, "\uD83E\uDD16"), /*#__PURE__*/React.createElement("p", {
    className: "font-bold text-purple-800"
  }, t('Analyse IA profonde en cours...', 'Deep AI analysis in progress...')), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-500 mt-2"
  }, t('Claude analyse contre CFIR 2.0, RE-AIM, StaRI, Proctor, ERIC...', 'Claude analyzing against CFIR 2.0, RE-AIM, StaRI, Proctor, ERIC...'))), deepError && /*#__PURE__*/React.createElement("div", {
    className: "mb-6 p-4 bg-red-50 rounded-xl border border-red-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-red-700"
  }, "\u274C ", deepError)), deepResult && !deepResult._parseError && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6 mb-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-6 bg-gradient-to-br from-purple-600 to-blue-700 text-white rounded-2xl shadow-lg"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex items-center justify-between"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("div", {
    className: "text-xs uppercase tracking-wider opacity-80 mb-2"
  }, "\uD83E\uDD16 ", t('Analyse IA Profonde â€” RÃ©sumÃ©', 'Deep AI Analysis â€” Summary')), /*#__PURE__*/React.createElement("p", {
    className: "text-sm leading-relaxed opacity-95"
  }, deepResult.executiveSummary || '')), /*#__PURE__*/React.createElement("div", {
    className: "text-right ml-6 flex-shrink-0"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-4xl font-bold"
  }, deepResult.globalScore, "%"), /*#__PURE__*/React.createElement("div", {
    className: "text-xs opacity-80"
  }, "AI Score")))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-5 rounded-xl border text-center " + ((deepResult.publishabilityScore || 0) >= 70 ? 'bg-green-50 border-green-200 text-green-700' : 'bg-amber-50 border-amber-200 text-amber-700')
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold"
  }, deepResult.publishabilityScore || 0, "%"), /*#__PURE__*/React.createElement("div", {
    className: "font-medium"
  }, t('PubliabilitÃ©', 'Publishability'))), /*#__PURE__*/React.createElement("div", {
    className: "p-5 rounded-xl border text-center " + ((deepResult.fundabilityScore || 0) >= 70 ? 'bg-green-50 border-green-200 text-green-700' : 'bg-amber-50 border-amber-200 text-amber-700')
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold"
  }, deepResult.fundabilityScore || 0, "%"), /*#__PURE__*/React.createElement("div", {
    className: "font-medium"
  }, t('FinanÃ§abilitÃ©', 'Fundability')))), deepResult.strengths && deepResult.strengths.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-green-50 rounded-xl border border-green-200 p-5"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-green-800 mb-3"
  }, "\u2705 ", t('Forces (IA)', 'Strengths (AI)')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, deepResult.strengths.map(function (s, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "text-sm text-green-700 p-2 bg-white rounded-lg"
    }, s.item || s, s.reference ? ' â€” ðŸ“š ' + s.reference : '');
  }))), deepResult.criticalGaps && deepResult.criticalGaps.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-red-50 rounded-xl border border-red-200 p-5"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-red-800 mb-3"
  }, "\uD83D\uDD34 ", t('Gaps critiques (IA)', 'Critical Gaps (AI)')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, deepResult.criticalGaps.map(function (g, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-3 bg-white rounded-lg border border-red-100"
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-red-700 text-sm"
    }, g.gap), g.recommendation && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-blue-600 mt-1"
    }, "\uD83D\uDCA1 ", g.recommendation), g.moudarModule && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-purple-600 mt-1"
    }, "\uD83D\uDD27 MOUDAR: ", g.moudarModule), g.reference && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-400 mt-1"
    }, "\uD83D\uDCDA ", g.reference));
  }))), deepResult.recommendations && deepResult.recommendations.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDE80 ", t('Recommandations IA', 'AI Recommendations')), /*#__PURE__*/React.createElement("div", {
    className: "space-y-2"
  }, deepResult.recommendations.sort(function (a, b) {
    return (a.priority || 99) - (b.priority || 99);
  }).map(function (rec, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "flex items-start gap-3 p-3 bg-purple-50 rounded-lg"
    }, /*#__PURE__*/React.createElement("span", {
      className: "w-7 h-7 rounded-full bg-purple-200 text-purple-800 flex items-center justify-center font-bold text-xs flex-shrink-0"
    }, rec.priority || i + 1), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("span", {
      className: "text-sm text-gray-800"
    }, rec.action), rec.moudarModule && /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-purple-600 ml-2"
    }, "\uD83D\uDD27 ", rec.moudarModule)));
  }))), deepResult.strategiesIdentified && deepResult.strategiesIdentified.length > 0 && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83D\uDCCB ", t('StratÃ©gies ERIC identifiÃ©es', 'ERIC strategies identified')), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-2"
  }, deepResult.strategiesIdentified.map(function (s, i) {
    return /*#__PURE__*/React.createElement("div", {
      key: i,
      className: "p-3 bg-blue-50 rounded-lg border border-blue-200"
    }, /*#__PURE__*/React.createElement("div", {
      className: "font-medium text-sm text-blue-800"
    }, s.name), s.ericCode && /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-blue-600 font-mono"
    }, s.ericCode), s.cfirTargets && /*#__PURE__*/React.createElement("div", {
      className: "text-xs text-gray-500 mt-1"
    }, "CFIR: ", (Array.isArray(s.cfirTargets) ? s.cfirTargets : []).join(', ')));
  })))), deepResult && deepResult._parseError && /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border p-5 mb-6"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-gray-800 mb-3"
  }, "\uD83E\uDD16 ", t('RÃ©ponse IA', 'AI Response')), /*#__PURE__*/React.createElement("div", {
    className: "whitespace-pre-wrap font-mono text-xs bg-gray-50 p-4 rounded-lg max-h-96 overflow-auto"
  }, deepResult._rawText)), mainTab === 'generate' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-5 bg-purple-50 rounded-xl border border-purple-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-purple-800 mb-1"
  }, "\u270D\uFE0F ", t('GÃ©nÃ©ration de sections par IA', 'AI Section Generation')), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, t('L\'IA gÃ©nÃ¨re un brouillon conforme StaRI (Pinnock 2017) prÃªt pour votre protocole.', 'AI generates a StaRI-compliant draft (Pinnock 2017) ready for your protocol.'))), /*#__PURE__*/React.createElement("div", {
    className: "bg-white rounded-xl border shadow-sm p-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-6"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "font-bold text-gray-700 text-sm block mb-2"
  }, t('Type de section', 'Section type')), /*#__PURE__*/React.createElement("div", {
    className: "grid gap-2"
  }, Object.keys(DeepAIAnalyzer.generableSections).map(function (secId) {
    var sec = DeepAIAnalyzer.generableSections[secId];
    return /*#__PURE__*/React.createElement("button", {
      key: secId,
      onClick: function () {
        setSectionType(secId);
      },
      className: "p-3 rounded-lg border text-left text-sm " + (sectionType === secId ? "border-purple-500 bg-purple-50" : "border-gray-200 hover:border-purple-300")
    }, sec.label[lang], " ", /*#__PURE__*/React.createElement("span", {
      className: "text-xs text-gray-400"
    }, "(", sec.stariRef, ")"));
  }))), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "font-bold text-gray-700 text-sm block mb-2"
  }, t('Contexte du projet', 'Project context')), /*#__PURE__*/React.createElement("textarea", {
    value: text,
    onChange: function (e) {
      setText(e.target.value);
    },
    className: "w-full h-48 p-3 border rounded-xl text-sm resize-y",
    placeholder: t('DÃ©crivez votre projet: intervention, population, contexte...', 'Describe your project: intervention, population, context...')
  }), /*#__PURE__*/React.createElement("button", {
    onClick: handleGenerateSection,
    disabled: generating || !text.trim(),
    className: "mt-3 w-full px-6 py-3 rounded-xl font-bold " + (!generating && text.trim() ? "bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg" : "bg-gray-200 text-gray-400")
  }, generating ? 'â³...' : 'âœï¸ ' + t('GÃ©nÃ©rer', 'Generate')))), generatedSection && /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-5 bg-gray-50 rounded-xl border"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-between items-center mb-3"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-gray-800"
  }, "\uD83D\uDCDD ", t('Section gÃ©nÃ©rÃ©e', 'Generated section')), /*#__PURE__*/React.createElement("button", {
    onClick: function () {
      navigator.clipboard.writeText(generatedSection);
    },
    className: "px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs"
  }, "\uD83D\uDCCB ", t('Copier', 'Copy'))), /*#__PURE__*/React.createElement("div", {
    className: "whitespace-pre-wrap bg-white p-4 rounded-lg border max-h-96 overflow-auto text-sm"
  }, generatedSection)))), mainTab === 'compare' && /*#__PURE__*/React.createElement("div", {
    className: "space-y-6"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-5 bg-purple-50 rounded-xl border border-purple-200"
  }, /*#__PURE__*/React.createElement("h3", {
    className: "font-bold text-purple-800 mb-1"
  }, "\u2696\uFE0F ", t('Comparaison de protocoles par IA', 'AI Protocol Comparison')), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-600"
  }, t('Comparez deux protocoles IS cÃ´te Ã  cÃ´te.', 'Compare two IS protocols side by side.'))), /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4"
  }, /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "font-bold text-gray-700 text-sm block mb-2"
  }, "\uD83D\uDCCB ", t('Protocole 1', 'Protocol 1')), /*#__PURE__*/React.createElement("textarea", {
    value: text,
    onChange: function (e) {
      setText(e.target.value);
    },
    className: "w-full h-48 p-3 border rounded-xl text-sm font-mono resize-y"
  })), /*#__PURE__*/React.createElement("div", null, /*#__PURE__*/React.createElement("label", {
    className: "font-bold text-gray-700 text-sm block mb-2"
  }, "\uD83D\uDCCB ", t('Protocole 2', 'Protocol 2')), /*#__PURE__*/React.createElement("textarea", {
    value: text2,
    onChange: function (e) {
      setText2(e.target.value);
    },
    className: "w-full h-48 p-3 border rounded-xl text-sm font-mono resize-y"
  }))), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-center"
  }, /*#__PURE__*/React.createElement("button", {
    onClick: handleCompare,
    disabled: comparing || !text.trim() || !text2.trim(),
    className: "px-8 py-3 rounded-xl font-bold shadow-lg " + (!comparing && text.trim() && text2.trim() ? "bg-gradient-to-r from-purple-600 to-blue-600 text-white" : "bg-gray-200 text-gray-400")
  }, comparing ? 'â³...' : 'âš–ï¸ ' + t('Comparer', 'Compare'))), compareResult && !compareResult._error && /*#__PURE__*/React.createElement("div", {
    className: "space-y-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "grid md:grid-cols-2 gap-4"
  }, /*#__PURE__*/React.createElement("div", {
    className: "p-5 rounded-xl border text-center bg-blue-50 border-blue-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-blue-700"
  }, compareResult.protocol1Score || 0, "%"), /*#__PURE__*/React.createElement("div", {
    className: "font-medium"
  }, t('Protocole 1', 'Protocol 1'))), /*#__PURE__*/React.createElement("div", {
    className: "p-5 rounded-xl border text-center bg-green-50 border-green-200"
  }, /*#__PURE__*/React.createElement("div", {
    className: "text-3xl font-bold text-green-700"
  }, compareResult.protocol2Score || 0, "%"), /*#__PURE__*/React.createElement("div", {
    className: "font-medium"
  }, t('Protocole 2', 'Protocol 2')))), compareResult.synthesis && /*#__PURE__*/React.createElement("div", {
    className: "p-5 bg-purple-50 rounded-xl border border-purple-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-purple-800 mb-2"
  }, "\uD83E\uDD16 ", t('SynthÃ¨se', 'Synthesis')), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-700"
  }, compareResult.synthesis)), compareResult.recommendation && /*#__PURE__*/React.createElement("div", {
    className: "p-5 bg-green-50 rounded-xl border border-green-200"
  }, /*#__PURE__*/React.createElement("h4", {
    className: "font-bold text-green-800 mb-2"
  }, "\uD83D\uDCA1 ", t('Recommandation', 'Recommendation')), /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-gray-700"
  }, compareResult.recommendation))), compareResult && compareResult._error && /*#__PURE__*/React.createElement("div", {
    className: "p-4 bg-red-50 rounded-xl border border-red-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-sm text-red-700"
  }, "\u274C ", compareResult._error))), /*#__PURE__*/React.createElement("div", {
    className: "mt-6 p-4 bg-blue-50 rounded-xl border border-blue-200"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-gray-500"
  }, "\uD83D\uDCDA ", /*#__PURE__*/React.createElement("strong", null, "Citations:"), " Trinkley KE et al. (2024). ", /*#__PURE__*/React.createElement("em", null, "Implementation Science"), ", 19:21 \u2022 Pinnock H et al. (2017). ", /*#__PURE__*/React.createElement("em", null, "BMJ"), ", 356:i6795 (StaRI) \u2022 Damschroder LJ et al. (2022) (CFIR 2.0) \u2022 Glasgow RE et al. (2019) (RE-AIM) \u2022 ", t('Analyse IA profonde propulsÃ©e par Claude (Anthropic)', 'Deep AI powered by Claude (Anthropic)'), " \u2022 MOUDAR\xAE v11.0")));
}
function App() {
  var viewState = useState("home");
  var view = viewState[0];
  var setView = viewState[1];
  var langState = useState("fr");
  var lang = langState[0];
  var setLang = langState[1];
  var projectState = useState(null);
  var currentProject = projectState[0];
  var setCurrentProject = projectState[1];
  var demoModeState = useState(false);
  var demoMode = demoModeState[0];
  var setDemoMode = demoModeState[1];
  var diagnosticProjectState = useState(null);
  var diagnosticProject = diagnosticProjectState[0];
  var setDiagnosticProject = diagnosticProjectState[1];

  // â•â•â• v8.1 - Nouveaux Ã©tats â•â•â•
  var showOnboardingState = useState(!OnboardingWizard.isCompleted());
  var showOnboarding = showOnboardingState[0];
  var setShowOnboarding = showOnboardingState[1];
  var showImportExportState = useState(false);
  var showImportExport = showImportExportState[0];
  var setShowImportExport = showImportExportState[1];
  var importExportProjectState = useState(null);
  var importExportProject = importExportProjectState[0];
  var setImportExportProject = importExportProjectState[1];
  // â•â•â• Fin v8.1 â•â•â•

  // â•â•â• v9.0 - Chargement automatique du projet Gold Demo â•â•â•
  useEffect(function () {
    // VÃ©rifier si un projet Gold est en attente
    var goldProjectStr = sessionStorage.getItem('MOUDAR_GOLD_PROJECT');
    if (goldProjectStr) {
      sessionStorage.removeItem('MOUDAR_GOLD_PROJECT');
      try {
        var goldProject = JSON.parse(goldProjectStr);
        console.log("[MOUDAR GOLD] Chargement du projet Gold:", goldProject.id);

        // DÃ©sactiver l'onboarding et ouvrir le wizard
        setShowOnboarding(false);
        setCurrentProject(goldProject);
        setView("wizard");
        console.log("[MOUDAR GOLD] âœ… Projet Gold chargÃ© dans le wizard");
      } catch (e) {
        console.error("[MOUDAR GOLD] Erreur parsing projet:", e);
      }
    }

    // Aussi Ã©couter l'Ã©vÃ©nement personnalisÃ© (fallback)
    function handleGoldProject(event) {
      var projectId = event.detail && event.detail.projectId;
      if (projectId) {
        console.log("[MOUDAR GOLD] Ouverture du projet via Ã©vÃ©nement:", projectId);
        var projects = StorageManager.getProjects();
        var goldProject = projects.find(function (p) {
          return p.id === projectId;
        });
        if (goldProject) {
          setShowOnboarding(false);
          setCurrentProject(goldProject);
          setView("wizard");
        }
      }
    }
    window.addEventListener('MoudarOpenGoldProject', handleGoldProject);
    return function () {
      window.removeEventListener('MoudarOpenGoldProject', handleGoldProject);
    };
  }, []);
  // â•â•â• Fin v9.0 â•â•â•

  function handleOpenProject(p) {
    setCurrentProject(p);
    setView("wizard");
  }
  function handleStartDiagnostic(p) {
    setDiagnosticProject(p);
    setDemoMode(false);
    setView("diagnostic");
  }
  function handleNavigate(newView) {
    if (newView !== "wizard") {
      setCurrentProject(null);
    }
    if (newView !== "diagnostic") {
      setDemoMode(false);
      setDiagnosticProject(null);
    }
    setView(newView);
  }
  function handleLoadDemo() {
    // Charger le projet dÃ©mo dans le wizard
    setCurrentProject(DEMO_PROJECT);
    setView("wizard");
  }
  function handleStartSectorExample(sectorKey) {
    try {
      var meta = SECTOR_EXAMPLES && SECTOR_EXAMPLES[sectorKey];
      if (!meta) {
        // fallback: projet dÃ©mo classique
        setCurrentProject(DEMO_PROJECT);
        setView("wizard");
        return;
      }
      var now = new Date().toISOString();
      var defaultDomain = sectorKey;
      if (!DOMAINS[defaultDomain]) {
        if (sectorKey === "industry") defaultDomain = "workplace";else if (sectorKey === "research") defaultDomain = "prfi";
      }
      if (!DOMAINS[defaultDomain]) {
        defaultDomain = "health";
      }
      var project = {
        id: "SECTOR_" + sectorKey + "_" + now,
        title: meta.title[lang] || meta.title.fr || meta.title.en,
        organization: "",
        domain: defaultDomain,
        phase: "preparation",
        resourceLevel: "UMIC",
        context: meta.context[lang] || meta.context.fr || meta.context.en,
        population: "",
        barriers: meta.challenge[lang] || meta.challenge.fr || meta.challenge.en,
        objectives: ["equity", "sustainability"],
        status: "draft",
        createdAt: now,
        updatedAt: now,
        tags: ["sector_example", sectorKey]
      };
      setCurrentProject(project);
      setDemoMode(false);
      setView("wizard");
    } catch (e) {
      console.error("handleStartSectorExample error", e);
      setCurrentProject(DEMO_PROJECT);
      setView("wizard");
    }
  }
  function handleLoadDemoDiagnostic() {
    setDemoMode(true);
    setDiagnosticProject(null);
    setView("diagnostic");
  }
  return /*#__PURE__*/React.createElement("div", {
    className: "min-h-screen bg-slate-50"
  }, showOnboarding && /*#__PURE__*/React.createElement(OnboardingWizardView, {
    lang: lang,
    onComplete: function (prefs, action) {
      setShowOnboarding(false);
    },
    onNavigate: function (newView) {
      setShowOnboarding(false);
      handleNavigate(newView);
    }
  }), showImportExport && /*#__PURE__*/React.createElement(ImportExportPanel, {
    lang: lang,
    project: importExportProject,
    onClose: function () {
      setShowImportExport(false);
      setImportExportProject(null);
    },
    onImportComplete: function (result) {
      setShowImportExport(false);
      setImportExportProject(null);
      if (result.success) {
        handleNavigate('space');
      }
    }
  }), /*#__PURE__*/React.createElement(Header, {
    currentView: view,
    onNavigate: handleNavigate,
    lang: lang,
    setLang: setLang
  }), /*#__PURE__*/React.createElement("main", {
    id: "main-content",
    className: "max-w-7xl mx-auto px-4 py-6",
    role: "main",
    "aria-label": "Contenu principal"
  }, view === "home" && /*#__PURE__*/React.createElement(HomeView, {
    onNavigate: handleNavigate,
    onLoadDemo: handleLoadDemo,
    onStartSectorExample: handleStartSectorExample,
    lang: lang
  }), view === "adaptive" && /*#__PURE__*/React.createElement(AdaptiveCockpitView, {
    lang: lang
  }), view === "grants" && /*#__PURE__*/React.createElement(GrantsView, {
    lang: lang
  }), view === "qualitative" && /*#__PURE__*/React.createElement(QualitativeView, {
    lang: lang
  }), view === "benchmark" && /*#__PURE__*/React.createElement(BenchmarkView, {
    lang: lang
  }), view === "digitaltwin" && /*#__PURE__*/React.createElement(DigitalTwinView, {
    lang: lang
  }), view === "budgetimpact" && /*#__PURE__*/React.createElement(BudgetImpactView, {
    lang: lang
  }), view === "stakeholders" && /*#__PURE__*/React.createElement(StakeholderMapView, {
    lang: lang
  }), view === "sustainability" && /*#__PURE__*/React.createElement(SustainabilityView, {
    lang: lang
  }), view === "consensus" && /*#__PURE__*/React.createElement(ConsensusValidationView, {
    lang: lang
  }), view === "security" && /*#__PURE__*/React.createElement(SecuritySettingsView, {
    lang: lang
  }), view === "npt" && /*#__PURE__*/React.createElement(NPTView, {
    lang: lang,
    project: selectedProject
  }), view === "frameTracker" && /*#__PURE__*/React.createElement(FRAMETrackerView, {
    lang: lang,
    project: selectedProject
  }), view === "proctorOutcomes" && /*#__PURE__*/React.createElement(ProctorOutcomesView, {
    lang: lang,
    project: selectedProject
  }), view === "smartDesign" && /*#__PURE__*/React.createElement(SMARTDesignView, {
    lang: lang,
    project: selectedProject
  }), view === "protocolAnalyzer" && /*#__PURE__*/React.createElement(ProtocolAnalyzerView, {
    lang: lang,
    project: selectedProject
  }), view === "ontology" && /*#__PURE__*/React.createElement(OntologyView, {
    lang: lang,
    project: selectedProject
  }), view === "evidenceRepo" && /*#__PURE__*/React.createElement(EvidenceRepositoryView, {
    lang: lang,
    project: selectedProject
  }), view === "apiSdk" && /*#__PURE__*/React.createElement(APISDKView, {
    lang: lang,
    project: selectedProject
  }), view === "cfirGuide" && /*#__PURE__*/React.createElement(CFIRUserGuideView, {
    lang: lang,
    project: selectedProject
  }), view === "prism" && /*#__PURE__*/React.createElement(PRISMView, {
    lang: lang,
    project: selectedProject
  }), view === "irlm" && /*#__PURE__*/React.createElement(IRLMView, {
    lang: lang,
    project: selectedProject
  }), view === "comB" && /*#__PURE__*/React.createElement(COMBView, {
    lang: lang,
    project: selectedProject
  }), view === "hybridDesign" && /*#__PURE__*/React.createElement(HybridDesignView, {
    lang: lang,
    project: selectedProject
  }), view === "sustainability" && /*#__PURE__*/React.createElement(SustainabilityView, {
    lang: lang,
    project: selectedProject
  }), view === "qualitative" && /*#__PURE__*/React.createElement(QualitativeView, {
    lang: lang,
    project: selectedProject
  }), view === "product" && /*#__PURE__*/React.createElement(ProductView, {
    onNavigate: handleNavigate,
    lang: lang
  }), view === "about" && /*#__PURE__*/React.createElement(AboutView, {
    lang: lang
  }), view === "investors" && /*#__PURE__*/React.createElement(InvestorsView, {
    lang: lang
  }), view === "pitch" && /*#__PURE__*/React.createElement(PitchView, {
    onNavigate: handleNavigate,
    lang: lang
  }), view === "myProjects" && /*#__PURE__*/React.createElement(MyProjectsView, {
    onNavigate: handleNavigate,
    onOpenProject: handleOpenProject,
    onStartDiagnostic: handleStartDiagnostic,
    lang: lang,
    onShowImportExport: function (p) {
      setImportExportProject(p);
      setShowImportExport(true);
    }
  }), view === "space" && /*#__PURE__*/React.createElement(SpaceView, {
    onNavigate: handleNavigate,
    onOpenProject: handleOpenProject,
    onStartDiagnostic: handleStartDiagnostic,
    lang: lang,
    onShowImportExport: function (p) {
      setImportExportProject(p);
      setShowImportExport(true);
    }
  }), view === "analyzer" && /*#__PURE__*/React.createElement(AnalyzerView, {
    onNavigate: handleNavigate,
    lang: lang
  }), view === "wizard" && /*#__PURE__*/React.createElement(WizardView, {
    existingProject: currentProject,
    lang: lang
  }), view === "diagnostic" && /*#__PURE__*/React.createElement(DiagnosticView, {
    lang: lang,
    demoMode: demoMode,
    linkedProject: diagnosticProject
  }), view === "cases" && /*#__PURE__*/React.createElement(UseCasesView, {
    lang: lang
  }), view === "table" && /*#__PURE__*/React.createElement(ImplementationTableView, {
    lang: lang
  }), view === "kanban" && /*#__PURE__*/React.createElement(ImplementationKanbanView, {
    lang: lang
  }), view === "pricing" && /*#__PURE__*/React.createElement(PricingView, {
    lang: lang
  }), view === "roadmap" && /*#__PURE__*/React.createElement(RoadmapView, {
    lang: lang
  })), /*#__PURE__*/React.createElement("footer", {
    className: "bg-slate-900 text-slate-400 py-8 px-4 mt-12",
    role: "contentinfo",
    "aria-label": "Pied de page MOUDAR"
  }, /*#__PURE__*/React.createElement("div", {
    className: "max-w-7xl mx-auto text-center"
  }, /*#__PURE__*/React.createElement("div", {
    className: "flex justify-center mb-4"
  }, /*#__PURE__*/React.createElement("svg", {
    width: "32",
    height: "32",
    viewBox: "0 0 40 40",
    fill: "none",
    xmlns: "http://www.w3.org/2000/svg"
  }, /*#__PURE__*/React.createElement("circle", {
    cx: "20",
    cy: "20",
    r: "18",
    fill: "url(#footerGrad)",
    stroke: "#64748b",
    strokeWidth: "1"
  }), /*#__PURE__*/React.createElement("path", {
    d: "M12 28V14L20 22L28 14V28",
    stroke: "white",
    strokeWidth: "2.5",
    strokeLinecap: "round",
    strokeLinejoin: "round"
  }), /*#__PURE__*/React.createElement("circle", {
    cx: "20",
    cy: "12",
    r: "2.5",
    fill: "#34d399"
  }), /*#__PURE__*/React.createElement("defs", null, /*#__PURE__*/React.createElement("linearGradient", {
    id: "footerGrad",
    x1: "0",
    y1: "0",
    x2: "40",
    y2: "40"
  }, /*#__PURE__*/React.createElement("stop", {
    offset: "0%",
    stopColor: "#3b82f6"
  }), /*#__PURE__*/React.createElement("stop", {
    offset: "100%",
    stopColor: "#10b981"
  }))))), /*#__PURE__*/React.createElement("p", {
    className: "text-slate-300 mb-2 font-medium"
  }, "Moudar \u2014 ", lang === "fr" ? "Co-pilote Science de la mise en Å“uvre" : "Implementation Science Co-pilot"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs mb-3"
  }, "D\xE9velopp\xE9 par Younes MOUDAR"), /*#__PURE__*/React.createElement(AIMetricsPanel, {
    lang: lang
  }), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-slate-600 mb-4"
  }, "\u26A0\uFE0F ", lang === "fr" ? "Version dÃ©mo â€” DonnÃ©es stockÃ©es localement â€” Ne pas saisir de donnÃ©es patients" : "Demo version â€” Data stored locally â€” Do not enter patient data"), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-center gap-6 mb-4"
  }, /*#__PURE__*/React.createElement("a", {
    href: "https://moudar.com",
    className: "text-blue-400 hover:text-blue-300 text-sm"
  }, "\uD83C\uDF10 moudar.com"), /*#__PURE__*/React.createElement("a", {
    href: "mailto:contact@moudar.com",
    className: "text-teal-400 hover:text-teal-300 text-sm"
  }, "\uD83D\uDCE9 ", lang === "fr" ? "Demander une dÃ©mo" : "Request a demo")), /*#__PURE__*/React.createElement("div", {
    className: "flex justify-center gap-4 text-xs text-slate-600 mb-4"
  }, /*#__PURE__*/React.createElement("a", {
    href: "CGU_moudar.html",
    target: "_blank",
    className: "hover:text-slate-300 transition"
  }, lang === "fr" ? "CGU" : "Terms"), /*#__PURE__*/React.createElement("span", null, "\u2022"), /*#__PURE__*/React.createElement("a", {
    href: "mentions_legales_moudar.html",
    target: "_blank",
    className: "hover:text-slate-300 transition"
  }, lang === "fr" ? "Mentions lÃ©gales" : "Legal"), /*#__PURE__*/React.createElement("span", null, "\u2022"), /*#__PURE__*/React.createElement("a", {
    href: "politique_confidentialite_moudar.html",
    target: "_blank",
    className: "hover:text-slate-300 transition"
  }, lang === "fr" ? "ConfidentialitÃ©" : "Privacy")), /*#__PURE__*/React.createElement("div", {
    className: "border-t border-slate-700 pt-4 mt-2"
  }, /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-slate-600 mb-1"
  }, "\xA9 2025 ", /*#__PURE__*/React.createElement("strong", {
    className: "text-slate-100"
  }, "Younes MOUDAR"), " \u2013 ", /*#__PURE__*/React.createElement("strong", {
    className: "text-blue-400"
  }, "MOUDAR"), "\xAE"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-slate-600"
  }, lang === "fr" ? "Tous droits rÃ©servÃ©s â€¢ Version 11.0 Scientific Excellence (CFIR 2.0 Exact, ERIC, Equity, NPT, Proctor, FRAME, E2EE, Consensus)" : "All rights reserved â€¢ Version 11.0 Scientific Excellence (CFIR 2.0 Exact, ERIC, Equity, NPT, Proctor, FRAME, E2EE, Consensus)"), /*#__PURE__*/React.createElement("p", {
    className: "text-xs text-slate-700 mt-1 italic"
  }, lang === "fr" ? "Algorithme propriÃ©taire protÃ©gÃ© â€” MOUDAR Younes" : "Proprietary algorithm protected â€” Younes MOUDAR")))));
}
ReactDOM.createRoot(document.getElementById("root")).render(/*#__PURE__*/React.createElement(App, null));
    </script>


<!-- Cookie/Analytics consent banner (GA4 is loaded only on explicit opt-in) -->
<div id="moudar-cookie-banner" style="position:fixed;left:16px;right:16px;bottom:16px;z-index:9999;display:none;background:#ffffff;border:1px solid rgba(15,23,42,.15);border-radius:14px;padding:12px 14px;box-shadow:0 10px 30px rgba(2,6,23,.12);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;">
  <div style="display:flex;gap:14px;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;">
    <div style="min-width:260px;flex:1;">
      <div style="font-weight:700;color:#0f172a;margin-bottom:4px;">Cookies analytics</div>
      <div style="font-size:13px;line-height:1.35;color:#334155;">
        Nous utilisons des cookies analytics (Google Analytics) uniquement pour mesurer lâ€™usage de la dÃ©mo. Vous pouvez accepter ou refuser. Le refus nâ€™impacte pas les fonctionnalitÃ©s.
      </div>
    </div>
    <div style="display:flex;gap:8px;align-items:center;">
      <button id="moudar-cookie-deny" style="background:#f1f5f9;border:1px solid rgba(15,23,42,.15);color:#0f172a;border-radius:10px;padding:8px 10px;cursor:pointer;">Refuser</button>
      <button id="moudar-cookie-accept" style="background:#0f172a;border:1px solid #0f172a;color:#ffffff;border-radius:10px;padding:8px 10px;cursor:pointer;">Accepter</button>
    </div>
  </div>
</div>
<script>
  (function(){
    try{
      var key='MOUDAR_ANALYTICS_CONSENT';
      var consent=localStorage.getItem(key);
      var banner=document.getElementById('moudar-cookie-banner');
      if(!banner) return;
      if(consent==='granted' || consent==='denied'){ return; }
      banner.style.display='block';

      var accept=document.getElementById('moudar-cookie-accept');
      var deny=document.getElementById('moudar-cookie-deny');

      function close(){ banner.style.display='none'; }

      if(accept){
        accept.addEventListener('click', function(){
          localStorage.setItem(key,'granted');
          close();
          if(window.MOUDAR_loadAnalytics){ window.MOUDAR_loadAnalytics(); }
        });
      }
      if(deny){
        deny.addEventListener('click', function(){
          localStorage.setItem(key,'denied');
          close();
        });
      }
    }catch(e){}
  })();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- MOUDAR v9.0 - MODULE DÃ‰MO GOLD STANDARD                                     -->
<!-- Bouton de dÃ©monstration instantanÃ©e pour prÃ©sentations                      -->
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<button class="moudar-gold-btn" id="goldDemoBtn" onclick="launchGoldDemo()">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
    </svg>
    <span>ðŸ‡¸ðŸ‡³ DÃ©mo Gold : SÃ©nÃ©gal</span>
</button>

<div id="goldDemoModal" class="moudar-gold-modal" style="display:none;">
    <div class="moudar-gold-modal-content">
        <div style="font-size:48px;margin-bottom:20px;">ðŸ†</div>
        <h2 style="color:#fbbf24;font-size:24px;margin-bottom:16px;">ScÃ©nario Gold Standard</h2>
        <p style="color:#94a3b8;margin-bottom:24px;">Chargement du cas d'Ã©cole :<br><strong style="color:white;">SantÃ© Mentale au SÃ©nÃ©gal</strong></p>
        <div style="display:flex;align-items:center;justify-content:center;gap:8px;color:#fbbf24;">
            <svg class="animate-spin" style="width:24px;height:24px;" viewBox="0 0 24 24">
                <circle style="opacity:0.25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"/>
                <path style="opacity:0.75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
            </svg>
            <span id="goldDemoStatus">Injection des donnÃ©es...</span>
        </div>
    </div>
</div>

<script>
/**
 * MOUDAR v9.0 - GOLD STANDARD DEMO LAUNCHER
 * Lance une dÃ©monstration complÃ¨te avec un cas d'Ã©cole parfait
 */
function launchGoldDemo() {
    var modal = document.getElementById('goldDemoModal');
    var statusEl = document.getElementById('goldDemoStatus');
    var btn = document.getElementById('goldDemoBtn');
    
    // Afficher le modal de chargement
    modal.style.display = 'flex';
    btn.classList.add('loading');
    
    // ScÃ©nario Gold Standard : SantÃ© Mentale au SÃ©nÃ©gal
    var goldProject = {
        id: 'GOLD_SENEGAL_' + Date.now(),
        title: "Programme National d'IntÃ©gration de la SantÃ© Mentale - SÃ©nÃ©gal",
        organization: "MinistÃ¨re de la SantÃ© et de l'Action Sociale du SÃ©nÃ©gal",
        domain: "mentalHealth",
        phase: "preparation",
        country: "senegal",
        resourceLevel: "LMIC",
        settingType: "community",
        settingCount: 15,
        geographicScope: "national",
        populationSize: 1200000,
        teamSize: "20+",
        timeline: "36",
        budget: "1m_5m",
        experience: "moderate",
        
        context: "Le SÃ©nÃ©gal fait face Ã  un dÃ©fi majeur en santÃ© mentale avec seulement 0.1 psychiatre pour 100 000 habitants. Les rÃ©gions rurales de Kolda, Matam et Tambacounda sont particuliÃ¨rement touchÃ©es. Le MinistÃ¨re de la SantÃ© a lancÃ© un plan ambitieux 2024-2028 pour intÃ©grer les soins de santÃ© mentale dans les structures de soins primaires. Le programme mhGAP de l'OMS sera dÃ©ployÃ© avec une approche communautaire adaptÃ©e au contexte culturel local, impliquant les tradipraticiens et les leaders religieux comme relais de sensibilisation.",
        
        population: "Population rurale des rÃ©gions de Kolda, Matam et Tambacounda (environ 1.2 million d'habitants). Cible prioritaire : personnes souffrant de dÃ©pression, Ã©pilepsie, psychoses et troubles liÃ©s Ã  l'usage de substances. Groupes vulnÃ©rables : femmes en post-partum, jeunes dÃ©scolarisÃ©s, personnes Ã¢gÃ©es isolÃ©es.",
        
        barriers: "PÃ©nurie critique de ressources humaines spÃ©cialisÃ©es en psychiatrie. Forte stigmatisation culturelle des troubles mentaux associÃ©s Ã  des croyances traditionnelles. Surcharge de travail chronique des infirmiers chefs de poste. Financement dÃ©pendant de l'aide internationale et donc instable. Infrastructure numÃ©rique limitÃ©e rendant la tÃ©lÃ©-supervision complexe. RÃ©sistance de certains tradipraticiens face Ã  l'approche biomÃ©dicale.",
        
        facilitators: "Engagement politique fort du Ministre de la SantÃ©. Partenariat Ã©tabli avec l'OMS et le Fonds Mondial. ExpÃ©rience pilote rÃ©ussie Ã  ThiÃ¨s en 2022. RÃ©seau de cases de santÃ© communautaires existant. Implication des Bajenu Gox (marraines de quartier) dans la sensibilisation.",
        
        objectives: ["equity", "sustainability", "scale"],
        expectedOutcomes: ["adoption", "fidelity", "sustainability", "reach"],
        barrierCategories: ["knowledge", "resources", "culture", "leadership", "coordination"],
        
        additionalInfo: "Projet alignÃ© sur les ODD 3.4 et 3.8. Ã‰valuation prÃ©vue selon le cadre RE-AIM. Partenaires techniques : OMS, USAID, Fonds Mondial. Budget estimÃ© : 2.5M USD sur 3 ans. Objectif : rÃ©duire le treatment gap de 85% Ã  45% d'ici 2028.",
        
        status: "draft",
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString(),
        tags: ["gold_standard", "senegal", "mental_health", "mhGAP", "scaling"]
    };
    
    // SÃ©quence d'injection avec feedback visuel
    setTimeout(function() {
        statusEl.textContent = "Sauvegarde du projet...";
        
        // Sauvegarder dans localStorage
        try {
            var projects = JSON.parse(localStorage.getItem("moudar_projects") || "[]");
            projects = projects.filter(function(p) { 
                return !p.tags || p.tags.indexOf('gold_standard') === -1; 
            });
            projects.unshift(goldProject);
            localStorage.setItem("moudar_projects", JSON.stringify(projects));
            
            // Sauvegarder le projet complet pour le rÃ©cupÃ©rer aprÃ¨s reload
            sessionStorage.setItem('MOUDAR_GOLD_PROJECT', JSON.stringify(goldProject));
            
            console.log("[MOUDAR GOLD] Projet sauvegardÃ©:", goldProject.id);
        } catch(e) {
            console.error("[MOUDAR GOLD] Erreur sauvegarde:", e);
            modal.style.display = 'none';
            btn.classList.remove('loading');
            alert("Erreur lors de la sauvegarde. Veuillez rÃ©essayer.");
            return;
        }
        
        setTimeout(function() {
            statusEl.textContent = "Lancement de l'analyse IA...";
            
            setTimeout(function() {
                statusEl.textContent = "Redirection...";
                
                setTimeout(function() {
                    // Recharger la page - le projet sera chargÃ© automatiquement
                    location.reload();
                }, 500);
            }, 800);
        }, 600);
    }, 400);
}

</script>

</body>
</html>
